<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2017-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1492541918.182444.13859.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014197.html">
   <LINK REL="Next"  HREF="014201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1492541918.182444.13859.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Tue Apr 18 18:58:38 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="014197.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="014201.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14198">[ date ]</a>
              <a href="thread.html#14198">[ thread ]</a>
              <a href="subject.html#14198">[ subject ]</a>
              <a href="author.html#14198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  3304d57848479441ffa0facc6d9693a466559756 (commit)
      from  b66411f6cda6970c01283ddde6d8063c57b3b7d9 (commit)


- Log -----------------------------------------------------------------
commit 3304d57848479441ffa0facc6d9693a466559756
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
Date:   Tue Apr 18 14:50:00 2017 -0400

    Convert more tests to framework
    
    randtest, cipher_overhead_test, bioprintest, constant_time_test
    Move test_bioprint to 04 group
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/3228">https://github.com/openssl/openssl/pull/3228</A>)

-----------------------------------------------------------------------

Summary of changes:
 test/bioprinttest.c                                | 255 +++++-------
 test/build.info                                    |  10 +-
 test/cipher_overhead_test.c                        |  25 +-
 test/constant_time_test.c                          | 446 ++++++++-------------
 test/randtest.c                                    |  95 ++---
 .../{90-test_bioprint.t =&gt; 04-test_bioprint.t}     |   0
 6 files changed, 327 insertions(+), 504 deletions(-)
 rename test/recipes/{90-test_bioprint.t =&gt; 04-test_bioprint.t} (100%)

diff --git a/test/bioprinttest.c b/test/bioprinttest.c
index 4eeb4c6..ca0f1aa 100644
--- a/test/bioprinttest.c
+++ b/test/bioprinttest.c
@@ -11,8 +11,11 @@
 #include &lt;string.h&gt;
 #include &lt;openssl/bio.h&gt;
 #include &quot;internal/numbers.h&quot;
+#include &quot;testutil.h&quot;
+#include &quot;test_main.h&quot;
+#include &quot;test_main_custom.h&quot;
 
-#define nelem(x) (sizeof(x)/sizeof((x)[0]))
+#define nelem(x) (int)(sizeof(x) / sizeof((x)[0]))
 
 static int justprint = 0;
 
@@ -89,64 +92,13 @@ static char *fpexpected[][5] = {
     /*  69 */ { &quot;6.6667e+04&quot;, &quot;66666.6667&quot;, &quot;6.667e+04&quot;, &quot;6.6667E+04&quot;, &quot;6.667E+04&quot; },
 };
 
-static void dofptest(int test, double val, char *width, int prec, int *fail)
-{
-    char format[80], result[80];
-    int i;
-
-    for (i = 0; i &lt; 5; i++) {
-        char *fspec = NULL;
-        switch (i) {
-        case 0:
-            fspec = &quot;e&quot;;
-            break;
-        case 1:
-            fspec = &quot;f&quot;;
-            break;
-        case 2:
-            fspec = &quot;g&quot;;
-            break;
-        case 3:
-            fspec = &quot;E&quot;;
-            break;
-        case 4:
-            fspec = &quot;G&quot;;
-            break;
-        }
-
-        if (prec &gt;= 0)
-            BIO_snprintf(format, sizeof(format), &quot;%%%s.%d%s&quot;, width, prec,
-                         fspec);
-        else
-            BIO_snprintf(format, sizeof(format), &quot;%%%s%s&quot;, width, fspec);
-        BIO_snprintf(result, sizeof(result), format, val);
-
-        if (justprint) {
-            if (i == 0) {
-                printf(&quot;    /* %3d */ { \&quot;%s\&quot;&quot;, test, result);
-            } else {
-                printf(&quot;, \&quot;%s\&quot;&quot;, result);
-            }
-        } else {
-            if (strcmp(fpexpected[test][i], result) != 0) {
-                printf(&quot;Test %d(%d) failed. Expected \&quot;%s\&quot;. Got \&quot;%s\&quot;. &quot;
-                       &quot;Format \&quot;%s\&quot;\n&quot;, test, i, fpexpected[test][i], result,
-                       format);
-                *fail = 1;
-            }
-        }
-    }
-    if (justprint) {
-        printf(&quot; },\n&quot;);
-    }
-}
-
-struct z_data_st {
+typedef struct z_data_st {
     size_t value;
     const char *format;
     const char *expected;
-};
-static struct z_data_st zu_data[] = {
+} z_data;
+
+static z_data zu_data[] = {
     { SIZE_MAX, &quot;%zu&quot;, (sizeof(size_t) == 4 ? &quot;4294967295&quot;
                         : sizeof(size_t) == 8 ? &quot;18446744073709551615&quot;
                         : &quot;&quot;) },
@@ -161,24 +113,24 @@ static struct z_data_st zu_data[] = {
     { 0, &quot;%zi&quot;, &quot;0&quot; },
 };
 
-static void dozutest(int test, const struct z_data_st *data, int *fail)
+static int test_zu(int i)
 {
     char bio_buf[80];
+    const z_data *data = &amp;zu_data[i];
 
     BIO_snprintf(bio_buf, sizeof(bio_buf) - 1, data-&gt;format, data-&gt;value);
-    if (strcmp(bio_buf, data-&gt;expected) != 0) {
-        printf(&quot;Test %d failed.  Expected \&quot;%s\&quot;.  Got \&quot;%s\&quot;. &quot;
-               &quot;Format \&quot;%s\&quot;\n&quot;, test, data-&gt;expected, bio_buf, data-&gt;format);
-        *fail = 1;
-    }
+    if (!TEST_str_eq(bio_buf, data-&gt;expected))
+        return 0;
+    return 1;
 }
 
-struct j_data_st {
+typedef struct j_data_st {
     uint64_t value;
     const char *format;
     const char *expected;
-};
-static struct j_data_st j_data[] = {
+} j_data;
+
+static j_data jf_data[] = {
     { 0xffffffffffffffffU, &quot;%ju&quot;, &quot;18446744073709551615&quot; },
     { 0xffffffffffffffffU, &quot;%jx&quot;, &quot;ffffffffffffffff&quot; },
     { 0x8000000000000000U, &quot;%ju&quot;, &quot;9223372036854775808&quot; },
@@ -189,108 +141,109 @@ static struct j_data_st j_data[] = {
     { 0x8000000000000000U, &quot;%ji&quot;, &quot;-9223372036854775808&quot; },
 };
 
-static void dojtest(int test, const struct j_data_st *data, int *fail)
+static int test_j(int i)
 {
+    const j_data *data = &amp;jf_data[i];
     char bio_buf[80];
 
     BIO_snprintf(bio_buf, sizeof(bio_buf) - 1, data-&gt;format, data-&gt;value);
-    if (strcmp(bio_buf, data-&gt;expected) != 0) {
-        printf(&quot;Test %d failed.  Expected \&quot;%s\&quot;.  Got \&quot;%s\&quot;. &quot;
-               &quot;Format \&quot;%s\&quot;\n&quot;, test, data-&gt;expected, bio_buf, data-&gt;format);
-        *fail = 1;
-    }
+    if (!TEST_str_eq(bio_buf, data-&gt;expected))
+        return 0;
+    return 1;
 }
 
-int main(int argc, char **argv)
+
+/* Precision and width. */
+typedef struct pw_st {
+    int p;
+    const char *w;
+} pw;
+
+static pw pw_params[] = {
+    { 4, &quot;&quot; },
+    { 5, &quot;&quot; },
+    { 4, &quot;12&quot; },
+    { 5, &quot;12&quot; },
+    { 0, &quot;&quot; },
+    { -1, &quot;&quot; },
+    { 4, &quot;08&quot; }
+};
+
+static int dofptest(int test, double val, const char *width, int prec)
 {
-    int test = 0;
-    size_t i;
-    int fail = 0;
-    int prec = -1;
-    char *width = &quot;&quot;;
-    const double frac = 2.0/3.0;
-    char buf[80];
+    static const char *fspecs[] = {
+        &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;E&quot;, &quot;G&quot;
+    };
+    char format[80], result[80];
+    int ret = 1, i;
 
-    if (argc == 2 &amp;&amp; strcmp(argv[1], &quot;-expected&quot;) == 0) {
-        justprint = 1;
-    }
+    for (i = 0; i &lt; nelem(fspecs); i++) {
+        const char *fspec = fspecs[i];
 
-    CRYPTO_set_mem_debug(1);
-    CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_ON);
+        if (prec &gt;= 0)
+            BIO_snprintf(format, sizeof(format), &quot;%%%s.%d%s&quot;, width, prec,
+                         fspec);
+        else
+            BIO_snprintf(format, sizeof(format), &quot;%%%s%s&quot;, width, fspec);
+        BIO_snprintf(result, sizeof(result), format, val);
 
-    /* Tests for floating point format specifiers */
-    for (i = 0; i &lt; 7; i++) {
-        switch (i) {
-        case 0:
-            prec = 4;
-            width = &quot;&quot;;
-            break;
-        case 1:
-            prec = 5;
-            width = &quot;&quot;;
-            break;
-        case 2:
-            prec = 4;
-            width = &quot;12&quot;;
-            break;
-        case 3:
-            prec = 5;
-            width = &quot;12&quot;;
-            break;
-        case 4:
-            prec = 0;
-            width = &quot;&quot;;
-            break;
-        case 5:
-            prec = -1;
-            width = &quot;&quot;;
-            break;
-        case 6:
-            prec = 4;
-            width = &quot;08&quot;;
-            break;
+        if (justprint) {
+            if (i == 0)
+                printf(&quot;    /* %d */  { \&quot;%s\&quot;&quot;, test, result);
+            else
+                printf(&quot;, \&quot;%s\&quot;&quot;, result);
+        } else if (!TEST_str_eq(fpexpected[test][i], result)) {
+            TEST_info(&quot;test %d format=|%s| exp=|%s|, ret=|%s|&quot;,
+                    test, format, fpexpected[test][i], result);
+            ret = 0;
         }
-
-        dofptest(test++, 0.0, width, prec, &amp;fail);
-        dofptest(test++, 0.67, width, prec, &amp;fail);
-        dofptest(test++, frac, width, prec, &amp;fail);
-        dofptest(test++, frac / 1000, width, prec, &amp;fail);
-        dofptest(test++, frac / 10000, width, prec, &amp;fail);
-        dofptest(test++, 6.0 + frac, width, prec, &amp;fail);
-        dofptest(test++, 66.0 + frac, width, prec, &amp;fail);
-        dofptest(test++, 666.0 + frac, width, prec, &amp;fail);
-        dofptest(test++, 6666.0 + frac, width, prec, &amp;fail);
-        dofptest(test++, 66666.0 + frac, width, prec, &amp;fail);
     }
+    if (justprint)
+        printf(&quot; },\n&quot;);
+    return ret;
+}
 
-    /* Test excessively big number. Should fail */
-    if (BIO_snprintf(buf, sizeof(buf), &quot;%f\n&quot;, 2 * (double)ULONG_MAX) != -1) {
-        printf(&quot;Test %d failed. Unexpected success return from &quot;
-               &quot;BIO_snprintf()\n&quot;, test);
-        fail = 1;
-    }
+static int test_fp(int i)
+{
+    static int t = 0;
+    const double frac = 2.0 / 3.0;
+    const pw *pwp = &amp;pw_params[i];
+
+        if (!TEST_true(dofptest(t++, 0.0, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, 0.67, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, frac, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, frac / 1000, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, frac / 10000, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, 6.0 + frac, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, 66.0 + frac, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, 666.0 + frac, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, 6666.0 + frac, pwp-&gt;w, pwp-&gt;p))
+                || !TEST_true(dofptest(t++, 66666.0 + frac, pwp-&gt;w, pwp-&gt;p)))
+            return 0;
+    return 1;
+}
 
-    for (i = 0; i &lt; nelem(zu_data); i++) {
-        dozutest(test++, &amp;zu_data[i], &amp;fail);
-    }
+static int test_big(void)
+{
+    char buf[80];
 
-    for (i = 0; i &lt; nelem(j_data); i++) {
-        dojtest(test++, &amp;j_data[i], &amp;fail);
-    }
+    /* Test excessively big number. Should fail */
+    if (!TEST_int_eq(BIO_snprintf(buf, sizeof(buf),
+                                  &quot;%f\n&quot;, 2 * (double)ULONG_MAX), -1))
+        return 0;
+    return 1;
+}
 
-#ifndef OPENSSL_NO_CRYPTO_MDEBUG
-    if (CRYPTO_mem_leaks_fp(stderr) &lt;= 0)
-        return 1;
-# endif
 
-    if (!justprint) {
-        if (fail) {
-            printf(&quot;FAIL\n&quot;);
-            return 1;
-        }
-        printf (&quot;PASS\n&quot;);
-    }
-    return 0;
-}
+int test_main(int argc, char **argv)
+{
+    if (argc == 2 &amp;&amp; strcmp(argv[1], &quot;-expected&quot;) == 0)
+        justprint = 1;
 
+    ADD_TEST(test_big);
+    ADD_ALL_TESTS(test_fp, nelem(pw_params));
+    ADD_ALL_TESTS(test_zu, nelem(zu_data));
+    ADD_ALL_TESTS(test_j, nelem(jf_data));
 
+    return run_tests(argv[0]);
+}
diff --git a/test/build.info b/test/build.info
index 8346385..eb36596 100644
--- a/test/build.info
+++ b/test/build.info
@@ -111,7 +111,7 @@ IF[{- !$disabled{tests} -}]
   INCLUDE[mdc2test]=../include
   DEPEND[mdc2test]=../libcrypto
 
-  SOURCE[randtest]=randtest.c
+  SOURCE[randtest]=randtest.c testutil.c test_main.c
   INCLUDE[randtest]=../include
   DEPEND[randtest]=../libcrypto
 
@@ -175,7 +175,7 @@ IF[{- !$disabled{tests} -}]
   INCLUDE[danetest]=../include
   DEPEND[danetest]=../libcrypto ../libssl
 
-  SOURCE[constant_time_test]=constant_time_test.c
+  SOURCE[constant_time_test]=constant_time_test.c testutil.c test_main.c
   INCLUDE[constant_time_test]=.. ../include
   DEPEND[constant_time_test]=../libcrypto
 
@@ -264,8 +264,8 @@ IF[{- !$disabled{tests} -}]
   INCLUDE[asynciotest]=../include
   DEPEND[asynciotest]=../libcrypto ../libssl
 
-  SOURCE[bioprinttest]=bioprinttest.c
-  INCLUDE[bioprinttest]=../include
+  SOURCE[bioprinttest]=bioprinttest.c testutil.c test_main_custom.c
+  INCLUDE[bioprinttest]=../ ../include
   DEPEND[bioprinttest]=../libcrypto
 
   SOURCE[sslapitest]=sslapitest.c ssltestlib.c testutil.c test_main_custom.c
@@ -311,7 +311,7 @@ IF[{- !$disabled{tests} -}]
 
   IF[{- $disabled{shared} -}]
     PROGRAMS_NO_INST=cipher_overhead_test
-    SOURCE[cipher_overhead_test]=cipher_overhead_test.c
+    SOURCE[cipher_overhead_test]=cipher_overhead_test.c testutil.c test_main.c
     INCLUDE[cipher_overhead_test]=.. ../include
     DEPEND[cipher_overhead_test]=../libcrypto ../libssl
   ENDIF
diff --git a/test/cipher_overhead_test.c b/test/cipher_overhead_test.c
index 8c262b3..5ddd21c 100644
--- a/test/cipher_overhead_test.c
+++ b/test/cipher_overhead_test.c
@@ -7,13 +7,15 @@
  * <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
  */
 
-#include &lt;stdio.h&gt;
+#include &quot;e_os.h&quot;
+#include &quot;testutil.h&quot;
+#include &quot;test_main.h&quot;
 
 #include &quot;../ssl/ssl_locl.h&quot;
 
-int main(void)
+static int cipher_overhead(void)
 {
-    int i, n = ssl3_num_ciphers();
+    int ret = 1, i, n = ssl3_num_ciphers();
     const SSL_CIPHER *ciph;
     size_t mac, in, blk, ex;
 
@@ -21,13 +23,18 @@ int main(void)
         ciph = ssl3_get_cipher(i);
         if (!ciph-&gt;min_dtls)
             continue;
-        if (!ssl_cipher_get_overhead(ciph, &amp;mac, &amp;in, &amp;blk, &amp;ex)) {
-            printf(&quot;Error getting overhead for %s\n&quot;, ciph-&gt;name);
-            exit(1);
+        if (!TEST_true(ssl_cipher_get_overhead(ciph, &amp;mac, &amp;in, &amp;blk, &amp;ex))) {
+            TEST_info(&quot;Failed getting %s&quot;, ciph-&gt;name);
+            ret = 0;
         } else {
-            printf(&quot;Cipher %s: %&quot;OSSLzu&quot; %&quot;OSSLzu&quot; %&quot;OSSLzu&quot; %&quot;OSSLzu&quot;\n&quot;,
-                   ciph-&gt;name, mac, in, blk, ex);
+            TEST_info(&quot;Cipher %s: %&quot;OSSLzu&quot; %&quot;OSSLzu&quot; %&quot;OSSLzu&quot; %&quot;OSSLzu,
+                      ciph-&gt;name, mac, in, blk, ex);
         }
     }
-    exit(0);
+    return ret;
+}
+
+void register_tests(void)
+{
+    ADD_TEST(cipher_overhead);
 }
diff --git a/test/constant_time_test.c b/test/constant_time_test.c
index e53a73b..d34e386 100644
--- a/test/constant_time_test.c
+++ b/test/constant_time_test.c
@@ -7,12 +7,13 @@
  * <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
  */
 
-#include &quot;internal/constant_time_locl.h&quot;
-#include &quot;e_os.h&quot;
-
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 
+#include &quot;e_os.h&quot;
+#include &quot;internal/constant_time_locl.h&quot;
+#include &quot;testutil.h&quot;
+#include &quot;test_main.h&quot;
 #include &quot;internal/numbers.h&quot;
 
 static const unsigned int CONSTTIME_TRUE = (unsigned)(~0);
@@ -26,17 +27,11 @@ static int test_binary_op(unsigned int (*op) (unsigned int a, unsigned int b),
                           const char *op_name, unsigned int a, unsigned int b,
                           int is_true)
 {
-    unsigned c = op(a, b);
-    if (is_true &amp;&amp; c != CONSTTIME_TRUE) {
-        fprintf(stderr, &quot;Test failed for %s(%du, %du): expected %du &quot;
-                &quot;(TRUE), got %du\n&quot;, op_name, a, b, CONSTTIME_TRUE, c);
-        return 1;
-    } else if (!is_true &amp;&amp; c != CONSTTIME_FALSE) {
-        fprintf(stderr, &quot;Test failed for  %s(%du, %du): expected %du &quot;
-                &quot;(FALSE), got %du\n&quot;, op_name, a, b, CONSTTIME_FALSE, c);
-        return 1;
-    }
-    return 0;
+    if (is_true &amp;&amp; !TEST_uint_eq(op(a, b), CONSTTIME_TRUE))
+        return 0;
+    if (!is_true &amp;&amp; !TEST_uint_eq(op(a, b), CONSTTIME_FALSE))
+        return 0;
+    return 1;
 }
 
 static int test_binary_op_8(unsigned
@@ -44,210 +39,112 @@ static int test_binary_op_8(unsigned
                             const char *op_name, unsigned int a,
                             unsigned int b, int is_true)
 {
-    unsigned char c = op(a, b);
-    if (is_true &amp;&amp; c != CONSTTIME_TRUE_8) {
-        fprintf(stderr, &quot;Test failed for %s(%du, %du): expected %u &quot;
-                &quot;(TRUE), got %u\n&quot;, op_name, a, b, CONSTTIME_TRUE_8, c);
-        return 1;
-    } else if (!is_true &amp;&amp; c != CONSTTIME_FALSE_8) {
-        fprintf(stderr, &quot;Test failed for  %s(%du, %du): expected %u &quot;
-                &quot;(FALSE), got %u\n&quot;, op_name, a, b, CONSTTIME_FALSE_8, c);
-        return 1;
-    }
-    return 0;
+    if (is_true &amp;&amp; !TEST_uint_eq(op(a, b), CONSTTIME_TRUE_8))
+        return 0;
+    if (!is_true &amp;&amp; !TEST_uint_eq(op(a, b), CONSTTIME_FALSE_8))
+        return 0;
+    return 1;
 }
 
 static int test_binary_op_s(size_t (*op) (size_t a, size_t b),
                             const char *op_name, size_t a, size_t b,
                             int is_true)
 {
-    size_t c = op(a, b);
-    if (is_true &amp;&amp; c != CONSTTIME_TRUE_S) {
-        fprintf(stderr, &quot;Test failed for %s(%&quot;OSSLzu&quot;, %&quot;OSSLzu
-        &quot;): expected %&quot;OSSLzu&quot; (TRUE), got %&quot;OSSLzu&quot;\n&quot;,
-        op_name, a, b, CONSTTIME_TRUE_S, c);
-        return 1;
-    } else if (!is_true &amp;&amp; c != CONSTTIME_FALSE_S) {
-        fprintf(stderr, &quot;Test failed for  %s(%&quot;OSSLzu&quot;, %&quot;OSSLzu
-        &quot;): expected %&quot; OSSLzu &quot; (FALSE), got %&quot;OSSLzu&quot;\n&quot;,
-        op_name, a, b, CONSTTIME_FALSE_S, c);
-        return 1;
-    }
-    return 0;
+    if (is_true &amp;&amp; !TEST_size_t_eq(op(a,b), CONSTTIME_TRUE_S))
+        return 0;
+    if (!is_true &amp;&amp; !TEST_uint_eq(op(a,b), CONSTTIME_FALSE_S))
+        return 0;
+    return 1;
 }
 
 static int test_is_zero(unsigned int a)
 {
-    unsigned int c = constant_time_is_zero(a);
-    if (a == 0 &amp;&amp; c != CONSTTIME_TRUE) {
-        fprintf(stderr, &quot;Test failed for constant_time_is_zero(%du): &quot;
-                &quot;expected %du (TRUE), got %du\n&quot;, a, CONSTTIME_TRUE, c);
-        return 1;
-    } else if (a != 0 &amp;&amp; c != CONSTTIME_FALSE) {
-        fprintf(stderr, &quot;Test failed for constant_time_is_zero(%du): &quot;
-                &quot;expected %du (FALSE), got %du\n&quot;, a, CONSTTIME_FALSE, c);
-        return 1;
-    }
-    return 0;
+    if (a == 0 &amp;&amp; !TEST_uint_eq(constant_time_is_zero(a), CONSTTIME_TRUE))
+        return 0;
+    if (a != 0 &amp;&amp; !TEST_uint_eq(constant_time_is_zero(a), CONSTTIME_FALSE))
+        return 0;
+    return 1;
 }
 
 static int test_is_zero_8(unsigned int a)
 {
-    unsigned char c = constant_time_is_zero_8(a);
-    if (a == 0 &amp;&amp; c != CONSTTIME_TRUE_8) {
-        fprintf(stderr, &quot;Test failed for constant_time_is_zero(%du): &quot;
-                &quot;expected %u (TRUE), got %u\n&quot;, a, CONSTTIME_TRUE_8, c);
-        return 1;
-    } else if (a != 0 &amp;&amp; c != CONSTTIME_FALSE) {
-        fprintf(stderr, &quot;Test failed for constant_time_is_zero(%du): &quot;
-                &quot;expected %u (FALSE), got %u\n&quot;, a, CONSTTIME_FALSE_8, c);
-        return 1;
-    }
-    return 0;
+    if (a == 0 &amp;&amp; !TEST_uint_eq(constant_time_is_zero_8(a), CONSTTIME_TRUE_8))
+        return 0;
+    if (a != 0 &amp;&amp; !TEST_uint_eq(constant_time_is_zero_8(a), CONSTTIME_FALSE_8))
+        return 0;
+    return 1;
 }
 
-static int test_is_zero_s(size_t a)
+static int test_is_zero_s(unsigned int a)
 {
-    size_t c = constant_time_is_zero_s(a);
-    if (a == 0 &amp;&amp; c != CONSTTIME_TRUE_S) {
-        fprintf(stderr, &quot;Test failed for constant_time_is_zero_s(%&quot;OSSLzu&quot;): &quot;
-                &quot;expected %&quot;OSSLzu&quot; (TRUE), got %&quot;OSSLzu&quot;\n&quot;,
-                a, CONSTTIME_TRUE_S, c);
-        return 1;
-    } else if (a != 0 &amp;&amp; c != CONSTTIME_FALSE) {
-        fprintf(stderr, &quot;Test failed for constant_time_is_zero_s(%&quot;OSSLzu&quot;): &quot;
-                &quot;expected %&quot;OSSLzu&quot; (FALSE), got %&quot;OSSLzu&quot;\n&quot;,
-                a, CONSTTIME_FALSE_S, c);
-        return 1;
-    }
-    return 0;
+    if (a == 0 &amp;&amp; !TEST_size_t_eq(constant_time_is_zero_s(a), CONSTTIME_TRUE_S))
+        return 0;
+    if (a != 0 &amp;&amp; !TEST_uint_eq(constant_time_is_zero_s(a), CONSTTIME_FALSE_S))
+        return 0;
+    return 1;
 }
+
 static int test_select(unsigned int a, unsigned int b)
 {
-    unsigned int selected = constant_time_select(CONSTTIME_TRUE, a, b);
-    if (selected != a) {
-        fprintf(stderr, &quot;Test failed for constant_time_select(%du, %du,&quot;
-                &quot;%du): expected %du(first value), got %du\n&quot;,
-                CONSTTIME_TRUE, a, b, a, selected);
-        return 1;
-    }
-    selected = constant_time_select(CONSTTIME_FALSE, a, b);
-    if (selected != b) {
-        fprintf(stderr, &quot;Test failed for constant_time_select(%du, %du,&quot;
-                &quot;%du): expected %du(second value), got %du\n&quot;,
-                CONSTTIME_FALSE, a, b, b, selected);
-        return 1;
-    }
-    return 0;
+    if (!TEST_uint_eq(constant_time_select(CONSTTIME_TRUE, a, b), a))
+        return 0;
+    if (!TEST_uint_eq(constant_time_select(CONSTTIME_FALSE, a, b), b))
+        return 0;
+    return 1;
 }
 
 static int test_select_8(unsigned char a, unsigned char b)
 {
-    unsigned char selected = constant_time_select_8(CONSTTIME_TRUE_8, a, b);
-    if (selected != a) {
-        fprintf(stderr, &quot;Test failed for constant_time_select(%u, %u,&quot;
-                &quot;%u): expected %u(first value), got %u\n&quot;,
-                CONSTTIME_TRUE, a, b, a, selected);
-        return 1;
-    }
-    selected = constant_time_select_8(CONSTTIME_FALSE_8, a, b);
-    if (selected != b) {
-        fprintf(stderr, &quot;Test failed for constant_time_select(%u, %u,&quot;
-                &quot;%u): expected %u(second value), got %u\n&quot;,
-                CONSTTIME_FALSE, a, b, b, selected);
-        return 1;
-    }
-    return 0;
+    if (!TEST_uint_eq(constant_time_select_8(CONSTTIME_TRUE_8, a, b), a))
+        return 0;
+    if (!TEST_uint_eq(constant_time_select_8(CONSTTIME_FALSE_8, a, b), b))
+        return 0;
+    return 1;
 }
 
-static int test_select_int(int a, int b)
+static int test_select_s(unsigned char a, unsigned char b)
 {
-    int selected = constant_time_select_int(CONSTTIME_TRUE, a, b);
-    if (selected != a) {
-        fprintf(stderr, &quot;Test failed for constant_time_select(%du, %d,&quot;
-                &quot;%d): expected %d(first value), got %d\n&quot;,
-                CONSTTIME_TRUE, a, b, a, selected);
-        return 1;
-    }
-    selected = constant_time_select_int(CONSTTIME_FALSE, a, b);
-    if (selected != b) {
-        fprintf(stderr, &quot;Test failed for constant_time_select(%du, %d,&quot;
-                &quot;%d): expected %d(second value), got %d\n&quot;,
-                CONSTTIME_FALSE, a, b, b, selected);
-        return 1;
-    }
-    return 0;
+    if (!TEST_uint_eq(constant_time_select_s(CONSTTIME_TRUE_S, a, b), a))
+        return 0;
+    if (!TEST_uint_eq(constant_time_select_s(CONSTTIME_FALSE_S, a, b), b))
+        return 0;
+    return 1;
 }
 
-
-static int test_select_s(size_t a, size_t b)
+static int test_select_int(int a, int b)
 {
-    size_t selected = constant_time_select_s(CONSTTIME_TRUE_S, a, b);
-    if (selected != a) {
-        fprintf(stderr, &quot;Test failed for constant_time_select_s(%&quot;OSSLzu
-                &quot;, %&quot;OSSLzu&quot;,%&quot;OSSLzu&quot;): expected %&quot;OSSLzu
-                &quot;(first value), got %&quot;OSSLzu&quot;\n&quot;,
-                CONSTTIME_TRUE_S, a, b, a, selected);
-        return 1;
-    }
-    selected = constant_time_select_s(CONSTTIME_FALSE_S, a, b);
-    if (selected != b) {
-        fprintf(stderr, &quot;Test failed for constant_time_select_s(%&quot;OSSLzu
-                &quot;, %&quot;OSSLzu&quot;,%&quot;OSSLzu&quot;): expected %&quot;OSSLzu
-                &quot;(second value), got %&quot;OSSLzu&quot;\n&quot;,
-                CONSTTIME_FALSE_S, a, b, b, selected);
-        return 1;
-    }
-    return 0;
+    if (!TEST_int_eq(constant_time_select_int(CONSTTIME_TRUE, a, b), a))
+        return 0;
+    if (!TEST_int_eq(constant_time_select_int(CONSTTIME_FALSE, a, b), b))
+        return 0;
+    return 1;
 }
 
-static int test_eq_int(int a, int b)
+static int test_eq_int_8(int a, int b)
 {
-    unsigned int equal = constant_time_eq_int(a, b);
-    if (a == b &amp;&amp; equal != CONSTTIME_TRUE) {
-        fprintf(stderr, &quot;Test failed for constant_time_eq_int(%d, %d): &quot;
-                &quot;expected %du(TRUE), got %du\n&quot;, a, b, CONSTTIME_TRUE, equal);
-        return 1;
-    } else if (a != b &amp;&amp; equal != CONSTTIME_FALSE) {
-        fprintf(stderr, &quot;Test failed for constant_time_eq_int(%d, %d): &quot;
-                &quot;expected %du(FALSE), got %du\n&quot;,
-                a, b, CONSTTIME_FALSE, equal);
-        return 1;
-    }
-    return 0;
+    if (a == b &amp;&amp; !TEST_int_eq(constant_time_eq_int_8(a, b), CONSTTIME_TRUE_8))
+        return 0;
+    if (a != b &amp;&amp; !TEST_int_eq(constant_time_eq_int_8(a, b), CONSTTIME_FALSE_8))
+        return 0;
+    return 1;
 }
 
-static int test_eq_int_8(int a, int b)
+static int test_eq_s(size_t a, size_t b)
 {
-    unsigned char equal = constant_time_eq_int_8(a, b);
-    if (a == b &amp;&amp; equal != CONSTTIME_TRUE_8) {
-        fprintf(stderr, &quot;Test failed for constant_time_eq_int_8(%d, %d): &quot;
-                &quot;expected %u(TRUE), got %u\n&quot;, a, b, CONSTTIME_TRUE_8, equal);
-        return 1;
-    } else if (a != b &amp;&amp; equal != CONSTTIME_FALSE_8) {
-        fprintf(stderr, &quot;Test failed for constant_time_eq_int_8(%d, %d): &quot;
-                &quot;expected %u(FALSE), got %u\n&quot;,
-                a, b, CONSTTIME_FALSE_8, equal);
-        return 1;
-    }
-    return 0;
+    if (a == b &amp;&amp; !TEST_size_t_eq(constant_time_eq_s(a, b), CONSTTIME_TRUE_S))
+        return 0;
+    if (a != b &amp;&amp; !TEST_int_eq(constant_time_eq_s(a, b), CONSTTIME_FALSE_S))
+        return 0;
+    return 1;
 }
 
-static int test_eq_s(size_t a, size_t b)
+static int test_eq_int(int a, int b)
 {
-    size_t equal = constant_time_eq_s(a, b);
-    if (a == b &amp;&amp; equal != CONSTTIME_TRUE_S) {
-        fprintf(stderr, &quot;Test failed for constant_time_eq_int(%&quot;OSSLzu
-                &quot;, %&quot;OSSLzu&quot;): expected %&quot;OSSLzu&quot;(TRUE), got %&quot;OSSLzu&quot;\n&quot;,
-                a, b, CONSTTIME_TRUE_S, equal);
-        return 1;
-    } else if (a != b &amp;&amp; equal != CONSTTIME_FALSE_S) {
-        fprintf(stderr, &quot;Test failed for constant_time_eq_int(%&quot;OSSLzu&quot;, %&quot;
-                OSSLzu&quot;): expected %&quot;OSSLzu&quot;(FALSE), got %&quot;OSSLzu&quot;\n&quot;,
-                a, b, CONSTTIME_FALSE_S, equal);
-        return 1;
-    }
-    return 0;
+    if (a == b &amp;&amp; !TEST_uint_eq(constant_time_eq_int(a, b), CONSTTIME_TRUE))
+        return 0;
+    if (a != b &amp;&amp; !TEST_uint_eq(constant_time_eq_int(a, b), CONSTTIME_FALSE))
+        return 0;
+    return 1;
 }
 
 static unsigned int test_values[] =
@@ -270,108 +167,109 @@ static size_t test_values_s[] =
     SIZE_MAX
 };
 
-int main(int argc, char *argv[])
+static int test_sizeofs(void)
 {
-    unsigned int a, b, i, j;
-    int c, d;
-    unsigned char e, f;
-    size_t g, h;
-    int num_failed = 0, num_all = 0;
-    fprintf(stdout, &quot;Testing constant time operations...\n&quot;);
-
-    if (OSSL_NELEM(test_values) != OSSL_NELEM(test_values_s)) {
-        fprintf(stdout, &quot;Unexpected number of tests\n&quot;);
-        return EXIT_FAILURE;
-    }
+    if (!TEST_uint_eq(OSSL_NELEM(test_values), OSSL_NELEM(test_values_s)))
+        return 0;
+    return 1;
+}
 
-    for (i = 0; i &lt; OSSL_NELEM(test_values); ++i) {
-        a = test_values[i];
-        g = test_values_s[i];
-        num_failed += test_is_zero(a);
-        num_failed += test_is_zero_8(a);
-        num_failed += test_is_zero_s(g);
-        num_all += 3;
-        for (j = 0; j &lt; OSSL_NELEM(test_values); ++j) {
-            b = test_values[j];
-            h = test_values[j];
-            num_failed += test_binary_op(&amp;constant_time_lt,
-                                         &quot;constant_time_lt&quot;, a, b, a &lt; b);
-            num_failed += test_binary_op_8(&amp;constant_time_lt_8,
-                                           &quot;constant_time_lt_8&quot;, a, b, a &lt; b);
-            num_failed += test_binary_op_s(&amp;constant_time_lt_s,
-                                           &quot;constant_time_lt_s&quot;, g, h, g &lt; h);
-            num_failed += test_binary_op(&amp;constant_time_lt,
-                                         &quot;constant_time_lt&quot;, b, a, b &lt; a);
-            num_failed += test_binary_op_8(&amp;constant_time_lt_8,
-                                           &quot;constant_time_lt_8&quot;, b, a, b &lt; a);
-            num_failed += test_binary_op_s(&amp;constant_time_lt_s,
-                                           &quot;constant_time_lt_s&quot;, h, g, h &lt; g);
-            num_failed += test_binary_op(&amp;constant_time_ge,
-                                         &quot;constant_time_ge&quot;, a, b, a &gt;= b);
-            num_failed += test_binary_op_8(&amp;constant_time_ge_8,
-                                           &quot;constant_time_ge_8&quot;, a, b,
-                                           a &gt;= b);
-            num_failed += test_binary_op_s(&amp;constant_time_ge_s,
-                                           &quot;constant_time_ge_s&quot;, g, h, g &gt;= h);
-            num_failed +=
-                test_binary_op(&amp;constant_time_ge, &quot;constant_time_ge&quot;, b, a,
-                               b &gt;= a);
-            num_failed +=
-                test_binary_op_8(&amp;constant_time_ge_8, &quot;constant_time_ge_8&quot;, b,
-                                 a, b &gt;= a);
-            num_failed +=
-                test_binary_op_s(&amp;constant_time_ge_s, &quot;constant_time_ge_s&quot;, h, g,
-                                 h &gt;= g);
-            num_failed +=
-                test_binary_op(&amp;constant_time_eq, &quot;constant_time_eq&quot;, a, b,
-                               a == b);
-            num_failed +=
-                test_binary_op_8(&amp;constant_time_eq_8, &quot;constant_time_eq_8&quot;, a,
-                                 b, a == b);
-            num_failed +=
-                test_binary_op_s(&amp;constant_time_eq_s, &quot;constant_time_eq_s&quot;, g, h,
-                                 g == h);
-            num_failed +=
-                test_binary_op(&amp;constant_time_eq, &quot;constant_time_eq&quot;, b, a,
-                               b == a);
-            num_failed +=
-                test_binary_op_8(&amp;constant_time_eq_8, &quot;constant_time_eq_8&quot;, b,
-                                 a, b == a);
-            num_failed +=
-                test_binary_op_s(&amp;constant_time_eq_s, &quot;constant_time_eq_s&quot;, h, g,
-                                 h == g);
-            num_failed += test_select(a, b);
-            num_failed += test_select_s(g, h);
-            num_failed += test_eq_s(g, h);
-            num_all += 21;
-        }
-    }
+static int test_binops(int i)
+{
+    unsigned int a = test_values[i];
+    unsigned int g = test_values_s[i];
+    int j;
+    int ret = 1;
+
+    if (!test_is_zero(a) || !test_is_zero_8(a) || !test_is_zero_s(g))
+        ret = 0;
+
+    for (j = 0; j &lt; (int)OSSL_NELEM(test_values); ++j) {
+        unsigned int b = test_values[j];
+        unsigned int h = test_values[j];
 
-    for (i = 0; i &lt; OSSL_NELEM(signed_test_values); ++i) {
-        c = signed_test_values[i];
-        for (j = 0; j &lt; OSSL_NELEM(signed_test_values); ++j) {
-            d = signed_test_values[j];
-            num_failed += test_select_int(c, d);
-            num_failed += test_eq_int(c, d);
-            num_failed += test_eq_int_8(c, d);
-            num_all += 3;
+        if (!test_select(a, b)
+                || !test_select_s(g, h)
+                || !test_eq_s(g, h)
+                || !test_binary_op(&amp;constant_time_lt, &quot;ct_lt&quot;,
+                                   a, b, a &lt; b)
+                || !test_binary_op_8(&amp;constant_time_lt_8, &quot;constant_time_lt_8&quot;,
+                                     a, b, a &lt; b)
+                || !test_binary_op_s(&amp;constant_time_lt_s, &quot;constant_time_lt_s&quot;,
+                                     g, h, g &lt; h)
+                || !test_binary_op(&amp;constant_time_lt, &quot;constant_time_lt&quot;,
+                                   b, a, b &lt; a)
+                || !test_binary_op_8(&amp;constant_time_lt_8, &quot;constant_time_lt_8&quot;,
+                                     b, a, b &lt; a)
+                || !test_binary_op_s(&amp;constant_time_lt_s, &quot;constant_time_lt_s&quot;,
+                                     h, g, h &lt; g)
+                || !test_binary_op(&amp;constant_time_ge, &quot;constant_time_ge&quot;,
+                                   a, b, a &gt;= b)
+                || !test_binary_op_8(&amp;constant_time_ge_8, &quot;constant_time_ge_8&quot;,
+                                     a, b, a &gt;= b)
+                || !test_binary_op_s(&amp;constant_time_ge_s, &quot;constant_time_ge_s&quot;,
+                                     g, h, g &gt;= h)
+                || !test_binary_op(&amp;constant_time_ge, &quot;constant_time_ge&quot;,
+                                   b, a, b &gt;= a)
+                || !test_binary_op_8(&amp;constant_time_ge_8, &quot;constant_time_ge_8&quot;,
+                                     b, a, b &gt;= a)
+                || !test_binary_op_s(&amp;constant_time_ge_s, &quot;constant_time_ge_s&quot;,
+                                     h, g, h &gt;= g)
+                || !test_binary_op(&amp;constant_time_eq, &quot;constant_time_eq&quot;,
+                                   a, b, a == b)
+                || !test_binary_op_8(&amp;constant_time_eq_8, &quot;constant_time_eq_8&quot;,
+                                     a, b, a == b)
+                || !test_binary_op_s(&amp;constant_time_eq_s, &quot;constant_time_eq_s&quot;,
+                                     g, h, g == h)
+                || !test_binary_op(&amp;constant_time_eq, &quot;constant_time_eq&quot;,
+                                   b, a, b == a)
+                || !test_binary_op_8(&amp;constant_time_eq_8, &quot;constant_time_eq_8&quot;,
+                                     b, a, b == a)
+                || !test_binary_op_s(&amp;constant_time_eq_s, &quot;constant_time_eq_s&quot;,
+                                     h, g, h == g)) {
+            ret = 0;
         }
     }
+    return ret;
+}
 
-    for (i = 0; i &lt; sizeof(test_values_8); ++i) {
-        e = test_values_8[i];
-        for (j = 0; j &lt; sizeof(test_values_8); ++j) {
-            f = test_values_8[j];
-            num_failed += test_select_8(e, f);
-            num_all += 1;
-        }
+static int test_signed(int i)
+{
+    int c = signed_test_values[i];
+    unsigned int j;
+    int ret = 1;
+
+    for (j = 0; j &lt; OSSL_NELEM(signed_test_values); ++j) {
+        int d = signed_test_values[j];
+
+        if (!test_select_int(c, d)
+                || !test_eq_int(c, d)
+                || !test_eq_int_8(c, d))
+            ret = 0;
     }
+    return ret;
+}
 
-    if (!num_failed) {
-        fprintf(stdout, &quot;success (ran %d tests)\n&quot;, num_all);
-        return EXIT_SUCCESS;
-    } else {
-        fprintf(stdout, &quot;%d of %d tests failed!\n&quot;, num_failed, num_all);
-        return EXIT_FAILURE;
+static int test_8values(int i)
+{
+    unsigned char e = test_values_8[i];
+    unsigned int j;
+    int ret = 1;
+
+    for (j = 0; j &lt; sizeof(test_values_8); ++j) {
+        unsigned char f = test_values_8[j];
+
+        if (!test_select_8(e, f))
+            ret = 0;
     }
+    return ret;
+}
+
+
+void register_tests(void)
+{
+    ADD_TEST(test_sizeofs);
+    ADD_ALL_TESTS(test_binops, OSSL_NELEM(test_values));
+    ADD_ALL_TESTS(test_signed, OSSL_NELEM(signed_test_values));
+    ADD_ALL_TESTS(test_8values, sizeof(test_values_8));
 }
diff --git a/test/randtest.c b/test/randtest.c
index 9f7a037..e1d84c3 100644
--- a/test/randtest.c
+++ b/test/randtest.c
@@ -7,33 +7,24 @@
  * <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
  */
 
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
 #include &lt;openssl/rand.h&gt;
-
-#include &quot;../e_os.h&quot;
+#include &quot;testutil.h&quot;
+#include &quot;test_main.h&quot;
 
 /* some FIPS 140-1 random number test */
 /* some simple tests */
 
-int main(int argc, char **argv)
+static int fips_random_tests(void)
 {
     unsigned char buf[2500];
-    int i, j, k, s, sign, nsign, err = 0;
+    int i, j, k, s, sign, nsign, ret = 1;
     unsigned long n1;
     unsigned long n2[16];
     unsigned long runs[2][34];
-    /*
-     * double d;
-     */
     long d;
 
-    i = RAND_bytes(buf, 2500);
-    if (i &lt;= 0) {
-        printf(&quot;init failed, the rand method is not properly installed\n&quot;);
-        err++;
-        goto err;
-    }
+    if (!TEST_int_ge(RAND_bytes(buf, sizeof(buf)), 0))
+        return 0;
 
     n1 = 0;
     for (i = 0; i &lt; 16; i++)
@@ -77,69 +68,43 @@ int main(int argc, char **argv)
         runs[sign][nsign - 1]++;
 
     /* test 1 */
-    if (!((9654 &lt; n1) &amp;&amp; (n1 &lt; 10346))) {
-        printf(&quot;test 1 failed, X=%lu\n&quot;, n1);
-        err++;
+    if (!TEST_true(9654 &lt; n1 &amp;&amp; n1 &lt; 10346)) {
+        TEST_info(&quot;test 1 failed, X=%lu&quot;, n1);
+        ret = 0;
     }
-    printf(&quot;test 1 done\n&quot;);
 
     /* test 2 */
     d = 0;
     for (i = 0; i &lt; 16; i++)
         d += n2[i] * n2[i];
     d = (d * 8) / 25 - 500000;
-    if (!((103 &lt; d) &amp;&amp; (d &lt; 5740))) {
-        printf(&quot;test 2 failed, X=%ld.%02ld\n&quot;, d / 100L, d % 100L);
-        err++;
+    if (!TEST_true(103 &lt; d &amp;&amp; d &lt; 5740)) {
+        TEST_info(&quot;test 2 failed, X=%ld.%02ld&quot;, d / 100L, d % 100L);
+        ret = 0;
     }
-    printf(&quot;test 2 done\n&quot;);
 
     /* test 3 */
     for (i = 0; i &lt; 2; i++) {
-        if (!((2267 &lt; runs[i][0]) &amp;&amp; (runs[i][0] &lt; 2733))) {
-            printf(&quot;test 3 failed, bit=%d run=%d num=%lu\n&quot;,
-                   i, 1, runs[i][0]);
-            err++;
-        }
-        if (!((1079 &lt; runs[i][1]) &amp;&amp; (runs[i][1] &lt; 1421))) {
-            printf(&quot;test 3 failed, bit=%d run=%d num=%lu\n&quot;,
-                   i, 2, runs[i][1]);
-            err++;
-        }
-        if (!((502 &lt; runs[i][2]) &amp;&amp; (runs[i][2] &lt; 748))) {
-            printf(&quot;test 3 failed, bit=%d run=%d num=%lu\n&quot;,
-                   i, 3, runs[i][2]);
-            err++;
-        }
-        if (!((223 &lt; runs[i][3]) &amp;&amp; (runs[i][3] &lt; 402))) {
-            printf(&quot;test 3 failed, bit=%d run=%d num=%lu\n&quot;,
-                   i, 4, runs[i][3]);
-            err++;
-        }
-        if (!((90 &lt; runs[i][4]) &amp;&amp; (runs[i][4] &lt; 223))) {
-            printf(&quot;test 3 failed, bit=%d run=%d num=%lu\n&quot;,
-                   i, 5, runs[i][4]);
-            err++;
-        }
-        if (!((90 &lt; runs[i][5]) &amp;&amp; (runs[i][5] &lt; 223))) {
-            printf(&quot;test 3 failed, bit=%d run=%d num=%lu\n&quot;,
-                   i, 6, runs[i][5]);
-            err++;
+        if (!TEST_true(2267 &lt; runs[i][0] &amp;&amp; runs[i][0] &lt; 2733)
+                || !TEST_true(1079 &lt; runs[i][1] &amp;&amp; runs[i][1] &lt; 1421)
+                || !TEST_true(502 &lt; runs[i][2] &amp;&amp; runs[i][2] &lt; 748)
+                || !TEST_true(223 &lt; runs[i][3] &amp;&amp; runs[i][3] &lt; 402)
+                || !TEST_true(90 &lt; runs[i][4] &amp;&amp; runs[i][4] &lt; 223)
+                || !TEST_true(90 &lt; runs[i][5] &amp;&amp; runs[i][5] &lt; 223)) {
+            TEST_info(&quot;During run %d&quot;, i);
+            ret = 0;
         }
     }
-    printf(&quot;test 3 done\n&quot;);
 
     /* test 4 */
-    if (runs[0][33] != 0) {
-        printf(&quot;test 4 failed, bit=%d run=%d num=%lu\n&quot;, 0, 34, runs[0][33]);
-        err++;
-    }
-    if (runs[1][33] != 0) {
-        printf(&quot;test 4 failed, bit=%d run=%d num=%lu\n&quot;, 1, 34, runs[1][33]);
-        err++;
-    }
-    printf(&quot;test 4 done\n&quot;);
- err:
-    err = ((err) ? 1 : 0);
-    EXIT(err);
+    if (!TEST_int_eq(runs[0][33], 0)
+            || !TEST_int_eq(runs[1][33], 0))
+        ret = 0;
+
+    return ret;
+}
+
+void register_tests(void)
+{
+    ADD_TEST(fips_random_tests);
 }
diff --git a/test/recipes/90-test_bioprint.t b/test/recipes/04-test_bioprint.t
similarity index 100%
rename from test/recipes/90-test_bioprint.t
rename to test/recipes/04-test_bioprint.t
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014197.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="014201.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14198">[ date ]</a>
              <a href="thread.html#14198">[ thread ]</a>
              <a href="subject.html#14198">[ subject ]</a>
              <a href="author.html#14198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
