<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C20150130134622.A8EC81DF118%40butler.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000355.html">
   <LINK REL="Next"  HREF="000360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C20150130134622.A8EC81DF118%40butler.localdomain%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Fri Jan 30 13:46:22 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000355.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="000360.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#358">[ date ]</a>
              <a href="thread.html#358">[ thread ]</a>
              <a href="subject.html#358">[ subject ]</a>
              <a href="author.html#358">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  4fdde1aa0c2146342a279dc11757e4e566248d6b (commit)
       via  e00ab250c878f7a7f0ae908a6305cebf6883a244 (commit)
       via  09ebad72dffe74933a5d5976bfb191d9dd041a89 (commit)
       via  36ed7adfbc2230dbc5db926c3e667a1ff491e8c1 (commit)
       via  36759bb75152cece52bcf3b514e4336036deb6d3 (commit)
       via  132536f96e1baba466baa7323c0d74bd7948dd5b (commit)
       via  c168a027cfe1459e946dade4179938f34894fe1d (commit)
      from  be7b1097e28ff6d49f0d4b7ab8b036d6da87ebc6 (commit)


- Log -----------------------------------------------------------------
commit 4fdde1aa0c2146342a279dc11757e4e566248d6b
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jan 30 14:30:25 2015 +0100

    Update on the use of logical names for OpenSSL configuration
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

commit e00ab250c878f7a7f0ae908a6305cebf6883a244
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jan 30 12:36:13 2015 +0100

    VMS exit codes weren't handled well enough and were unclear
    
    Making a specific variable $failure_code and a bit of commenting in the
    VMS section should help clear things up.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

commit 09ebad72dffe74933a5d5976bfb191d9dd041a89
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Jan 29 14:36:27 2015 +0100

    VMS adjustments:
    
    Add missing crypto modules and files to copy to crypto/install-crypto.com
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

commit 36ed7adfbc2230dbc5db926c3e667a1ff491e8c1
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Jan 29 14:35:46 2015 +0100

    VMS adjustments:
    
    test/cms-test.pl adjusted to handle NL: instead of /dev/null on VMS
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

commit 36759bb75152cece52bcf3b514e4336036deb6d3
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Jan 29 14:27:21 2015 +0100

    VMS build changes
    
    crypto/crypto-lib.com:
     Remove all APPS building, as they are gone.
     Depend on the variable SDIRS that's defined by makevms.com.
     Remake the whole partial module list mechanism to check for variables with a counter.
     Define the logical name INTERNAL to allow for '#include &quot;internal/foo.h&quot;'.
    
    makevms.com:
     Define SDIRS, to allow for removal of crypto modules and pass that information to crypto/crypto-lib.com.
     Allow for experimental modules.
     Update the allowed things to disable.
     Update the things disabled by default to match Configure.
     Update headers to be copied.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

commit 132536f96e1baba466baa7323c0d74bd7948dd5b
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Jan 29 13:13:28 2015 +0100

    VMS adjustments:
    
    catch up with the Unix build.
    A number of new tests, among others test/tocsp.com
    Define INTERNAL in ssl/ssl-lib.com to allow for '#include &quot;internal/foo.h&quot;'
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

commit c168a027cfe1459e946dade4179938f34894fe1d
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Jan 29 13:07:53 2015 +0100

    VMS adjustments:
    
    Add new symbols that are longer than 31 chars to symhacks.
    VMS doesn't have &lt;sys/un.h&gt;, reflect that in e_os.h.
    MS_CALLBACK has been removed, ssl_task.c needs adjustment.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 INSTALL.VMS               |   26 ++--
 crypto/crypto-lib.com     |  287 ++++++++++++++++-----------------------------
 crypto/install-crypto.com |   10 +-
 crypto/symhacks.h         |   24 ++++
 e_os.h                    |    1 +
 engines/makeengines.com   |   24 ++--
 makevms.com               |  162 ++++++++++++++++++-------
 ssl/ssl-lib.com           |   17 ++-
 ssl/ssl_task.c            |    4 +-
 test/cms-test.pl          |   25 +++-
 test/maketests.com        |   86 ++++++++------
 test/tests.com            |  103 ++++++++++------
 test/tocsp.com            |  165 ++++++++++++++++++++++++++
 13 files changed, 586 insertions(+), 348 deletions(-)
 create mode 100644 test/tocsp.com

diff --git a/INSTALL.VMS b/INSTALL.VMS
index 6a50e6f..7c530a1 100644
--- a/INSTALL.VMS
+++ b/INSTALL.VMS
@@ -130,15 +130,23 @@ Currently, the logical names supported are:
       OPENSSL_NO_ASM    with value YES, the assembler parts of OpenSSL will
                         not be used.  Instead, plain C implementations are
                         used.  This is good to try if something doesn't work.
-      OPENSSL_NO_'alg'  with value YES, the corresponding crypto algorithm
-                        will not be implemented.  Supported algorithms to
-                        do this with are: RSA, DSA, DH, MD2, MD4, MD5, RIPEMD,
-                        SHA, DES, MDC2, CR2, RC4, RC5, IDEA, BF, CAST, HMAC,
-                        SSL3.  So, for example, having the logical name
-                        OPENSSL_NO_RSA with the value YES means that the
-                        LIBCRYPTO.OLB library will not contain an RSA
-                        implementation.
-
+      OPENSSL_NO_'alg'  with value YES, the corresponding crypto algorithm,
+                        protocol or other routine will not be implemented if
+                        disabling it is supported.  Supported algorithms to
+                        do this with are: AES, BF, CAMELLIA, CAST, CMS, COMP,
+                        DES, DGRAM, DH, DSA, EC, EC2M, ECDH, ECDSA, ENGINE,
+                        ERR, GOST, HEARTBEATS, HMAC, IDEA, KRB5, MD2, MD4,
+                        MD5, OCB, OCSP, PSK, RC2, RC4, RC5, RMD160, RSA, SCTP,
+                        SEED, SOCK, SRP, SRTP, TLSEXT, WHIRLPOOL.  So, for
+                        example, having the logical name OPENSSL_NO_RSA with
+                        the value YES means that the LIBCRYPTO.OLB library
+                        will not contain an RSA implementation.
+      OPENSSL_EXPERIMENTAL_'alg'
+                        with value YES, the corresponding experimental
+                        algorithm is enabled.  Note that is also requires
+                        the application using this to define the C macro
+                        OPENSSL_EXPERIMENTAL_'alg'.  Supported algorithms
+                        to do this with are: JPAKE, STORE.
 
 Test:
 =====
diff --git a/crypto/crypto-lib.com b/crypto/crypto-lib.com
index 4db5063..84ca96e 100644
--- a/crypto/crypto-lib.com
+++ b/crypto/crypto-lib.com
@@ -19,7 +19,6 @@ $!  Specify the following as P1 to build just that part or ALL to just
 $!  build everything.
 $!
 $!    	LIBRARY    To just compile the [.xxx.EXE.CRYPTO]LIBCRYPTO.OLB Library.
-$!    	APPS       To just compile the [.xxx.EXE.CRYPTO]*.EXE
 $!	ALL	   To do both LIBRARY and APPS
 $!
 $!  Specify DEBUG or NODEBUG as P2 to compile with or without debugger
@@ -102,22 +101,35 @@ $ LIB32 = &quot;32&quot;
 $ OPT_FILE = &quot;&quot;
 $ POINTER_SIZE = &quot;&quot;
 $!
-$! Define The Different Encryption Types.
-$! NOTE: Some might think this list ugly.  However, it's made this way to
-$! reflect the SDIRS variable in [-]Makefile.org as closely as possible,
-$! thereby making it fairly easy to verify that the lists are the same.
-$!
-$ ET_WHIRLPOOL = &quot;WHRLPOOL&quot;
-$ IF ARCH .EQS. &quot;VAX&quot; THEN ET_WHIRLPOOL = &quot;&quot;
-$ ENCRYPT_TYPES = &quot;Basic,&quot;+ -
-		  &quot;OBJECTS,&quot;+ -
-		  &quot;MD2,MD4,MD5,SHA,MDC2,HMAC,RIPEMD,&quot;+ET_WHIRLPOOL+&quot;,&quot;+ -
-		  &quot;DES,AES,RC2,RC4,RC5,IDEA,BF,CAST,CAMELLIA,SEED,MODES,&quot;+ -
-		  &quot;BN,EC,RSA,DSA,ECDSA,DH,ECDH,DSO,ENGINE,&quot;+ -
-		  &quot;BUFFER,BIO,STACK,LHASH,RAND,ERR,&quot;+ -
-		  &quot;EVP,EVP_2,EVP_3,ASN1,ASN1_2,PEM,X509,X509V3,&quot;+ -
-		  &quot;CONF,TXT_DB,PKCS7,PKCS12,COMP,OCSP,UI,KRB5,&quot;+ -
-		  &quot;CMS,PQUEUE,TS,JPAKE,SRP,STORE,CMAC&quot;
+$! Check if there's a SDIRS variable defined
+$!
+$ IF &quot;''SDIRS'&quot; .NES. &quot;&quot;
+$ THEN
+$!
+$!   If SDIRS was defined, define ENCRYPT_TYPES from it
+$!
+$     ENCRYPT_TYPES = &quot;Basic,''SDIRS'&quot;
+$!
+$! Otherwise
+$!
+$ ELSE
+$!
+$!   Define The Different Encryption Types.
+$!   NOTE: Some might think this list ugly.  However, it's made this way to
+$!   reflect the SDIRS variable in [-]Makefile.org as closely as possible,
+$!   thereby making it fairly easy to verify that the lists are the same.
+$!
+$   ET_WHIRLPOOL = &quot;WHRLPOOL&quot;
+$   IF ARCH .EQS. &quot;VAX&quot; THEN ET_WHIRLPOOL = &quot;&quot;
+$   ENCRYPT_TYPES = &quot;Basic,&quot;+ -
+		    &quot;OBJECTS,&quot;+ -
+		    &quot;MD2,MD4,MD5,SHA,MDC2,HMAC,RIPEMD,&quot;+ET_WHIRLPOOL+&quot;,&quot;+ -
+		    &quot;DES,AES,RC2,RC4,RC5,IDEA,BF,CAST,CAMELLIA,SEED,MODES,&quot;+ -
+		    &quot;BN,EC,RSA,DSA,ECDSA,DH,ECDH,DSO,ENGINE,&quot;+ -
+		    &quot;BUFFER,BIO,STACK,LHASH,RAND,ERR,&quot;+ -
+		    &quot;EVP,ASN1,PEM,X509,X509V3,CONF,TXT_DB,PKCS7,PKCS12,COMP,OCSP,UI,KRB5,&quot;+ -
+		    &quot;CMS,PQUEUE,TS,JPAKE,SRP,STORE,CMAC&quot;
+$ ENDIF
 $!
 $! Check To Make Sure We Have Valid Command Line Parameters.
 $!
@@ -204,16 +216,14 @@ $ GOSUB CHECK_OPT_FILE
 $!
 $! Define The Different Encryption &quot;library&quot; Strings.
 $!
-$ APPS_DES = &quot;DES/DES,CBC3_ENC&quot;
-$ APPS_PKCS7 = &quot;ENC/ENC;DEC/DEC;SIGN/SIGN;VERIFY/VERIFY,EXAMPLE&quot;
-$
 $ LIB_ = &quot;cryptlib,mem,mem_clr,mem_dbg,cversion,ex_data,cpt_err,&quot;+ -
 	&quot;ebcdic,uid,o_time,o_str,o_dir,thr_id,lock,fips_ers,&quot;+ -
 	&quot;o_init,o_fips&quot;
+$ LIB_OBJECTS = &quot;o_names,obj_dat,obj_lib,obj_err,obj_xref&quot;
 $ LIB_MD2 = &quot;md2_dgst,md2_one&quot;
 $ LIB_MD4 = &quot;md4_dgst,md4_one&quot;
 $ LIB_MD5 = &quot;md5_dgst,md5_one&quot;
-$ LIB_SHA = &quot;sha_dgst,sha1dgst,sha_one,sha1_one,sha256,sha512&quot;
+$ LIB_SHA = &quot;sha1dgst,sha1_one,sha256,sha512&quot;
 $ LIB_MDC2 = &quot;mdc2dgst,mdc2_one&quot;
 $ LIB_HMAC = &quot;hmac,hm_ameth,hm_pmeth&quot;
 $ LIB_RIPEMD = &quot;rmd_dgst,rmd_one&quot;
@@ -224,18 +234,19 @@ $ LIB_DES = &quot;set_key,ecb_enc,cbc_enc,&quot;+ -
 	&quot;ofb_enc,str2key,pcbc_enc,qud_cksm,rand_key,&quot;+ -
 	&quot;des_enc,fcrypt_b,&quot;+ -
 	&quot;fcrypt,xcbc_enc,rpc_enc,cbc_cksm,&quot;+ -
-	&quot;ede_cbcm_enc,des_old,des_old2,read2pwd&quot;
+	&quot;des_old,des_old2,read2pwd&quot;
+$ LIB_AES = &quot;aes_misc,aes_ecb,aes_cfb,aes_ofb,aes_ige,aes_wrap,&quot;+ -
+	&quot;aes_core,aes_cbc&quot;
 $ LIB_RC2 = &quot;rc2_ecb,rc2_skey,rc2_cbc,rc2cfb64,rc2ofb64&quot;
-$ LIB_RC4 = &quot;rc4_skey,rc4_enc&quot;
+$ LIB_RC4 = &quot;rc4_enc,rc4_skey&quot;
 $ LIB_RC5 = &quot;rc5_skey,rc5_ecb,rc5_enc,rc5cfb64,rc5ofb64&quot;
 $ LIB_IDEA = &quot;i_cbc,i_cfb64,i_ofb64,i_ecb,i_skey&quot;
 $ LIB_BF = &quot;bf_skey,bf_ecb,bf_enc,bf_cfb64,bf_ofb64&quot;
 $ LIB_CAST = &quot;c_skey,c_ecb,c_enc,c_cfb64,c_ofb64&quot;
-$ LIB_CAMELLIA = &quot;camellia,cmll_misc,cmll_ecb,cmll_cbc,cmll_ofb,&quot;+ -
-		 &quot;cmll_cfb,cmll_ctr&quot;
+$ LIB_CAMELLIA = &quot;cmll_ecb,cmll_ofb,cmll_cfb,cmll_ctr,camellia,cmll_misc,cmll_cbc&quot;
 $ LIB_SEED = &quot;seed,seed_ecb,seed_cbc,seed_cfb,seed_ofb&quot;
 $ LIB_MODES = &quot;cbc128,ctr128,cts128,cfb128,ofb128,gcm128,&quot;+ -
-	&quot;ccm128,xts128&quot;
+	&quot;ccm128,xts128,wrap128,ocb128&quot;
 $ LIB_BN_ASM = &quot;[.asm]vms.mar,vms-helper&quot;
 $ IF F$TRNLNM(&quot;OPENSSL_NO_ASM&quot;) .OR. ARCH .NES. &quot;VAX&quot; THEN -
      LIB_BN_ASM = &quot;bn_asm&quot;
@@ -243,7 +254,7 @@ $ LIB_BN = &quot;bn_add,bn_div,bn_exp,bn_lib,bn_ctx,bn_mul,bn_mod,&quot;+ -
 	&quot;bn_print,bn_rand,bn_shift,bn_word,bn_blind,&quot;+ -
 	&quot;bn_kron,bn_sqrt,bn_gcd,bn_prime,bn_err,bn_sqr,&quot;+LIB_BN_ASM+&quot;,&quot;+ -
 	&quot;bn_recp,bn_mont,bn_mpi,bn_exp2,bn_gf2m,bn_nist,&quot;+ -
-	&quot;bn_depr,bn_const,bn_x931p&quot;
+	&quot;bn_depr,bn_const,bn_x931p,bn_intern,bn_dh,bn_srp&quot;
 $ LIB_EC = &quot;ec_lib,ecp_smpl,ecp_mont,ecp_nist,ec_cvt,ec_mult,&quot;+ -
 	&quot;ec_err,ec_curve,ec_check,ec_print,ec_asn1,ec_key,&quot;+ -
 	&quot;ec2_smpl,ec2_mult,ec_ameth,ec_pmeth,eck_prn,&quot;+ -
@@ -257,45 +268,42 @@ $ LIB_DSA = &quot;dsa_gen,dsa_key,dsa_lib,dsa_asn1,dsa_vrf,dsa_sign,&quot;+ -
 	&quot;dsa_err,dsa_ossl,dsa_depr,dsa_ameth,dsa_pmeth,dsa_prn&quot;
 $ LIB_ECDSA = &quot;ecs_lib,ecs_asn1,ecs_ossl,ecs_sign,ecs_vrf,ecs_err&quot;
 $ LIB_DH = &quot;dh_asn1,dh_gen,dh_key,dh_lib,dh_check,dh_err,dh_depr,&quot;+ -
-	&quot;dh_ameth,dh_pmeth,dh_prn,dh_rfc5114&quot;
-$ LIB_ECDH = &quot;ech_lib,ech_ossl,ech_key,ech_err&quot;
+	&quot;dh_ameth,dh_pmeth,dh_prn,dh_rfc5114,dh_kdf&quot;
+$ LIB_ECDH = &quot;ech_lib,ech_ossl,ech_key,ech_err,ech_kdf&quot;
 $ LIB_DSO = &quot;dso_dl,dso_dlfcn,dso_err,dso_lib,dso_null,&quot;+ -
-	&quot;dso_openssl,dso_win32,dso_vms,dso_beos&quot;
+	&quot;dso_openssl,dso_win32,dso_vms&quot;
 $ LIB_ENGINE = &quot;eng_err,eng_lib,eng_list,eng_init,eng_ctrl,&quot;+ -
 	&quot;eng_table,eng_pkey,eng_fat,eng_all,&quot;+ -
 	&quot;tb_rsa,tb_dsa,tb_ecdsa,tb_dh,tb_ecdh,tb_rand,tb_store,&quot;+ -
 	&quot;tb_cipher,tb_digest,tb_pkmeth,tb_asnmth,&quot;+ -
-	&quot;eng_openssl,eng_dyn,eng_cnf,eng_cryptodev,&quot;+ -
-	&quot;eng_rsax,eng_rdrand&quot;
-$ LIB_AES = &quot;aes_core,aes_misc,aes_ecb,aes_cbc,aes_cfb,aes_ofb,&quot;+ -
-	&quot;aes_ige,aes_wrap&quot;
+	&quot;eng_openssl,eng_cnf,eng_dyn,eng_cryptodev,&quot;+ -
+	&quot;eng_rdrand&quot;
 $ LIB_BUFFER = &quot;buffer,buf_str,buf_err&quot;
 $ LIB_BIO = &quot;bio_lib,bio_cb,bio_err,&quot;+ -
 	&quot;bss_mem,bss_null,bss_fd,&quot;+ -
 	&quot;bss_file,bss_sock,bss_conn,&quot;+ -
 	&quot;bf_null,bf_buff,b_print,b_dump,&quot;+ -
-	&quot;b_sock,bss_acpt,bf_nbio,bss_rtcp,bss_bio,bss_log,&quot;+ -
+	&quot;b_sock,bss_acpt,bf_nbio,bss_log,bss_bio,&quot;+ -
 	&quot;bss_dgram,&quot;+ -
-	&quot;bf_lbuf&quot;
+	&quot;bf_lbuf,bss_rtcp&quot;	! The last two are VMS specific
 $ LIB_STACK = &quot;stack&quot;
 $ LIB_LHASH = &quot;lhash,lh_stats&quot;
 $ LIB_RAND = &quot;md_rand,randfile,rand_lib,rand_err,rand_egd,&quot;+ -
-	&quot;rand_vms&quot;
+	&quot;rand_win,rand_unix,rand_vms,rand_os2,rand_nw&quot;
 $ LIB_ERR = &quot;err,err_all,err_prn&quot;
-$ LIB_OBJECTS = &quot;o_names,obj_dat,obj_lib,obj_err,obj_xref&quot;
-$ LIB_EVP = &quot;encode,digest,evp_enc,evp_key,evp_acnf,evp_cnf,&quot;+ -
+$ LIB_EVP_1 = &quot;encode,digest,evp_enc,evp_key,evp_acnf,evp_cnf,&quot;+ -
 	&quot;e_des,e_bf,e_idea,e_des3,e_camellia,&quot;+ -
 	&quot;e_rc4,e_aes,names,e_seed,&quot;+ -
 	&quot;e_xcbc_d,e_rc2,e_cast,e_rc5&quot;
-$ LIB_EVP_2 = &quot;m_null,m_md2,m_md4,m_md5,m_sha,m_sha1,m_wp,&quot; + -
-	&quot;m_dss,m_dss1,m_mdc2,m_ripemd,m_ecdsa,&quot;+ -
+$ LIB_EVP_2 = &quot;m_null,m_md2,m_md4,m_md5,m_sha1,m_wp,&quot; + -
+	&quot;m_dss1,m_mdc2,m_ripemd,m_ecdsa,&quot;+ -
 	&quot;p_open,p_seal,p_sign,p_verify,p_lib,p_enc,p_dec,&quot;+ -
 	&quot;bio_md,bio_b64,bio_enc,evp_err,e_null,&quot;+ -
 	&quot;c_all,c_allc,c_alld,evp_lib,bio_ok,&quot;+-
 	&quot;evp_pkey,evp_pbe,p5_crpt,p5_crpt2&quot;
 $ LIB_EVP_3 = &quot;e_old,pmeth_lib,pmeth_fn,pmeth_gn,m_sigver,&quot;+ -
-	&quot;e_aes_cbc_hmac_sha1,e_rc4_hmac_md5&quot;
-$ LIB_ASN1 = &quot;a_object,a_bitstr,a_utctm,a_gentm,a_time,a_int,a_octet,&quot;+ -
+	&quot;e_aes_cbc_hmac_sha1,e_aes_cbc_hmac_sha256,e_rc4_hmac_md5&quot;
+$ LIB_ASN1_1 = &quot;a_object,a_bitstr,a_utctm,a_gentm,a_time,a_int,a_octet,&quot;+ -
 	&quot;a_print,a_type,a_set,a_dup,a_d2i_fp,a_i2d_fp,&quot;+ -
 	&quot;a_enum,a_utf8,a_sign,a_digest,a_verify,a_mbstr,a_strex,&quot;+ -
 	&quot;x_algor,x_val,x_pubkey,x_sig,x_req,x_attrib,x_bignum,&quot;+ -
@@ -307,7 +315,8 @@ $ LIB_ASN1_2 = &quot;t_req,t_x509,t_x509a,t_crl,t_pkey,t_spki,t_bitst,&quot;+ -
 	&quot;f_int,f_string,n_pkey,&quot;+ -
 	&quot;f_enum,x_pkey,a_bool,x_exten,bio_asn1,bio_ndef,asn_mime,&quot;+ -
 	&quot;asn1_gen,asn1_par,asn1_lib,asn1_err,a_bytes,a_strnid,&quot;+ -
-	&quot;evp_asn1,asn_pack,p5_pbe,p5_pbev2,p8_pkey,asn_moid&quot;
+	&quot;evp_asn1,asn_pack,p5_pbe,p5_pbev2,p8_pkey,asn_moid,&quot;+ -
+	&quot;asn_mstbl&quot;
 $ LIB_PEM = &quot;pem_sign,pem_seal,pem_info,pem_lib,pem_all,pem_err,&quot;+ -
 	&quot;pem_x509,pem_xaux,pem_oth,pem_pk8,pem_pkey,pvkfmt&quot;
 $ LIB_X509 = &quot;x509_def,x509_d2,x509_r2x,x509_cmp,&quot;+ -
@@ -338,7 +347,7 @@ $ LIB_UI = &quot;ui_err,ui_lib,ui_openssl,ui_util&quot;+LIB_UI_COMPAT
 $ LIB_KRB5 = &quot;krb5_asn&quot;
 $ LIB_CMS = &quot;cms_lib,cms_asn1,cms_att,cms_io,cms_smime,cms_err,&quot;+ -
 	&quot;cms_sd,cms_dd,cms_cd,cms_env,cms_enc,cms_ess,&quot;+ -
-	&quot;cms_pwri&quot;
+	&quot;cms_pwri,cms_kari&quot;
 $ LIB_PQUEUE = &quot;pqueue&quot;
 $ LIB_TS = &quot;ts_err,ts_req_utils,ts_req_print,ts_rsp_utils,ts_rsp_print,&quot;+ -
 	&quot;ts_rsp_sign,ts_rsp_verify,ts_verify_ctx,ts_lib,ts_conf,&quot;+ -
@@ -383,8 +392,6 @@ $!
 $! Extract The Module Name From The Encryption List.
 $!
 $ MODULE_NAME = F$ELEMENT(MODULE_COUNTER,&quot;,&quot;,ENCRYPT_TYPES)
-$ IF MODULE_NAME.EQS.&quot;Basic&quot; THEN MODULE_NAME = &quot;&quot;
-$ MODULE_NAME1 = MODULE_NAME
 $!
 $! Check To See If We Are At The End Of The Module List.
 $!
@@ -402,121 +409,71 @@ $!
 $! Increment The Moudle Counter.
 $!
 $ MODULE_COUNTER = MODULE_COUNTER + 1
+$
+$ IF MODULE_NAME.EQS.&quot;&quot; THEN GOTO MODULE_NEXT
+$ MODULE_NAME1 = MODULE_NAME
+$ IF MODULE_NAME.EQS.&quot;Basic&quot; THEN MODULE_NAME = &quot;&quot;
 $!
-$! Create The Library and Apps Module Names.
+$! Check if the library module name actually is defined
 $!
-$ LIB_MODULE = &quot;LIB_&quot; + MODULE_NAME
-$ APPS_MODULE = &quot;APPS_&quot; + MODULE_NAME
-$ IF (F$EXTRACT(0,5,MODULE_NAME).EQS.&quot;ASN1_&quot;)
-$ THEN
-$   MODULE_NAME = &quot;ASN1&quot;
-$ ENDIF
-$ IF (F$EXTRACT(0,4,MODULE_NAME).EQS.&quot;EVP_&quot;)
+$ PART_COUNTER = -1
+$ IF F$TYPE(LIB_'MODULE_NAME'_1) .NES. &quot;&quot;
 $ THEN
-$   MODULE_NAME = &quot;EVP&quot;
+$   PART_COUNTER = 1
+$ ELSE
+$   IF F$TYPE(LIB_'MODULE_NAME') .EQS. &quot;&quot;
+$   THEN
+$     WRITE SYS$ERROR &quot;&quot;
+$     WRITE SYS$ERROR &quot;The module &quot;,MODULE_NAME1,&quot; does not exist.  Continuing...&quot;
+$     WRITE SYS$ERROR &quot;&quot;
+$     GOTO MODULE_NEXT
+$   ENDIF
 $ ENDIF
 $!
-$! Set state (can be LIB and APPS)
+$! Tell The User What Module We Are Building.
 $!
-$ STATE = &quot;LIB&quot;
-$ IF BUILDALL .EQS. &quot;APPS&quot; THEN STATE = &quot;APPS&quot;
+$ WRITE SYS$OUTPUT &quot;Compiling The &quot;,MODULE_NAME1,&quot; Library Files. (&quot;,BUILDALL,&quot;)&quot;
 $!
-$! Check if the library module name actually is defined
+$! Create The Library Module Names.
 $!
-$ IF F$TYPE('LIB_MODULE') .EQS. &quot;&quot;
+$ PART_NEXT:
+$ IF PART_COUNTER .EQ. 0 THEN GOTO MODULE_NEXT
+$
+$ IF PART_COUNTER .LT. 0
 $ THEN
-$   WRITE SYS$ERROR &quot;&quot;
-$   WRITE SYS$ERROR &quot;The module &quot;,MODULE_NAME1,&quot; does not exist.  Continuing...&quot;
-$   WRITE SYS$ERROR &quot;&quot;
-$   GOTO MODULE_NEXT
+$   LIB_MODULE = &quot;LIB_&quot; + MODULE_NAME
+$ ELSE
+$   LIB_MODULE = &quot;LIB_&quot; + MODULE_NAME + &quot;_''PART_COUNTER'&quot;
 $ ENDIF
 $!
-$! Top Of The Module Loop.
+$! If there are no more parts, go to the next module
 $!
-$ MODULE_AGAIN:
+$ IF F$TYPE('LIB_MODULE') .EQS. &quot;&quot; THEN GOTO MODULE_NEXT
 $!
-$! Tell The User What Module We Are Building.
+$! Increment The Counter.
 $!
-$ IF (MODULE_NAME1.NES.&quot;&quot;) 
-$ THEN
-$   IF STATE .EQS. &quot;LIB&quot;
-$   THEN
-$     WRITE SYS$OUTPUT &quot;Compiling The &quot;,MODULE_NAME1,&quot; Library Files. (&quot;,BUILDALL,&quot;,&quot;,STATE,&quot;)&quot;
-$   ELSE IF F$TYPE('APPS_MODULE') .NES. &quot;&quot;
-$     THEN
-$       WRITE SYS$OUTPUT &quot;Compiling The &quot;,MODULE_NAME1,&quot; Applications. (&quot;,BUILDALL,&quot;,&quot;,STATE,&quot;)&quot;
-$     ENDIF
-$   ENDIF
-$ ENDIF
+$ PART_COUNTER = PART_COUNTER + 1
 $!
 $!  Define A File Counter And Set It To &quot;0&quot;.
 $!
 $ FILE_COUNTER = 0
-$ APPLICATION = &quot;&quot;
-$ APPLICATION_COUNTER = 0
 $!
 $! Top Of The File Loop.
 $!
 $ NEXT_FILE:
 $!
-$! Look in the LIB_MODULE is we're in state LIB
-$!
-$ IF STATE .EQS. &quot;LIB&quot;
-$ THEN
-$!
-$!   O.K, Extract The File Name From The File List.
-$!
-$   FILE_NAME = F$ELEMENT(FILE_COUNTER,&quot;,&quot;,'LIB_MODULE')
+$! Extract The File Name From The File List.
 $!
-$!   else
-$!
-$ ELSE
-$   FILE_NAME = &quot;,&quot;
-$!
-$   IF F$TYPE('APPS_MODULE') .NES. &quot;&quot;
-$   THEN
-$!
-$!     Extract The File Name From The File List.
-$!     This part is a bit more complicated.
-$!
-$     IF APPLICATION .EQS. &quot;&quot;
-$     THEN
-$       APPLICATION = F$ELEMENT(APPLICATION_COUNTER,&quot;;&quot;,'APPS_MODULE')
-$       APPLICATION_COUNTER = APPLICATION_COUNTER + 1
-$       APPLICATION_OBJECTS = F$ELEMENT(1,&quot;/&quot;,APPLICATION)
-$       APPLICATION = F$ELEMENT(0,&quot;/&quot;,APPLICATION)
-$       FILE_COUNTER = 0
-$     ENDIF
-$
-$!     WRITE SYS$OUTPUT &quot;DEBUG: SHOW SYMBOL APPLICATION*&quot;
-$!     SHOW SYMBOL APPLICATION*
-$!
-$     IF APPLICATION .NES. &quot;;&quot;
-$     THEN
-$       FILE_NAME = F$ELEMENT(FILE_COUNTER,&quot;,&quot;,APPLICATION_OBJECTS)
-$       IF FILE_NAME .EQS. &quot;,&quot;
-$       THEN
-$         APPLICATION = &quot;&quot;
-$         GOTO NEXT_FILE
-$       ENDIF
-$     ENDIF
-$   ENDIF
-$ ENDIF
+$ FILE_NAME = F$ELEMENT(FILE_COUNTER,&quot;,&quot;,'LIB_MODULE')
 $!
 $! Check To See If We Are At The End Of The File List.
 $!
 $ IF (FILE_NAME.EQS.&quot;,&quot;) 
 $ THEN 
 $!
-$!  We Are At The End Of The File List, Change State Or Goto FILE_DONE.
+$!  We Are At The End Of The File List, Goto FILE_DONE.
 $!
-$   IF STATE .EQS. &quot;LIB&quot; .AND. BUILDALL .NES. &quot;LIBRARY&quot;
-$   THEN
-$     STATE = &quot;APPS&quot;
-$     GOTO MODULE_AGAIN
-$   ELSE
-$     GOTO FILE_DONE
-$   ENDIF
+$   GOTO FILE_DONE
 $!
 $! End The File List Check.
 $!
@@ -566,14 +523,7 @@ $ ENDIF
 $!
 $! Tell The User We Are Compiling The File.
 $!
-$ IF (MODULE_NAME.EQS.&quot;&quot;)
-$ THEN
-$   WRITE SYS$OUTPUT &quot;Compiling The &quot;,FILE_NAME,&quot; File.  (&quot;,BUILDALL,&quot;,&quot;,STATE,&quot;)&quot;
-$ ENDIF
-$ IF (MODULE_NAME.NES.&quot;&quot;)
-$ THEN 
-$   WRITE SYS$OUTPUT &quot;        &quot;,FILE_NAME,&quot;&quot;
-$ ENDIF
+$ WRITE SYS$OUTPUT &quot;        &quot;,FILE_NAME,&quot;&quot;
 $!
 $! Compile The File.
 $!
@@ -634,17 +584,14 @@ $       ENDIF
 $     ENDIF
 $   ENDIF
 $ ENDIF
-$ IF STATE .EQS. &quot;LIB&quot;
-$ THEN 
 $!
-$!   Add It To The Library.
+$! Add It To The Library.
 $!
-$   LIBRARY/REPLACE 'LIB_NAME' 'OBJECT_FILE'
+$ LIBRARY/REPLACE 'LIB_NAME' 'OBJECT_FILE'
 $!
-$!   Time To Clean Up The Object File.
+$! Time To Clean Up The Object File.
 $!
-$   DELETE 'OBJECT_FILE';*
-$ ENDIF
+$ DELETE 'OBJECT_FILE';*
 $!
 $! Go Back And Do It Again.
 $!
@@ -654,47 +601,9 @@ $! All Done With This Library Part.
 $!
 $ FILE_DONE:
 $!
-$! Time To Build Some Applications
-$!
-$ IF F$TYPE('APPS_MODULE') .NES. &quot;&quot; .AND. BUILDALL .NES. &quot;LIBRARY&quot;
-$ THEN
-$   APPLICATION_COUNTER = 0
-$ NEXT_APPLICATION:
-$   APPLICATION = F$ELEMENT(APPLICATION_COUNTER,&quot;;&quot;,'APPS_MODULE')
-$   IF APPLICATION .EQS. &quot;;&quot; THEN GOTO APPLICATION_DONE
-$
-$   APPLICATION_COUNTER = APPLICATION_COUNTER + 1
-$   APPLICATION_OBJECTS = F$ELEMENT(1,&quot;/&quot;,APPLICATION)
-$   APPLICATION = F$ELEMENT(0,&quot;/&quot;,APPLICATION)
-$
-$!   WRITE SYS$OUTPUT &quot;DEBUG: SHOW SYMBOL APPLICATION*&quot;
-$!   SHOW SYMBOL APPLICATION*
-$!
-$! Tell the user what happens
-$!
-$   WRITE SYS$OUTPUT &quot;        &quot;,APPLICATION,&quot;.exe&quot;
-$!
-$! Link The Program.
-$!
-$   ON ERROR THEN GOTO NEXT_APPLICATION
-$!
-$!  Link With A TCP/IP Library.
-$!
-$   LINK /'DEBUGGER' /'LINKMAP' /'TRACEBACK' -
-     /EXE='EXE_DIR''APPLICATION'.EXE -
-     'OBJ_DIR''APPLICATION_OBJECTS', -
-     'CRYPTO_LIB'/LIBRARY -
-     'TCPIP_LIB' -
-     'ZLIB_LIB' -
-     ,'OPT_FILE' /OPTIONS
-$!
-$   GOTO NEXT_APPLICATION
-$  APPLICATION_DONE:
-$ ENDIF
-$!
-$! Go Back And Get The Next Module.
+$! Go Back And Get The Next Part.
 $!
-$ GOTO MODULE_NEXT
+$ GOTO PART_NEXT
 $!
 $! All Done With This Module.
 $!
@@ -851,7 +760,7 @@ $ ELSE
 $!
 $!  Else, Check To See If P1 Has A Valid Argument.
 $!
-$   IF (P1.EQS.&quot;LIBRARY&quot;).OR.(P1.EQS.&quot;APPS&quot;)
+$   IF (P1.EQS.&quot;LIBRARY&quot;)
 $   THEN
 $!
 $!    A Valid Argument.
@@ -869,7 +778,6 @@ $     WRITE SYS$OUTPUT &quot;The Option &quot;,P1,&quot; Is Invalid.  The Valid Options Are:&quot;
 $     WRITE SYS$OUTPUT &quot;&quot;
 $     WRITE SYS$OUTPUT &quot;    ALL      :  Just Build Everything.&quot;
 $     WRITE SYS$OUTPUT &quot;    LIBRARY  :  To Compile Just The [.xxx.EXE.CRYPTO]LIBCRYPTO.OLB Library.&quot;
-$     WRITE SYS$OUTPUT &quot;    APPS     :  To Compile Just The [.xxx.EXE.CRYPTO]*.EXE Programs.&quot;
 $     WRITE SYS$OUTPUT &quot;&quot;
 $     WRITE SYS$OUTPUT &quot; Where 'xxx' Stands For:&quot;
 $     WRITE SYS$OUTPUT &quot;&quot;
@@ -1493,10 +1401,12 @@ $ __HERE = F$PARSE(F$PARSE(&quot;A.;&quot;,F$ENVIRONMENT(&quot;PROCEDURE&quot;))-&quot;A.;&quot;,&quot;[]A.;&quot;) - &quot;A
 $ __HERE = F$EDIT(__HERE,&quot;UPCASE&quot;)
 $ __TOP = __HERE - &quot;CRYPTO]&quot;
 $ __INCLUDE = __TOP + &quot;INCLUDE.OPENSSL]&quot;
+$ __INTERNAL = __TOP + &quot;CRYPTO.INCLUDE.INTERNAL]&quot;
 $!
 $! Set up the logical name OPENSSL to point at the include directory
 $!
 $ DEFINE OPENSSL/NOLOG '__INCLUDE'
+$ DEFINE INTERNAL/NOLOG '__INTERNAL'
 $!
 $! Done
 $!
@@ -1509,6 +1419,7 @@ $!
 $ IF __SAVE_OPENSSL .EQS. &quot;&quot;
 $ THEN
 $   DEASSIGN OPENSSL
+$   DEASSIGN INTERNAL
 $ ELSE
 $   DEFINE/NOLOG OPENSSL '__SAVE_OPENSSL'
 $ ENDIF
diff --git a/crypto/install-crypto.com b/crypto/install-crypto.com
index 85b3d58..e57b2ee 100755
--- a/crypto/install-crypto.com
+++ b/crypto/install-crypto.com
@@ -76,12 +76,12 @@ $ sdirs := , -
    'archd', -
    objects, -
    md2, md4, md5, sha, mdc2, hmac, ripemd, whrlpool, -
-   des, aes, rc2, rc4, rc5, idea, bf, cast, camellia, seed, -
+   des, aes, rc2, rc4, rc5, idea, bf, cast, camellia, seed, modes, -
    bn, ec, rsa, dsa, ecdsa, dh, ecdh, dso, engine, -
    buffer, bio, stack, lhash, rand, err, -
    evp, asn1, pem, x509, x509v3, conf, txt_db, pkcs7, pkcs12, comp, ocsp, -
    ui, krb5, -
-   store, cms, pqueue, ts, jpake
+   cms, pqueue, ts, jpake, srp, store, cmac
 $!
 $ exheader_ := crypto.h, opensslv.h, ebcdic.h, symhacks.h, ossl_typ.h
 $ exheader_'archd' := opensslconf.h
@@ -133,12 +133,14 @@ $ exheader_comp := comp.h
 $ exheader_ocsp := ocsp.h
 $ exheader_ui := ui.h, ui_compat.h
 $ exheader_krb5 := krb5_asn.h
-$! exheader_store := store.h, str_compat.h
-$ exheader_store := store.h
 $ exheader_cms := cms.h
 $ exheader_pqueue := pqueue.h
 $ exheader_ts := ts.h
 $ exheader_jpake := jpake.h
+$ exheader_srp := srp.h
+$! exheader_store := store.h, str_compat.h
+$ exheader_store := store.h
+$ exheader_cmac := cmac.h
 $ libs := ssl_libcrypto
 $!
 $ exe_dir := [-.'archd'.exe.crypto]
diff --git a/crypto/symhacks.h b/crypto/symhacks.h
index 56922c9..03cdb1a 100644
--- a/crypto/symhacks.h
+++ b/crypto/symhacks.h
@@ -189,6 +189,14 @@
                                                 SSL_CTX_set_not_resumbl_sess_cb
 #  undef SSL_set_not_resumable_session_callback
 #  define SSL_set_not_resumable_session_callback  SSL_set_not_resumbl_sess_cb
+#  undef ssl_check_clienthello_tlsext_late
+#  define ssl_check_clienthello_tlsext_late       ssl_chk_clienthello_tlsext_late
+#  undef ssl3_cbc_record_digest_supported
+#  define ssl3_cbc_record_digest_supported        ssl3_cbc_rcd_digest_supported
+#  undef SSL_COMP_set0_compression_methods
+#  define SSL_COMP_set0_compression_methods       SSL_COMP_set0_compr_methods
+#  undef SSL_COMP_free_compression_methods
+#  define SSL_COMP_free_compression_methods       SSL_COMP_free_compr_methods
 
 /* Hack some long ENGINE names */
 #  undef ENGINE_get_default_BN_mod_exp_crt
@@ -399,6 +407,18 @@
 #  define CMS_OriginatorIdentifierOrKey_it        CMS_OriginatorIdOrKey_it
 #  undef cms_SignerIdentifier_get0_signer_id
 #  define cms_SignerIdentifier_get0_signer_id     cms_SignerId_get0_signer_id
+#  undef CMS_RecipientInfo_kari_get0_orig_id
+#  define CMS_RecipientInfo_kari_get0_orig_id     CMS_RecipInfo_kari_get0_orig_id
+#  undef CMS_RecipientInfo_kari_get0_reks
+#  define CMS_RecipientInfo_kari_get0_reks        CMS_RecipInfo_kari_get0_reks
+#  undef CMS_RecipientInfo_kari_set0_pkey
+#  define CMS_RecipientInfo_kari_set0_pkey        CMS_RecipInfo_kari_set0_pkey
+#  undef CMS_RecipientInfo_kari_orig_id_cmp
+#  define CMS_RecipientInfo_kari_orig_id_cmp      CMS_RecipInfo_kari_orig_id_cmp
+#  undef CMS_RecipientEncryptedKey_cert_cmp
+#  define CMS_RecipientEncryptedKey_cert_cmp      CMS_RecipEncryptedKey_cert_cmp
+#  undef CMS_RecipientEncryptedKey_get0_id
+#  define CMS_RecipientEncryptedKey_get0_id       CMS_RecipEncryptedKey_get0_id
 
 /* Hack some long DTLS1 names */
 #  undef dtls1_retransmit_buffered_messages
@@ -416,6 +436,10 @@
 #  undef UI_method_set_prompt_constructor
 #  define UI_method_set_prompt_constructor        UI_method_set_prompt_constructr
 
+/* Hack some long RSA names */
+#  undef RSA_padding_check_PKCS1_OAEP_mgf1
+#  define RSA_padding_check_PKCS1_OAEP_mgf1       RSA_padding_chk_PKCS1_OAEP_mgf1
+
 # endif                         /* defined OPENSSL_SYS_VMS */
 
 /* Case insensitive linking causes problems.... */
diff --git a/e_os.h b/e_os.h
index 0fbc33c..f4a427a 100644
--- a/e_os.h
+++ b/e_os.h
@@ -385,6 +385,7 @@ extern FILE *_imp___iob;
                                      __VMS_EXIT |= 0x10000000; \
                                      exit(__VMS_EXIT); } while(0)
 #   define NO_SYS_PARAM_H
+#   define NO_SYS_UN_H
 
 #  elif defined(OPENSSL_SYS_NETWARE)
 #   include &lt;fcntl.h&gt;
diff --git a/engines/makeengines.com b/engines/makeengines.com
index 6329fbb..a0bd168 100644
--- a/engines/makeengines.com
+++ b/engines/makeengines.com
@@ -94,12 +94,12 @@ $! library that isn't necessarely ported to VMS.
 $!
 $ ENGINES = &quot;,&quot; + P6
 $ IF ENGINES .EQS. &quot;,&quot; THEN -
-	ENGINES = &quot;,4758cca,aep,atalla,cswift,chil,nuron,sureware,ubsec,padlock,&quot;
+	ENGINES = &quot;,4758cca,padlock,capi,&quot;
 $!
 $! GOST requires a 64-bit integer type, unavailable on VAX.
 $!
 $ IF (ARCH .NES. &quot;VAX&quot;) THEN -
-       ENGINES = ENGINES+ &quot;,ccgost&quot;
+       ENGINES = ENGINES+ &quot;,gost&quot;
 $!
 $! Check options.
 $!
@@ -156,20 +156,14 @@ $   TV_OBJ_NAME = OBJ_DIR + F$PARSE(ENGINE_,,,&quot;NAME&quot;,&quot;SYNTAX_ONLY&quot;) + &quot;.OBJ&quot;
 $   TV_OBJ = &quot;,''TV_OBJ_NAME'&quot;
 $ ENDIF
 $ ENGINE_4758CCA = &quot;e_4758cca&quot;
-$ ENGINE_aep = &quot;e_aep&quot;
-$ ENGINE_atalla = &quot;e_atalla&quot;
-$ ENGINE_cswift = &quot;e_cswift&quot;
-$ ENGINE_chil = &quot;e_chil&quot;
-$ ENGINE_nuron = &quot;e_nuron&quot;
-$ ENGINE_sureware = &quot;e_sureware&quot;
-$ ENGINE_ubsec = &quot;e_ubsec&quot;
 $ ENGINE_padlock = &quot;e_padlock&quot;
-$
-$ ENGINE_ccgost_SUBDIR = &quot;ccgost&quot;
-$ ENGINE_ccgost = &quot;e_gost_err,gost2001_keyx,gost2001,gost89,gost94_keyx,&quot;+ -
-		  &quot;gost_ameth,gost_asn1,gost_crypt,gost_ctl,gost_eng,&quot;+ -
-		  &quot;gosthash,gost_keywrap,gost_md,gost_params,gost_pmeth,&quot;+ -
-		  &quot;gost_sign&quot;
+$ ENGINE_capi = &quot;e_capi&quot;
+$ 
+$ ENGINE_gost_SUBDIR = &quot;ccgost&quot;
+$ ENGINE_gost = &quot;e_gost_err,gost2001_keyx,gost2001,gost89,gost94_keyx,&quot;+ -
+		&quot;gost_ameth,gost_asn1,gost_crypt,gost_ctl,gost_eng,&quot;+ -
+		&quot;gosthash,gost_keywrap,gost_md,gost_params,gost_pmeth,&quot;+ -
+		&quot;gost_sign&quot;
 $!
 $! Define which programs need to be linked with a TCP/IP library
 $!
diff --git a/makevms.com b/makevms.com
index 331b1be..cf759e4 100755
--- a/makevms.com
+++ b/makevms.com
@@ -243,9 +243,23 @@ $ WRITE H_FILE &quot;#ifndef OPENSSL_SYS_VMS&quot;
 $ WRITE H_FILE &quot;# define OPENSSL_SYS_VMS&quot;
 $ WRITE H_FILE &quot;#endif&quot;
 $
+$!
+$! Defined the full SDIRS here.  It will be pruned depending on configuration.
+$! This is an exact copy of what's found in Makefile.org, with spaces replaced
+$! with commas.
+$!
+$ SDIRS := -
+        objects,-
+        md2,md4,md5,sha,mdc2,hmac,ripemd,whrlpool,-
+        des,aes,rc2,rc4,rc5,idea,bf,cast,camellia,seed,modes,-
+        bn,ec,rsa,dsa,ecdsa,dh,ecdh,dso,engine,-
+        buffer,bio,stack,lhash,rand,err,-
+        evp,asn1,pem,x509,x509v3,conf,txt_db,pkcs7,pkcs12,comp,ocsp,ui,krb5,-
+        cms,pqueue,ts,jpake,srp,store,cmac
+$
 $! One of the best way to figure out what the list should be is to do
 $! the following on a Unix system:
-$!   grep OPENSSL_NO_ crypto/*/*.h ssl/*.h engines/*.h engines/*/*.h|grep ':# *if'|sed -e 's/^.*def //'|sort|uniq
+$!   grep OPENSSL_NO_ crypto/include/internal/*.h crypto/*/*.h ssl/*.h engines/*.h engines/*/*.h|grep ':# *if'|sed -e 's/^.*def //'|sort|uniq
 $! For that reason, the list will also always end up in alphabetical order
 $ CONFIG_LOGICALS := AES,-
 		     ASM,INLINE_ASM,-
@@ -266,46 +280,42 @@ $ CONFIG_LOGICALS := AES,-
 		     EC_NISTP_64_GCC_128,-
 		     ENGINE,-
 		     ERR,-
-		     EVP,-
-		     FP_API,-
 		     GMP,-
 		     GOST,-
-		     HASH_COMP,-
+		     HEARTBEATS,-
 		     HMAC,-
 		     IDEA,-
 		     JPAKE,-
 		     KRB5,-
-		     LHASH,-
 		     MD2,-
 		     MD4,-
 		     MD5,-
 		     MDC2,-
 		     NEXTPROTONEG,-
+		     OCB,-
 		     OCSP,-
 		     PSK,-
 		     RC2,-
 		     RC4,-
 		     RC5,-
-		     RIPEMD,-
+		     RMD160,-
 		     RSA,-
+		     SCTP,-
 		     SEED,-
-		     SHA,-
-		     SHA0,-
-		     SHA1,-
-		     SHA256,-
-		     SHA512,-
 		     SOCK,-
 		     SRP,-
+		     SRTP,-
+		     SSL3_METHOD,-
 		     SSL_INTERN,-
-		     STACK,-
+		     SSL_TRACE,-
 		     STATIC_ENGINE,-
 		     STDIO,-
 		     STORE,-
 		     TLSEXT,-
+		     UNIT_TEST,-
 		     WHIRLPOOL
-$! Add a few that we know about
-$ CONFIG_LOGICALS := 'CONFIG_LOGICALS',-
-		     THREADS
+$ CONFIG_EXPERIMENTAL := JPAKE,-
+			 STORE
 $! The following rules, which dictate how some algorithm choices affect
 $! others, are picked from Configure.
 $! Quick syntax:
@@ -322,18 +332,29 @@ $! affect all following rules that depend on that algorithm being disabled.
 $! To force something to be enabled or disabled, have no algorithms in the
 $! algos part.
 $ CONFIG_DISABLE_RULES := RIJNDAEL/AES;-
+			  RMD160/RIPEMD;-
 			  DES/MDC2;-
 			  EC/ECDSA,ECDH;-
 			  MD5/SSL3,TLS1;-
 			  SHA/SSL3,TLS1;-
+			  RSA,DSA/SSL3,TLS1;-
 			  DH/SSL3,TLS1;-
 			  TLS1/TLSEXT;-
 			  EC/GOST;-
 			  DSA/GOST;-
 			  DH/GOST;-
+			  TLSEXT/SRP,HEARTBEAT;-
 			  /STATIC_ENGINE;-
 			  /KRB5;-
-			  /EC_NISTP_64_GCC_128
+			  /DEPRECATED;-
+			  /EC_NISTP_64_GCC_128;-
+			  /GMP;-
+			  /MD2;-
+			  /RC5;-
+			  /RFC3779;-
+			  /SCTP;-
+			  /SSL_TRACE;-
+			  /UNIT_TEST
 $ CONFIG_ENABLE_RULES := ZLIB_DYNAMIC/ZLIB;-
 			 /THREADS
 $
@@ -346,25 +367,59 @@ $   CONFIG_DISABLE_RULES = CONFIG_DISABLE_RULES + -
 			   &quot;;/WHIRLPOOL&quot;
 $ ENDIF
 $
+$! Keep track of things to remove from SDIRS, have the items surrounded
+$! with commas
+$ SKIP_SDIRS = &quot;,&quot;
+$
 $ CONFIG_LOG_I = 0
-$ CONFIG_LOG_LOOP1:
+$ CONFIG_LOG_LOOP11:
 $   CONFIG_LOG_E = F$EDIT(F$ELEMENT(CONFIG_LOG_I,&quot;,&quot;,CONFIG_LOGICALS),&quot;TRIM&quot;)
 $   CONFIG_LOG_I = CONFIG_LOG_I + 1
-$   IF CONFIG_LOG_E .EQS. &quot;&quot; THEN GOTO CONFIG_LOG_LOOP1
-$   IF CONFIG_LOG_E .EQS. &quot;,&quot; THEN GOTO CONFIG_LOG_LOOP1_END
+$   IF CONFIG_LOG_E .EQS. &quot;&quot; THEN GOTO CONFIG_LOG_LOOP11
+$   IF CONFIG_LOG_E .EQS. &quot;,&quot; THEN GOTO CONFIG_LOG_LOOP11_END
 $   IF F$TRNLNM(&quot;OPENSSL_NO_&quot;+CONFIG_LOG_E)
 $   THEN
 $       CONFIG_DISABLED_'CONFIG_LOG_E' := YES
 $       CONFIG_ENABLED_'CONFIG_LOG_E' := NO
 $	CONFIG_CHANGED_'CONFIG_LOG_E' := YES
+$	IF (SKIP_SDIRS - (&quot;,&quot;+CONFIG_LOG_E+&quot;,&quot;)) .EQS. SKIP_SDIRS THEN -
+	    SKIP_SDIRS = SKIP_SDIRS + CONFIG_LOG_E + &quot;,&quot;
 $   ELSE
 $       CONFIG_DISABLED_'CONFIG_LOG_E' := NO
 $       CONFIG_ENABLED_'CONFIG_LOG_E' := YES
-$	! Because all algorithms are assumed enabled by default
+$	! Because all non-experimental algorithms are assumed
+$	! enabled by default
 $	CONFIG_CHANGED_'CONFIG_LOG_E' := NO
+$	IF (SKIP_SDIRS - (&quot;,&quot;+CONFIG_LOG_E+&quot;,&quot;)) .NES. SKIP_SDIRS THEN -
+	    SKIP_SDIRS = SKIP_SDIRS - (CONFIG_LOG_E + &quot;,&quot;)
 $   ENDIF
-$   GOTO CONFIG_LOG_LOOP1
-$ CONFIG_LOG_LOOP1_END:
+$   GOTO CONFIG_LOG_LOOP11
+$ CONFIG_LOG_LOOP11_END:
+$
+$ CONFIG_LOG_I = 0
+$ CONFIG_LOG_LOOP12:
+$   CONFIG_LOG_E = F$EDIT(F$ELEMENT(CONFIG_LOG_I,&quot;,&quot;,CONFIG_EXPERIMENTAL),&quot;TRIM&quot;)
+$   CONFIG_LOG_I = CONFIG_LOG_I + 1
+$   IF CONFIG_LOG_E .EQS. &quot;&quot; THEN GOTO CONFIG_LOG_LOOP12
+$   IF CONFIG_LOG_E .EQS. &quot;,&quot; THEN GOTO CONFIG_LOG_LOOP12_END
+$   IF F$TRNLNM(&quot;OPENSSL_EXPERIMENTAL_&quot;+CONFIG_LOG_E)
+$   THEN
+$	CONFIG_DISABLED_'CONFIG_LOG_E' := NO
+$	CONFIG_ENABLED_'CONFIG_LOG_E' := YES
+$	CONFIG_CHANGED_'CONFIG_LOG_E' := YES
+$	IF (SKIP_SDIRS - (&quot;,&quot;+CONFIG_LOG_E+&quot;,&quot;)) .NES. SKIP_SDIRS THEN -
+	    SKIP_SDIRS = SKIP_SDIRS - (CONFIG_LOG_E + &quot;,&quot;)
+$   ELSE
+$	CONFIG_DISABLED_'CONFIG_LOG_E' := YES
+$	CONFIG_ENABLED_'CONFIG_LOG_E' := NO
+$	! Because all experimental algorithms are assumed
+$	! disabled by default
+$	CONFIG_CHANGED_'CONFIG_LOG_E' := NO
+$	IF (SKIP_SDIRS - (&quot;,&quot;+CONFIG_LOG_E+&quot;,&quot;)) .EQS. SKIP_SDIRS THEN -
+	    SKIP_SDIRS = SKIP_SDIRS + CONFIG_LOG_E + &quot;,&quot;
+$   ENDIF
+$   GOTO CONFIG_LOG_LOOP12
+$ CONFIG_LOG_LOOP12_END:
 $
 $! Apply cascading disable rules
 $ CONFIG_DISABLE_I = 0
@@ -407,6 +462,8 @@ $       CONFIG_DISABLED_'CONFIG_DEPENDENT_E' := YES
 $       CONFIG_ENABLED_'CONFIG_DEPENDENT_E' := NO
 $	! Better not to assume defaults at this point...
 $	CONFIG_CHANGED_'CONFIG_DEPENDENT_E' := YES
+$	IF (SKIP_SDIRS - (&quot;,&quot;+CONFIG_DEPENDENT_E+&quot;,&quot;)) .EQS. SKIP_SDIRS THEN -
+	    SKIP_SDIRS = SKIP_SDIRS + CONFIG_DEPENDENT_E + &quot;,&quot;
 $	WRITE SYS$ERROR -
          &quot;''CONFIG_DEPENDENT_E' disabled by rule ''CONFIG_DISABLE_E'&quot;
 $	GOTO CONFIG_DISABLE_LOOP2
@@ -456,6 +513,8 @@ $       CONFIG_DISABLED_'CONFIG_DEPENDENT_E' := NO
 $       CONFIG_ENABLED_'CONFIG_DEPENDENT_E' := YES
 $	! Better not to assume defaults at this point...
 $	CONFIG_CHANGED_'CONFIG_DEPENDENT_E' := YES
+$	IF (SKIP_SDIRS - (&quot;,&quot;+CONFIG_DEPENDENT_E+&quot;,&quot;)) .NES. SKIP_SDIRS THEN -
+	    SKIP_SDIRS = SKIP_SDIRS - (CONFIG_DEPENDENT_E + &quot;,&quot;)
 $	WRITE SYS$ERROR -
          &quot;''CONFIG_DEPENDENT_E' enabled by rule ''CONFIG_ENABLE_E'&quot;
 $	GOTO CONFIG_ENABLE_LOOP2
@@ -464,6 +523,19 @@ $   ENDIF
 $   GOTO CONFIG_ENABLE_LOOP0
 $ CONFIG_ENABLE_LOOP0_END:
 $
+$! Fix SDIRS
+$ SDIRS = &quot;,&quot;+F$EDIT(SDIRS,&quot;COLLAPSE&quot;)+&quot;,&quot;
+$ CONFIG_SKIP_I = 0
+$ CONFIG_SDIRS_LOOP1:
+$   CONFIG_SKIP_E = F$EDIT(F$ELEMENT(CONFIG_SKIP_I,&quot;,&quot;,SKIP_SDIRS),&quot;TRIM&quot;)
+$   CONFIG_SKIP_I = CONFIG_SKIP_I + 1
+$   IF CONFIG_SKIP_E .EQS. &quot;&quot; THEN GOTO CONFIG_SDIRS_LOOP1
+$   IF CONFIG_SKIP_E .EQS. &quot;,&quot; THEN GOTO CONFIG_SDIRS_LOOP1_END
+$   IF (SDIRS - (&quot;,&quot;+CONFIG_SKIP_E+&quot;,&quot;)) .NES. SDIRS THEN -
+       SDIRS = SDIRS - (CONFIG_SKIP_E+&quot;,&quot;)
+$   GOTO CONFIG_SDIRS_LOOP1
+$ CONFIG_SDIRS_LOOP1_END: 
+$ 
 $! Write to the configuration
 $ CONFIG_LOG_I = 0
 $ CONFIG_LOG_LOOP2:
@@ -471,21 +543,32 @@ $   CONFIG_LOG_E = F$EDIT(F$ELEMENT(CONFIG_LOG_I,&quot;,&quot;,CONFIG_LOGICALS),&quot;TRIM&quot;)
 $   CONFIG_LOG_I = CONFIG_LOG_I + 1
 $   IF CONFIG_LOG_E .EQS. &quot;&quot; THEN GOTO CONFIG_LOG_LOOP2
 $   IF CONFIG_LOG_E .EQS. &quot;,&quot; THEN GOTO CONFIG_LOG_LOOP2_END
-$   IF CONFIG_CHANGED_'CONFIG_LOG_E'
+$   IF CONFIG_DISABLED_'CONFIG_LOG_E'
 $   THEN
-$     IF CONFIG_DISABLED_'CONFIG_LOG_E'
+$     WRITE H_FILE &quot;#ifndef OPENSSL_NO_&quot;,CONFIG_LOG_E
+$     WRITE H_FILE &quot;# define OPENSSL_NO_&quot;,CONFIG_LOG_E
+$     WRITE H_FILE &quot;#endif&quot;
+$   ELSE
+$     IF CONFIG_CHANGED_'CONFIG_LOG_E'
 $     THEN
-$	WRITE H_FILE &quot;#ifndef OPENSSL_NO_&quot;,CONFIG_LOG_E
-$	WRITE H_FILE &quot;# define OPENSSL_NO_&quot;,CONFIG_LOG_E
-$	WRITE H_FILE &quot;#endif&quot;
-$     ELSE
-$	WRITE H_FILE &quot;#ifndef OPENSSL_&quot;,CONFIG_LOG_E
-$	WRITE H_FILE &quot;# define OPENSSL_&quot;,CONFIG_LOG_E
+$	WRITE H_FILE &quot;#ifndef OPENSSL_EXPERIMENTAL_&quot;,CONFIG_LOG_E
+$	WRITE H_FILE &quot;# ifndef OPENSSL_NO_&quot;,CONFIG_LOG_E
+$	WRITE H_FILE &quot;#  define OPENSSL_NO_&quot;,CONFIG_LOG_E
+$	WRITE H_FILE &quot;# endif&quot;
 $	WRITE H_FILE &quot;#endif&quot;
+$
+$	IF F$TYPE(USER_CCDEFS) .NES. &quot;&quot;
+$	THEN
+$	  USER_CCDEFS = USER_CCDEFS + &quot;,OPENSSL_EXPERIMENTAL_&quot; + CONFIG_LOG_E
+$       ELSE
+$	  USER_CCDEFS = &quot;OPENSSL_EXPERIMENTAL_&quot; + CONFIG_LOG_E
+$       ENDIF
 $     ENDIF
 $   ENDIF
 $   GOTO CONFIG_LOG_LOOP2
 $ CONFIG_LOG_LOOP2_END:
+$
+$ WRITE/SYMBOL SYS$ERROR &quot;SDIRS = &quot;&quot;&quot;,SDIRS,&quot;&quot;&quot;&quot;
 $!
 $ WRITE H_FILE &quot;&quot;
 $ WRITE H_FILE &quot;/* STCP support comes with TCPIP 5.7 ECO 2 &quot;
@@ -689,7 +772,7 @@ $ copy 'exheader' sys$disk:[.include.openssl]
 $!
 $! Copy All The &quot;.H&quot; Files From The [.CRYPTO] Directory Tree.
 $!
-$ SDIRS := , -
+$ HEADER_SDIRS := , -
    'ARCHD', -
    OBJECTS, -
    MD2, MD4, MD5, SHA, MDC2, HMAC, RIPEMD, WHRLPOOL, -
@@ -760,20 +843,20 @@ $ EXHEADER_STORE := store.h
 $ EXHEADER_CMAC := cmac.h
 $!
 $ i = 0
-$ loop_sdirs:
-$   sdir = f$edit( f$element( i, &quot;,&quot;, sdirs), &quot;trim&quot;)
+$ loop_header_sdirs:
+$   sdir = f$edit( f$element( i, &quot;,&quot;, header_sdirs), &quot;trim&quot;)
 $   i = i + 1
-$   if (sdir .eqs. &quot;,&quot;) then goto loop_sdirs_end
+$   if (sdir .eqs. &quot;,&quot;) then goto loop_header_sdirs_end
 $   hdr_list = exheader_'sdir'
 $   if (sdir .nes. &quot;&quot;) then sdir = &quot;.&quot;+ sdir
 $   copy [.crypto'sdir']'hdr_list' sys$disk:[.include.openssl]
-$ goto loop_sdirs
-$ loop_sdirs_end:
+$ goto loop_header_sdirs
+$ loop_header_sdirs_end:
 $!
 $! Copy All The &quot;.H&quot; Files From The [.SSL] Directory.
 $!
 $! (keep these in the same order as ssl/Makefile)
-$ EXHEADER := ssl.h, ssl2.h, ssl3.h, ssl23.h, tls1.h, dtls1.h, kssl.h
+$ EXHEADER := ssl.h, ssl2.h, ssl3.h, ssl23.h, tls1.h, dtls1.h, kssl.h, srtp.h
 $ copy sys$disk:[.ssl]'exheader' sys$disk:[.include.openssl]
 $!
 $! Purge the [.include.openssl] header files.
@@ -803,11 +886,6 @@ $!
 $ @CRYPTO-LIB LIBRARY 'DEBUGGER' &quot;''COMPILER'&quot; &quot;''TCPIP_TYPE'&quot; -
    &quot;''ISSEVEN'&quot; &quot;''BUILDPART'&quot; &quot;''POINTER_SIZE'&quot; &quot;''ZLIB'&quot;
 $!
-$! Build The [.xxx.EXE.CRYPTO]*.EXE Test Applications.
-$!  
-$ @CRYPTO-LIB APPS 'DEBUGGER' &quot;''COMPILER'&quot; &quot;''TCPIP_TYPE'&quot; -
-   &quot;''ISSEVEN'&quot; &quot;''BUILDPART'&quot; &quot;''POINTER_SIZE'&quot; &quot;''ZLIB'&quot;
-$!
 $! Go Back To The Main Directory.
 $!
 $ SET DEFAULT [-]
diff --git a/ssl/ssl-lib.com b/ssl/ssl-lib.com
index 51e2b12..b160a0a 100644
--- a/ssl/ssl-lib.com
+++ b/ssl/ssl-lib.com
@@ -213,16 +213,15 @@ $ ENDIF
 $!
 $! Define The Different SSL &quot;library&quot; Files.
 $!
-$ LIB_SSL = &quot;s2_meth,s2_srvr,s2_clnt,s2_lib,s2_enc,s2_pkt,&quot;+ -
-	    &quot;s3_meth,s3_srvr,s3_clnt,s3_lib,s3_enc,s3_pkt,s3_both,&quot;+ -
-	    &quot;s23_meth,s23_srvr,s23_clnt,s23_lib,s23_pkt,&quot;+ -
-	    &quot;t1_meth,t1_srvr,t1_clnt,t1_lib,t1_enc,&quot;+ -
-	    &quot;d1_meth,d1_srvr,d1_clnt,d1_lib,d1_pkt,&quot;+ -
-	    &quot;d1_both,d1_enc,d1_srtp,&quot;+ -
+$ LIB_SSL = &quot;s3_meth,  s3_srvr, s3_clnt, s3_lib, s3_enc,s3_pkt,s3_both,s3_cbc,&quot;+ -
+	    &quot;s23_meth,s23_srvr,s23_clnt,s23_lib,       s23_pkt,&quot;+ -
+	    &quot;t1_meth,  t1_srvr, t1_clnt, t1_lib, t1_enc,       t1_ext,&quot;+ -
+	    &quot;d1_meth,  d1_srvr, d1_clnt, d1_lib,        d1_pkt,&quot;+ -
+	    &quot;d1_both,d1_srtp,&quot;+ -
 	    &quot;ssl_lib,ssl_err2,ssl_cert,ssl_sess,&quot;+ -
 	    &quot;ssl_ciph,ssl_stat,ssl_rsa,&quot;+ -
-	    &quot;ssl_asn1,ssl_txt,ssl_algs,&quot;+ -
-	    &quot;bio_ssl,ssl_err,kssl,t1_reneg,tls_srp,t1_trce&quot;
+	    &quot;ssl_asn1,ssl_txt,ssl_algs,ssl_conf,&quot;+ -
+	    &quot;bio_ssl,ssl_err,kssl,t1_reneg,tls_srp,t1_trce,ssl_utst&quot;
 $!
 $ COMPILEWITH_CC5 = &quot;&quot;
 $!
@@ -240,7 +239,7 @@ $ NEXT_FILE:
 $!
 $! O.K, Extract The File Name From The File List.
 $!
-$ FILE_NAME = F$ELEMENT(FILE_COUNTER,&quot;,&quot;,LIB_SSL)
+$ FILE_NAME = F$EDIT(F$ELEMENT(FILE_COUNTER,&quot;,&quot;,LIB_SSL),&quot;TRIM&quot;)
 $!
 $! Check To See If We Are At The End Of The File List.
 $!
diff --git a/ssl/ssl_task.c b/ssl/ssl_task.c
index f0ed4e4..dad20c6 100644
--- a/ssl/ssl_task.c
+++ b/ssl/ssl_task.c
@@ -131,8 +131,8 @@ int LIB$INIT_TIMER(), LIB$SHOW_TIMER();
 #include &lt;openssl/ssl.h&gt;
 #include &lt;openssl/err.h&gt;
 
-int MS_CALLBACK verify_callback(int ok, X509 *xs, X509 *xi, int depth,
-                                int error);
+int verify_callback(int ok, X509 *xs, X509 *xi, int depth,
+		    int error);
 BIO *bio_err = NULL;
 BIO *bio_stdout = NULL;
 BIO_METHOD *BIO_s_rtcp();
diff --git a/test/cms-test.pl b/test/cms-test.pl
index 7d4ca29..1c3f00d 100644
--- a/test/cms-test.pl
+++ b/test/cms-test.pl
@@ -58,19 +58,32 @@ my $redir = &quot; 2&gt; cms.err &gt; cms.out&quot;;
 # Make VMS work
 if ( $^O eq &quot;VMS&quot; &amp;&amp; -f &quot;OSSLX:openssl.exe&quot; ) {
     $ossl_path = &quot;pipe mcr OSSLX:openssl&quot;;
+    $null_path = &quot;NL:&quot;;
+    # On VMS, the lowest 3 bits of the exit code indicates severity
+    # 1 is success (perl translates it to 0 for $?), 2 is error
+    # (perl doesn't translate it)
+    $failure_code = 512;	# 2 &lt;&lt; 8 = 512
 }
 # Make MSYS work
 elsif ( $^O eq &quot;MSWin32&quot; &amp;&amp; -f &quot;../apps/openssl.exe&quot; ) {
     $ossl_path = &quot;cmd /c ..\\apps\\openssl&quot;;
+    $null_path = &quot;/dev/null&quot;;
+    $failure_code = 256;
 }
 elsif ( -f &quot;../apps/openssl$ENV{EXE_EXT}&quot; ) {
     $ossl_path = &quot;../util/shlib_wrap.sh ../apps/openssl&quot;;
+    $null_path = &quot;/dev/null&quot;;
+    $failure_code = 256;
 }
 elsif ( -f &quot;..\\out32dll\\openssl.exe&quot; ) {
     $ossl_path = &quot;..\\out32dll\\openssl.exe&quot;;
+    $null_path = &quot;/dev/null&quot;;
+    $failure_code = 256;
 }
 elsif ( -f &quot;..\\out32\\openssl.exe&quot; ) {
     $ossl_path = &quot;..\\out32\\openssl.exe&quot;;
+    $null_path = &quot;/dev/null&quot;;
+    $failure_code = 256;
 }
 else {
     die &quot;Can't find OpenSSL executable&quot;;
@@ -87,12 +100,12 @@ my $no_ec2m;
 my $no_ecdh;
 my $ossl8 = `$ossl_path version -v` =~ /0\.9\.8/;
 
-system (&quot;$ossl_path no-ec &gt;/dev/null&quot;);
+system (&quot;$ossl_path no-ec &gt; $null_path&quot;);
 if ($? == 0)
 	{
 	$no_ec = 1;
 	}
-elsif ($? == 256)
+elsif ($? == $failure_code)
 	{
 	$no_ec = 0;
 	}
@@ -101,12 +114,12 @@ else
 	die &quot;Error checking for EC support\n&quot;;
 	}
     
-system (&quot;$ossl_path no-ec2m &gt;/dev/null&quot;);
+system (&quot;$ossl_path no-ec2m &gt; $null_path&quot;);
 if ($? == 0)
 	{
 	$no_ec2m = 1;
 	}
-elsif ($? == 256)
+elsif ($? == $failure_code)
 	{
 	$no_ec2m = 0;
 	}
@@ -115,12 +128,12 @@ else
 	die &quot;Error checking for EC2M support\n&quot;;
 	}
 
-system (&quot;$ossl_path no-ecdh &gt;/dev/null&quot;);
+system (&quot;$ossl_path no-ecdh &gt; $null_path&quot;);
 if ($? == 0)
 	{
 	$no_ecdh = 1;
 	}
-elsif ($? == 256)
+elsif ($? == $failure_code)
 	{
 	$no_ecdh = 0;
 	}
diff --git a/test/maketests.com b/test/maketests.com
index e7a6860..5919374 100644
--- a/test/maketests.com
+++ b/test/maketests.com
@@ -142,47 +142,56 @@ $!
 $ TEST_FILES = &quot;BNTEST,ECTEST,ECDSATEST,ECDHTEST,IDEATEST,&quot;+ -
 	       &quot;MD2TEST,MD4TEST,MD5TEST,HMACTEST,WP_TEST,&quot;+ -
 	       &quot;RC2TEST,RC4TEST,RC5TEST,&quot;+ -
-	       &quot;DESTEST,SHATEST,SHA1TEST,SHA256T,SHA512T,&quot;+ -
+	       &quot;DESTEST,SHA1TEST,SHA256T,SHA512T,&quot;+ -
 	       &quot;MDC2TEST,RMDTEST,&quot;+ -
 	       &quot;RANDTEST,DHTEST,ENGINETEST,&quot;+ -
-	       &quot;BFTEST,CASTTEST,SSLTEST,EXPTEST,DSATEST,RSA_TEST,&quot;+ -
-	       &quot;EVP_TEST,IGETEST,JPAKETEST,SRPTEST&quot;
+	       &quot;GOST2814789TEST,&quot;+ -
+	       &quot;BFTEST,CASTTEST,SSLTEST,&quot;+ -
+	       &quot;EXPTEST,DSATEST,RSA_TEST,&quot;+ -
+	       &quot;EVP_TEST,IGETEST,JPAKETEST,SRPTEST,&quot;+ -
+	       &quot;V3NAMETEST,HEARTBEAT_TEST,P5_CRPT2_TEST,&quot;+ -
+	       &quot;CONSTANT_TIME_TEST&quot;
 $! Should we add MTTEST,PQ_TEST,LH_TEST,DIVTEST,TABTEST as well?
 $!
 $! Additional directory information.
-$ T_D_BNTEST     := [-.crypto.bn]
-$ T_D_ECTEST     := [-.crypto.ec]
-$ T_D_ECDSATEST  := [-.crypto.ecdsa]
-$ T_D_ECDHTEST   := [-.crypto.ecdh]
-$ T_D_IDEATEST   := [-.crypto.idea]
-$ T_D_MD2TEST    := [-.crypto.md2]
-$ T_D_MD4TEST    := [-.crypto.md4]
-$ T_D_MD5TEST    := [-.crypto.md5]
-$ T_D_HMACTEST   := [-.crypto.hmac]
-$ T_D_WP_TEST    := [-.crypto.whrlpool]
-$ T_D_RC2TEST    := [-.crypto.rc2]
-$ T_D_RC4TEST    := [-.crypto.rc4]
-$ T_D_RC5TEST    := [-.crypto.rc5]
-$ T_D_DESTEST    := [-.crypto.des]
-$ T_D_SHATEST    := [-.crypto.sha]
-$ T_D_SHA1TEST   := [-.crypto.sha]
-$ T_D_SHA256T    := [-.crypto.sha]
-$ T_D_SHA512T    := [-.crypto.sha]
-$ T_D_MDC2TEST   := [-.crypto.mdc2]
-$ T_D_RMDTEST    := [-.crypto.ripemd]
-$ T_D_RANDTEST   := [-.crypto.rand]
-$ T_D_DHTEST     := [-.crypto.dh]
-$ T_D_ENGINETEST := [-.crypto.engine]
-$ T_D_BFTEST     := [-.crypto.bf]
-$ T_D_CASTTEST   := [-.crypto.cast]
-$ T_D_SSLTEST    := [-.ssl]
-$ T_D_EXPTEST    := [-.crypto.bn]
-$ T_D_DSATEST    := [-.crypto.dsa]
-$ T_D_RSA_TEST   := [-.crypto.rsa]
-$ T_D_EVP_TEST   := [-.crypto.evp]
-$ T_D_IGETEST    := [-.test]
-$ T_D_JPAKETEST  := [-.crypto.jpake]
-$ T_D_SRPTEST    := [-.crypto.srp]
+$ T_D_BNTEST             := [-.crypto.bn]
+$ T_D_ECTEST             := [-.crypto.ec]
+$ T_D_ECDSATEST          := [-.crypto.ecdsa]
+$ T_D_ECDHTEST           := [-.crypto.ecdh]
+$ T_D_IDEATEST           := [-.crypto.idea]
+$ T_D_MD2TEST            := [-.crypto.md2]
+$ T_D_MD4TEST            := [-.crypto.md4]
+$ T_D_MD5TEST            := [-.crypto.md5]
+$ T_D_HMACTEST           := [-.crypto.hmac]
+$ T_D_WP_TEST            := [-.crypto.whrlpool]
+$ T_D_RC2TEST            := [-.crypto.rc2]
+$ T_D_RC4TEST            := [-.crypto.rc4]
+$ T_D_RC5TEST            := [-.crypto.rc5]
+$ T_D_DESTEST            := [-.crypto.des]
+$ T_D_SHATEST            := [-.crypto.sha]
+$ T_D_SHA1TEST           := [-.crypto.sha]
+$ T_D_SHA256T            := [-.crypto.sha]
+$ T_D_SHA512T            := [-.crypto.sha]
+$ T_D_MDC2TEST           := [-.crypto.mdc2]
+$ T_D_RMDTEST            := [-.crypto.ripemd]
+$ T_D_RANDTEST           := [-.crypto.rand]
+$ T_D_DHTEST             := [-.crypto.dh]
+$ T_D_ENGINETEST         := [-.crypto.engine]
+$ T_D_GOST2814789TEST    := [-.engines.ccgost]
+$ T_D_BFTEST             := [-.crypto.bf]
+$ T_D_CASTTEST           := [-.crypto.cast]
+$ T_D_SSLTEST            := [-.ssl]
+$ T_D_EXPTEST            := [-.crypto.bn]
+$ T_D_DSATEST            := [-.crypto.dsa]
+$ T_D_RSA_TEST           := [-.crypto.rsa]
+$ T_D_EVP_TEST           := [-.crypto.evp]
+$ T_D_IGETEST            := [-.test]
+$ T_D_JPAKETEST          := [-.crypto.jpake]
+$ T_D_SRPTEST            := [-.crypto.srp]
+$ T_D_V3NAMETEST         := [-.crypto.x509v3]
+$ T_D_HEARTBEAT_TEST     := [-.ssl]
+$ T_D_P5_CRPT2_TEST      := [-.crypto.evp]
+$ T_D_CONSTANT_TIME_TEST := [-.crypto]
 $!
 $ TCPIP_PROGRAMS = &quot;,,&quot;
 $ IF COMPILER .EQS. &quot;VAXC&quot; THEN -
@@ -468,7 +477,7 @@ $ CHECK_OPTIONS:
 $!
 $! Set basic C compiler /INCLUDE directories.
 $!
-$ CC_INCLUDES = &quot;SYS$DISK:[-],SYS$DISK:[-.CRYPTO]&quot;
+$ CC_INCLUDES = &quot;SYS$DISK:[],SYS$DISK:[-],SYS$DISK:[-.CRYPTO]&quot;
 $!
 $! Check To See If P1 Is Blank.
 $!
@@ -1060,10 +1069,12 @@ $ __HERE = F$PARSE(F$PARSE(&quot;A.;&quot;,F$ENVIRONMENT(&quot;PROCEDURE&quot;))-&quot;A.;&quot;,&quot;[]A.;&quot;) - &quot;A
 $ __HERE = F$EDIT(__HERE,&quot;UPCASE&quot;)
 $ __TOP = __HERE - &quot;TEST]&quot;
 $ __INCLUDE = __TOP + &quot;INCLUDE.OPENSSL]&quot;
+$ __INTERNAL = __TOP + &quot;CRYPTO.INCLUDE.INTERNAL]&quot;
 $!
 $! Set up the logical name OPENSSL to point at the include directory
 $!
 $ DEFINE OPENSSL /NOLOG '__INCLUDE'
+$ DEFINE INTERNAL /NOLOG '__INTERNAL'
 $!
 $! Done
 $!
@@ -1076,6 +1087,7 @@ $!
 $ IF __SAVE_OPENSSL .EQS. &quot;&quot;
 $ THEN
 $   DEASSIGN OPENSSL
+$   DEASSIGN INTERNAL
 $ ELSE
 $   DEFINE /NOLOG OPENSSL '__SAVE_OPENSSL'
 $ ENDIF
diff --git a/test/tests.com b/test/tests.com
index 62be1e7..ba947be 100644
--- a/test/tests.com
+++ b/test/tests.com
@@ -27,6 +27,7 @@ $	endif
 $!
 $	texe_dir := sys$disk:[-.'__archd'.exe.test]
 $	exe_dir := sys$disk:[-.'__archd'.exe.apps]
+$	engines_dir := sys$disk:[-.'__archd'.exe.engines]
 $
 $	set default '__here'
 $
@@ -51,47 +52,55 @@ $! if there's a difference that needs to be taken care of.
 $	    tests := -
 	test_des,test_idea,test_sha,test_md4,test_md5,test_hmac,-
 	test_md2,test_mdc2,test_wp,-
-	test_rmd,test_rc2,test_rc4,test_rc5,test_bf,test_cast,test_aes,-
+	test_rmd,test_rc2,test_rc4,test_rc5,test_bf,test_cast,-
 	test_rand,test_bn,test_ec,test_ecdsa,test_ecdh,-
 	test_enc,test_x509,test_rsa,test_crl,test_sid,-
 	test_gen,test_req,test_pkcs7,test_verify,test_dh,test_dsa,-
 	test_ss,test_ca,test_engine,test_evp,test_ssl,test_tsa,test_ige,-
-	test_jpake,test_srp,test_cms
+	test_jpake,test_srp,test_cms,test_v3name,test_ocsp,-
+	test_gost2814789,test_heartbeat,test_p5_crpt2,-
+	test_constant_time
 $	endif
 $	tests = f$edit(tests,&quot;COLLAPSE&quot;)
 $
-$	BNTEST :=	bntest
-$	ECTEST :=	ectest
-$	ECDSATEST :=	ecdsatest
-$	ECDHTEST :=	ecdhtest
-$	EXPTEST :=	exptest
-$	IDEATEST :=	ideatest
-$	SHATEST :=	shatest
-$	SHA1TEST :=	sha1test
-$	MDC2TEST :=	mdc2test
-$	RMDTEST :=	rmdtest
-$	MD2TEST :=	md2test
-$	MD4TEST :=	md4test
-$	MD5TEST :=	md5test
-$	HMACTEST :=	hmactest
-$	WPTEST :=	wp_test
-$	RC2TEST :=	rc2test
-$	RC4TEST :=	rc4test
-$	RC5TEST :=	rc5test
-$	BFTEST :=	bftest
-$	CASTTEST :=	casttest
-$	DESTEST :=	destest
-$	RANDTEST :=	randtest
-$	DHTEST :=	dhtest
-$	DSATEST :=	dsatest
-$	METHTEST :=	methtest
-$	SSLTEST :=	ssltest
-$	RSATEST :=	rsa_test
-$	ENGINETEST :=	enginetest
-$	EVPTEST :=	evp_test
-$	IGETEST :=	igetest
-$	JPAKETEST :=	jpaketest
-$	SRPTEST :=	srptest
+$	BNTEST :=		bntest
+$	ECTEST :=		ectest
+$	ECDSATEST :=		ecdsatest
+$	ECDHTEST :=		ecdhtest
+$	EXPTEST :=		exptest
+$	IDEATEST :=		ideatest
+$	SHA1TEST :=		sha1test
+$	SHA256TEST :=		sha256t
+$	SHA512TEST :=		sha512t
+$	MDC2TEST :=		mdc2test
+$	RMDTEST :=		rmdtest
+$	MD2TEST :=		md2test
+$	MD4TEST :=		md4test
+$	MD5TEST :=		md5test
+$	HMACTEST :=		hmactest
+$	WPTEST :=		wp_test
+$	RC2TEST :=		rc2test
+$	RC4TEST :=		rc4test
+$	RC5TEST :=		rc5test
+$	BFTEST :=		bftest
+$	CASTTEST :=		casttest
+$	DESTEST :=		destest
+$	RANDTEST :=		randtest
+$	DHTEST :=		dhtest
+$	DSATEST :=		dsatest
+$	METHTEST :=		methtest
+$	SSLTEST :=		ssltest
+$	RSATEST :=		rsa_test
+$	ENGINETEST :=		enginetest
+$	GOST2814789TEST :=	gost2814789test
+$	EVPTEST :=		evp_test
+$	P5_CRPT2_TEST :=	p5_crpt2_test
+$	IGETEST :=		igetest
+$	JPAKETEST :=		jpaketest
+$	SRPTEST :=		srptest
+$	V3NAMETEST :=		v3nametest
+$	HEARTBEATTEST :=	heartbeat_test
+$	CONSTTIMETEST :=	constant_time_test
 $!
 $	tests_i = 0
 $ loop_tests:
@@ -105,6 +114,9 @@ $
 $ test_evp:
 $	mcr 'texe_dir''evptest' 'ROOT'.CRYPTO.EVP]evptests.txt
 $	return
+$ test_p5_crpt2:
+$	mcr 'texe_dir''p5_crpt2_test'
+$	return
 $ test_des:
 $	mcr 'texe_dir''destest'
 $	return
@@ -112,8 +124,9 @@ $ test_idea:
 $	mcr 'texe_dir''ideatest'
 $	return
 $ test_sha:
-$	mcr 'texe_dir''shatest'
 $	mcr 'texe_dir''sha1test'
+$	mcr 'texe_dir''sha256test'
+$	mcr 'texe_dir''sha512test'
 $	return
 $ test_mdc2:
 $	mcr 'texe_dir''mdc2test'
@@ -154,6 +167,10 @@ $	return
 $ test_rand:
 $	mcr 'texe_dir''randtest'
 $	return
+$ test_gost2814789:
+$	define/user OPENSSL_ENGINES 'engines_dir'
+$	mcr 'texe_dir''gost2814789test'
+$	return
 $ test_enc:
 $	@testenc.com 'pointer_size'
 $	return
@@ -361,7 +378,21 @@ $ test_srp:
 $	write sys$output &quot;Test SRP&quot;
 $	mcr 'texe_dir''srptest'
 $	return
-$
+$ test_v3name:
+$	write sys$output &quot;Test X509v3_check_*&quot;
+$	mcr 'texe_dir''v3nametest'
+$	return
+$ test_ocsp:
+$	write sys$output &quot;Test OCSP&quot;
+$	@tocsp.com
+$	return
+$ test_heartbeat:
+$	mcr 'texe_dir''heartbeattest'
+$	return
+$ test_constant_time:
+$	write sys$output &quot;Test constant time utilites&quot;
+$	mcr 'texe_dir''consttimetest'
+$	return
 $
 $ exit:
 $	mcr 'exe_dir'openssl version -a
diff --git a/test/tocsp.com b/test/tocsp.com
new file mode 100644
index 0000000..97253fe
--- /dev/null
+++ b/test/tocsp.com
@@ -0,0 +1,165 @@
+$! TOCSP.COM  --  Test ocsp
+$
+$	__arch = &quot;VAX&quot;
+$       if f$getsyi(&quot;cpu&quot;) .ge. 128 then -
+           __arch = f$edit( f$getsyi( &quot;ARCH_NAME&quot;), &quot;UPCASE&quot;)
+$       if __arch .eqs. &quot;&quot; then __arch = &quot;UNK&quot;
+$!
+$       if (p2 .eqs. &quot;64&quot;) then __arch = __arch+ &quot;_64&quot;
+$!
+$       exe_dir = &quot;sys$disk:[-.''__arch'.exe.apps]&quot;
+$
+$       cmd = &quot;mcr ''f$parse(exe_dir+&quot;openssl.exe&quot;)'&quot;
+$	ocspdir = &quot;ocsp-tests&quot;
+$
+$!	17 December 2012 so we don't get certificate expiry errors.
+$	check_time=&quot;-attime 1355875200&quot;
+$
+$ test_ocsp:
+$	subroutine
+$		'cmd' base64 -d -in [.'ocspdir']'p1' -out ocsp-test.test-bin
+$		'cmd' ocsp -respin ocsp-test.test-bin -partial_chain 'check_time' -
+		      &quot;-CAfile&quot; [.'ocspdir']'p2' -verify_other [.'ocspdir']'p2' &quot;-CApath&quot; NLA0:
+$		if $severity .ne. p3+1
+$		then
+$		    write sys$error &quot;OCSP test failed!&quot;
+$		    exit 3
+$		endif
+$	endsubroutine
+$
+$	set noon
+$
+$	write sys$output &quot;=== VALID OCSP RESPONSES ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND1.ors&quot; &quot;ND1_Issuer_ICA.pem&quot; 0
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ND2.ors&quot; &quot;ND2_Issuer_Root.pem&quot; 0
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND3.ors&quot; &quot;ND3_Issuer_Root.pem&quot; 0
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 0
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 0
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 0
+$	
+$	write sys$output &quot;=== INVALID SIGNATURE on the OCSP RESPONSE ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ISOP_ND1.ors&quot; &quot;ND1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ISOP_ND2.ors&quot; &quot;ND2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ISOP_ND3.ors&quot; &quot;ND3_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ISOP_D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ISOP_D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ISOP_D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== WRONG RESPONDERID in the OCSP RESPONSE ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WRID_ND1.ors&quot; &quot;ND1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WRID_ND2.ors&quot; &quot;ND2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WRID_ND3.ors&quot; &quot;ND3_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WRID_D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WRID_D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WRID_D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== WRONG ISSUERNAMEHASH in the OCSP RESPONSE ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WINH_ND1.ors&quot; &quot;ND1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WINH_ND2.ors&quot; &quot;ND2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WINH_ND3.ors&quot; &quot;ND3_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WINH_D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WINH_D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WINH_D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== WRONG ISSUERKEYHASH in the OCSP RESPONSE ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WIKH_ND1.ors&quot; &quot;ND1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WIKH_ND2.ors&quot; &quot;ND2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WIKH_ND3.ors&quot; &quot;ND3_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WIKH_D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WIKH_D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WIKH_D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== WRONG KEY in the DELEGATED OCSP SIGNING CERTIFICATE ===&quot;
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;WKDOSC_D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;WKDOSC_D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;WKDOSC_D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== INVALID SIGNATURE on the DELEGATED OCSP SIGNING CERTIFICATE ===&quot;
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ISDOSC_D1.ors&quot; &quot;D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ISDOSC_D2.ors&quot; &quot;D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ISDOSC_D3.ors&quot; &quot;D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== WRONG SUBJECT NAME in the ISSUER CERTIFICATE ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND1.ors&quot; &quot;WSNIC_ND1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ND2.ors&quot; &quot;WSNIC_ND2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND3.ors&quot; &quot;WSNIC_ND3_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;D1.ors&quot; &quot;WSNIC_D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;D2.ors&quot; &quot;WSNIC_D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;D3.ors&quot; &quot;WSNIC_D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== WRONG KEY in the ISSUER CERTIFICATE ===&quot;
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND1.ors&quot; &quot;WKIC_ND1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ND2.ors&quot; &quot;WKIC_ND2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND3.ors&quot; &quot;WKIC_ND3_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;D1.ors&quot; &quot;WKIC_D1_Issuer_ICA.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;D2.ors&quot; &quot;WKIC_D2_Issuer_Root.pem&quot; 1
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;D3.ors&quot; &quot;WKIC_D3_Issuer_Root.pem&quot; 1
+$	
+$	write sys$output &quot;=== INVALID SIGNATURE on the ISSUER CERTIFICATE ===&quot;
+$!	Expect success, because we're explicitly trusting the issuer certificate.
+$	write sys$output &quot;NON-DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND1.ors&quot; &quot;ISIC_ND1_Issuer_ICA.pem&quot; 0
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;ND2.ors&quot; &quot;ISIC_ND2_Issuer_Root.pem&quot; 0
+$	write sys$output &quot;NON-DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;ND3.ors&quot; &quot;ISIC_ND3_Issuer_Root.pem&quot; 0
+$	write sys$output &quot;DELEGATED; Intermediate CA -&gt; EE&quot;
+$	call test_ocsp &quot;D1.ors&quot; &quot;ISIC_D1_Issuer_ICA.pem&quot; 0
+$	write sys$output &quot;DELEGATED; Root CA -&gt; Intermediate CA&quot;
+$	call test_ocsp &quot;D2.ors&quot; &quot;ISIC_D2_Issuer_Root.pem&quot; 0
+$	write sys$output &quot;DELEGATED; Root CA -&gt; EE&quot;
+$	call test_ocsp &quot;D3.ors&quot; &quot;ISIC_D3_Issuer_Root.pem&quot; 0
+$	
+$	write sys$output &quot;ALL OCSP TESTS SUCCESSFUL&quot;
+$
+$	set on
+$	
+$	exit
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000355.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="000360.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#358">[ date ]</a>
              <a href="thread.html#358">[ thread ]</a>
              <a href="subject.html#358">[ subject ]</a>
              <a href="author.html#358">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
