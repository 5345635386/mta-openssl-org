<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2019-October/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1572528052.476194.29557.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025882.html">
   <LINK REL="Next"  HREF="025889.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>tmraz at fedoraproject.org</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1572528052.476194.29557.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">tmraz at fedoraproject.org
       </A><BR>
    <I>Thu Oct 31 13:20:52 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="025882.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="025889.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25888">[ date ]</a>
              <a href="thread.html#25888">[ thread ]</a>
              <a href="subject.html#25888">[ subject ]</a>
              <a href="author.html#25888">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  9fcb9702fba8aa135945f96aefddf050a6f4f11d (commit)
      from  fb1ecf85c9f732e5827771ff243d7a70e06ce112 (commit)


- Log -----------------------------------------------------------------
commit 9fcb9702fba8aa135945f96aefddf050a6f4f11d
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at akamai.com</A>&gt;
Date:   Sat Oct 12 17:45:56 2019 -0400

    Infrastructure for templated doc in POD files
    
    Use new doc-build capabilities
    Add -i flag to dofile.
    Add doc/man1 to SUBDIRS for the new templated doc files
    Rewrite commit a397aca (merged from PR 10118) to use the doc-template stuff.
    Put template references in common place
    Template options and text come at the end of command-specific options:
    opt_x, opt_trust, opt_r (in that order).
    Refactor xchain options.
    Do doc-nits after building generated sources.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/10159">https://github.com/openssl/openssl/pull/10159</A>)

-----------------------------------------------------------------------

Summary of changes:
 .gitignore                                         |  29 +++++
 .travis.yml                                        |   8 +-
 build.info                                         |   3 +-
 doc/man1/build.info                                |  84 ++++++++++++++
 doc/man1/{openssl-ca.pod =&gt; openssl-ca.pod.in}     |  14 ++-
 doc/man1/{openssl-cms.pod =&gt; openssl-cms.pod.in}   |  35 +++---
 doc/man1/{openssl-crl.pod =&gt; openssl-crl.pod.in}   |  14 +--
 doc/man1/{openssl-dgst.pod =&gt; openssl-dgst.pod.in} |  14 ++-
 ...{openssl-dhparam.pod =&gt; openssl-dhparam.pod.in} |  14 ++-
 ...penssl-dsaparam.pod =&gt; openssl-dsaparam.pod.in} |  14 ++-
 ...{openssl-ecparam.pod =&gt; openssl-ecparam.pod.in} |  14 ++-
 doc/man1/{openssl-enc.pod =&gt; openssl-enc.pod.in}   |  12 +-
 .../{openssl-gendsa.pod =&gt; openssl-gendsa.pod.in}  |  14 ++-
 .../{openssl-genrsa.pod =&gt; openssl-genrsa.pod.in}  |  14 ++-
 doc/man1/{openssl-ocsp.pod =&gt; openssl-ocsp.pod.in} |  16 +--
 .../{openssl-passwd.pod =&gt; openssl-passwd.pod.in}  |  12 +-
 .../{openssl-pkcs12.pod =&gt; openssl-pkcs12.pod.in}  |  25 ++--
 .../{openssl-pkcs8.pod =&gt; openssl-pkcs8.pod.in}    |  14 ++-
 ...{openssl-pkeyutl.pod =&gt; openssl-pkeyutl.pod.in} |  14 ++-
 doc/man1/{openssl-rand.pod =&gt; openssl-rand.pod.in} |  14 ++-
 doc/man1/{openssl-req.pod =&gt; openssl-req.pod.in}   |  14 ++-
 .../{openssl-rsautl.pod =&gt; openssl-rsautl.pod.in}  |  14 ++-
 ...penssl-s_client.pod =&gt; openssl-s_client.pod.in} |  64 ++++------
 ...penssl-s_server.pod =&gt; openssl-s_server.pod.in} |  56 +++------
 .../{openssl-s_time.pod =&gt; openssl-s_time.pod.in}  |  16 +--
 .../{openssl-smime.pod =&gt; openssl-smime.pod.in}    |  25 ++--
 .../{openssl-speed.pod =&gt; openssl-speed.pod.in}    |  14 ++-
 doc/man1/{openssl-srp.pod =&gt; openssl-srp.pod.in}   |  12 +-
 doc/man1/{openssl-ts.pod =&gt; openssl-ts.pod.in}     |  14 ++-
 .../{openssl-verify.pod =&gt; openssl-verify.pod.in}  |  16 +--
 doc/man1/{openssl-x509.pod =&gt; openssl-x509.pod.in} |  14 ++-
 doc/man1/openssl.pod                               |  36 +++++-
 doc/perlvars.pm                                    | 129 +++++++++++++++++++++
 util/dofile.pl                                     |  61 +++++++---
 34 files changed, 571 insertions(+), 292 deletions(-)
 create mode 100644 doc/man1/build.info
 rename doc/man1/{openssl-ca.pod =&gt; openssl-ca.pod.in} (99%)
 rename doc/man1/{openssl-cms.pod =&gt; openssl-cms.pod.in} (98%)
 rename doc/man1/{openssl-crl.pod =&gt; openssl-crl.pod.in} (91%)
 rename doc/man1/{openssl-dgst.pod =&gt; openssl-dgst.pod.in} (97%)
 rename doc/man1/{openssl-dhparam.pod =&gt; openssl-dhparam.pod.in} (96%)
 rename doc/man1/{openssl-dsaparam.pod =&gt; openssl-dsaparam.pod.in} (94%)
 rename doc/man1/{openssl-ecparam.pod =&gt; openssl-ecparam.pod.in} (96%)
 rename doc/man1/{openssl-enc.pod =&gt; openssl-enc.pod.in} (98%)
 rename doc/man1/{openssl-gendsa.pod =&gt; openssl-gendsa.pod.in} (93%)
 rename doc/man1/{openssl-genrsa.pod =&gt; openssl-genrsa.pod.in} (95%)
 rename doc/man1/{openssl-ocsp.pod =&gt; openssl-ocsp.pod.in} (98%)
 rename doc/man1/{openssl-passwd.pod =&gt; openssl-passwd.pod.in} (94%)
 rename doc/man1/{openssl-pkcs12.pod =&gt; openssl-pkcs12.pod.in} (96%)
 rename doc/man1/{openssl-pkcs8.pod =&gt; openssl-pkcs8.pod.in} (98%)
 rename doc/man1/{openssl-pkeyutl.pod =&gt; openssl-pkeyutl.pod.in} (98%)
 rename doc/man1/{openssl-rand.pod =&gt; openssl-rand.pod.in} (86%)
 rename doc/man1/{openssl-req.pod =&gt; openssl-req.pod.in} (99%)
 rename doc/man1/{openssl-rsautl.pod =&gt; openssl-rsautl.pod.in} (97%)
 rename doc/man1/{openssl-s_client.pod =&gt; openssl-s_client.pod.in} (95%)
 rename doc/man1/{openssl-s_server.pod =&gt; openssl-s_server.pod.in} (95%)
 rename doc/man1/{openssl-s_time.pod =&gt; openssl-s_time.pod.in} (96%)
 rename doc/man1/{openssl-smime.pod =&gt; openssl-smime.pod.in} (97%)
 rename doc/man1/{openssl-speed.pod =&gt; openssl-speed.pod.in} (94%)
 rename doc/man1/{openssl-srp.pod =&gt; openssl-srp.pod.in} (92%)
 rename doc/man1/{openssl-ts.pod =&gt; openssl-ts.pod.in} (99%)
 rename doc/man1/{openssl-verify.pod =&gt; openssl-verify.pod.in} (99%)
 rename doc/man1/{openssl-x509.pod =&gt; openssl-x509.pod.in} (99%)
 create mode 100644 doc/perlvars.pm

diff --git a/.gitignore b/.gitignore
index f035ab1975..fa57dfcb38 100644
--- a/.gitignore
+++ b/.gitignore
@@ -25,6 +25,35 @@
 /include/openssl/opensslconf.h
 /include/openssl/opensslv.h
 
+# Auto generated doc files
+doc/man1/openssl-ca.pod
+doc/man1/openssl-cms.pod
+doc/man1/openssl-crl.pod
+doc/man1/openssl-dgst.pod
+doc/man1/openssl-dhparam.pod
+doc/man1/openssl-dsaparam.pod
+doc/man1/openssl-ecparam.pod
+doc/man1/openssl-enc.pod
+doc/man1/openssl-gendsa.pod
+doc/man1/openssl-genrsa.pod
+doc/man1/openssl-ocsp.pod
+doc/man1/openssl-passwd.pod
+doc/man1/openssl-pkcs12.pod
+doc/man1/openssl-pkcs8.pod
+doc/man1/openssl-pkeyutl.pod
+doc/man1/openssl-rand.pod
+doc/man1/openssl-req.pod
+doc/man1/openssl-rsautl.pod
+doc/man1/openssl-s_client.pod
+doc/man1/openssl-s_server.pod
+doc/man1/openssl-s_time.pod
+doc/man1/openssl-smime.pod
+doc/man1/openssl-speed.pod
+doc/man1/openssl-srp.pod
+doc/man1/openssl-ts.pod
+doc/man1/openssl-verify.pod
+doc/man1/openssl-x509.pod
+
 # error code files
 /crypto/err/openssl.txt.old
 /engines/e_afalg.txt.old
diff --git a/.travis.yml b/.travis.yml
index 9f616c7e00..4b104642ff 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -177,14 +177,14 @@ script:
           echo -e '\052\052 FAILED -- UPDATED FILES NOT COMMITED';
           travis_terminate 1;
       fi
-    - if test -n &quot;$CHECKDOCS&quot; &amp;&amp; ! $make doc-nits; then
-          echo -e '\052\052 FAILED -- MAKE DOC-NITS';
-          travis_terminate 1;
-      fi
     - if test -n &quot;$GENERATE&quot; &amp;&amp; ! $make build_all_generated; then
           echo -e '\052\052 FAILED -- MAKE BUILD_ALL_GENERATED';
           travis_terminate 1;
       fi
+    - if test -n &quot;$CHECKDOCS&quot; &amp;&amp; ! $make doc-nits; then
+          echo -e '\052\052 FAILED -- MAKE DOC-NITS';
+          travis_terminate 1;
+      fi
     - if ! $make2; then
           echo -e '\052\052 FAILED -- MAKE';
           travis_terminate 1;
diff --git a/build.info b/build.info
index 6b70b11006..a050ae9530 100644
--- a/build.info
+++ b/build.info
@@ -1,6 +1,6 @@
 # Note that some of these directories are filtered in Configure.  Look for
 # %skipdir there for further explanations.
-SUBDIRS=crypto ssl apps test util tools fuzz engines providers
+SUBDIRS=crypto ssl apps test util tools fuzz engines providers doc/man1
 
 LIBS=libcrypto libssl
 INCLUDE[libcrypto]=. include
@@ -12,6 +12,7 @@ DEPEND[libssl]=libcrypto
 DEPEND[]=include/openssl/opensslconf.h include/openssl/opensslv.h \
          include/crypto/bn_conf.h include/crypto/dso_conf.h \
          doc/man7/openssl_user_macros.pod
+
 GENERATE[include/openssl/opensslconf.h]=include/openssl/opensslconf.h.in
 GENERATE[include/openssl/opensslv.h]=include/openssl/opensslv.h.in
 GENERATE[include/crypto/bn_conf.h]=include/crypto/bn_conf.h.in
diff --git a/doc/man1/build.info b/doc/man1/build.info
new file mode 100644
index 0000000000..aed1f948d5
--- /dev/null
+++ b/doc/man1/build.info
@@ -0,0 +1,84 @@
+
+DEPEND[]= \
+         openssl-ca.pod \
+         openssl-cms.pod \
+         openssl-crl.pod \
+         openssl-dgst.pod \
+         openssl-dhparam.pod \
+         openssl-dsaparam.pod \
+         openssl-ecparam.pod \
+         openssl-enc.pod \
+         openssl-gendsa.pod \
+         openssl-genrsa.pod \
+         openssl-ocsp.pod \
+         openssl-passwd.pod \
+         openssl-pkcs12.pod \
+         openssl-pkcs8.pod \
+         openssl-pkeyutl.pod \
+         openssl-rand.pod \
+         openssl-req.pod \
+         openssl-rsautl.pod \
+         openssl-s_client.pod \
+         openssl-s_server.pod \
+         openssl-s_time.pod \
+         openssl-smime.pod \
+         openssl-speed.pod \
+         openssl-srp.pod \
+         openssl-ts.pod \
+         openssl-verify.pod \
+         openssl-x509.pod
+
+DEPEND[openssl-ca.pod]=../perlvars.pm
+GENERATE[openssl-ca.pod]=openssl-ca.pod.in
+DEPEND[openssl-cms.pod]=../perlvars.pm
+GENERATE[openssl-cms.pod]=openssl-cms.pod.in
+DEPEND[openssl-crl.pod]=../perlvars.pm
+GENERATE[openssl-crl.pod]=openssl-crl.pod.in
+DEPEND[openssl-dgst.pod]=../perlvars.pm
+GENERATE[openssl-dgst.pod]=openssl-dgst.pod.in
+DEPEND[openssl-dhparam.pod]=../perlvars.pm
+GENERATE[openssl-dhparam.pod]=openssl-dhparam.pod.in
+DEPEND[openssl-dsaparam.pod]=../perlvars.pm
+GENERATE[openssl-dsaparam.pod]=openssl-dsaparam.pod.in
+DEPEND[openssl-ecparam.pod]=../perlvars.pm
+GENERATE[openssl-ecparam.pod]=openssl-ecparam.pod.in
+DEPEND[openssl-enc.pod]=../perlvars.pm
+GENERATE[openssl-enc.pod]=openssl-enc.pod.in
+DEPEND[openssl-gendsa.pod]=../perlvars.pm
+GENERATE[openssl-gendsa.pod]=openssl-gendsa.pod.in
+DEPEND[openssl-genrsa.pod]=../perlvars.pm
+GENERATE[openssl-genrsa.pod]=openssl-genrsa.pod.in
+DEPEND[openssl-ocsp.pod]=../perlvars.pm
+GENERATE[openssl-ocsp.pod]=openssl-ocsp.pod.in
+DEPEND[openssl-passwd.pod]=../perlvars.pm
+GENERATE[openssl-passwd.pod]=openssl-passwd.pod.in
+DEPEND[openssl-pkcs8.pod]=../perlvars.pm
+GENERATE[openssl-pkcs8.pod]=openssl-pkcs8.pod.in
+DEPEND[openssl-pkcs12.pod]=../perlvars.pm
+GENERATE[openssl-pkcs12.pod]=openssl-pkcs12.pod.in
+DEPEND[openssl-pkeyutl.pod]=../perlvars.pm
+GENERATE[openssl-pkeyutl.pod]=openssl-pkeyutl.pod.in
+DEPEND[openssl-rand.pod]=../perlvars.pm
+GENERATE[openssl-rand.pod]=openssl-rand.pod.in
+DEPEND[openssl-req.pod]=../perlvars.pm
+GENERATE[openssl-req.pod]=openssl-req.pod.in
+DEPEND[openssl-rsautl.pod]=../perlvars.pm
+GENERATE[openssl-rsautl.pod]=openssl-rsautl.pod.in
+DEPEND[openssl-s_client.pod]=../perlvars.pm
+GENERATE[openssl-s_client.pod]=openssl-s_client.pod.in
+DEPEND[openssl-s_server.pod]=../perlvars.pm
+GENERATE[openssl-s_server.pod]=openssl-s_server.pod.in
+DEPEND[openssl-s_time.pod]=../perlvars.pm
+GENERATE[openssl-s_time.pod]=openssl-s_time.pod.in
+DEPEND[openssl-smime.pod]=../perlvars.pm
+GENERATE[openssl-smime.pod]=openssl-smime.pod.in
+DEPEND[openssl-speed.pod]=../perlvars.pm
+GENERATE[openssl-speed.pod]=openssl-speed.pod.in
+DEPEND[openssl-srp.pod]=../perlvars.pm
+GENERATE[openssl-srp.pod]=openssl-srp.pod.in
+DEPEND[openssl-ts.pod]=../perlvars.pm
+GENERATE[openssl-ts.pod]=openssl-ts.pod.in
+DEPEND[openssl-verify.pod]=../perlvars.pm
+GENERATE[openssl-verify.pod]=openssl-verify.pod.in
+DEPEND[openssl-x509.pod]=../perlvars.pm
+GENERATE[openssl-x509.pod]=openssl-x509.pod.in
diff --git a/doc/man1/openssl-ca.pod b/doc/man1/openssl-ca.pod.in
similarity index 99%
rename from doc/man1/openssl-ca.pod
rename to doc/man1/openssl-ca.pod.in
index e3d6c7b17c..81d1186d23 100644
--- a/doc/man1/openssl-ca.pod
+++ b/doc/man1/openssl-ca.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-ca - sample minimal CA application
@@ -54,10 +59,9 @@ B&lt;openssl&gt; B&lt;ca&gt;
 [B&lt;-create_serial&gt;]
 [B&lt;-rand_serial&gt;]
 [B&lt;-multivalue-rdn&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-sm2-id&gt; I&lt;string&gt;]
 [B&lt;-sm2-hex-id&gt; I&lt;hex-string&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine sm2-id sm2-hex-id
 
@@ -294,10 +298,6 @@ C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
 
 If B&lt;-multi-rdn&gt; is not used then the UID value is C&lt;123456+CN=John Doe&gt;.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-sm2-id&gt; I&lt;string&gt;
 
 Specify the ID string to use when verifying an SM2 certificate. The ID string is
@@ -308,6 +308,8 @@ required by the SM2 signature algorithm for signing and verification.
 Specify a binary ID string to use when signing or verifying using an SM2
 certificate. The argument for this option is string of hexadecimal digits.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 CRL OPTIONS
diff --git a/doc/man1/openssl-cms.pod b/doc/man1/openssl-cms.pod.in
similarity index 98%
rename from doc/man1/openssl-cms.pod
rename to doc/man1/openssl-cms.pod.in
index ff601cc548..3d8bcd792e 100644
--- a/doc/man1/openssl-cms.pod
+++ b/doc/man1/openssl-cms.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-cms - CMS utility
@@ -38,10 +43,6 @@ B&lt;openssl&gt; B&lt;cms&gt;
 [B&lt;-text&gt;]
 [B&lt;-noout&gt;]
 [B&lt;-print&gt;]
-[B&lt;-CAfile&gt; I&lt;file&gt;]
-[B&lt;-CApath&gt; I&lt;dir&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-attime&gt; I&lt;timestamp&gt;]
 [B&lt;-check_ss_sig&gt;]
 [B&lt;-crl_check&gt;]
@@ -97,11 +98,11 @@ B&lt;openssl&gt; B&lt;cms&gt;
 [B&lt;-inkey&gt; I&lt;file&gt;]
 [B&lt;-keyopt&gt; I&lt;name&gt;:I&lt;parameter&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-to&gt; I&lt;addr&gt;]
 [B&lt;-from&gt; I&lt;addr&gt;]
 [B&lt;-subject&gt; I&lt;subj&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;cert.pem&gt; ...]
 
 =for openssl ifdef des-wrap engine
@@ -286,10 +287,6 @@ structure is being checked.
 For the B&lt;-cmsout&gt; operation print out all fields of the CMS structure. This
 is mainly useful for testing purposes.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-md&gt; I&lt;digest&gt;
 
 Digest algorithm to use when signing or resigning. If not present then the
@@ -462,15 +459,6 @@ or to modify default parameters for ECDH.
 The private key password source. For more information about the format of B&lt;arg&gt;
 see L&lt;openssl(1)/Pass Phrase Options&gt;.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
-=item I&lt;cert.pem&gt; ...
-
-One or more certificates of message recipients: used when encrypting
-a message.
-
 =item B&lt;-to&gt;, B&lt;-from&gt;, B&lt;-subject&gt;
 
 The relevant mail headers. These are included outside the signed
@@ -489,6 +477,15 @@ B&lt;-verify_ip&gt;, B&lt;-verify_name&gt;, B&lt;-x509_strict&gt;
 Set various certificate chain validation options. See the
 L&lt;openssl-verify(1)&gt; manual page for details.
 
+{- $OpenSSL::safe::opt_trust_item -}
+
+{- $OpenSSL::safe::opt_r_item -}
+
+=item I&lt;cert.pem&gt; ...
+
+One or more certificates of message recipients: used when encrypting
+a message.
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-crl.pod b/doc/man1/openssl-crl.pod.in
similarity index 91%
rename from doc/man1/openssl-crl.pod
rename to doc/man1/openssl-crl.pod.in
index 911af026bb..7441de446c 100644
--- a/doc/man1/openssl-crl.pod
+++ b/doc/man1/openssl-crl.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-crl - CRL utility
@@ -20,10 +25,7 @@ B&lt;openssl&gt; B&lt;crl&gt;
 [B&lt;-issuer&gt;]
 [B&lt;-lastupdate&gt;]
 [B&lt;-nextupdate&gt;]
-[B&lt;-CAfile&gt; I&lt;file&gt;]
-[B&lt;-CApath&gt; I&lt;dir&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
 
 =for openssl ifdef hash_old
 
@@ -94,9 +96,7 @@ Output the lastUpdate field.
 
 Output the nextUpdate field.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
+{- $OpenSSL::safe::opt_trust_item -}
 
 =back
 
diff --git a/doc/man1/openssl-dgst.pod b/doc/man1/openssl-dgst.pod.in
similarity index 97%
rename from doc/man1/openssl-dgst.pod
rename to doc/man1/openssl-dgst.pod.in
index 7ea47480bc..75187ffe2c 100644
--- a/doc/man1/openssl-dgst.pod
+++ b/doc/man1/openssl-dgst.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-dgst - perform digest operations
@@ -25,10 +30,9 @@ B&lt;openssl&gt; B&lt;dgst&gt;|I&lt;digest&gt;
 [B&lt;-sigopt&gt; I&lt;nm&gt;:I&lt;v&gt;]
 [B&lt;-hmac&gt; I&lt;key&gt;]
 [B&lt;-fips-fingerprint&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-engine_impl&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;file&gt; ...]
 
 =head1 DESCRIPTION
@@ -164,10 +168,6 @@ for example exactly 32 chars for gost-mac.
 The L&lt;openssl-mac(1)&gt; command should be preferred to using this command line
 option.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-fips-fingerprint&gt;
 
 Compute HMAC using a specific key for certain OpenSSL-FIPS operations.
@@ -184,6 +184,8 @@ specified.
 When used with the B&lt;-engine&gt; option, it specifies to also use
 engine I&lt;id&gt; for digest operations.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =item I&lt;file&gt; ...
 
 File or files to digest. If no files are specified then standard input is
diff --git a/doc/man1/openssl-dhparam.pod b/doc/man1/openssl-dhparam.pod.in
similarity index 96%
rename from doc/man1/openssl-dhparam.pod
rename to doc/man1/openssl-dhparam.pod.in
index cbd52b00fb..9ae5006b1e 100644
--- a/doc/man1/openssl-dhparam.pod
+++ b/doc/man1/openssl-dhparam.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-dhparam - DH parameter manipulation and generation
@@ -20,9 +25,8 @@ B&lt;openssl dhparam&gt;
 [B&lt;-2&gt;]
 [B&lt;-3&gt;]
 [B&lt;-5&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;numbits&gt;]
 
 =for openssl ifdef dsaparam engine
@@ -80,10 +84,6 @@ input file is ignored and parameters are generated instead. If not
 present but I&lt;numbits&gt; is present, parameters are generated with the
 default generator 2.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item I&lt;numbits&gt;
 
 This option specifies that a parameter set should be generated of size
@@ -113,6 +113,8 @@ to attempt to obtain a functional reference to the specified engine,
 thus initialising it if needed. The engine will then be set as the default
 for all available algorithms.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 WARNINGS
diff --git a/doc/man1/openssl-dsaparam.pod b/doc/man1/openssl-dsaparam.pod.in
similarity index 94%
rename from doc/man1/openssl-dsaparam.pod
rename to doc/man1/openssl-dsaparam.pod.in
index 0c85ca0d1d..d23f48fd5b 100644
--- a/doc/man1/openssl-dsaparam.pod
+++ b/doc/man1/openssl-dsaparam.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-dsaparam - DSA parameter manipulation and generation
@@ -15,11 +20,10 @@ B&lt;openssl dsaparam&gt;
 [B&lt;-noout&gt;]
 [B&lt;-text&gt;]
 [B&lt;-C&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-genkey&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-verbose&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;numbits&gt;]
 
 =head1 DESCRIPTION
@@ -75,10 +79,6 @@ be loaded by calling the get_dsaXXX() function.
 This option will generate a DSA either using the specified or generated
 parameters.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-engine&gt; I&lt;id&gt;
 
 Specifying an engine (by its unique I&lt;id&gt; string) will cause this command
@@ -90,6 +90,8 @@ for all available algorithms.
 
 Print extra details about the operations being performed.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =item I&lt;numbits&gt;
 
 This option specifies that a parameter set should be generated of size
diff --git a/doc/man1/openssl-ecparam.pod b/doc/man1/openssl-ecparam.pod.in
similarity index 96%
rename from doc/man1/openssl-ecparam.pod
rename to doc/man1/openssl-ecparam.pod.in
index c761980953..1e262a4a81 100644
--- a/doc/man1/openssl-ecparam.pod
+++ b/doc/man1/openssl-ecparam.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-ecparam - EC parameter manipulation and generation
@@ -22,10 +27,9 @@ B&lt;openssl ecparam&gt;
 [B&lt;-conv_form&gt; I&lt;arg&gt;]
 [B&lt;-param_enc&gt; I&lt;arg&gt;]
 [B&lt;-no_seed&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-genkey&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine
 
@@ -122,10 +126,6 @@ is included in the ECParameters structure (see RFC 3279).
 
 This option will generate an EC private key using the specified parameters.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-engine&gt; I&lt;id&gt;
 
 Specifying an engine (by its unique I&lt;id&gt; string) will cause B&lt;ecparam&gt;
@@ -133,6 +133,8 @@ to attempt to obtain a functional reference to the specified engine,
 thus initialising it if needed. The engine will then be set as the default
 for all available algorithms.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 EXAMPLES
diff --git a/doc/man1/openssl-enc.pod b/doc/man1/openssl-enc.pod.in
similarity index 98%
rename from doc/man1/openssl-enc.pod
rename to doc/man1/openssl-enc.pod.in
index ced97e743e..842eb2a183 100644
--- a/doc/man1/openssl-enc.pod
+++ b/doc/man1/openssl-enc.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-enc - symmetric cipher routines
@@ -36,9 +41,8 @@ B&lt;openssl&gt; B&lt;enc&gt;|I&lt;cipher&gt;
 [B&lt;-nopad&gt;]
 [B&lt;-debug&gt;]
 [B&lt;-none&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef z engine
 
@@ -190,9 +194,7 @@ or zlib-dynamic option.
 
 Use NULL cipher (no encryption or decryption of input).
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
+{- $OpenSSL::safe::opt_r_item -}
 
 =back
 
diff --git a/doc/man1/openssl-gendsa.pod b/doc/man1/openssl-gendsa.pod.in
similarity index 93%
rename from doc/man1/openssl-gendsa.pod
rename to doc/man1/openssl-gendsa.pod.in
index 451a3c4835..d92f0dd7a8 100644
--- a/doc/man1/openssl-gendsa.pod
+++ b/doc/man1/openssl-gendsa.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-gendsa - generate a DSA private key from a set of parameters
@@ -21,10 +26,9 @@ B&lt;openssl&gt; B&lt;gendsa&gt;
 [B&lt;-des&gt;]
 [B&lt;-des3&gt;]
 [B&lt;-idea&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-verbose&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;paramfile&gt;]
 
 =for openssl ifdef engine
@@ -53,10 +57,6 @@ These options encrypt the private key with specified
 cipher before outputting it. A pass phrase is prompted for.
 If none of these options is specified no encryption is used.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-engine&gt; I&lt;id&gt;
 
 Specifying an engine (by its unique I&lt;id&gt; string) will cause this command
@@ -74,6 +74,8 @@ The DSA parameter file to use. The parameters in this file determine
 the size of the private key. DSA parameters can be generated and
 examined using the L&lt;openssl-dsaparam(1)&gt; command.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-genrsa.pod b/doc/man1/openssl-genrsa.pod.in
similarity index 95%
rename from doc/man1/openssl-genrsa.pod
rename to doc/man1/openssl-genrsa.pod.in
index d04c8eeb19..6239cd8bee 100644
--- a/doc/man1/openssl-genrsa.pod
+++ b/doc/man1/openssl-genrsa.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-genrsa - generate an RSA private key
@@ -23,11 +28,10 @@ B&lt;openssl&gt; B&lt;genrsa&gt;
 [B&lt;-des3&gt;]
 [B&lt;-idea&gt;]
 [B&lt;-f4&gt;|B&lt;-3&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-primes&gt; I&lt;num&gt;]
 [B&lt;-verbose&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [B&lt;numbits&gt;]
 
 =for openssl ifdef engine
@@ -65,10 +69,6 @@ for if it is not supplied via the B&lt;-passout&gt; argument.
 
 The public exponent to use, either 65537 or 3. The default is 65537.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-engine&gt; I&lt;id&gt;
 
 Specifying an engine (by its unique I&lt;id&gt; string) will cause this command
@@ -87,6 +87,8 @@ RSA key, which is defined in RFC 8017.
 
 Print extra details about the operations being performed.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =item B&lt;numbits&gt;
 
 The size of the private key to generate in bits. This must be the last option
diff --git a/doc/man1/openssl-ocsp.pod b/doc/man1/openssl-ocsp.pod.in
similarity index 98%
rename from doc/man1/openssl-ocsp.pod
rename to doc/man1/openssl-ocsp.pod.in
index 6fc077506f..a3358e724a 100644
--- a/doc/man1/openssl-ocsp.pod
+++ b/doc/man1/openssl-ocsp.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-ocsp - Online Certificate Status Protocol utility
@@ -30,10 +35,6 @@ B&lt;openssl&gt; B&lt;ocsp&gt;
 [B&lt;-multi&gt; I&lt;process-count&gt;]
 [B&lt;-header&gt;]
 [B&lt;-path&gt;]
-[B&lt;-CApath&gt; I&lt;dir&gt;]
-[B&lt;-CAfile&gt; I&lt;file&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-attime&gt; I&lt;timestamp&gt;]
 [B&lt;-check_ss_sig&gt;]
 [B&lt;-crl_check&gt;]
@@ -89,6 +90,7 @@ B&lt;openssl&gt; B&lt;ocsp&gt;
 [B&lt;-nrequest&gt; I&lt;n&gt;]
 [B&lt;-rcid&gt; I&lt;digest&gt;]
 [B&lt;-I&lt;digest&gt;&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
 
 =for openssl ifdef multi
 
@@ -207,10 +209,6 @@ each child is willing to wait for the client's OCSP response.
 This option is available on POSIX systems (that support the fork() and other
 required unix system-calls).
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-attime&gt;, B&lt;-check_ss_sig&gt;, B&lt;-crl_check&gt;, B&lt;-crl_check_all&gt;,
 B&lt;-explicit_policy&gt;, B&lt;-extended_crl&gt;, B&lt;-ignore_critical&gt;, B&lt;-inhibit_any&gt;,
 B&lt;-inhibit_map&gt;, B&lt;-no_alt_chains&gt;, B&lt;-no_check_time&gt;, B&lt;-partial_chain&gt;, B&lt;-policy&gt;,
@@ -310,6 +308,8 @@ OCSP request. Any digest supported by the OpenSSL B&lt;dgst&gt; command can be used.
 The default is SHA-1. This option may be used multiple times to specify the
 digest used by subsequent certificate identifiers.
 
+{- $OpenSSL::safe::opt_trust_item -}
+
 =back
 
 =head2 OCSP Server Options
diff --git a/doc/man1/openssl-passwd.pod b/doc/man1/openssl-passwd.pod.in
similarity index 94%
rename from doc/man1/openssl-passwd.pod
rename to doc/man1/openssl-passwd.pod.in
index e7502ae332..2fa8e97f13 100644
--- a/doc/man1/openssl-passwd.pod
+++ b/doc/man1/openssl-passwd.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-passwd - compute password hashes
@@ -20,8 +25,7 @@ B&lt;openssl passwd&gt;
 [B&lt;-noverify&gt;]
 [B&lt;-quiet&gt;]
 [B&lt;-table&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 {I&lt;password&gt;}
 
 =for openssl ifdef crypt
@@ -93,9 +97,7 @@ Don't output warnings when passwords given at the command line are truncated.
 In the output list, prepend the cleartext password and a TAB character
 to each password hash.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
+{- $OpenSSL::safe::opt_r_item -}
 
 =back
 
diff --git a/doc/man1/openssl-pkcs12.pod b/doc/man1/openssl-pkcs12.pod.in
similarity index 96%
rename from doc/man1/openssl-pkcs12.pod
rename to doc/man1/openssl-pkcs12.pod.in
index 5742549891..09b75111db 100644
--- a/doc/man1/openssl-pkcs12.pod
+++ b/doc/man1/openssl-pkcs12.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-pkcs12 - PKCS#12 file utility
@@ -36,13 +41,9 @@ B&lt;openssl&gt; B&lt;pkcs12&gt;
 [B&lt;-password&gt; I&lt;arg&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
 [B&lt;-passout&gt; I&lt;arg&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
-[B&lt;-CAfile&gt; I&lt;file&gt;]
-[B&lt;-CApath&gt; I&lt;dir&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-CSP&gt; I&lt;name&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine
 
@@ -263,18 +264,14 @@ to be needed to use MAC iterations counts but they are now used by default.
 
 Don't attempt to provide the MAC integrity.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-CSP&gt; I&lt;name&gt;
 
 Write I&lt;name&gt; as a Microsoft CSP name.
 
+{- $OpenSSL::safe::opt_trust_item -}
+
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-pkcs8.pod b/doc/man1/openssl-pkcs8.pod.in
similarity index 98%
rename from doc/man1/openssl-pkcs8.pod
rename to doc/man1/openssl-pkcs8.pod.in
index f923c986a0..c9d8b9c5a8 100644
--- a/doc/man1/openssl-pkcs8.pod
+++ b/doc/man1/openssl-pkcs8.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-pkcs8 - PKCS#8 format private key conversion tool
@@ -17,8 +22,6 @@ B&lt;openssl&gt; B&lt;pkcs8&gt;
 [B&lt;-passout&gt; I&lt;arg&gt;]
 [B&lt;-iter&gt; I&lt;count&gt;]
 [B&lt;-noiter&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-nocrypt&gt;]
 [B&lt;-traditional&gt;]
 [B&lt;-v2&gt; I&lt;alg&gt;]
@@ -29,6 +32,7 @@ B&lt;openssl&gt; B&lt;pkcs8&gt;
 [B&lt;-scrypt_N&gt; I&lt;N&gt;]
 [B&lt;-scrypt_r&gt; I&lt;r&gt;]
 [B&lt;-scrypt_p&gt; I&lt;p&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine scrypt scrypt_N scrypt_r scrypt_p
 
@@ -113,10 +117,6 @@ This option does not encrypt private keys at all and should only be used
 when absolutely necessary. Certain software such as some versions of Java
 code signing software used unencrypted private keys.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-v2&gt; I&lt;alg&gt;
 
 This option sets the PKCS#5 v2.0 algorithm.
@@ -158,6 +158,8 @@ B&lt;-scrypt_p&gt; and B&lt;-v2&gt; options.
 
 Sets the scrypt I&lt;N&gt;, I&lt;r&gt; or I&lt;p&gt; parameters.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-pkeyutl.pod b/doc/man1/openssl-pkeyutl.pod.in
similarity index 98%
rename from doc/man1/openssl-pkeyutl.pod
rename to doc/man1/openssl-pkeyutl.pod.in
index 13519399fa..61cf3cb9ef 100644
--- a/doc/man1/openssl-pkeyutl.pod
+++ b/doc/man1/openssl-pkeyutl.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-pkeyutl - public key algorithm utility
@@ -33,10 +38,9 @@ B&lt;openssl&gt; B&lt;pkeyutl&gt;
 [B&lt;-pkeyopt_passin&gt; I&lt;opt&gt;[:I&lt;passarg&gt;]]
 [B&lt;-hexdump&gt;]
 [B&lt;-asn1parse&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-engine_impl&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine engine_impl
 
@@ -179,10 +183,6 @@ hex dump the output data.
 Parse the ASN.1 output data, this is useful when combined with the
 B&lt;-verifyrecover&gt; option when an ASN1 structure is signed.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-engine&gt; I&lt;id&gt;
 
 Specifying an engine (by its unique I&lt;id&gt; string) will cause this command
@@ -195,6 +195,8 @@ for all available algorithms.
 When used with the B&lt;-engine&gt; option, it specifies to also use
 engine I&lt;id&gt; for crypto operations.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-rand.pod b/doc/man1/openssl-rand.pod.in
similarity index 86%
rename from doc/man1/openssl-rand.pod
rename to doc/man1/openssl-rand.pod.in
index c32b10242e..fe7a2467bc 100644
--- a/doc/man1/openssl-rand.pod
+++ b/doc/man1/openssl-rand.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-rand - generate pseudo-random bytes
@@ -9,10 +14,9 @@ openssl-rand - generate pseudo-random bytes
 B&lt;openssl rand&gt;
 [B&lt;-help&gt;]
 [B&lt;-out&gt; I&lt;file&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-base64&gt;]
 [B&lt;-hex&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 I&lt;num&gt;
 
 =for openssl ifdef engine
@@ -34,10 +38,6 @@ Print out a usage message.
 
 Write to I&lt;file&gt; instead of standard output.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-base64&gt;
 
 Perform base64 encoding on the output.
@@ -46,6 +46,8 @@ Perform base64 encoding on the output.
 
 Show the output as a hex string.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 SEE ALSO
diff --git a/doc/man1/openssl-req.pod b/doc/man1/openssl-req.pod.in
similarity index 99%
rename from doc/man1/openssl-req.pod
rename to doc/man1/openssl-req.pod.in
index f976b7948e..8ca4acc111 100644
--- a/doc/man1/openssl-req.pod
+++ b/doc/man1/openssl-req.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-req - PKCS#10 certificate request and certificate generating utility
@@ -20,8 +25,6 @@ B&lt;openssl&gt; B&lt;req&gt;
 [B&lt;-verify&gt;]
 [B&lt;-modulus&gt;]
 [B&lt;-new&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-newkey&gt; I&lt;arg&gt;]
 [B&lt;-nodes&gt;]
 [B&lt;-key&gt; I&lt;filename&gt;]
@@ -50,6 +53,7 @@ B&lt;openssl&gt; B&lt;req&gt;
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-sm2-id&gt; I&lt;string&gt;]
 [B&lt;-sm2-hex-id&gt; I&lt;hex-string&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine keygen_engine sm2-id sm2-hex-id
 
@@ -132,10 +136,6 @@ in the configuration file and any requested extensions.
 If the B&lt;-key&gt; option is not used it will generate a new RSA private
 key using information specified in the configuration file.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-newkey&gt; I&lt;arg&gt;
 
 This option creates a new certificate request and a new private
@@ -334,6 +334,8 @@ string is required by the SM2 signature algorithm for signing and verification.
 Specify a binary ID string to use when verifying an SM2 certificate request. The
 argument for this option is string of hexadecimal digits.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 CONFIGURATION FILE FORMAT
diff --git a/doc/man1/openssl-rsautl.pod b/doc/man1/openssl-rsautl.pod.in
similarity index 97%
rename from doc/man1/openssl-rsautl.pod
rename to doc/man1/openssl-rsautl.pod.in
index cc85cc4b21..374b87a406 100644
--- a/doc/man1/openssl-rsautl.pod
+++ b/doc/man1/openssl-rsautl.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-rsautl - RSA utility
@@ -18,13 +23,12 @@ B&lt;openssl&gt; B&lt;rsautl&gt;
 [B&lt;-verify&gt;]
 [B&lt;-encrypt&gt;]
 [B&lt;-decrypt&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-pkcs&gt;]
 [B&lt;-ssl&gt;]
 [B&lt;-raw&gt;]
 [B&lt;-hexdump&gt;]
 [B&lt;-asn1parse&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine
 
@@ -85,10 +89,6 @@ Encrypt the input data using an RSA public key.
 
 Decrypt the input data using an RSA private key.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-pkcs&gt;, B&lt;-oaep&gt;, B&lt;-ssl&gt;, B&lt;-raw&gt;
 
 The padding to use: PKCS#1 v1.5 (the default), PKCS#1 OAEP,
@@ -105,6 +105,8 @@ Hex dump the output data.
 Parse the ASN.1 output data, this is useful when combined with the
 B&lt;-verify&gt; option.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-s_client.pod b/doc/man1/openssl-s_client.pod.in
similarity index 95%
rename from doc/man1/openssl-s_client.pod
rename to doc/man1/openssl-s_client.pod.in
index 2dc64f578f..9752407a82 100644
--- a/doc/man1/openssl-s_client.pod
+++ b/doc/man1/openssl-s_client.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-s_client - SSL/TLS client program
@@ -27,19 +32,9 @@ B&lt;openssl&gt; B&lt;s_client&gt;
 [B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-cert_chain&gt; I&lt;filename&gt;]
 [B&lt;-build_chain&gt;]
-[B&lt;-xkey&gt;]
-[B&lt;-xcert&gt;]
-[B&lt;-xchain&gt;]
-[B&lt;-xchain_build&gt;]
-[B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
-[B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-pass&gt; I&lt;arg&gt;]
-[B&lt;-CApath&gt; I&lt;directory&gt;]
-[B&lt;-CAfile&gt; I&lt;filename&gt;]
 [B&lt;-chainCApath&gt; I&lt;directory&gt;]
 [B&lt;-chainCAfile&gt; I&lt;filename&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-requestCAfile&gt; I&lt;filename&gt;]
 [B&lt;-dane_tlsa_domain&gt; I&lt;domain&gt;]
 [B&lt;-dane_tlsa_rrdata&gt; I&lt;rrdata&gt;]
@@ -126,8 +121,6 @@ B&lt;openssl&gt; B&lt;s_client&gt;
 [B&lt;-no_ticket&gt;]
 [B&lt;-sess_out&gt; I&lt;filename&gt;]
 [B&lt;-sess_in&gt; I&lt;filename&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-serverinfo&gt; I&lt;types&gt;]
 [B&lt;-status&gt;]
 [B&lt;-alpn&gt; I&lt;protocols&gt;]
@@ -138,6 +131,9 @@ B&lt;openssl&gt; B&lt;s_client&gt;
 [B&lt;-keylogfile&gt; I&lt;file&gt;]
 [B&lt;-early_data&gt; I&lt;file&gt;]
 [B&lt;-enable_pha&gt;]
+{- $OpenSSL::safe::opt_x_synopsis -}
+{- $OpenSSL::safe::opt_trust_synopsis -}
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;host&gt;:I&lt;port&gt;]
 
 =for openssl ifdef engine ssl_client_engine ct noct ctlogfile
@@ -176,7 +172,7 @@ select the host and port using the optional target positional argument instead.
 If neither this nor the target positional argument are specified then an attempt
 is made to connect to the local host on port 4433.
 
-=item B&lt;-bind&gt; I&lt;host:port&gt;]
+=item B&lt;-bind&gt; I&lt;host:port&gt;
 
 This specifies the host address and or port to bind as the source for the
 connection.  For Unix-domain sockets the port is ignored and the host is
@@ -218,14 +214,14 @@ Use IPv6 only.
 =item B&lt;-servername&gt; I&lt;name&gt;
 
 Set the TLS SNI (Server Name Indication) extension in the ClientHello message to
-the given value. 
-If B&lt;-servername&gt; is not provided, the TLS SNI extension will be populated with 
-the name given to B&lt;-connect&gt; if it follows a DNS name format. If B&lt;-connect&gt; is 
+the given value.
+If B&lt;-servername&gt; is not provided, the TLS SNI extension will be populated with
+the name given to B&lt;-connect&gt; if it follows a DNS name format. If B&lt;-connect&gt; is
 not provided either, the SNI is set to &quot;localhost&quot;.
 This is the default since OpenSSL 1.1.1.
 
-Even though SNI should normally be a DNS name and not an IP address, if 
-B&lt;-servername&gt; is provided then that name will be sent, regardless of whether 
+Even though SNI should normally be a DNS name and not an IP address, if
+B&lt;-servername&gt; is provided then that name will be sent, regardless of whether
 it is a DNS name or not.
 
 This option cannot be used in conjunction with B&lt;-noservername&gt;.
@@ -271,24 +267,6 @@ B&lt;-cert&gt; option.
 Specify whether the application should build the certificate chain to be
 provided to the server.
 
-=item B&lt;-xkey&gt; I&lt;infile&gt;, B&lt;-xcert&gt; I&lt;infile&gt;, B&lt;-xchain&gt;
-
-Specify an extra certificate, private key and certificate chain. These behave
-in the same manner as the B&lt;-cert&gt;, B&lt;-key&gt; and B&lt;-cert_chain&gt; options.  When
-specified, the callback returning the first valid chain will be in use by the
-client.
-
-=item B&lt;-xchain_build&gt;
-
-Specify whether the application should build the certificate chain to be
-provided to the server for the extra certificates provided via B&lt;-xkey&gt; I&lt;infile&gt;,
-B&lt;-xcert&gt; I&lt;infile&gt;, B&lt;-xchain&gt; options.
-
-=item B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
-
-Extra certificate and private key format respectively.
-See L&lt;openssl(1)/Format Options&gt; for details.
-
 =item B&lt;-pass&gt; I&lt;arg&gt;
 
 the private key password source. For more information about the format of I&lt;arg&gt;
@@ -314,10 +292,6 @@ I&lt;option&gt; argument can be a single option or multiple options separated by
 commas.  Alternatively the B&lt;-nameopt&gt; switch may be used more than once to
 set multiple options. See the L&lt;openssl-x509(1)&gt; manual page for details.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-chainCApath&gt; I&lt;directory&gt;
 
 The directory to use for building the chain provided to the server. This
@@ -667,10 +641,6 @@ to attempt to obtain a functional reference to the specified engine,
 thus initialising it if needed. The engine will then be set as the default
 for all available algorithms.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-serverinfo&gt; I&lt;types&gt;
 
 A list of comma-separated TLS Extension Types (numbers between 0 and
@@ -735,6 +705,12 @@ be provided as a single positional argument after all options. If neither this
 nor B&lt;-connect&gt; are provided, falls back to attempting to connect to
 I&lt;localhost&gt; on port I&lt;4433&gt;.
 
+{- $OpenSSL::safe::opt_x_item -}
+
+{- $OpenSSL::safe::opt_trust_item -}
+
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 CONNECTED COMMANDS
diff --git a/doc/man1/openssl-s_server.pod b/doc/man1/openssl-s_server.pod.in
similarity index 95%
rename from doc/man1/openssl-s_server.pod
rename to doc/man1/openssl-s_server.pod.in
index be70cfcff5..638516695f 100644
--- a/doc/man1/openssl-s_server.pod
+++ b/doc/man1/openssl-s_server.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-s_server - SSL/TLS server program
@@ -36,10 +41,6 @@ B&lt;openssl&gt; B&lt;s_server&gt;
 [B&lt;-msg&gt;]
 [B&lt;-msgfile&gt; I&lt;outfile&gt;]
 [B&lt;-state&gt;]
-[B&lt;-CAfile&gt; I&lt;infile&gt;]
-[B&lt;-CApath&gt; I&lt;dir&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-nocert&gt;]
 [B&lt;-quiet&gt;]
 [B&lt;-no_resume_ephemeral&gt;]
@@ -52,8 +53,6 @@ B&lt;openssl&gt; B&lt;s_server&gt;
 [B&lt;-tlsextdebug&gt;]
 [B&lt;-HTTP&gt;]
 [B&lt;-id_prefix&gt; I&lt;val&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-keymatexport&gt; I&lt;val&gt;]
 [B&lt;-keymatexportlen&gt; I&lt;+int&gt;]
 [B&lt;-CRL&gt; I&lt;infile&gt;]
@@ -146,13 +145,6 @@ B&lt;openssl&gt; B&lt;s_server&gt;
 [B&lt;-no_alt_chains&gt;]
 [B&lt;-no_check_time&gt;]
 [B&lt;-allow_proxy_certs&gt;]
-[B&lt;-xkey&gt;]
-[B&lt;-xcert&gt;]
-[B&lt;-xchain&gt;]
-[B&lt;-xchain_build&gt;]
-[B&lt;-CRLform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
-[B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
-[B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-nbio&gt;]
 [B&lt;-psk_identity&gt; I&lt;val&gt;]
 [B&lt;-psk_hint&gt; I&lt;val&gt;]
@@ -184,6 +176,9 @@ B&lt;openssl&gt; B&lt;s_server&gt;
 [B&lt;-anti_replay&gt;]
 [B&lt;-no_anti_replay&gt;]
 [B&lt;-http_server_binmode&gt;]
+{- $OpenSSL::safe::opt_x_synopsis -}
+{- $OpenSSL::safe::opt_trust_synopsis -}
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef unix 4 6 unlink no_dhe nextprotoneg use_srtp engine
 
@@ -300,7 +295,7 @@ See L&lt;openssl(1)/Format Options&gt; for details.
 The private key to use. If not specified then the certificate file will
 be used.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
 
 The key format; the default is B&lt;PEM&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
@@ -339,25 +334,6 @@ The passphrase for the additional private key.
 For more information about the format of I&lt;val&gt;,
 see L&lt;openssl(1)/Pass Phrase Options&gt;.
 
-=item B&lt;-xkey&gt; I&lt;infile&gt;, B&lt;-xcert&gt; I&lt;infile&gt;, B&lt;-xchain&gt;
-
-Specify an extra certificate, private key and certificate chain. These behave
-in the same manner as the B&lt;-cert&gt;, B&lt;-key&gt; and B&lt;-cert_chain&gt; options.  When
-specified, the callback returning the first valid chain will be in use by
-the server.
-
-=item B&lt;-xchain_build&gt;
-
-Specify whether the application should build the certificate chain to be
-provided to the client for the extra certificates provided via B&lt;-xkey&gt; I&lt;infile&gt;,
-B&lt;-xcert&gt; I&lt;infile&gt;, B&lt;-xchain&gt; options.
-
-=item B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
-
-The format for the extra certificate and private key, respectively;
-the default format is B&lt;PEM&gt;.
-see L&lt;openssl(1)/Pass Phrase Options&gt;.
-
 =item B&lt;-nbio_test&gt;
 
 Tests non blocking I/O.
@@ -382,10 +358,6 @@ File to send output of B&lt;-msg&gt; or B&lt;-trace&gt; to, default standard output.
 
 Prints the SSL session states.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-chainCApath&gt; I&lt;dir&gt;
 
 The directory to use for building the chain provided to the client. This
@@ -441,10 +413,6 @@ for testing any SSL/TLS code (eg. proxies) that wish to deal with multiple
 servers, when each of which might be generating a unique range of session
 IDs (eg. with a certain prefix).
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-verify_return_error&gt;
 
 Verification errors normally just print a message but allow the
@@ -745,6 +713,12 @@ data that was sent will be rejected.
 When acting as web-server (using option B&lt;-WWW&gt; or B&lt;-HTTP&gt;) open files requested
 by the client in binary mode.
 
+{- $OpenSSL::safe::opt_x_item -}
+
+{- $OpenSSL::safe::opt_trust_item -}
+
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head1 CONNECTED COMMANDS
diff --git a/doc/man1/openssl-s_time.pod b/doc/man1/openssl-s_time.pod.in
similarity index 96%
rename from doc/man1/openssl-s_time.pod
rename to doc/man1/openssl-s_time.pod.in
index f5126dae54..737424da87 100644
--- a/doc/man1/openssl-s_time.pod
+++ b/doc/man1/openssl-s_time.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-s_time - SSL/TLS performance timing program
@@ -12,10 +17,6 @@ B&lt;openssl&gt; B&lt;s_time&gt;
 [B&lt;-www&gt; I&lt;page&gt;]
 [B&lt;-cert&gt; I&lt;filename&gt;]
 [B&lt;-key&gt; I&lt;filename&gt;]
-[B&lt;-CApath&gt; I&lt;directory&gt;]
-[B&lt;-cafile&gt; I&lt;filename&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-reuse&gt;]
 [B&lt;-new&gt;]
 [B&lt;-verify&gt; I&lt;depth&gt;]
@@ -29,6 +30,7 @@ B&lt;openssl&gt; B&lt;s_time&gt;
 [B&lt;-bugs&gt;]
 [B&lt;-cipher&gt; I&lt;cipherlist&gt;]
 [B&lt;-ciphersuites&gt; I&lt;val&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
 
 =for openssl ifdef ssl3 tls1 tls1_1 tls1_2 tls1_3
 
@@ -91,10 +93,6 @@ The directory to use for server certificate verification. This directory
 must be in &quot;hash format&quot;, see L&lt;openssl-verify(1)&gt; for more information.
 These are also used when building the client certificate chain.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-new&gt;
 
 Performs the timing test using a new session ID for each connection.
@@ -145,6 +143,8 @@ and optionally transfer payload data from a server. Server and client
 performance and the link speed determine how many connections it
 can establish.
 
+{- $OpenSSL::safe::opt_trust_item -}
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/openssl-smime.pod b/doc/man1/openssl-smime.pod.in
similarity index 97%
rename from doc/man1/openssl-smime.pod
rename to doc/man1/openssl-smime.pod.in
index 935a89b678..4e07af3860 100644
--- a/doc/man1/openssl-smime.pod
+++ b/doc/man1/openssl-smime.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-smime - S/MIME utility
@@ -18,10 +23,6 @@ B&lt;openssl&gt; B&lt;smime&gt;
 [B&lt;-crlfeol&gt;]
 [B&lt;-I&lt;cipher&gt;&gt;]
 [B&lt;-in&gt; I&lt;file&gt;]
-[B&lt;-CAfile&gt; I&lt;file&gt;]
-[B&lt;-CApath&gt; I&lt;dir&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-attime&gt; I&lt;timestamp&gt;]
 [B&lt;-check_ss_sig&gt;]
 [B&lt;-crl_check&gt;]
@@ -66,9 +67,9 @@ B&lt;openssl&gt; B&lt;smime&gt;
 [B&lt;-indef&gt;]
 [B&lt;-noindef&gt;]
 [B&lt;-stream&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-md&gt; I&lt;digest&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
+{- $OpenSSL::safe::opt_r_synopsis -}
 I&lt;cert.pem&gt; ...
 
 =for openssl ifdef engine
@@ -179,10 +180,6 @@ message if encrypting or signing. If decrypting or verifying it strips
 off text headers: if the decrypted or verified message is not of MIME
 type text/plain then an error occurs.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-md&gt; I&lt;digest&gt;
 
 Digest algorithm to use when signing or resigning. If not present then the
@@ -283,10 +280,6 @@ specified, the argument is given to the engine as a key identifier.
 The private key password source. For more information about the format of I&lt;arg&gt;
 see L&lt;openssl(1)/Pass Phrase Options&gt;.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-to&gt;, B&lt;-from&gt;, B&lt;-subject&gt;
 
 The relevant mail headers. These are included outside the signed
@@ -305,6 +298,10 @@ B&lt;-verify_ip&gt;, B&lt;-verify_name&gt;, B&lt;-x509_strict&gt;
 Set various options of certificate chain verification. See
 L&lt;openssl-verify(1)&gt; manual page for details.
 
+{- $OpenSSL::safe::opt_trust_item -}
+
+{- $OpenSSL::safe::opt_r_item -}
+
 =item I&lt;cert.pem&gt; ...
 
 One or more certificates of message recipients, used when encrypting
diff --git a/doc/man1/openssl-speed.pod b/doc/man1/openssl-speed.pod.in
similarity index 94%
rename from doc/man1/openssl-speed.pod
rename to doc/man1/openssl-speed.pod.in
index e818bf6666..657a4156c6 100644
--- a/doc/man1/openssl-speed.pod
+++ b/doc/man1/openssl-speed.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-speed - test library performance
@@ -14,11 +19,10 @@ B&lt;openssl speed&gt;
 [B&lt;-hmac&gt; I&lt;algo&gt;]
 [B&lt;-cmac&gt; I&lt;algo&gt;]
 [B&lt;-decrypt&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-primes&gt; I&lt;num&gt;]
 [B&lt;-seconds&gt; I&lt;num&gt;]
 [B&lt;-bytes&gt; I&lt;num&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;algorithm&gt; ...]
 
 =for openssl ifdef cmac multi async_jobs engine
@@ -71,10 +75,6 @@ C&lt;openssl speed -cmac aes128&gt;.
 
 Time the decryption instead of encryption. Affects only the EVP testing.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-primes&gt; I&lt;num&gt;
 
 Generate a I&lt;num&gt;-prime RSA key and use it to run the benchmarks. This option
@@ -88,6 +88,8 @@ Run benchmarks for I&lt;num&gt; seconds.
 
 Run benchmarks on I&lt;num&gt;-byte buffers. Affects ciphers, digests and the CSPRNG.
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =item I&lt;algorithm&gt; ...
 
 If any I&lt;algorithm&gt; is given, then those algorithms are tested, otherwise a
diff --git a/doc/man1/openssl-srp.pod b/doc/man1/openssl-srp.pod.in
similarity index 92%
rename from doc/man1/openssl-srp.pod
rename to doc/man1/openssl-srp.pod.in
index 65443c25cf..24990c9148 100644
--- a/doc/man1/openssl-srp.pod
+++ b/doc/man1/openssl-srp.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-srp - maintain SRP password file
@@ -20,8 +25,7 @@ B&lt;openssl srp&gt;
 [B&lt;-userinfo&gt; I&lt;text&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
 [B&lt;-passout&gt; I&lt;arg&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 [I&lt;user&gt; ...]
 
 =for openssl ifdef engine
@@ -71,9 +75,7 @@ The password source for the input and output file.
 For more information about the format of B&lt;arg&gt;
 see L&lt;openssl(1)/Pass Phrase Options&gt;.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =back
 
diff --git a/doc/man1/openssl-ts.pod b/doc/man1/openssl-ts.pod.in
similarity index 99%
rename from doc/man1/openssl-ts.pod
rename to doc/man1/openssl-ts.pod.in
index fc46421745..d9354b2ab7 100644
--- a/doc/man1/openssl-ts.pod
+++ b/doc/man1/openssl-ts.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-ts - Time Stamping Authority tool (client/server)
@@ -8,8 +13,6 @@ openssl-ts - Time Stamping Authority tool (client/server)
 
 B&lt;openssl&gt; B&lt;ts&gt;
 B&lt;-query&gt;
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-config&gt; I&lt;configfile&gt;]
 [B&lt;-data&gt; I&lt;file_to_hash&gt;]
 [B&lt;-digest&gt; I&lt;digest_bytes&gt;]
@@ -20,6 +23,7 @@ B&lt;-query&gt;
 [B&lt;-in&gt; I&lt;request.tsq&gt;]
 [B&lt;-out&gt; I&lt;request.tsq&gt;]
 [B&lt;-text&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 B&lt;openssl&gt; B&lt;ts&gt;
 B&lt;-reply&gt;
@@ -134,10 +138,6 @@ request with the following options:
 
 =over 4
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-config&gt; I&lt;configfile&gt;
 
 The configuration file to use.
@@ -200,6 +200,8 @@ is stdout. (Optional)
 If this option is specified the output is human-readable text format
 instead of DER. (Optional)
 
+{- $OpenSSL::safe::opt_r_item -}
+
 =back
 
 =head2 Timestamp Response generation
diff --git a/doc/man1/openssl-verify.pod b/doc/man1/openssl-verify.pod.in
similarity index 99%
rename from doc/man1/openssl-verify.pod
rename to doc/man1/openssl-verify.pod.in
index abaa0755f2..72ef98cc85 100644
--- a/doc/man1/openssl-verify.pod
+++ b/doc/man1/openssl-verify.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-verify - Utility to verify certificates
@@ -8,10 +13,6 @@ openssl-verify - Utility to verify certificates
 
 B&lt;openssl&gt; B&lt;verify&gt;
 [B&lt;-help&gt;]
-[B&lt;-CAfile&gt; I&lt;file&gt;]
-[B&lt;-CApath&gt; I&lt;directory&gt;]
-[B&lt;-no-CAfile&gt;]
-[B&lt;-no-CApath&gt;]
 [B&lt;-allow_proxy_certs&gt;]
 [B&lt;-attime&gt; I&lt;timestamp&gt;]
 [B&lt;-check_ss_sig&gt;]
@@ -51,6 +52,7 @@ B&lt;openssl&gt; B&lt;verify&gt;
 [B&lt;-show_chain&gt;]
 [B&lt;-sm2-id&gt; I&lt;string&gt;]
 [B&lt;-sm2-hex-id&gt; I&lt;hex-string&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
 [B&lt;--&gt;]
 [I&lt;certificate&gt; ...]
 
@@ -68,10 +70,6 @@ This command verifies certificate chains.
 
 Print out a usage message.
 
-=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;
-
-See L&lt;openssl(1)/Trusted Certificate Options&gt; for more information.
-
 =item B&lt;-allow_proxy_certs&gt;
 
 Allow the verification of proxy certificates.
@@ -318,6 +316,8 @@ Indicates the last option. All arguments following this are assumed to be
 certificate files. This is useful if the first certificate filename begins
 with a B&lt;--&gt;.
 
+{- $OpenSSL::safe::opt_trust_item -}
+
 =item I&lt;certificate&gt; ...
 
 One or more certificates to verify. If no certificates are given,
diff --git a/doc/man1/openssl-x509.pod b/doc/man1/openssl-x509.pod.in
similarity index 99%
rename from doc/man1/openssl-x509.pod
rename to doc/man1/openssl-x509.pod.in
index d843ff3975..c99a5b23f0 100644
--- a/doc/man1/openssl-x509.pod
+++ b/doc/man1/openssl-x509.pod.in
@@ -1,5 +1,10 @@
 =pod
 
+=begin comment
+{- join(&quot;\n&quot;, @autowarntext) -}
+
+=end comment
+
 =head1 NAME
 
 openssl-x509 - Certificate display and signing utility
@@ -63,10 +68,9 @@ B&lt;openssl&gt; B&lt;x509&gt;
 [B&lt;-extfile&gt; I&lt;filename&gt;]
 [B&lt;-extensions&gt; I&lt;section&gt;]
 [B&lt;-sigopt&gt; I&lt;nm&gt;:I&lt;v&gt;]
-[B&lt;-rand&gt; I&lt;files&gt;]
-[B&lt;-writerand&gt; I&lt;file&gt;]
 [B&lt;-engine&gt; I&lt;id&gt;]
 [B&lt;-preserve_dates&gt;]
+{- $OpenSSL::safe::opt_r_synopsis -}
 
 =for openssl ifdef engine subject_hash_old issuer_hash_old
 
@@ -117,10 +121,6 @@ Any digest supported by the L&lt;openssl-dgst(1)&gt; command can be used.
 If not specified then SHA1 is used with B&lt;-fingerprint&gt; or
 the default digest for the signing algorithm is used, typically SHA256.
 
-=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;
-
-See L&lt;openssl(1)/Random State Options&gt; for more information.
-
 =item B&lt;-engine&gt; I&lt;id&gt;
 
 Specifying an engine (by its unique I&lt;id&gt; string) will cause this command
@@ -134,6 +134,8 @@ When signing a certificate, preserve the &quot;notBefore&quot; and &quot;notAfter&quot; dates
 instead of adjusting them to current time and duration.
 Cannot be used with the B&lt;-days&gt; option.
 
+{- $OpenSSL::safe::opt_r_synopsis -}
+
 =back
 
 =head2 Display Options
diff --git a/doc/man1/openssl.pod b/doc/man1/openssl.pod
index 2de4fceeb3..3198f90e22 100644
--- a/doc/man1/openssl.pod
+++ b/doc/man1/openssl.pod
@@ -613,7 +613,7 @@ The format of the input or output streams.
 
 Format of a private key input source.
 
-=item B&lt;-CRLform&gt; I&lt;fornat&gt;
+=item B&lt;-CRLform&gt; I&lt;format&gt;
 
 Format of a CRL input source.
 
@@ -732,6 +732,40 @@ This file can be used in a subsequent command invocation.
 
 =back
 
+=head2 Extended Verification Options
+
+Sometimes there may be more than one certificate chain leading to an
+end-entity certificate.
+This usually happens when a root or intermediate CA signs a certificate
+for another a CA in other organization.
+Another reason is when a CA might have intermediates that use two different
+signature formats, such as a SHA-1 and a SHA-256 digest.
+
+The following options can be used to provide data that will allow the
+OpenSSL command to generate an alternative chain.
+
+=over 4
+
+=item B&lt;-xchain_build&gt;
+
+Specify whether the application should build the certificate chain to be
+provided to the server for the extra certificates via the B&lt;-xkey&gt;,
+B&lt;-xcert&gt;, and B&lt;-xchain&gt; options.
+
+=item B&lt;-xkey&gt; I&lt;infile&gt;, B&lt;-xcert&gt; I&lt;infile&gt;, B&lt;-xchain&gt;
+
+Specify an extra certificate, private key and certificate chain. These behave
+in the same manner as the B&lt;-cert&gt;, B&lt;-key&gt; and B&lt;-cert_chain&gt; options.  When
+specified, the callback returning the first valid chain will be in use by the
+client.
+
+=item B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+
+The input format for the extra certifcate and key, respectively.
+See L&lt;openssl(1)/Format Options&gt; for details.
+
+=back
+
 =head1 ENVIRONMENT
 
 =over 4
diff --git a/doc/perlvars.pm b/doc/perlvars.pm
new file mode 100644
index 0000000000..ca62ca5ce9
--- /dev/null
+++ b/doc/perlvars.pm
@@ -0,0 +1,129 @@
+#! /usr/bin/env perl
+# Copyright 2019 The OpenSSL Project Authors. All Rights Reserved.
+#
+# Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+# this file except in compliance with the License.  You can obtain a copy
+# in the file LICENSE in the source distribution or at
+
+# Set some Perl variables for use by util/dofile.pl when processing
+# POD files (mainly man1).
+
+# Verify options
+$OpenSSL::safe::opt_v_synopsis = &quot;&quot;
+. &quot;[B&lt;-attime&gt; I&lt;timestamp&gt;]\n&quot;
+. &quot;[B&lt;-check_ss_sig&gt;]\n&quot;
+. &quot;[B&lt;-crl_check&gt;]\n&quot;
+. &quot;[B&lt;-crl_check_all&gt;]\n&quot;
+. &quot;[B&lt;-explicit_policy&gt;]\n&quot;
+. &quot;[B&lt;-extended_crl&gt;]\n&quot;
+. &quot;[B&lt;-ignore_critical&gt;]\n&quot;
+. &quot;[B&lt;-inhibit_any&gt;]\n&quot;
+. &quot;[B&lt;-inhibit_map&gt;]\n&quot;
+. &quot;[B&lt;-partial_chain&gt;]\n&quot;
+. &quot;[B&lt;-policy&gt; I&lt;arg&gt;]\n&quot;
+. &quot;[B&lt;-policy_check&gt;]\n&quot;
+. &quot;[B&lt;-policy_print&gt;]\n&quot;
+. &quot;[B&lt;-purpose&gt; I&lt;purpose&gt;]\n&quot;
+. &quot;[B&lt;-suiteB_128&gt;]\n&quot;
+. &quot;[B&lt;-suiteB_128_only&gt;]\n&quot;
+. &quot;[B&lt;-suiteB_192&gt;]\n&quot;
+. &quot;[B&lt;-trusted_first&gt;]\n&quot;
+. &quot;[B&lt;-no_alt_chains&gt;]\n&quot;
+. &quot;[B&lt;-use_deltas&gt;]\n&quot;
+. &quot;[B&lt;-auth_level&gt; I&lt;num&gt;]\n&quot;
+. &quot;[B&lt;-verify_depth&gt; I&lt;num&gt;]\n&quot;
+. &quot;[B&lt;-verify_email&gt; I&lt;email&gt;]\n&quot;
+. &quot;[B&lt;-verify_hostname&gt; I&lt;hostname&gt;]\n&quot;
+. &quot;[B&lt;-verify_ip&gt; I&lt;ip&gt;]\n&quot;
+. &quot;[B&lt;-verify_name&gt; I&lt;name&gt;]\n&quot;
+. &quot;[B&lt;-x509_strict&gt;]\n&quot;
+. &quot;[B&lt;-certfile&gt; I&lt;file&gt;]&quot;;
+$OpenSSL::safe::opt_v_item = &quot;&quot;
+. &quot;=item B&lt;-attime&gt;, B&lt;-check_ss_sig&gt;, B&lt;-crl_check&gt;, B&lt;-crl_check_all&gt;,\n&quot;
+. &quot;B&lt;-explicit_policy&gt;, B&lt;-extended_crl&gt;, B&lt;-ignore_critical&gt;, B&lt;-inhibit_any&gt;,\n&quot;
+. &quot;B&lt;-inhibit_map&gt;, B&lt;-no_alt_chains&gt;, B&lt;-partial_chain&gt;, B&lt;-policy&gt;,\n&quot;
+. &quot;B&lt;-policy_check&gt;, B&lt;-policy_print&gt;, B&lt;-purpose&gt;, B&lt;-suiteB_128&gt;,\n&quot;
+. &quot;B&lt;-suiteB_128_only&gt;, B&lt;-suiteB_192&gt;, B&lt;-trusted_first&gt;, B&lt;-use_deltas&gt;,\n&quot;
+. &quot;B&lt;-auth_level&gt;, B&lt;-verify_depth&gt;, B&lt;-verify_email&gt;, B&lt;-verify_hostname&gt;,\n&quot;
+. &quot;B&lt;-verify_ip&gt;, B&lt;-verify_name&gt;, B&lt;-x509_strict&gt;\n&quot;
+. &quot;\n&quot;
+. &quot;Set various options of certificate chain verification.\n&quot;
+. &quot;See L&lt;openssl(1)/Verification Options&gt; for details.&quot;;
+
+
+# Extended validation options.
+$OpenSSL::safe::opt_x_synopsis = &quot;&quot;
+. &quot;[B&lt;-xkey&gt;] I&lt;infile&gt;\n&quot;
+. &quot;[B&lt;-xcert&gt; I&lt;file&gt;]\n&quot;
+. &quot;[B&lt;-xchain&gt;] I&lt;file&gt;\n&quot;
+. &quot;[B&lt;-xchain_build&gt;] I&lt;file&gt;\n&quot;
+. &quot;[B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]&gt;\n&quot;
+. &quot;[B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]&gt;&quot;;
+$OpenSSL::safe::opt_x_item = &quot;&quot;
+. &quot;=item B&lt;xkey&gt; I&lt;infile&gt;, B&lt;-xcert&gt; I&lt;file&gt;, B&lt;-xchain&gt; I&lt;file&gt;,\n&quot;
+. &quot;B&lt;-xchain_build&gt; I&lt;file&gt;, B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;,\n&quot;
+. &quot;B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;&gt;\n&quot;
+. &quot;\n&quot;
+. &quot;Set extended certificate verification options.\n&quot;
+. &quot;See L&lt;openssl(1)/Extended Verification Options&gt; for details.&quot;;
+
+
+# Random State Options
+$OpenSSL::safe::opt_r_synopsis = &quot;&quot;
+. &quot;[B&lt;-rand&gt; I&lt;files&gt;]\n&quot;
+. &quot;[B&lt;-writerand&gt; I&lt;file&gt;]&quot;;
+$OpenSSL::safe::opt_r_item = &quot;&quot;
+. &quot;=item B&lt;-rand&gt; I&lt;files&gt;, B&lt;-writerand&gt; I&lt;file&gt;\n&quot;
+. &quot;\n&quot;
+. &quot;See L&lt;openssl(1)/Random State Options&gt; for details.&quot;;
+
+# Trusted certs options
+$OpenSSL::safe::opt_trust_synopsis = &quot;&quot;
+. &quot;[B&lt;-CAfile&gt; I&lt;file&gt;]\n&quot;
+. &quot;[B&lt;-no-CAfile&gt;]\n&quot;
+. &quot;[B&lt;-CApath&gt; I&lt;dir&gt;]\n&quot;
+. &quot;[B&lt;-no-CApath&gt;]&quot;;
+$OpenSSL::safe::opt_trust_item = &quot;&quot;
+. &quot;=item B&lt;-CAfile&gt; I&lt;file&gt;, B&lt;-no-CAfile&gt;, B&lt;-CApath&gt; I&lt;dir&gt;, B&lt;-no-CApath&gt;\n&quot;
+. &quot;\n&quot;
+. &quot;See L&lt;openssl(1)/Trusted Certificate Options&gt; for details.&quot;;
+
+# SSL connection options.
+# TODO(3.0) Not currently used.  The refactoring needs to be done, and
+# the options will probably be re-ordered.
+$OpenSSL::safe::opt_s_synopsis = &quot;&quot;
+. &quot;[B&lt;-bugs&gt;]\n&quot;
+. &quot;[B&lt;-no_comp&gt;]\n&quot;
+. &quot;[B&lt;-no_ticket&gt;]\n&quot;
+. &quot;[B&lt;-serverpref&gt;]\n&quot;
+. &quot;[B&lt;-legacy_renegotiation&gt;]\n&quot;
+. &quot;[B&lt;-no_renegotiation&gt;]\n&quot;
+. &quot;[B&lt;-legacy_server_connect&gt;]\n&quot;
+. &quot;[B&lt;-no_resumption_on_reneg&gt;]\n&quot;
+. &quot;[B&lt;-no_legacy_server_connect&gt;]\n&quot;
+. &quot;[B&lt;-allow_no_dhe_kex&gt;]\n&quot;
+. &quot;[B&lt;-prioritize_chacha&gt;]\n&quot;
+. &quot;[B&lt;-strict&gt;]\n&quot;
+. &quot;[B&lt;-sigalgs&gt; I&lt;algs&gt;]\n&quot;
+. &quot;[B&lt;-client_sigalgs&gt; I&lt;algs&gt;]\n&quot;
+. &quot;[B&lt;-groups&gt; I&lt;groups&gt;]\n&quot;
+. &quot;[B&lt;-curves&gt; I&lt;curves&gt;]\n&quot;
+. &quot;[B&lt;-named_curve&gt; I&lt;curves&gt;]\n&quot;
+. &quot;[B&lt;-cipher&gt; I&lt;ciphers&gt;]\n&quot;
+. &quot;[B&lt;-ciphersuites&gt; I&lt;1.3ciphers&gt;]\n&quot;
+. &quot;[B&lt;-min_protocol&gt; I&lt;minprot&gt;]\n&quot;
+. &quot;[B&lt;-max_protocol&gt; I&lt;maxprot&gt;]\n&quot;
+. &quot;[B&lt;-record_padding&gt; I&lt;padding&gt;]\n&quot;
+. &quot;[B&lt;-debug_broken_protocol&gt;]\n&quot;
+. &quot;[B&lt;-no_middlebox&gt;]&quot;;
+$OpenSSL::safe::opt_s_item = &quot;&quot;
+. &quot;=item B&lt;-bugs&gt;, B&lt;-no_comp&gt;, B&lt;-no_ticket&gt;, B&lt;-serverpref&gt;,&quot;
+. &quot;B&lt;-legacy_renegotiation&gt;, B&lt;-no_renegotiation&gt;, B&lt;-legacy_server_connect&gt;,\n&quot;
+. &quot;B&lt;-no_resumption_on_reneg&gt;, B&lt;-no_legacy_server_connect&gt;,\n&quot;
+. &quot;B&lt;-allow_no_dhe_kex&gt;, B&lt;-prioritize_chacha&gt;, B&lt;-strict&gt;, B&lt;-sigalgs&gt;\n&quot;
+. &quot;I&lt;algs&gt;, B&lt;-client_sigalgs&gt; I&lt;algs&gt;, B&lt;-groups&gt; I&lt;groups&gt;, B&lt;-curves&gt;\n&quot;
+. &quot;I&lt;curves&gt;, B&lt;-named_curve&gt; I&lt;curves&gt;, B&lt;-cipher&gt; I&lt;ciphers&gt;, B&lt;-ciphersuites&gt;\n&quot;
+. &quot;I&lt;1.3ciphers&gt;, B&lt;-min_protocol&gt; I&lt;minprot&gt;, B&lt;-max_protocol&gt; I&lt;maxprot&gt;,\n&quot;
+. &quot;B&lt;-record_padding&gt; I&lt;padding&gt;, B&lt;-debug_broken_protocol&gt;, B&lt;-no_middlebox&gt;\n&quot;
+. &quot;\n&quot;
+. &quot;See L&lt;SSL_CONF_cmd(3)/SUPPORTED COMMAND LINE COMMANDS&gt; for details.&quot;;
diff --git a/util/dofile.pl b/util/dofile.pl
index 9fa8684549..a82b987eba 100644
--- a/util/dofile.pl
+++ b/util/dofile.pl
@@ -20,30 +20,28 @@ use OpenSSL::fallback &quot;$FindBin::Bin/../external/perl/MODULES.txt&quot;;
 use Getopt::Std;
 use OpenSSL::Template;
 
-# We actually expect to get the following hash tables from configdata:
-#
-#    %config
-#    %target
-#    %withargs
-#    %unified_info
-#
-# We just do a minimal test to see that we got what we expected.
-# $config{target} must exist as an absolute minimum.
+# We expect to get a lot of information from configdata, so check that
+# it was part of our commandline.
 die &quot;You must run this script with -Mconfigdata\n&quot;
     if !exists($config{target});
 
 # Check options ######################################################
 
-my %opts = ();
-
 # -o ORIGINATOR
 #		declares ORIGINATOR as the originating script.
-getopt('o', \%opts);
+# -i .ext       Like Perl's edit-in-place -i flag
+my %opts = ();
+getopt('oi', \%opts);
 
-my @autowarntext = (&quot;WARNING: do not edit!&quot;,
-                    &quot;Generated&quot;
-                    . (defined($opts{o}) ? &quot; by &quot;.$opts{o} : &quot;&quot;)
-                    . (scalar(@ARGV) &gt; 0 ? &quot; from &quot;.join(&quot;, &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at ARGV</A>) : &quot;&quot;));
+my @autowarntext = (
+    &quot;WARNING: do not edit!&quot;,
+    &quot;Generated&quot;
+        . (defined($opts{o}) ? &quot; by $opts{o}&quot; : &quot;&quot;)
+        . (scalar(@ARGV) &gt; 0 ? &quot; from &quot; .join(&quot;, &quot;, @ARGV) : &quot;&quot;)
+);
+
+die &quot;Must have input files&quot;
+   if defined($opts{i}) and scalar(@ARGV) == 0;
 
 # Template setup #####################################################
 
@@ -52,6 +50,15 @@ my @template_settings =
     ? map { { TYPE =&gt; 'FILE', SOURCE =&gt; $_, FILENAME =&gt; $_ } } @ARGV
     : ( { TYPE =&gt; 'FILEHANDLE', SOURCE =&gt; \*STDIN, FILENAME =&gt; '&lt;stdin&gt;' } );
 
+# Error callback; print message, set status, return &quot;stop processing&quot;
+my $failed = 0;
+sub errorcallback {
+    my %args = @_;
+    print STDERR $args{error};
+    $failed++;
+    return undef;
+}
+
 # Engage! ############################################################
 
 my $prepend = &lt;&lt;&quot;_____&quot;;
@@ -65,17 +72,35 @@ _____
 
 foreach (@template_settings) {
     my $template = OpenSSL::Template-&gt;new(%$_);
-    $template-&gt;fill_in(%$_,
-                       OUTPUT =&gt; \*STDOUT,
+    die &quot;Couldn't create template: $Text::Template::ERROR&quot;
+        if !defined($template);
+
+    my $result = $template-&gt;fill_in(%$_,
                        HASH =&gt; { config =&gt; \%config,
                                  target =&gt; \%target,
                                  disabled =&gt; \%disabled,
                                  withargs =&gt; \%withargs,
                                  unified_info =&gt; \%unified_info,
                                  autowarntext =&gt; \@autowarntext },
+                       BROKEN =&gt; \&amp;errorcallback,
                        PREPEND =&gt; $prepend,
                        # To ensure that global variables and functions
                        # defined in one template stick around for the
                        # next, making them combinable
                        PACKAGE =&gt; 'OpenSSL::safe');
+    exit 1 if $failed;
+
+    if (defined($opts{i})) {
+        my $in = $_-&gt;{FILENAME};
+        my $out = $in;
+        $out =~ s/$opts{i}$//;
+        die &quot;Cannot replace file in-place $in&quot;
+            if $in eq $out;
+        open OFH, &quot;&gt;$out&quot;
+            or die &quot;Can't open $out, $!&quot;;
+        print OFH $result;
+        close OFH;
+    } else {
+        print $result;
+    }
 }
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025882.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="025889.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25888">[ date ]</a>
              <a href="thread.html#25888">[ thread ]</a>
              <a href="subject.html#25888">[ subject ]</a>
              <a href="author.html#25888">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
