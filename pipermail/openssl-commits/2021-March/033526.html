<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2021-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1616199662.359040.10961.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033525.html">
   <LINK REL="Next"  HREF="033542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Dr. Paul Dale</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1616199662.359040.10961.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">pauli at openssl.org
       </A><BR>
    <I>Sat Mar 20 00:21:02 UTC 2021</I>
    <P><UL>
        <LI>Previous message: <A HREF="033525.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="033542.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33526">[ date ]</a>
              <a href="thread.html#33526">[ thread ]</a>
              <a href="subject.html#33526">[ subject ]</a>
              <a href="author.html#33526">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  c38048e793e4cdf21759d4b068561d3bb0041ae6 (commit)
       via  b6d1bd4eb8662fb89911d5823d9454ca924878e7 (commit)
       via  72ded6f2a93085f536b4a820ab42b2da26fecf1c (commit)
       via  f1619160c89d5394f0cb9626d1198ef5180448db (commit)
       via  88ce406c895acf8d310835c3af628542364d8129 (commit)
       via  8f586f5bc10f86a064c74f06542b9da6cf137cc6 (commit)
       via  337ace06b9f112c5a5f540840814348ba17984d0 (commit)
       via  b6f0f546ff06fa9aa7e37c1a272e3a712c81fdc0 (commit)
       via  28c21fa048db0f1850e533c82a13d01c98de7ea1 (commit)
      from  07aa88cccf506c6143ec882a5dd93cd97483ecc2 (commit)


- Log -----------------------------------------------------------------
commit c38048e793e4cdf21759d4b068561d3bb0041ae6
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 17:59:34 2021 +1000

    sslapitest: fix problem in cleanup on failure path
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit b6d1bd4eb8662fb89911d5823d9454ca924878e7
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 13:35:59 2021 +1000

    evp: fix coverity 1473381 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit 72ded6f2a93085f536b4a820ab42b2da26fecf1c
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 13:25:11 2021 +1000

    x509: coverity 1472673 &amp; 1472693 - dereference after null checks
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit f1619160c89d5394f0cb9626d1198ef5180448db
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 13:09:06 2021 +1000

    test: coverity 1469426 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit 88ce406c895acf8d310835c3af628542364d8129
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 13:07:56 2021 +1000

    ssl: coverity 1465527 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit 8f586f5bc10f86a064c74f06542b9da6cf137cc6
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 13:05:37 2021 +1000

    test: coverity 1455749 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit 337ace06b9f112c5a5f540840814348ba17984d0
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 13:04:20 2021 +1000

    test: coverity 1455747 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit b6f0f546ff06fa9aa7e37c1a272e3a712c81fdc0
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 12:59:24 2021 +1000

    async: coverity 1446224 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

commit 28c21fa048db0f1850e533c82a13d01c98de7ea1
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">ppzgs1 at gmail.com</A>&gt;
Date:   Wed Mar 17 12:55:37 2021 +1000

    evp: fix coverity 1445872 - dereference after null check
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/14589">https://github.com/openssl/openssl/pull/14589</A>)

-----------------------------------------------------------------------

Summary of changes:
 crypto/async/async.c               |  5 ++++-
 crypto/evp/ctrl_params_translate.c | 10 ++++++++--
 crypto/evp/digest.c                |  7 ++++++-
 crypto/x509/x509_cmp.c             |  7 +++++--
 ssl/ssl_rsa.c                      |  3 +++
 test/evp_test.c                    | 14 ++++++++------
 test/sslapitest.c                  | 14 +++++++++-----
 7 files changed, 43 insertions(+), 17 deletions(-)

diff --git a/crypto/async/async.c b/crypto/async/async.c
index 2a51ee7bc2..53b25d7b4b 100644
--- a/crypto/async/async.c
+++ b/crypto/async/async.c
@@ -181,7 +181,7 @@ int ASYNC_start_job(ASYNC_JOB **job, ASYNC_WAIT_CTX *wctx, int *ret,
     if (ctx == NULL)
         return ASYNC_ERR;
 
-    if (*job)
+    if (*job != NULL)
         ctx-&gt;currjob = *job;
 
     for (;;) {
@@ -203,7 +203,10 @@ int ASYNC_start_job(ASYNC_JOB **job, ASYNC_WAIT_CTX *wctx, int *ret,
             }
 
             if (ctx-&gt;currjob-&gt;status == ASYNC_JOB_PAUSED) {
+                if (*job == NULL)
+                    return ASYNC_ERR;
                 ctx-&gt;currjob = *job;
+
                 /*
                  * Restore the default libctx to what it was the last time the
                  * fibre ran
diff --git a/crypto/evp/ctrl_params_translate.c b/crypto/evp/ctrl_params_translate.c
index 32af4eedd3..808804ab3a 100644
--- a/crypto/evp/ctrl_params_translate.c
+++ b/crypto/evp/ctrl_params_translate.c
@@ -1512,8 +1512,14 @@ static int get_payload_group_name(enum state state,
         return 0;
     }
 
-    if (ctx-&gt;p2 != NULL)
-        ctx-&gt;p1 = strlen(ctx-&gt;p2);
+    /*
+     * Quietly ignoring unknown groups matches the behaviour on the provider
+     * side.
+     */
+    if (ctx-&gt;p2 == NULL)
+        return 1;
+
+    ctx-&gt;p1 = strlen(ctx-&gt;p2);
     return default_fixup_args(state, translation, ctx);
 }
 
diff --git a/crypto/evp/digest.c b/crypto/evp/digest.c
index d256cbe140..494e0f5646 100644
--- a/crypto/evp/digest.c
+++ b/crypto/evp/digest.c
@@ -457,7 +457,12 @@ int EVP_DigestFinalXOF(EVP_MD_CTX *ctx, unsigned char *md, size_t size)
     OSSL_PARAM params[2];
     size_t i = 0;
 
-    if (ctx-&gt;digest == NULL || ctx-&gt;digest-&gt;prov == NULL)
+    if (ctx-&gt;digest == NULL) {
+        ERR_raise(ERR_LIB_EVP, EVP_R_INVALID_NULL_ALGORITHM);
+        return 0;
+    }
+
+    if (ctx-&gt;digest-&gt;prov == NULL)
         goto legacy;
 
     if (ctx-&gt;digest-&gt;dfinal == NULL) {
diff --git a/crypto/x509/x509_cmp.c b/crypto/x509/x509_cmp.c
index a149bf49dc..3ced70b21f 100644
--- a/crypto/x509/x509_cmp.c
+++ b/crypto/x509/x509_cmp.c
@@ -251,18 +251,21 @@ int X509_NAME_cmp(const X509_NAME *a, const X509_NAME *b)
         return -1;
 
     /* Ensure canonical encoding is present and up to date */
-    if (!a-&gt;canon_enc || a-&gt;modified) {
+    if (a-&gt;canon_enc == NULL || a-&gt;modified) {
         ret = i2d_X509_NAME((X509_NAME *)a, NULL);
         if (ret &lt; 0)
             return -2;
     }
 
-    if (!b-&gt;canon_enc || b-&gt;modified) {
+    if (b-&gt;canon_enc == NULL || b-&gt;modified) {
         ret = i2d_X509_NAME((X509_NAME *)b, NULL);
         if (ret &lt; 0)
             return -2;
     }
 
+    if (a-&gt;canon_enc == NULL || b-&gt;canon_enc == NULL)
+        return -2;
+
     ret = a-&gt;canon_enclen - b-&gt;canon_enclen;
     if (ret == 0 &amp;&amp; a-&gt;canon_enclen != 0)
         ret = memcmp(a-&gt;canon_enc, b-&gt;canon_enc, a-&gt;canon_enclen);
diff --git a/ssl/ssl_rsa.c b/ssl/ssl_rsa.c
index b78d751818..cf410d6d87 100644
--- a/ssl/ssl_rsa.c
+++ b/ssl/ssl_rsa.c
@@ -424,6 +424,9 @@ static int use_certificate_chain_file(SSL_CTX *ctx, SSL *ssl, const char *file)
     void *passwd_callback_userdata;
     SSL_CTX *real_ctx = (ssl == NULL) ? ctx : ssl-&gt;ctx;
 
+    if (ctx == NULL &amp;&amp; ssl == NULL)
+        return 0;
+
     ERR_clear_error();          /* clear error stack for
                                  * SSL_CTX_use_certificate() */
 
diff --git a/test/evp_test.c b/test/evp_test.c
index bd32ad5c7b..2bb837e6e7 100644
--- a/test/evp_test.c
+++ b/test/evp_test.c
@@ -1115,15 +1115,16 @@ static int mac_test_parse(EVP_TEST *t,
 static int mac_test_ctrl_pkey(EVP_TEST *t, EVP_PKEY_CTX *pctx,
                               const char *value)
 {
-    int rv;
+    int rv = 0;
     char *p, *tmpval;
 
     if (!TEST_ptr(tmpval = OPENSSL_strdup(value)))
         return 0;
     p = strchr(tmpval, ':');
-    if (p != NULL)
+    if (p != NULL) {
         *p++ = '\0';
-    rv = EVP_PKEY_CTX_ctrl_str(pctx, tmpval, p);
+        rv = EVP_PKEY_CTX_ctrl_str(pctx, tmpval, p);
+    }
     if (rv == -2)
         t-&gt;err = &quot;PKEY_CTRL_INVALID&quot;;
     else if (rv &lt;= 0)
@@ -1459,15 +1460,16 @@ static void pkey_test_cleanup(EVP_TEST *t)
 static int pkey_test_ctrl(EVP_TEST *t, EVP_PKEY_CTX *pctx,
                           const char *value)
 {
-    int rv;
+    int rv = 0;
     char *p, *tmpval;
 
     if (!TEST_ptr(tmpval = OPENSSL_strdup(value)))
         return 0;
     p = strchr(tmpval, ':');
-    if (p != NULL)
+    if (p != NULL) {
         *p++ = '\0';
-    rv = EVP_PKEY_CTX_ctrl_str(pctx, tmpval, p);
+        rv = EVP_PKEY_CTX_ctrl_str(pctx, tmpval, p);
+    }
     if (rv == -2) {
         t-&gt;err = &quot;PKEY_CTRL_INVALID&quot;;
         rv = 1;
diff --git a/test/sslapitest.c b/test/sslapitest.c
index b469d80a17..edaadb170f 100644
--- a/test/sslapitest.c
+++ b/test/sslapitest.c
@@ -625,10 +625,14 @@ static int test_client_cert_verify_cb(void)
 end:
     X509_free(crt1);
     X509_free(crt2);
-    SSL_shutdown(clientssl);
-    SSL_shutdown(serverssl);
-    SSL_free(serverssl);
-    SSL_free(clientssl);
+    if (clientssl != NULL) {
+        SSL_shutdown(clientssl);
+        SSL_free(clientssl);
+    }
+    if (serverssl != NULL) {
+        SSL_shutdown(serverssl);
+        SSL_free(serverssl);
+    }
     SSL_CTX_free(sctx);
     SSL_CTX_free(cctx);
 
@@ -8297,7 +8301,7 @@ static EVP_PKEY *get_tmp_dh_params(void)
         OSSL_PARAM_BLD_free_params(params);
     }
 
-    if (!EVP_PKEY_up_ref(tmp_dh_params))
+    if (tmp_dh_params != NULL &amp;&amp; !EVP_PKEY_up_ref(tmp_dh_params))
         return NULL;
 
     return tmp_dh_params;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033525.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="033542.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33526">[ date ]</a>
              <a href="thread.html#33526">[ thread ]</a>
              <a href="subject.html#33526">[ subject ]</a>
              <a href="author.html#33526">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
