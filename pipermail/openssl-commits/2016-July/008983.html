<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-July/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1468125716.411327.15370.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008963.html">
   <LINK REL="Next"  HREF="008985.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1468125716.411327.15370.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Sun Jul 10 04:41:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="008963.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="008985.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8983">[ date ]</a>
              <a href="thread.html#8983">[ thread ]</a>
              <a href="subject.html#8983">[ subject ]</a>
              <a href="author.html#8983">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  7498162d753fc21aa4a30cb0855479dac0515f5c (commit)
       via  9481a301e4736f24042ddeb2a75b52f02272e442 (commit)
       via  16dc790f47cd38b4d9e9cdefc6e6781075a773f4 (commit)
       via  1c450706da5e7d1c54f130d2f90657539c19d8cd (commit)
       via  afea0067ff1ef5040a5e3a7618d0007b3d4923c0 (commit)
       via  a90f8d7641d89bf36203784527b298c117e41335 (commit)
      from  7304e329bc3a91479ab77704a30d43fcc1376ea0 (commit)


- Log -----------------------------------------------------------------
commit 7498162d753fc21aa4a30cb0855479dac0515f5c
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Jul 9 11:06:44 2016 +0200

    VMS: Adjust the engines directory by adding the pointer size to its name
    
    With OpenSSL 1.1 and on, the engines are tightly tied to the shared
    library they're to be used with.  That makes them depend on the
    pointer size as well as the shared library version, and this gets
    reflected in the name of the directory they're installed in.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 9481a301e4736f24042ddeb2a75b52f02272e442
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jul 8 18:38:31 2016 +0200

    VMS: Small cleanups
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 16dc790f47cd38b4d9e9cdefc6e6781075a773f4
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jul 8 18:35:38 2016 +0200

    VMS: OSSL$EXE: needs to reflect that programs are installed in two places
    
    We're installing architecture dependent (compiled) programs in
    architecture specific directories, while architecture independent
    programs (scripts) get installed in the general programs directory.
    OSSL$EXE: reflects that by having two values.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 1c450706da5e7d1c54f130d2f90657539c19d8cd
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jul 8 18:34:21 2016 +0200

    VMS: Document the changed logical names in VMS/openssl_staryup.com.in
    
    Since there's been quite some changes, documentation needs updating
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit afea0067ff1ef5040a5e3a7618d0007b3d4923c0
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jul 8 18:30:43 2016 +0200

    VMS: Present OPENSSLDIR according to the VMS setup.
    
    This mostly affects 'openssl version -a', which might as well display
    what we're actually looking at.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit a90f8d7641d89bf36203784527b298c117e41335
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jul 8 18:27:56 2016 +0200

    VMS: Simplify the spec of the default certs &amp; keys area.
    
    We previously had a number of logical names for the different parts.
    There's really no need for that, the default directories are in one
    directory tree.  So we only define OSSL$DATAROOT: and make everything
    related to that one.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/descrip.mms.tmpl    | 13 +++++-----
 VMS/openssl_shutdown.com.in        |  1 +
 VMS/openssl_startup.com.in         | 49 ++++++++++++++++++++++----------------
 crypto/include/internal/cryptlib.h |  8 +++----
 4 files changed, 40 insertions(+), 31 deletions(-)

diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index c53c500..b3cf430 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -152,11 +152,13 @@ SYSTARTUP={- catdir($installtop, '[.SYS$STARTUP]'); -}
 OPENSSLDIR={- catdir($config{openssldir}) ||
               $config{prefix} ? catdir($config{prefix},&quot;COMMON&quot;)
                               : &quot;SYS\$COMMON:[OPENSSL-COMMON]&quot; -}
-# Where installed engines reside
-ENGINESDIR={- $osslprefix -}ENGINES{- $sover -}:
+# The same, but for C
+OPENSSLDIR_C={- $osslprefix -}DATAROOT:[000000]
+# Where installed engines reside, for C
+ENGINESDIR_C={- $osslprefix -}ENGINES{- $sover.$target{pointer_size} -}:
 
 CC= {- $target{cc} -}
-CFLAGS= /DEFINE=({- join(&quot;,&quot;, @{$target{defines}}, @{$config{defines}},&quot;OPENSSLDIR=\&quot;\&quot;\&quot;\$(OPENSSLDIR)\&quot;\&quot;\&quot;&quot;,&quot;ENGINESDIR=\&quot;\&quot;\&quot;\$(ENGINESDIR)\&quot;\&quot;\&quot;&quot;) -}) {- $target{cflags} -} {- $config{cflags} -}
+CFLAGS= /DEFINE=({- join(&quot;,&quot;, @{$target{defines}}, @{$config{defines}},&quot;OPENSSLDIR=\&quot;\&quot;\&quot;\$(OPENSSLDIR_C)\&quot;\&quot;\&quot;&quot;,&quot;ENGINESDIR=\&quot;\&quot;\&quot;\$(ENGINESDIR_C)\&quot;\&quot;\&quot;&quot;) -}) {- $target{cflags} -} {- $config{cflags} -}
 CFLAGS_Q=$(CFLAGS)
 DEPFLAG= /DEFINE=({- join(&quot;,&quot;, @{$config{depdefines}}) -})
 LDFLAGS= {- $target{lflags} -}
@@ -396,16 +398,15 @@ install_runtime : check_INSTALLTOP
         COPY/PROT=W:RE [.APPS]openssl.EXE -
                 ossl_installroot:[EXE.'arch']openssl{- $osslver -}.EXE
         @ ! Install scripts
-        - CREATE/DIR ossl_installroot:[EXE]
         COPY/PROT=W:RE $(BIN_SCRIPTS) ossl_installroot:[EXE]
         @ ! {- output_on() if $disabled{apps}; &quot;&quot; -}
 
 install_engines : check_INSTALLTOP
         @ {- output_off() unless scalar @{$unified_info{engines}}; &quot;&quot; -} !
         @ WRITE SYS$OUTPUT &quot;*** Installing engines&quot;
-        - CREATE/DIR ossl_installroot:[ENGINES{- $sover -}.'arch']
+        - CREATE/DIR ossl_installroot:[ENGINES{- $sover.$target{pointer_size} -}.'arch']
         {- join(&quot;\n        &quot;,
-                map { &quot;COPY/PROT=W:RE $_.EXE ossl_installroot:[ENGINES$sover.'arch']&quot; }
+                map { &quot;COPY/PROT=W:RE $_.EXE ossl_installroot:[ENGINES$sover$target{pointer_size}.'arch']&quot; }
                 grep(!m|ossltest$|i, @{$unified_info{engines}})) -}
         @ {- output_on() unless scalar @{$unified_info{engines}}; &quot;&quot; -} !
 
diff --git a/VMS/openssl_shutdown.com.in b/VMS/openssl_shutdown.com.in
index 81cf4ea..385903f 100644
--- a/VMS/openssl_shutdown.com.in
+++ b/VMS/openssl_shutdown.com.in
@@ -29,6 +29,7 @@ $	DEAS := DEASSIGN /NOLOG 'P1'
 $	sv   := {- sprintf &quot;%02d%02d&quot;, $config{shlib_major}, $config{shlib_minor} -}
 $	pz   := {- $config{pointer_size} -}
 $
+$	DEAS OSSL$DATAROOT
 $	DEAS OSSL$INSTROOT
 $	DEAS OSSL$INCLUDE
 $	DEAS OSSL$LIB
diff --git a/VMS/openssl_startup.com.in b/VMS/openssl_startup.com.in
index ca2220e..511c133 100644
--- a/VMS/openssl_startup.com.in
+++ b/VMS/openssl_startup.com.in
@@ -6,26 +6,33 @@ $	! defined by P1.
 $	!
 $	! The logical names created are:
 $	!
-$	!	OSSL$ROOTnnn	Installation root
-$	!	OSSL$EXEnnn	Where the executables are located
-$	!	OSSL$LIBnnn	Where the library files are located
-$	!	OSSL$SHAREnnn	Where the sahreable images are located
-$	!	OSSL$INCLUDEnnn	Include directory root
-$	!	OSSL$ENGINESnnn	Where the sahreable images are located
+$	!	OSSL$INSTROOT		Installation root
+$	!	OSSL$DATAROOT		Data root (common directory
+$	!				for certs etc)
+$	!	OSSL$INCLUDE		Include directory root
+$	!	OSSL$LIB		Where the static library files
+$	!				are located
+$	!	OSSL$SHARE		Where the shareable image files
+$	!				are located
+$	!	OSSL$EXE		Where the executables are located
+$	!	OSSL$ENGINESnnn		Where the shareable images are located
+$	!	OSSL$LIBCRYPTO		The static crypto library
+$	!	OSSL$LIBSSL		The static ssl library
+$	!	OSSL$LIBCRYPTOnnn_SHR	The shareable crypto image
+$	!	OSSL$LIBSSLnnn_SHR	The shareable ssl image
+$	!	OPENSSL			is OSSL$INCLUDE:[OPENSSL]
 $	!
 $	! In all these, nnn is the OpenSSL version number.  This allows
-$	! several OpenSSL versions to be installed simultaneously.
+$	! several OpenSSL versions to be installed simultaneously, which
+$	! matters for applications that are linked to the shareable images
+$	! or that depend on engines.
 $	!
 $	! In addition, unless P2 is &quot;NOALIASES&quot;, these logical names are
 $	! created:
 $	!
-$	!	OSSL$ROOT	Alias for OSSL$ROOTnnn
-$	!	OSSL$EXE	Alias for OSSL$EXEnnn
-$	!	OSSL$LIB	Alias for OSSL$LIBnnn
-$	!	OSSL$SHARE	Alias for OSSL$SHAREnnn
-$	!	OSSL$INCLUDE	Alias for OSSL$INCLUDEnnn
-$	!	OPENSSL		is OSSL$INCLUDE:[OPENSSL]
-$	!	OSSL$ENGINES	Alias for OSSL$ENGINESnnn
+$	!	OSSL$ENGINES		Alias for OSSL$ENGINESnnn
+$	!	OSSL$LIBCRYPTO_SHR	Alias for OSSL$LIBCRYPTOnnn_SHR
+$	!	OSSL$LIBSSL_SHR		Alias for OSSL$LIBSSLnnn_SHR
 $	!
 $	! P1	Qualifier(s) for DEFINE.  &quot;/SYSTEM&quot; would be typical when
 $	!	calling this script from SYS$STARTUP:SYSTARTUP_VMS.COM,
@@ -60,6 +67,7 @@ $	INSTALLTOP_ = F$PARSE(&quot;A.;&quot;,INSTALLTOP,,,&quot;NO_CONCEAL&quot;) -
 		     - &quot;.][000000&quot; - &quot;[000000.&quot; - &quot;][&quot; - &quot;]A.;&quot; + &quot;.&quot;
 $	OPENSSLDIR_ = F$PARSE(&quot;A.;&quot;,OPENSSLDIR,,,&quot;NO_CONCEAL&quot;) -
 		     - &quot;.][000000&quot; - &quot;[000000.&quot; - &quot;][&quot; - &quot;]A.;&quot; + &quot;.&quot;
+$
 $	DEFINE /TRANSLATION=CONCEALED /NOLOG WRK_INSTALLTOP 'INSTALLTOP_']
 $	DEFINE /TRANSLATION=CONCEALED /NOLOG WRK_OPENSSLDIR 'OPENSSLDIR_']
 $
@@ -83,12 +91,14 @@ $	DEF  := DEFINE /NOLOG 'P1'
 $	sv   := {- sprintf &quot;%02d%02d&quot;, $config{shlib_major}, $config{shlib_minor} -}
 $	pz   := {- $config{pointer_size} -}
 $
+$	DEFT OSSL$DATAROOT		'OPENSSLDIR_']
 $	DEFT OSSL$INSTROOT		'INSTALLTOP_']
 $	DEFT OSSL$INCLUDE		'INSTALLTOP_'INCLUDE.]
 $	DEF  OSSL$LIB			OSSL$INSTROOT:[LIB.'arch']
 $	DEF  OSSL$SHARE			OSSL$INSTROOT:[LIB.'arch']
-$	DEF  OSSL$ENGINES'sv'		OSSL$INSTROOT:[ENGINES'sv'.'arch']
-$	DEF  OSSL$EXE			OSSL$INSTROOT:[EXE.'arch']
+$	DEF  OSSL$ENGINES'sv''pz'	OSSL$INSTROOT:[ENGINES'sv''pz'.'arch']
+$	DEF  OSSL$EXE			OSSL$INSTROOT:[EXE.'arch'],-
+					OSSL$INSTROOT:[EXE]
 $	DEF  OSSL$LIBCRYPTO'pz'		OSSL$LIB:OSSL$LIBCRYPTO'pz'.OLB
 $	DEF  OSSL$LIBSSL'pz'		OSSL$LIB:OSSL$LIBSSL'pz'.OLB
 $	DEF  OSSL$LIBCRYPTO'sv'_SHR'pz'	OSSL$SHARE:OSSL$LIBCRYPTO'sv'_SHR'pz'.EXE
@@ -97,16 +107,13 @@ $	DEF  OPENSSL			OSSL$INCLUDE:[OPENSSL]
 $
 $	IF P2 .NES. &quot;NOALIASES&quot;
 $	THEN
-$	    DEF OSSL$ENGINES		OSSL$ENGINES'sv'
+$	    DEF OSSL$ENGINES'pz'	OSSL$ENGINES'sv''pz'
 $	    DEF OSSL$LIBCRYPTO_SHR'pz'	OSSL$LIBCRYPTO'sv'_SHR'pz'
 $	    DEF OSSL$LIBSSL_SHR'pz'	OSSL$LIBSSL'sv'_SHR'pz'
 $	ENDIF
 $
-$	DEFT OSSL$DATAROOT	'OPENSSLDIR_']
-$	DEF  OSSL$CERTS		OSSL$DATAROOT:[CERTS]
-$	DEF  OSSL$PRIVATE	OSSL$DATAROOT:[PRIVATE]
-$
 $ bailout:
 $	DEASSIGN WRK_INSTALLTOP
+$	DEASSIGN WRK_OPENSSLDIR
 $
 $	EXIT 'status'
diff --git a/crypto/include/internal/cryptlib.h b/crypto/include/internal/cryptlib.h
index 5270ee9..91267b7 100644
--- a/crypto/include/internal/cryptlib.h
+++ b/crypto/include/internal/cryptlib.h
@@ -47,10 +47,10 @@ DEFINE_LHASH_OF(MEM);
 #  define CTLOG_FILE              OPENSSLDIR &quot;/ct_log_list.cnf&quot;
 # else
 #  define X509_CERT_AREA          &quot;OSSL$DATAROOT:[000000]&quot;
-#  define X509_CERT_DIR           &quot;OSSL$CERTS:&quot;
-#  define X509_CERT_FILE          &quot;OSSL$DATAROOT:cert.pem&quot;
-#  define X509_PRIVATE_DIR        &quot;OSSL$PRIVATE:&quot;
-#  define CTLOG_FILE              &quot;OSSL$DATAROOT:ct_log_list.cnf&quot;
+#  define X509_CERT_DIR           &quot;OSSL$DATAROOT:[CERTS]&quot;
+#  define X509_CERT_FILE          &quot;OSSL$DATAROOT:[000000]cert.pem&quot;
+#  define X509_PRIVATE_DIR        &quot;OSSL$DATAROOT:[PRIVATE]&quot;
+#  define CTLOG_FILE              &quot;OSSL$DATAROOT:[000000]ct_log_list.cnf&quot;
 # endif
 
 # define X509_CERT_DIR_EVP        &quot;SSL_CERT_DIR&quot;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008963.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="008985.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8983">[ date ]</a>
              <a href="thread.html#8983">[ thread ]</a>
              <a href="subject.html#8983">[ subject ]</a>
              <a href="author.html#8983">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
