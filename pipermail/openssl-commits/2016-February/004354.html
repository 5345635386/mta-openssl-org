<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1456155894.895240.28291.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004352.html">
   <LINK REL="Next"  HREF="004355.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1456155894.895240.28291.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Mon Feb 22 15:44:54 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004352.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="004355.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4354">[ date ]</a>
              <a href="thread.html#4354">[ thread ]</a>
              <a href="subject.html#4354">[ subject ]</a>
              <a href="author.html#4354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  721f9058b398f05611c1d5ac4ff7cc464695dd1e (commit)
       via  00b0d6632bd4c0af84dc4e9e66d17a989ad58d00 (commit)
       via  93e3d3f3ff5013a900e1719bfc03794deb8db099 (commit)
       via  36a3090904877cde2a793488b8ef640c9d803fbd (commit)
       via  22bfe05efdda4239b200453b09ed0649319399a4 (commit)
       via  84af1bae68950a6993b56e39beff905d23fb74c8 (commit)
       via  9e04edf2f309e7edc3f4c9a09d444b2fd23a1e46 (commit)
      from  d784bcffa3dcd7ac4a0c77bfac4e686dcb771bd9 (commit)


- Log -----------------------------------------------------------------
commit 721f9058b398f05611c1d5ac4ff7cc464695dd1e
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 14:12:35 2016 +0100

    Clean away $no_dso since with have $disabled{dso}
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 00b0d6632bd4c0af84dc4e9e66d17a989ad58d00
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 14:10:45 2016 +0100

    Clean away $no_asm since with have $disabled{asm}
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 93e3d3f3ff5013a900e1719bfc03794deb8db099
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 14:06:16 2016 +0100

    Clean away $no_rfc3779 since we don't appear to use it at all
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 36a3090904877cde2a793488b8ef640c9d803fbd
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 14:04:45 2016 +0100

    Clean away $zlib since with have $disabled{zlib}
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 22bfe05efdda4239b200453b09ed0649319399a4
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 14:03:23 2016 +0100

    Clean away $no_threads since we have $disabled{threads}
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 84af1bae68950a6993b56e39beff905d23fb74c8
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 13:52:46 2016 +0100

    Clean away $config{no_shared} since we have $disabled{shared}
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 9e04edf2f309e7edc3f4c9a09d444b2fd23a1e46
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Feb 22 13:45:46 2016 +0100

    Expose %disables to the perl fragments in build.info files.
    
    This way, we can use them as conditions instead of relying to more or
    less obscure aliases in %config or variables directly in Configure.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/10-main.conf       |  2 +-
 Configurations/README             |  2 +-
 Configurations/common.tmpl        |  2 +-
 Configurations/descrip.mms.tmpl   | 16 ++++-----
 Configurations/unix-Makefile.tmpl | 16 ++++-----
 Configure                         | 68 ++++++++++++++++++---------------------
 Makefile.in                       |  2 +-
 VMS/openssl_shutdown.com.in       |  4 +--
 VMS/openssl_startup.com.in        |  4 +--
 9 files changed, 55 insertions(+), 61 deletions(-)

diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 312aac5..a3dfcfd 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -1163,7 +1163,7 @@
 #### MinGW
     &quot;mingw&quot; =&gt; {
         inherit_from     =&gt; [ asm(&quot;x86_asm&quot;),
-                              sub { $config{no_shared} ? () : &quot;x86_uplink&quot; } ],
+                              sub { $disabled{shared} ? () : &quot;x86_uplink&quot; } ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; &quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN -DUNICODE -D_UNICODE -m32 -Wall&quot;,
         debug_cflags     =&gt; &quot;-g -O0&quot;,
diff --git a/Configurations/README b/Configurations/README
index 454c8f3..c031884 100644
--- a/Configurations/README
+++ b/Configurations/README
@@ -430,7 +430,7 @@ example, the above would have &quot;something&quot; used, since 1 is true.
 Together with the use of Text::Template, this can be used as
 conditions based on something in the passed variables, for example:
 
-    IF[{- $config{no_shared} -}]
+    IF[{- $disabled{shared} -}]
       LIBS=libcrypto
       SOURCE[libcrypto]=...
     ELSE
diff --git a/Configurations/common.tmpl b/Configurations/common.tmpl
index 196441c..f8f37ae 100644
--- a/Configurations/common.tmpl
+++ b/Configurations/common.tmpl
@@ -54,7 +54,7 @@
  # built.
  sub dolib {
      my $lib = shift;
-     if (!$config{no_shared}) {
+     unless ($disabled{shared}) {
          my %ordinals =
              $unified_info{ordinals}-&gt;{$lib}
              ? (ordinals =&gt; $unified_info{ordinals}-&gt;{$lib}) : ();
diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index 279400c..c2eed11 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -296,12 +296,12 @@ install_dev : check_INSTALLTOP
         {- join(&quot;\n        &quot;,
                 map { &quot;COPY/PROT=W:R $_.OLB ossl_installroot:[LIB.'arch']&quot; }
                 @{$unified_info{libraries}}) -}
-        @ {- output_off() if $config{no_shared}; &quot;&quot; -} !
+        @ {- output_off() if $disabled{shared}; &quot;&quot; -} !
         {- join(&quot;\n        &quot;,
                 map { &quot;COPY/PROT=W:RE $_.EXE ossl_installroot:[LIB.'arch']&quot; }
                 map { $unified_info{sharednames}-&gt;{$_} || () }
                 @{$unified_info{libraries}}) -}
-        @ {- output_on() if $config{no_shared}; &quot;&quot; -} !
+        @ {- output_on() if $disabled{shared}; &quot;&quot; -} !
 
 install_runtime : check_INSTALLTOP
         @ WRITE SYS$OUTPUT &quot;*** Installing runtime files&quot;
@@ -363,7 +363,7 @@ vmsconfig.pm : configdata.pm
         WRITE CONFIG &quot;our %config = (&quot;
         WRITE CONFIG &quot;  target =&gt; '{- $config{target} -}',&quot;
         WRITE CONFIG &quot;  version =&gt; '$(MAJOR).$(MINOR)',&quot;
-        WRITE CONFIG &quot;  no_shared =&gt; '&quot;,&quot;{- $config{no_shared} -}&quot;,&quot;',&quot;
+        WRITE CONFIG &quot;  no_shared =&gt; '&quot;,&quot;{- $disabled{shared} -}&quot;,&quot;',&quot;
         WRITE CONFIG &quot;  INSTALLTOP =&gt; '$(INSTALLTOP)',&quot;
         WRITE CONFIG &quot;  OPENSSLDIR =&gt; '$(OPENSSLDIR)',&quot;
         WRITE CONFIG &quot;  pointersize =&gt; '&quot;,&quot;{- $target{pointersize} -}&quot;,&quot;',&quot;
@@ -470,10 +470,10 @@ EOF
       my $libn = basename($lib);
       (my $mkdef_key = $libn) =~ s/^${osslprefix_q}lib//i;
       my @deps = map {
-          $config{no_shared} ? $_.&quot;.OLB&quot;
+          $disabled{shared} ? $_.&quot;.OLB&quot;
               : $unified_info{sharednames}-&gt;{$_}.&quot;.EXE&quot;; } @{$args{deps}};
       my $deps = join(&quot;, -\n\t\t&quot;, @deps);
-      my $shlib_target = $config{no_shared} ? &quot;&quot; : $target{shared_target};
+      my $shlib_target = $disabled{shared} ? &quot;&quot; : $target{shared_target};
       my $ordinalsfile = defined($args{ordinals}) ? $args{ordinals}-&gt;[1] : &quot;&quot;;
       my $engine_opt = abs2rel(rel2abs(catfile($config{sourcedir},
                                                &quot;VMS&quot;, &quot;engine.opt&quot;)),
@@ -522,10 +522,10 @@ EOF
       (my $libn_nolib = $libn) =~ s/^lib//;
       my @objs = map { &quot;$_.OBJ&quot; } @{$args{objs}};
       my @deps = map {
-          $config{no_shared} ? $_.&quot;.OLB&quot;
+          $disabled{shared} ? $_.&quot;.OLB&quot;
               : $unified_info{sharednames}-&gt;{$_}.&quot;.EXE&quot;; } @{$args{deps}};
       my $deps = join(&quot;, -\n\t\t&quot;, @objs, @deps);
-      my $shlib_target = $config{no_shared} ? &quot;&quot; : $target{shared_target};
+      my $shlib_target = $disabled{shared} ? &quot;&quot; : $target{shared_target};
       my $engine_opt = abs2rel(rel2abs(catfile($config{sourcedir},
                                                &quot;VMS&quot;, &quot;engine.opt&quot;)),
                                rel2abs($config{builddir}));
@@ -572,7 +572,7 @@ EOF
       my $binn = basename($bin);
       my @objs = map { &quot;$_.OBJ&quot; } @{$args{objs}};
       my @deps = map {
-          $config{no_shared} ? $_.&quot;.OLB&quot;
+          $disabled{shared} ? $_.&quot;.OLB&quot;
               : $unified_info{sharednames}-&gt;{$_}.&quot;.EXE&quot;; } @{$args{deps}};
       my $deps = join(&quot;, -\n\t\t&quot;, @objs, @deps);
       # The &quot;[]&quot; hack is because in .OPT files, each line inherits the
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index b591c4d..339c733 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -34,12 +34,12 @@
      # removed.  On some systems, they may therefore return the exact same
      # string.
      sub shlib {
-         return () if $config{no_shared};
+         return () if $disabled{shared};
          my $lib = shift;
          return $unified_info{sharednames}-&gt;{$lib} . $shlibext;
      }
      sub shlib_simple {
-         return () if $config{no_shared};
+         return () if $disabled{shared};
 
          my $lib = shift;
          if (windowsdll()) {
@@ -320,7 +320,7 @@ install_dev:
 		mv -f $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/$$fn.new \
 		      $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/$$fn; \
 	done
-	@ : {- output_off() if $config{no_shared}; &quot;&quot; -}
+	@ : {- output_off() if $disabled{shared}; &quot;&quot; -}
 	@set -e; for s in $(SHLIB_INFO); do \
 		s1=`echo &quot;$$s&quot; | cut -f1 -d&quot;;&quot;`; \
 		s2=`echo &quot;$$s&quot; | cut -f2 -d&quot;;&quot;`; \
@@ -344,7 +344,7 @@ install_dev:
 		      $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/$$fn2; \
 		: {- output_on() unless windowsdll(); &quot;&quot; -}; \
 	done
-	@ : {- output_on() if $config{no_shared}; &quot;&quot; -}
+	@ : {- output_on() if $disabled{shared}; &quot;&quot; -}
 	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/pkgconfig
 	@echo &quot;install libcrypto.pc -&gt; $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/pkgconfig/libcrypto.pc&quot;
 	@cp libcrypto.pc $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/pkgconfig
@@ -371,7 +371,7 @@ uninstall_dev:
 		echo &quot;$(RM) $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/$$fn&quot;; \
 		$(RM) $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/$$fn; \
 	done
-	@ : {- output_off() if $config{no_shared}; &quot;&quot; -}
+	@ : {- output_off() if $disabled{shared}; &quot;&quot; -}
 	@set -e; for s in $(SHLIB_INFO); do \
 		s1=`echo &quot;$$s&quot; | cut -f1 -d&quot;;&quot;`; \
 		s2=`echo &quot;$$s&quot; | cut -f2 -d&quot;;&quot;`; \
@@ -389,7 +389,7 @@ uninstall_dev:
 		$(RM) $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/$$fn2; \
 		: {- output_on() unless windowsdll(); &quot;&quot; -}; \
 	done
-	@ : {- output_on() if $config{no_shared}; &quot;&quot; -}
+	@ : {- output_on() if $disabled{shared}; &quot;&quot; -}
 	@echo &quot;$(RM) $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/pkgconfig/libcrypto.pc&quot;
 	@$(RM) $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/pkgconfig/libcrypto.pc
 	@echo &quot;$(RM) $(DESTDIR)$(INSTALLTOP)/$(LIBDIR)/pkgconfig/libssl.pc&quot;
@@ -832,7 +832,7 @@ configdata.pm: {- $config{build_file_template} -} $(SRCDIR)/Configure $(SRCDIR)/
   # Helper function to figure out dependencies on libraries
   # It takes a list of library names and outputs a list of dependencies
   sub compute_lib_depends {
-      if ($config{no_shared}) {
+      if ($disabled{shared}) {
           return map { $_.$libext } @_;
       }
 
@@ -969,7 +969,7 @@ EOF
                                     $d = &quot;.&quot; if $d eq $f;
                                     (my $l = $f) =~ s/^lib//;
                                     &quot; -L$d -l$l&quot; } @{$args{deps}});
-      my $shlib_target = $config{no_shared} ? &quot;&quot; : $target{shared_target};
+      my $shlib_target = $disabled{shared} ? &quot;&quot; : $target{shared_target};
       return &lt;&lt;&quot;EOF&quot;;
 $bin$exeext: $objs $deps
 	\$(RM) $bin$exeext
diff --git a/Configure b/Configure
index 6b7165f..82086ed 100755
--- a/Configure
+++ b/Configure
@@ -208,13 +208,7 @@ $config{cross_compile_prefix}=&quot;&quot;;
 $config{fipslibdir}=&quot;/usr/local/ssl/fips-2.0/lib/&quot;;
 my $nofipscanistercheck=0;
 $config{baseaddr}=&quot;0xFB00000&quot;;
-my $no_threads=0;
 my $threads=0;
-$config{no_shared}=0; # but &quot;no-shared&quot; is default
-my $zlib=1;      # but &quot;no-zlib&quot; is default
-my $no_rfc3779=0;
-my $no_asm=0;
-my $no_dso=0;
 my $default_ranlib;
 $config{fips}=0;
 
@@ -334,20 +328,20 @@ my @deprecated_disablables = (
 
 # All of the following is disabled by default (RC5 was enabled before 0.9.8):
 
-my %disabled = ( # &quot;what&quot;         =&gt; &quot;comment&quot;
-		 &quot;ec_nistp_64_gcc_128&quot; =&gt; &quot;default&quot;,
-		 &quot;egd&quot;            =&gt; &quot;default&quot;,
-		 &quot;md2&quot;            =&gt; &quot;default&quot;,
-		 &quot;rc5&quot;            =&gt; &quot;default&quot;,
-		 &quot;sctp&quot;           =&gt; &quot;default&quot;,
-		 &quot;shared&quot;         =&gt; &quot;default&quot;,
-		 &quot;ssl-trace&quot;	  =&gt; &quot;default&quot;,
-		 &quot;static-engine&quot;  =&gt; &quot;default&quot;,
-		 &quot;unit-test&quot;	  =&gt; &quot;default&quot;,
-		 &quot;zlib&quot;           =&gt; &quot;default&quot;,
-		 &quot;crypto-mdebug&quot;  =&gt; &quot;default&quot;,
-		 &quot;heartbeats&quot;     =&gt; &quot;default&quot;,
-	       );
+our %disabled = ( # &quot;what&quot;         =&gt; &quot;comment&quot;
+		  &quot;ec_nistp_64_gcc_128&quot; =&gt; &quot;default&quot;,
+		  &quot;egd&quot;            =&gt; &quot;default&quot;,
+		  &quot;md2&quot;            =&gt; &quot;default&quot;,
+		  &quot;rc5&quot;            =&gt; &quot;default&quot;,
+		  &quot;sctp&quot;           =&gt; &quot;default&quot;,
+		  &quot;shared&quot;         =&gt; &quot;default&quot;,
+		  &quot;ssl-trace&quot;      =&gt; &quot;default&quot;,
+		  &quot;static-engine&quot;  =&gt; &quot;default&quot;,
+		  &quot;unit-test&quot;      =&gt; &quot;default&quot;,
+		  &quot;zlib&quot;           =&gt; &quot;default&quot;,
+		  &quot;crypto-mdebug&quot;  =&gt; &quot;default&quot;,
+		  &quot;heartbeats&quot;     =&gt; &quot;default&quot;,
+		);
 
 # Note: =&gt; pair form used for aesthetics, not to truly make a hash table
 my @disable_cascades = (
@@ -780,15 +774,15 @@ foreach (sort (keys %disabled))
 	printf &quot;    no-%-12s %-10s&quot;, $_, &quot;[$disabled{$_}]&quot;;
 
 	if (/^dso$/)
-		{ $no_dso = 1; }
+		{ }
 	elsif (/^threads$/)
-		{ $no_threads = 1; }
+		{ }
 	elsif (/^shared$/)
-		{ $config{no_shared} = 1; }
+		{ }
 	elsif (/^pic$/)
 		{ }
 	elsif (/^zlib$/)
-		{ $zlib = 0; }
+		{ }
 	elsif (/^dynamic-engine$/)
 		{ }
 	elsif (/^zlib-dynamic$/)
@@ -813,7 +807,6 @@ foreach (sort (keys %disabled))
 			print &quot; OPENSSL_NO_$ALGO&quot;;
 
 			if (/^err$/)	{ push @user_defines, &quot;OPENSSL_NO_ERR&quot;; }
-			elsif (/^asm$/)	{ $no_asm = 1; }
 			}
 		else
 			{
@@ -920,7 +913,7 @@ if ($target =~ /^mingw/ &amp;&amp; `$target{cc} --target-help 2&gt;&amp;1` =~ m/-mno-cygwin/m)
 	$target{shared_ldflag} .= &quot; -mno-cygwin&quot;;
 	}
 
-if ($target =~ /linux.*-mips/ &amp;&amp; !$no_asm &amp;&amp; $user_cflags !~ /-m(ips|arch=)/) {
+if ($target =~ /linux.*-mips/ &amp;&amp; !$disabled{asm} &amp;&amp; $user_cflags !~ /-m(ips|arch=)/) {
 	# minimally required architecture flags for assembly modules
 	$config{cflags}=&quot;-mips2 $config{cflags}&quot; if ($target =~ /mips32/);
 	$config{cflags}=&quot;-mips3 $config{cflags}&quot; if ($target =~ /mips64/);
@@ -936,7 +929,7 @@ my $no_user_defines=0;
 # has support compiled in for them. Currently each method is enabled
 # by a define &quot;DSO_&lt;name&gt;&quot; ... we translate the &quot;dso_scheme&quot; config
 # string entry into using the following logic;
-if (!$no_dso &amp;&amp; $target{dso_scheme} ne &quot;&quot;)
+if (!$disabled{dso} &amp;&amp; $target{dso_scheme} ne &quot;&quot;)
 	{
 	$target{dso_scheme} =~ tr/[a-z]/[A-Z]/;
 	if ($target{dso_scheme} eq &quot;DLFCN&quot;)
@@ -957,7 +950,7 @@ if (!$no_dso &amp;&amp; $target{dso_scheme} ne &quot;&quot;)
 
 my $thread_cflags = &quot;&quot;;
 my @thread_defines;
-if ($target{thread_cflag} ne &quot;(unknown)&quot; &amp;&amp; !$no_threads)
+if ($target{thread_cflag} ne &quot;(unknown)&quot; &amp;&amp; !$disabled{threads})
 	{
 	# If we know how to do it, support threads by default.
 	$threads = 1;
@@ -983,7 +976,7 @@ else
 
 $config{ex_libs}=&quot;$libs$config{ex_libs}&quot; if ($libs ne &quot;&quot;);
 
-if ($no_asm)
+if ($disabled{asm})
 	{
 	@{$config{defines}} = grep !/^[BL]_ENDIAN$/, @{$config{defines}}
 	    if ($config{fips});
@@ -996,7 +989,7 @@ if ($threads)
 	push @{$config{openssl_thread_defines}}, @thread_defines;
 	}
 
-if ($zlib)
+unless ($disabled{zlib})
 	{
 	push @{$config{defines}}, &quot;ZLIB&quot;;
 	if (defined($disabled{&quot;zlib-dynamic&quot;}))
@@ -1024,9 +1017,9 @@ if (defined($disabled{&quot;deprecated&quot;})) {
 if ($target{shared_target} eq &quot;&quot;)
 	{
 	$no_shared_warn = 1
-	    if ((!$config{no_shared} || !$disabled{&quot;dynamic-engine&quot;})
+	    if ((!$disabled{shared} || !$disabled{&quot;dynamic-engine&quot;})
 		&amp;&amp; !$config{fips});
-	$config{no_shared} = 1;
+	$disabled{shared} = &quot;no-shared-target&quot;;
 	$disabled{pic} = $disabled{shared} = $disabled{&quot;dynamic-engine&quot;} =
 	    &quot;no-shared-target&quot;;
 	}
@@ -1060,7 +1053,7 @@ if ($target{ranlib} eq &quot;&quot;)
 	$target{ranlib} = $default_ranlib;
 	}
 
-if (!$no_asm) {
+unless ($disabled{asm}) {
     $target{cpuid_asm_src}=$table{BASE}-&gt;{cpuid_asm_src} if ($config{processor} eq &quot;386&quot;);
     $target{bn_asm_src} =~ s/\w+-gf2m.c// if (defined($disabled{ec2m}));
 
@@ -1301,6 +1294,7 @@ if ($builder eq &quot;unified&quot;) {
             split /^/m,
             $template-&gt;fill_in(HASH =&gt; { config =&gt; \%config,
                                          target =&gt; \%target,
+                                         disabled =&gt; \%disabled,
                                          builddir =&gt; abs2rel($buildd, $blddir),
                                          sourcedir =&gt; abs2rel($sourced, $blddir),
                                          buildtop =&gt; abs2rel($blddir, $blddir),
@@ -1446,7 +1440,7 @@ EOF
 
         push @{$unified_info{rawlines}}, @rawlines;
 
-        if (!$config{no_shared}) {
+        unless ($disabled{shared}) {
             # Check sharednames.
             foreach (keys %sharednames) {
                 my $dest = cleanfile($buildd, $_, $blddir);
@@ -1875,7 +1869,7 @@ print &lt;&lt;&quot;EOF&quot;;
 Configured for $target.
 EOF
 
-print &lt;&lt;&quot;EOF&quot; if (!$no_threads &amp;&amp; !$threads);
+print &lt;&lt;&quot;EOF&quot; if (!$disabled{threads} &amp;&amp; !$threads);
 
 The library could not be configured for supporting multi-threaded
 applications as the compiler options required on this system are not known.
@@ -1934,14 +1928,14 @@ exit(0);
 # Configuration file reading #########################################
 
 # Helper function to implement conditional inheritance depending on the
-# value of $no_asm.  Used in inherit_from values as follows:
+# value of $disabled{asm}.  Used in inherit_from values as follows:
 #
 #      inherit_from =&gt; [ &quot;template&quot;, asm(&quot;asm_tmpl&quot;) ]
 #
 sub asm {
     my @x = @_;
     sub {
-	$no_asm ? () : @x;
+	$disabled{asm} ? () : @x;
     }
 }
 
diff --git a/Makefile.in b/Makefile.in
index 9cca221..9513003 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -193,7 +193,7 @@ TOP=    .
 LIBS=   libcrypto.a libssl.a
 SHARED_CRYPTO=libcrypto$(SHLIB_EXT)
 SHARED_SSL=libssl$(SHLIB_EXT)
-SHARED_LIBS={- '$(SHARED_CRYPTO) $(SHARED_SSL)' if (!$config{no_shared}) -}
+SHARED_LIBS={- '$(SHARED_CRYPTO) $(SHARED_SSL)' unless $disabled{shared} -}
 SHARED_CFLAG={- $target{shared_cflag} -}
 SHARED_LDFLAG={- $target{shared_ldflag}
                  # Unlike other OSes (like Solaris, Linux, Tru64,
diff --git a/VMS/openssl_shutdown.com.in b/VMS/openssl_shutdown.com.in
index 85cc26d..236979e 100644
--- a/VMS/openssl_shutdown.com.in
+++ b/VMS/openssl_shutdown.com.in
@@ -39,7 +39,7 @@ $	DEAS OSSL$LIB'v'
 $	DEAS OSSL$SHARE'v'
 $	DEAS OSSL$ENGINES'v'
 $	DEAS OSSL$EXE'v'
-$       {- output_off() if $config{no_shared} -}
+$       {- output_off() if $disabled{shared} -}
 $       {- join(&quot;\n\$       &quot;, map { &quot;DEAS $_'v'&quot; } map { $unified_info{sharednames}-&gt;{$_} || () } @{$unified_info{libraries}}) -}
 $       {- output_on() -}
 $	IF P2 .NES. &quot;NOALIASES&quot;
@@ -51,7 +51,7 @@ $	    DEAS OSSL$SHARE
 $	    DEAS OSSL$ENGINES
 $	    DEAS OSSL$EXE
 $	    DEAS OPENSSL
-$           {- output_off() if $config{no_shared} -}
+$           {- output_off() if $disabled{shared} -}
 $           {- join(&quot;\n\$           &quot;, map { &quot;DEAS $_&quot; } map { $unified_info{sharednames}-&gt;{$_} || () } @{$unified_info{libraries}}) -}
 $           {- output_on() -}
 $	ENDIF
diff --git a/VMS/openssl_startup.com.in b/VMS/openssl_startup.com.in
index a968b44..be3f385 100644
--- a/VMS/openssl_startup.com.in
+++ b/VMS/openssl_startup.com.in
@@ -88,7 +88,7 @@ $	DEF  OSSL$LIB'v'	OSSL$INSTROOT:['arch'.LIB]
 $	DEF  OSSL$SHARE'v'	OSSL$INSTROOT:['arch'.LIB]
 $	DEF  OSSL$ENGINES'v'	OSSL$INSTROOT:['arch'.ENGINES]
 $	DEF  OSSL$EXE'v'	OSSL$INSTROOT:['arch'.EXE]
-$       {- output_off() if $config{no_shared} -}
+$       {- output_off() if $disabled{shared} -}
 $       {- join(&quot;\n\$       &quot;, map { &quot;DEF  $_'v' OSSL\$SHARE:$_&quot; } map { $unified_info{sharednames}-&gt;{$_} || () } @{$unified_info{libraries}}) -}
 $       {- output_on() -}
 $	IF P2 .NES. &quot;NOALIASES&quot;
@@ -100,7 +100,7 @@ $	    DEF OSSL$SHARE	OSSL$SHARE'v'
 $	    DEF OSSL$ENGINES	OSSL$ENGINES'v'
 $	    DEF OSSL$EXE	OSSL$EXE'v'
 $	    DEF OPENSSL		OSSL$INCLUDE:[OPENSSL]
-$       {- output_off() if $config{no_shared} -}
+$       {- output_off() if $disabled{shared} -}
 $       {- join(&quot;\n\$           &quot;, map { &quot;DEF  $_ $_'v'&quot; } map { $unified_info{sharednames}-&gt;{$_} || () } @{$unified_info{libraries}}) -}
 $       {- output_on() -}
 $	ENDIF
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004352.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="004355.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4354">[ date ]</a>
              <a href="thread.html#4354">[ thread ]</a>
              <a href="subject.html#4354">[ subject ]</a>
              <a href="author.html#4354">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
