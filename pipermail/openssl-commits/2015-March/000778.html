<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1427222867.914600.16461.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000777.html">
   <LINK REL="Next"  HREF="000779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1427222867.914600.16461.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Tue Mar 24 18:47:47 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000777.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="000779.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#778">[ date ]</a>
              <a href="thread.html#778">[ thread ]</a>
              <a href="subject.html#778">[ subject ]</a>
              <a href="author.html#778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  e30a64fae76a3eea6e512eacd06aa5e487427fbc (commit)
       via  fa327fafe2184e6f1d7f3f2a663d00034c5d22b3 (commit)
      from  e5991ec528b1c339062440811e2641f5ea2b328b (commit)


- Log -----------------------------------------------------------------
commit e30a64fae76a3eea6e512eacd06aa5e487427fbc
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Tue Mar 24 15:11:29 2015 +0100

    Update ordinals
    
    Thanks to the change of mkdef.pl, a few more deprecated functions were
    properly defined in util/libeay.num.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;

commit fa327fafe2184e6f1d7f3f2a663d00034c5d22b3
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Tue Mar 24 15:02:51 2015 +0100

    Teach mkdef.pl to handle multiline declarations.
    
    For the moment, this is specially crafted for DECLARE_DEPRECATED because
    that's where we found the problem, but it can easily be expanded to other
    types of special delarations when needed.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 util/libeay.num |  8 ++++----
 util/mkdef.pl   | 19 ++++++++++++++++---
 2 files changed, 20 insertions(+), 7 deletions(-)

diff --git a/util/libeay.num b/util/libeay.num
index 623f639..957ef3f 100755
--- a/util/libeay.num
+++ b/util/libeay.num
@@ -126,7 +126,7 @@ BN_gcd                                  131	EXIST::FUNCTION:
 BN_generate_prime                       132	EXIST::FUNCTION:DEPRECATED
 BN_get_word                             133	EXIST::FUNCTION:
 BN_is_bit_set                           134	EXIST::FUNCTION:
-BN_is_prime                             135	NOEXIST::FUNCTION:
+BN_is_prime                             135	EXIST::FUNCTION:DEPRECATED
 BN_lshift                               136	EXIST::FUNCTION:
 BN_lshift1                              137	EXIST::FUNCTION:
 BN_mask_bits                            138	EXIST::FUNCTION:
@@ -1744,7 +1744,7 @@ X509_REQ_add1_attr_by_txt               2217	EXIST::FUNCTION:
 X509_ATTRIBUTE_create_by_txt            2218	EXIST::FUNCTION:
 X509at_add1_attr_by_txt                 2219	EXIST::FUNCTION:
 BN_pseudo_rand                          2239	EXIST::FUNCTION:
-BN_is_prime_fasttest                    2240	NOEXIST::FUNCTION:
+BN_is_prime_fasttest                    2240	EXIST::FUNCTION:DEPRECATED
 BN_CTX_end                              2241	EXIST::FUNCTION:
 BN_CTX_start                            2242	EXIST::FUNCTION:
 BN_CTX_get                              2243	EXIST::FUNCTION:
@@ -2900,7 +2900,7 @@ STORE_method_set_list_start_function    3336	NOEXIST::FUNCTION:
 BN_BLINDING_invert_ex                   3337	EXIST::FUNCTION:
 NAME_CONSTRAINTS_free                   3338	EXIST::FUNCTION:
 STORE_ATTR_INFO_set_number              3339	NOEXIST::FUNCTION:
-BN_BLINDING_get_thread_id               3340	NOEXIST::FUNCTION:
+BN_BLINDING_get_thread_id               3340	EXIST::FUNCTION:DEPRECATED
 X509_STORE_CTX_set0_param               3341	EXIST::FUNCTION:
 POLICY_MAPPING_it                       3342	EXIST:!EXPORT_VAR_AS_FUNCTION:VARIABLE:
 POLICY_MAPPING_it                       3342	EXIST:EXPORT_VAR_AS_FUNCTION:FUNCTION:
@@ -3368,7 +3368,7 @@ pqueue_insert                           3766	EXIST::FUNCTION:
 pitem_free                              3767	EXIST::FUNCTION:
 BN_GF2m_mod_inv_arr                     3768	EXIST::FUNCTION:EC2M
 ENGINE_unregister_ECDSA                 3769	EXIST::FUNCTION:ENGINE
-BN_BLINDING_set_thread_id               3770	NOEXIST::FUNCTION:
+BN_BLINDING_set_thread_id               3770	EXIST::FUNCTION:DEPRECATED
 get_rfc3526_prime_8192                  3771	EXIST::FUNCTION:
 X509_VERIFY_PARAM_clear_flags           3772	EXIST::FUNCTION:
 get_rfc2409_prime_1024                  3773	EXIST::FUNCTION:
diff --git a/util/mkdef.pl b/util/mkdef.pl
index b549a60..1d47561 100755
--- a/util/mkdef.pl
+++ b/util/mkdef.pl
@@ -487,7 +487,14 @@ sub do_defs
 		while(&lt;IN&gt;) {
 			if($parens &gt; 0) {
 				#Inside a DECLARE_DEPRECATED
-				$parens += count_parens($_);
+				$stored_multiline .= $_;
+				chomp $stored_multiline;
+				print STDERR &quot;DEBUG: Continuing multiline DEPRECATED: $stored_multiline\n&quot; if $debug;
+				$parens = count_parens($stored_multiline);
+				if ($parens == 0) {
+					$stored_multiline =~ /^\s*DECLARE_DEPRECATED\s*\(\s*(\w*(\s|\*|\w)*)/;
+					$def .= &quot;$1(void);&quot;;
+				}
 				next;
 			}
 			if (/\/\* Error codes for the \w+ functions\. \*\//)
@@ -881,9 +888,15 @@ sub do_defs
 						      &quot;EXPORT_VAR_AS_FUNCTION&quot;,
 						      &quot;FUNCTION&quot;);
 				} elsif (/^\s*DECLARE_DEPRECATED\s*\(\s*(\w*(\s|\*|\w)*)/) {
-					$def .= &quot;$1(void);&quot;;
 					$parens = count_parens($_);
-					next;
+					if ($parens == 0) {
+						$def .= &quot;$1(void);&quot;;
+					} else {
+						$stored_multiline = $_;
+						chomp $stored_multiline;
+						print STDERR &quot;DEBUG: Found multiline DEPRECATED starting with: $stored_multiline\n&quot; if $debug;
+						next;
+					}
 				} elsif ($tag{'CONST_STRICT'} != 1) {
 					if (/\{|\/\*|\([^\)]*$/) {
 						$line = $_;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000777.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="000779.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#778">[ date ]</a>
              <a href="thread.html#778">[ thread ]</a>
              <a href="subject.html#778">[ subject ]</a>
              <a href="author.html#778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
