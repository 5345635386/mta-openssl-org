<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2018-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1519765575.626463.23124.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018264.html">
   <LINK REL="Next"  HREF="018267.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1519765575.626463.23124.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Tue Feb 27 21:06:15 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="018264.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="018267.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18266">[ date ]</a>
              <a href="thread.html#18266">[ thread ]</a>
              <a href="subject.html#18266">[ subject ]</a>
              <a href="author.html#18266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  22defb43507ce026a9eb717df433f1ba7531ffe7 (commit)
      from  4c861b381667b8e496483bf89f72674ad7e5fc25 (commit)


- Log -----------------------------------------------------------------
commit 22defb43507ce026a9eb717df433f1ba7531ffe7
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
Date:   Tue Feb 27 15:14:18 2018 -0500

    Make some perl scripts output to stdout
    
    And only generate one output &quot;file&quot; at a time for objects.pl
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5432">https://github.com/openssl/openssl/pull/5432</A>)

-----------------------------------------------------------------------

Summary of changes:
 Configurations/unix-Makefile.tmpl |  9 ++++++--
 crypto/objects/obj_dat.pl         | 45 ++++++++++++++++++---------------------
 crypto/objects/objects.pl         | 35 ++++++++++++++++--------------
 3 files changed, 47 insertions(+), 42 deletions(-)

diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index 78b1a5e..6c0eb42 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -651,13 +651,18 @@ generate_crypto_bn:
 	( cd $(SRCDIR); $(PERL) crypto/bn/bn_prime.pl &gt; crypto/bn/bn_prime.h )
 
 generate_crypto_objects:
+	( cd $(SRCDIR); $(PERL) crypto/objects/objects.pl -n \
+				crypto/objects/objects.txt \
+				crypto/objects/obj_mac.num \
+				&gt; crypto/objects/obj_mac.new &amp;&amp; \
+	    mv crypto/objects/obj_mac.new crypto/objects/obj_mac.num )
 	( cd $(SRCDIR); $(PERL) crypto/objects/objects.pl \
 				crypto/objects/objects.txt \
 				crypto/objects/obj_mac.num \
-				include/openssl/obj_mac.h )
+				&gt; include/openssl/obj_mac.h )
 	( cd $(SRCDIR); $(PERL) crypto/objects/obj_dat.pl \
 				include/openssl/obj_mac.h \
-				crypto/objects/obj_dat.h )
+				&gt; crypto/objects/obj_dat.h )
 	( cd $(SRCDIR); $(PERL) crypto/objects/objxref.pl \
 				crypto/objects/obj_mac.num \
 				crypto/objects/obj_xref.txt \
diff --git a/crypto/objects/obj_dat.pl b/crypto/objects/obj_dat.pl
index 392617c..e80900d 100644
--- a/crypto/objects/obj_dat.pl
+++ b/crypto/objects/obj_dat.pl
@@ -152,8 +152,7 @@ for (my $i = 0; $i &lt; $n; $i++) {
 }
 
 # Finally ready to generate the output.
-open(OUT, &quot;&gt;$ARGV[1]&quot;) || die &quot;Can't open output file $ARGV[1], $!&quot;;
-print OUT &lt;&lt;&quot;EOF&quot;;
+print &lt;&lt;&quot;EOF&quot;;
 /*
  * WARNING: do not edit!
  * Generated by crypto/objects/obj_dat.pl
@@ -167,44 +166,44 @@ print OUT &lt;&lt;&quot;EOF&quot;;
 
 EOF
 
-print OUT &quot;/* Serialized OID's */\n&quot;;
-printf OUT &quot;static const unsigned char so[%d] = {\n&quot;, $lvalues + 1;
-print OUT @lvalues;
-print OUT &quot;};\n\n&quot;;
+print &quot;/* Serialized OID's */\n&quot;;
+printf &quot;static const unsigned char so[%d] = {\n&quot;, $lvalues + 1;
+print @lvalues;
+print &quot;};\n\n&quot;;
 
-printf OUT &quot;#define NUM_NID %d\n&quot;, $n;
-printf OUT &quot;static const ASN1_OBJECT nid_objs[NUM_NID] = {\n&quot;;
-print OUT @out;
-print  OUT &quot;};\n\n&quot;;
+printf &quot;#define NUM_NID %d\n&quot;, $n;
+printf &quot;static const ASN1_OBJECT nid_objs[NUM_NID] = {\n&quot;;
+print @out;
+print  &quot;};\n\n&quot;;
 
 {
     no warnings &quot;uninitialized&quot;;
     @a = grep(defined $sn{$nid{$_}}, 0 .. $n);
 }
-printf OUT &quot;#define NUM_SN %d\n&quot;, $#a + 1;
-printf OUT &quot;static const unsigned int sn_objs[NUM_SN] = {\n&quot;;
+printf &quot;#define NUM_SN %d\n&quot;, $#a + 1;
+printf &quot;static const unsigned int sn_objs[NUM_SN] = {\n&quot;;
 foreach (sort { $sn{$nid{$a}} cmp $sn{$nid{$b}} } @a) {
-    printf OUT &quot;    %4d,    /* \&quot;$sn{$nid{$_}}\&quot; */\n&quot;, $_;
+    printf &quot;    %4d,    /* \&quot;$sn{$nid{$_}}\&quot; */\n&quot;, $_;
 }
-print  OUT &quot;};\n\n&quot;;
+print  &quot;};\n\n&quot;;
 
 {
     no warnings &quot;uninitialized&quot;;
     @a = grep(defined $ln{$nid{$_}}, 0 .. $n);
 }
-printf OUT &quot;#define NUM_LN %d\n&quot;, $#a + 1;
-printf OUT &quot;static const unsigned int ln_objs[NUM_LN] = {\n&quot;;
+printf &quot;#define NUM_LN %d\n&quot;, $#a + 1;
+printf &quot;static const unsigned int ln_objs[NUM_LN] = {\n&quot;;
 foreach (sort { $ln{$nid{$a}} cmp $ln{$nid{$b}} } @a) {
-    printf OUT &quot;    %4d,    /* \&quot;$ln{$nid{$_}}\&quot; */\n&quot;, $_;
+    printf &quot;    %4d,    /* \&quot;$ln{$nid{$_}}\&quot; */\n&quot;, $_;
 }
-print  OUT &quot;};\n\n&quot;;
+print  &quot;};\n\n&quot;;
 
 {
     no warnings &quot;uninitialized&quot;;
     @a = grep(defined $obj{$nid{$_}}, 0 .. $n);
 }
-printf OUT &quot;#define NUM_OBJ %d\n&quot;, $#a + 1;
-printf OUT &quot;static const unsigned int obj_objs[NUM_OBJ] = {\n&quot;;
+printf &quot;#define NUM_OBJ %d\n&quot;, $#a + 1;
+printf &quot;static const unsigned int obj_objs[NUM_OBJ] = {\n&quot;;
 
 # Compare DER; prefer shorter; if some length, use the &quot;smaller&quot; encoding.
 sub obj_cmp
@@ -224,8 +223,6 @@ foreach (sort obj_cmp @a) {
     my $v = $objd{$m};
     $v =~ s/L//g;
     $v =~ s/,/ /g;
-    printf OUT &quot;    %4d,    /* %-32s %s */\n&quot;, $_, $m, $v;
+    printf &quot;    %4d,    /* %-32s %s */\n&quot;, $_, $m, $v;
 }
-print  OUT &quot;};\n&quot;;
-
-close OUT;
+print  &quot;};\n&quot;;
diff --git a/crypto/objects/objects.pl b/crypto/objects/objects.pl
index 20f726d..8f9b67f 100644
--- a/crypto/objects/objects.pl
+++ b/crypto/objects/objects.pl
@@ -6,7 +6,12 @@
 # in the file LICENSE in the source distribution or at
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
-# Output year depends on the year of the script and the input files.
+use Getopt::Std;
+
+our($opt_n);
+getopts('n');
+
+# Output year depends on the year of the script and the input file.
 my $YEAR = [localtime([stat($0)]-&gt;[9])]-&gt;[5] + 1900;
 my $iYEAR = [localtime([stat($ARGV[0])]-&gt;[9])]-&gt;[5] + 1900;
 $YEAR = $iYEAR if $iYEAR &gt; $YEAR;
@@ -123,15 +128,15 @@ print STDERR &quot;Added OID $Cname\n&quot;;
 	}
 close IN;
 
-open (NUMOUT,&quot;&gt;$ARGV[1]&quot;) || die &quot;Can't open output file $ARGV[1]&quot;;
-foreach (sort { $a &lt;=&gt; $b } keys %nidn)
-	{
-	print NUMOUT $nidn{$_},&quot;\t\t&quot;,$_,&quot;\n&quot;;
-	}
-close NUMOUT;
+if ( $opt_n ) {
+    foreach (sort { $a &lt;=&gt; $b } keys %nidn)
+            {
+            print $nidn{$_},&quot;\t\t&quot;,$_,&quot;\n&quot;;
+            }
+    exit;
+}
 
-open (OUT,&quot;&gt;$ARGV[2]&quot;) || die &quot;Can't open output file $ARGV[2]&quot;;
-print OUT &lt;&lt;&quot;EOF&quot;;
+print &lt;&lt;&quot;EOF&quot;;
 /*
  * WARNING: do not edit!
  * Generated by crypto/objects/objects.pl
@@ -161,15 +166,13 @@ sub expand
 foreach (sort { $a &lt;=&gt; $b } keys %ordern)
 	{
 	$Cname=$ordern{$_};
-	print OUT &quot;\n&quot;;
-	print OUT expand(&quot;#define SN_$Cname\t\t\&quot;$sn{$Cname}\&quot;\n&quot;) if $sn{$Cname} ne &quot;&quot;;
-	print OUT expand(&quot;#define LN_$Cname\t\t\&quot;$ln{$Cname}\&quot;\n&quot;) if $ln{$Cname} ne &quot;&quot;;
-	print OUT expand(&quot;#define NID_$Cname\t\t$nid{$Cname}\n&quot;) if $nid{$Cname} ne &quot;&quot;;
-	print OUT expand(&quot;#define OBJ_$Cname\t\t$obj{$Cname}\n&quot;) if $obj{$Cname} ne &quot;&quot;;
+	print &quot;\n&quot;;
+	print expand(&quot;#define SN_$Cname\t\t\&quot;$sn{$Cname}\&quot;\n&quot;) if $sn{$Cname} ne &quot;&quot;;
+	print expand(&quot;#define LN_$Cname\t\t\&quot;$ln{$Cname}\&quot;\n&quot;) if $ln{$Cname} ne &quot;&quot;;
+	print expand(&quot;#define NID_$Cname\t\t$nid{$Cname}\n&quot;) if $nid{$Cname} ne &quot;&quot;;
+	print expand(&quot;#define OBJ_$Cname\t\t$obj{$Cname}\n&quot;) if $obj{$Cname} ne &quot;&quot;;
 	}
 
-close OUT;
-
 sub process_oid
 	{
 	local($oid)=@_;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018264.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="018267.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18266">[ date ]</a>
              <a href="thread.html#18266">[ thread ]</a>
              <a href="subject.html#18266">[ subject ]</a>
              <a href="author.html#18266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
