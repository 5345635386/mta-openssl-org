<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2017-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1512689788.887980.28142.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017095.html">
   <LINK REL="Next"  HREF="017103.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1512689788.887980.28142.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Thu Dec  7 23:36:28 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="017095.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="017103.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17101">[ date ]</a>
              <a href="thread.html#17101">[ thread ]</a>
              <a href="subject.html#17101">[ subject ]</a>
              <a href="author.html#17101">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  e7a206694451be19432d079691610994473f53b7 (commit)
       via  99aeeecb9f59ab6d6cdb13ed07a30c11e89a32e7 (commit)
       via  a064c6158e2deb706a09dd8ca95523c97ecbfb2d (commit)
       via  17f1661724480b720f718d455b997b5fa52be424 (commit)
       via  1786733e51d1aa9fc0ef70a20fef148bf78694d6 (commit)
       via  89bea0830de908c6713166ff376ab767b91a2dfd (commit)
       via  7ecdf18d80cba14ad1afa6c0d18574d2ad2929c3 (commit)
      from  e84282cbdafe0b4e49742106974ff8ee28087875 (commit)


- Log -----------------------------------------------------------------
commit e7a206694451be19432d079691610994473f53b7
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Nov 30 21:48:04 2017 +0100

    Document how the configuration option 'reconf' works
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

commit 99aeeecb9f59ab6d6cdb13ed07a30c11e89a32e7
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Nov 30 21:46:53 2017 +0100

    Configure: die if there are other arguments with 'reconf'
    
    It's better to inform the user about this than silently ignoring
    something that the user might expect to work, somehow.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

commit a064c6158e2deb706a09dd8ca95523c97ecbfb2d
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Nov 30 08:20:02 2017 +0100

    Make sure ./config passes options to ./Configure correctly
    
    This is, even when they contain spaces or all kinds of funny quotes
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

commit 17f1661724480b720f718d455b997b5fa52be424
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Nov 29 17:41:10 2017 +0100

    Have all relevant config targets use the env() function rather than $ENV
    
    This way, any of the relevant environment variables for the platform
    being configured are preserved and don't have to be recalled manually
    when reconfiguring.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

commit 1786733e51d1aa9fc0ef70a20fef148bf78694d6
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Nov 29 13:23:07 2017 +0100

    Document the possibility for command line argument env assignments
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

commit 89bea0830de908c6713166ff376ab767b91a2dfd
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Nov 29 13:16:53 2017 +0100

    Make it possible to add env var assignments as Configure options
    
    In other words, make the following possible:
    
        ./config CC=clang
    
    or
    
        ./Configure CC=clang linux-x86_64
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

commit 7ecdf18d80cba14ad1afa6c0d18574d2ad2929c3
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Nov 29 13:09:01 2017 +0100

    Save away the environment variables we rely on
    
    There are cases when we overwrite %ENV values, and while this is
    perfectly fine on some platforms, it isn't on others, because the
    Configure script isn't necessarely run in a separate process, and
    thus, changing %ENV may very well change the environment of the
    calling shell.  VMS is such a platform.
    
    Furthermore, saving away values that we use also allow us to save them
    in configdata.pm in an effective way, and recall those values just as
    effectively when reconfiguring.  Also, this makes sure that we do use
    the saved away values when reconfiguring, when the actual environment
    variables might otherwise affect us.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/4818">https://github.com/openssl/openssl/pull/4818</A>)

-----------------------------------------------------------------------

Summary of changes:
 CHANGES                     |  4 +++
 Configurations/10-main.conf | 38 ++++++++++----------
 Configure                   | 86 +++++++++++++++++++++++++++++----------------
 INSTALL                     | 24 +++++++++++++
 config                      |  7 ++--
 5 files changed, 108 insertions(+), 51 deletions(-)

diff --git a/CHANGES b/CHANGES
index cbae96d..691cbcd 100644
--- a/CHANGES
+++ b/CHANGES
@@ -9,6 +9,10 @@
 
  Changes between 1.1.0f and 1.1.1 [xx XXX xxxx]
 
+  *) Make it possible to have environment variable assignments as
+     arguments to config / Configure.
+     [Richard Levitte]
+
   *) Add multi-prime RSA (RFC 8017) support.
      [Paul Yang]
 
diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index f8f4bd1..28cfd30 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -53,14 +53,14 @@ my $vc_wince_info = {};
 sub vc_wince_info {
     unless (%$vc_wince_info) {
         # sanity check
-        $die-&gt;('%OSVERSION% is not defined') if (!defined($ENV{'OSVERSION'}));
-        $die-&gt;('%PLATFORM% is not defined')  if (!defined($ENV{'PLATFORM'}));
-        $die-&gt;('%TARGETCPU% is not defined') if (!defined($ENV{'TARGETCPU'}));
+        $die-&gt;('%OSVERSION% is not defined') if (!defined(env('OSVERSION')));
+        $die-&gt;('%PLATFORM% is not defined')  if (!defined(env('PLATFORM')));
+        $die-&gt;('%TARGETCPU% is not defined') if (!defined(env('TARGETCPU')));
 
         #
         # Idea behind this is to mimic flags set by eVC++ IDE...
         #
-        my $wcevers = $ENV{'OSVERSION'};                    # WCENNN
+        my $wcevers = env('OSVERSION');                     # WCENNN
 	my $wcevernum;
 	my $wceverdotnum;
 	if ($wcevers =~ /^WCE([1-9])([0-9]{2})$/) {
@@ -74,12 +74,12 @@ sub vc_wince_info {
         my $wcecdefs = &quot;-D_WIN32_WCE=$wcevernum -DUNDER_CE=$wcevernum&quot;; # -D_WIN32_WCE=NNN
         my $wcelflag = &quot;/subsystem:windowsce,$wceverdotnum&quot;;        # ...,N.NN
 
-        my $wceplatf =  $ENV{'PLATFORM'};
+        my $wceplatf =  env('PLATFORM');
 
         $wceplatf =~ tr/a-z0-9 /A-Z0-9_/;
         $wcecdefs .= &quot; -DWCE_PLATFORM_$wceplatf&quot;;
 
-        my $wcetgt = $ENV{'TARGETCPU'};                     # just shorter name...
+        my $wcetgt = env('TARGETCPU');                      # just shorter name...
       SWITCH: for($wcetgt) {
           /^X86/        &amp;&amp; do { $wcecdefs.=&quot; -Dx86 -D_X86_ -D_i386_ -Di_386_&quot;;
                                 $wcelflag.=&quot; /machine:X86&quot;;     last; };
@@ -1407,9 +1407,9 @@ sub vms_info {
             picker(default =&gt;
                    combine('/W3 /WX /GF /Gy /nologo -DUNICODE -D_UNICODE -DOPENSSL_SYS_WINCE -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -DDSO_WIN32 -DNO_CHMOD -DOPENSSL_SMALL_FOOTPRINT',
                            sub { vc_wince_info()-&gt;{cflags}; },
-                           sub { defined($ENV{'WCECOMPAT'})
+                           sub { defined(env('WCECOMPAT'))
                                      ? '-I$(WCECOMPAT)/include' : (); },
-                           sub { defined($ENV{'PORTSDK_LIBPATH'})
+                           sub { defined(env('PORTSDK_LIBPATH'))
                                      ? '-I$(PORTSDK_LIBPATH)/../../include' : (); },
                            sub { `cl 2&gt;&amp;1` =~ /Version ([0-9]+)\./ &amp;&amp; $1&gt;=14
                                      ? ($disabled{shared} ? &quot; /MT&quot; : &quot; /MD&quot;)
@@ -1418,7 +1418,7 @@ sub vms_info {
                    release =&gt; &quot;/O1i&quot;),
         lflags           =&gt; combine(&quot;/nologo /opt:ref&quot;,
                                     sub { vc_wince_info()-&gt;{lflags}; },
-                                    sub { defined($ENV{PORTSDK_LIBPATH})
+                                    sub { defined(env('PORTSDK_LIBPATH'))
                                               ? &quot;/entry:mainCRTstartup&quot; : (); }),
         sys_id           =&gt; &quot;WINCE&quot;,
         bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
@@ -1426,9 +1426,9 @@ sub vms_info {
             my @ex_libs = ();
             push @ex_libs, 'ws2.lib' unless $disabled{sock};
             push @ex_libs, 'crypt32.lib';
-            if (defined($ENV{WCECOMPAT})) {
+            if (defined(env('WCECOMPAT'))) {
                 my $x = '$(WCECOMPAT)/lib';
-                if (-f &quot;$x/$ENV{TARGETCPU}/wcecompatex.lib&quot;) {
+                if (-f &quot;$x/env('TARGETCPU')/wcecompatex.lib&quot;) {
                     $x .= '/$(TARGETCPU)/wcecompatex.lib';
                 } else {
                     $x .= '/wcecompatex.lib';
@@ -1436,9 +1436,9 @@ sub vms_info {
                 push @ex_libs, $x;
             }
             push @ex_libs, '$(PORTSDK_LIBPATH)/portlib.lib'
-                if (defined($ENV{'PORTSDK_LIBPATH'}));
+                if (defined(env('PORTSDK_LIBPATH')));
             push @ex_libs, ' /nodefaultlib coredll.lib corelibc.lib'
-                if ($ENV{'TARGETCPU'} eq &quot;X86&quot;);
+                if (env('TARGETCPU') eq &quot;X86&quot;);
             return @ex_libs;
         }),
         build_scheme     =&gt; add(&quot;VC-WCE&quot;, { separator =&gt; undef }),
@@ -1738,35 +1738,35 @@ sub vms_info {
 #### uClinux
     &quot;uClinux-dist&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;$ENV{'CC'}&quot;,
+        cc               =&gt; sub { env('CC') },
         cflags           =&gt; combine(&quot;\$(CFLAGS)&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         plib_lflags      =&gt; &quot;\$(LDFLAGS)&quot;,
         ex_libs          =&gt; add(&quot;\$(LDLIBS)&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
-        dso_scheme       =&gt; &quot;$ENV{'LIBSSL_dlfcn'}&quot;,
+        dso_scheme       =&gt; sub { env('LIBSSL_dlfcn') },
         shared_target    =&gt; &quot;linux-shared&quot;,
         shared_cflag     =&gt; &quot;-fPIC&quot;,
         shared_ldflag    =&gt; &quot;-shared&quot;,
         shared_extension =&gt; &quot;.so.\$(SHLIB_VERSION_NUMBER)&quot;,
-        ranlib           =&gt; &quot;$ENV{'RANLIB'}&quot;,
+        ranlib           =&gt; sub { env('RANLIB') },
     },
     &quot;uClinux-dist64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;$ENV{'CC'}&quot;,
+        cc               =&gt; sub { env('CC') },
         cflags           =&gt; combine(&quot;\$(CFLAGS)&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         plib_lflags      =&gt; &quot;\$(LDFLAGS)&quot;,
         ex_libs          =&gt; add(&quot;\$(LDLIBS)&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
-        dso_scheme       =&gt; &quot;$ENV{'LIBSSL_dlfcn'}&quot;,
+        dso_scheme       =&gt; sub { env('LIBSSL_dlfcn') },
         shared_target    =&gt; &quot;linux-shared&quot;,
         shared_cflag     =&gt; &quot;-fPIC&quot;,
         shared_ldflag    =&gt; &quot;-shared&quot;,
         shared_extension =&gt; &quot;.so.\$(SHLIB_VERSION_NUMBER)&quot;,
-        ranlib           =&gt; &quot;$ENV{'RANLIB'}&quot;,
+        ranlib           =&gt; sub { env('RANLIB') },
     },
 
     ##### VMS
diff --git a/Configure b/Configure
index 0bdc110..2690493 100755
--- a/Configure
+++ b/Configure
@@ -211,6 +211,8 @@ $config{builddir} = abs2rel($blddir);
 my @argvcopy=@ARGV;
 
 if (grep /^reconf(igure)?$/, @argvcopy) {
+    die &quot;reconfiguring with other arguments present isn't supported&quot;
+        if scalar @argvcopy &gt; 1;
     if (-f &quot;./configdata.pm&quot;) {
 	my $file = &quot;./configdata.pm&quot;;
 	unless (my $return = do $file) {
@@ -223,25 +225,12 @@ if (grep /^reconf(igure)?$/, @argvcopy) {
 	    @{$configdata::config{perlargv}} : ();
 	die &quot;Incorrect data to reconfigure, please do a normal configuration\n&quot;
 	    if (grep(/^reconf/<A HREF="../../../mailman/listinfo/openssl-commits.html">, at argvcopy</A>));
-	$ENV{CROSS_COMPILE} = $configdata::config{cross_compile_prefix}
-	    if defined($configdata::config{cross_compile_prefix});
-	$ENV{CC} = $configdata::config{cc}
-	    if defined($configdata::config{cc});
-	$ENV{CXX} = $configdata::config{cxx}
-	    if defined($configdata::config{cxx});
-	$ENV{BUILDFILE} = $configdata::config{build_file}
-	    if defined($configdata::config{build_file});
-	$ENV{$local_config_envname} = $configdata::config{local_config_dir}
-	    if defined($configdata::config{local_config_dir});
+	$config{perlenv} = $configdata::config{perlenv} // {};
 
 	print &quot;Reconfiguring with: &quot;, join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at argvcopy</A>), &quot;\n&quot;;
-	print &quot;    CROSS_COMPILE = &quot;,$ENV{CROSS_COMPILE},&quot;\n&quot;
-	    if $ENV{CROSS_COMPILE};
-	print &quot;    CC = &quot;,$ENV{CC},&quot;\n&quot; if $ENV{CC};
-	print &quot;    CXX = &quot;,$ENV{CXX},&quot;\n&quot; if $ENV{CXX};
-	print &quot;    BUILDFILE = &quot;,$ENV{BUILDFILE},&quot;\n&quot; if $ENV{BUILDFILE};
-	print &quot;    $local_config_envname = &quot;,$ENV{$local_config_envname},&quot;\n&quot;
-	    if $ENV{$local_config_envname};
+	foreach (sort keys %{$config{perlenv}}) {
+	    print &quot;    $_ = $config{perlenv}-&gt;{$_}\n&quot;;
+	}
     } else {
 	die &quot;Insufficient data to reconfigure, please do a normal configuration\n&quot;;
     }
@@ -280,13 +269,13 @@ foreach (sort glob($pattern)) {
     &amp;read_config($_);
 }
 
-if (defined $ENV{$local_config_envname}) {
+if (defined env($local_config_envname)) {
     if ($^O eq 'VMS') {
         # VMS environment variables are logical names,
         # which can be used as is
         $pattern = $local_config_envname . ':' . '*.conf';
     } else {
-        $pattern = catfile($ENV{$local_config_envname}, '*.conf');
+        $pattern = catfile(env($local_config_envname), '*.conf');
     }
 
     foreach (sort glob($pattern)) {
@@ -551,6 +540,14 @@ my @seed_sources = ();
 while (@argvcopy)
 	{
 	$_ = shift @argvcopy;
+
+	# Support env variable assignments among the options
+	if (m|^(\w+)=(.+)?$|)
+		{
+		$config{perlenv}-&gt;{$1} = $2;
+		next;
+		}
+
 	# VMS is a case insensitive environment, and depending on settings
 	# out of our control, we may receive options uppercased.  Let's
 	# downcase at least the part before any equal sign.
@@ -982,7 +979,7 @@ $target{dso_extension}=$target{shared_extension_simple};
     if ($config{target} =~ /^(?:Cygwin|mingw)/);
 
 
-$config{cross_compile_prefix} = $ENV{'CROSS_COMPILE'}
+$config{cross_compile_prefix} = env('CROSS_COMPILE')
     if $config{cross_compile_prefix} eq &quot;&quot;;
 
 # Allow overriding the names of some tools.  USE WITH CARE
@@ -990,19 +987,19 @@ $config{cross_compile_prefix} = $ENV{'CROSS_COMPILE'}
 # the default string.
 $config{perl} =    ($^O ne &quot;VMS&quot; ? $^X : &quot;perl&quot;);
 $config{hashbangperl} =
-    $ENV{'HASHBANGPERL'}           || $ENV{'PERL'}     || &quot;/usr/bin/env perl&quot;;
-$target{cc} =      $ENV{'CC'}      || $target{cc}      || &quot;cc&quot;;
-$target{cxx} =     $ENV{'CXX'}     || $target{cxx}     || &quot;c++&quot;;
-$target{ranlib} =  $ENV{'RANLIB'}  || $target{ranlib}  ||
+    env('HASHBANGPERL')           || env('PERL')      || &quot;/usr/bin/env perl&quot;;
+$target{cc} =      env('CC')      || $target{cc}      || &quot;cc&quot;;
+$target{cxx} =     env('CXX')     || $target{cxx}     || &quot;c++&quot;;
+$target{ranlib} =  env('RANLIB')  || $target{ranlib}  ||
                    (which(&quot;$config{cross_compile_prefix}ranlib&quot;) ?
                           &quot;\$(CROSS_COMPILE)ranlib&quot; : &quot;true&quot;);
-$target{ar} =      $ENV{'AR'}      || $target{ar}      || &quot;ar&quot;;
-$target{nm} =      $ENV{'NM'}      || $target{nm}      || &quot;nm&quot;;
+$target{ar} =      env('AR')      || $target{ar}      || &quot;ar&quot;;
+$target{nm} =      env('NM')      || $target{nm}      || &quot;nm&quot;;
 $target{rc} =
-    $ENV{'RC'}  || $ENV{'WINDRES'} || $target{rc}      || &quot;windres&quot;;
+    env('RC')  || env('WINDRES')  || $target{rc}      || &quot;windres&quot;;
 
 # Allow overriding the build file name
-$target{build_file} = $ENV{BUILDFILE} || $target{build_file} || &quot;Makefile&quot;;
+$target{build_file} = env('BUILDFILE') || $target{build_file} || &quot;Makefile&quot;;
 
 # Cache information necessary for reconfiguration
 $config{cc} = $target{cc};
@@ -1418,7 +1415,7 @@ if ($builder eq &quot;unified&quot;) {
     my @build_file_templates = ();
 
     # First, look in the user provided directory, if given
-    if (defined $ENV{$local_config_envname}) {
+    if (defined env($local_config_envname)) {
 	@build_file_templates =
 	    map {
 		if ($^O eq 'VMS') {
@@ -1426,7 +1423,7 @@ if ($builder eq &quot;unified&quot;) {
 		    # which can be used as is
 		    $local_config_envname . ':' . $_;
 		} else {
-		    catfile($ENV{$local_config_envname}, $_);
+		    catfile(env($local_config_envname), $_);
 		}
 	    }
 	    @build_file_template_names;
@@ -2009,6 +2006,22 @@ foreach (sort keys %config) {
 	print OUT &quot;  &quot;, $_, &quot; =&gt; [ &quot;, join(&quot;, &quot;,
 					   map { quotify(&quot;perl&quot;, $_) }
 					   @{$config{$_}}), &quot; ],\n&quot;;
+    } elsif (ref($config{$_}) eq &quot;HASH&quot;) {
+	print OUT &quot;  &quot;, $_, &quot; =&gt; {&quot;;
+        if (scalar keys %{$config{$_}} &gt; 0) {
+            print OUT &quot;\n&quot;;
+            foreach my $key (sort keys %{$config{$_}}) {
+                print OUT &quot;      &quot;,
+                    join(&quot; =&gt; &quot;,
+                         quotify(&quot;perl&quot;, $key),
+                         defined $config{$_}-&gt;{$key}
+                             ? quotify(&quot;perl&quot;, $config{$_}-&gt;{$key})
+                             : &quot;undef&quot;);
+                print OUT &quot;,\n&quot;;
+            }
+            print OUT &quot;  &quot;;
+        }
+        print OUT &quot;},\n&quot;;
     } else {
 	print OUT &quot;  &quot;, $_, &quot; =&gt; &quot;, quotify(&quot;perl&quot;, $config{$_}), &quot;,\n&quot;
     }
@@ -2522,6 +2535,19 @@ sub which
     }
 }
 
+sub env
+{
+    my $name = shift;
+
+    # Note that if $ENV{$name} doesn't exist or is undefined,
+    # $config{perlenv}-&gt;{$name} will be created with the value
+    # undef.  This is intentional.
+
+    $config{perlenv}-&gt;{$name} = $ENV{$name}
+        if ! exists $config{perlenv}-&gt;{$name};
+    return $config{perlenv}-&gt;{$name};
+}
+
 # Configuration printer ##############################################
 
 sub print_table_entry
diff --git a/INSTALL b/INSTALL
index 9e67014..5583817 100644
--- a/INSTALL
+++ b/INSTALL
@@ -532,6 +532,30 @@
                    passed through as they are to the compiler as well.  Again,
                    consult your compiler documentation.
 
+  VAR=value
+                   Assignment if environment variable for Configure.  These
+                   work just like normal environment variable assignments,
+                   but are supported on all platforms and are confined to
+                   the configuration scripts only.  These assignments override
+                   the corresponding value in the inherited environment, if
+                   there is one.
+
+  reconf
+  reconfigure
+                   Reconfigure from earlier data.  This fetches the previous
+                   command line options and environment from data saved in
+                   &quot;configdata.pm&quot;, and runs the configuration process again,
+                   using these options and environment.
+                   Note: NO other option is permitted together with &quot;reconf&quot;.
+                   This means that you also MUST use &quot;./Configure&quot; (or
+                   what corresponds to that on non-Unix platforms) directly
+                   to invoke this option.
+                   Note: The original configuration saves away values for ALL
+                   environment variables that were used, and if they weren't
+                   defined, they are still saved away with information that
+                   they weren't originally defined.  This information takes
+                   precedence over environment variables that are defined
+                   when reconfiguring.
 
  Installation in Detail
  ----------------------
diff --git a/config b/config
index a341af2..00f9087 100755
--- a/config
+++ b/config
@@ -35,7 +35,8 @@ See INSTALL for instructions.
 
 EOF
 ;;
-*) options=$options&quot; $i&quot; ;;
+*)  i=`echo &quot;$i&quot; | sed -e &quot;s|'|'\\\\\\''|g&quot;`
+    options=&quot;$options '$i'&quot; ;;
 esac
 done
 
@@ -902,7 +903,9 @@ if [ $? = &quot;0&quot; ]; then
     echo $PERL $THERE/Configure $OUT $options
   fi  
   if [ &quot;$DRYRUN&quot; = &quot;false&quot; ]; then
-    $PERL $THERE/Configure $OUT $options
+    # eval to make sure quoted options, possibly with spaces inside,
+    # are treated right
+    eval $PERL $THERE/Configure $OUT $options
   fi
 else
   echo &quot;This system ($OUT) is not supported. See file INSTALL for details.&quot;
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017095.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="017103.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17101">[ date ]</a>
              <a href="thread.html#17101">[ thread ]</a>
              <a href="subject.html#17101">[ subject ]</a>
              <a href="author.html#17101">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
