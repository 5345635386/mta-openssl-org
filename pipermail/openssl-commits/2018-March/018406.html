<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2018-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1520526258.261452.9349.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018405.html">
   <LINK REL="Next"  HREF="018412.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1520526258.261452.9349.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Thu Mar  8 16:24:18 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="018405.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="018412.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18406">[ date ]</a>
              <a href="thread.html#18406">[ thread ]</a>
              <a href="subject.html#18406">[ subject ]</a>
              <a href="author.html#18406">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  b92013602b6666314ad200d48e10a1aaa2c5b2fa (commit)
       via  310f28df2e5317a96a4390117af17dab34706d67 (commit)
       via  150624bcf54c285183f596976641d57e3cb9a52f (commit)
       via  2ab92ae9dca7c4a9dc3b8468333b10aff7629c5a (commit)
       via  72d7f221ee7a3909496c240bab85770b48b515dd (commit)
       via  b6954f3b3f9f18d885a521d6581d1b442c1d04ac (commit)
       via  abe256e7951e6d57f8f6b4364ea696eb4ead3852 (commit)
       via  48dcca265c9cb0c26459240ab1858577dacf9e67 (commit)
      from  d420729b9e709b7a6fc227a073f526d86d8767e6 (commit)


- Log -----------------------------------------------------------------
commit b92013602b6666314ad200d48e10a1aaa2c5b2fa
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Mar 8 14:16:18 2018 +0100

    Configure: disallow the mixture of compiling flags and env / make variables
    
    Note that this might give surprising results if someone forgets an environment
    variable that has been set previously.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit 310f28df2e5317a96a4390117af17dab34706d67
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Mar 8 00:17:29 2018 +0100

    Configurations/README: update documentation on flags
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit 150624bcf54c285183f596976641d57e3cb9a52f
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Mar 8 00:16:47 2018 +0100

    Configure et al: get rid of last traces of plib_lflags / PLIB_LDFLAGS
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit 2ab92ae9dca7c4a9dc3b8468333b10aff7629c5a
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Mar 7 22:44:59 2018 +0100

    config: Pass diverse flags to Configure via the environment
    
    Passing flags &quot;discovered&quot; by 'config' on the command line to
    'Configure' mixes them up with flags given by the user.  That is
    contrary to their intention, so they need to be passed in a different
    manner.
    
    Enter the environment variables __CNF_CPPDEFINES, __CNF_CPPINCLUDES,
    __CNF_CPPFLAGS, __CNF_CFLAGS, __CNF_CXXFLAGS, __CNF_LDFLAGS, and
    __CNF_LDLIBS, initialised by 'config', and then used by Configure to
    initialise these %config values: defines, includes, cppflags, cflags,
    cxxflags, lflags, and ex_libs.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit 72d7f221ee7a3909496c240bab85770b48b515dd
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Mar 7 13:29:41 2018 +0100

    Configurations/10-main.conf: Duplicate cflags to cxxflags
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit b6954f3b3f9f18d885a521d6581d1b442c1d04ac
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Mar 7 13:29:04 2018 +0100

    Add space to asoutflag value where appropriate
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit abe256e7951e6d57f8f6b4364ea696eb4ead3852
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Tue Mar 6 20:35:30 2018 +0100

    Make &quot;make variables&quot; config attributes for overridable flags
    
    With the support of &quot;make variables&quot; comes the possibility for the
    user to override them.  However, we need to make a difference between
    defaults that we use (and that should be overridable by the user) and
    flags that are crucial for building OpenSSL (should not be
    overridable).
    
    Typically, overridable flags are those setting optimization levels,
    warnings levels, that kind of thing, while non-overridable flags are,
    for example, macros that indicate aspects of how the config target
    should be treated, such as L_ENDIAN and B_ENDIAN.
    
    We do that differentiation by allowing upper case attributes in the
    config targets, named exactly like the &quot;make variables&quot; we support,
    and reserving the lower case attributes for non-overridable project
    flags.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

commit 48dcca265c9cb0c26459240ab1858577dacf9e67
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Mar 7 20:31:15 2018 +0100

    Configure et al: rename all dso_* to module_* in shared-info.pl
    
    Because there are already attributes with the dso_ prefix that are
    used instead of the corresponding lib_ attributes rather than in
    addition to them, it gets confusing to have similar or exactly the
    same attributes working with different semantics on Unix.
    
    So we rename those by changing the prefix dso_ to module_, and having
    those work just like the shared_ attributes, but for DSOs.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5534">https://github.com/openssl/openssl/pull/5534</A>)

-----------------------------------------------------------------------

Summary of changes:
 Configurations/00-base-templates.conf |  42 +--
 Configurations/10-main.conf           | 541 ++++++++++++++++++----------------
 Configurations/50-djgpp.conf          |   5 +-
 Configurations/50-haiku.conf          |   9 +-
 Configurations/50-masm.conf           |   5 +-
 Configurations/90-team.conf           |   6 +-
 Configurations/README                 |  67 +++--
 Configurations/descrip.mms.tmpl       | 209 ++++++++++---
 Configurations/shared-info.pl         |   8 +-
 Configurations/unix-Makefile.tmpl     | 172 ++++++++---
 Configurations/windows-makefile.tmpl  | 176 ++++++++---
 Configure                             | 147 +++++----
 INSTALL                               |  24 +-
 apps/CA.pl.in                         |   2 +-
 apps/tsget.in                         |   2 +-
 config                                | 103 +++++--
 crypto/build.info                     |   2 +-
 tools/c_rehash.in                     |   2 +-
 18 files changed, 967 insertions(+), 555 deletions(-)

diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
index 0350997..310a370 100644
--- a/Configurations/00-base-templates.conf
+++ b/Configurations/00-base-templates.conf
@@ -46,16 +46,16 @@ my %targets=(
 	build_scheme	=&gt; [ &quot;unified&quot;, &quot;unix&quot; ],
 	build_file	=&gt; &quot;Makefile&quot;,
 
-	ar		=&gt; &quot;ar&quot;,
-	arflags		=&gt; &quot;r&quot;,
-	cc		=&gt; &quot;cc&quot;,
-	hashbangperl	=&gt; &quot;/usr/bin/env perl&quot;,
-	ranlib		=&gt; sub { which(&quot;$config{cross_compile_prefix}ranlib&quot;)
+	AR		=&gt; &quot;ar&quot;,
+	ARFLAGS		=&gt; &quot;r&quot;,
+	CC		=&gt; &quot;cc&quot;,
+	HASHBANGPERL	=&gt; &quot;/usr/bin/env perl&quot;,
+	RANLIB		=&gt; sub { which(&quot;$config{cross_compile_prefix}ranlib&quot;)
                                      ? &quot;ranlib&quot; : &quot;&quot; },
-	rc		=&gt; &quot;windres&quot;,
+	RC		=&gt; &quot;windres&quot;,
 
 	#### THESE WILL BE ENABLED IN OpenSSL 1.2
-	#hashbangperl	=&gt; &quot;PERL&quot;, # Only Unix actually cares
+	#HASHBANGPERL	=&gt; &quot;PERL&quot;, # Only Unix actually cares
     },
 
     BASE_common =&gt; {
@@ -84,19 +84,19 @@ my %targets=(
         inherit_from    =&gt; [ &quot;BASE_common&quot; ],
         template        =&gt; 1,
 
-        ar              =&gt; &quot;ar&quot;,
-        arflags         =&gt; &quot;r&quot;,
-        cc              =&gt; &quot;cc&quot;,
+        AR              =&gt; &quot;ar&quot;,
+        ARFLAGS         =&gt; &quot;r&quot;,
+        CC              =&gt; &quot;cc&quot;,
         lflags          =&gt;
             sub { $withargs{zlib_lib} ? &quot;-L&quot;.$withargs{zlib_lib} : () },
         ex_libs         =&gt;
             sub { !defined($disabled{zlib})
                   &amp;&amp; defined($disabled{&quot;zlib-dynamic&quot;})
                   ? &quot;-lz&quot; : () },
-        hashbangperl    =&gt; &quot;/usr/bin/env perl&quot;, # Only Unix actually cares
-        ranlib          =&gt; sub { which(&quot;$config{cross_compile_prefix}ranlib&quot;)
+        HASHBANGPERL    =&gt; &quot;/usr/bin/env perl&quot;, # Only Unix actually cares
+        RANLIB          =&gt; sub { which(&quot;$config{cross_compile_prefix}ranlib&quot;)
                                      ? &quot;ranlib&quot; : &quot;&quot; },
-        rc              =&gt; &quot;windres&quot;,
+        RC              =&gt; &quot;windres&quot;,
 
         build_scheme    =&gt; [ &quot;unified&quot;, &quot;unix&quot; ],
         build_file      =&gt; &quot;Makefile&quot;,
@@ -116,16 +116,16 @@ my %targets=(
                 return ();
             },
 
-        ld              =&gt; &quot;link&quot;,
-        lflags          =&gt; &quot;/nologo&quot;,
-        loutflag        =&gt; &quot;/out:&quot;,
-        ar              =&gt; &quot;lib&quot;,
-        arflags         =&gt; &quot;/nologo&quot;,
+        LD              =&gt; &quot;link&quot;,
+        LDFLAGS         =&gt; &quot;/nologo&quot;,
+        ldoutflag       =&gt; &quot;/out:&quot;,
+        AR              =&gt; &quot;lib&quot;,
+        ARFLAGS         =&gt; &quot;/nologo&quot;,
         aroutflag       =&gt; &quot;/out:&quot;,
-        rc               =&gt; &quot;rc&quot;,
+        RC               =&gt; &quot;rc&quot;,
         rcoutflag        =&gt; &quot;/fo&quot;,
-        mt              =&gt; &quot;mt&quot;,
-        mtflags         =&gt; &quot;-nologo&quot;,
+        MT              =&gt; &quot;mt&quot;,
+        MTFLAGS         =&gt; &quot;-nologo&quot;,
         mtinflag        =&gt; &quot;-manifest &quot;,
         mtoutflag       =&gt; &quot;-outputresource:&quot;,
 
diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 7f07752..69439e4 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -6,16 +6,19 @@ my $vc_win64a_info = {};
 sub vc_win64a_info {
     unless (%$vc_win64a_info) {
         if (`nasm -v 2&gt;NUL` =~ /NASM version ([0-9]+\.[0-9]+)/ &amp;&amp; $1 &gt;= 2.0) {
-            $vc_win64a_info = { as        =&gt; &quot;nasm&quot;,
-                                asflags   =&gt; &quot;-f win64 -DNEAR -Ox -g&quot;,
-                                asoutflag =&gt; &quot;-o&quot; };
+            $vc_win64a_info = { AS        =&gt; &quot;nasm&quot;,
+                                ASFLAGS   =&gt; &quot;-g&quot;,
+                                asflags   =&gt; &quot;-Ox -f win64 -DNEAR&quot;,
+                                asoutflag =&gt; &quot;-o &quot; };
         } elsif ($disabled{asm}) {
-            $vc_win64a_info = { as        =&gt; &quot;ml64&quot;,
-                                asflags   =&gt; &quot;/c /Cp /Cx /Zi&quot;,
+            $vc_win64a_info = { AS        =&gt; &quot;ml64&quot;,
+                                ASFLAGS   =&gt; &quot;/Zi&quot;,
+                                asflags   =&gt; &quot;/c /Cp /Cx&quot;,
                                 asoutflag =&gt; &quot;/Fo&quot; };
         } else {
             $die-&gt;(&quot;NASM not found - please read INSTALL and NOTES.WIN for further details\n&quot;);
-            $vc_win64a_info = { as        =&gt; &quot;{unknown}&quot;,
+            $vc_win64a_info = { AS        =&gt; &quot;{unknown}&quot;,
+                                ASFLAGS   =&gt; &quot;&quot;,
                                 asflags   =&gt; &quot;&quot;,
                                 asoutflag =&gt; &quot;&quot; };
         }
@@ -29,18 +32,21 @@ sub vc_win32_info {
         my $ver=`nasm -v 2&gt;NUL`;
         my $vew=`nasmw -v 2&gt;NUL`;
         if ($ver ne &quot;&quot; || $vew ne &quot;&quot;) {
-            $vc_win32_info = { as        =&gt; $ver ge $vew ? &quot;nasm&quot; : &quot;nasmw&quot;,
+            $vc_win32_info = { AS        =&gt; $ver ge $vew ? &quot;nasm&quot; : &quot;nasmw&quot;,
+                               ASFLAGS   =&gt; &quot;&quot;,
                                asflags   =&gt; &quot;-f win32&quot;,
-                               asoutflag =&gt; &quot;-o&quot;,
+                               asoutflag =&gt; &quot;-o &quot;,
                                perlasm_scheme =&gt; &quot;win32n&quot; };
         } elsif ($disabled{asm}) {
-            $vc_win32_info = { as        =&gt; &quot;ml&quot;,
-                               asflags   =&gt; &quot;/nologo /Cp /coff /c /Cx /Zi&quot;,
+            $vc_win32_info = { AS        =&gt; &quot;ml&quot;,
+                               ASFLAGS   =&gt; &quot;/nologo /Zi&quot;,
+                               asflags   =&gt; &quot;/Cp /coff /c /Cx&quot;,
                                asoutflag =&gt; &quot;/Fo&quot;,
                                perlasm_scheme =&gt; &quot;win32&quot; };
         } else {
             $die-&gt;(&quot;NASM not found - please read INSTALL and NOTES.WIN for further details\n&quot;);
-            $vc_win32_info = { as        =&gt; &quot;{unknown}&quot;,
+            $vc_win32_info = { AS        =&gt; &quot;{unknown}&quot;,
+                               ASFLAGS   =&gt; &quot;&quot;,
                                asflags   =&gt; &quot;&quot;,
                                asoutflag =&gt; &quot;&quot;,
                                perlasm_scheme =&gt; &quot;win32&quot; };
@@ -150,9 +156,10 @@ sub vms_info {
         if ($config{target} =~ /-ia64/) {
             `PIPE ias -H 2&gt; NL:`;
             if ($? == 0) {
-                $vms_info-&gt;{as} = &quot;ias&quot;;
-                $vms_info-&gt;{asflags} = '-d debug &quot;-N&quot; vms_upcase';
-                $vms_info-&gt;{asoutflag} = &quot;-o&quot;;
+                $vms_info-&gt;{AS} = &quot;ias&quot;;
+                $vms_info-&gt;{ASFLAGS} = '-d debug';
+                $vms_info-&gt;{asflags} = '&quot;-N&quot; vms_upcase';
+                $vms_info-&gt;{asoutflag} = &quot;-o &quot;;
                 $vms_info-&gt;{perlasm_scheme} = &quot;ias&quot;;
             }
         }
@@ -165,24 +172,24 @@ my %targets = (
 #### Basic configs that should work on any 32-bit box
     &quot;gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
     &quot;cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-O&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
 
 #### VOS Configurations
     &quot;vos-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cppflags         =&gt; &quot;-D_POSIX_C_SOURCE=200112L -D_BSD -D_VOS_EXTENDED_NAMES -DB_ENDIAN&quot;,
@@ -210,11 +217,11 @@ my %targets = (
         # /usr/ccs/bin/as. Failure to comply will result in compile
         # failures [at least] in 32-bit build.
         inherit_from     =&gt; [ &quot;solaris-common&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
                                               debug   =&gt; &quot;-O0 -g&quot;,
-                                              release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
-                                       threads(&quot;-pthread&quot;)),
+                                              release =&gt; &quot;-O3 -fomit-frame-pointer&quot;)),
+        cflags           =&gt; add(threads(&quot;-pthread&quot;)),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -231,11 +238,11 @@ my %targets = (
         # to consider using gcc shared build even with vendor compiler:-)
         #                        -- &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
         inherit_from     =&gt; [ &quot;solaris-common&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-m64 -Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
                                               debug   =&gt; &quot;-O0 -g&quot;,
-                                              release =&gt; &quot;-O3&quot;),
-                                       threads(&quot;-pthread&quot;)),
+                                              release =&gt; &quot;-O3&quot;)),
+        cflags           =&gt; add_before(&quot;-m64&quot;, threads(&quot;-pthread&quot;)),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
@@ -260,10 +267,10 @@ my %targets = (
     #
     &quot;solaris64-x86_64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;solaris-common&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-xarch=generic64 -xstrconst -Xa&quot;,
-                                              debug   =&gt; &quot;-g&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; add_before(picker(debug   =&gt; &quot;-g&quot;,
                                               release =&gt; &quot;-xO5 -xdepend -xbuiltin&quot;)),
+        cflags           =&gt; add_before(&quot;-xarch=generic64 -xstrconst -Xa&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         thread_scheme    =&gt; &quot;pthreads&quot;,
         lflags           =&gt; add(threads(&quot;-mt&quot;)),
@@ -278,11 +285,11 @@ my %targets = (
 #### SPARC Solaris with GNU C setups
     &quot;solaris-sparcv7-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;solaris-common&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
                                               debug   =&gt; &quot;-O0 -g&quot;,
-                                              release =&gt; &quot;-O3&quot;),
-                                       threads(&quot;-pthread&quot;)),
+                                              release =&gt; &quot;-O3&quot;)),
+        cflags           =&gt; add(threads(&quot;-pthread&quot;)),
         cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -312,10 +319,10 @@ my %targets = (
 # SC5.0 note: Compiler common patch 107357-01 or later is required!
     &quot;solaris-sparcv7-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;solaris-common&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-xstrconst -Xa&quot;,
-                                              debug   =&gt; &quot;-g&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; add_before(picker(debug   =&gt; &quot;-g&quot;,
                                               release =&gt; &quot;-xO5 -xdepend&quot;)),
+        cflags           =&gt; add_before(&quot;-xstrconst -Xa&quot;),
         cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;,
                                 threads(&quot;-D_REENTRANT&quot;)),
         lflags           =&gt; add(threads(&quot;-mt&quot;)),
@@ -344,10 +351,10 @@ my %targets = (
 # Only N32 and N64 ABIs are supported.
     &quot;irix-mips3-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-mabi=n32&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; &quot;-mabi=n32&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
@@ -361,10 +368,10 @@ my %targets = (
     },
     &quot;irix-mips3-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-n32 -mips3 -use_readonly_const -G0 -rdata_shared&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O2&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O2&quot;),
+        cflags           =&gt; &quot;-n32 -mips3 -use_readonly_const -G0 -rdata_shared&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
@@ -379,10 +386,10 @@ my %targets = (
     # N64 ABI builds.
     &quot;irix64-mips4-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-mabi=64 -mips4&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; &quot;-mabi=64 -mips4&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
@@ -396,13 +403,14 @@ my %targets = (
     },
     &quot;irix64-mips4-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-64 -mips4 -use_readonly_const -G0 -rdata_shared&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O2&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O2&quot;),
+        cppflags         =&gt; threads(&quot;-D_SGI_MP_SOURCE&quot;),
+        cflags           =&gt; &quot;-64 -mips4 -use_readonly_const -G0 -rdata_shared&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
-        ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
+        ex_libs          =&gt; threads(&quot;-lpthread&quot;),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
         perlasm_scheme   =&gt; &quot;64&quot;,
@@ -441,10 +449,10 @@ my %targets = (
 #   thus adequate performance is provided even with PA-RISC 1.1 build.
     &quot;hpux-parisc-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; add(threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-DB_ENDIAN -DBN_DIV2W&quot;,
         ex_libs          =&gt; add(&quot;-Wl,+s -ldld&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -461,8 +469,8 @@ my %targets = (
     },
     &quot;hpux64-parisc2-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;parisc20_64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;)),
         cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;),
@@ -479,10 +487,10 @@ my %targets = (
     # More attempts at unified 10.X and 11.X targets for HP C compiler.
     &quot;hpux-parisc-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;+Optrs_strongly_typed -Ae +ESlit&quot;,
-                                           debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O3&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
+                                   release =&gt; &quot;+O3&quot;),
+        cflags           =&gt; &quot;+Optrs_strongly_typed -Ae +ESlit&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV2W -DMD32_XARRAY&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-Wl,+s -ldld&quot;,threads(&quot;-lpthread&quot;)),
@@ -501,10 +509,10 @@ my %targets = (
     },
     &quot;hpux64-parisc2-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;parisc20_64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;+DD64 +Optrs_strongly_typed -Ae +ESlit&quot;,
-                                           debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O3&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
+                                   release =&gt; &quot;+O3&quot;) ,
+        cflags           =&gt; &quot;+DD64 +Optrs_strongly_typed -Ae +ESlit&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DMD32_XARRAY&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;,threads(&quot;-lpthread&quot;)),
@@ -521,10 +529,10 @@ my %targets = (
     # HP/UX IA-64 targets
     &quot;hpux-ia64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-Ae +DD32 +Olit=all -z&quot;,
-                                           debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O2&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
+                                   release =&gt; &quot;+O2&quot;),
+        cflags           =&gt; &quot;-Ae +DD32 +Olit=all -z&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
@@ -538,10 +546,10 @@ my %targets = (
     },
     &quot;hpux64-ia64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-Ae +DD64 +Olit=all -z&quot;,
-                                           debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O3&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
+                                   release =&gt; &quot;+O3&quot;),
+        cflags           =&gt; &quot;-Ae +DD64 +Olit=all -z&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
@@ -556,10 +564,10 @@ my %targets = (
     # GCC builds...
     &quot;hpux-ia64-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; add(threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
@@ -573,11 +581,10 @@ my %targets = (
     },
     &quot;hpux64-ia64-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-mlp64&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; combine(&quot;-mlp64&quot;, threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
@@ -593,8 +600,8 @@ my %targets = (
 #### HP MPE/iX <A HREF="http://jazz.external.hp.com/src/openssl/">http://jazz.external.hp.com/src/openssl/</A>
     &quot;MPE/iX-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-O3&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-O3&quot;,
         cppflags         =&gt; &quot;-D_ENDIAN -DBN_DIV2W -D_POSIX_SOURCE -D_SOCKET_SOURCE&quot;,
         includes         =&gt; add(&quot;/SYSLOG/PUB&quot;),
         sys_id           =&gt; &quot;MPE&quot;,
@@ -610,8 +617,9 @@ my %targets = (
 #### but not anymore...
     &quot;tru64-alpha-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;alpha_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(&quot;-std=c9x -O3&quot;, threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-O3&quot;,
+        cflags           =&gt; add(&quot;-std=c9x&quot;, threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-D_XOPEN_SOURCE=500 -D_OSF_SOURCE&quot;,
         ex_libs          =&gt; add(&quot;-lrt&quot;, threads(&quot;-pthread&quot;)), # for mlock(2)
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
@@ -622,9 +630,10 @@ my %targets = (
     },
     &quot;tru64-alpha-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;alpha_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-std1 -tune host -fast -readonly_strings&quot;,
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-tune host -fast&quot;,
+        cflags           =&gt; add(&quot;-std1 -readonly_strings&quot;,
+                                threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-D_XOPEN_SOURCE=500 -D_OSF_SOURCE&quot;,
         ex_libs          =&gt; add(&quot;-lrt&quot;, threads(&quot;-pthread&quot;)), # for mlock(2)
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
@@ -642,16 +651,16 @@ my %targets = (
 # throw in -D[BL]_ENDIAN, whichever appropriate...
     &quot;linux-generic32&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
-        cxx              =&gt; &quot;g++&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-Wall&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread&quot;)),
-        cxxflags         =&gt; combine(picker(default =&gt; &quot;-std=c++11 -Wall&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CXX              =&gt; &quot;g++&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
+                                   debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        CXXFLAGS         =&gt; picker(default =&gt; &quot;-Wall&quot;,
+                                   debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; threads(&quot;-pthread&quot;),
+        cxxflags         =&gt; combine(&quot;-std=c++11&quot;, threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-DOPENSSL_USE_NODELETE&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -674,6 +683,7 @@ my %targets = (
     &quot;linux-ppc64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;ppc64_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
+        cxxflags         =&gt; add(&quot;-m64&quot;),
         cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;linux64&quot;,
         multilib         =&gt; &quot;64&quot;,
@@ -681,6 +691,7 @@ my %targets = (
     &quot;linux-ppc64le&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;ppc64_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
+        cxxflags         =&gt; add(&quot;-m64&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;linux64le&quot;,
     },
@@ -727,6 +738,7 @@ my %targets = (
     &quot;linux-arm64ilp32&quot; =&gt; {  # <A HREF="https://wiki.linaro.org/Platform/arm64-ilp32">https://wiki.linaro.org/Platform/arm64-ilp32</A>
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;aarch64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=ilp32&quot;),
+        cxxflags         =&gt; add(&quot;-mabi=ilp32&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT RC4_CHAR&quot;,
         perlasm_scheme   =&gt; &quot;linux64&quot;,
     },
@@ -736,6 +748,7 @@ my %targets = (
         # support, if no -march was specified at command line.
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;mips32_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=32&quot;),
+        cxxflags         =&gt; add(&quot;-mabi=32&quot;),
         cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
         perlasm_scheme   =&gt; &quot;o32&quot;,
     },
@@ -744,6 +757,7 @@ my %targets = (
     &quot;linux-mips64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;mips64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=n32&quot;),
+        cxxflags         =&gt; add(&quot;-mabi=n32&quot;),
         cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT RC4_CHAR&quot;,
         perlasm_scheme   =&gt; &quot;n32&quot;,
@@ -752,6 +766,7 @@ my %targets = (
     &quot;linux64-mips64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;mips64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=64&quot;),
+        cxxflags         =&gt; add(&quot;-mabi=64&quot;),
         cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
         perlasm_scheme   =&gt; &quot;64&quot;,
         multilib         =&gt; &quot;64&quot;,
@@ -762,14 +777,14 @@ my %targets = (
     #### machines where gcc doesn't understand -m32 and -m64
     &quot;linux-elf&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cflags           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
     &quot;linux-aout&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add(picker(default =&gt; &quot;-Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; add(picker(default =&gt; &quot;-Wall&quot;,
                                        debug   =&gt; &quot;-O0 -g&quot;,
                                        release =&gt; &quot;-O3 -fomit-frame-pointer&quot;)),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
@@ -781,21 +796,23 @@ my %targets = (
     #### X86 / X86_64 targets
     &quot;linux-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-m32&quot;,
-                                       release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cflags           =&gt; add(&quot;-m32&quot;),
+        cxxflags         =&gt; add(&quot;-m32&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
     },
     &quot;linux-x86-clang&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-x86&quot; ],
-        cc               =&gt; &quot;clang&quot;,
-        cxx              =&gt; &quot;clang++&quot;,
-        cflags           =&gt; add(&quot;-Wextra&quot;),
+        CC               =&gt; &quot;clang&quot;,
+        CXX              =&gt; &quot;clang++&quot;,
+        CFLAGS           =&gt; add(&quot;-Wextra&quot;),
     },
     &quot;linux-x86_64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;x86_64_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
+        cxxflags         =&gt; add(&quot;-m64&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
@@ -803,13 +820,14 @@ my %targets = (
     },
     &quot;linux-x86_64-clang&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-x86_64&quot; ],
-        cc               =&gt; &quot;clang&quot;,
-        cxx              =&gt; &quot;clang++&quot;,
-        cflags           =&gt; add(&quot;-Wextra&quot;),
+        CC               =&gt; &quot;clang&quot;,
+        CXX              =&gt; &quot;clang++&quot;,
+        CFLAGS           =&gt; add(&quot;-Wextra&quot;),
     },
     &quot;linux-x32&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mx32&quot;),
+        cxxflags         =&gt; add(&quot;-mx32&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         perlasm_scheme   =&gt; &quot;elf32&quot;,
@@ -824,6 +842,7 @@ my %targets = (
     &quot;linux64-s390x&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;s390x_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
+        cxxflags         =&gt; add(&quot;-m64&quot;),
         cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;64&quot;,
         multilib         =&gt; &quot;64&quot;,
@@ -847,6 +866,7 @@ my %targets = (
         #
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;s390x_asm&quot;) ],
         cflags           =&gt; add(&quot;-m31 -Wa,-mzarch&quot;),
+        cxxflags         =&gt; add(&quot;-m31 -Wa,-mzarch&quot;),
         cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_asm_src       =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s|asm/s390x\.S|bn_asm.c|; $r; },
         perlasm_scheme   =&gt; &quot;31&quot;,
@@ -857,34 +877,39 @@ my %targets = (
     &quot;linux-sparcv8&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;sparcv8_asm&quot;) ],
         cflags           =&gt; add(&quot;-mcpu=v8&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
+        cxxflags         =&gt; add(&quot;-mcpu=v8&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
     },
     &quot;linux-sparcv9&quot; =&gt; {
         # it's a real mess with -mcpu=ultrasparc option under Linux,
         # but -Wa,-Av8plus should do the trick no matter what.
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;sparcv9_asm&quot;) ],
         cflags           =&gt; add(&quot;-m32 -mcpu=ultrasparc -Wa,-Av8plus&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
+        cxxflags         =&gt; add(&quot;-m32 -mcpu=ultrasparc -Wa,-Av8plus&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
     },
     &quot;linux64-sparcv9&quot; =&gt; {
         # GCC 3.1 is a requirement
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;sparcv9_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64 -mcpu=ultrasparc&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        cxxflags         =&gt; add(&quot;-m64 -mcpu=ultrasparc&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
 
     &quot;linux-alpha-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;alpha_asm&quot;) ],
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
     },
     &quot;linux-c64xplus&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         # TI_CGT_C6000_7.3.x is a requirement
-        cc               =&gt; &quot;cl6x&quot;,
-        cflags           =&gt; &quot;--linux -ea=.s -eo=.o -mv6400+ -o2 -ox -ms -pden&quot;,
+        CC               =&gt; &quot;cl6x&quot;,
+        CFLAGS           =&gt; &quot;-o2 -ox -ms&quot;,
+        cflags           =&gt; &quot;--linux -ea=.s -eo=.o -mv6400+ -pden&quot;,
+        cxxflags         =&gt; &quot;--linux -ea=.s -eo=.o -mv6400+ -pden&quot;,
         cppflags         =&gt; combine(&quot;-DOPENSSL_SMALL_FOOTPRINT&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -932,12 +957,13 @@ my %targets = (
         # systems are perfectly capable of executing binaries targeting
         # Froyo. Keep in mind that in the nutshell Android builds are
         # about JNI, i.e. shared libraries, not applications.
-        cflags           =&gt; add(picker(default =&gt; &quot;-mandroid -fPIC --sysroot=\$(CROSS_SYSROOT) -Wa,--noexecstack&quot;)),
+        cflags           =&gt; add(&quot;-mandroid -fPIC --sysroot=\$(CROSS_SYSROOT) -Wa,--noexecstack&quot;),
+        cxxflags         =&gt; add(&quot;-mandroid -fPIC --sysroot=\$(CROSS_SYSROOT) -Wa,--noexecstack&quot;),
         bin_cflags       =&gt; &quot;-pie&quot;,
     },
     &quot;android-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;android&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         perlasm_scheme   =&gt; &quot;android&quot;,
     },
@@ -972,7 +998,8 @@ my %targets = (
 
     &quot;android64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot; ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-mandroid -fPIC --sysroot=\$(CROSS_SYSROOT) -Wa,--noexecstack&quot;)),
+        cflags           =&gt; add(&quot;-mandroid -fPIC --sysroot=\$(CROSS_SYSROOT) -Wa,--noexecstack&quot;),
+        cxxflags         =&gt; add(&quot;-mandroid -fPIC --sysroot=\$(CROSS_SYSROOT) -Wa,--noexecstack&quot;),
         bin_cflags       =&gt; &quot;-pie&quot;,
     },
     &quot;android64-aarch64&quot; =&gt; {
@@ -1007,11 +1034,11 @@ my %targets = (
         # -D_THREAD_SAFE and sometimes -D_REENTRANT. FreeBSD 5.x
         # expands it as -lc_r, which seems to be sufficient?
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-Wall&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
+                                   debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cflags           =&gt; threads(&quot;-pthread&quot;),
         cppflags         =&gt; threads(&quot;-D_THREAD_SAFE -D_REENTRANT&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         enable           =&gt; add(&quot;devcryptoeng&quot;),
@@ -1029,7 +1056,7 @@ my %targets = (
 
     &quot;BSD-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic32&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         shared_target    =&gt; &quot;bsd-shared&quot;,
@@ -1069,8 +1096,8 @@ my %targets = (
 
     &quot;bsdi-elf-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-fomit-frame-pointer -O3 -Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-fomit-frame-pointer -O3 -Wall&quot;,
         cppflags         =&gt; &quot;-DPERL5 -DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -1083,16 +1110,16 @@ my %targets = (
 
     &quot;nextstep&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-O -Wall&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O -Wall&quot;,
         unistd           =&gt; &quot;&lt;libc.h&gt;&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;nextstep3.3&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-O3 -Wall&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O3 -Wall&quot;,
         unistd           =&gt; &quot;&lt;libc.h&gt;&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
@@ -1101,14 +1128,14 @@ my %targets = (
 # QNX
     &quot;qnx4&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;&quot;,
         cppflags         =&gt; &quot;-DL_ENDIAN -DTERMIO&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;QNX6&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;gcc&quot;,
+        CC               =&gt; &quot;gcc&quot;,
         ex_libs          =&gt; add(&quot;-lsocket&quot;),
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         shared_target    =&gt; &quot;bsd-gcc-shared&quot;,
@@ -1117,8 +1144,8 @@ my %targets = (
     },
     &quot;QNX6-i386&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-O2 -Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-O2 -Wall&quot;,
         cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-lsocket&quot;),
         dso_scheme       =&gt; &quot;dlfcn&quot;,
@@ -1140,24 +1167,26 @@ my %targets = (
 # UnixWare 2.0x fails destest with -O.
     &quot;unixware-2.0&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(threads(&quot;-Kthread&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        cflags           =&gt; threads(&quot;-Kthread&quot;),
         cppflags         =&gt; &quot;-DFILIO_H -DNO_STRINGS_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -lresolv -lx&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
     },
     &quot;unixware-2.1&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-O&quot;, threads(&quot;-Kthread&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O&quot;,
+        cflags           =&gt; threads(&quot;-Kthread&quot;),
         cppflags         =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -lresolv -lx&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
     },
     &quot;unixware-7&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-O -Kalloca&quot;, threads(&quot;-Kthread&quot;)),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O&quot;,
+        cflags           =&gt; combine(&quot;-Kalloca&quot;, threads(&quot;-Kthread&quot;)),
         cppflags         =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
@@ -1170,8 +1199,8 @@ my %targets = (
     },
     &quot;unixware-7-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(&quot;-O3 -fomit-frame-pointer -Wall&quot;),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-O3 -fomit-frame-pointer -Wall&quot;,
         cppflags         =&gt; add(&quot;-DL_ENDIAN -DFILIO_H&quot;,
                                 threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
@@ -1218,10 +1247,10 @@ my %targets = (
     # current value of $OBJECT_MODE.
     &quot;aix-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc32_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O&quot;),
+        cflags           =&gt; add(threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
@@ -1236,11 +1265,10 @@ my %targets = (
     },
     &quot;aix64-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-maix64&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O&quot;),
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O&quot;),
+        cflags           =&gt; combine(&quot;-maix64&quot;, threads(&quot;-pthread&quot;)),
         cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
@@ -1255,10 +1283,10 @@ my %targets = (
     },
     &quot;aix-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc32_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-q32 -qmaxmem=16384 -qro -qroconst&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O&quot;),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O&quot;),
+        cflags           =&gt; combine(&quot;-q32 -qmaxmem=16384 -qro -qroconst&quot;,
                                     threads(&quot;-qthreaded&quot;)),
         cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_THREAD_SAFE&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
@@ -1274,10 +1302,10 @@ my %targets = (
     },
     &quot;aix64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc64_asm&quot;) ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-q64 -qmaxmem=16384 -qro -qroconst&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O&quot;),
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                   release =&gt; &quot;-O&quot;),
+        cflags           =&gt; combine(&quot;-q64 -qmaxmem=16384 -qro -qroconst&quot;,
                                     threads(&quot;-qthreaded&quot;)),
         cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_THREAD_SAFE&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
@@ -1295,8 +1323,9 @@ my %targets = (
 # SIEMENS BS2000/OSD: an EBCDIC-based mainframe
     &quot;BS2000-OSD&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;c89&quot;,
-        cflags           =&gt; &quot;-O -XLLML -XLLMK -XL&quot;,
+        CC               =&gt; &quot;c89&quot;,
+        CFLAGS           =&gt; &quot;-O&quot;,
+        cflags           =&gt; &quot;-XLLML -XLLMK -XL&quot;,
         cppflags         =&gt; &quot;-DB_ENDIAN -DCHARSET_EBCDIC&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         bn_ops           =&gt; &quot;THIRTY_TWO_BIT RC4_CHAR&quot;,
@@ -1317,9 +1346,12 @@ my %targets = (
     &quot;VC-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
         template         =&gt; 1,
-        cc               =&gt; &quot;cl&quot;,
-        cpp              =&gt; '$(CC) /EP /C',
-        cflags           =&gt; &quot;-W3 -wd4090 -Gs0 -GF -Gy -nologo&quot;,
+        CC               =&gt; &quot;cl&quot;,
+        CPP              =&gt; '$(CC) /EP /C',
+        CFLAGS           =&gt; &quot;-W3 -wd4090 -nologo&quot;,
+        LDFLAGS          =&gt; add(&quot;/debug&quot;),
+        coutflag         =&gt; &quot;/Fo&quot;,
+        cflags           =&gt; '-Gs0 -GF -Gy',
         defines          =&gt; add(&quot;OPENSSL_SYS_WIN32&quot;, &quot;WIN32_LEAN_AND_MEAN&quot;,
                                 &quot;L_ENDIAN&quot;, &quot;_CRT_SECURE_NO_DEPRECATE&quot;,
                                 &quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;,
@@ -1333,11 +1365,9 @@ my %targets = (
                                       }
                                       return [ @defs ];
                                   }),
-        coutflag         =&gt; &quot;/Fo&quot;,
         lib_cflags       =&gt; add(&quot;/Zi /Fdossl_static&quot;),
         dso_cflags       =&gt; &quot;/Zi /Fddso&quot;,
         bin_cflags       =&gt; &quot;/Zi /Fdapp&quot;,
-        lflags           =&gt; add(&quot;/debug&quot;),
         shared_ldflag    =&gt; &quot;/dll&quot;,
         shared_target    =&gt; &quot;win-shared&quot;, # meaningless except it gives Configure a hint
         thread_scheme    =&gt; &quot;winthreads&quot;,
@@ -1347,15 +1377,15 @@ my %targets = (
     &quot;VC-noCE-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;VC-common&quot; ],
         template         =&gt; 1,
+        CFLAGS           =&gt; add(picker(debug   =&gt; '/Od',
+                                       release =&gt; '/O2')),
         cflags           =&gt; add(picker(debug   =&gt;
                                        sub {
-                                           ($disabled{shared} ? &quot;&quot; : &quot;/MDd&quot;)
-                                               .&quot; /Od&quot;;
+                                           ($disabled{shared} ? &quot;&quot; : &quot;/MDd&quot;);
                                        },
                                        release =&gt;
                                        sub {
-                                           ($disabled{shared} ? &quot;&quot; : &quot;/MD&quot;)
-                                               .&quot; /O2&quot;;
+                                           ($disabled{shared} ? &quot;&quot; : &quot;/MD&quot;);
                                        })),
         defines          =&gt; add(picker(default =&gt; [ &quot;UNICODE&quot;, &quot;_UNICODE&quot; ],
                                        debug   =&gt; [ &quot;DEBUG&quot;, &quot;_DEBUG&quot; ])),
@@ -1396,8 +1426,8 @@ my %targets = (
     &quot;VC-WIN64I&quot; =&gt; {
         inherit_from     =&gt; [ &quot;VC-WIN64-common&quot;, asm(&quot;ia64_asm&quot;),
                               sub { $disabled{shared} ? () : &quot;ia64_uplink&quot; } ],
-        as               =&gt; &quot;ias&quot;,
-        asflags          =&gt; &quot;-d debug&quot;,
+        AS               =&gt; &quot;ias&quot;,
+        ASFLAGS          =&gt; &quot;-d debug&quot;,
         asoutflag        =&gt; &quot;-o&quot;,
         sys_id           =&gt; &quot;WIN64I&quot;,
         bn_asm_src       =&gt; sub { return undef unless @_;
@@ -1408,9 +1438,10 @@ my %targets = (
     &quot;VC-WIN64A&quot; =&gt; {
         inherit_from     =&gt; [ &quot;VC-WIN64-common&quot;, asm(&quot;x86_64_asm&quot;),
                               sub { $disabled{shared} ? () : &quot;x86_64_uplink&quot; } ],
-        as               =&gt; sub { vc_win64a_info()-&gt;{as} },
-        asflags          =&gt; sub { vc_win64a_info()-&gt;{asflags} },
+        AS               =&gt; sub { vc_win64a_info()-&gt;{AS} },
+        ASFLAGS          =&gt; sub { vc_win64a_info()-&gt;{ASFLAGS} },
         asoutflag        =&gt; sub { vc_win64a_info()-&gt;{asoutflag} },
+        asflags          =&gt; sub { vc_win64a_info()-&gt;{asflags} },
         sys_id           =&gt; &quot;WIN64A&quot;,
         bn_asm_src       =&gt; sub { return undef unless @_;
                                   my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s|asm/x86_64-gcc|bn_asm|; $r; },
@@ -1422,10 +1453,11 @@ my %targets = (
         # configure with 'perl Configure VC-WIN32 -DUNICODE -D_UNICODE'
         inherit_from     =&gt; [ &quot;VC-noCE-common&quot;, asm(&quot;x86_asm&quot;),
                               sub { $disabled{shared} ? () : &quot;uplink_common&quot; } ],
-        cflags           =&gt; add(&quot;-WX&quot;),
-        as               =&gt; sub { vc_win32_info()-&gt;{as} },
-        asflags          =&gt; sub { vc_win32_info()-&gt;{asflags} },
+        CFLAGS           =&gt; add(&quot;-WX&quot;),
+        AS               =&gt; sub { vc_win32_info()-&gt;{AS} },
+        ASFLAGS          =&gt; sub { vc_win32_info()-&gt;{ASFLAGS} },
         asoutflag        =&gt; sub { vc_win32_info()-&gt;{asoutflag} },
+        asflags          =&gt; sub { vc_win32_info()-&gt;{asflags} },
         ex_libs          =&gt; add(sub {
             my @ex_libs = ();
             # WIN32 UNICODE build gets linked with unicows.lib for
@@ -1441,33 +1473,33 @@ my %targets = (
     },
     &quot;VC-CE&quot; =&gt; {
         inherit_from     =&gt; [ &quot;VC-common&quot; ],
-        as               =&gt; &quot;ml&quot;,
-        asflags          =&gt; &quot;/nologo /Cp /coff /c /Cx /Zi&quot;,
+        AS               =&gt; &quot;ml&quot;,
+        ASFLAGS          =&gt; &quot;/nologo&quot;,
         asoutflag        =&gt; &quot;/Fo&quot;,
-        cc               =&gt; &quot;cl&quot;,
+        asflags          =&gt; &quot;/Cp /coff /c /Cx /Zi&quot;,
+        CC               =&gt; &quot;cl&quot;,
+        CFLAGS           =&gt; picker(default =&gt; '/W3 /WX /nologo',
+                                   debug   =&gt; &quot;/Od&quot;,
+                                   release =&gt; &quot;/O1i&quot;),
+        CPPDEFINES       =&gt; picker(debug   =&gt; [ &quot;DEBUG&quot;, &quot;_DEBUG&quot; ]),
+        LDFLAGS          =&gt; add(&quot;/nologo /opt:ref&quot;),
         cflags           =&gt;
-            picker(default =&gt;
-                   combine('/W3 /WX /GF /Gy /nologo',
-                           sub { vc_wince_info()-&gt;{cflags}; },
-                           sub { `cl 2&gt;&amp;1` =~ /Version ([0-9]+)\./ &amp;&amp; $1&gt;=14
-                                     ? ($disabled{shared} ? &quot; /MT&quot; : &quot; /MD&quot;)
-                                     : &quot; /MC&quot;; }),
-                   debug   =&gt; &quot;/Od&quot;,
-                   release =&gt; &quot;/O1i&quot;),
+            combine('/GF /Gy',
+                    sub { vc_wince_info()-&gt;{cflags}; },
+                    sub { `cl 2&gt;&amp;1` =~ /Version ([0-9]+)\./ &amp;&amp; $1&gt;=14
+                              ? ($disabled{shared} ? &quot; /MT&quot; : &quot; /MD&quot;)
+                              : &quot; /MC&quot;; }),
         cppflags         =&gt; sub { vc_wince_info()-&gt;{cppflags}; },
-        defines          =&gt;
-            picker(default =&gt; [ &quot;UNICODE&quot;, &quot;_UNICODE&quot;, &quot;OPENSSL_SYS_WINCE&quot;,
-                                &quot;WIN32_LEAN_AND_MEAN&quot;, &quot;L_ENDIAN&quot;, &quot;DSO_WIN32&quot;,
-                                &quot;NO_CHMOD&quot;, &quot;OPENSSL_SMALL_FOOTPRINT&quot; ],
-                   debug   =&gt; [ &quot;DEBUG&quot;, &quot;_DEBUG&quot; ]),
+        defines          =&gt; [ &quot;UNICODE&quot;, &quot;_UNICODE&quot;, &quot;L_ENDIAN&quot;, &quot;DSO_WIN32&quot;,
+                              &quot;NO_CHMOD&quot;, &quot;OPENSSL_SMALL_FOOTPRINT&quot;,
+                              &quot;WIN32_LEAN_AND_MEAN&quot; ],
         includes         =&gt;
             add(combine(sub { defined(env('WCECOMPAT'))
                               ? '$(WCECOMPAT)/include' : (); },
                         sub { defined(env('PORTSDK_LIBPATH'))
                                   ? '$(PORTSDK_LIBPATH)/../../include'
                                   : (); })),
-        lflags           =&gt; add(combine(&quot;/nologo /opt:ref&quot;,
-                                        sub { vc_wince_info()-&gt;{lflags}; },
+        lflags           =&gt; add(combine(sub { vc_wince_info()-&gt;{lflags}; },
                                         sub { defined(env('PORTSDK_LIBPATH'))
                                                   ? &quot;/entry:mainCRTstartup&quot; : (); })),
         sys_id           =&gt; &quot;WINCE&quot;,
@@ -1498,12 +1530,14 @@ my %targets = (
     &quot;mingw&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_asm&quot;),
                               sub { $disabled{shared} ? () : &quot;x86_uplink&quot; } ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-m32 -Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
-        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN&quot;,
-                                    &quot;-DUNICODE -D_UNICODE&quot;, threads(&quot;-D_MT&quot;)),
+        cflags           =&gt; &quot;-m32&quot;,
+        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DUNICODE -D_UNICODE&quot;,
+                                    &quot;-DWIN32_LEAN_AND_MEAN&quot;,
+                                    threads(&quot;-D_MT&quot;)),
         sys_id           =&gt; &quot;MINGW32&quot;,
         ex_libs          =&gt; add(&quot;-lws2_32 -lgdi32 -lcrypt32&quot;),
         bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
@@ -1528,12 +1562,14 @@ my %targets = (
         # environment. And as mingw64 is always consistent with itself,
         # Applink is never engaged and can as well be omitted.
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-m64 -Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
-        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN&quot;,
-                                    &quot;-DUNICODE -D_UNICODE&quot;, threads(&quot;-D_MT&quot;)),
+        cflags           =&gt; &quot;-m64&quot;,
+        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DUNICODE -D_UNICODE&quot;,
+                                    &quot;-DWIN32_LEAN_AND_MEAN&quot;,
+                                    threads(&quot;-D_MT&quot;)),
         sys_id           =&gt; &quot;MINGW64&quot;,
         ex_libs          =&gt; add(&quot;-lws2_32 -lgdi32 -lcrypt32&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT EXPORT_VAR_AS_FN&quot;,
@@ -1552,8 +1588,8 @@ my %targets = (
 #### UEFI
     &quot;UEFI&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-O&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O&quot;,
         cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;UEFI&quot;,
     },
@@ -1561,9 +1597,9 @@ my %targets = (
 #### UWIN
     &quot;UWIN&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-O -Wall&quot;,
-        cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O -Wall&quot;,
+        lib_cppflags     =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;UWIN&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         dso_scheme       =&gt; &quot;win32&quot;,
@@ -1572,8 +1608,8 @@ my %targets = (
 #### Cygwin
     &quot;Cygwin-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
         cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
@@ -1588,8 +1624,8 @@ my %targets = (
     },
     &quot;Cygwin-x86_64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
@@ -1624,13 +1660,12 @@ my %targets = (
     &quot;darwin-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         template         =&gt; 1,
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;&quot;,
-                                   debug   =&gt; &quot;-g -O0&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
+        lflags           =&gt; &quot;-Wl,-search_paths_first&quot;,
         sys_id           =&gt; &quot;MACOSX&quot;,
-        plib_lflags      =&gt; &quot;-Wl,-search_paths_first&quot;,
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
         perlasm_scheme   =&gt; &quot;osx32&quot;,
@@ -1659,15 +1694,16 @@ my %targets = (
     },
     &quot;darwin-i386-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-arch i386&quot;,
-                                       release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cflags           =&gt; add(&quot;-arch i386&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG RC4_INT&quot;,
         perlasm_scheme   =&gt; &quot;macosx&quot;,
     },
     &quot;darwin64-x86_64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-arch x86_64 -Wall&quot;),
+        CFLAGS           =&gt; add(&quot;-Wall&quot;),
+        cflags           =&gt; add(&quot;-arch x86_64&quot;),
         cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;macosx&quot;,
@@ -1714,9 +1750,9 @@ my %targets = (
     &quot;hurd-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         inherit_from     =&gt; [ asm(&quot;x86_elf_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(&quot;-O3 -fomit-frame-pointer -Wall&quot;,
-                                    threads(&quot;-pthread&quot;)),
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-O3 -fomit-frame-pointer -Wall&quot;,
+        cflags           =&gt; threads(&quot;-pthread&quot;),
         cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -1730,8 +1766,9 @@ my %targets = (
 ##### VxWorks for various targets
     &quot;vxworks-ppc60x&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-mrtp -mhard-float -mstrict-align -fno-implicit-fp -O2 -fstrength-reduce -fno-builtin -fno-strict-aliasing -Wall&quot;,
+        CC               =&gt; &quot;ccppc&quot;,
+        CFLAGS           =&gt; &quot;-O2 -Wall -fstrength-reduce&quot;,
+        cflags           =&gt; &quot;-mrtp -mhard-float -mstrict-align -fno-implicit-fp -fno-builtin -fno-strict-aliasing&quot;,
         cppflags         =&gt; combine(&quot;-D_REENTRANT -DPPC32_fp60x -DCPU=PPC32&quot;,
                                     &quot;_DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
                                     &quot;-I\$(WIND_BASE)/target/usr/h&quot;,
@@ -1742,8 +1779,9 @@ my %targets = (
     },
     &quot;vxworks-ppcgen&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-mrtp -msoft-float -mstrict-align -O1 -fno-builtin -fno-strict-aliasing -Wall&quot;,
+        CC               =&gt; &quot;ccppc&quot;,
+        CFLAGS           =&gt; &quot;-O1 -Wall&quot;,
+        cflags           =&gt; &quot;-mrtp -msoft-float -mstrict-align -fno-builtin -fno-strict-aliasing&quot;,
         cppflags         =&gt; combine(&quot;-D_REENTRANT -DPPC32 -DCPU=PPC32&quot;,
                                     &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
                                     &quot;-I\$(WIND_BASE)/target/usr/h&quot;,
@@ -1754,8 +1792,9 @@ my %targets = (
     },
     &quot;vxworks-ppc405&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-g -msoft-float -mlongcall&quot;,
+        CC               =&gt; &quot;ccppc&quot;,
+        CFLAGS           =&gt; &quot;-g&quot;,
+        cflags           =&gt; &quot;-msoft-float -mlongcall&quot;,
         cppflags         =&gt; combine(&quot;-D_REENTRANT -DPPC32 -DCPU=PPC405&quot;,
                                     &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
                                     &quot;-I\$(WIND_BASE)/target/h&quot;),
@@ -1764,8 +1803,9 @@ my %targets = (
     },
     &quot;vxworks-ppc750&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-ansi -nostdinc -fvolatile -fno-builtin -fno-for-scope -fsigned-char -Wall -msoft-float -mlongcall \$(DEBUG_FLAG)&quot;,
+        CC               =&gt; &quot;ccppc&quot;,
+        CFLAGS           =&gt; &quot;-ansi -fvolatile -Wall \$(DEBUG_FLAG)&quot;,
+        cflags           =&gt; &quot;-nostdinc -fno-builtin -fno-for-scope -fsigned-char -msoft-float -mlongcall&quot;,
         cppflags         =&gt; combine(&quot;-DPPC750 -D_REENTRANT -DCPU=PPC604&quot;,
                                     &quot;-I\$(WIND_BASE)/target/h&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
@@ -1773,8 +1813,9 @@ my %targets = (
     },
     &quot;vxworks-ppc750-debug&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-ansi -nostdinc -fvolatile -fno-builtin -fno-for-scope -fsigned-char -Wall -msoft-float -mlongcall -g&quot;,
+        CC               =&gt; &quot;ccppc&quot;,
+        CFLAGS           =&gt; &quot;-ansi -fvolatile -Wall -g&quot;,
+        cflags           =&gt; &quot;-nostdinc -fno-builtin -fno-for-scope -fsigned-char -msoft-float -mlongcall&quot;,
         cppflags         =&gt; combine(&quot;-DPPC750 -D_REENTRANT -DCPU=PPC604&quot;,
                                     &quot;-DPEDANTIC -DDEBUG&quot;,
                                     &quot;-I\$(WIND_BASE)/target/h&quot;),
@@ -1783,7 +1824,7 @@ my %targets = (
     },
     &quot;vxworks-ppc860&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccppc&quot;,
+        CC               =&gt; &quot;ccppc&quot;,
         cflags           =&gt; &quot;-nostdinc -msoft-float&quot;,
         cppflags         =&gt; combine(&quot;-DCPU=PPC860 -DNO_STRINGS_H&quot;,
                                     &quot;-I\$(WIND_BASE)/target/h&quot;),
@@ -1792,7 +1833,7 @@ my %targets = (
     },
     &quot;vxworks-simlinux&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; &quot;ccpentium&quot;,
+        CC               =&gt; &quot;ccpentium&quot;,
         cflags           =&gt; &quot;-B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -fno-builtin -fno-defer-pop&quot;,
         cppflags         =&gt; combine(&quot;-D_VSB_CONFIG_FILE=\&quot;\$(WIND_BASE)/target/lib/h/config/vsbConfig.h\&quot;&quot;,
                                     &quot;-DL_ENDIAN -DCPU=SIMLINUX -DNO_STRINGS_H&quot;,
@@ -1806,8 +1847,9 @@ my %targets = (
     },
     &quot;vxworks-mips&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips32_asm&quot;) ],
-        cc               =&gt; &quot;ccmips&quot;,
-        cflags           =&gt; &quot;-mrtp -mips2 -O -G 0 -B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -msoft-float -mno-branch-likely -fno-builtin -fno-defer-pop&quot;,
+        CC               =&gt; &quot;ccmips&quot;,
+        CFLAGS           =&gt; &quot;-O -G 0&quot;,
+        cflags           =&gt; &quot;-mrtp -mips2 -B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -msoft-float -mno-branch-likely -fno-builtin -fno-defer-pop&quot;,
         cppflags         =&gt; combine(&quot;-D_VSB_CONFIG_FILE=\&quot;\$(WIND_BASE)/target/lib/h/config/vsbConfig.h\&quot;&quot;,
                                     &quot;-DCPU=MIPS32 -DNO_STRINGS_H&quot;,
                                     &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
@@ -1826,7 +1868,7 @@ my %targets = (
 #### uClinux
     &quot;uClinux-dist&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; sub { env('CC') },
+        CC               =&gt; sub { env('CC') },
         cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
         ex_libs          =&gt; add(&quot;\$(LDLIBS)&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -1839,7 +1881,7 @@ my %targets = (
     },
     &quot;uClinux-dist64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
-        cc               =&gt; sub { env('CC') },
+        CC               =&gt; sub { env('CC') },
         cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
         ex_libs          =&gt; add(&quot;\$(LDLIBS)&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
@@ -1859,9 +1901,9 @@ my %targets = (
     &quot;vms-generic&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_VMS&quot; ],
         template         =&gt; 1,
-        cc               =&gt; &quot;CC/DECC&quot;,
-        cpp              =&gt; '$(CC)/PREPROCESS_ONLY=SYS$OUTPUT:',
-        cflags           =&gt;
+        CC               =&gt; &quot;CC/DECC&quot;,
+        CPP              =&gt; '$(CC)/PREPROCESS_ONLY=SYS$OUTPUT:',
+        CFLAGS           =&gt;
             combine(picker(default =&gt; &quot;/STANDARD=(ISOC94,RELAXED)/NOLIST/PREFIX=ALL&quot;,
                            debug   =&gt; &quot;/NOOPTIMIZE/DEBUG&quot;,
                            release =&gt; &quot;/OPTIMIZE/NODEBUG&quot;),
@@ -1887,9 +1929,10 @@ my %targets = (
         dso_scheme       =&gt; &quot;vms&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
 
-        as               =&gt; sub { vms_info()-&gt;{as} },
-        asflags          =&gt; sub { vms_info()-&gt;{asflags} },
+        AS               =&gt; sub { vms_info()-&gt;{AS} },
+        ASFLAGS          =&gt; sub { vms_info()-&gt;{ASFLAGS} },
         asoutflag        =&gt; sub { vms_info()-&gt;{asoutflag} },
+        asflags          =&gt; sub { vms_info()-&gt;{asflags} },
         perlasm_scheme   =&gt; sub { vms_info()-&gt;{perlasm_scheme} },
 
         apps_aux_src     =&gt; &quot;vms_term_sock.c&quot;,
diff --git a/Configurations/50-djgpp.conf b/Configurations/50-djgpp.conf
index b4d19e2..a8853a8 100644
--- a/Configurations/50-djgpp.conf
+++ b/Configurations/50-djgpp.conf
@@ -5,8 +5,9 @@
 my %targets = (
     &quot;DJGPP&quot; =&gt; {
         inherit_from     =&gt; [ asm(&quot;x86_asm&quot;) ],
-        cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-I/dev/env/WATT_ROOT/inc -DTERMIOS -DL_ENDIAN -fomit-frame-pointer -O2 -Wall&quot;,
+        CC               =&gt; &quot;gcc&quot;,
+        CFLAGS           =&gt; &quot;-fomit-frame-pointer -O2 -Wall&quot;,
+        cflags           =&gt; &quot;-I/dev/env/WATT_ROOT/inc -DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;MSDOS&quot;,
         lflags           =&gt; add(&quot;-L/dev/env/WATT_ROOT/lib&quot;),
         ex_libs          =&gt; add(&quot;-lwatt&quot;),
diff --git a/Configurations/50-haiku.conf b/Configurations/50-haiku.conf
index b57e148..cd6d10e 100644
--- a/Configurations/50-haiku.conf
+++ b/Configurations/50-haiku.conf
@@ -1,10 +1,11 @@
 my %targets = (
     &quot;haiku-common&quot; =&gt; {
         template         =&gt; 1,
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-DL_ENDIAN -Wall -include \$(SRCDIR)/os-dep/haiku.h&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
                                               debug   =&gt; &quot;-g -O0&quot;,
-                                              release =&gt; &quot;-O2&quot;),
+                                              release =&gt; &quot;-O2&quot;)),
+        cflags           =&gt; add_before(&quot;-DL_ENDIAN -include \$(SRCDIR)/os-dep/haiku.h&quot;,
                                        threads(&quot;-D_REENTRANT&quot;)),
         sys_id           =&gt; &quot;HAIKU&quot;,
         ex_libs          =&gt; &quot;-lnetwork&quot;,
@@ -18,7 +19,7 @@ my %targets = (
     },
     &quot;haiku-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;haiku-common&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cflags           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
     &quot;haiku-x86_64&quot; =&gt; {
diff --git a/Configurations/50-masm.conf b/Configurations/50-masm.conf
index e2b54e3..2c55ddd 100644
--- a/Configurations/50-masm.conf
+++ b/Configurations/50-masm.conf
@@ -11,9 +11,10 @@ my %targets = (
     &quot;VC-WIN64A-masm&quot; =&gt; {
         inherit_from    =&gt; [ &quot;VC-WIN64-common&quot;, asm(&quot;x86_64_asm&quot;),
                              sub { $disabled{shared} ? () : &quot;x86_64_uplink&quot; } ],
-        as              =&gt; &quot;ml64&quot;,
-        asflags         =&gt; &quot;/nologo /c /Cp /Cx /Zi&quot;,
+        AS              =&gt; &quot;ml64&quot;,
+        ASFLAGS         =&gt; &quot;/nologo /Zi&quot;,
         asoutflag       =&gt; &quot;/Fo&quot;,
+        asflags         =&gt; &quot;/c /Cp /Cx&quot;,
         sys_id          =&gt; &quot;WIN64A&quot;,
         bn_asm_src      =&gt; sub { return undef unless @_;
                                  my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s|asm/x86_64-gcc|bn_asm|; $r; },
diff --git a/Configurations/90-team.conf b/Configurations/90-team.conf
index 3138218..a5cc6da 100644
--- a/Configurations/90-team.conf
+++ b/Configurations/90-team.conf
@@ -5,7 +5,7 @@ my %targets = (
     &quot;purify&quot; =&gt; {
         inherit_from     =&gt; [ 'BASE_unix' ],
         cc               =&gt; &quot;purify gcc&quot;,
-        cflags           =&gt; &quot;-g -Wall&quot;,
+        CFLAGS           =&gt; &quot;-g -Wall&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         ex_libs          =&gt; add(&quot; &quot;,&quot;-lsocket -lnsl&quot;),
     },
@@ -81,8 +81,8 @@ my %targets = (
     },
     &quot;dist&quot; =&gt; {
         inherit_from     =&gt; [ 'BASE_unix' ],
-        cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-O&quot;,
+        CC               =&gt; &quot;cc&quot;,
+        CFLAGS           =&gt; &quot;-O&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;debug-test-64-clang&quot; =&gt; {
diff --git a/Configurations/README b/Configurations/README
index 8d32a25..d809824 100644
--- a/Configurations/README
+++ b/Configurations/README
@@ -45,19 +45,24 @@ In each table entry, the following keys are significant:
                            Note: if the same feature is both enabled
                            and disabled, disable wins.
 
+        as              =&gt; The assembler command.  This is not always
+                           used (for example on Unix, where the C
+                           compiler is used instead).
+        asflags         =&gt; Default assembler command flags [4].
         cpp             =&gt; The C preprocessor command, normally not
                            given, as the build file defaults are
                            usually good enough.
-        cppflags        =&gt; The C preprocessor flags.
+        cppflags        =&gt; Default C preprocessor flags [4].
         defines         =&gt; As an alternative, macro definitions may be
-                           given here instead of in `cppflags'.  If
-                           given here, they MUST be as an array of the
-                           string such as &quot;MACRO=value&quot;, or just
+                           given here instead of in `cppflags' [4].
+                           If given here, they MUST be as an array of
+                           the string such as &quot;MACRO=value&quot;, or just
                            &quot;MACRO&quot; for definitions without value.
         includes        =&gt; As an alternative, inclusion directories
-                           may be given here instead of in `cppflags'.
-                           If given here, the MUST be an array of
-                           strings, one directory specification each.
+                           may be given here instead of in `cppflags'
+                           [4].  If given here, the MUST be an array
+                           of strings, one directory specification
+                           each.
         cc              =&gt; The C compiler command, usually one of &quot;cc&quot;,
                            &quot;gcc&quot; or &quot;clang&quot;.  This command is normally
                            also used to link object files and
@@ -67,14 +72,9 @@ In each table entry, the following keys are significant:
                            also used when linking a program where at
                            least one of the object file is made from
                            C++ source.
-        cflags          =&gt; Flags that are used at all times when
-                           compiling C object files.
-        cxxflags        =&gt; Flags that are used at all times when
-                           compiling C++ object files.  If unset, it
-                           gets the same value as cflags.
-        shared_cflag    =&gt; Extra compilation flags used when
-                           compiling for shared libraries, typically
-                           something like &quot;-fPIC&quot;.
+        cflags          =&gt; Defaults C compiler flags [4].
+        cxxflags        =&gt; Default  C++ compiler flags [4].  If unset,
+                           it gets the same value as cflags.
 
         (linking is a complex thing, see [3] below)
         ld              =&gt; Linker command, usually not defined
@@ -82,13 +82,24 @@ In each table entry, the following keys are significant:
                            instead).
                            (NOTE: this is here for future use, it's
                            not implemented yet)
-        lflags          =&gt; Flags that are used when linking apps.
-        shared_ldflag   =&gt; Flags that are used when linking shared
-                           or dynamic libraries.
-        plib_lflags     =&gt; Extra linking flags to appear just before
-                           the libraries on the command line.
+        lflags          =&gt; Default flags used when linking apps,
+                           shared libraries or DSOs [4].
         ex_libs         =&gt; Extra libraries that are needed when
-                           linking.
+                           linking shared libraries, DSOs or programs.
+
+        shared_cppflags =&gt; Extra C preprocessor flags used when
+                           processing C files for shared libraries.
+        shared_cflag    =&gt; Extra C compiler flags used when compiling
+                           for shared libraries, typically something
+                           like &quot;-fPIC&quot;.
+        shared_ldflag   =&gt; Extra linking flags used when linking
+                           shared libraries.
+        module_cppflags
+        module_cflags
+        module_ldflags  =&gt; Has the same function as the corresponding
+                           `shared_' attributes, but for building DSOs.
+                           When unset, they get the same values as the
+                           corresponding `shared_' attributes.
 
         ar              =&gt; The library archive command, the default is
                            &quot;ar&quot;.
@@ -338,18 +349,20 @@ In each table entry, the following keys are significant:
     of this file):
 
     shared libraries:
-        {ld} $(CFLAGS) {shared_ldflag} -shared -o libfoo.so \
-            -Wl,--whole-archive libfoo.a -Wl,--no-whole-archive \
-            {plib_lflags} -lcrypto {ex_libs}
+        {ld} $(CFLAGS) {lflags} {shared_ldflag} -o libfoo.so \
+            foo/something.o foo/somethingelse.o {ex_libs}
 
     shared objects:
-        {ld} $(CFLAGS) {shared_ldflag} -shared -o libeng.so \
-            blah1.o blah2.o {plib_lflags} -lcrypto {ex_libs}
+        {ld} $(CFLAGS) {lflags} {module_ldflags} -o libeng.so \
+            blah1.o blah2.o -lcrypto {ex_libs}
 
     applications:
         {ld} $(CFLAGS) {lflags} -o app \
-            app1.o utils.o {plib_lflags} -lssl -lcrypto {ex_libs}
+            app1.o utils.o -lssl -lcrypto {ex_libs}
 
+[4] There are variants of these attribute, prefixed with `lib_',
+    `dso_' or `bin_'.  Those variants replace the unprefixed attribute
+    when building library, DSO or program modules specifically.
 
 Historically, the target configurations came in form of a string with
 values separated by colons.  This use is deprecated.  The string form
diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index 2364644..e8780e4 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -171,51 +171,168 @@ OPENSSLDIR_C={- $osslprefix -}DATAROOT:[000000]
 # Where installed engines reside, for C
 ENGINESDIR_C={- $osslprefix -}ENGINES{- $sover_dirname.$target{pointer_size} -}:
 
-CC= {- $config{cc} -}
-CPP= {- $config{cpp} -}
-DEFINES={- our $defines = join(&quot;,&quot;,
-                               '__dummy', # To make comma processing easier
-                               @{$config{defines}}) -}
-INCLUDES={- our $includes = join(',', @{$config{includes}}) -}
-CPPFLAGS='qual_includes'{- our $cppflags = join('', @{$config{cppflags}}) -}
-CPPFLAGS_Q={- (my $x = $cppflags) =~ s|&quot;|&quot;&quot;|g;
-              (my $d = $defines) =~ s|&quot;|&quot;&quot;|g;
-              $x .= &quot;/INCLUDE=($includes)&quot; if $includes;
-              $x .= &quot;/DEFINE=($d)&quot;;
-              $x; -}
-CFLAGS={- join('', @{$config{cflags}}) -}
-LDFLAGS= {- join('', @{$config{lflags}}) -}
-EX_LIBS= {- join('', map { ','.$_ } @{$config{ex_libs}}) -}
-
-LIB_DEFINES=$(DEFINES){- join(&quot;&quot;, (map { &quot;,$_&quot; }
-                                   @{$target{shared_defines}},
-                                   'OPENSSLDIR=&quot;&quot;&quot;$(OPENSSLDIR_C)&quot;&quot;&quot;',
-                                   'ENGINESDIR=&quot;&quot;&quot;$(ENGINESDIR_C)&quot;&quot;&quot;')) -}
-LIB_CPPFLAGS=$(CPPFLAGS)/DEFINE=($(LIB_DEFINES))
-LIB_CFLAGS=$(CFLAGS){- $target{lib_cflags} // &quot;&quot; -}
-DSO_DEFINES=$(DEFINES){- join(&quot;&quot;, (map { &quot;,$_&quot; } @{$target{dso_defines}})) -}
-DSO_CPPFLAGS=$(CPPFLAGS)/DEFINE=($(DSO_DEFINES))
-DSO_CFLAGS=$(CFLAGS){- $target{dso_cflags} // &quot;&quot; -}
-BIN_DEFINES=$(DEFINES){- join(&quot;&quot;, (map { &quot;,$_&quot; } @{$target{bin_defines}})) -}
-BIN_CPPFLAGS=$(CPPFLAGS)/DEFINE=($(BIN_DEFINES))
-BIN_CFLAGS=$(CFLAGS){- $target{bin_cflags} // &quot;&quot; -}
-NO_INST_LIB_CFLAGS=$(CFLAGS){- $target{no_inst_lib_cflags}
-                               // $target{lib_cflags}
-                               // &quot;&quot; -}
-NO_INST_DSO_CFLAGS=$(CFLAGS){- $target{no_inst_dso_cflags}
-                               // $target{dso_cflags}
-                               // &quot;&quot; -}
-NO_INST_BIN_CFLAGS=$(CFLAGS){- $target{no_inst_bin_cflags}
-                               // $target{bin_cflags}
-                               // &quot;&quot; -}
+##### User defined commands and flags ################################
+
+CC={- $config{CC} -}
+CPP={- $config{CPP} -}
+DEFINES={- our $defines1 = join('', map { &quot;,$_&quot; } @{$config{CPPDEFINES}}) -}
+INCLUDES={- our $includes1 = join('', map { &quot;,$_&quot; } @{$config{CPPINCLUDES}}) -}
+CPPFLAGS={- our $cppflags1 = join('', @{$config{CPPFLAGS}}) -}
+CFLAGS={- join('', @{$config{CFLAGS}}) -}
+LDFLAGS={- join('', @{$config{LFLAGS}}) -}
+EX_LIBS={- join('', map { &quot;,$_&quot; } @{$config{LDLIBS}}) -}
 
 PERL={- $config{perl} -}
 
-AS={- $config{as} -}
-ASFLAGS={- join(' ', @{$config{asflags}}) -}
+AS={- $config{AS} -}
+ASFLAGS={- join(' ', @{$config{ASFLAGS}}) -}
+
+##### Special command flags ##########################################
+
 ASOUTFLAG={- $target{asoutflag} -}$(OSSL_EMPTY)
+
+##### Project flags ##################################################
+
+# Variables starting with CNF_ are common variables for all product types
+
+CNF_ASFLAGS={- join('', $target{asflags} || (),
+                        @{$config{asflags}}) -}
+CNF_DEFINES={- our $defines2 = join('', map { &quot;,$_&quot; } @{$target{defines}},
+                                                      @{$config{defines}}) -}
+CNF_INCLUDES={- our $includes2 = join(',', @{$target{includes}},
+                                           @{$config{includes}}) -}
+CNF_CPPFLAGS={- our $cppflags2 = join('', $target{cppflags} || (),
+                                          @{$config{cppflags}}) -}
+CNF_CFLAGS={- join('', $target{cflags} || (),
+                       @{$config{cflags}}) -}
+CNF_CXXFLAGS={- join('', $target{cxxflags} || (),
+                         @{$config{cxxflags}}) -}
+CNF_LDFLAGS={- join('', $target{lflags} || (),
+                        @{$config{lflags}}) -}
+CNF_EX_LIBS={- join('', map{ &quot;,$_&quot; } @{$target{ex_libs}},
+                                     @{$config{ex_libs}}) -}
+
+# Variables starting with LIB_ are used to build library object files
+# and shared libraries.
+# Variables starting with DSO_ are used to build DSOs and their object files.
+# Variables starting with BIN_ are used to build programs and their object
+# files.
+
+LIB_ASFLAGS={- join(' ', $target{lib_asflags} || (),
+                         @{$config{lib_asflags}},
+                         '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
+LIB_DEFINES={- join('', (map { &quot;,$_&quot; } @{$target{lib_defines}},
+                                       @{$target{shared_defines}},
+                                       @{$config{lib_defines}},
+                                       @{$config{shared_defines}},
+                                       'OPENSSLDIR=&quot;&quot;&quot;$(OPENSSLDIR_C)&quot;&quot;&quot;',
+                                       'ENGINESDIR=&quot;&quot;&quot;$(ENGINESDIR_C)&quot;&quot;&quot;'),
+                        '$(CNF_DEFINES)', '$(DEFINES)') -}
+LIB_INCLUDES={- join(',', @{$target{lib_includes}},
+                          @{$target{shared_includes}},
+                          @{$config{lib_includes}},
+                          @{$config{shared_includes}}) -}
+LIB_CPPFLAGS={- join('', &quot;'qual_includes'&quot;,
+                         '/DEFINE=(__dummy$(LIB_DEFINES))',
+                         $target{lib_cppflags} || (),
+                         $target{shared_cppflags} || (),
+                         @{$config{lib_cppflags}},
+                         @{$config{shared_cppflag}},
+                         '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+LIB_CFLAGS={- join('', $target{lib_cflags} || (),
+                       $target{shared_cflag} || (),
+                       @{$config{lib_cflags}},
+                       @{$config{shared_cflag}},
+                       '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+LIB_LDFLAGS={- join('', $target{lib_lflags} || (),
+                        $target{shared_ldflag} || (),
+                        @{$config{lib_lflags}},
+                        @{$config{shared_ldflag}},
+                        '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+LIB_EX_LIBS=$(CNF_EX_LIBS)$(EX_LIBS)
+DSO_ASFLAGS={- join(' ', $target{dso_asflags} || (),
+                         $target{module_asflags} || (),
+                         @{$config{dso_asflags}},
+                         @{$config{module_asflags}},
+                         '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
+DSO_DEFINES={- join('', (map { &quot;,$_&quot; } @{$target{dso_defines}},
+                                       @{$target{module_defines}},
+                                       @{$config{dso_defines}},
+                                       @{$config{module_defines}}),
+                        '$(CNF_DEFINES)', '$(DEFINES)') -}
+DSO_INCLUDES={- join(',', @{$target{dso_includes}},
+                          @{$target{module_includes}},
+                          @{$config{dso_includes}},
+                          @{$config{module_includes}}) -}
+DSO_CPPFLAGS={- join('', &quot;'qual_includes'&quot;,
+                         '/DEFINE=(__dummy$(DSO_DEFINES))',
+                         $target{dso_cppflags} || (),
+                         $target{module_cppflags} || (),
+                         @{$config{dso_cppflags}},
+                         @{$config{module_cppflags}},
+                         '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+DSO_CFLAGS={- join('', $target{dso_cflags} || (),
+                       $target{module_cflags} || (),
+                       @{$config{dso_cflags}},
+                       @{$config{module_cflags}},
+                       '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+DSO_LDFLAGS={- join('', $target{dso_lflags} || (),
+                        $target{module_ldflags} || (),
+                        @{$config{dso_lflags}},
+                        @{$config{module_ldflags}},
+                        '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+DSO_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+BIN_ASFLAGS={- join(' ', $target{bin_asflags} || (),
+                         @{$config{bin_asflags}},
+                         '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
+BIN_DEFINES={- join('', (map { &quot;,$_&quot; } @{$target{bin_defines}},
+                                       @{$config{bin_defines}}),
+                        '$(CNF_DEFINES)', '$(DEFINES)') -}
+BIN_INCLUDES={- join(',', @{$target{bin_includes}},
+                          @{$config{bin_includes}}) -}
+BIN_CPPFLAGS={- join('', &quot;'qual_includes'&quot;,
+                         '/DEFINE=(__dummy$(DSO_DEFINES))',
+                         $target{bin_cppflags} || (),
+                         @{$config{bin_cppflag}},
+                         '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+BIN_CFLAGS={- join('', $target{bin_cflag} || (),
+                       @{$config{bin_cflag}},
+                       '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+BIN_LDFLAGS={- join('', $target{bin_lflags} || (),
+                        @{$config{bin_lflags}} || (),
+                        '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+BIN_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+NO_INST_LIB_CFLAGS={- join('', $target{no_inst_lib_cflags}
+                               // $target{lib_cflags}
+                               // (),
+                               $target{shared_cflag} || (),
+                               @{$config{lib_cflags}},
+                               @{$config{shared_cflag}},
+                               '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+NO_INST_DSO_CFLAGS={- join('', $target{no_inst_lib_cflags}
+                               // $target{lib_cflags}
+                               // (),
+                               $target{dso_cflags} || (),
+                               @{$config{lib_cflags}},
+                               @{$config{dso_cflags}},
+                               '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+NO_INST_BIN_CFLAGS={- join('', $target{no_inst_bin_cflags}
+                               // $target{bin_cflags}
+                               // (),
+                               @{$config{bin_cflags}},
+                               '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+
 PERLASM_SCHEME={- $target{perlasm_scheme} -}
 
+# CPPFLAGS_Q is used for one thing only: to build up buildinf.h
+CPPFLAGS_Q={- (my $c = $cppflags1.$cppflags2) =~ s|&quot;|&quot;&quot;|g;
+              (my $d = $defines1.$defines2) =~ s|&quot;|&quot;&quot;|g;
+              my $i = join(',', $includes1 || (), $includes2 || ());
+              my $x = $c;
+              $x .= &quot;/INCLUDE=($i)&quot; if $i;
+              $x .= &quot;/DEFINE=($d)&quot; if $d;
+              $x; -}
+
 # .FIRST and .LAST are special targets with MMS and MMK.
 # The defines in there are for C.  includes that look like
 # this:
@@ -666,6 +783,7 @@ EOF
           my @incs_cmds = includes({ lib =&gt; '$(LIB_INCLUDES)',
                                      dso =&gt; '$(DSO_INCLUDES)',
                                      bin =&gt; '$(BIN_INCLUDES)' } -&gt; {$args{intent}},
+                                   '$(CNF_INCLUDES)',
                                    '$(INCLUDES)',
                                    @{$args{incs}});
           my $incs_on = join(&quot;\n\t\@ &quot;, @{$incs_cmds[0]}) || '!';
@@ -725,11 +843,14 @@ EOF
       my $after = $unified_info{after}-&gt;{$obj.&quot;.OBJ&quot;} || &quot;\@ !&quot;;
 
       if ($srcs[0] =~ /\.asm$/) {
+          my $asflags = { lib =&gt; ' $(LIB_ASFLAGS)',
+		          dso =&gt; ' $(DSO_ASFLAGS)',
+		          bin =&gt; ' $(BIN_ASFLAGS)' } -&gt; {$args{intent}};
           return &lt;&lt;&quot;EOF&quot;;
 $obj.OBJ : $deps
         ${before}
         SET DEFAULT $forward
-        \$(AS) \$(ASFLAGS) \$(ASOUTFLAG)${objd}${objn}.OBJ $srcs
+        \$(AS) $asflags \$(ASOUTFLAG)${objd}${objn}.OBJ $srcs
         SET DEFAULT $backward
 EOF
       }
@@ -817,8 +938,8 @@ $shlib.EXE : $lib.OLB $deps
         $write_opt1
         $write_opt2
         CLOSE OPT_FILE
-        LINK \$(LDFLAGS)/SHARE=\$\@ $defs[0]-translated/OPT,-
-                $lib-components.OPT/OPT \$(EX_LIBS)
+        LINK \$(LIB_LDFLAGS)/SHARE=\$\@ $defs[0]-translated/OPT,-
+                $lib-components.OPT/OPT \$(LIB_EX_LIBS)
         DELETE $defs[0]-translated;*,$lib-components.OPT;*
         PURGE $shlib.EXE,$shlib.MAP
 EOF
@@ -861,7 +982,7 @@ $lib.EXE : $deps
         $write_opt1
         $write_opt2
         CLOSE OPT_FILE
-        LINK \$(LDFLAGS)/SHARE=\$\@ $lib.OPT/OPT \$(EX_LIBS)
+        LINK \$(DSO_LDFLAGS)/SHARE=\$\@ $lib.OPT/OPT \$(DSO_EX_LIBS)
         - PURGE $lib.EXE,$lib.OPT,$lib.MAP
 EOF
         . ($config{target} =~ m|alpha| ? &quot;&quot; : &lt;&lt;&quot;EOF&quot;
@@ -949,7 +1070,7 @@ $bin.EXE : $deps
         @ CLOSE OPT_FILE
         TYPE $bin.opt ! For debugging
         - pipe SPAWN/WAIT/NOLOG/OUT=$bin.LINKLOG -
-                    LINK \$(LDFLAGS)/EXEC=\$\@ $bin.OPT/OPT \$(EX_LIBS) ; -
+                    LINK \$(BIN_LDFLAGS)/EXEC=\$\@ $bin.OPT/OPT \$(BIN_EX_LIBS) ; -
                link_status = \$status ; link_severity = link_status .AND. 7
         @ search_severity = 1
         -@ IF link_severity .EQ. 0 THEN -
diff --git a/Configurations/shared-info.pl b/Configurations/shared-info.pl
index 9716348..f3c4cb6 100644
--- a/Configurations/shared-info.pl
+++ b/Configurations/shared-info.pl
@@ -13,12 +13,12 @@
 
 sub detect_gnu_ld {
     my @lines =
-        `$config{cross_compile_prefix}$config{cc} -Wl,-V /dev/null 2&gt;&amp;1`;
+        `$config{CROSS_COMPILE}$config{CC} -Wl,-V /dev/null 2&gt;&amp;1`;
     return grep /^GNU ld/, @lines;
 }
 sub detect_gnu_cc {
     my @lines =
-        `$config{cross_compile_prefix}$config{cc} -v 2&gt;&amp;1`;
+        `$config{CROSS_COMPILE}$config{CC} -v 2&gt;&amp;1`;
     return grep /gcc/, @lines;
 }
 
@@ -42,7 +42,7 @@ my %shared_info;
         };
     },
     'darwin-shared' =&gt; {
-        dso_lflags            =&gt; '-bundle',
+        module_ldflags        =&gt; '-bundle',
         shared_ldflag         =&gt; '-dynamiclib -current_version $(SHLIB_VERSION_NUMBER) -compatibility_version $(SHLIB_VERSION_NUMBER)',
         shared_sonameflag     =&gt; '-install_name $(INSTALLTOP)/$(LIBDIR)/',
     },
@@ -61,7 +61,7 @@ my %shared_info;
     'alpha-osf1-shared' =&gt; sub {
         return $shared_info{'gnu-shared'} if detect_gnu_ld();
         return {
-            dso_lflags        =&gt; '-shared -Wl,-Bsymbolic',
+            module_ldflags    =&gt; '-shared -Wl,-Bsymbolic',
             shared_ldflag     =&gt; '-shared -Wl,-Bsymbolic -set_version $(SHLIB_VERSION_NUMBER)',
         };
     },
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index fd1f109..588c6c1 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -188,60 +188,136 @@ HTMLSUFFIX=html
 # For &quot;optional&quot; echo messages, to get &quot;real&quot; silence
 ECHO = echo
 
-CROSS_COMPILE= {- $config{cross_compile_prefix} -}
-CPPFLAGS={- our $cppflags = join(&quot; &quot;,
-                                 (map { &quot;-D&quot;.$_} @{$config{defines}}),
-                                 (map { &quot;-I&quot;.$_} @{$config{includes}}),
-                                 @{$config{cppflags}}) -}
-CPPFLAGS_Q={- $cppflags =~ s|([\\&quot;])|\\$1|g; $cppflags -}
-CC= $(CROSS_COMPILE){- $config{cc} -}
-CFLAGS={- join(' ', @{$config{cflags}}) -}
-CXX={- $config{cxx} ? &quot;\$(CROSS_COMPILE)$config{cxx}&quot; : '' -}
-CXXFLAGS={- join(' ', @{$config{cxxflags}}) -}
-LDFLAGS= {- join(' ', @{$config{lflags}}) -}
-PLIB_LDFLAGS= {- join(' ', @{$config{plib_lflags}}) -}
-EX_LIBS= {- join(' ', @{$config{ex_libs}}) -}
-
-LIB_CPPFLAGS={- join(' ', '$(CPPFLAGS)',
-                          $target{shared_cppflag} || (),
-                          (map { '-D'.$_ }
-                               ('OPENSSLDIR=&quot;\&quot;$(OPENSSLDIR)\&quot;&quot;',
-                                'ENGINESDIR=&quot;\&quot;$(ENGINESDIR)\&quot;&quot;'))) -}
-LIB_CFLAGS={- join(' ', '$(CFLAGS)', $target{shared_cflag} || ()) -}
-LIB_CXXFLAGS={- join(' ', '$(CXXFLAGS)', $target{shared_cxxflag} || ()) -}
-LIB_LDFLAGS={- join(' ', '$(LDFLAGS)', $target{shared_ldflag} || (), $config{shared_ldflag} || ()) -}
-DSO_CPPFLAGS={- join(' ', '$(CPPFLAGS)', $target{dso_cppflags} || ()) -}
-DSO_CFLAGS={- join(' ', '$(CFLAGS)', $target{dso_cflags} || ()) -}
-DSO_CXXFLAGS={- join(' ', '$(CXXFLAGS)', $target{dso_cxxflags} || ()) -}
-DSO_LDFLAGS={- join(' ', '$(LDFLAGS)', $target{dso_lflags} || ()) -}
-BIN_CPPFLAGS={- join(' ', '$(CPPFLAGS)', $target{bin_cppflags} || ()) -}
-BIN_CFLAGS={- join(' ', '$(CFLAGS)', $target{bin_cflags} || ()) -}
-BIN_CXXFLAGS={- join(' ', '$(CXXFLAGS)', $target{bin_cxxflags} || ()) -}
-BIN_LDFLAGS={- join(' ', '$(LDFLAGS)', $target{bin_lflags} || ()) -}
+##### User defined commands and flags ################################
+
+# We let the C compiler driver to take care of .s files. This is done in
+# order to be excused from maintaining a separate set of architecture
+# dependent assembler flags. E.g. if you throw -mcpu=ultrasparc at SPARC
+# gcc, then the driver will automatically translate it to -xarch=v8plus
+# and pass it down to assembler.  In any case, we do not define AS or
+# ASFLAGS for this reason.
+
+CROSS_COMPILE={- $config{CROSS_COMPILE} -}
+CC=$(CROSS_COMPILE){- $config{CC} -}
+CXX={- $config{CXX} ? &quot;\$(CROSS_COMPILE)$config{CXX}&quot; : '' -}
+CPPFLAGS={- our $cppflags1 = join(&quot; &quot;,
+                                  (map { &quot;-D&quot;.$_} @{$config{CPPDEFINES}}),
+                                  (map { &quot;-I&quot;.$_} @{$config{CPPINCLUDES}}),
+                                  @{$config{CPPFLAGS}}) -}
+CFLAGS={- join(' ', @{$config{CFLAGS}}) -}
+CXXFLAGS={- join(' ', @{$config{CXXFLAGS}}) -}
+LDFLAGS= {- join(' ', @{$config{LDFLAGS}}) -}
+EX_LIBS= {- join(' ', @{$config{LDLIBS}}) -}
+
+MAKEDEPEND={- $config{makedepprog} -}
 
 PERL={- $config{perl} -}
 
-AR=$(CROSS_COMPILE){- $config{ar} -}
-ARFLAGS= {- join(' ', @{$config{arflags}}) -}
-RANLIB={- $config{ranlib} ? &quot;\$(CROSS_COMPILE)$config{ranlib}&quot; : &quot;true&quot;; -}
-RC= $(CROSS_COMPILE){- $target{rc} || &quot;windres&quot; -}
-RCFLAGS={- join(' ', @{$config{rcflags}}) -} {- $target{shared_rcflag} -}
+AR=$(CROSS_COMPILE){- $config{AR} -}
+ARFLAGS= {- join(' ', @{$config{ARFLAGS}}) -}
+RANLIB={- $config{RANLIB} ? &quot;\$(CROSS_COMPILE)$config{RANLIB}&quot; : &quot;true&quot;; -}
+RC= $(CROSS_COMPILE){- $config{RC} -}
+RCFLAGS={- join(' ', @{$config{RCFLAGS}}) -} {- $target{shared_rcflag} -}
+
 RM= rm -f
 RMDIR= rmdir
-TAR= {- $target{tar} || &quot;tar&quot; -}
-TARFLAGS= {- $target{tarflags} -}
-MAKEDEPEND={- $config{makedepprog} -}
+TAR= {- $target{TAR} || &quot;tar&quot; -}
+TARFLAGS= {- $target{TARFLAGS} -}
 
 BASENAME=       openssl
 NAME=           $(BASENAME)-$(VERSION)
 TARFILE=        ../$(NAME).tar
 
-# We let the C compiler driver to take care of .s files. This is done in
-# order to be excused from maintaining a separate set of architecture
-# dependent assembler flags. E.g. if you throw -mcpu=ultrasparc at SPARC
-# gcc, then the driver will automatically translate it to -xarch=v8plus
-# and pass it down to assembler.  In any case, we do not define AS or
-# ASFLAGS for this reason.
+##### Project flags ##################################################
+
+# Variables starting with CNF_ are common variables for all product types
+
+CNF_CPPFLAGS={- our $cppflags2 =
+                    join(' ', $target{cppflags} || (),
+                              (map { &quot;-D&quot;.$_} @{$target{defines}},
+                                              @{$config{defines}}),
+                              (map { &quot;-I&quot;.$_} @{$target{includes}},
+                                              @{$config{includes}}),
+                              @{$config{cppflags}}) -}
+CNF_CFLAGS={- join(' ', $target{cflags} || (),
+                        @{$config{cflags}}) -}
+CNF_CXXFLAGS={- join(' ', $target{cxxflags} || (),
+                          @{$config{cxxflags}}) -}
+CNF_LDFLAGS={- join(' ', $target{lflags} || (),
+                         @{$config{lflags}}) -}
+CNF_EX_LIBS={- join(' ', $target{ex_libs} || (),
+                         @{$config{ex_libs}}) -}
+
+# Variables starting with LIB_ are used to build library object files
+# and shared libraries.
+# Variables starting with DSO_ are used to build DSOs and their object files.
+# Variables starting with BIN_ are used to build programs and their object
+# files.
+
+LIB_CPPFLAGS={- join(' ', $target{lib_cppflags} || (),
+                          $target{shared_cppflag} || (),
+                          (map { '-D'.$_ }
+                               @{$config{lib_defines}},
+                               @{$config{shared_defines}},
+                               'OPENSSLDIR=&quot;\&quot;$(OPENSSLDIR)\&quot;&quot;',
+                               'ENGINESDIR=&quot;\&quot;$(ENGINESDIR)\&quot;&quot;'),
+                          @{$config{lib_cppflags}},
+                          @{$config{shared_cppflag}},
+                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+LIB_CFLAGS={- join(' ', $target{lib_cflags} || (),
+                        $target{shared_cflag} || (),
+                        @{$config{lib_cflags}},
+                        @{$config{shared_cflag}},
+                        '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+LIB_CXXFLAGS={- join(' ', $target{lib_cxxflags} || (),
+                          $target{shared_cxxflag} || (),
+                          @{$config{lib_cxxflags}},
+                          @{$config{shared_cxxflag}},
+                          '$(CNF_CXXFLAGS)', '$(CXXFLAGS)') -}
+LIB_LDFLAGS={- join(' ', $target{shared_ldflag} || (),
+                         $config{shared_ldflag} || (),
+                         '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+LIB_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+DSO_CPPFLAGS={- join(' ', $target{dso_cppflags} || (),
+                          $target{module_cppflags} || (),
+                          @{$config{dso_cppflags}},
+                          @{$config{module_cppflags}},
+                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+DSO_CFLAGS={- join(' ', $target{dso_cflags} || (),
+                        $target{module_cflags} || (),
+                        @{$config{dso_cflags}},
+                        @{$config{module_cflags}},
+                        '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+DSO_CXXFLAGS={- join(' ', $target{dso_cxxflags} || (),
+                          $target{module_cxxflags} || (),
+                          @{$config{dso_cxxflags}},
+                          @{$config{module_cxxflag}},
+                          '$(CNF_CXXFLAGS)', '$(CXXFLAGS)') -}
+DSO_LDFLAGS={- join(' ', $target{dso_ldflags} || (),
+                         $target{module_ldflags} || (),
+                         @{$config{dso_ldflags}},
+                         @{$config{module_ldflags}},
+                         '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+DSO_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+BIN_CPPFLAGS={- join(' ', $target{bin_cppflags} || (),
+                          @{$config{bin_cppflags}},
+                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+BIN_CFLAGS={- join(' ', $target{bin_cflags} || (),
+                        @{$config{bin_cflags}},
+                        '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+BIN_CXXFLAGS={- join(' ', $target{bin_cxxflags} || (),
+                          @{$config{bin_cxxflags}},
+                          '$(CNF_CXXFLAGS)', '$(CXXFLAGS)') -}
+BIN_LDFLAGS={- join(' ', $target{bin_lflags} || (),
+                         @{$config{bin_lflags}},
+                         '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+BIN_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+
+# CPPFLAGS_Q is used for one thing only: to build up buildinf.h
+CPPFLAGS_Q={- $cppflags1 =~ s|([\\&quot;])|\\$1|g;
+              $cppflags2 =~ s|([\\&quot;])|\\$1|g;
+              join(' ', $cppflags1 || (), $cppflags2 || ()) -}
+
 PERLASM_SCHEME= {- $target{perlasm_scheme} -}
 
 # For x86 assembler: Set PROCESSOR to 386 if you want to support
@@ -771,7 +847,7 @@ libcrypto.pc:
 	    echo 'Description: OpenSSL cryptography library'; \
 	    echo 'Version: '$(VERSION); \
 	    echo 'Libs: -L$${libdir} -lcrypto'; \
-	    echo 'Libs.private: $(EX_LIBS)'; \
+	    echo 'Libs.private: $(LIB_EX_LIBS)'; \
 	    echo 'Cflags: -I$${includedir}' ) &gt; libcrypto.pc
 
 libssl.pc:
@@ -1024,7 +1100,7 @@ EOF
 $target: $deps
 	\$(CC) \$(LIB_CFLAGS) $linkflags\$(LIB_LDFLAGS)$shared_soname$shared_imp \\
 		-o $target_full$shared_def $objs \\
-                \$(PLIB_LDFLAGS) $linklibs \$(EX_LIBS)
+                $linklibs \$(LIB_EX_LIBS)
 EOF
       if (windowsdll()) {
           $recipe .= &lt;&lt;&quot;EOF&quot;;
@@ -1067,7 +1143,7 @@ EOF
 $target: $objs $deps
 	\$(CC) \$(DSO_CFLAGS) $linkflags\$(DSO_LDFLAGS) \\
 		-o $target $objs \\
-                \$(PLIB_LDFLAGS) $linklibs \$(EX_LIBS)
+                $linklibs \$(DSO_EX_LIBS)
 EOF
   }
   sub obj2lib {
@@ -1115,7 +1191,7 @@ $bin$exeext: $objs $deps
 	rm -f $bin$exeext
 	\$\${LDCMD:-$cmd} $cmdflags $linkflags\$(BIN_LDFLAGS) \\
 		-o $bin$exeext $objs \\
-		\$(PLIB_LDFLAGS) $linklibs \$(EX_LIBS)
+		$linklibs \$(BIN_EX_LIBS)
 EOF
   }
   sub in2script {
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index dd0c849..83f893d 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -163,50 +163,139 @@ ENGINESDIR=$(ENGINESDIR_dev)$(ENGINESDIR_dir)
 libdir={- file_name_is_absolute($libdir)
           ? $libdir : '$(INSTALLTOP)\$(LIBDIR)' -}
 
-CC={- $config{cc} -}
-CPP={- $config{cpp} -}
-CPPFLAGS={- our $cppflags = join(&quot; &quot;,
-                                 (map { &quot;-D&quot;.$_} @{$config{defines}}),
-                                 (map { &quot; /I &quot;.$_} @{$config{includes}}),
-                                 @{$config{cppflags}}) -}
-CPPFLAGS_Q={- $cppflags =~ s|([\\&quot;])|\\$1|g; $cppflags -}
-CFLAGS={- join(' ', @{$config{cflags}}) -}
-COUTFLAG={- $target{coutflag} || &quot;/Fo&quot; -}$(OSSL_EMPTY)
-RC={- $config{rc} -}
-RCOUTFLAG={- $target{rcoutflag} || &quot;/fo&quot; -}$(OSSL_EMPTY)
-LD={- $config{ld} -}
-LDFLAGS={- join(' ', @{$config{lflags}}) -}
-LDOUTFLAG={- $target{loutflag} || &quot;/out:&quot; -}$(OSSL_EMPTY)
-EX_LIBS={- join(' ', @{$config{ex_libs}}) -}
-
-LIB_CPPFLAGS={- join(' ', '$(CPPFLAGS)',
-                          $target{shared_cppflag} || (),
-                          (map { quotify_l(&quot;-D&quot;.$_) }
-                           &quot;OPENSSLDIR=\&quot;$openssldir\&quot;&quot;,
-                           &quot;ENGINESDIR=\&quot;$enginesdir\&quot;&quot;)) -}
-LIB_CFLAGS={- join(' ', '$(CFLAGS)', $target{lib_cflags} || (), $target{shared_cflag} || ()) -}
-LIB_LDFLAGS={- join(' ', '$(LDFLAGS)', $target{shared_ldflag} || (), $config{shared_ldflag} || ()) -}
-DSO_CPPFLAGS={- join(' ', '$(CPPFLAGS)', $target{dso_cppflags} || ()) -}
-DSO_CFLAGS={- join(' ', '$(CFLAGS)', $target{dso_cflags} || ()) -}
-DSO_LDFLAGS={- join(' ', '$(LDFLAGS)', $target{dso_ldflag} || ()) -}
-BIN_CPPFLAGS={- join(' ', '$(CPPFLAGS)', $target{dso_cppflags} || ()) -}
-BIN_CFLAGS={- join(' ', '$(CFLAGS)', $target{bin_cflags} || ()) -}
-BIN_LDFLAGS={- join(' ', '$(LDFLAGS)', $target{bin_lflags} || ()) -}
+##### User defined commands and flags ################################
+
+CC={- $config{CC} -}
+CPP={- $config{CPP} -}
+CPPFLAGS={- our $cppflags1 = join(&quot; &quot;,
+                                  (map { &quot;-D&quot;.$_} @{$config{CPPDEFINES}}),
+                                  (map { &quot; /I &quot;.$_} @{$config{CPPINCLUDES}}),
+                                  @{$config{CPPFLAGS}}) -}
+CFLAGS={- join(' ', @{$config{CFLAGS}}) -}
+LD={- $config{LD} -}
+LDFLAGS={- join(' ', @{$config{LDFLAGS}}) -}
+EX_LIBS={- join(' ', @{$config{LDLIBS}}) -}
 
 PERL={- $config{perl} -}
 
-AR={- $config{ar} -}
-ARFLAGS= {- join(' ', @{$config{arflags}}) -}
-AROUTFLAG={- $target{aroutflag} || &quot;/out:&quot; -}$(OSSL_EMPTY)
+AR={- $config{AR} -}
+ARFLAGS= {- join(' ', @{$config{ARFLAGS}}) -}
+
+MT={- $config{MT} -}
+MTFLAGS= {- join(' ', @{$config{MTFLAGS}}) -}
+
+AS={- $config{AS} -}
+ASFLAGS={- join(' ', @{$config{ASFLAGS}}) -}
 
-MT={- $config{mt} -}
-MTFLAGS= {- join(' ', @{$config{mtflags}}) -}
-MTINFLAG={- $target{mtinflag} || &quot;-manifest &quot; -}$(OSSL_EMPTY)
-MTOUTFLAG={- $target{mtoutflag} || &quot;-outputresource:&quot; -}$(OSSL_EMPTY)
+RC={- $config{RC} -}
 
-AS={- $config{as} -}
-ASFLAGS={- join(' ', @{$config{asflags}}) -}
+##### Special command flags ##########################################
+
+COUTFLAG={- $target{coutflag} -}$(OSSL_EMPTY)
+LDOUTFLAG={- $target{ldoutflag} -}$(OSSL_EMPTY)
+AROUTFLAG={- $target{aroutflag} -}$(OSSL_EMPTY)
+MTINFLAG={- $target{mtinflag} -}$(OSSL_EMPTY)
+MTOUTFLAG={- $target{mtoutflag} -}$(OSSL_EMPTY)
 ASOUTFLAG={- $target{asoutflag} -}$(OSSL_EMPTY)
+RCOUTFLAG={- $target{rcoutflag} -}$(OSSL_EMPTY)
+
+##### Project flags ##################################################
+
+# Variables starting with CNF_ are common variables for all product types
+
+CNF_ASFLAGS={- join(' ', $target{asflags} || (),
+                         @{$config{asflags}}) -}
+CNF_CPPFLAGS={- our $cppfags2 =
+                    join(' ', $target{cppflags} || (),
+                              (map { quotify_l(&quot;-D&quot;.$_) } @{$target{defines}},
+                                                          @{$config{defines}}),
+                              (map { quotify_l(&quot;-I&quot;.$_) } @{$target{includes}},
+                                                          @{$config{includes}}),
+                              @{$config{cppflags}}) -}
+CNF_CFLAGS={- join(' ', $target{cflags} || (),
+                        @{$config{cflags}}) -}
+CNF_CXXFLAGS={- join(' ', $target{cxxflags} || (),
+                          @{$config{cxxflags}}) -}
+CNF_LDFLAGS={- join(' ', $target{lflags} || (),
+                         @{$config{lflags}}) -}
+CNF_EX_LIBS={- join(' ', $target{ex_libs} || (),
+                         @{$config{ex_libs}}) -}
+
+# Variables starting with LIB_ are used to build library object files
+# and shared libraries.
+# Variables starting with DSO_ are used to build DSOs and their object files.
+# Variables starting with BIN_ are used to build programs and their object
+# files.
+
+LIB_ASFLAGS={- join(' ', $target{lib_asflags} || (),
+                         @{$config{lib_asflags}},
+                         '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
+LIB_CPPFLAGS={- join(' ', $target{lib_cppflags} || (),
+                          $target{shared_cppflag} || (),
+                          (map { quotify_l(&quot;-D&quot;.$_) }
+                               @{$target{lib_defines}},
+                               @{$target{shared_defines}},
+                               @{$config{lib_defines}},
+                               @{$config{shared_defines}},
+                               &quot;OPENSSLDIR=\&quot;$openssldir\&quot;&quot;,
+                               &quot;ENGINESDIR=\&quot;$enginesdir\&quot;&quot;),
+                          (map { quotify_l(&quot;-I&quot;.$_) }
+                               @{$target{lib_includes}},
+                               @{$target{shared_includes}},
+                               @{$config{lib_includes}},
+                               @{$config{shared_includes}}),
+                          @{$config{lib_cppflags}},
+                          @{$config{shared_cppflag}},
+                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+LIB_CFLAGS={- join(' ', $target{lib_cflags} || (),
+                        $target{shared_cflag} || (),
+                        @{$config{lib_cflags}},
+                        @{$config{shared_cflag}},
+                        '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+LIB_LDFLAGS={- join(' ', $target{shared_ldflag} || (),
+                         $config{shared_ldflag} || (),
+                         '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+LIB_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+DSO_ASFLAGS={- join(' ', $target{dso_asflags} || (),
+                         $target{module_asflags} || (),
+                         @{$config{dso_asflags}},
+                         @{$config{module_asflags}},
+                         '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
+DSO_CPPFLAGS={- join(' ', $target{dso_cppflags} || (),
+                          $target{module_cppflags} || (),
+                          @{$config{dso_cppflags}},
+                          @{$config{module_cppflags}},
+                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+DSO_CFLAGS={- join(' ', $target{dso_cflags} || (),
+                        $target{module_cflags} || (),
+                        @{$config{dso_cflags}},
+                        @{$config{module_cflags}},
+                        '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+DSO_LDFLAGS={- join(' ', $target{dso_lflags} || (),
+                         $target{module_ldflags} || (),
+                         @{$config{dso_lflags}},
+                         @{$config{module_ldflags}},
+                         '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+DSO_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+BIN_ASFLAGS={- join(' ', $target{bin_asflags} || (),
+                         @{$config{bin_asflags}},
+                         '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
+BIN_CPPFLAGS={- join(' ', $target{bin_cppflags} || (),
+                          @{$config{bin_cppflags}},
+                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
+BIN_CFLAGS={- join(' ', $target{bin_cflags} || (),
+                        @{$config{bin_cflags}},
+                        '$(CNF_CFLAGS)', '$(CFLAGS)') -}
+BIN_LDFLAGS={- join(' ', $target{bin_lflags} || (),
+                         @{$config{bin_lflags}},
+                         '$(CNF_LDFLAGS)', '$(LDFLAGS)') -}
+BIN_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
+
+# CPPFLAGS_Q is used for one thing only: to build up buildinf.h
+CPPFLAGS_Q={- $cppflags1 =~ s|([\\&quot;])|\\$1|g;
+              $cppflags2 =~ s|([\\&quot;])|\\$1|g;
+              join(' ', $cppflags1 || (), $cppflags2 || ()) -}
+
 PERLASM_SCHEME= {- $target{perlasm_scheme} -}
 
 PROCESSOR= {- $config{processor} -}
@@ -484,6 +573,9 @@ EOF
      $cflags .= { lib =&gt; ' $(LIB_CPPFLAGS)',
 		  dso =&gt; ' $(DSO_CPPFLAGS)',
 		  bin =&gt; ' $(BIN_CPPFLAGS)' } -&gt; {$args{intent}};
+     my $asflags = { lib =&gt; ' $(LIB_ASFLAGS)',
+		     dso =&gt; ' $(DSO_ASFLAGS)',
+		     bin =&gt; ' $(BIN_ASFLAGS)' } -&gt; {$args{intent}};
      my $makedepprog = $config{makedepprog};
      if ($srcs[0] =~ /\.rc$/) {
          return &lt;&lt;&quot;EOF&quot;;
@@ -495,7 +587,7 @@ EOF
      if ($srcs[0] =~ /\.asm$/) {
          return &lt;&lt;&quot;EOF&quot;;
 $obj$objext: $deps
-	\$(AS) \$(ASFLAGS) \$(ASOUTFLAG)\$\@ $srcs
+	\$(AS) $asflags \$(ASOUTFLAG)\$\@ $srcs
 EOF
      }
      return &lt;&lt;&quot;EOF&quot;	if (!$disabled{makedepend});
@@ -542,7 +634,7 @@ $target: $deps
 	\$(LD) \$(LDFLAGS) \$(LIB_LDFLAGS) \\
 		/implib:\$@ \$(LDOUTFLAG)$shlib$shlibext$shared_def @&lt;&lt; || (DEL /Q \$(\@B).* $shlib.* &amp;&amp; EXIT 1)
 $objs
-$linklibs\$(EX_LIBS)
+$linklibs\$(LIB_EX_LIBS)
 &lt;&lt;
 	IF EXIST $shlib$shlibext.manifest \\
 	   \$(MT) \$(MTFLAGS) \$(MTINFLAG)$shlib$shlibext.manifest \$(MTOUTFLAG)$shlib$shlibext
@@ -573,7 +665,7 @@ EXPORTS
     v_check		@2
 &lt;&lt;
 $objs
-$linklibs \$(EX_LIBS)
+$linklibs \$(DSO_EX_LIBS)
 &lt;&lt;
 	IF EXIST $dso$dsoext.manifest \\
 	   \$(MT) \$(MTFLAGS) \$(MTINFLAG)$dso$dsoext.manifest \$(MTOUTFLAG)$dso$dsoext
@@ -613,7 +705,7 @@ $bin$exeext: $deps
 	\$(LD) \$(LDFLAGS) \$(BIN_LDFLAGS) \$(LDOUTFLAG)$bin$exeext @&lt;&lt;
 $objs
 setargv.obj
-$linklibs\$(EX_LIBS)
+$linklibs\$(BIN_EX_LIBS)
 &lt;&lt;
 	IF EXIST $bin$exeext.manifest \\
 	   \$(MT) \$(MTFLAGS) \$(MTINFLAG)$bin$exeext.manifest \$(MTOUTFLAG)$bin$exeext
diff --git a/Configure b/Configure
index 6f70e18..1b6a7b6 100755
--- a/Configure
+++ b/Configure
@@ -568,15 +568,31 @@ my %user_synonyms = (
     HASHBANGPERL=&gt; 'PERL',
     RC          =&gt; 'WINDRES',
    );
-my %user_to_target = (
-    # If not given here, the value is the lc of the key
-    CPPDEFINES  =&gt; 'defines',
-    CPPINCLUDES =&gt; 'includes',
-    CROSS_COMPILE =&gt; 'cross_compile_prefix',
-    LDFLAGS     =&gt; 'lflags',
-    LDLIBS      =&gt; 'ex_libs',
+
+# Some target attributes have been renamed, this is the translation table
+my %target_attr_translate =(
+    ar          =&gt; 'AR',
+    as          =&gt; 'AS',
+    cc          =&gt; 'CC',
+    cxx         =&gt; 'CXX',
+    cpp         =&gt; 'CPP',
+    hashbangperl =&gt; 'HASHBANGPERL',
+    ld          =&gt; 'LD',
+    mt          =&gt; 'MT',
+    ranlib      =&gt; 'RANLIB',
+    rc          =&gt; 'RC',
+    rm          =&gt; 'RM',
    );
 
+# Initialisers coming from 'config' scripts
+$config{defines} = [ split(/$list_separator_re/, env('__CNF_CPPDEFINES')) ],
+$config{includes} = [ split(/$list_separator_re/, env('__CNF_CPPINCLUDES')) ],
+$config{cppflags} = [ env('__CNF_CPPFLAGS') || () ],
+$config{cflags} = [ env('__CNF_CFLAGS') || () ],
+$config{cxxflags} = [ env('__CNF_CXXFLAGS') || () ],
+$config{lflags} = [ env('__CNF_LDFLAGS') || () ],
+$config{ex_libs} = [ env('__CNF_LDLIBS') || () ],
+
 $config{openssl_api_defines}=[];
 $config{openssl_algorithm_defines}=[];
 $config{openssl_thread_defines}=[];
@@ -605,10 +621,10 @@ while (@argvcopy)
 			{
 			$user{$1} = ref $user{$1} eq &quot;ARRAY&quot; ? [] : undef;
 			}
-		if (exists $useradd{$1})
-			{
-			$useradd{$1} = [];
-			}
+		#if (exists $useradd{$1})
+		#	{
+		#	$useradd{$1} = [];
+		#	}
 		next;
 		}
 
@@ -875,6 +891,18 @@ while (@argvcopy)
 		}
 	}
 
+if (grep { scalar @$_ &gt; 0 } values %useradd) {
+    my $detected_env = join(', ', grep { @{$useradd{$_}} || env($_) }
+                                  sort keys %useradd);
+    if ($detected_env) {
+        die &lt;&lt;&quot;_____&quot;;
+***** Mixing env / make variables and additional compiler/linker flags as
+***** configure command line option is not permitted.
+***** Affected env / make variables: $detected_env
+_____
+    }
+}
+
 foreach (keys %user) {
     my $value = env($_);
     $value //= defined $user_synonyms{$_} ? env($user_synonyms{$_}) : undef;
@@ -969,13 +997,19 @@ my %target = resolve_config($target);
 
 &amp;usage if (!%target || $target{template});
 
+foreach (keys %target_attr_translate) {
+    $target{$target_attr_translate{$_}} = $target{$_}
+        if $target{$_};
+    delete $target{$_};
+}
+
 %target = ( %{$table{DEFAULTS}}, %target );
 
 # Make the flags to build DSOs the same as for shared libraries unless they
 # are already defined
-$target{dso_cflags} = $target{shared_cflag} unless defined $target{dso_cflags};
-$target{dso_cxxflags} = $target{shared_cxxflag} unless defined $target{dso_cxxflags};
-$target{dso_lflags} = $target{shared_ldflag} unless defined $target{dso_lflags};
+$target{module_cflags} = $target{shared_cflag} unless defined $target{module_cflags};
+$target{module_cxxflags} = $target{shared_cxxflag} unless defined $target{module_cxxflags};
+$target{module_ldflags} = $target{shared_ldflag} unless defined $target{module_ldflags};
 {
     my $shared_info_pl =
         catfile(dirname($0), &quot;Configurations&quot;, &quot;shared-info.pl&quot;);
@@ -997,10 +1031,10 @@ $target{dso_lflags} = $target{shared_ldflag} unless defined $target{dso_lflags};
     # Windows and VMS.
     if (defined $si) {
         # Just as above, copy certain shared_* attributes to the corresponding
-        # dso_ attribute unless the latter is already defined
-        $si-&gt;{dso_cflags} = $si-&gt;{shared_cflag} unless defined $si-&gt;{dso_cflags};
-        $si-&gt;{dso_cxxflags} = $si-&gt;{shared_cxxflag} unless defined $si-&gt;{dso_cxxflags};
-        $si-&gt;{dso_lflags} = $si-&gt;{shared_ldflag} unless defined $si-&gt;{dso_lflags};
+        # module_ attribute unless the latter is already defined
+        $si-&gt;{module_cflags} = $si-&gt;{shared_cflag} unless defined $si-&gt;{module_cflags};
+        $si-&gt;{module_cxxflags} = $si-&gt;{shared_cxxflag} unless defined $si-&gt;{module_cxxflags};
+        $si-&gt;{module_ldflags} = $si-&gt;{shared_ldflag} unless defined $si-&gt;{module_ldflags};
         foreach (sort keys %$si) {
             $target{$_} = defined $target{$_}
                 ? add($si-&gt;{$_})-&gt;($target{$_})
@@ -1031,7 +1065,8 @@ foreach my $feature (@{$target{enable}}) {
     }
 }
 
-$target{cxxflags}//=$target{cflags} if $target{cxx};
+$target{CXXFLAGS}//=$target{CFLAGS} if $target{CXX};
+$target{cxxflags}//=$target{cflags} if $target{CXX};
 $target{exe_extension}=&quot;&quot;;
 $target{exe_extension}=&quot;.exe&quot; if ($config{target} eq &quot;DJGPP&quot;
                                   || $config{target} =~ /^(?:Cygwin|mingw)/);
@@ -1048,7 +1083,6 @@ $target{dso_extension}=$target{shared_extension_simple};
 # the default string.
 $config{perl} =    ($^O ne &quot;VMS&quot; ? $^X : &quot;perl&quot;);
 foreach (keys %user) {
-    my $target_key = $user_to_target{$_} // lc $_;
     my $ref_type = ref $user{$_};
 
     # Temporary function.  Takes an intended ref type (empty string or &quot;ARRAY&quot;)
@@ -1074,12 +1108,11 @@ foreach (keys %user) {
         return $value;
     };
 
-    $config{$target_key} =
+    $config{$_} =
         $mkvalue-&gt;($ref_type, $user{$_})
-        || $mkvalue-&gt;($ref_type, $target{$target_key});
-    delete $config{$target_key} unless defined $config{$target_key};
+        || $mkvalue-&gt;($ref_type, $target{$_});
+    delete $config{$_} unless defined $config{$_};
 }
-$config{plib_lflags} = [ $target{plib_lflags} ];
 
 # Allow overriding the build file name
 $config{build_file} = env('BUILDFILE') || $target{build_file} || &quot;Makefile&quot;;
@@ -1149,10 +1182,10 @@ foreach my $checker (($builder_platform.&quot;-&quot;.$target{build_file}.&quot;-checker.pm&quot;,
 
 push @{$config{defines}}, &quot;NDEBUG&quot;    if $config{build_type} eq &quot;release&quot;;
 
-if ($target =~ /^mingw/ &amp;&amp; `$config{cc} --target-help 2&gt;&amp;1` =~ m/-mno-cygwin/m)
+if ($target =~ /^mingw/ &amp;&amp; `$config{CC} --target-help 2&gt;&amp;1` =~ m/-mno-cygwin/m)
 	{
 	push @{$config{cflags}}, &quot;-mno-cygwin&quot;;
-	push @{$config{cxxflags}}, &quot;-mno-cygwin&quot; if $config{cxx};
+	push @{$config{cxxflags}}, &quot;-mno-cygwin&quot; if $config{CXX};
 	push @{$config{shared_ldflag}}, &quot;-mno-cygwin&quot;;
 	}
 
@@ -1164,7 +1197,7 @@ if ($target =~ /linux.*-mips/ &amp;&amp; !$disabled{asm}
 	$value = '-mips2' if ($target =~ /mips32/);
 	$value = '-mips3' if ($target =~ /mips64/);
 	unshift @{$config{cflags}}, $value;
-	unshift @{$config{cxxflags}}, $value if $config{cxx};
+	unshift @{$config{cxxflags}}, $value if $config{CXX};
 }
 
 # The DSO code currently always implements all functions so that no
@@ -1246,7 +1279,7 @@ if ($disabled{&quot;dynamic-engine&quot;}) {
 
 unless ($disabled{asan}) {
     push @{$config{cflags}}, &quot;-fsanitize=address&quot;;
-    push @{$config{cxxflags}}, &quot;-fsanitize=address&quot; if $config{cxx};
+    push @{$config{cxxflags}}, &quot;-fsanitize=address&quot; if $config{CXX};
 }
 
 unless ($disabled{ubsan}) {
@@ -1254,18 +1287,18 @@ unless ($disabled{ubsan}) {
     # platforms.
     push @{$config{cflags}}, &quot;-fsanitize=undefined&quot;, &quot;-fno-sanitize-recover=all&quot;;
     push @{$config{cxxflags}}, &quot;-fsanitize=undefined&quot;, &quot;-fno-sanitize-recover=all&quot;
-        if $config{cxx};
+        if $config{CXX};
 }
 
 unless ($disabled{msan}) {
   push @{$config{cflags}}, &quot;-fsanitize=memory&quot;;
-  push @{$config{cxxflags}}, &quot;-fsanitize=memory&quot; if $config{cxx};
+  push @{$config{cxxflags}}, &quot;-fsanitize=memory&quot; if $config{CXX};
 }
 
 unless ($disabled{&quot;fuzz-libfuzzer&quot;} &amp;&amp; $disabled{&quot;fuzz-afl&quot;}
         &amp;&amp; $disabled{asan} &amp;&amp; $disabled{ubsan} &amp;&amp; $disabled{msan}) {
     push @{$config{cflags}}, &quot;-fno-omit-frame-pointer&quot;, &quot;-g&quot;;
-    push @{$config{cxxflags}}, &quot;-fno-omit-frame-pointer&quot;, &quot;-g&quot; if $config{cxx};
+    push @{$config{cxxflags}}, &quot;-fno-omit-frame-pointer&quot;, &quot;-g&quot; if $config{CXX};
 }
 #
 # Platform fix-ups
@@ -1275,9 +1308,9 @@ unless ($disabled{&quot;fuzz-libfuzzer&quot;} &amp;&amp; $disabled{&quot;fuzz-afl&quot;}
 if ($disabled{pic})
 	{
 	foreach (qw(shared_cflag shared_cxxflag shared_cppflag
-                    shared_defines shared_includes shared_ldflag
-		    dso_cflags dso_cxxflags dso_cppflags
-                    dso_defines dso_includes dso_lflags))
+		    shared_defines shared_includes shared_ldflag
+		    module_cflags module_cxxflags module_cppflags
+		    module_defines module_includes module_lflags))
 		{
 		delete $config{$_};
 		$target{$_} = &quot;&quot;;
@@ -1357,7 +1390,7 @@ unless ($disabled{asm}) {
     }
 }
 
-my %predefined = compiler_predefined($config{cc});
+my %predefined = compiler_predefined($config{CC});
 
 # Check for makedepend capabilities.
 if (!$disabled{makedepend}) {
@@ -1368,7 +1401,7 @@ if (!$disabled{makedepend}) {
     } elsif ($predefined{__GNUC__} &gt;= 3) {
         # We know that GNU C version 3 and up as well as all clang
         # versions support dependency generation
-        $config{makedepprog} = &quot;\$(CROSS_COMPILE)$config{cc}&quot;;
+        $config{makedepprog} = &quot;\$(CROSS_COMPILE)$config{CC}&quot;;
     } else {
         # In all other cases, we look for 'makedepend', and disable the
         # capability if not found.
@@ -1410,7 +1443,7 @@ die &quot;Exactly one of SIXTY_FOUR_BIT|SIXTY_FOUR_BIT_LONG|THIRTY_TWO_BIT can be set
 $config{cflags} = [ map { (my $x = $_) =~ s/([\\\&quot;])/\\$1/g; $x }
                         @{$config{cflags}} ];
 $config{cxxflags} = [ map { (my $x = $_) =~ s/([\\\&quot;])/\\$1/g; $x }
-                          @{$config{cxxflags}} ] if $config{cxx};
+                          @{$config{cxxflags}} ] if $config{CXX};
 
 if (defined($config{api})) {
     $config{openssl_api_defines} = [ &quot;OPENSSL_MIN_API=&quot;.$apitable-&gt;{$config{api}} ];
@@ -1420,7 +1453,7 @@ if (defined($config{api})) {
 
 if (defined($predefined{__clang__}) &amp;&amp; !$disabled{asm}) {
     push @{$config{cflags}}, &quot;-Qunused-arguments&quot;;
-    push @{$config{cxxflags}}, &quot;-Qunused-arguments&quot; if $config{cxx};
+    push @{$config{cxxflags}}, &quot;-Qunused-arguments&quot; if $config{CXX};
 }
 
 if ($strict_warnings)
@@ -1436,7 +1469,7 @@ if ($strict_warnings)
 		push @{$config{cflags}}, $wopt
 			unless grep { $_ eq $wopt } @{$config{cflags}};
 		push @{$config{cxxflags}}, $wopt
-			if ($config{cxx}
+			if ($config{CXX}
 			    &amp;&amp; !grep { $_ eq $wopt } @{$config{cxxflags}});
 		}
 	if (defined($predefined{__clang__}))
@@ -1446,7 +1479,7 @@ if ($strict_warnings)
 			push @{$config{cflags}}, $wopt
 				unless grep { $_ eq $wopt } @{$config{cflags}};
 			push @{$config{cxxflags}}, $wopt
-				if ($config{cxx}
+				if ($config{CXX}
 				    &amp;&amp; !grep { $_ eq $wopt } @{$config{cxxflags}});
 			}
 		}
@@ -1459,7 +1492,7 @@ unless ($disabled{&quot;crypto-mdebug-backtrace&quot;})
 		push @{$config{cflags}}, $wopt
 			unless grep { $_ eq $wopt } @{$config{cflags}};
 		push @{$config{cxxflags}}, $wopt
-			if ($config{cxx}
+			if ($config{CXX}
 			    &amp;&amp; !grep { $_ eq $wopt } @{$config{cxxflags}});
 		}
 	if ($target =~ /^BSD-/)
@@ -1472,7 +1505,7 @@ unless ($disabled{afalgeng}) {
     $config{afalgeng}=&quot;&quot;;
     if ($target =~ m/^linux/) {
         my $minver = 4*10000 + 1*100 + 0;
-        if ($config{cross_compile_prefix} eq &quot;&quot;) {
+        if ($config{CROSS_COMPILE} eq &quot;&quot;) {
             my $verstr = `uname -r`;
             my ($ma, $mi1, $mi2) = split(&quot;\\.&quot;, $verstr);
             ($mi2) = $mi2 =~ /(\d+)/;
@@ -1499,12 +1532,10 @@ foreach (keys %useradd) {
     die &quot;internal error: \$useradd{$_} isn't an ARRAY\n&quot;
         unless ref $useradd{$_} eq 'ARRAY';
 
-    my $target_key = $user_to_target{$_} // lc $_;
-
-    if (defined $config{$target_key}) {
-        push @{$config{$target_key}}, @{$useradd{$_}};
+    if (defined $config{$_}) {
+        push @{$config{$_}}, @{$useradd{$_}};
     } else {
-        $config{$target_key} = [ @{$useradd{$_}} ];
+        $config{$_} = [ @{$useradd{$_}} ];
     }
 }
 
@@ -2168,7 +2199,7 @@ foreach (grep /_(asm|aux)_src$/, keys %target) {
 print &quot;Creating configdata.pm\n&quot;;
 open(OUT,&quot;&gt;configdata.pm&quot;) || die &quot;unable to create configdata.pm: $!\n&quot;;
 print OUT &lt;&lt;&quot;EOF&quot;;
-#! $config{hashbangperl}
+#! $config{HASHBANGPERL}
 
 package configdata;
 
@@ -2306,10 +2337,9 @@ EOF
 }
 print OUT
     &quot;# The following data is only used when this files is use as a script\n&quot;;
-print OUT &quot;my \%makevars = (\n&quot;;
+print OUT &quot;my \@makevars = (\n&quot;;
 foreach (sort keys %user) {
-    print OUT '    ',$_,' ' x (20 - length $_),'=&gt; ',
-        &quot;'&quot;,$user_to_target{$_} || lc $_,&quot;',\n&quot;;
+    print OUT &quot;    '&quot;,$_,&quot;',\n&quot;;
 }
 print OUT &quot;);\n&quot;;
 print OUT &quot;my \%disabled_info = (\n&quot;;
@@ -2440,17 +2470,17 @@ _____
     }
     if ($dump || $makevars) {
         print &quot;\nMakevars:\n\n&quot;;
-        foreach my $var (sort keys %makevars) {
+        foreach my $var (@makevars) {
             my $prefix = '';
-            $prefix = $config{cross_compile_prefix}
+            $prefix = $config{CROSS_COMPILE}
                 if grep { $var eq $_ } @user_crossable;
             $prefix //= '';
             print '    ',$var,' ' x (16 - length $var),'= ',
-                (ref $config{$makevars{$var}} eq 'ARRAY'
-                 ? join(' ', @{$config{$makevars{$var}}})
-                 : $prefix.$config{$makevars{$var}}),
+                (ref $config{$var} eq 'ARRAY'
+                 ? join(' ', @{$config{$var}})
+                 : $prefix.$config{$var}),
                 &quot;\n&quot;
-                if defined $config{$makevars{$var}};
+                if defined $config{$var};
         }
 
         my @buildfile = ($config{builddir}, $config{build_file});
@@ -3012,7 +3042,7 @@ sub compiler_predefined {
         unless $default_compiler;
 
     if (! $predefined{$default_compiler}) {
-        my $cc = &quot;$config{cross_compile_prefix}$default_compiler&quot;;
+        my $cc = &quot;$config{CROSS_COMPILE}$default_compiler&quot;;
 
         $predefined{$default_compiler} = {};
 
@@ -3085,7 +3115,6 @@ sub print_table_entry
 	&quot;ld&quot;,
 	&quot;lflags&quot;,
 	&quot;loutflag&quot;,
-	&quot;plib_lflags&quot;,
 	&quot;ex_libs&quot;,
 	&quot;bn_ops&quot;,
 	&quot;apps_aux_src&quot;,
diff --git a/INSTALL b/INSTALL
index 3c8548d..0875833 100644
--- a/INSTALL
+++ b/INSTALL
@@ -581,30 +581,12 @@
                    RCFLAGS         Flags for the Windows reources manipulator.
                    RM              The command to remove files and directories.
 
-                   These can be mixed with flags given on the command line.
-                   Any variable assignment resets any corresponding flags
-                   given before it, so for example:
+                   These cannot be mixed with compiling / linking flags given
+                   on the command line.  In other words, something like this
+                   isn't permitted.
 
                        ./config -DFOO CPPFLAGS=-DBAR -DCOOKIE
 
-                   Will end up having 'CPPFLAGS=-DBAR -DCOOKIE'.
-
-                   Here is how the flags documented above are collected as
-                   augmentation of these variables:
-
-                   -Dxxx           xxx is collected in CPPDEFINES
-                   -Ixxx           xxx is collected in CPPINCLUDES
-                   -Wp,xxx         collected in CPPFLAGS
-                   -Lxxx           collected in LDFLAGS
-                   -lxxx           collected in LDLIBS
-                   -Wp,xxx         collected in LDLIBS
-                   -rpath xxx      collected in LDLIBS
-                   -R xxx          collected in LDLIBS
-                   -framework xxx  collected in LDLIBS
-                   -static         collected in LDLIBS
-                   -xxx            collected in CFLAGS
-                   +xxx            collected in CFLAGS
-
   reconf
   reconfigure
                    Reconfigure from earlier data.  This fetches the previous
diff --git a/apps/CA.pl.in b/apps/CA.pl.in
index 784c22f..bbaf6a9 100644
--- a/apps/CA.pl.in
+++ b/apps/CA.pl.in
@@ -1,4 +1,4 @@
-#!{- $config{hashbangperl} -}
+#!{- $config{HASHBANGPERL} -}
 # Copyright 2000-2016 The OpenSSL Project Authors. All Rights Reserved.
 #
 # Licensed under the OpenSSL license (the &quot;License&quot;).  You may not use
diff --git a/apps/tsget.in b/apps/tsget.in
index 71bcc24..c3420db 100644
--- a/apps/tsget.in
+++ b/apps/tsget.in
@@ -1,4 +1,4 @@
-#!{- $config{hashbangperl} -}
+#!{- $config{HASHBANGPERL} -}
 # Copyright 2002-2016 The OpenSSL Project Authors. All Rights Reserved.
 # Copyright (c) 2002 The OpenTSA Project. All rights reserved.
 #
diff --git a/config b/config
index 00f9087..92dfa4a 100755
--- a/config
+++ b/config
@@ -40,6 +40,15 @@ EOF
 esac
 done
 
+# Environment that's being passed to Configure
+__CNF_CPPDEFINES=
+__CNF_CPPINCLUDES=
+__CNF_CPPFLAGS=
+__CNF_CFLAGS=
+__CNF_CXXFLAGS=
+__CNF_LDFLAGS=
+__CNF_LDLIBS=
+
 # First get uname entries that we use below
 
 [ &quot;$MACHINE&quot; ] || MACHINE=`(uname -m) 2&gt;/dev/null` || MACHINE=&quot;unknown&quot;
@@ -504,10 +513,12 @@ case &quot;$GUESSOS&quot; in
 	    OUT=&quot;darwin64-x86_64-cc&quot;
 	fi ;;
   armv6+7-*-iphoneos)
-	options=&quot;$options -arch%20armv6 -arch%20armv7&quot;
+	__CNF_CFLAGS=&quot;$__CNF_CFLAGS -arch%20armv6 -arch%20armv7&quot;
+	__CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -arch%20armv6 -arch%20armv7&quot;
 	OUT=&quot;iphoneos-cross&quot; ;;
   *-*-iphoneos)
-	options=&quot;$options -arch%20${MACHINE}&quot;
+	__CNF_CFLAGS=&quot;$__CNF_CFLAGS -arch%20${MACHINE}&quot;
+	__CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -arch%20${MACHINE}&quot;
 	OUT=&quot;iphoneos-cross&quot; ;;
   arm64-*-iphoneos|*-*-ios64)
 	OUT=&quot;ios64-cross&quot; ;;
@@ -519,9 +530,12 @@ case &quot;$GUESSOS&quot; in
 	esac
 	if [ &quot;$CC&quot; = &quot;gcc&quot; ]; then
 	    case ${ISA:-generic} in
-	    EV5|EV45)		options=&quot;$options -mcpu=ev5&quot;;;
-	    EV56|PCA56)		options=&quot;$options -mcpu=ev56&quot;;;
-	    *)			options=&quot;$options -mcpu=ev6&quot;;;
+	    EV5|EV45)		__CNF_CFLAGS=&quot;$__CNF_CFLAGS -mcpu=ev5&quot;
+				__CNF_CXXFLAGS=&quot;$__CNF_CFLAGS -mcpu=ev5&quot;;;
+	    EV56|PCA56)		__CNF_CFLAGS=&quot;$__CNF_CFLAGS -mcpu=ev56&quot;
+				__CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -mcpu=ev56&quot;;;
+	    *)			__CNF_CFLAGS=&quot;$__CNF_CFLAGS -mcpu=ev6&quot;
+				__CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -mcpu=ev6&quot;;;
 	    esac
 	fi
 	;;
@@ -538,7 +552,12 @@ case &quot;$GUESSOS&quot; in
 	    OUT=&quot;linux-ppc64&quot;
 	else
 	    OUT=&quot;linux-ppc&quot;
-	    (echo &quot;__LP64__&quot; | gcc -E -x c - 2&gt;/dev/null | grep &quot;^__LP64__&quot; 2&gt;&amp;1 &gt; /dev/null) || options=&quot;$options -m32&quot;
+	    if (echo &quot;__LP64__&quot; | gcc -E -x c - 2&gt;/dev/null | grep &quot;^__LP64__&quot; 2&gt;&amp;1 &gt; /dev/null); then
+		:;
+	    else
+		__CNF_CFLAGS=&quot;$__CNF_CFLAGS -m32&quot;
+		__CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -m32&quot;
+	    fi
 	fi
 	;;
   ppc64le-*-linux2) OUT=&quot;linux-ppc64le&quot; ;;
@@ -574,7 +593,8 @@ case &quot;$GUESSOS&quot; in
 	sun4u*)	OUT=&quot;linux-sparcv9&quot; ;;
 	sun4m)	OUT=&quot;linux-sparcv8&quot; ;;
 	sun4d)	OUT=&quot;linux-sparcv8&quot; ;;
-	*)	OUT=&quot;linux-generic32&quot;; options=&quot;$options -DB_ENDIAN&quot; ;;
+	*)	OUT=&quot;linux-generic32&quot;;
+		__CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DB_ENDIAN&quot; ;;
 	esac ;;
   parisc*-*-linux2)
 	# 64-bit builds under parisc64 linux are not supported and
@@ -596,16 +616,25 @@ case &quot;$GUESSOS&quot; in
 	CPUSCHEDULE=`echo $CPUSCHEDULE|sed -e 's/7300LC/7100LC/' -e 's/8.00/8000/'`
 	# Finish Model transformations
 
-	options=&quot;$options -DB_ENDIAN -mschedule=$CPUSCHEDULE -march=$CPUARCH&quot;
+	__CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DB_ENDIAN&quot;
+	__CNF_CFLAGS=&quot;$__CNF_CFLAGS -mschedule=$CPUSCHEDULE -march=$CPUARCH&quot;
+	__CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -mschedule=$CPUSCHEDULE -march=$CPUARCH&quot;
 	OUT=&quot;linux-generic32&quot; ;;
   armv[1-3]*-*-linux2) OUT=&quot;linux-generic32&quot; ;;
-  armv[7-9]*-*-linux2) OUT=&quot;linux-armv4&quot;; options=&quot;$options -march=armv7-a&quot; ;;
+  armv[7-9]*-*-linux2) OUT=&quot;linux-armv4&quot;
+		       __CNF_CFLAGS=&quot;$__CNF_CFLAGS -march=armv7-a&quot;
+		       __CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -march=armv7-a&quot;
+		       ;;
   arm*-*-linux2) OUT=&quot;linux-armv4&quot; ;;
   aarch64-*-linux2) OUT=&quot;linux-aarch64&quot; ;;
-  sh*b-*-linux2) OUT=&quot;linux-generic32&quot;; options=&quot;$options -DB_ENDIAN&quot; ;;
-  sh*-*-linux2)  OUT=&quot;linux-generic32&quot;; options=&quot;$options -DL_ENDIAN&quot; ;;
-  m68k*-*-linux2) OUT=&quot;linux-generic32&quot;; options=&quot;$options -DB_ENDIAN&quot; ;;
-  s390-*-linux2) OUT=&quot;linux-generic32&quot;; options=&quot;$options -DB_ENDIAN&quot; ;;
+  sh*b-*-linux2) OUT=&quot;linux-generic32&quot;;
+		 __CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DB_ENDIAN&quot; ;;
+  sh*-*-linux2)	 OUT=&quot;linux-generic32&quot;;
+		 __CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DL_ENDIAN&quot; ;;
+  m68k*-*-linux2) OUT=&quot;linux-generic32&quot;;
+		  __CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DB_ENDIAN&quot; ;;
+  s390-*-linux2) OUT=&quot;linux-generic32&quot;;
+		 __CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DB_ENDIAN&quot; ;;
   s390x-*-linux2)
 	# To be uncommented when glibc bug is fixed, see Configure...
 	#if egrep -e '^features.* highgprs' /proc/cpuinfo &gt;/dev/null ; then
@@ -687,9 +716,12 @@ case &quot;$GUESSOS&quot; in
 	;;
   *-*-sunos4)		OUT=&quot;sunos-$CC&quot; ;;
 
-  *86*-*-bsdi4)		OUT=&quot;BSD-x86-elf&quot;; options=&quot;$options no-sse2 -ldl&quot; ;;
-  alpha*-*-*bsd*)	OUT=&quot;BSD-generic64&quot;; options=&quot;$options -DL_ENDIAN&quot; ;;
-  powerpc64-*-*bsd*)	OUT=&quot;BSD-generic64&quot;; options=&quot;$options -DB_ENDIAN&quot; ;;
+  *86*-*-bsdi4)		OUT=&quot;BSD-x86-elf&quot;; options=&quot;$options no-sse2&quot;;
+			__CNF_LDFLAGS=&quot;$__CNF_LDFLAGS -ldl&quot; ;;
+  alpha*-*-*bsd*)	OUT=&quot;BSD-generic64&quot;;
+			__CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DL_ENDIAN&quot; ;;
+  powerpc64-*-*bsd*)	OUT=&quot;BSD-generic64&quot;;
+			__CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DB_ENDIAN&quot; ;;
   sparc64-*-*bsd*)	OUT=&quot;BSD-sparc64&quot; ;;
   ia64-*-*bsd*)		OUT=&quot;BSD-ia64&quot; ;;
   x86_64-*-dragonfly*)  OUT=&quot;BSD-x86_64&quot; ;;
@@ -716,7 +748,8 @@ case &quot;$GUESSOS&quot; in
 	if [ &quot;$CC&quot; = &quot;gcc&quot; ]; then
 	  OUT=&quot;unixware-7-gcc&quot; ; options=&quot;$options no-sse2&quot;
 	else    
-	  OUT=&quot;unixware-7&quot; ; options=&quot;$options no-sse2 -D__i386__&quot;
+	  OUT=&quot;unixware-7&quot; ; options=&quot;$options no-sse2&quot;
+	  __CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -D__i386__&quot;
 	fi
 	;;
   *-*-[Uu]nix[Ww]are20*) OUT=&quot;unixware-2.0&quot;; options=&quot;$options no-sse2 no-sha512&quot; ;;
@@ -763,7 +796,7 @@ case &quot;$GUESSOS&quot; in
 	else					# Motorola(?) CPU
 	     OUT=&quot;hpux-$CC&quot;
 	fi
-	options=&quot;$options -D_REENTRANT&quot; ;;
+	__CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -D_REENTRANT&quot; ;;
   *-hpux)	OUT=&quot;hpux-parisc-$CC&quot; ;;
   *-aix)
 	[ &quot;$KERNEL_BITS&quot; ] || KERNEL_BITS=`(getconf KERNEL_BITMODE) 2&gt;/dev/null`
@@ -802,7 +835,9 @@ case &quot;$GUESSOS&quot; in
   *-*-qnx6) OUT=&quot;QNX6&quot; ;;
   x86-*-android|i?86-*-android) OUT=&quot;android-x86&quot; ;;
   armv[7-9]*-*-android)
-      OUT=&quot;android-armeabi&quot;; options=&quot;$options -march=armv7-a&quot; ;;
+      OUT=&quot;android-armeabi&quot;
+      __CNF_CFLAGS=&quot;$__CNF_CFLAGS -march=armv7-a&quot;
+      __CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -march=armv7-a&quot;;;
   arm*-*-android) OUT=&quot;android-armeabi&quot; ;;
   *) OUT=`echo $GUESSOS | awk -F- '{print $3}'`;;
 esac
@@ -816,7 +851,7 @@ esac
 # See whether we can compile Atalla support
 #if [ -f /usr/include/atasi.h ]
 #then
-#  options=&quot;$options -DATALLA&quot;
+#  __CNF_CPPFLAGS=&quot;$__CNF_CPPFLAGS -DATALLA&quot;
 #fi
 
 if [ -n &quot;$CONFIG_OPTIONS&quot; ]; then
@@ -824,9 +859,11 @@ if [ -n &quot;$CONFIG_OPTIONS&quot; ]; then
 fi
 
 if expr &quot;$options&quot; : '.*no\-asm' &gt; /dev/null; then :; else
-  sh -c &quot;$CROSS_COMPILE${CC:-gcc} -Wa,--help -c -o /tmp/null.$$.o -x assembler /dev/null &amp;&amp; rm /tmp/null.$$.o&quot; 2&gt;&amp;1 | \
-  grep \\--noexecstack &gt;/dev/null &amp;&amp; \
-  options=&quot;$options -Wa,--noexecstack&quot;
+  if sh -c &quot;$CROSS_COMPILE${CC:-gcc} -Wa,--help -c -o /tmp/null.$$.o -x assembler /dev/null &amp;&amp; rm /tmp/null.$$.o&quot; 2&gt;&amp;1 | \
+         grep \\--noexecstack &gt;/dev/null; then
+    __CNF_CFLAGS=&quot;$__CNF_CFLAGS -Wa,--noexecstack&quot;
+    __CNF_CXXFLAGS=&quot;$__CNF_CXXFLAGS -Wa,--noexecstack&quot;
+  fi
 fi
 
 # gcc &lt; 2.8 does not support -march=ultrasparc
@@ -900,12 +937,28 @@ OUT=&quot;$OUT&quot;
 $PERL $THERE/Configure LIST | grep &quot;$OUT&quot; &gt; /dev/null
 if [ $? = &quot;0&quot; ]; then
   if [ &quot;$VERBOSE&quot; = &quot;true&quot; ]; then
-    echo $PERL $THERE/Configure $OUT $options
+    echo /usr/bin/env \
+	 __CNF_CPPDEFINES=&quot;'$__CNF_CPPDEFINES'&quot; \
+	 __CNF_CPPINCLUDES=&quot;'$__CNF_CPPINCLUDES'&quot; \
+	 __CNF_CPPFLAGS=&quot;'$__CNF_CPPFLAGS'&quot; \
+	 __CNF_CFLAGS=&quot;'$__CNF_CFLAGS'&quot; \
+	 __CNF_CXXFLAGS=&quot;'$__CNF_CXXFLAGS'&quot; \
+	 __CNF_LDFLAGS=&quot;'$__CNF_LDFLAGS'&quot; \
+	 __CNF_LDLIBS=&quot;'$__CNF_LDLIBS'&quot; \
+	 $PERL $THERE/Configure $OUT $options
   fi  
   if [ &quot;$DRYRUN&quot; = &quot;false&quot; ]; then
     # eval to make sure quoted options, possibly with spaces inside,
     # are treated right
-    eval $PERL $THERE/Configure $OUT $options
+    eval /usr/bin/env \
+	 __CNF_CPPDEFINES=&quot;'$__CNF_CPPDEFINES'&quot; \
+	 __CNF_CPPINCLUDES=&quot;'$__CNF_CPPINCLUDES'&quot; \
+	 __CNF_CPPFLAGS=&quot;'$__CNF_CPPFLAGS'&quot; \
+	 __CNF_CFLAGS=&quot;'$__CNF_CFLAGS'&quot; \
+	 __CNF_CXXFLAGS=&quot;'$__CNF_CXXFLAGS'&quot; \
+	 __CNF_LDFLAGS=&quot;'$__CNF_LDFLAGS'&quot; \
+	 __CNF_LDLIBS=&quot;'$__CNF_LDLIBS'&quot; \
+	 $PERL $THERE/Configure $OUT $options
   fi
 else
   echo &quot;This system ($OUT) is not supported. See file INSTALL for details.&quot;
diff --git a/crypto/build.info b/crypto/build.info
index 0a8f6e2..c406a11 100644
--- a/crypto/build.info
+++ b/crypto/build.info
@@ -11,7 +11,7 @@ EXTRA=  ../ms/uplink-x86.pl ../ms/uplink.c ../ms/applink.c \
         ppccpuid.pl pariscid.pl alphacpuid.pl arm64cpuid.pl armv4cpuid.pl
 
 DEPEND[cversion.o]=buildinf.h
-GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(CFLAGS) $(CPPFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
+GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(CNF_CFLAGS) $(CFLAGS) $(CPPFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
 DEPEND[buildinf.h]=../configdata.pm
 
 GENERATE[uplink-x86.s]=../ms/uplink-x86.pl $(PERLASM_SCHEME)
diff --git a/tools/c_rehash.in b/tools/c_rehash.in
index e658222..3a9e44a 100644
--- a/tools/c_rehash.in
+++ b/tools/c_rehash.in
@@ -1,4 +1,4 @@
-#!{- $config{hashbangperl} -}
+#!{- $config{HASHBANGPERL} -}
 
 # {- join(&quot;\n# &quot;, @autowarntext) -}
 # Copyright 1999-2016 The OpenSSL Project Authors. All Rights Reserved.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018405.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="018412.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18406">[ date ]</a>
              <a href="thread.html#18406">[ thread ]</a>
              <a href="subject.html#18406">[ subject ]</a>
              <a href="author.html#18406">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
