<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2018-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1520600887.268818.6431.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018432.html">
   <LINK REL="Next"  HREF="018436.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1520600887.268818.6431.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Fri Mar  9 13:08:07 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="018432.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="018436.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18434">[ date ]</a>
              <a href="thread.html#18434">[ thread ]</a>
              <a href="subject.html#18434">[ subject ]</a>
              <a href="author.html#18434">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  58d6be5b5de7c46e0c67438bc11d96e717578386 (commit)
       via  68b8bcf49c84b74e3d5560c50113e879f872d21a (commit)
      from  0244234d5d64b96d251fc86371bccbca6cfc52b5 (commit)


- Log -----------------------------------------------------------------
commit 58d6be5b5de7c46e0c67438bc11d96e717578386
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Mar 9 12:39:01 2018 +0100

    Display the library building flags
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5560">https://github.com/openssl/openssl/pull/5560</A>)

commit 68b8bcf49c84b74e3d5560c50113e879f872d21a
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Tue Mar 6 21:09:05 2018 +0100

    Configure et al: Move the definition of library only flags
    
    We're currently using the attributes 'defines', 'cppflags', 'cflags'
    etc quite liberally, with no regard for where that ends up.  Quite a
    few of those flags are actually only relevant for the libraries
    (mostly libcrypto), so it's safe to say that those could be applied to
    the libraries only.
    
    So, we move some of those flags to 'lib_defines', 'lib_cppflags',
    'lib_cflags', etc.
    
    Reviewed-by: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5560">https://github.com/openssl/openssl/pull/5560</A>)

-----------------------------------------------------------------------

Summary of changes:
 Configurations/00-base-templates.conf |   3 +
 Configurations/10-main.conf           | 166 ++++++++++++++++++----------------
 Configurations/descrip.mms.tmpl       |  28 +++---
 Configurations/unix-Makefile.tmpl     |  15 ++-
 Configurations/windows-makefile.tmpl  |  16 ++--
 Configure                             |  58 ++++++------
 crypto/build.info                     |   2 +-
 7 files changed, 159 insertions(+), 129 deletions(-)

diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
index 310a370..a1837ca 100644
--- a/Configurations/00-base-templates.conf
+++ b/Configurations/00-base-templates.conf
@@ -8,6 +8,9 @@ my %targets=(
 	lflags		=&gt; &quot;&quot;,
 	defines		=&gt; [],
 	includes	=&gt; [],
+	lib_cflags	=&gt; &quot;&quot;,
+	lib_cppflags	=&gt; &quot;&quot;,
+	lib_defines	=&gt; [],
 	thread_scheme	=&gt; &quot;(unknown)&quot;, # Assume we don't know
 	thread_defines	=&gt; [],
 
diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 6e7f2d1..65f08b0 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -192,7 +192,8 @@ my %targets = (
         CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
-        cppflags         =&gt; &quot;-D_POSIX_C_SOURCE=200112L -D_BSD -D_VOS_EXTENDED_NAMES -DB_ENDIAN&quot;,
+        cppflags         =&gt; &quot;-D_POSIX_C_SOURCE=200112L -D_BSD -D_VOS_EXTENDED_NAMES&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         sys_id           =&gt; &quot;VOS&quot;,
         lflags           =&gt; add(&quot;-Wl,-map&quot;),
@@ -204,7 +205,7 @@ my %targets = (
     &quot;solaris-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         template         =&gt; 1,
-        cppflags         =&gt; &quot;-DFILIO_H&quot;,
+        lib_cppflags     =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -ldl&quot;),
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -222,7 +223,7 @@ my %targets = (
                                               debug   =&gt; &quot;-O0 -g&quot;,
                                               release =&gt; &quot;-O3 -fomit-frame-pointer&quot;)),
         cflags           =&gt; add(threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         shared_cflag     =&gt; &quot;-fPIC&quot;,
@@ -243,7 +244,7 @@ my %targets = (
                                               debug   =&gt; &quot;-O0 -g&quot;,
                                               release =&gt; &quot;-O3&quot;)),
         cflags           =&gt; add_before(&quot;-m64&quot;, threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
@@ -271,7 +272,8 @@ my %targets = (
         CFLAGS           =&gt; add_before(picker(debug   =&gt; &quot;-g&quot;,
                                               release =&gt; &quot;-xO5 -xdepend -xbuiltin&quot;)),
         cflags           =&gt; add_before(&quot;-xarch=generic64 -xstrconst -Xa&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; add(threads(&quot;-D_REENTRANT&quot;)),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         thread_scheme    =&gt; &quot;pthreads&quot;,
         lflags           =&gt; add(threads(&quot;-mt&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
@@ -290,7 +292,7 @@ my %targets = (
                                               debug   =&gt; &quot;-O0 -g&quot;,
                                               release =&gt; &quot;-O3&quot;)),
         cflags           =&gt; add(threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         shared_cflag     =&gt; &quot;-fPIC&quot;,
@@ -323,8 +325,8 @@ my %targets = (
         CFLAGS           =&gt; add_before(picker(debug   =&gt; &quot;-g&quot;,
                                               release =&gt; &quot;-xO5 -xdepend&quot;)),
         cflags           =&gt; add_before(&quot;-xstrconst -Xa&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;,
-                                threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; add(threads(&quot;-D_REENTRANT&quot;)),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
         lflags           =&gt; add(threads(&quot;-mt&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -357,6 +359,8 @@ my %targets = (
         cflags           =&gt; &quot;-mabi=n32&quot;,
         cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
+        cppflags         =&gt; threads(&quot;-D_SGI_MP_SOURCE&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DBN_DIV3W&quot;,
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -372,8 +376,8 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O2&quot;),
         cflags           =&gt; &quot;-n32 -mips3 -use_readonly_const -G0 -rdata_shared&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
-                                    threads(&quot;-D_SGI_MP_SOURCE&quot;)),
+        cppflags         =&gt; threads(&quot;-D_SGI_MP_SOURCE&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DBN_DIV3W&quot;,
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -390,8 +394,8 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cflags           =&gt; &quot;-mabi=64 -mips4&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
-                                    threads(&quot;-D_SGI_MP_SOURCE&quot;)),
+        cppflags         =&gt; threads(&quot;-D_SGI_MP_SOURCE&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DBN_DIV3W&quot;,
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -406,10 +410,9 @@ my %targets = (
         CC               =&gt; &quot;cc&quot;,
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O2&quot;),
-        cppflags         =&gt; threads(&quot;-D_SGI_MP_SOURCE&quot;),
         cflags           =&gt; &quot;-64 -mips4 -use_readonly_const -G0 -rdata_shared&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV3W&quot;,
-                                    threads(&quot;-D_SGI_MP_SOURCE&quot;)),
+        cppflags         =&gt; threads(&quot;-D_SGI_MP_SOURCE&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DBN_DIV3W&quot;,
         ex_libs          =&gt; threads(&quot;-lpthread&quot;),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -453,7 +456,7 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cflags           =&gt; add(threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; &quot;-DB_ENDIAN -DBN_DIV2W&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DBN_DIV2W&quot;,
         ex_libs          =&gt; add(&quot;-Wl,+s -ldld&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -472,7 +475,8 @@ my %targets = (
         CC               =&gt; &quot;gcc&quot;,
         CFLAGS           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;)),
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -491,8 +495,8 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
                                    release =&gt; &quot;+O3&quot;),
         cflags           =&gt; &quot;+Optrs_strongly_typed -Ae +ESlit&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN -DBN_DIV2W -DMD32_XARRAY&quot;,
-                                    threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DBN_DIV2W -DMD32_XARRAY&quot;,
         ex_libs          =&gt; add(&quot;-Wl,+s -ldld&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -513,8 +517,8 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
                                    release =&gt; &quot;+O3&quot;) ,
         cflags           =&gt; &quot;+DD64 +Optrs_strongly_typed -Ae +ESlit&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN -DMD32_XARRAY&quot;,
-                                    threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;) ,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN -DMD32_XARRAY&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -533,7 +537,8 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
                                    release =&gt; &quot;+O2&quot;),
         cflags           =&gt; &quot;-Ae +DD32 +Olit=all -z&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; add(threads(&quot;-D_REENTRANT&quot;)),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -550,7 +555,8 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;+O0 +d -g&quot;,
                                    release =&gt; &quot;+O3&quot;),
         cflags           =&gt; &quot;-Ae +DD64 +Olit=all -z&quot;,
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -568,7 +574,7 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cflags           =&gt; add(threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -585,7 +591,7 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cflags           =&gt; combine(&quot;-mlp64&quot;, threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -602,8 +608,9 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         CC               =&gt; &quot;gcc&quot;,
         CFLAGS           =&gt; &quot;-O3&quot;,
-        cppflags         =&gt; &quot;-DBN_DIV2W -D_POSIX_SOURCE -D_SOCKET_SOURCE&quot;,
-        includes         =&gt; add(&quot;/SYSLOG/PUB&quot;),
+        cppflags         =&gt; &quot;-D_POSIX_SOURCE -D_SOCKET_SOURCE&quot;,
+        includes         =&gt; [ &quot;/SYSLOG/PUB&quot; ],
+        lib_cppflags     =&gt; &quot;-DBN_DIV2W&quot;,
         sys_id           =&gt; &quot;MPE&quot;,
         lflags           =&gt; add(&quot;-L/SYSLOG/PUB&quot;),
         ex_libs          =&gt; add(&quot;-lsyslog -lsocket -lcurses&quot;),
@@ -661,7 +668,7 @@ my %targets = (
                                    release =&gt; &quot;-O3&quot;),
         cflags           =&gt; threads(&quot;-pthread&quot;),
         cxxflags         =&gt; combine(&quot;-std=c++11&quot;, threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; &quot;-DOPENSSL_USE_NODELETE&quot;,
+        lib_cppflags     =&gt; &quot;-DOPENSSL_USE_NODELETE&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -684,7 +691,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;ppc64_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
         cxxflags         =&gt; add(&quot;-m64&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;linux64&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
@@ -692,7 +699,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;ppc64_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
         cxxflags         =&gt; add(&quot;-m64&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;linux64le&quot;,
     },
 
@@ -749,7 +756,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;mips32_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=32&quot;),
         cxxflags         =&gt; add(&quot;-mabi=32&quot;),
-        cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
+        lib_cppflags     =&gt; add(&quot;-DBN_DIV3W&quot;),
         perlasm_scheme   =&gt; &quot;o32&quot;,
     },
     # mips32 and mips64 below refer to contemporary MIPS Architecture
@@ -758,7 +765,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;mips64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=n32&quot;),
         cxxflags         =&gt; add(&quot;-mabi=n32&quot;),
-        cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
+        lib_cppflags     =&gt; add(&quot;-DBN_DIV3W&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT RC4_CHAR&quot;,
         perlasm_scheme   =&gt; &quot;n32&quot;,
         multilib         =&gt; &quot;32&quot;,
@@ -767,7 +774,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;mips64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mabi=64&quot;),
         cxxflags         =&gt; add(&quot;-mabi=64&quot;),
-        cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
+        lib_cppflags     =&gt; add(&quot;-DBN_DIV3W&quot;),
         perlasm_scheme   =&gt; &quot;64&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
@@ -778,7 +785,7 @@ my %targets = (
     &quot;linux-elf&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_elf_asm&quot;) ],
         CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
     &quot;linux-aout&quot; =&gt; {
@@ -787,7 +794,7 @@ my %targets = (
         CFLAGS           =&gt; add(picker(default =&gt; &quot;-Wall&quot;,
                                        debug   =&gt; &quot;-O0 -g&quot;,
                                        release =&gt; &quot;-O3 -fomit-frame-pointer&quot;)),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         perlasm_scheme   =&gt; &quot;a.out&quot;,
@@ -799,7 +806,7 @@ my %targets = (
         CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
         cflags           =&gt; add(&quot;-m32&quot;),
         cxxflags         =&gt; add(&quot;-m32&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
     },
@@ -813,7 +820,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;x86_64_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
         cxxflags         =&gt; add(&quot;-m64&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
         multilib         =&gt; &quot;64&quot;,
@@ -828,7 +835,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_64_asm&quot;) ],
         cflags           =&gt; add(&quot;-mx32&quot;),
         cxxflags         =&gt; add(&quot;-mx32&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         perlasm_scheme   =&gt; &quot;elf32&quot;,
         multilib         =&gt; &quot;x32&quot;,
@@ -843,7 +850,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;s390x_asm&quot;) ],
         cflags           =&gt; add(&quot;-m64&quot;),
         cxxflags         =&gt; add(&quot;-m64&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;64&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
@@ -867,7 +874,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;s390x_asm&quot;) ],
         cflags           =&gt; add(&quot;-m31 -Wa,-mzarch&quot;),
         cxxflags         =&gt; add(&quot;-m31 -Wa,-mzarch&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_asm_src       =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s|asm/s390x\.S|bn_asm.c|; $r; },
         perlasm_scheme   =&gt; &quot;31&quot;,
         multilib         =&gt; &quot;/highgprs&quot;,
@@ -1057,7 +1064,7 @@ my %targets = (
     &quot;BSD-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic32&quot;, asm(&quot;x86_asm&quot;) ],
         CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         shared_target    =&gt; &quot;bsd-shared&quot;,
         perlasm_scheme   =&gt; &quot;a.out&quot;,
@@ -1070,26 +1077,26 @@ my %targets = (
     &quot;BSD-sparcv8&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic32&quot;, asm(&quot;sparcv8_asm&quot;) ],
         cflags           =&gt; add(&quot;-mcpu=v8&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
     },
     &quot;BSD-sparc64&quot; =&gt; {
         # -DMD32_REG_T=int doesn't actually belong in sparc64 target, it
         # simply *happens* to work around a compiler bug in gcc 3.3.3,
         # triggered by RIPEMD160 code.
         inherit_from     =&gt; [ &quot;BSD-generic64&quot;, asm(&quot;sparcv9_asm&quot;) ],
-        cppflags         =&gt; add(&quot;-DB_ENDIAN -DMD32_REG_T=int&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN -DMD32_REG_T=int&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
 
     &quot;BSD-ia64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic64&quot;, asm(&quot;ia64_asm&quot;) ],
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
     },
 
     &quot;BSD-x86_64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic64&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
     },
@@ -1098,7 +1105,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         CC               =&gt; &quot;gcc&quot;,
         CFLAGS           =&gt; &quot;-fomit-frame-pointer -O3 -Wall&quot;,
-        cppflags         =&gt; &quot;-DPERL5 -DL_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DPERL5 -DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
@@ -1130,7 +1137,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         CC               =&gt; &quot;cc&quot;,
         CFLAGS           =&gt; &quot;&quot;,
-        cppflags         =&gt; &quot;-DL_ENDIAN -DTERMIO&quot;,
+        lib_cppflags     =&gt; &quot;-DL_ENDIAN -DTERMIO&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;QNX6&quot; =&gt; {
@@ -1146,7 +1153,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         CC               =&gt; &quot;gcc&quot;,
         CFLAGS           =&gt; &quot;-O2 -Wall&quot;,
-        cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-lsocket&quot;),
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         shared_target    =&gt; &quot;bsd-gcc-shared&quot;,
@@ -1169,7 +1176,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         CC               =&gt; &quot;cc&quot;,
         cflags           =&gt; threads(&quot;-Kthread&quot;),
-        cppflags         =&gt; &quot;-DFILIO_H -DNO_STRINGS_H&quot;,
+        lib_cppflags     =&gt; &quot;-DFILIO_H -DNO_STRINGS_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -lresolv -lx&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
     },
@@ -1178,7 +1185,7 @@ my %targets = (
         CC               =&gt; &quot;cc&quot;,
         CFLAGS           =&gt; &quot;-O&quot;,
         cflags           =&gt; threads(&quot;-Kthread&quot;),
-        cppflags         =&gt; &quot;-DFILIO_H&quot;,
+        lib_cppflags     =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -lresolv -lx&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
     },
@@ -1187,7 +1194,7 @@ my %targets = (
         CC               =&gt; &quot;cc&quot;,
         CFLAGS           =&gt; &quot;-O&quot;,
         cflags           =&gt; combine(&quot;-Kalloca&quot;, threads(&quot;-Kthread&quot;)),
-        cppflags         =&gt; &quot;-DFILIO_H&quot;,
+        lib_cppflags     =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -1201,8 +1208,8 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         CC               =&gt; &quot;gcc&quot;,
         CFLAGS           =&gt; &quot;-O3 -fomit-frame-pointer -Wall&quot;,
-        cppflags         =&gt; add(&quot;-DL_ENDIAN -DFILIO_H&quot;,
-                                threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; add(threads(&quot;-D_REENTRANT&quot;)),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN -DFILIO_H&quot;),
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1251,7 +1258,7 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O&quot;),
         cflags           =&gt; add(threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -1269,7 +1276,7 @@ my %targets = (
         CFLAGS           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O&quot;),
         cflags           =&gt; combine(&quot;-maix64&quot;, threads(&quot;-pthread&quot;)),
-        cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
@@ -1288,7 +1295,8 @@ my %targets = (
                                    release =&gt; &quot;-O&quot;),
         cflags           =&gt; combine(&quot;-q32 -qmaxmem=16384 -qro -qroconst&quot;,
                                     threads(&quot;-qthreaded&quot;)),
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_THREAD_SAFE&quot;)),
+        cppflags         =&gt; threads(&quot;-D_THREAD_SAFE&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1307,7 +1315,8 @@ my %targets = (
                                    release =&gt; &quot;-O&quot;),
         cflags           =&gt; combine(&quot;-q64 -qmaxmem=16384 -qro -qroconst&quot;,
                                     threads(&quot;-qthreaded&quot;)),
-        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_THREAD_SAFE&quot;)),
+        cppflags         =&gt; threads(&quot;-D_THREAD_SAFE&quot;),
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1326,7 +1335,8 @@ my %targets = (
         CC               =&gt; &quot;c89&quot;,
         CFLAGS           =&gt; &quot;-O&quot;,
         cflags           =&gt; &quot;-XLLML -XLLMK -XL&quot;,
-        cppflags         =&gt; &quot;-DB_ENDIAN -DCHARSET_EBCDIC&quot;,
+        cppflags         =&gt; &quot;-DCHARSET_EBCDIC&quot;,
+        lib_cppflags     =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         bn_ops           =&gt; &quot;THIRTY_TWO_BIT RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
@@ -1353,8 +1363,10 @@ my %targets = (
         coutflag         =&gt; &quot;/Fo&quot;,
         cflags           =&gt; '-Gs0 -GF -Gy',
         defines          =&gt; add(&quot;OPENSSL_SYS_WIN32&quot;, &quot;WIN32_LEAN_AND_MEAN&quot;,
-                                &quot;L_ENDIAN&quot;, &quot;_CRT_SECURE_NO_DEPRECATE&quot;,
-                                &quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;,
+                                &quot;_CRT_SECURE_NO_DEPRECATE&quot;,
+                                &quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;),
+        lib_cflags       =&gt; add(&quot;/Zi /Fdossl_static&quot;),
+        lib_defines      =&gt; add([ &quot;L_ENDIAN&quot; ],
                                 sub { my @defs = ();
                                       unless ($disabled{&quot;zlib-dynamic&quot;}) {
                                           my $zlib =
@@ -1365,7 +1377,6 @@ my %targets = (
                                       }
                                       return [ @defs ];
                                   }),
-        lib_cflags       =&gt; add(&quot;/Zi /Fdossl_static&quot;),
         dso_cflags       =&gt; &quot;/Zi /Fddso&quot;,
         bin_cflags       =&gt; &quot;/Zi /Fdapp&quot;,
         shared_ldflag    =&gt; &quot;/dll&quot;,
@@ -1490,9 +1501,10 @@ my %targets = (
                               ? ($disabled{shared} ? &quot; /MT&quot; : &quot; /MD&quot;)
                               : &quot; /MC&quot;; }),
         cppflags         =&gt; sub { vc_wince_info()-&gt;{cppflags}; },
-        defines          =&gt; [ &quot;UNICODE&quot;, &quot;_UNICODE&quot;, &quot;L_ENDIAN&quot;, &quot;DSO_WIN32&quot;,
-                              &quot;NO_CHMOD&quot;, &quot;OPENSSL_SMALL_FOOTPRINT&quot;,
-                              &quot;WIN32_LEAN_AND_MEAN&quot; ],
+        defines          =&gt; [ &quot;WIN32_LEAN_AND_MEAN&quot; ],
+        lib_defines      =&gt; [ &quot;L_ENDIAN&quot;, &quot;DSO_WIN32&quot;, &quot;NO_CHMOD&quot;,
+                              &quot;OPENSSL_SMALL_FOOTPRINT&quot; ],
+        lib_cppflags     =&gt; sub { vc_wince_info()-&gt;{cppflags}; },
         includes         =&gt;
             add(combine(sub { defined(env('WCECOMPAT'))
                               ? '$(WCECOMPAT)/include' : (); },
@@ -1535,9 +1547,9 @@ my %targets = (
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
         cflags           =&gt; &quot;-m32&quot;,
-        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DUNICODE -D_UNICODE&quot;,
-                                    &quot;-DWIN32_LEAN_AND_MEAN&quot;,
+        cppflags         =&gt; combine(&quot;-DUNICODE -D_UNICODE -DWIN32_LEAN_AND_MEAN&quot;,
                                     threads(&quot;-D_MT&quot;)),
+        lib_cppflags     =&gt; &quot;-DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;MINGW32&quot;,
         ex_libs          =&gt; add(&quot;-lws2_32 -lgdi32 -lcrypt32&quot;),
         bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
@@ -1567,9 +1579,9 @@ my %targets = (
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
         cflags           =&gt; &quot;-m64&quot;,
-        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DUNICODE -D_UNICODE&quot;,
-                                    &quot;-DWIN32_LEAN_AND_MEAN&quot;,
+        cppflags         =&gt; combine(&quot;-DUNICODE -D_UNICODE -DWIN32_LEAN_AND_MEAN&quot;,
                                     threads(&quot;-D_MT&quot;)),
+        lib_cppflags     =&gt; &quot;-DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;MINGW64&quot;,
         ex_libs          =&gt; add(&quot;-lws2_32 -lgdi32 -lcrypt32&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT EXPORT_VAR_AS_FN&quot;,
@@ -1590,7 +1602,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         CC               =&gt; &quot;cc&quot;,
         CFLAGS           =&gt; &quot;-O&quot;,
-        cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;UEFI&quot;,
     },
 
@@ -1612,7 +1624,7 @@ my %targets = (
         CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
-        cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;CYGWIN&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthread&quot;,
@@ -1628,7 +1640,7 @@ my %targets = (
         CFLAGS           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
-        cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;CYGWIN&quot;,
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthread&quot;,
@@ -1681,14 +1693,14 @@ my %targets = (
     &quot;darwin-ppc-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;ppc32_asm&quot;) ],
         cflags           =&gt; add(&quot;-arch ppc -std=gnu9x -Wa,-force_cpusubtype_ALL&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
         shared_cflag     =&gt; add(&quot;-fno-common&quot;),
         perlasm_scheme   =&gt; &quot;osx32&quot;,
     },
     &quot;darwin64-ppc-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;ppc64_asm&quot;) ],
         cflags           =&gt; add(&quot;-arch ppc64 -std=gnu9x&quot;),
-        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         perlasm_scheme   =&gt; &quot;osx64&quot;,
     },
@@ -1696,7 +1708,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;x86_asm&quot;) ],
         CFLAGS           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
         cflags           =&gt; add(&quot;-arch i386&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG RC4_INT&quot;,
         perlasm_scheme   =&gt; &quot;macosx&quot;,
     },
@@ -1704,7 +1716,7 @@ my %targets = (
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;x86_64_asm&quot;) ],
         CFLAGS           =&gt; add(&quot;-Wall&quot;),
         cflags           =&gt; add(&quot;-arch x86_64&quot;),
-        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
+        lib_cppflags     =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;macosx&quot;,
     },
@@ -1753,7 +1765,7 @@ my %targets = (
         CC               =&gt; &quot;gcc&quot;,
         CFLAGS           =&gt; &quot;-O3 -fomit-frame-pointer -Wall&quot;,
         cflags           =&gt; threads(&quot;-pthread&quot;),
-        cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
+        lib_cppflags     =&gt; &quot;-DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1911,7 +1923,7 @@ my %targets = (
                               @{vms_info()-&gt;{disable_warns}};
                           @warnings
                               ? &quot;/WARNINGS=DISABLE=(&quot;.join(&quot;,&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at warnings</A>).&quot;)&quot; : (); }),
-        defines          =&gt;
+        lib_defines      =&gt;
             add(&quot;OPENSSL_USE_NODELETE&quot;,
                 sub {
                     return vms_info()-&gt;{def_zlib}
diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index e8780e4..1972314 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -221,23 +221,28 @@ CNF_EX_LIBS={- join('', map{ &quot;,$_&quot; } @{$target{ex_libs}},
 LIB_ASFLAGS={- join(' ', $target{lib_asflags} || (),
                          @{$config{lib_asflags}},
                          '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
-LIB_DEFINES={- join('', (map { &quot;,$_&quot; } @{$target{lib_defines}},
+LIB_DEFINES={- our $lib_defines =
+               join('', (map { &quot;,$_&quot; } @{$target{lib_defines}},
                                        @{$target{shared_defines}},
                                        @{$config{lib_defines}},
-                                       @{$config{shared_defines}},
-                                       'OPENSSLDIR=&quot;&quot;&quot;$(OPENSSLDIR_C)&quot;&quot;&quot;',
+                                       @{$config{shared_defines}});
+               join('', $lib_defines,
+                        (map { &quot;,$_&quot; } 'OPENSSLDIR=&quot;&quot;&quot;$(OPENSSLDIR_C)&quot;&quot;&quot;',
                                        'ENGINESDIR=&quot;&quot;&quot;$(ENGINESDIR_C)&quot;&quot;&quot;'),
                         '$(CNF_DEFINES)', '$(DEFINES)') -}
-LIB_INCLUDES={- join(',', @{$target{lib_includes}},
+LIB_INCLUDES={- our $lib_includes =
+                join(',', @{$target{lib_includes}},
                           @{$target{shared_includes}},
                           @{$config{lib_includes}},
                           @{$config{shared_includes}}) -}
-LIB_CPPFLAGS={- join('', &quot;'qual_includes'&quot;,
-                         '/DEFINE=(__dummy$(LIB_DEFINES))',
-                         $target{lib_cppflags} || (),
+LIB_CPPFLAGS={- our $lib_cppflags =
+                join('', $target{lib_cppflags} || (),
                          $target{shared_cppflags} || (),
                          @{$config{lib_cppflags}},
-                         @{$config{shared_cppflag}},
+                         @{$config{shared_cppflag}});
+                join('', &quot;'qual_includes'&quot;,
+                         '/DEFINE=(__dummy$(LIB_DEFINES))'
+                         $lib_cppflags,
                          '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
 LIB_CFLAGS={- join('', $target{lib_cflags} || (),
                        $target{shared_cflag} || (),
@@ -325,9 +330,10 @@ NO_INST_BIN_CFLAGS={- join('', $target{no_inst_bin_cflags}
 PERLASM_SCHEME={- $target{perlasm_scheme} -}
 
 # CPPFLAGS_Q is used for one thing only: to build up buildinf.h
-CPPFLAGS_Q={- (my $c = $cppflags1.$cppflags2) =~ s|&quot;|&quot;&quot;|g;
-              (my $d = $defines1.$defines2) =~ s|&quot;|&quot;&quot;|g;
-              my $i = join(',', $includes1 || (), $includes2 || ());
+CPPFLAGS_Q={- (my $c = $lib_cppflags.$cppflags2.$cppflags1) =~ s|&quot;|&quot;&quot;|g;
+              (my $d = $lib_defines.$defines2.$defines1) =~ s|&quot;|&quot;&quot;|g;
+              my $i = join(',', $lib_includes || (), $includes2 || (),
+                                $includes1 || ());
               my $x = $c;
               $x .= &quot;/INCLUDE=($i)&quot; if $i;
               $x .= &quot;/DEFINE=($d)&quot; if $d;
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index fc483f0..8230676 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -254,15 +254,18 @@ CNF_EX_LIBS={- join(' ', $target{ex_libs} || (),
 # Variables starting with BIN_ are used to build programs and their object
 # files.
 
-LIB_CPPFLAGS={- join(' ', $target{lib_cppflags} || (),
+LIB_CPPFLAGS={- our $lib_cppflags =
+                join(' ', $target{lib_cppflags} || (),
                           $target{shared_cppflag} || (),
                           (map { '-D'.$_ }
                                @{$config{lib_defines}},
-                               @{$config{shared_defines}},
+                               @{$config{shared_defines}}),
+                          @{$config{lib_cppflags}},
+                          @{$config{shared_cppflag}});
+                join(' ', $lib_cppflags,
+                          (map { '-D'.$_ }
                                'OPENSSLDIR=&quot;\&quot;$(OPENSSLDIR)\&quot;&quot;',
                                'ENGINESDIR=&quot;\&quot;$(ENGINESDIR)\&quot;&quot;'),
-                          @{$config{lib_cppflags}},
-                          @{$config{shared_cppflag}},
                           '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
 LIB_CFLAGS={- join(' ', $target{lib_cflags} || (),
                         $target{shared_cflag} || (),
@@ -316,7 +319,9 @@ BIN_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
 # CPPFLAGS_Q is used for one thing only: to build up buildinf.h
 CPPFLAGS_Q={- $cppflags1 =~ s|([\\&quot;])|\\$1|g;
               $cppflags2 =~ s|([\\&quot;])|\\$1|g;
-              join(' ', $cppflags1 || (), $cppflags2 || ()) -}
+              $lib_cppflags =~ s|([\\&quot;])|\\$1|g;
+              join(' ', $lib_cppflags || (), $cppflags2 || (),
+                        $cppflags1 || ()) -}
 
 PERLASM_SCHEME= {- $target{perlasm_scheme} -}
 
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index 83f893d..214619a 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -230,22 +230,25 @@ CNF_EX_LIBS={- join(' ', $target{ex_libs} || (),
 LIB_ASFLAGS={- join(' ', $target{lib_asflags} || (),
                          @{$config{lib_asflags}},
                          '$(CNF_ASFLAGS)', '$(ASFLAGS)') -}
-LIB_CPPFLAGS={- join(' ', $target{lib_cppflags} || (),
+LIB_CPPFLAGS={- our $lib_cppflags =
+                join(' ', $target{lib_cppflags} || (),
                           $target{shared_cppflag} || (),
                           (map { quotify_l(&quot;-D&quot;.$_) }
                                @{$target{lib_defines}},
                                @{$target{shared_defines}},
                                @{$config{lib_defines}},
-                               @{$config{shared_defines}},
-                               &quot;OPENSSLDIR=\&quot;$openssldir\&quot;&quot;,
-                               &quot;ENGINESDIR=\&quot;$enginesdir\&quot;&quot;),
+                               @{$config{shared_defines}}),
                           (map { quotify_l(&quot;-I&quot;.$_) }
                                @{$target{lib_includes}},
                                @{$target{shared_includes}},
                                @{$config{lib_includes}},
                                @{$config{shared_includes}}),
                           @{$config{lib_cppflags}},
-                          @{$config{shared_cppflag}},
+                          @{$config{shared_cppflag}});
+                join(' ', $lib_cppflags,
+                          (map { quotify_l(&quot;-D&quot;.$_) }
+                               &quot;OPENSSLDIR=\&quot;$openssldir\&quot;&quot;,
+                               &quot;ENGINESDIR=\&quot;$enginesdir\&quot;&quot;),
                           '$(CNF_CPPFLAGS)', '$(CPPFLAGS)') -}
 LIB_CFLAGS={- join(' ', $target{lib_cflags} || (),
                         $target{shared_cflag} || (),
@@ -294,7 +297,8 @@ BIN_EX_LIBS=$(CNF_EX_LIBS) $(EX_LIBS)
 # CPPFLAGS_Q is used for one thing only: to build up buildinf.h
 CPPFLAGS_Q={- $cppflags1 =~ s|([\\&quot;])|\\$1|g;
               $cppflags2 =~ s|([\\&quot;])|\\$1|g;
-              join(' ', $cppflags1 || (), $cppflags2 || ()) -}
+              join(' ', $lib_cppflags || (), $cppflags2 || (),
+                        $cppflags1 || ()) -}
 
 PERLASM_SCHEME= {- $target{perlasm_scheme} -}
 
diff --git a/Configure b/Configure
index 9cf3d75..016a9f3 100755
--- a/Configure
+++ b/Configure
@@ -1226,15 +1226,15 @@ if (!$disabled{dso} &amp;&amp; $target{dso_scheme} ne &quot;&quot;)
 	$target{dso_scheme} =~ tr/[a-z]/[A-Z]/;
 	if ($target{dso_scheme} eq &quot;DLFCN&quot;)
 		{
-		unshift @{$config{defines}}, &quot;DSO_DLFCN&quot;, &quot;HAVE_DLFCN_H&quot;;
+		unshift @{$config{lib_defines}}, &quot;DSO_DLFCN&quot;, &quot;HAVE_DLFCN_H&quot;;
 		}
 	elsif ($target{dso_scheme} eq &quot;DLFCN_NO_H&quot;)
 		{
-		unshift @{$config{defines}}, &quot;DSO_DLFCN&quot;;
+		unshift @{$config{lib_defines}}, &quot;DSO_DLFCN&quot;;
 		}
 	else
 		{
-		unshift @{$config{defines}}, &quot;DSO_$target{dso_scheme}&quot;;
+		unshift @{$config{lib_defines}}, &quot;DSO_$target{dso_scheme}&quot;;
 		}
 	}
 
@@ -1285,10 +1285,10 @@ if ($target{shared_target} eq &quot;&quot;)
 	}
 
 if ($disabled{&quot;dynamic-engine&quot;}) {
-        push @{$config{defines}}, &quot;OPENSSL_NO_DYNAMIC_ENGINE&quot;;
+        push @{$config{openssl_other_defines}}, &quot;OPENSSL_NO_DYNAMIC_ENGINE&quot;;
         $config{dynamic_engines} = 0;
 } else {
-        push @{$config{defines}}, &quot;OPENSSL_NO_STATIC_ENGINE&quot;;
+        push @{$config{openssl_other_defines}}, &quot;OPENSSL_NO_STATIC_ENGINE&quot;;
         $config{dynamic_engines} = 1;
 }
 
@@ -1333,7 +1333,7 @@ if ($disabled{pic})
 	}
 else
 	{
-	push @{$config{defines}}, &quot;OPENSSL_PIC&quot;;
+	push @{$config{lib_defines}}, &quot;OPENSSL_PIC&quot;;
 	}
 
 if ($target{sys_id} ne &quot;&quot;)
@@ -1343,65 +1343,65 @@ if ($target{sys_id} ne &quot;&quot;)
 
 unless ($disabled{asm}) {
     $target{cpuid_asm_src}=$table{DEFAULTS}-&gt;{cpuid_asm_src} if ($config{processor} eq &quot;386&quot;);
-    push @{$config{defines}}, &quot;OPENSSL_CPUID_OBJ&quot; if ($target{cpuid_asm_src} ne &quot;mem_clr.c&quot;);
+    push @{$config{lib_defines}}, &quot;OPENSSL_CPUID_OBJ&quot; if ($target{cpuid_asm_src} ne &quot;mem_clr.c&quot;);
 
     $target{bn_asm_src} =~ s/\w+-gf2m.c// if (defined($disabled{ec2m}));
 
     # bn-586 is the only one implementing bn_*_part_words
-    push @{$config{defines}}, &quot;OPENSSL_BN_ASM_PART_WORDS&quot; if ($target{bn_asm_src} =~ /bn-586/);
-    push @{$config{defines}}, &quot;OPENSSL_IA32_SSE2&quot; if (!$disabled{sse2} &amp;&amp; $target{bn_asm_src} =~ /86/);
+    push @{$config{lib_defines}}, &quot;OPENSSL_BN_ASM_PART_WORDS&quot; if ($target{bn_asm_src} =~ /bn-586/);
+    push @{$config{lib_defines}}, &quot;OPENSSL_IA32_SSE2&quot; if (!$disabled{sse2} &amp;&amp; $target{bn_asm_src} =~ /86/);
 
-    push @{$config{defines}}, &quot;OPENSSL_BN_ASM_MONT&quot; if ($target{bn_asm_src} =~ /-mont/);
-    push @{$config{defines}}, &quot;OPENSSL_BN_ASM_MONT5&quot; if ($target{bn_asm_src} =~ /-mont5/);
-    push @{$config{defines}}, &quot;OPENSSL_BN_ASM_GF2m&quot; if ($target{bn_asm_src} =~ /-gf2m/);
+    push @{$config{lib_defines}}, &quot;OPENSSL_BN_ASM_MONT&quot; if ($target{bn_asm_src} =~ /-mont/);
+    push @{$config{lib_defines}}, &quot;OPENSSL_BN_ASM_MONT5&quot; if ($target{bn_asm_src} =~ /-mont5/);
+    push @{$config{lib_defines}}, &quot;OPENSSL_BN_ASM_GF2m&quot; if ($target{bn_asm_src} =~ /-gf2m/);
 
     if ($target{sha1_asm_src}) {
-	push @{$config{defines}}, &quot;SHA1_ASM&quot;   if ($target{sha1_asm_src} =~ /sx86/ || $target{sha1_asm_src} =~ /sha1/);
-	push @{$config{defines}}, &quot;SHA256_ASM&quot; if ($target{sha1_asm_src} =~ /sha256/);
-	push @{$config{defines}}, &quot;SHA512_ASM&quot; if ($target{sha1_asm_src} =~ /sha512/);
+	push @{$config{lib_defines}}, &quot;SHA1_ASM&quot;   if ($target{sha1_asm_src} =~ /sx86/ || $target{sha1_asm_src} =~ /sha1/);
+	push @{$config{lib_defines}}, &quot;SHA256_ASM&quot; if ($target{sha1_asm_src} =~ /sha256/);
+	push @{$config{lib_defines}}, &quot;SHA512_ASM&quot; if ($target{sha1_asm_src} =~ /sha512/);
     }
     if ($target{rc4_asm_src} ne $table{DEFAULTS}-&gt;{rc4_asm_src}) {
-	push @{$config{defines}}, &quot;RC4_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;RC4_ASM&quot;;
     }
     if ($target{md5_asm_src}) {
-	push @{$config{defines}}, &quot;MD5_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;MD5_ASM&quot;;
     }
     $target{cast_asm_src}=$table{DEFAULTS}-&gt;{cast_asm_src} unless $disabled{pic}; # CAST assembler is not PIC
     if ($target{rmd160_asm_src}) {
-	push @{$config{defines}}, &quot;RMD160_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;RMD160_ASM&quot;;
     }
     if ($target{aes_asm_src}) {
-	push @{$config{defines}}, &quot;AES_ASM&quot; if ($target{aes_asm_src} =~ m/\baes-/);;
+	push @{$config{lib_defines}}, &quot;AES_ASM&quot; if ($target{aes_asm_src} =~ m/\baes-/);;
 	# aes-ctr.fake is not a real file, only indication that assembler
 	# module implements AES_ctr32_encrypt...
-	push @{$config{defines}}, &quot;AES_CTR_ASM&quot; if ($target{aes_asm_src} =~ s/\s*aes-ctr\.fake//);
+	push @{$config{lib_defines}}, &quot;AES_CTR_ASM&quot; if ($target{aes_asm_src} =~ s/\s*aes-ctr\.fake//);
 	# aes-xts.fake indicates presence of AES_xts_[en|de]crypt...
-	push @{$config{defines}}, &quot;AES_XTS_ASM&quot; if ($target{aes_asm_src} =~ s/\s*aes-xts\.fake//);
+	push @{$config{lib_defines}}, &quot;AES_XTS_ASM&quot; if ($target{aes_asm_src} =~ s/\s*aes-xts\.fake//);
 	$target{aes_asm_src} =~ s/\s*(vpaes|aesni)-x86\.s//g if ($disabled{sse2});
-	push @{$config{defines}}, &quot;VPAES_ASM&quot; if ($target{aes_asm_src} =~ m/vpaes/);
-	push @{$config{defines}}, &quot;BSAES_ASM&quot; if ($target{aes_asm_src} =~ m/bsaes/);
+	push @{$config{lib_defines}}, &quot;VPAES_ASM&quot; if ($target{aes_asm_src} =~ m/vpaes/);
+	push @{$config{lib_defines}}, &quot;BSAES_ASM&quot; if ($target{aes_asm_src} =~ m/bsaes/);
     }
     if ($target{wp_asm_src} =~ /mmx/) {
         if ($config{processor} eq &quot;386&quot;) {
 	    $target{wp_asm_src}=$table{DEFAULTS}-&gt;{wp_asm_src};
 	} elsif (!$disabled{&quot;whirlpool&quot;}) {
-	    push @{$config{defines}}, &quot;WHIRLPOOL_ASM&quot;;
+	    push @{$config{lib_defines}}, &quot;WHIRLPOOL_ASM&quot;;
 	}
     }
     if ($target{modes_asm_src} =~ /ghash-/) {
-	push @{$config{defines}}, &quot;GHASH_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;GHASH_ASM&quot;;
     }
     if ($target{ec_asm_src} =~ /ecp_nistz256/) {
-	push @{$config{defines}}, &quot;ECP_NISTZ256_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;ECP_NISTZ256_ASM&quot;;
     }
     if ($target{ec_asm_src} =~ /x25519/) {
-	push @{$config{defines}}, &quot;X25519_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;X25519_ASM&quot;;
     }
     if ($target{padlock_asm_src} ne $table{DEFAULTS}-&gt;{padlock_asm_src}) {
-	push @{$config{defines}}, &quot;PADLOCK_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;PADLOCK_ASM&quot;;
     }
     if ($target{poly1305_asm_src} ne &quot;&quot;) {
-	push @{$config{defines}}, &quot;POLY1305_ASM&quot;;
+	push @{$config{lib_defines}}, &quot;POLY1305_ASM&quot;;
     }
 }
 
diff --git a/crypto/build.info b/crypto/build.info
index c406a11..368671a 100644
--- a/crypto/build.info
+++ b/crypto/build.info
@@ -11,7 +11,7 @@ EXTRA=  ../ms/uplink-x86.pl ../ms/uplink.c ../ms/applink.c \
         ppccpuid.pl pariscid.pl alphacpuid.pl arm64cpuid.pl armv4cpuid.pl
 
 DEPEND[cversion.o]=buildinf.h
-GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(CNF_CFLAGS) $(CFLAGS) $(CPPFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
+GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(LIB_CFLAGS) $(CPPFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
 DEPEND[buildinf.h]=../configdata.pm
 
 GENERATE[uplink-x86.s]=../ms/uplink-x86.pl $(PERLASM_SCHEME)
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018432.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="018436.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18434">[ date ]</a>
              <a href="thread.html#18434">[ thread ]</a>
              <a href="subject.html#18434">[ subject ]</a>
              <a href="author.html#18434">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
