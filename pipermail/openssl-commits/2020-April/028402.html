<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1587456782.097832.29721.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028398.html">
   <LINK REL="Next"  HREF="028414.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1587456782.097832.29721.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Tue Apr 21 08:13:02 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="028398.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="028414.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28402">[ date ]</a>
              <a href="thread.html#28402">[ thread ]</a>
              <a href="subject.html#28402">[ subject ]</a>
              <a href="author.html#28402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  b0b0b6a41dd4418bab19cdd28c01ce248fee6af7 (commit)
      from  78b4aba9f814e7866bc47a4b6552fb3b2b992cfa (commit)


- Log -----------------------------------------------------------------
commit b0b0b6a41dd4418bab19cdd28c01ce248fee6af7
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Apr 6 23:58:24 2020 +0200

    Developer scripts: Release script
    
    The old release script that exists in another repository has aged, and
    risks becoming messy beyond maintainability if it's made to deal with
    multiple OpenSSL version schemes.
    
    A solution, which has been seen in other projects, is to have the
    release script as part of the versioned source tree, and ensure it's
    adapted for the ongoing version scheme in that source tree.
    
    This introduces dev/, a directory of OpenSSL developer &quot;stuff&quot;.  We
    may expand it with other practical scripts to easy development setup
    and other similar things that developers may need.  For now, it's the
    release script dev/release.sh, with auxilliary files in dev/release-aux/.
    The script is self describing, the manual is available by running the
    command `./dev/release.sh --manual`.
    
    The dev/ directory shall never appear in a source distribution.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11516">https://github.com/openssl/openssl/pull/11516</A>)

-----------------------------------------------------------------------

Summary of changes:
 .gitattributes                                    |   1 +
 dev/README                                        |   6 +
 dev/release-aux/README.md                         |  30 +
 dev/release-aux/fix-title.pl                      |   6 +
 dev/release-aux/fixup-CHANGES.md-postrelease.pl   |  28 +
 dev/release-aux/fixup-CHANGES.md-release.pl       |  13 +
 dev/release-aux/fixup-NEWS.md-postrelease.pl      |  28 +
 dev/release-aux/fixup-NEWS.md-release.pl          |  16 +
 dev/release-aux/openssl-announce-pre-release.tmpl |  49 ++
 dev/release-aux/openssl-announce-release.tmpl     |  36 ++
 dev/release-aux/release-state-fn.sh               | 202 ++++++
 dev/release-aux/release-version-fn.sh             | 114 ++++
 dev/release.sh                                    | 711 ++++++++++++++++++++++
 13 files changed, 1240 insertions(+)
 create mode 100644 dev/README
 create mode 100644 dev/release-aux/README.md
 create mode 100644 dev/release-aux/fix-title.pl
 create mode 100644 dev/release-aux/fixup-CHANGES.md-postrelease.pl
 create mode 100644 dev/release-aux/fixup-CHANGES.md-release.pl
 create mode 100644 dev/release-aux/fixup-NEWS.md-postrelease.pl
 create mode 100644 dev/release-aux/fixup-NEWS.md-release.pl
 create mode 100644 dev/release-aux/openssl-announce-pre-release.tmpl
 create mode 100644 dev/release-aux/openssl-announce-release.tmpl
 create mode 100644 dev/release-aux/release-state-fn.sh
 create mode 100644 dev/release-aux/release-version-fn.sh
 create mode 100755 dev/release.sh

diff --git a/.gitattributes b/.gitattributes
index 96e40b6cd4..e2558331ac 100644
--- a/.gitattributes
+++ b/.gitattributes
@@ -10,3 +10,4 @@ util/mktar.sh                           export-ignore
 boringssl                               export-ignore
 krb5                                    export-ignore
 pyca-cryptography                       export-ignore
+dev                                     export-ignore
diff --git a/dev/README b/dev/README
new file mode 100644
index 0000000000..aee3fcd6af
--- /dev/null
+++ b/dev/README
@@ -0,0 +1,6 @@
+Developer files
+===============
+
+Here are all kinds of things that an OpenSSL developer might need or
+might choose to use.  Some of them demand access to OpenSSL's
+infrastructure, others are simply practical.
diff --git a/dev/release-aux/README.md b/dev/release-aux/README.md
new file mode 100644
index 0000000000..9d05ae5f98
--- /dev/null
+++ b/dev/release-aux/README.md
@@ -0,0 +1,30 @@
+Auxilliary files for dev/release.sh
+===================================
+
+-   release-state-fn.sh
+
+    This is the main version and state update logic...  you could say
+    that it's the innermost engine for the release mechanism.  It
+    tries to be agnostic of versioning schemes, and relies on
+    release-version-fn.sh to supply necessary functions that are
+    specific for versioning schemes.
+    
+-   release-version-fn.sh
+
+    Supplies functions that are specific to versioning schemes:
+    
+    get_version() gets the version data from appropriate files.
+
+    set_version() writes the version data to appropriate files.
+
+    fixup_version() updates the version data, given a first argument
+    that instructs it what update to do.
+    
+-   openssl-announce-pre-release.tmpl and openssl-announce-release.tmpl
+
+    Templates for announcements
+    
+-   fixup-*-release.pl and fixup-*-postrelease.pl
+
+    Fixup scripts for specific files, to be done for the release
+    commit and for the post-release commit.
diff --git a/dev/release-aux/fix-title.pl b/dev/release-aux/fix-title.pl
new file mode 100644
index 0000000000..d3f00b984b
--- /dev/null
+++ b/dev/release-aux/fix-title.pl
@@ -0,0 +1,6 @@
+#! /usr/bin/perl
+
+BEGIN { my $prev }
+($_ = $prev) =~ s|^( *)(.*)$|&quot;$1&quot; . '=' x length($2)|e
+    if m|==========|;
+$prev = $_;
diff --git a/dev/release-aux/fixup-CHANGES.md-postrelease.pl b/dev/release-aux/fixup-CHANGES.md-postrelease.pl
new file mode 100644
index 0000000000..6592635dc3
--- /dev/null
+++ b/dev/release-aux/fixup-CHANGES.md-postrelease.pl
@@ -0,0 +1,28 @@
+#! /usr/bin/env perl -pi
+
+BEGIN {
+    our $count = 1;              # Only the first one
+    our $RELEASE = $ENV{RELEASE};
+    our $RELEASE_TEXT = $ENV{RELEASE_TEXT};
+    our $PREV_RELEASE_DATE = $ENV{PREV_RELEASE_DATE} || 'xx XXX xxxx';
+    our $PREV_RELEASE_TEXT = $ENV{PREV_RELEASE_TEXT};
+
+    $RELEASE =~ s/-dev//;
+}
+
+if (/^### Changes between (\S+) and (\S+) \[xx XXX xxxx\]/
+    &amp;&amp; $count-- &gt; 0) {
+    my $v1 = $1;
+    my $v2 = $PREV_RELEASE_TEXT || $2;
+
+    # If this is a pre-release, we do nothing
+    if ($RELEASE !~ /^\d+\.\d+\.\d+-(?:alpha|beta)/) {
+        $_ = &lt;&lt;_____
+### Changes between $v2 and $RELEASE_TEXT [xx XXX xxxx] ###
+
+ * 
+
+### Changes between $v1 and $v2 [$PREV_RELEASE_DATE] ###
+_____
+    }
+}
diff --git a/dev/release-aux/fixup-CHANGES.md-release.pl b/dev/release-aux/fixup-CHANGES.md-release.pl
new file mode 100644
index 0000000000..7e5ba7e8ce
--- /dev/null
+++ b/dev/release-aux/fixup-CHANGES.md-release.pl
@@ -0,0 +1,13 @@
+#! /usr/bin/env perl -p
+
+BEGIN {
+    our $count = 1;              # Only the first one
+    our $RELEASE = $ENV{RELEASE};
+    our $RELEASE_TEXT = $ENV{RELEASE_TEXT};
+    our $RELEASE_DATE = $ENV{RELEASE_DATE};
+}
+
+if (/^### Changes between (\S+) and (\S+) \[xx XXX xxxx\]/
+    &amp;&amp; $count-- &gt; 0) {
+    $_ = &quot;### Changes between $1 and $RELEASE_TEXT [$RELEASE_DATE]$'&quot;;
+}
diff --git a/dev/release-aux/fixup-NEWS.md-postrelease.pl b/dev/release-aux/fixup-NEWS.md-postrelease.pl
new file mode 100644
index 0000000000..b1d47264b0
--- /dev/null
+++ b/dev/release-aux/fixup-NEWS.md-postrelease.pl
@@ -0,0 +1,28 @@
+#! /usr/bin/env perl -pi
+
+BEGIN {
+    our $count = 1;              # Only the first one
+    our $RELEASE = $ENV{RELEASE};
+    our $RELEASE_TEXT = $ENV{RELEASE_TEXT};
+    our $PREV_RELEASE_DATE = $ENV{PREV_RELEASE_DATE} || 'under development';
+    our $PREV_RELEASE_TEXT = $ENV{PREV_RELEASE_TEXT};
+
+    $RELEASE =~ s/-dev//;
+}
+
+if (/^### Major changes between OpenSSL (\S+) and OpenSSL (\S+) \[under development\]/
+    &amp;&amp; $count-- &gt; 0) {
+    my $v1 = $1;
+    my $v2 = $PREV_RELEASE_TEXT || $2;
+
+    # If this is a pre-release, we do nothing
+    if ($RELEASE !~ /^\d+\.\d+\.\d+-(?:alpha|beta)/) {
+        $_ = &lt;&lt;_____
+### Major changes between OpenSSL $v2 and OpenSSL $RELEASE_TEXT [under development] ###
+
+ * 
+
+### Major changes between OpenSSL $v1 and OpenSSL $v2 [$PREV_RELEASE_DATE] ###
+_____
+    }
+}
diff --git a/dev/release-aux/fixup-NEWS.md-release.pl b/dev/release-aux/fixup-NEWS.md-release.pl
new file mode 100644
index 0000000000..212e10e869
--- /dev/null
+++ b/dev/release-aux/fixup-NEWS.md-release.pl
@@ -0,0 +1,16 @@
+#! /usr/bin/env perl -p
+
+BEGIN {
+    our $count = 1;              # Only the first one
+    our $RELEASE = $ENV{RELEASE};
+    our $RELEASE_TEXT = $ENV{RELEASE_TEXT};
+    our $RELEASE_DATE = $ENV{RELEASE_DATE};
+
+    $RELEASE_DATE = 'in pre-release'
+        if ($RELEASE =~ /\d+\.\d+\.\d+-(?:alpha|beta)/)
+}
+
+if (/^### Major changes between OpenSSL (\S+) and OpenSSL (\S+) \[under development\]/
+    &amp;&amp; $count-- &gt; 0) {
+    $_ = &quot;### Major changes between OpenSSL $1 and OpenSSL $RELEASE_TEXT [$RELEASE_DATE]$'&quot;;
+}
diff --git a/dev/release-aux/openssl-announce-pre-release.tmpl b/dev/release-aux/openssl-announce-pre-release.tmpl
new file mode 100644
index 0000000000..2f3b5d36f4
--- /dev/null
+++ b/dev/release-aux/openssl-announce-pre-release.tmpl
@@ -0,0 +1,49 @@
+
+   OpenSSL version $release_text released
+   ======================================
+
+   OpenSSL - The Open Source toolkit for SSL/TLS
+   <A HREF="https://www.openssl.org/">https://www.openssl.org/</A>
+
+   OpenSSL $series is currently in $label.
+
+   OpenSSL $release_text has now been made available.  For details of
+   changes and known issues see the release notes at:
+
+        <A HREF="https://www.openssl.org/news/openssl-$series-notes.html">https://www.openssl.org/news/openssl-$series-notes.html</A>
+
+   Note: This OpenSSL pre-release has been provided for testing ONLY.
+   It should NOT be used for security critical purposes.
+
+   The $label release is available for download via HTTPS and FTP from the
+   following master locations (you can find the various FTP mirrors under
+   <A HREF="https://www.openssl.org/source/mirror.html">https://www.openssl.org/source/mirror.html</A>):
+
+     * <A HREF="https://www.openssl.org/source/">https://www.openssl.org/source/</A>
+     * <A HREF="ftp://ftp.openssl.org/source/">ftp://ftp.openssl.org/source/</A>
+
+   The distribution file name is:
+
+    o $tarfile
+      Size: $length
+      SHA1 checksum: $sha1hash
+      SHA256 checksum: $sha256hash
+
+   The checksums were calculated using the following commands:
+
+    openssl sha1 $tarfile
+    openssl sha256 $tarfile
+
+   Please download and check this $LABEL release as soon as possible.
+   To report a bug, open an issue on GitHub:
+
+    <A HREF="https://github.com/openssl/openssl/issues">https://github.com/openssl/openssl/issues</A>
+
+   Please check the release notes and mailing lists to avoid duplicate
+   reports of known issues. (Of course, the source is also available
+   on GitHub.)
+
+   Yours,
+
+   The OpenSSL Project Team.
+
diff --git a/dev/release-aux/openssl-announce-release.tmpl b/dev/release-aux/openssl-announce-release.tmpl
new file mode 100644
index 0000000000..8e708c2253
--- /dev/null
+++ b/dev/release-aux/openssl-announce-release.tmpl
@@ -0,0 +1,36 @@
+
+   OpenSSL version $release released
+   =================================
+
+   OpenSSL - The Open Source toolkit for SSL/TLS
+   <A HREF="https://www.openssl.org/">https://www.openssl.org/</A>
+
+   The OpenSSL project team is pleased to announce the release of
+   version $release of our open source toolkit for SSL/TLS.
+   For details of changes and known issues see the release notes at:
+
+        <A HREF="https://www.openssl.org/news/openssl-$series-notes.html">https://www.openssl.org/news/openssl-$series-notes.html</A>
+
+   OpenSSL $release is available for download via HTTPS and FTP from the
+   following master locations (you can find the various FTP mirrors under
+   <A HREF="https://www.openssl.org/source/mirror.html">https://www.openssl.org/source/mirror.html</A>):
+
+     * <A HREF="https://www.openssl.org/source/">https://www.openssl.org/source/</A>
+     * <A HREF="ftp://ftp.openssl.org/source/">ftp://ftp.openssl.org/source/</A>
+
+   The distribution file name is:
+
+    o $tarfile
+      Size: $length
+      SHA1 checksum: $sha1hash
+      SHA256 checksum: $sha256hash
+
+   The checksums were calculated using the following commands:
+
+    openssl sha1 $tarfile
+    openssl sha256 $tarfile
+
+   Yours,
+
+   The OpenSSL Project Team.
+
diff --git a/dev/release-aux/release-state-fn.sh b/dev/release-aux/release-state-fn.sh
new file mode 100644
index 0000000000..f495cb8536
--- /dev/null
+++ b/dev/release-aux/release-state-fn.sh
@@ -0,0 +1,202 @@
+#! /bin/sh
+# Copyright 2020 The OpenSSL Project Authors. All Rights Reserved.
+#
+# Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+# this file except in compliance with the License.  You can obtain a copy
+# in the file LICENSE in the source distribution or at
+# <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
+
+# This will increase the version number and pre-release tag, according to the
+# current state of the source tree, and the function's first argument (called
+# |next| internally), which is how the caller tells what the next step should
+# be.
+#
+# The possible current source tree states are:
+# ''            The source is in a released state.
+# 'dev'         The source is in development.  This is the normal state.
+# 'alpha', 'alphadev'
+#               The source is undergoing a series of alpha releases.
+# 'beta', 'betadev'
+#               The source is undergoing a series of beta releases.
+# These states are computed from $PRE_LABEL and $TYPE
+#
+# The possible |next| values are:
+# 'alpha'       The source tree should move to an alpha release state, or
+#               stay there.  This trips the alpha / pre-release counter.
+# 'beta'        The source tree should move to a beta release state, or
+#               stay there.  This trips the beta / pre-release counter.
+# 'final'       The source tree should move to a final release (assuming it's
+#               currently in one of the alpha or beta states).  This turns
+#               off the alpha or beta states.
+# ''            The source tree should move to the next release.  The exact
+#               meaning depends on the current source state.  It may mean
+#               tripping the alpha / beta / pre-release counter, or increasing
+#               the PATCH number.
+#
+# 'minor'       The source tree should move to the next minor version.  This
+#               should only be used in the master branch when a release branch
+#               has been created.
+#
+# This function expects there to be a function called fixup_version(), which
+# SHOULD take the |next| as first argument, and SHOULD increase the label
+# counter or the PATCH number accordingly, but only when the current
+# state is &quot;in development&quot;.
+
+next_release_state () {
+    local next=&quot;$1&quot;
+    local today=&quot;$(date '+%-d %b %Y')&quot;
+    local retry=true
+
+    local before=&quot;$PRE_LABEL$TYPE&quot;
+
+    while $retry; do
+        retry=false
+
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$before=$before&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$next=$next&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$MAJOR=$MAJOR&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$MINOR=$MINOR&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$PATCH=$PATCH&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$TYPE=$TYPE&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$PRE_LABEL=$PRE_LABEL&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$PRE_NUM=$PRE_NUM&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: BEGIN: \$RELEASE_DATE=$RELEASE_DATE&quot;
+
+        case &quot;$before+$next&quot; in
+            # MAKING ALPHA RELEASES ##################################
+            
+            # Alpha releases can't be made from beta versions or real versions
+            beta*+alpha | +alpha )
+                echo &gt;&amp;2 &quot;Invalid state for an alpha release&quot;
+                echo &gt;&amp;2 &quot;Try --beta or --final, or perhaps nothing&quot;
+                exit 1
+                ;;
+            # For alpha releases, the tag update is dev =&gt; alpha or
+            # alpha dev =&gt; alpha for the release itself, and
+            # alpha =&gt; alpha dev for post release.
+            dev+alpha | alphadev+alpha )
+                TYPE=
+                RELEASE_DATE=&quot;$today&quot;
+                fixup_version &quot;alpha&quot;
+                ;;
+            alpha+alpha )
+                TYPE=dev
+                RELEASE_DATE=
+                fixup_version &quot;alpha&quot;
+                ;;
+
+            # MAKING BETA RELEASES ###################################
+
+            # Beta releases can't be made from real versions
+            +beta )
+                echo &gt;&amp;2 &quot;Invalid state for beta release&quot;
+                echo &gt;&amp;2 &quot;Try --final, or perhaps nothing&quot;
+                exit 1
+                ;;
+            # For beta releases, the tag update is dev =&gt; beta1, or
+            # alpha{n}-dev =&gt; beta1 when transitioning from alpha to
+            # beta, or beta{n}-dev =&gt; beta{n} for the release itself,
+            # or beta{n} =&gt; beta{n+1}-dev for post release.
+            dev+beta | alphadev+beta | betadev+beta )
+                TYPE=
+                RELEASE_DATE=&quot;$today&quot;
+                fixup_version &quot;beta&quot;
+                ;;
+            beta+beta )
+                TYPE=dev
+                RELEASE_DATE=
+                fixup_version &quot;beta&quot;
+                ;;
+            # It's possible to switch from alpha to beta in the
+            # post release.  That's what --next-beta does.
+            alpha+beta )
+                TYPE=dev
+                RELEASE_DATE=
+                fixup_version &quot;beta&quot;
+                ;;
+
+            # MAKING FINAL RELEASES ##################################
+
+            # Final releases can't be made from the main development branch
+            dev+final)
+                echo &gt;&amp;2 &quot;Invalid state for final release&quot;
+                echo &gt;&amp;2 &quot;This should have been preceded by an alpha or a beta release&quot;
+                exit 1
+                ;;
+            # For final releases, the starting point must be a dev state
+            alphadev+final | betadev+final )
+                TYPE=
+                RELEASE_DATE=&quot;$today&quot;
+                fixup_version &quot;final&quot;
+                ;;
+            # The final step of a final release is to switch back to
+            # development
+            +final )
+                TYPE=dev
+                RELEASE_DATE=
+                fixup_version &quot;final&quot;
+                ;;
+
+            # SWITCHING TO THE NEXT MINOR RELEASE ####################
+
+            *+minor )
+                TYPE=dev
+                RELEASE_DATE=
+                fixup_version &quot;minor&quot;
+                ;;
+
+            # MAKING DEFAULT RELEASES ################################
+
+            # If we're coming from a non-dev, simply switch to dev.
+            # fixup_version() should trip up the PATCH number.
+            + )
+                TYPE=dev
+                fixup_version &quot;&quot;
+                ;;
+
+            # If we're coming from development, switch to non-dev, unless
+            # the PATCH number is zero.  If it is, we force the caller to
+            # go through the alpha and beta release process.
+            dev+ )
+                if [ &quot;$PATCH&quot; = &quot;0&quot; ]; then
+                    echo &gt;&amp;2 &quot;Can't update PATCH version number from 0&quot;
+                    echo &gt;&amp;2 &quot;Please use --alpha or --beta&quot;
+                    exit 1
+                fi
+                TYPE=
+                RELEASE_DATE=&quot;$today&quot;
+                fixup_version &quot;&quot;
+                ;;
+
+            # If we're currently in alpha, we continue with alpha, as if
+            # the user had specified --alpha
+            alpha*+ )
+                next=alpha
+                retry=true
+                ;;
+
+            # If we're currently in beta, we continue with beta, as if
+            # the user had specified --beta
+            beta*+ )
+                next=beta
+                retry=true
+                ;;
+
+            *)
+                echo &gt;&amp;2 &quot;Invalid combination of options&quot;
+                exit 1
+                ;;
+        esac
+
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$before=$before&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$next=$next&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$MAJOR=$MAJOR&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$MINOR=$MINOR&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$PATCH=$PATCH&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$TYPE=$TYPE&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$PRE_LABEL=$PRE_LABEL&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$PRE_NUM=$PRE_NUM&quot;
+        $DEBUG &gt;&amp;2 &quot;DEBUG[next_release_state]: END: \$RELEASE_DATE=$RELEASE_DATE&quot;
+    done
+}
+
diff --git a/dev/release-aux/release-version-fn.sh b/dev/release-aux/release-version-fn.sh
new file mode 100644
index 0000000000..f0ac69fa6e
--- /dev/null
+++ b/dev/release-aux/release-version-fn.sh
@@ -0,0 +1,114 @@
+#! /bin/sh
+# Copyright 2020 The OpenSSL Project Authors. All Rights Reserved.
+#
+# Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+# this file except in compliance with the License.  You can obtain a copy
+# in the file LICENSE in the source distribution or at
+# <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
+
+# These functions load, manipulate and store the current version information
+# for OpenSSL 3.0 and on.
+# They are meant to be minimalistic for easy refactoring depending on OpenSSL
+# version.
+#
+# Version information is stored in the following variables:
+#
+# |MAJOR|, |MINOR|, |PATCH| are the three parts of a version number.
+# |MAJOR| is to be increased for new major releases, |MINOR| for new
+# minor releases, and |PATCH| for update releases.
+#
+# |SERIES| tells what release series the current version belongs to, and
+# is composed from |MAJOR| and |MINOR|.
+# |VERSION| tells what the current version is, and is composed from |MAJOR|,
+# |MINOR| and |PATCH|.
+# |TYPE| tells what state the source is in.  It may have an empty value
+# for released source, or 'dev' for &quot;in development&quot;.
+# |PRE_LABEL| may be &quot;alpha&quot; or &quot;beta&quot; to signify an ongoing series of
+# alpha or beta releases.  |PRE_NUM| is a pre-release counter for the
+# alpha and beta release series, but isn't necessarily strictly tied
+# to the prerelease label.
+#
+# Scripts loading this file are not allowed to manipulate these
+# variables directly.  They must use functions such as fixup_version()
+# below, or next_release_state(), found in release-state-fn.sh.
+
+# These functions depend on |SOURCEDIR|, which must have the intended
+# OpenSSL source directory as value.
+
+get_version () {
+    eval $(git cat-file blob HEAD:VERSION)
+    VERSION=&quot;$MAJOR.$MINOR.$PATCH&quot;
+    SERIES=&quot;$MAJOR.$MINOR&quot;
+    TYPE=$( echo &quot;$PRE_RELEASE_TAG&quot; \
+                | sed -E \
+                      -e 's|^dev$|dev|' \
+                      -e 's|^alpha([0-9]+)(-(dev))?$|\3|' \
+                      -e 's|^beta([0-9]+)(-(dev))?$|\3|' )
+    PRE_LABEL=$( echo &quot;$PRE_RELEASE_TAG&quot; \
+                     | sed -E \
+                           -e 's|^dev$||' \
+                           -e 's|^alpha([0-9]+)(-(dev))?$|alpha|' \
+                           -e 's|^beta([0-9]+)(-(dev))?$|beta|' )
+    PRE_NUM=$( echo &quot;$PRE_RELEASE_TAG&quot; \
+                   | sed -E \
+                         -e 's|^dev$|0|' \
+                         -e 's|^alpha([0-9]+)(-(dev))?$|\1|' \
+                         -e 's|^beta([0-9]+)(-(dev))?$|\1|' )
+}
+
+# $1 is one of &quot;alpha&quot;, &quot;beta&quot;, &quot;final&quot;, &quot;&quot;, or &quot;minor&quot;
+fixup_version () {
+    local new_label=&quot;$1&quot;
+
+    case &quot;$new_label&quot; in
+        alpha | beta )
+            if [ &quot;$new_label&quot; != &quot;$PRE_LABEL&quot; ]; then
+                PRE_LABEL=&quot;$new_label&quot;
+                PRE_NUM=1
+            elif [ &quot;$TYPE&quot; = 'dev' ]; then
+                PRE_NUM=$(expr $PRE_NUM + 1)
+            fi
+            ;;
+        final | '' )
+            if [ &quot;$TYPE&quot; = 'dev' ]; then
+                PATCH=$(expr $PATCH + 1)
+            fi
+            PRE_LABEL=
+            PRE_NUM=0
+            ;;
+        minor )
+            if [ &quot;$TYPE&quot; = 'dev' ]; then
+                MINOR=$(expr $MINOR + 1)
+                PATCH=0
+            fi
+            PRE_LABEL=
+            PRE_NUM=0
+            ;;
+    esac
+
+    VERSION=&quot;$MAJOR.$MINOR.$PATCH&quot;
+    SERIES=&quot;$MAJOR.$MINOR&quot;
+}
+
+set_version () {
+    case &quot;$TYPE+$PRE_LABEL+$PRE_NUM&quot; in
+        *++* )
+            PRE_RELEASE_TAG=&quot;$TYPE&quot;
+            ;;
+        dev+* )
+            PRE_RELEASE_TAG=&quot;$PRE_LABEL$PRE_NUM-dev&quot;
+            ;;
+        +* )
+            PRE_RELEASE_TAG=&quot;$PRE_LABEL$PRE_NUM&quot;
+            ;;
+    esac
+    cat &gt; &quot;$SOURCEDIR/VERSION&quot; &lt;&lt;EOF
+MAJOR=$MAJOR
+MINOR=$MINOR
+PATCH=$PATCH
+PRE_RELEASE_TAG=$PRE_RELEASE_TAG
+BUILD_METADATA=$BUILD_METADATA
+RELEASE_DATE=&quot;$RELEASE_DATE&quot;
+SHLIB_VERSION=$SHLIB_VERSION
+EOF
+}
diff --git a/dev/release.sh b/dev/release.sh
new file mode 100755
index 0000000000..c7f19fe16d
--- /dev/null
+++ b/dev/release.sh
@@ -0,0 +1,711 @@
+#! /bin/bash -e
+# Copyright 2020 The OpenSSL Project Authors. All Rights Reserved.
+#
+# Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+# this file except in compliance with the License.  You can obtain a copy
+# in the file LICENSE in the source distribution or at
+# <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
+
+# This is the most shell agnostic way to specify that POSIX rules.
+POSIXLY_CORRECT=1
+
+usage () {
+    cat &lt;&lt;EOF
+Usage: release.sh [ options ... ]
+
+--alpha         Start or increase the &quot;alpha&quot; pre-release tag.
+--next-beta     Switch to the &quot;beta&quot; pre-release tag after alpha release.
+                It can only be given with --alpha.
+--beta          Start or increase the &quot;beta&quot; pre-release tag.
+--final         Get out of &quot;alpha&quot; or &quot;beta&quot; and make a final release.
+                Implies --branch.
+
+--branch        Create a release branch 'openssl-{major}.{minor}.x',
+                where '{major}' and '{minor}' are the major and minor
+                version numbers.
+
+--local-user=&lt;keyid&gt;
+                For the purpose of signing tags and tar files, use this
+                key (default: use the default e-mail address&#8217; key).
+
+--no-upload     Don't upload to <A HREF="../../../mailman/listinfo/openssl-commits.html">upload at dev.openssl.org.</A>
+--no-update     Don't perform 'make update'.
+--verbose       Verbose output.
+--debug         Include debug output.  Implies --no-upload.
+
+--force         Force execution
+
+--help          This text
+--manual        The manual
+
+If none of --alpha, --beta, or --final are given, this script tries to
+figure out the next step.
+EOF
+    exit 0
+}
+
+# Set to one of 'major', 'minor', 'alpha', 'beta' or 'final'
+next_method=
+next_method2=
+
+do_branch=false
+warn_branch=false
+
+do_clean=true
+do_upload=true
+do_update=true
+DEBUG=:
+VERBOSE=:
+git_quiet=-q
+
+force=false
+
+do_help=false
+do_manual=false
+
+tagkey=' -s'
+gpgkey=
+
+upload_address=<A HREF="../../../mailman/listinfo/openssl-commits.html">upload at dev.openssl.org</A>
+
+TEMP=$(getopt -l 'alpha,next-beta,beta,final' \
+              -l 'branch' \
+              -l 'no-upload,no-update' \
+              -l 'verbose,debug' \
+              -l 'local-user:' \
+              -l 'force' \
+              -l 'help,manual' \
+              -n release.sh -- - &quot;$@&quot;)
+eval set -- &quot;$TEMP&quot;
+while true; do
+    case $1 in
+    --alpha | --beta | --final )
+        next_method=$(echo &quot;x$1&quot; | sed -e 's|^x--||')
+        if [ -z &quot;$next_method2&quot; ]; then
+            next_method2=$next_method
+        fi
+        shift
+        if [ &quot;$next_method&quot; = 'final' ]; then
+            do_branch=true
+        fi
+        ;;
+    --next-beta )
+        next_method2=$(echo &quot;x$1&quot; | sed -e 's|^x--next-||')
+        shift
+        ;;
+    --branch )
+        do_branch=true
+        warn_branch=true
+        shift
+        ;;
+    --no-upload )
+        do_upload=false
+        shift
+        ;;
+    --no-update )
+        do_update=false
+        shift
+        ;;
+    --verbose )
+        VERBOSE=echo
+        git_quiet=
+        shift
+        ;;
+    --debug )
+        DEBUG=echo
+        do_upload=false
+        shift
+        ;;
+    --local-user )
+        shift
+        tagley=&quot; -u $1&quot;
+        gpgkey=&quot; -u $1&quot;
+        shift
+        ;;
+    --force )
+        force=true
+        shift
+        ;;
+    --help )
+        usage
+        exit 0
+        ;;
+    --manual )
+        sed -e '1,/^### BEGIN MANUAL/d' \
+            -e '/^### END MANUAL/,$d' \
+            &lt; &quot;$0&quot; \
+            | pod2man \
+            | man -l -
+        exit 0
+        ;;
+    -- )
+        shift
+        break
+        ;;
+    * )
+        echo &gt;&amp;2 &quot;Unknown option $1&quot;
+        shift
+        exit 1
+        ;;
+    esac
+done
+
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$next_method=$next_method&quot;
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$next_method2=$next_method2&quot;
+
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$do_branch=$do_branch&quot;
+
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$do_upload=$do_upload&quot;
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$do_update=$do_update&quot;
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$DEBUG=$DEBUG&quot;
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$VERBOSE=$VERBOSE&quot;
+$DEBUG &gt;&amp;2 &quot;DEBUG: \$git_quiet=$git_quiet&quot;
+
+case &quot;$next_method+$next_method2&quot; in
+    major+major | minor+minor )
+        # These are expected
+        ;;
+    alpha+alpha | alpha+beta | beta+beta | final+final | + | +beta )
+        # These are expected
+        ;;
+    * )
+        echo &gt;&amp;2 &quot;Internal option error ($next_method, $next_method2)&quot;
+        exit 1
+        ;;
+esac
+
+# Verbosity feed for certain commands
+VERBOSITY_FIFO=/tmp/openssl-$$.fifo
+mkfifo -m 600 $VERBOSITY_FIFO
+( cat $VERBOSITY_FIFO | while read L; do $VERBOSE &quot;&gt; $L&quot;; done ) &amp;
+exec 42&gt;$VERBOSITY_FIFO
+trap &quot;exec 42&gt;&amp;-; rm $VERBOSITY_FIFO&quot; 0 2
+
+# Setup ##############################################################
+
+# Make sure we're in the work directory
+cd $(dirname $0)/..
+HERE=$(pwd)
+
+# Check that we have the scripts that define functions we use
+found=true
+for fn in &quot;$HERE/dev/release-aux/release-version-fn.sh&quot; \
+          &quot;$HERE/dev/release-aux/release-state-fn.sh&quot;; do
+    if ! [ -f &quot;$fn&quot; ]; then
+        echo &gt;&amp;2 &quot;'$fn' is missing&quot;
+        found=false
+    fi
+done
+if ! $found; then
+    exit 1
+fi
+
+# Load version functions
+. $HERE/dev/release-aux/release-version-fn.sh
+. $HERE/dev/release-aux/release-state-fn.sh
+
+# Make sure it's a branch we recognise
+orig_branch=$(git rev-parse --abbrev-ref HEAD)
+if (echo &quot;$orig_branch&quot; \
+        | grep -E -q \
+               -e '^master$' \
+               -e '^OpenSSL_[0-9]+_[0-9]+_[0-9]+[a-z]*-stable$' \
+               -e '^openssl-[0-9]+\.[0-9]+\.x$'); then
+    :
+elif $force; then
+    :
+else
+    echo &gt;&amp;2 &quot;Not in master or any recognised release branch&quot;
+    echo &gt;&amp;2 &quot;Please 'git checkout' an approprite branch&quot;
+    exit 1
+fi
+
+# Initialize #########################################################
+
+echo &quot;== Initializing work tree&quot;
+
+get_version
+
+# Generate a cloned directory name
+clone_branch=&quot;openssl-$SERIES.x&quot;
+release_clone=&quot;$clone_branch-release-tmp&quot;
+
+echo &quot;== Work tree will be in $release_clone&quot;
+
+# Make a clone in a subdirectory and move there
+if ! [ -d &quot;$release_clone&quot; ]; then
+    $VERBOSE &quot;== Cloning to $release_clone&quot;
+    git clone $git_quiet -b &quot;$orig_branch&quot; . &quot;$release_clone&quot;
+fi
+cd &quot;$release_clone&quot;
+
+get_version
+
+current_branch=&quot;$(git rev-parse --abbrev-ref HEAD)&quot;
+new_branch=&quot;openssl-$SERIES.x&quot;
+
+# Check that we're still on the same branch, or on a release branch
+if [ &quot;$current_branch&quot; = &quot;$orig_branch&quot; ]; then
+    :
+elif [ &quot;$current_branch&quot; = &quot;$new_branch&quot; ]; then
+    :
+else
+   echo &gt;&amp;2 &quot;The cloned sub-directory '$release_clone' is on a branch&quot;
+   echo &gt;&amp;2 &quot;other than '$current_branch' or '$new_branch'&quot;
+   echo &gt;&amp;2 &quot;Please 'cd \&quot;$(pwd)\&quot;; git checkout $current_branch'&quot;
+   exit 1
+fi
+
+if $do_branch; then
+    if [ &quot;$current_branch&quot; = &quot;$new_branch&quot; ]; then
+        do_branch=false
+    fi
+    if ! $do_branch &amp;&amp; $warn_branch; then
+        echo &gt;&amp;2 &quot;Warning: --branch ignored, we're already in a release branch&quot;
+    fi
+fi
+
+SOURCEDIR=$(pwd)
+$DEBUG &gt;&amp;2 &quot;DEBUG: Source directory is $SOURCEDIR&quot;
+
+# Release ############################################################
+
+# We always expect to start from a state of development
+if [ &quot;$TYPE&quot; != 'dev' ]; then
+    echo &gt;&amp;2 &quot;Not in a development branch&quot;
+    echo &gt;&amp;2 &quot;Have a look at the git log in $release_clone, it may be that&quot;
+    echo &gt;&amp;2 &quot;a previous crash left it in an intermediate state and that&quot;
+    echo &gt;&amp;2 &quot;need to drop the top commit:&quot;
+    echo &gt;&amp;2 &quot;&quot;
+    echo &gt;&amp;2 &quot;(cd $release_clone; git reset --hard HEAD^)&quot;
+    echo &gt;&amp;2 &quot;# WARNING! LOOK BEFORE YOU ACT&quot;
+    exit 1
+fi
+
+# We only create a release branch if the patch number is zero
+if [ $PATCH -ne 0 ]; then
+    if $do_branch; then
+        echo &gt;&amp;2 &quot;Warning! We're already in a release branch; --branch ignored&quot;
+    fi
+    do_branch=false
+fi
+
+# Update the version information.  This won't save anything anywhere, yet,
+# but does check for possible next_method errors before we do bigger work.
+next_release_state &quot;$next_method&quot;
+
+if $do_branch; then
+    $VERBOSE &quot;== Creating a release branch: $new_branch&quot;
+    git checkout $git_quiet -b &quot;$new_branch&quot;
+fi
+
+echo &quot;== Configuring OpenSSL for update and release.  This may take a bit of time&quot;
+
+./Configure cc &gt;&amp;42
+
+$VERBOSE &quot;== Checking source file updates&quot;
+
+make update &gt;&amp;42
+
+if [ -n &quot;$(git status --porcelain)&quot; ]; then
+    $VERBOSE &quot;== Committing updates&quot;
+    git add -u
+    git commit $git_quiet -m 'make update'
+fi
+
+# Write the version information we updated
+set_version
+
+if [ -n &quot;$PRE_LABEL&quot; ]; then
+    release=&quot;$VERSION-$PRE_RELEASE_TAG$BUILD_METADATA&quot;
+    release_text=&quot;$SERIES$BUILD_METADATA $PRE_LABEL $PRE_NUM&quot;
+    announce_template=openssl-announce-pre-release.tmpl
+else
+    release=&quot;$VERSION$BUILD_METADATA&quot;
+    release_text=&quot;$release&quot;
+    announce_template=openssl-announce-release.tmpl
+fi
+tag=&quot;openssl-$release&quot;
+$VERBOSE &quot;== Updated version information to $release&quot;
+
+$VERBOSE &quot;== Updating files with release date for $release : $RELEASE_DATE&quot;
+for fixup in &quot;$HERE/dev/release-aux&quot;/fixup-*-release.pl; do
+    file=&quot;$(basename &quot;$fixup&quot; | sed -e 's|^fixup-||' -e 's|-release\.pl$||')&quot;
+    $VERBOSE &quot;&gt; $file&quot;
+    RELEASE=&quot;$release&quot; RELEASE_TEXT=&quot;$release_text&quot; RELEASE_DATE=&quot;$RELEASE_DATE&quot; \
+        perl -pi $fixup $file
+done
+
+$VERBOSE &quot;== Comitting updates and tagging&quot;
+git add -u
+git commit $git_quiet -m &quot;Prepare for release of $release_text&quot;
+echo &quot;Tagging release with tag $tag.  You may need to enter a pass phrase&quot;
+git tag$tagkey &quot;$tag&quot; -m &quot;OpenSSL $release release tag&quot;
+
+tarfile=openssl-$release.tar
+tgzfile=$tarfile.gz
+announce=openssl-$release.txt
+
+echo &quot;== Generating tar, hash and announcement files.  This make take a bit of time&quot;
+
+$VERBOSE &quot;== Making tarfile: $tgzfile&quot;
+# Unfortunately, util/mktar.sh does verbose output on STDERR...  for good
+# reason, but it means we don't display errors unless --verbose
+./util/mktar.sh --tarfile=&quot;../$tarfile&quot; 2&gt;&amp;1 \
+    | while read L; do $VERBOSE &quot;&gt; $L&quot;; done
+
+if ! [ -f &quot;../$tgzfile&quot; ]; then
+    echo &gt;&amp;2 &quot;Where did the tarball end up? (../$tgzfile)&quot;
+    exit 1
+fi
+
+$VERBOSE &quot;== Generating checksums: $tgzfile.sha1 $tgzfile.sha256&quot;
+openssl sha1 &lt; &quot;../$tgzfile&quot; | \
+    (IFS='='; while read X H; do echo $H; done) &gt; &quot;../$tgzfile.sha1&quot;
+openssl sha256 &lt; &quot;../$tgzfile&quot; | \
+    (IFS='='; while read X H; do echo $H; done) &gt; &quot;../$tgzfile.sha256&quot;
+length=$(wc -c &lt; &quot;../$tgzfile&quot;)
+sha1hash=$(cat &quot;../$tgzfile.sha1&quot;)
+sha256hash=$(cat &quot;../$tgzfile.sha256&quot;)
+
+$VERBOSE &quot;== Generating announcement text: $announce&quot;
+# Hack the announcement template
+cat &quot;$HERE/dev/release-aux/$announce_template&quot; \
+    | sed -e &quot;s|\\\$release_text|$release_text|g&quot; \
+          -e &quot;s|\\\$release|$release|g&quot; \
+          -e &quot;s|\\\$series|$SERIES|g&quot; \
+          -e &quot;s|\\\$label|$PRE_LABEL|g&quot; \
+          -e &quot;s|\\\$tarfile|$tgzfile|&quot; \
+          -e &quot;s|\\\$length|$length|&quot; \
+          -e &quot;s|\\\$sha1hash|$sha1hash|&quot; \
+          -e &quot;s|\\\$sha256hash|$sha256hash|&quot; \
+    | perl -p &quot;$HERE/dev/release-aux/fix-title.pl&quot; \
+    &gt; &quot;../$announce&quot;
+              
+$VERBOSE &quot;== Generating signatures: $tgzfile.asc $announce.asc&quot;
+rm -f &quot;../$tgzfile.asc&quot; &quot;../$announce.asc&quot;
+echo &quot;Signing the release files.  You may need to enter a pass phrase&quot;
+gpg$gpgkey --use-agent -sba &quot;../$tgzfile&quot;
+gpg$gpgkey --use-agent -sta --clearsign &quot;../$announce&quot;
+
+# We finish off by resetting all files, so we don't have to update
+# files with release dates again
+$VERBOSE &quot;== Reset all files to their pre-commit contents&quot;
+git reset $git_quiet HEAD^ -- .
+git checkout -- .
+
+if $do_upload; then
+    (
+        if [ &quot;$VERBOSE&quot; != ':' ]; then
+            echo &quot;progress&quot;
+        fi
+        echo &quot;put ../$tgzfile&quot;
+        echo &quot;put ../$tgzfile.sha1&quot;
+        echo &quot;put ../$tgzfile.sha256&quot;
+        echo &quot;put ../$tgzfile.asc&quot;
+        echo &quot;put ../$announce.asc&quot;
+    ) \
+    | sftp &quot;$upload_address&quot;
+fi
+
+# Post-release #######################################################
+
+prev_release_text=&quot;$release_text&quot;
+prev_release_date=&quot;$RELEASE_DATE&quot;
+
+next_release_state &quot;$next_method2&quot;
+set_version
+
+release=&quot;$VERSION-$PRE_RELEASE_TAG$BUILD_METADATA&quot;
+release_text=&quot;$VERSION$BUILD_METADATA&quot;
+if [ -n &quot;$PRE_LABEL&quot; ]; then
+    release_text=&quot;$SERIES$BUILD_METADATA $PRE_LABEL $PRE_NUM&quot;
+fi
+$VERBOSE &quot;== Updated version information to $release&quot;
+
+$VERBOSE &quot;== Updating files for $release :&quot;
+for fixup in &quot;$HERE/dev/release-aux&quot;/fixup-*-postrelease.pl; do
+    file=&quot;$(basename &quot;$fixup&quot; | sed -e 's|^fixup-||' -e 's|-postrelease\.pl$||')&quot;
+    $VERBOSE &quot;&gt; $file&quot;
+    RELEASE=&quot;$release&quot; RELEASE_TEXT=&quot;$release_text&quot; \
+        PREV_RELEASE_TEXT=&quot;$prev_release_text&quot; \
+        PREV_RELEASE_DATE=&quot;$prev_release_date&quot; \
+        perl -pi $fixup $file
+done
+
+$VERBOSE &quot;== Comitting updates&quot;
+git add -u
+git commit $git_quiet -m &quot;Prepare for $release_text&quot;
+
+if $do_branch; then
+    $VERBOSE &quot;== Going back to the main branch $current_branch&quot;
+    git checkout $git_quiet &quot;$current_branch&quot;
+
+    get_version
+    next_release_state &quot;minor&quot;
+    set_version
+
+    release=&quot;$VERSION-$PRE_RELEASE_TAG$BUILD_METADATA&quot;
+    release_text=&quot;$SERIES$BUILD_METADATA&quot;
+    $VERBOSE &quot;== Updated version information to $release&quot;
+
+    $VERBOSE &quot;== Updating files for $release :&quot;
+    for fixup in &quot;$HERE/dev/release-aux&quot;/fixup-*-postrelease.pl; do
+        file=&quot;$(basename &quot;$fixup&quot; | sed -e 's|^fixup-||' -e 's|-postrelease\.pl$||')&quot;
+        $VERBOSE &quot;&gt; $file&quot;
+        RELEASE=&quot;$release&quot; RELEASE_TEXT=&quot;$release_text&quot; \
+            perl -pi $fixup $file
+    done
+
+    $VERBOSE &quot;== Comitting updates&quot;
+    git add -u
+    git commit $git_quiet -m &quot;Prepare for $release_text&quot;
+fi
+
+# Done ###############################################################
+    
+$VERBOSE &quot;== Done&quot;
+
+cat &lt;&lt;EOF
+
+======================================================================
+The release is done, and involves a few commits for you to deal with.
+It has all been done in a clone of this workspace, see details below.
+EOF
+if $do_branch; then
+    cat &lt;&lt;EOF
+Additionally, a release branch has been created for you, so you need
+to look for new commits in two places.
+EOF
+fi
+
+if $do_release; then
+    cat &lt;&lt;EOF
+
+These files were uploaded to $upload_address:
+
+    ../$tgzfile
+    ../$tgzfile.sha1
+    ../$tgzfile.sha256
+    ../$tgzfile.asc
+    ../$announce.asc
+EOF
+fi
+
+cat &lt;&lt;EOF
+
+Release worktree:   $release_clone
+EOF
+if [ &quot;$current_branch&quot; != &quot;$new_branch&quot; ]; then
+    cat &lt;&lt;EOF
+Current branch:     $current_branch
+EOF
+fi
+if $do_branch; then
+    cat &lt;&lt;EOF
+New release branch: $new_branch
+EOF
+fi
+
+cat &lt;&lt;EOF
+======================================================================
+EOF
+
+cat &lt;&lt;EOF
+If something went wrong and you want to start over, all you need is to
+remove the release worktree:
+
+    rm -rf $release_clone
+
+If a tarball was uploaded, you must also clean that away, or ask you
+kind OpenSSL sysadmin to do so.
+EOF
+
+exit 0
+
+# cat is inconsequential, it's only there to fend off zealous shell parsers
+# that parse all the way here.
+cat &lt;&lt;EOF
+### BEGIN MANUAL
+=pod
+
+=head1 NAME
+
+release.sh - OpenSSL release script
+
+=head1 SYNOPSIS
+
+B&lt;release.sh&gt;
+[
+B&lt;--alpha&gt; |
+B&lt;--next-beta&gt; |
+B&lt;--beta&gt; |
+B&lt;--final&gt; |
+B&lt;--branch&gt; |
+B&lt;--local-user&gt;=I&lt;keyid&gt; |
+B&lt;--no-upload&gt; |
+B&lt;--no-update&gt; |
+B&lt;--verbose&gt; |
+B&lt;--debug&gt; |
+B&lt;--help&gt; |
+B&lt;--manual&gt;
+]
+
+=head1 DESCRIPTION
+
+B&lt;release.sh&gt; creates an OpenSSL release, given current worktree conditions.
+It will refuse to work unless the current branch is C&lt;master&gt; or a release
+branch (see L&lt;/RELEASE BRANCHES AND TAGS&gt; below for a discussion on those).
+
+B&lt;release.sh&gt; tries to be smart and figure out the next release if no hints
+are given through options, and will exit with an error in ambiguous cases.
+
+B&lt;release.sh&gt; always clones the current workspace into a sub-directory
+named C&lt;&lt; openssl-I&lt;SERIES&gt;-tmp &gt;&gt;, where C&lt;&lt; I&lt;SERIES&gt; &gt;&gt; is taken from
+the available version information in the source.
+
+=head1 OPTIONS
+
+=over 4
+
+=item B&lt;--alpha&gt;, B&lt;--beta&gt;
+
+Set the state of this branch to indicate that alpha or beta releases are
+to be done.
+
+B&lt;--alpha&gt; is only acceptable if the I&lt;PATCH&gt; version number is zero and
+the current state is &quot;in development&quot; or that alpha releases are ongoing.
+
+B&lt;--beta&gt; is only acceptable if the I&lt;PATCH&gt; version number is zero and
+that alpha or beta releases are ongoing.
+
+=item B&lt;--next-beta&gt;
+
+Use together with B&lt;--alpha&gt; to switch to beta releases after the current
+release is done.
+
+=item B&lt;--final&gt;
+
+Set the state of this branch to indicate that regular releases are to be
+done.  This is only valid if alpha or beta releases are currently ongoing.
+
+This implies B&lt;--branch&gt;.
+
+=item B&lt;--branch&gt;
+
+Create a branch specific for the I&lt;SERIES&gt;.x release series, if it doesn't
+already exist, and switch to it.  The exact branch name will be
+C&lt;&lt; openssl-I&lt;SERIES&gt;.x &gt;&gt;.
+
+=item B&lt;--no-upload&gt;
+
+Don't upload the produced files.
+
+=item B&lt;--no-update&gt;
+
+Don't run C&lt;make update&gt;.
+
+=item B&lt;--verbose&gt;
+
+Verbose output.
+
+=item B&lt;--debug&gt;
+
+Display extra debug output.  Implies B&lt;--no-upload&gt;
+
+=item B&lt;--local-user&gt;=I&lt;keyid&gt;
+
+Use I&lt;keyid&gt; as the local user for C&lt;git tag&gt; and for signing with C&lt;gpg&gt;.
+
+If not given, then the default e-mail address' key is used.
+
+=item B&lt;--force&gt;
+
+Force execution.  Precisely, the check that the current branch is C&lt;master&gt;
+or a release branch is not done.
+
+=item B&lt;--help&gt;
+
+Display a quick help text and exit.
+
+=item B&lt;--manual&gt;
+
+Display this manual and exit.
+
+=back
+
+=head1 RELEASE BRANCHES AND TAGS
+
+Prior to OpenSSL 3.0, the release branches were named
+C&lt;&lt; OpenSSL_I&lt;SERIES&gt;-stable &gt;&gt;, and the release tags were named
+C&lt;&lt; OpenSSL_I&lt;VERSION&gt; &gt;&gt; for regular releases, or
+C&lt;&lt; OpenSSL_I&lt;VERSION&gt;-preI&lt;n&gt; &gt;&gt; for pre-releases.
+
+From OpenSSL 3.0 ongoing, the release branches are named
+C&lt;&lt; openssl-I&lt;SERIES&gt;.x &gt;&gt;, and the release tags are named
+C&lt;&lt; openssl-I&lt;VERSION&gt; &gt;&gt; for regular releases, or
+C&lt;&lt; openssl-I&lt;VERSION&gt;-alphaI&lt;n&gt; &gt;&gt; for alpha releases
+and C&lt;&lt; openssl-I&lt;VERSION&gt;-betaI&lt;n&gt; &gt;&gt; for beta releases.
+
+B&lt;release.sh&gt; recognises both forms.
+
+=head1 VERSION AND STATE
+
+With OpenSSL 3.0, all the version and state information is in the file
+F&lt;VERSION&gt;, where the following variables are used and changed:
+
+=over 4
+
+=item B&lt;MAJOR&gt;, B&lt;MINOR&gt;, B&lt;PATCH&gt;
+
+The three part of the version number.
+
+=item B&lt;PRE_RELEASE_TAG&gt;
+
+The indicator of the current state of the branch.  The value may be one pf:
+
+=over 4
+
+=item C&lt;dev&gt;
+
+This branch is &quot;in development&quot;.  This is typical for the C&lt;master&gt; branch
+unless there are ongoing alpha or beta releases.
+
+=item C&lt;&lt; alphaI&lt;n&gt; &gt;&gt; or C&lt;&lt; alphaI&lt;n&gt;-dev &gt;&gt;
+
+This branch has alpha releases going on.  C&lt;&lt; alphaI&lt;n&gt;-dev &gt;&gt; is what
+should normally be seen in the git workspace, indicating that
+C&lt;&lt; alphaI&lt;n&gt; &gt;&gt; is in development.  C&lt;&lt; alphaI&lt;n&gt; &gt;&gt; is what should be
+found in the alpha release tar file.
+
+=item C&lt;&lt; alphaI&lt;n&gt; &gt;&gt; or C&lt;&lt; alphaI&lt;n&gt;-dev &gt;&gt;
+
+This branch has beta releases going on.  The details are otherwise exactly
+as for alpha.
+
+=item I&lt;no value&gt;
+
+This is normally not seen in the git workspace, but should always be what's
+found in the tar file of a regular release.
+
+=back
+
+=item B&lt;RELEASE_DATE&gt;
+
+This is normally empty in the git workspace, but should always have the
+release date in the tar file of any release.
+
+=back
+
+=head1 COPYRIGHT
+
+Copyright 2020 The OpenSSL Project Authors. All Rights Reserved.
+
+Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+this file except in compliance with the License.  You can obtain a copy
+in the file LICENSE in the source distribution or at
+L&lt;<A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>&gt;.
+
+=cut
+### END MANUAL
+EOF
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028398.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="028414.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28402">[ date ]</a>
              <a href="thread.html#28402">[ thread ]</a>
              <a href="subject.html#28402">[ subject ]</a>
              <a href="author.html#28402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
