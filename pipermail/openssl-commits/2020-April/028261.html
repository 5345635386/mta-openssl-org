<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  OpenSSL_1_1_1-stable update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20OpenSSL_1_1_1-stable%20update&In-Reply-To=%3C1586716199.055255.31357.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028254.html">
   <LINK REL="Next"  HREF="028272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  OpenSSL_1_1_1-stable update</H1>
    <B>bernd.edlinger at hotmail.de</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20OpenSSL_1_1_1-stable%20update&In-Reply-To=%3C1586716199.055255.31357.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  OpenSSL_1_1_1-stable update">bernd.edlinger at hotmail.de
       </A><BR>
    <I>Sun Apr 12 18:29:59 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="028254.html">[openssl]  OpenSSL_1_1_1-stable update
</A></li>
        <LI>Next message: <A HREF="028272.html">[openssl]  OpenSSL_1_1_1-stable update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28261">[ date ]</a>
              <a href="thread.html#28261">[ thread ]</a>
              <a href="subject.html#28261">[ subject ]</a>
              <a href="author.html#28261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch OpenSSL_1_1_1-stable has been updated
       via  369cef760364a88aafa68afd406328e20689b5e2 (commit)
      from  07e2f4b2aabdc5709ae055b226fb54d9d21c631e (commit)


- Log -----------------------------------------------------------------
commit 369cef760364a88aafa68afd406328e20689b5e2
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at akamai.com</A>&gt;
Date:   Fri Apr 10 11:51:02 2020 -0400

    Don't compile commands if disabled
    
    Rather than wrapping whole files in &quot;ifndef OPENSSL_NO_xxx&quot; we handle
    the changes in build.info
    
    Reviewed-by: Kurt Roeckx &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">kurt at roeckx.be</A>&gt;
    Reviewed-by: Bernd Edlinger &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">bernd.edlinger at hotmail.de</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11518">https://github.com/openssl/openssl/pull/11518</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/build.info |  61 +++++++++++++++++----
 apps/dhparam.c  |  61 ++++++++++-----------
 apps/dsa.c      |  53 +++++++++---------
 apps/dsaparam.c |  33 +++++-------
 apps/ec.c       |  27 ++++------
 apps/ecparam.c  |  34 +++++-------
 apps/engine.c   |  23 ++++----
 apps/gendsa.c   |  33 +++++-------
 apps/genrsa.c   |  43 +++++++--------
 apps/ocsp.c     | 163 +++++++++++++++++++++++++++-----------------------------
 apps/pkcs12.c   |  52 ++++++++----------
 apps/rsa.c      |  57 +++++++++-----------
 apps/rsautl.c   |  35 ++++++------
 apps/srp.c      |  39 ++++++--------
 apps/ts.c       |  46 ++++++++--------
 15 files changed, 365 insertions(+), 395 deletions(-)

diff --git a/apps/build.info b/apps/build.info
index 751d8da828..0153736182 100644
--- a/apps/build.info
+++ b/apps/build.info
@@ -1,16 +1,17 @@
 {- our @apps_openssl_src =
        qw(openssl.c
-          asn1pars.c ca.c ciphers.c cms.c crl.c crl2p7.c dgst.c dhparam.c
-          dsa.c dsaparam.c ec.c ecparam.c enc.c engine.c errstr.c gendsa.c
-          genpkey.c genrsa.c nseq.c ocsp.c passwd.c pkcs12.c pkcs7.c pkcs8.c
-          pkey.c pkeyparam.c pkeyutl.c prime.c rand.c req.c rsa.c rsautl.c
+          asn1pars.c ca.c ciphers.c cms.c crl.c crl2p7.c dgst.c
+          enc.c errstr.c
+          genpkey.c nseq.c passwd.c pkcs7.c pkcs8.c
+          pkey.c pkeyparam.c pkeyutl.c prime.c rand.c req.c
           s_client.c s_server.c s_time.c sess_id.c smime.c speed.c spkac.c
-          srp.c ts.c verify.c version.c x509.c rehash.c storeutl.c);
+          verify.c version.c x509.c rehash.c storeutl.c);
    our @apps_lib_src =
        ( qw(apps.c opt.c s_cb.c s_socket.c app_rand.c bf_prefix.c),
          split(/\s+/, $target{apps_aux_src}) );
    our @apps_init_src = split(/\s+/, $target{apps_init_src});
    &quot;&quot; -}
+
 IF[{- !$disabled{apps} -}]
   LIBS_NO_INST=libapps.a
   SOURCE[libapps.a]={- join(&quot; &quot;, @apps_lib_src) -}
@@ -21,11 +22,51 @@ IF[{- !$disabled{apps} -}]
   SOURCE[openssl]={- join(&quot; &quot;, @apps_openssl_src) -}
   INCLUDE[openssl]=.. ../include
   DEPEND[openssl]=libapps.a ../libssl
-
-IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
-  GENERATE[openssl.rc]=../util/mkrc.pl openssl
-  SOURCE[openssl]=openssl.rc
-ENDIF
+  IF[{- !$disabled{'des'} -}]
+    SOURCE[openssl]=pkcs12.c
+    DEPEND[pkcs12.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'ec'} -}]
+    SOURCE[openssl]=ec.c ecparam.c
+    DEPEND[ec.o]=progs.h
+    DEPEND[ecparam.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'ocsp'} -}]
+    SOURCE[openssl]=ocsp.c
+    DEPEND[ocsp.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'srp'} -}]
+    SOURCE[openssl]=srp.c
+    DEPEND[srp.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'ts'} -}]
+    SOURCE[openssl]=ts.c
+    DEPEND[ts.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'dh'} -}]
+    SOURCE[openssl]=dhparam.c
+    DEPEND[dhparam.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'dsa'} -}]
+    SOURCE[openssl]=dsa.c dsaparam.c gendsa.c
+    DEPEND[dsa.o]=progs.h
+    DEPEND[dsaparam.o]=progs.h
+    DEPEND[gendsa.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'engine'} -}]
+    SOURCE[openssl]=engine.c
+    DEPEND[engine.o]=progs.h
+  ENDIF
+  IF[{- !$disabled{'rsa'} -}]
+    SOURCE[openssl]=rsa.c rsautl.c genrsa.c
+    DEPEND[rsa.o]=progs.h
+    DEPEND[rsautl.o]=progs.h
+    DEPEND[genrsa.o]=progs.h
+  ENDIF
+  IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
+    GENERATE[openssl.rc]=../util/mkrc.pl openssl
+    SOURCE[openssl]=openssl.rc
+  ENDIF
 
   {- join(&quot;\n  &quot;, map { (my $x = $_) =~ s|\.c$|.o|; &quot;DEPEND[$x]=progs.h&quot; }
                   @apps_openssl_src) -}
diff --git a/apps/dhparam.c b/apps/dhparam.c
index 13f76754d2..11fc3f6bd2 100644
--- a/apps/dhparam.c
+++ b/apps/dhparam.c
@@ -8,28 +8,24 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_DH
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;time.h&gt;
-# include &lt;string.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/bn.h&gt;
-# include &lt;openssl/dh.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
-
-# ifndef OPENSSL_NO_DSA
-#  include &lt;openssl/dsa.h&gt;
-# endif
-
-# define DEFBITS 2048
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;time.h&gt;
+#include &lt;string.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/bn.h&gt;
+#include &lt;openssl/dh.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
+
+#ifndef OPENSSL_NO_DSA
+# include &lt;openssl/dsa.h&gt;
+#endif
+
+#define DEFBITS 2048
 
 static int dh_cb(int p, int n, BN_GENCB *cb);
 
@@ -56,13 +52,13 @@ const OPTIONS dhparam_options[] = {
     {&quot;C&quot;, OPT_C, '-', &quot;Print C code&quot;},
     {&quot;2&quot;, OPT_2, '-', &quot;Generate parameters using 2 as the generator value&quot;},
     {&quot;5&quot;, OPT_5, '-', &quot;Generate parameters using 5 as the generator value&quot;},
-# ifndef OPENSSL_NO_DSA
+#ifndef OPENSSL_NO_DSA
     {&quot;dsaparam&quot;, OPT_DSAPARAM, '-',
      &quot;Read or generate DSA parameters, convert to DH&quot;},
-# endif
-# ifndef OPENSSL_NO_ENGINE
+#endif
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine e, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -146,13 +142,13 @@ int dhparam_main(int argc, char **argv)
     if (g &amp;&amp; !num)
         num = DEFBITS;
 
-# ifndef OPENSSL_NO_DSA
+#ifndef OPENSSL_NO_DSA
     if (dsaparam &amp;&amp; g) {
         BIO_printf(bio_err,
                    &quot;generator may not be chosen for DSA parameters\n&quot;);
         goto end;
     }
-# endif
+#endif
 
     out = bio_open_default(outfile, 'w', outformat);
     if (out == NULL)
@@ -173,7 +169,7 @@ int dhparam_main(int argc, char **argv)
 
         BN_GENCB_set(cb, dh_cb, bio_err);
 
-# ifndef OPENSSL_NO_DSA
+#ifndef OPENSSL_NO_DSA
         if (dsaparam) {
             DSA *dsa = DSA_new();
 
@@ -196,7 +192,7 @@ int dhparam_main(int argc, char **argv)
                 goto end;
             }
         } else
-# endif
+#endif
         {
             dh = DH_new();
             BIO_printf(bio_err,
@@ -217,7 +213,7 @@ int dhparam_main(int argc, char **argv)
         if (in == NULL)
             goto end;
 
-# ifndef OPENSSL_NO_DSA
+#ifndef OPENSSL_NO_DSA
         if (dsaparam) {
             DSA *dsa;
 
@@ -239,7 +235,7 @@ int dhparam_main(int argc, char **argv)
                 goto end;
             }
         } else
-# endif
+#endif
         {
             if (informat == FORMAT_ASN1) {
                 /*
@@ -376,4 +372,3 @@ static int dh_cb(int p, int n, BN_GENCB *cb)
     (void)BIO_flush(BN_GENCB_get_arg(cb));
     return 1;
 }
-#endif
diff --git a/apps/dsa.c b/apps/dsa.c
index 6022e64cd4..fb59e1b4c0 100644
--- a/apps/dsa.c
+++ b/apps/dsa.c
@@ -8,23 +8,19 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_DSA
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &lt;time.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/dsa.h&gt;
-# include &lt;openssl/evp.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
-# include &lt;openssl/bn.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;time.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/dsa.h&gt;
+#include &lt;openssl/evp.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
+#include &lt;openssl/bn.h&gt;
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -49,14 +45,14 @@ const OPTIONS dsa_options[] = {
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
-# ifndef OPENSSL_NO_RC4
+#ifndef OPENSSL_NO_RC4
     {&quot;pvk-strong&quot;, OPT_PVK_STRONG, '-', &quot;Enable 'Strong' PVK encoding level (default)&quot;},
     {&quot;pvk-weak&quot;, OPT_PVK_WEAK, '-', &quot;Enable 'Weak' PVK encoding level&quot;},
     {&quot;pvk-none&quot;, OPT_PVK_NONE, '-', &quot;Don't enforce PVK encoding&quot;},
-# endif
-# ifndef OPENSSL_NO_ENGINE
+#endif
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine e, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -71,9 +67,9 @@ int dsa_main(int argc, char **argv)
     OPTION_CHOICE o;
     int informat = FORMAT_PEM, outformat = FORMAT_PEM, text = 0, noout = 0;
     int i, modulus = 0, pubin = 0, pubout = 0, ret = 1;
-# ifndef OPENSSL_NO_RC4
+#ifndef OPENSSL_NO_RC4
     int pvk_encr = 2;
-# endif
+#endif
     int private = 0;
 
     prog = opt_init(argc, argv, dsa_options);
@@ -214,7 +210,7 @@ int dsa_main(int argc, char **argv)
             i = PEM_write_bio_DSAPrivateKey(out, dsa, enc,
                                             NULL, 0, NULL, passout);
         }
-# ifndef OPENSSL_NO_RSA
+#ifndef OPENSSL_NO_RSA
     } else if (outformat == FORMAT_MSBLOB || outformat == FORMAT_PVK) {
         EVP_PKEY *pk;
         pk = EVP_PKEY_new();
@@ -229,13 +225,13 @@ int dsa_main(int argc, char **argv)
                 goto end;
             }
             assert(private);
-#  ifdef OPENSSL_NO_RC4
+# ifdef OPENSSL_NO_RC4
             BIO_printf(bio_err, &quot;PVK format not supported\n&quot;);
             EVP_PKEY_free(pk);
             goto end;
-#  else
+# else
             i = i2b_PVK_bio(out, pk, pvk_encr, 0, passout);
-#  endif
+# endif
         } else if (pubin || pubout) {
             i = i2b_PublicKey_bio(out, pk);
         } else {
@@ -243,7 +239,7 @@ int dsa_main(int argc, char **argv)
             i = i2b_PrivateKey_bio(out, pk);
         }
         EVP_PKEY_free(pk);
-# endif
+#endif
     } else {
         BIO_printf(bio_err, &quot;bad output format specified for outfile\n&quot;);
         goto end;
@@ -262,4 +258,3 @@ int dsa_main(int argc, char **argv)
     OPENSSL_free(passout);
     return ret;
 }
-#endif
diff --git a/apps/dsaparam.c b/apps/dsaparam.c
index b227b76a37..ba00bee02b 100644
--- a/apps/dsaparam.c
+++ b/apps/dsaparam.c
@@ -8,22 +8,18 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_DSA
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;time.h&gt;
-# include &lt;string.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/bn.h&gt;
-# include &lt;openssl/dsa.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;time.h&gt;
+#include &lt;string.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/bn.h&gt;
+#include &lt;openssl/dsa.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
 
 static int dsa_cb(int p, int n, BN_GENCB *cb);
 
@@ -44,9 +40,9 @@ const OPTIONS dsaparam_options[] = {
     {&quot;noout&quot;, OPT_NOOUT, '-', &quot;No output&quot;},
     {&quot;genkey&quot;, OPT_GENKEY, '-', &quot;Generate a DSA key&quot;},
     OPT_R_OPTIONS,
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine e, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -255,4 +251,3 @@ static int dsa_cb(int p, int n, BN_GENCB *cb)
     (void)BIO_flush(BN_GENCB_get_arg(cb));
     return 1;
 }
-#endif
diff --git a/apps/ec.c b/apps/ec.c
index 03abb00683..f48ffbe1b3 100644
--- a/apps/ec.c
+++ b/apps/ec.c
@@ -8,19 +8,15 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_EC
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/evp.h&gt;
-# include &lt;openssl/pem.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/evp.h&gt;
+#include &lt;openssl/pem.h&gt;
 
 static OPT_PAIR conv_forms[] = {
     {&quot;compressed&quot;, POINT_CONVERSION_COMPRESSED},
@@ -62,9 +58,9 @@ const OPTIONS ec_options[] = {
      &quot;Specifies the way the ec parameters are encoded&quot;},
     {&quot;conv_form&quot;, OPT_CONV_FORM, 's', &quot;Specifies the point conversion form &quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -280,4 +276,3 @@ int ec_main(int argc, char **argv)
     OPENSSL_free(passout);
     return ret;
 }
-#endif
diff --git a/apps/ecparam.c b/apps/ecparam.c
index 917f1a86b2..65ff660964 100644
--- a/apps/ecparam.c
+++ b/apps/ecparam.c
@@ -9,22 +9,18 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_EC
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;time.h&gt;
-# include &lt;string.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/bn.h&gt;
-# include &lt;openssl/ec.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;time.h&gt;
+#include &lt;string.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/bn.h&gt;
+#include &lt;openssl/ec.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -55,9 +51,9 @@ const OPTIONS ecparam_options[] = {
      &quot;Specifies the way the ec parameters are encoded&quot;},
     {&quot;genkey&quot;, OPT_GENKEY, '-', &quot;Generate ec key&quot;},
     OPT_R_OPTIONS,
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -446,5 +442,3 @@ int ecparam_main(int argc, char **argv)
     BIO_free_all(out);
     return ret;
 }
-
-#endif
diff --git a/apps/engine.c b/apps/engine.c
index 83f9588a0a..a00161ed29 100644
--- a/apps/engine.c
+++ b/apps/engine.c
@@ -8,19 +8,15 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_ENGINE
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/engine.h&gt;
-# include &lt;openssl/ssl.h&gt;
-# include &lt;openssl/store.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/engine.h&gt;
+#include &lt;openssl/ssl.h&gt;
+#include &lt;openssl/store.h&gt;
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -486,4 +482,3 @@ int engine_main(int argc, char **argv)
     BIO_free_all(out);
     return ret;
 }
-#endif
diff --git a/apps/gendsa.c b/apps/gendsa.c
index 401375420b..74540ffde5 100644
--- a/apps/gendsa.c
+++ b/apps/gendsa.c
@@ -8,22 +8,18 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_DSA
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;string.h&gt;
-# include &lt;sys/types.h&gt;
-# include &lt;sys/stat.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/bn.h&gt;
-# include &lt;openssl/dsa.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;string.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/bn.h&gt;
+#include &lt;openssl/dsa.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -39,9 +35,9 @@ const OPTIONS gendsa_options[] = {
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
     OPT_R_OPTIONS,
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Encrypt the output with any supported cipher&quot;},
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -143,4 +139,3 @@ int gendsa_main(int argc, char **argv)
     OPENSSL_free(passout);
     return ret;
 }
-#endif
diff --git a/apps/genrsa.c b/apps/genrsa.c
index c17cd14715..eff38b35ed 100644
--- a/apps/genrsa.c
+++ b/apps/genrsa.c
@@ -8,27 +8,23 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_RSA
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;string.h&gt;
-# include &lt;sys/types.h&gt;
-# include &lt;sys/stat.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/bn.h&gt;
-# include &lt;openssl/rsa.h&gt;
-# include &lt;openssl/evp.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
-# include &lt;openssl/rand.h&gt;
-
-# define DEFBITS 2048
-# define DEFPRIMES 2
+#include &lt;stdio.h&gt;
+#include &lt;string.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/bn.h&gt;
+#include &lt;openssl/rsa.h&gt;
+#include &lt;openssl/evp.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
+#include &lt;openssl/rand.h&gt;
+
+#define DEFBITS 2048
+#define DEFPRIMES 2
 
 static int genrsa_cb(int p, int n, BN_GENCB *cb);
 
@@ -48,9 +44,9 @@ const OPTIONS genrsa_options[] = {
     OPT_R_OPTIONS,
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Encrypt the output with any supported cipher&quot;},
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {&quot;primes&quot;, OPT_PRIMES, 'p', &quot;Specify number of primes&quot;},
     {NULL}
 };
@@ -198,4 +194,3 @@ static int genrsa_cb(int p, int n, BN_GENCB *cb)
     (void)BIO_flush(BN_GENCB_get_arg(cb));
     return 1;
 }
-#endif
diff --git a/apps/ocsp.c b/apps/ocsp.c
index b85a4d82c1..eb98c25310 100644
--- a/apps/ocsp.c
+++ b/apps/ocsp.c
@@ -9,65 +9,62 @@
 
 #include &lt;openssl/opensslconf.h&gt;
 
-#ifdef OPENSSL_NO_OCSP
-NON_EMPTY_TRANSLATION_UNIT
-#else
-# ifdef OPENSSL_SYS_VMS
-#  define _XOPEN_SOURCE_EXTENDED/* So fd_set and friends get properly defined
+#ifdef OPENSSL_SYS_VMS
+# define _XOPEN_SOURCE_EXTENDED/* So fd_set and friends get properly defined
                                  * on OpenVMS */
-# endif
+#endif
 
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &lt;time.h&gt;
-# include &lt;ctype.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;time.h&gt;
+#include &lt;ctype.h&gt;
 
 /* Needs to be included before the openssl headers */
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &quot;internal/sockets.h&quot;
-# include &lt;openssl/e_os2.h&gt;
-# include &lt;openssl/crypto.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/ssl.h&gt;
-# include &lt;openssl/evp.h&gt;
-# include &lt;openssl/bn.h&gt;
-# include &lt;openssl/x509v3.h&gt;
-# include &lt;openssl/rand.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &quot;internal/sockets.h&quot;
+#include &lt;openssl/e_os2.h&gt;
+#include &lt;openssl/crypto.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/ssl.h&gt;
+#include &lt;openssl/evp.h&gt;
+#include &lt;openssl/bn.h&gt;
+#include &lt;openssl/x509v3.h&gt;
+#include &lt;openssl/rand.h&gt;
 
 #ifndef HAVE_FORK
-# if defined(OPENSSL_SYS_VMS) || defined(OPENSSL_SYS_WINDOWS)
-#  define HAVE_FORK 0
-# else
-#  define HAVE_FORK 1
-# endif
+#if defined(OPENSSL_SYS_VMS) || defined(OPENSSL_SYS_WINDOWS)
+# define HAVE_FORK 0
+#else
+# define HAVE_FORK 1
+#endif
 #endif
 
 #if HAVE_FORK
-# undef NO_FORK
+#undef NO_FORK
 #else
-# define NO_FORK
+#define NO_FORK
 #endif
 
-# if !defined(NO_FORK) &amp;&amp; !defined(OPENSSL_NO_SOCK) \
+#if !defined(NO_FORK) &amp;&amp; !defined(OPENSSL_NO_SOCK) \
      &amp;&amp; !defined(OPENSSL_NO_POSIX_IO)
-#  define OCSP_DAEMON
-#  include &lt;sys/types.h&gt;
-#  include &lt;sys/wait.h&gt;
-#  include &lt;syslog.h&gt;
-#  include &lt;signal.h&gt;
-#  define MAXERRLEN 1000 /* limit error text sent to syslog to 1000 bytes */
-# else
-#  undef LOG_INFO
-#  undef LOG_WARNING
-#  undef LOG_ERR
-#  define LOG_INFO      0
-#  define LOG_WARNING   1
-#  define LOG_ERR       2
-# endif
+# define OCSP_DAEMON
+# include &lt;sys/types.h&gt;
+# include &lt;sys/wait.h&gt;
+# include &lt;syslog.h&gt;
+# include &lt;signal.h&gt;
+# define MAXERRLEN 1000 /* limit error text sent to syslog to 1000 bytes */
+#else
+# undef LOG_INFO
+# undef LOG_WARNING
+# undef LOG_ERR
+# define LOG_INFO      0
+# define LOG_WARNING   1
+# define LOG_ERR       2
+#endif
 
-# if defined(OPENSSL_SYS_VXWORKS)
+#if defined(OPENSSL_SYS_VXWORKS)
 /* not supported */
 int setpgid(pid_t pid, pid_t pgid)
 {
@@ -80,9 +77,9 @@ pid_t fork(void)
     errno = ENOSYS;
     return (pid_t) -1;
 }
-# endif
+#endif
 /* Maximum leeway in validity period: default 5 minutes */
-# define MAX_VALIDITY_PERIOD    (5 * 60)
+#define MAX_VALIDITY_PERIOD    (5 * 60)
 
 static int add_ocsp_cert(OCSP_REQUEST **req, X509 *cert,
                          const EVP_MD *cert_id_md, X509 *issuer,
@@ -109,20 +106,20 @@ static void log_message(int level, const char *fmt, ...);
 static char *prog;
 static int multi = 0;
 
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
 static int acfd = (int) INVALID_SOCKET;
 static int index_changed(CA_DB *);
 static void spawn_loop(void);
 static int print_syslog(const char *str, size_t len, void *levPtr);
 static void socket_timeout(int signum);
-# endif
+#endif
 
-# ifndef OPENSSL_NO_SOCK
+#ifndef OPENSSL_NO_SOCK
 static OCSP_RESPONSE *query_responder(BIO *cbio, const char *host,
                                       const char *path,
                                       const STACK_OF(CONF_VALUE) *headers,
                                       OCSP_REQUEST *req, int req_timeout);
-# endif
+#endif
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -160,9 +157,9 @@ const OPTIONS ocsp_options[] = {
      &quot;Don't include any certificates in response&quot;},
     {&quot;resp_key_id&quot;, OPT_RESP_KEY_ID, '-',
      &quot;Identify response by signing certificate key ID&quot;},
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
     {&quot;multi&quot;, OPT_MULTI, 'p', &quot;run multiple responder processes&quot;},
-# endif
+#endif
     {&quot;no_certs&quot;, OPT_NO_CERTS, '-',
      &quot;Don't include any certificates in signed request&quot;},
     {&quot;no_signature_verify&quot;, OPT_NO_SIGNATURE_VERIFY, '-',
@@ -511,9 +508,9 @@ int ocsp_main(int argc, char **argv)
             trailing_md = 1;
             break;
         case OPT_MULTI:
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
             multi = atoi(opt_arg());
-# endif
+#endif
             break;
         }
     }
@@ -593,7 +590,7 @@ int ocsp_main(int argc, char **argv)
         }
     }
 
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
     if (multi &amp;&amp; acbio != NULL)
         spawn_loop();
     if (acbio != NULL &amp;&amp; req_timeout &gt; 0)
@@ -606,7 +603,7 @@ int ocsp_main(int argc, char **argv)
 redo_accept:
 
     if (acbio != NULL) {
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
         if (index_changed(rdb)) {
             CA_DB *newrdb = load_index(ridx_filename, NULL);
 
@@ -619,7 +616,7 @@ redo_accept:
                             ridx_filename);
             }
         }
-# endif
+#endif
 
         req = NULL;
         if (!do_responder(&amp;req, &amp;cbio, acbio, req_timeout))
@@ -688,16 +685,16 @@ redo_accept:
         if (cbio != NULL)
             send_ocsp_response(cbio, resp);
     } else if (host != NULL) {
-# ifndef OPENSSL_NO_SOCK
+#ifndef OPENSSL_NO_SOCK
         resp = process_responder(req, host, path,
                                  port, use_ssl, headers, req_timeout);
         if (resp == NULL)
             goto end;
-# else
+#else
         BIO_printf(bio_err,
                    &quot;Error creating connect BIO - sockets not supported.\n&quot;);
         goto end;
-# endif
+#endif
     } else if (respin != NULL) {
         derbio = bio_open_default(respin, 'r', FORMAT_ASN1);
         if (derbio == NULL)
@@ -840,7 +837,7 @@ log_message(int level, const char *fmt, ...)
     va_list ap;
 
     va_start(ap, fmt);
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
     if (multi) {
         char buf[1024];
         if (vsnprintf(buf, sizeof(buf), fmt, ap) &gt; 0) {
@@ -849,7 +846,7 @@ log_message(int level, const char *fmt, ...)
         if (level &gt;= LOG_ERR)
             ERR_print_errors_cb(print_syslog, &amp;level);
     }
-# endif
+#endif
     if (!multi) {
         BIO_printf(bio_err, &quot;%s: &quot;, prog);
         BIO_vprintf(bio_err, fmt, ap);
@@ -858,7 +855,7 @@ log_message(int level, const char *fmt, ...)
     va_end(ap);
 }
 
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
 
 static int print_syslog(const char *str, size_t len, void *levPtr)
 {
@@ -1011,7 +1008,7 @@ static void spawn_loop(void)
     syslog(LOG_INFO, &quot;terminating on signal: %d&quot;, termsig);
     killall(0, kidpids);
 }
-# endif
+#endif
 
 static int add_ocsp_cert(OCSP_REQUEST **req, X509 *cert,
                          const EVP_MD *cert_id_md, X509 *issuer,
@@ -1291,11 +1288,11 @@ static char **lookup_serial(CA_DB *db, ASN1_INTEGER *ser)
 
 static BIO *init_responder(const char *port)
 {
-# ifdef OPENSSL_NO_SOCK
+#ifdef OPENSSL_NO_SOCK
     BIO_printf(bio_err,
                &quot;Error setting up accept BIO - sockets not supported.\n&quot;);
     return NULL;
-# else
+#else
     BIO *acbio = NULL, *bufbio = NULL;
 
     bufbio = BIO_new(BIO_f_buffer());
@@ -1322,10 +1319,10 @@ static BIO *init_responder(const char *port)
     BIO_free_all(acbio);
     BIO_free(bufbio);
     return NULL;
-# endif
+#endif
 }
 
-# ifndef OPENSSL_NO_SOCK
+#ifndef OPENSSL_NO_SOCK
 /*
  * Decode %xx URL-decoding in-place. Ignores mal-formed sequences.
  */
@@ -1349,22 +1346,22 @@ static int urldecode(char *p)
     *out = '\0';
     return (int)(out - save);
 }
-# endif
+#endif
 
-# ifdef OCSP_DAEMON
+#ifdef OCSP_DAEMON
 static void socket_timeout(int signum)
 {
     if (acfd != (int)INVALID_SOCKET)
         (void)shutdown(acfd, SHUT_RD);
 }
-# endif
+#endif
 
 static int do_responder(OCSP_REQUEST **preq, BIO **pcbio, BIO *acbio,
                         int timeout)
 {
-# ifdef OPENSSL_NO_SOCK
+#ifdef OPENSSL_NO_SOCK
     return 0;
-# else
+#else
     int len;
     OCSP_REQUEST *req = NULL;
     char inbuf[2048], reqbuf[2048];
@@ -1382,12 +1379,12 @@ static int do_responder(OCSP_REQUEST **preq, BIO **pcbio, BIO *acbio,
     *pcbio = cbio;
     client = BIO_get_peer_name(cbio);
 
-#  ifdef OCSP_DAEMON
+# ifdef OCSP_DAEMON
     if (timeout &gt; 0) {
         (void) BIO_get_fd(cbio, &amp;acfd);
         alarm(timeout);
     }
-#  endif
+# endif
 
     /* Read the request line. */
     len = BIO_gets(cbio, reqbuf, sizeof(reqbuf));
@@ -1450,11 +1447,11 @@ static int do_responder(OCSP_REQUEST **preq, BIO **pcbio, BIO *acbio,
             break;
     }
 
-#  ifdef OCSP_DAEMON
+# ifdef OCSP_DAEMON
     /* Clear alarm before we close the client socket */
     alarm(0);
     timeout = 0;
-#  endif
+# endif
 
     /* Try to read OCSP request */
     if (getbio != NULL) {
@@ -1470,13 +1467,13 @@ static int do_responder(OCSP_REQUEST **preq, BIO **pcbio, BIO *acbio,
     *preq = req;
 
 out:
-#  ifdef OCSP_DAEMON
+# ifdef OCSP_DAEMON
     if (timeout &gt; 0)
         alarm(0);
     acfd = (int)INVALID_SOCKET;
-#  endif
-    return 1;
 # endif
+    return 1;
+#endif
 }
 
 static int send_ocsp_response(BIO *cbio, OCSP_RESPONSE *resp)
@@ -1492,7 +1489,7 @@ static int send_ocsp_response(BIO *cbio, OCSP_RESPONSE *resp)
     return 1;
 }
 
-# ifndef OPENSSL_NO_SOCK
+#ifndef OPENSSL_NO_SOCK
 static OCSP_RESPONSE *query_responder(BIO *cbio, const char *host,
                                       const char *path,
                                       const STACK_OF(CONF_VALUE) *headers,
@@ -1623,6 +1620,4 @@ OCSP_RESPONSE *process_responder(OCSP_REQUEST *req,
     SSL_CTX_free(ctx);
     return resp;
 }
-# endif
-
 #endif
diff --git a/apps/pkcs12.c b/apps/pkcs12.c
index 3603b60c19..5b33586d2f 100644
--- a/apps/pkcs12.c
+++ b/apps/pkcs12.c
@@ -8,25 +8,21 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#if defined(OPENSSL_NO_DES)
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/crypto.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/pem.h&gt;
-# include &lt;openssl/pkcs12.h&gt;
-
-# define NOKEYS          0x1
-# define NOCERTS         0x2
-# define INFO            0x4
-# define CLCERTS         0x8
-# define CACERTS         0x10
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/crypto.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/pem.h&gt;
+#include &lt;openssl/pkcs12.h&gt;
+
+#define NOKEYS          0x1
+#define NOCERTS         0x2
+#define INFO            0x4
+#define CLCERTS         0x8
+#define CACERTS         0x10
 
 #define PASSWD_BUF_SIZE 2048
 
@@ -74,15 +70,15 @@ const OPTIONS pkcs12_options[] = {
     {&quot;chain&quot;, OPT_CHAIN, '-', &quot;Add certificate chain&quot;},
     {&quot;twopass&quot;, OPT_TWOPASS, '-', &quot;Separate MAC, encryption passwords&quot;},
     {&quot;nomacver&quot;, OPT_NOMACVER, '-', &quot;Don't verify MAC&quot;},
-# ifndef OPENSSL_NO_RC2
+#ifndef OPENSSL_NO_RC2
     {&quot;descert&quot;, OPT_DESCERT, '-',
      &quot;Encrypt output with 3DES (default RC2-40)&quot;},
     {&quot;certpbe&quot;, OPT_CERTPBE, 's',
      &quot;Certificate PBE algorithm (default RC2-40)&quot;},
-# else
+#else
     {&quot;descert&quot;, OPT_DESCERT, '-', &quot;Encrypt output with 3DES (the default)&quot;},
     {&quot;certpbe&quot;, OPT_CERTPBE, 's', &quot;Certificate PBE algorithm (default 3DES)&quot;},
-# endif
+#endif
     {&quot;export&quot;, OPT_EXPORT, '-', &quot;Output PKCS12 file&quot;},
     {&quot;noiter&quot;, OPT_NOITER, '-', &quot;Don't use encryption iteration&quot;},
     {&quot;maciter&quot;, OPT_MACITER, '-', &quot;Use MAC iteration&quot;},
@@ -113,9 +109,9 @@ const OPTIONS pkcs12_options[] = {
     {&quot;no-CApath&quot;, OPT_NOCAPATH, '-',
      &quot;Do not load certificates from the default certificates directory&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -126,11 +122,11 @@ int pkcs12_main(int argc, char **argv)
     char pass[PASSWD_BUF_SIZE] = &quot;&quot;, macpass[PASSWD_BUF_SIZE] = &quot;&quot;;
     int export_cert = 0, options = 0, chain = 0, twopass = 0, keytype = 0;
     int iter = PKCS12_DEFAULT_ITER, maciter = PKCS12_DEFAULT_ITER;
-# ifndef OPENSSL_NO_RC2
+#ifndef OPENSSL_NO_RC2
     int cert_pbe = NID_pbe_WithSHA1And40BitRC2_CBC;
-# else
+#else
     int cert_pbe = NID_pbe_WithSHA1And3_Key_TripleDES_CBC;
-# endif
+#endif
     int key_pbe = NID_pbe_WithSHA1And3_Key_TripleDES_CBC;
     int ret = 1, macver = 1, add_lmk = 0, private = 0;
     int noprompt = 0;
@@ -976,5 +972,3 @@ static int set_pbe(int *ppbe, const char *str)
     }
     return 1;
 }
-
-#endif
diff --git a/apps/rsa.c b/apps/rsa.c
index fdd02dce32..7a8502288b 100644
--- a/apps/rsa.c
+++ b/apps/rsa.c
@@ -8,23 +8,19 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_RSA
-NON_EMPTY_TRANSLATION_UNIT
-#else
-
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &lt;time.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/rsa.h&gt;
-# include &lt;openssl/evp.h&gt;
-# include &lt;openssl/x509.h&gt;
-# include &lt;openssl/pem.h&gt;
-# include &lt;openssl/bn.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;time.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/rsa.h&gt;
+#include &lt;openssl/evp.h&gt;
+#include &lt;openssl/x509.h&gt;
+#include &lt;openssl/pem.h&gt;
+#include &lt;openssl/bn.h&gt;
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -53,14 +49,14 @@ const OPTIONS rsa_options[] = {
     {&quot;modulus&quot;, OPT_MODULUS, '-', &quot;Print the RSA key modulus&quot;},
     {&quot;check&quot;, OPT_CHECK, '-', &quot;Verify key consistency&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
-# if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_RC4)
+#if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_RC4)
     {&quot;pvk-strong&quot;, OPT_PVK_STRONG, '-', &quot;Enable 'Strong' PVK encoding level (default)&quot;},
     {&quot;pvk-weak&quot;, OPT_PVK_WEAK, '-', &quot;Enable 'Weak' PVK encoding level&quot;},
     {&quot;pvk-none&quot;, OPT_PVK_NONE, '-', &quot;Don't enforce PVK encoding&quot;},
-# endif
-# ifndef OPENSSL_NO_ENGINE
+#endif
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -75,9 +71,9 @@ int rsa_main(int argc, char **argv)
     int i, private = 0;
     int informat = FORMAT_PEM, outformat = FORMAT_PEM, text = 0, check = 0;
     int noout = 0, modulus = 0, pubin = 0, pubout = 0, ret = 1;
-# if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_RC4)
+#if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_RC4)
     int pvk_encr = 2;
-# endif
+#endif
     OPTION_CHOICE o;
 
     prog = opt_init(argc, argv, rsa_options);
@@ -130,9 +126,9 @@ int rsa_main(int argc, char **argv)
         case OPT_PVK_STRONG:    /* pvk_encr:= 2 */
         case OPT_PVK_WEAK:      /* pvk_encr:= 1 */
         case OPT_PVK_NONE:      /* pvk_encr:= 0 */
-# if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_RC4)
+#if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_RC4)
             pvk_encr = (o - OPT_PVK_NONE);
-# endif
+#endif
             break;
         case OPT_NOOUT:
             noout = 1;
@@ -265,7 +261,7 @@ int rsa_main(int argc, char **argv)
             i = PEM_write_bio_RSAPrivateKey(out, rsa,
                                             enc, NULL, 0, NULL, passout);
         }
-# ifndef OPENSSL_NO_DSA
+#ifndef OPENSSL_NO_DSA
     } else if (outformat == FORMAT_MSBLOB || outformat == FORMAT_PVK) {
         EVP_PKEY *pk;
         pk = EVP_PKEY_new();
@@ -280,13 +276,13 @@ int rsa_main(int argc, char **argv)
                 goto end;
             }
             assert(private);
-#  ifdef OPENSSL_NO_RC4
+# ifdef OPENSSL_NO_RC4
             BIO_printf(bio_err, &quot;PVK format not supported\n&quot;);
             EVP_PKEY_free(pk);
             goto end;
-#  else
+# else
             i = i2b_PVK_bio(out, pk, pvk_encr, 0, passout);
-#  endif
+# endif
         } else if (pubin || pubout) {
             i = i2b_PublicKey_bio(out, pk);
         } else {
@@ -294,7 +290,7 @@ int rsa_main(int argc, char **argv)
             i = i2b_PrivateKey_bio(out, pk);
         }
         EVP_PKEY_free(pk);
-# endif
+#endif
     } else {
         BIO_printf(bio_err, &quot;bad output format specified for outfile\n&quot;);
         goto end;
@@ -313,4 +309,3 @@ int rsa_main(int argc, char **argv)
     OPENSSL_free(passout);
     return ret;
 }
-#endif
diff --git a/apps/rsautl.c b/apps/rsautl.c
index 5da8504d3c..a24a7e5a79 100644
--- a/apps/rsautl.c
+++ b/apps/rsautl.c
@@ -8,25 +8,21 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_RSA
-NON_EMPTY_TRANSLATION_UNIT
-#else
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;string.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/pem.h&gt;
+#include &lt;openssl/rsa.h&gt;
 
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;string.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/pem.h&gt;
-# include &lt;openssl/rsa.h&gt;
+#define RSA_SIGN        1
+#define RSA_VERIFY      2
+#define RSA_ENCRYPT     3
+#define RSA_DECRYPT     4
 
-# define RSA_SIGN        1
-# define RSA_VERIFY      2
-# define RSA_ENCRYPT     3
-# define RSA_DECRYPT     4
-
-# define KEY_PRIVKEY     1
-# define KEY_PUBKEY      2
-# define KEY_CERT        3
+#define KEY_PRIVKEY     1
+#define KEY_PUBKEY      2
+#define KEY_CERT        3
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
@@ -60,9 +56,9 @@ const OPTIONS rsautl_options[] = {
     {&quot;decrypt&quot;, OPT_DECRYPT, '-', &quot;Decrypt with private key&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     OPT_R_OPTIONS,
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -279,4 +275,3 @@ int rsautl_main(int argc, char **argv)
     OPENSSL_free(passin);
     return ret;
 }
-#endif
diff --git a/apps/srp.c b/apps/srp.c
index 689574a485..3ffe68fcad 100644
--- a/apps/srp.c
+++ b/apps/srp.c
@@ -12,28 +12,24 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_SRP
-NON_EMPTY_TRANSLATION_UNIT
-#else
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;openssl/conf.h&gt;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/txt_db.h&gt;
+#include &lt;openssl/buffer.h&gt;
+#include &lt;openssl/srp.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
 
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &lt;openssl/conf.h&gt;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/txt_db.h&gt;
-# include &lt;openssl/buffer.h&gt;
-# include &lt;openssl/srp.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
+#define BASE_SECTION    &quot;srp&quot;
+#define CONFIG_FILE &quot;openssl.cnf&quot;
 
-# define BASE_SECTION    &quot;srp&quot;
-# define CONFIG_FILE &quot;openssl.cnf&quot;
 
-
-# define ENV_DATABASE            &quot;srpvfile&quot;
-# define ENV_DEFAULT_SRP         &quot;default_srp&quot;
+#define ENV_DATABASE            &quot;srpvfile&quot;
+#define ENV_DEFAULT_SRP         &quot;default_srp&quot;
 
 static int get_index(CA_DB *db, char *id, char type)
 {
@@ -212,9 +208,9 @@ const OPTIONS srp_options[] = {
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
     OPT_R_OPTIONS,
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {NULL}
 };
 
@@ -610,4 +606,3 @@ int srp_main(int argc, char **argv)
     release_engine(e);
     return ret;
 }
-#endif
diff --git a/apps/ts.c b/apps/ts.c
index 44a8f75d4a..87e31f2d49 100644
--- a/apps/ts.c
+++ b/apps/ts.c
@@ -8,29 +8,26 @@
  */
 
 #include &lt;openssl/opensslconf.h&gt;
-#ifdef OPENSSL_NO_TS
-NON_EMPTY_TRANSLATION_UNIT
-#else
-# include &lt;stdio.h&gt;
-# include &lt;stdlib.h&gt;
-# include &lt;string.h&gt;
-# include &quot;apps.h&quot;
-# include &quot;progs.h&quot;
-# include &lt;openssl/bio.h&gt;
-# include &lt;openssl/err.h&gt;
-# include &lt;openssl/pem.h&gt;
-# include &lt;openssl/rand.h&gt;
-# include &lt;openssl/ts.h&gt;
-# include &lt;openssl/bn.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &quot;apps.h&quot;
+#include &quot;progs.h&quot;
+#include &lt;openssl/bio.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/pem.h&gt;
+#include &lt;openssl/rand.h&gt;
+#include &lt;openssl/ts.h&gt;
+#include &lt;openssl/bn.h&gt;
 
 /* Request nonce length, in bits (must be a multiple of 8). */
-# define NONCE_LENGTH            64
+#define NONCE_LENGTH            64
 
 /* Name of config entry that defines the OID file. */
-# define ENV_OID_FILE            &quot;oid_file&quot;
+#define ENV_OID_FILE            &quot;oid_file&quot;
 
 /* Is |EXACTLY_ONE| of three pointers set? */
-# define EXACTLY_ONE(a, b, c) \
+#define EXACTLY_ONE(a, b, c) \
         (( a &amp;&amp; !b &amp;&amp; !c) || \
          ( b &amp;&amp; !a &amp;&amp; !c) || \
          ( c &amp;&amp; !a &amp;&amp; !b))
@@ -114,9 +111,9 @@ const OPTIONS ts_options[] = {
     {&quot;CAfile&quot;, OPT_CAFILE, '&lt;', &quot;File with trusted CA certs&quot;},
     {&quot;untrusted&quot;, OPT_UNTRUSTED, '&lt;', &quot;File with untrusted certs&quot;},
     {&quot;&quot;, OPT_MD, '-', &quot;Any supported digest&quot;},
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
-# endif
+#endif
     {OPT_HELP_STR, 1, '-', &quot;\nOptions specific to 'ts -verify': \n&quot;},
     OPT_V_OPTIONS,
     {OPT_HELP_STR, 1, '-', &quot;\n&quot;},
@@ -137,11 +134,11 @@ static char* opt_helplist[] = {
     &quot;          [-signer tsa_cert.pem] [-inkey private_key.pem]&quot;,
     &quot;          [-chain certs_file.pem] [-tspolicy oid]&quot;,
     &quot;          [-in file] [-token_in] [-out file] [-token_out]&quot;,
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     &quot;          [-text] [-engine id]&quot;,
-# else
+#else
     &quot;          [-text]&quot;,
-# endif
+#endif
     &quot;  or&quot;,
     &quot;ts -verify -CApath dir -CAfile file.pem -untrusted file.pem&quot;,
     &quot;           [-data file] [-digest hexstring]&quot;,
@@ -682,10 +679,10 @@ static TS_RESP *create_response(CONF *conf, const char *section, const char *eng
         goto end;
     if (!TS_CONF_set_serial(conf, section, serial_cb, resp_ctx))
         goto end;
-# ifndef OPENSSL_NO_ENGINE
+#ifndef OPENSSL_NO_ENGINE
     if (!TS_CONF_set_crypto_device(conf, section, engine))
         goto end;
-# endif
+#endif
     if (!TS_CONF_set_signer_cert(conf, section, signer, resp_ctx))
         goto end;
     if (!TS_CONF_set_certs(conf, section, chain, resp_ctx))
@@ -984,4 +981,3 @@ static int verify_cb(int ok, X509_STORE_CTX *ctx)
 {
     return ok;
 }
-#endif  /* ndef OPENSSL_NO_TS */
</PRE>































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028254.html">[openssl]  OpenSSL_1_1_1-stable update
</A></li>
	<LI>Next message: <A HREF="028272.html">[openssl]  OpenSSL_1_1_1-stable update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28261">[ date ]</a>
              <a href="thread.html#28261">[ thread ]</a>
              <a href="subject.html#28261">[ subject ]</a>
              <a href="author.html#28261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
