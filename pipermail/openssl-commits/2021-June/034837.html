<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2021-June/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1625025381.517178.17247.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034836.html">
   <LINK REL="Next"  HREF="034838.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Dr. Paul Dale</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1625025381.517178.17247.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">pauli at openssl.org
       </A><BR>
    <I>Wed Jun 30 03:56:21 UTC 2021</I>
    <P><UL>
        <LI>Previous message: <A HREF="034836.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="034838.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34837">[ date ]</a>
              <a href="thread.html#34837">[ thread ]</a>
              <a href="subject.html#34837">[ subject ]</a>
              <a href="author.html#34837">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  5e56f4587de2f2e06c079272fa4d6712d56dbcf0 (commit)
       via  98431c431366ec3445e92cf4c50a1d3ac80573a5 (commit)
       via  159dacca4682a48ccc3625c64678b7eaf31681ef (commit)
       via  196feb18de28cc5e6b59483ab61453dbca8d5c4b (commit)
       via  01fb4bff9bee4b6a652d42ec9f1b677773280450 (commit)
      from  10af976962b2383bb3044120a764037361b8bff7 (commit)


- Log -----------------------------------------------------------------
commit 5e56f4587de2f2e06c079272fa4d6712d56dbcf0
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">pauli at openssl.org</A>&gt;
Date:   Tue Jun 29 08:26:11 2021 +1000

    evp: fix coverity 1473380 Copy into fixed size buffer (STRING_OVERFLOW)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/15943">https://github.com/openssl/openssl/pull/15943</A>)

commit 98431c431366ec3445e92cf4c50a1d3ac80573a5
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">pauli at openssl.org</A>&gt;
Date:   Tue Jun 29 08:18:30 2021 +1000

    dh_test: fix coverity 1473239 Argument cannot be negative (NEGATIVE_RETURNS)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/15943">https://github.com/openssl/openssl/pull/15943</A>)

commit 159dacca4682a48ccc3625c64678b7eaf31681ef
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">pauli at openssl.org</A>&gt;
Date:   Tue Jun 29 08:05:19 2021 +1000

    s_time: avoid unlikely division by zero
    
    Fixing coverity 966560 Division or modulo by zero (DIVIDE_BY_ZERO)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/15943">https://github.com/openssl/openssl/pull/15943</A>)

commit 196feb18de28cc5e6b59483ab61453dbca8d5c4b
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">pauli at openssl.org</A>&gt;
Date:   Tue Jun 29 08:01:13 2021 +1000

    bio: check for valid socket when closing
    
    Fixes coverity 271258 Improper use of negative value (NEGATIVE_RETURNS)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/15943">https://github.com/openssl/openssl/pull/15943</A>)

commit 01fb4bff9bee4b6a652d42ec9f1b677773280450
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">pauli at openssl.org</A>&gt;
Date:   Tue Jun 29 07:59:00 2021 +1000

    test: fix coverity 1469427 Improper use of negative value (NEGATIVE_RETURNS)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/15943">https://github.com/openssl/openssl/pull/15943</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/s_time.c                      | 11 +++++++----
 crypto/bio/bio_sock2.c             |  2 +-
 crypto/evp/ctrl_params_translate.c |  4 +++-
 test/dhtest.c                      | 11 +++++++----
 test/endecoder_legacy_test.c       |  3 ++-
 5 files changed, 20 insertions(+), 11 deletions(-)

diff --git a/apps/s_time.c b/apps/s_time.c
index 34e939d047..1a58e19de5 100644
--- a/apps/s_time.c
+++ b/apps/s_time.c
@@ -394,10 +394,13 @@ int s_time_main(int argc, char **argv)
     printf
         (&quot;\n\n%d connections in %.2fs; %.2f connections/user sec, bytes read %ld\n&quot;,
          nConn, totalTime, ((double)nConn / totalTime), bytes_read);
-    printf
-        (&quot;%d connections in %ld real seconds, %ld bytes read per connection\n&quot;,
-         nConn, (long)time(NULL) - finishtime + maxtime, bytes_read / nConn);
-
+    if (nConn &gt; 0)
+        printf
+            (&quot;%d connections in %ld real seconds, %ld bytes read per connection\n&quot;,
+             nConn, (long)time(NULL) - finishtime + maxtime, bytes_read / nConn);
+    else
+        printf(&quot;0 connections in %ld real seconds\n&quot;,
+               (long)time(NULL) - finishtime + maxtime);
     ret = 0;
 
  end:
diff --git a/crypto/bio/bio_sock2.c b/crypto/bio/bio_sock2.c
index f13f20148b..b6c95913ce 100644
--- a/crypto/bio/bio_sock2.c
+++ b/crypto/bio/bio_sock2.c
@@ -335,7 +335,7 @@ int BIO_accept_ex(int accept_sock, BIO_ADDR *addr_, int options)
  */
 int BIO_closesocket(int sock)
 {
-    if (closesocket(sock) &lt; 0)
+    if (sock &lt; 0 || closesocket(sock) &lt; 0)
         return 0;
     return 1;
 }
diff --git a/crypto/evp/ctrl_params_translate.c b/crypto/evp/ctrl_params_translate.c
index 6998dcc6fc..c532e57f8f 100644
--- a/crypto/evp/ctrl_params_translate.c
+++ b/crypto/evp/ctrl_params_translate.c
@@ -1353,7 +1353,9 @@ static int fix_rsa_pss_saltlen(enum state state,
         if (i == OSSL_NELEM(str_value_map)) {
             BIO_snprintf(ctx-&gt;name_buf, sizeof(ctx-&gt;name_buf), &quot;%d&quot;, ctx-&gt;p1);
         } else {
-            strcpy(ctx-&gt;name_buf, str_value_map[i].ptr);
+            strncpy(ctx-&gt;name_buf, str_value_map[i].ptr, sizeof(ctx-&gt;name_buf));
+            /* This won't truncate but it will quiet static analysers */
+            ctx-&gt;name_buf[sizeof(ctx-&gt;name_buf) - 1] = '\0';
         }
         ctx-&gt;p2 = ctx-&gt;name_buf;
         ctx-&gt;p1 = strlen(ctx-&gt;p2);
diff --git a/test/dhtest.c b/test/dhtest.c
index adbe3afd78..cb8d9a7de4 100644
--- a/test/dhtest.c
+++ b/test/dhtest.c
@@ -558,6 +558,7 @@ static int rfc5114_test(void)
     DH *dhB = NULL;
     unsigned char *Z1 = NULL;
     unsigned char *Z2 = NULL;
+    int szA, szB;
     const rfc5114_td *td = NULL;
     BIGNUM *priv_key = NULL, *pub_key = NULL;
     const BIGNUM *pub_key_tmp;
@@ -580,12 +581,14 @@ static int rfc5114_test(void)
             goto bad_err;
         priv_key = pub_key = NULL;
 
-        if (!TEST_uint_eq(td-&gt;Z_len, (size_t)DH_size(dhA))
-            || !TEST_uint_eq(td-&gt;Z_len, (size_t)DH_size(dhB)))
+        if (!TEST_int_gt(szA = DH_size(dhA), 0)
+                || !TEST_int_gt(szB = DH_size(dhB), 0)
+                || !TEST_size_t_eq(td-&gt;Z_len, (size_t)szA)
+                || !TEST_size_t_eq(td-&gt;Z_len, (size_t)szB))
             goto err;
 
-        if (!TEST_ptr(Z1 = OPENSSL_malloc(DH_size(dhA)))
-                || !TEST_ptr(Z2 = OPENSSL_malloc(DH_size(dhB))))
+        if (!TEST_ptr(Z1 = OPENSSL_malloc((size_t)szA))
+                || !TEST_ptr(Z2 = OPENSSL_malloc((size_t)szB)))
             goto bad_err;
         /*
          * Work out shared secrets using both sides and compare with expected
diff --git a/test/endecoder_legacy_test.c b/test/endecoder_legacy_test.c
index 121e2de3d4..943cba56e5 100644
--- a/test/endecoder_legacy_test.c
+++ b/test/endecoder_legacy_test.c
@@ -289,7 +289,8 @@ static int test_membio_str_eq(BIO *bio_provided, BIO *bio_legacy)
     long len_provided = BIO_get_mem_data(bio_provided, &amp;str_provided);
     long len_legacy = BIO_get_mem_data(bio_legacy, &amp;str_legacy);
 
-    return TEST_long_ge(len_provided, 0)
+    return TEST_long_ge(len_legacy, 0)
+           &amp;&amp; TEST_long_ge(len_provided, 0)
            &amp;&amp; TEST_strn2_eq(str_provided, len_provided,
                             str_legacy, len_legacy);
 }
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034836.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="034838.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34837">[ date ]</a>
              <a href="thread.html#34837">[ thread ]</a>
              <a href="subject.html#34837">[ subject ]</a>
              <a href="author.html#34837">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
