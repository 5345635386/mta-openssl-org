<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2019-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1568644355.805565.1842.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025147.html">
   <LINK REL="Next"  HREF="025154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1568644355.805565.1842.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Mon Sep 16 14:32:35 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="025147.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="025154.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25151">[ date ]</a>
              <a href="thread.html#25151">[ thread ]</a>
              <a href="subject.html#25151">[ subject ]</a>
              <a href="author.html#25151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  1aa89a7a3afb053d0c0b7fad8d3ea1b0a5447289 (commit)
       via  a1c8befd661fa2145d330bb04ebc6061660db4fd (commit)
       via  593d5c2fadd3c1322fa995e9ac9ced3af4d6468d (commit)
      from  6ef03ea98fac501e6d6e33bac6ad3c92ea074712 (commit)


- Log -----------------------------------------------------------------
commit 1aa89a7a3afb053d0c0b7fad8d3ea1b0a5447289
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Sep 13 00:06:46 2019 +0200

    Unify all assembler file generators
    
    They now generally conform to the following argument sequence:
    
        script.pl &quot;$(PERLASM_SCHEME)&quot; [ C preprocessor arguments ... ] \
                  $(PROCESSOR) &lt;output file&gt;
    
    However, in the spirit of being able to use these scripts manually,
    they also allow for no argument, or for only the flavour, or for only
    the output file.  This is done by only using the last argument as
    output file if it's a file (it has an extension), and only using the
    first argument as flavour if it isn't a file (it doesn't have an
    extension).
    
    While we're at it, we make all $xlate calls the same, i.e. the $output
    argument is always quoted, and we always die on error when trying to
    start $xlate.
    
    There's a perl lesson in this, regarding operator priority...
    
    This will always succeed, even when it fails:
    
        open FOO, &quot;something&quot; || die &quot;ERR: $!&quot;;
    
    The reason is that '||' has higher priority than list operators (a
    function is essentially a list operator and gobbles up everything
    following it that isn't lower priority), and since a non-empty string
    is always true, so that ends up being exactly the same as:
    
        open FOO, &quot;something&quot;;
    
    This, however, will fail if &quot;something&quot; can't be opened:
    
        open FOO, &quot;something&quot; or die &quot;ERR: $!&quot;;
    
    The reason is that 'or' has lower priority that list operators,
    i.e. it's performed after the 'open' call.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/9884">https://github.com/openssl/openssl/pull/9884</A>)

commit a1c8befd661fa2145d330bb04ebc6061660db4fd
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Sep 13 00:05:26 2019 +0200

    build.info: For all assembler generators, remove all arguments
    
    Since the arguments are now generated in the build file templates,
    they should be removed from the build.info files.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/9884">https://github.com/openssl/openssl/pull/9884</A>)

commit 593d5c2fadd3c1322fa995e9ac9ced3af4d6468d
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Sep 12 23:58:07 2019 +0200

    Build files: Unify standard arguments for assembler generating scrips
    
    - Make the last argument always be the output file.
    - Make the first argument always be the flavour, even if there is no
      flavour (i.e. it might become the empty string).
    - Make the next to last argument to be $(PROCESSOR) if that one has a
      value.
    - Remaining arguments are C prepropressor arguments.
    
    Perl scripts that should handle this may use the following code:
    
        $output = pop;
        $flavour = shift;
        if ($ARGV[$#ARGV] eq '386') {
            # Do 386 specific things
        } else {
            # Do whatever else, with the knowledge the @ARGV contains
            # C preprocessor arguments
        }
    
    Some scripts don't care about anything than $output, and that's ok.
    Some scripts do care, but handle it a little differently, and that's
    ok too (notably, the x86 scripts call asm_init() with the first and
    the last argument after having popped $output).
    As long as they handle the argument order right, they are going to
    be fine.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/9884">https://github.com/openssl/openssl/pull/9884</A>)

-----------------------------------------------------------------------

Summary of changes:
 Configurations/descrip.mms.tmpl          |  24 ++++---
 Configurations/unix-Makefile.tmpl        |  16 ++---
 Configurations/windows-makefile.tmpl     |  19 +++---
 crypto/aes/asm/aes-586.pl                |   4 +-
 crypto/aes/asm/aes-armv4.pl              |  12 ++--
 crypto/aes/asm/aes-c64xplus.pl           |   3 +-
 crypto/aes/asm/aes-mips.pl               |  16 ++---
 crypto/aes/asm/aes-parisc.pl             |   9 ++-
 crypto/aes/asm/aes-ppc.pl                |   8 ++-
 crypto/aes/asm/aes-s390x.pl              |   8 ++-
 crypto/aes/asm/aes-sparcv9.pl            |   3 +-
 crypto/aes/asm/aes-x86_64.pl             |  10 +--
 crypto/aes/asm/aesfx-sparcv9.pl          |   3 +-
 crypto/aes/asm/aesni-mb-x86_64.pl        |  10 +--
 crypto/aes/asm/aesni-sha1-x86_64.pl      |  10 +--
 crypto/aes/asm/aesni-sha256-x86_64.pl    |  10 +--
 crypto/aes/asm/aesni-x86.pl              |   4 +-
 crypto/aes/asm/aesni-x86_64.pl           |  10 +--
 crypto/aes/asm/aesp8-ppc.pl              |   8 ++-
 crypto/aes/asm/aest4-sparcv9.pl          |   3 +-
 crypto/aes/asm/aesv8-armx.pl             |   9 ++-
 crypto/aes/asm/bsaes-armv7.pl            |  12 ++--
 crypto/aes/asm/bsaes-x86_64.pl           |  10 +--
 crypto/aes/asm/vpaes-armv8.pl            |   9 ++-
 crypto/aes/asm/vpaes-ppc.pl              |   8 ++-
 crypto/aes/asm/vpaes-x86.pl              |   4 +-
 crypto/aes/asm/vpaes-x86_64.pl           |  10 +--
 crypto/aes/build.info                    |  51 +++++++--------
 crypto/alphacpuid.pl                     |   3 +-
 crypto/arm64cpuid.pl                     |   9 ++-
 crypto/armv4cpuid.pl                     |   9 ++-
 crypto/bf/asm/bf-586.pl                  |   3 +-
 crypto/bf/build.info                     |   3 +-
 crypto/bn/asm/alpha-mont.pl              |   3 +-
 crypto/bn/asm/armv4-gf2m.pl              |  12 ++--
 crypto/bn/asm/armv4-mont.pl              |  12 ++--
 crypto/bn/asm/armv8-mont.pl              |   9 ++-
 crypto/bn/asm/bn-586.pl                  |   3 +-
 crypto/bn/asm/c64xplus-gf2m.pl           |   3 +-
 crypto/bn/asm/co-586.pl                  |   3 +-
 crypto/bn/asm/ia64-mont.pl               |   3 +-
 crypto/bn/asm/mips-mont.pl               |  11 ++--
 crypto/bn/asm/mips.pl                    |   9 ++-
 crypto/bn/asm/parisc-mont.pl             |   8 ++-
 crypto/bn/asm/ppc-mont.pl                |   8 ++-
 crypto/bn/asm/ppc.pl                     |   8 ++-
 crypto/bn/asm/ppc64-mont.pl              |   8 ++-
 crypto/bn/asm/rsaz-avx2.pl               |  10 +--
 crypto/bn/asm/rsaz-x86_64.pl             |  10 +--
 crypto/bn/asm/s390x-gf2m.pl              |   8 ++-
 crypto/bn/asm/s390x-mont.pl              |   8 ++-
 crypto/bn/asm/sparct4-mont.pl            |   3 +-
 crypto/bn/asm/sparcv9-gf2m.pl            |   3 +-
 crypto/bn/asm/sparcv9-mont.pl            |   3 +-
 crypto/bn/asm/sparcv9a-mont.pl           |   6 +-
 crypto/bn/asm/via-mont.pl                |   3 +-
 crypto/bn/asm/vis3-mont.pl               |   3 +-
 crypto/bn/asm/x86-gf2m.pl                |   3 +-
 crypto/bn/asm/x86-mont.pl                |   3 +-
 crypto/bn/asm/x86_64-gf2m.pl             |  10 +--
 crypto/bn/asm/x86_64-mont.pl             |  10 +--
 crypto/bn/asm/x86_64-mont5.pl            |  10 +--
 crypto/bn/build.info                     |  58 ++++++++---------
 crypto/build.info                        |  21 +++----
 crypto/camellia/asm/cmll-x86.pl          |   3 +-
 crypto/camellia/asm/cmll-x86_64.pl       |  10 +--
 crypto/camellia/asm/cmllt4-sparcv9.pl    |   3 +-
 crypto/camellia/build.info               |   8 +--
 crypto/cast/asm/cast-586.pl              |   3 +-
 crypto/cast/build.info                   |   3 +-
 crypto/chacha/asm/chacha-armv4.pl        |  12 ++--
 crypto/chacha/asm/chacha-armv8.pl        |   9 ++-
 crypto/chacha/asm/chacha-c64xplus.pl     |   3 +-
 crypto/chacha/asm/chacha-ia64.pl         |   3 +-
 crypto/chacha/asm/chacha-ppc.pl          |   8 ++-
 crypto/chacha/asm/chacha-s390x.pl        |   8 +--
 crypto/chacha/asm/chacha-x86.pl          |   3 +-
 crypto/chacha/asm/chacha-x86_64.pl       |  10 +--
 crypto/chacha/build.info                 |  17 +++--
 crypto/des/asm/crypt586.pl               |   3 +-
 crypto/des/asm/des-586.pl                |   3 +-
 crypto/des/asm/dest4-sparcv9.pl          |   3 +-
 crypto/des/build.info                    |   8 +--
 crypto/ec/asm/ecp_nistz256-armv4.pl      |  12 ++--
 crypto/ec/asm/ecp_nistz256-armv8.pl      |   9 ++-
 crypto/ec/asm/ecp_nistz256-avx2.pl       |  10 +--
 crypto/ec/asm/ecp_nistz256-ppc64.pl      |   9 ++-
 crypto/ec/asm/ecp_nistz256-sparcv9.pl    |   3 +-
 crypto/ec/asm/ecp_nistz256-x86.pl        |   3 +-
 crypto/ec/asm/ecp_nistz256-x86_64.pl     |  10 +--
 crypto/ec/asm/x25519-ppc64.pl            |   9 ++-
 crypto/ec/asm/x25519-x86_64.pl           |  10 +--
 crypto/ec/build.info                     |  19 +++---
 crypto/md5/asm/md5-586.pl                |   6 +-
 crypto/md5/asm/md5-sparcv9.pl            |   6 +-
 crypto/md5/asm/md5-x86_64.pl             |  10 +--
 crypto/md5/build.info                    |   7 +--
 crypto/modes/asm/aesni-gcm-x86_64.pl     |  10 +--
 crypto/modes/asm/ghash-armv4.pl          |  12 ++--
 crypto/modes/asm/ghash-c64xplus.pl       |   3 +-
 crypto/modes/asm/ghash-parisc.pl         |   9 ++-
 crypto/modes/asm/ghash-s390x.pl          |   8 ++-
 crypto/modes/asm/ghash-sparcv9.pl        |   3 +-
 crypto/modes/asm/ghash-x86.pl            |   3 +-
 crypto/modes/asm/ghash-x86_64.pl         |  10 +--
 crypto/modes/asm/ghashp8-ppc.pl          |   9 ++-
 crypto/modes/asm/ghashv8-armx.pl         |   9 ++-
 crypto/modes/build.info                  |  25 ++++----
 crypto/pariscid.pl                       |   9 ++-
 crypto/poly1305/asm/poly1305-armv4.pl    |  12 ++--
 crypto/poly1305/asm/poly1305-armv8.pl    |   9 ++-
 crypto/poly1305/asm/poly1305-c64xplus.pl |   3 +-
 crypto/poly1305/asm/poly1305-mips.pl     |   8 ++-
 crypto/poly1305/asm/poly1305-ppc.pl      |   8 ++-
 crypto/poly1305/asm/poly1305-ppcfp.pl    |   8 ++-
 crypto/poly1305/asm/poly1305-s390x.pl    |   8 +--
 crypto/poly1305/asm/poly1305-sparcv9.pl  |   9 ++-
 crypto/poly1305/asm/poly1305-x86.pl      |   3 +-
 crypto/poly1305/asm/poly1305-x86_64.pl   |  10 +--
 crypto/poly1305/build.info               |  21 +++----
 crypto/ppccpuid.pl                       |   8 ++-
 crypto/rc4/asm/rc4-586.pl                |   3 +-
 crypto/rc4/asm/rc4-c64xplus.pl           |   3 +-
 crypto/rc4/asm/rc4-md5-x86_64.pl         |  10 +--
 crypto/rc4/asm/rc4-parisc.pl             |   9 ++-
 crypto/rc4/asm/rc4-s390x.pl              |   8 ++-
 crypto/rc4/asm/rc4-x86_64.pl             |  10 +--
 crypto/rc4/build.info                    |  13 ++--
 crypto/rc5/asm/rc5-586.pl                |   3 +-
 crypto/rc5/build.info                    |   3 +-
 crypto/ripemd/asm/rmd-586.pl             |   3 +-
 crypto/ripemd/build.info                 |   3 +-
 crypto/s390xcpuid.pl                     |   8 ++-
 crypto/sha/asm/keccak1600-armv4.pl       |  12 ++--
 crypto/sha/asm/keccak1600-armv8.pl       |   9 ++-
 crypto/sha/asm/keccak1600-avx2.pl        |   3 +-
 crypto/sha/asm/keccak1600-avx512.pl      |   3 +-
 crypto/sha/asm/keccak1600-avx512vl.pl    |   3 +-
 crypto/sha/asm/keccak1600-c64x.pl        |   3 +-
 crypto/sha/asm/keccak1600-mmx.pl         |   3 +-
 crypto/sha/asm/keccak1600-ppc64.pl       |   8 ++-
 crypto/sha/asm/keccak1600-s390x.pl       |   8 ++-
 crypto/sha/asm/keccak1600-x86_64.pl      |  10 +--
 crypto/sha/asm/keccak1600p8-ppc.pl       |   8 ++-
 crypto/sha/asm/sha1-586.pl               |   3 +-
 crypto/sha/asm/sha1-armv4-large.pl       |  12 ++--
 crypto/sha/asm/sha1-armv8.pl             |   9 ++-
 crypto/sha/asm/sha1-c64xplus.pl          |   3 +-
 crypto/sha/asm/sha1-ia64.pl              |   3 +-
 crypto/sha/asm/sha1-mb-x86_64.pl         |  10 +--
 crypto/sha/asm/sha1-mips.pl              |  11 ++--
 crypto/sha/asm/sha1-parisc.pl            |   9 ++-
 crypto/sha/asm/sha1-ppc.pl               |   8 ++-
 crypto/sha/asm/sha1-s390x.pl             |   8 ++-
 crypto/sha/asm/sha1-sparcv9.pl           |   3 +-
 crypto/sha/asm/sha1-sparcv9a.pl          |   3 +-
 crypto/sha/asm/sha1-thumb.pl             |   3 +-
 crypto/sha/asm/sha1-x86_64.pl            |  10 +--
 crypto/sha/asm/sha256-586.pl             |   3 +-
 crypto/sha/asm/sha256-armv4.pl           |  12 ++--
 crypto/sha/asm/sha256-c64xplus.pl        |   3 +-
 crypto/sha/asm/sha256-mb-x86_64.pl       |  10 +--
 crypto/sha/asm/sha512-586.pl             |   3 +-
 crypto/sha/asm/sha512-armv4.pl           |  12 ++--
 crypto/sha/asm/sha512-armv8.pl           |  11 ++--
 crypto/sha/asm/sha512-c64xplus.pl        |   3 +-
 crypto/sha/asm/sha512-ia64.pl            |   5 +-
 crypto/sha/asm/sha512-mips.pl            |  10 ++-
 crypto/sha/asm/sha512-parisc.pl          |   9 ++-
 crypto/sha/asm/sha512-ppc.pl             |   9 ++-
 crypto/sha/asm/sha512-s390x.pl           |   6 +-
 crypto/sha/asm/sha512-sparcv9.pl         |   6 +-
 crypto/sha/asm/sha512-x86_64.pl          |  10 +--
 crypto/sha/asm/sha512p8-ppc.pl           |   9 ++-
 crypto/sha/build.info                    | 105 +++++++++++++++----------------
 crypto/whrlpool/asm/wp-mmx.pl            |   3 +-
 crypto/whrlpool/asm/wp-x86_64.pl         |  10 +--
 crypto/whrlpool/build.info               |   5 +-
 crypto/x86_64cpuid.pl                    |  10 +--
 crypto/x86cpuid.pl                       |   4 +-
 engines/asm/e_padlock-x86.pl             |   3 +-
 engines/asm/e_padlock-x86_64.pl          |  10 +--
 engines/build.info                       |   5 +-
 ms/uplink-ia64.pl                        |   3 +-
 ms/uplink-x86.pl                         |   3 +-
 ms/uplink-x86_64.pl                      |   7 ++-
 186 files changed, 885 insertions(+), 707 deletions(-)

diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index 6cbbb01565..892102dd91 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -787,15 +787,6 @@ $target : $args{generator}-&gt;[0] $deps
 EOF
 	  }
       } else {
-          my $target = platform-&gt;asm($args{src});
-          if ($args{generator}-&gt;[0] =~ /\.pl$/) {
-              $generator = '$(PERL)'.$generator_incs.' '.$generator;
-          } elsif ($args{generator}-&gt;[0] =~ /\.S$/) {
-              $generator = undef;
-          } else {
-              die &quot;Generator type for $src unknown: $generator\n&quot;;
-          }
-
           my $cppflags = {
               shlib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
               lib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
@@ -812,6 +803,17 @@ EOF
           my $incs_on = join(&quot;\n\t\@ &quot;, @{$incs_cmds[0]}) || '!';
           my $incs_off = join(&quot;\n\t\@ &quot;, @{$incs_cmds[1]}) || '!';
           my $defs = join(&quot;&quot;, map { &quot;,&quot;.$_ } @{$args{defs}});
+          my $target = platform-&gt;asm($args{src});
+
+          if ($args{generator}-&gt;[0] =~ /\.pl$/) {
+              $generator = '$(PERL)'.$generator_incs.' '.$generator
+                  .' '.$cppflags;
+          } elsif ($args{generator}-&gt;[0] =~ /\.S$/) {
+              $generator = undef;
+          } else {
+              die &quot;Generator type for $src unknown: $generator\n&quot;;
+          }
+
           if (defined($generator)) {
               # If the target is named foo.S in build.info, we want to
               # end up generating foo.s in two steps.
@@ -832,7 +834,11 @@ EOF
               # Otherwise....
               return &lt;&lt;&quot;EOF&quot;;
 $target : $args{generator}-&gt;[0] $deps
+        \@ $incs_on
+        \@ extradefines = &quot;$defs&quot;
 	$generator \$\@
+        \@ DELETE/SYMBOL/LOCAL extradefines
+        \@ $incs_off
 EOF
           }
           return &lt;&lt;&quot;EOF&quot;;
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index 1e8a84f946..36cb253bf2 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -980,8 +980,16 @@ $args{src}: $args{generator}-&gt;[0] $deps
 EOF
 	  }
       } else {
+          my $cppflags = {
+              shlib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
+              lib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
+              dso =&gt; '$(DSO_CFLAGS) $(DSO_CPPFLAGS)',
+              bin =&gt; '$(BIN_CFLAGS) $(BIN_CPPFLAGS)'
+          } -&gt; {$args{intent}};
+
           if ($args{generator}-&gt;[0] =~ /\.pl$/) {
-              $generator = 'CC=&quot;$(CC)&quot; $(PERL)'.$generator_incs.' '.$generator;
+              $generator = 'CC=&quot;$(CC)&quot; $(PERL)'.$generator_incs.' '.$generator
+                  .' &quot;$(PERLASM_SCHEME)&quot;'.$incs.' '.$cppflags.$defs.' $(PROCESSSOR)';
           } elsif ($args{generator}-&gt;[0] =~ /\.m4$/) {
               $generator = 'm4 -B 8192'.$generator_incs.' '.$generator.' &gt;'
           } elsif ($args{generator}-&gt;[0] =~ /\.S$/) {
@@ -990,12 +998,6 @@ EOF
               die &quot;Generator type for $args{src} unknown: $generator\n&quot;;
           }
 
-          my $cppflags = {
-              shlib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
-              lib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
-              dso =&gt; '$(DSO_CFLAGS) $(DSO_CPPFLAGS)',
-              bin =&gt; '$(BIN_CFLAGS) $(BIN_CPPFLAGS)'
-          } -&gt; {$args{intent}};
           if (defined($generator)) {
               return &lt;&lt;&quot;EOF&quot;;
 $args{src}: $args{generator}-&gt;[0] $deps
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index a211c2277d..bfe88f6cc9 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -570,22 +570,23 @@ $target: &quot;$args{generator}-&gt;[0]&quot; $deps
 EOF
 	  }
       } else {
+          my $cppflags = {
+              shlib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
+              lib =&gt; '$(LIB_CFLAGS) $(LIB_CPPFLAGS)',
+              dso =&gt; '$(DSO_CFLAGS) $(DSO_CPPFLAGS)',
+              bin =&gt; '$(BIN_CFLAGS) $(BIN_CPPFLAGS)'
+          } -&gt; {$args{intent}};
           my $target = platform-&gt;asm($args{src});
+
           if ($args{generator}-&gt;[0] =~ /\.pl$/) {
-              $generator = '&quot;$(PERL)&quot;'.$generator_incs.' '.$generator;
+              $generator = '&quot;$(PERL)&quot;'.$generator_incs.' '.$generator
+                  .' &quot;$(PERLASM_SCHEME)&quot;'.$incs.' '.$cppflags.$defs.' $(PROCESSSOR)';
           } elsif ($args{generator}-&gt;[0] =~ /\.S$/) {
               $generator = undef;
           } else {
               die &quot;Generator type for $src unknown: $generator\n&quot;;
           }
 
-          my $cppflags = $incs;
-          $cppflags .= {
-              shlib =&gt; ' $(LIB_CFLAGS) $(LIB_CPPFLAGS)',
-              lib =&gt; ' $(LIB_CFLAGS) $(LIB_CPPFLAGS)',
-              dso =&gt; ' $(DSO_CFLAGS) $(DSO_CPPFLAGS)',
-              bin =&gt; ' $(BIN_CFLAGS) $(BIN_CPPFLAGS)'
-          } -&gt; {$args{intent}};
           if (defined($generator)) {
               # If the target is named foo.S in build.info, we want to
               # end up generating foo.s in two steps.
@@ -594,7 +595,7 @@ EOF
 $target: &quot;$args{generator}-&gt;[0]&quot; $deps
 	set ASM=\$(AS)
 	$generator \$@.S
-	\$(CPP) $cppflags $defs \$@.S &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
+	\$(CPP) $incs $cppflags $defs \$@.S &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
         del /Q \$@.S
 EOF
               }
diff --git a/crypto/aes/asm/aes-586.pl b/crypto/aes/asm/aes-586.pl
index 514a0673c4..1fe8245f39 100755
--- a/crypto/aes/asm/aes-586.pl
+++ b/crypto/aes/asm/aes-586.pl
@@ -198,9 +198,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open OUT,&quot;&gt;$output&quot;;
-*STDOUT=*OUT;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$x86only = $ARGV[$#ARGV] eq &quot;386&quot;);
 &amp;static_label(&quot;AES_Te&quot;);
diff --git a/crypto/aes/asm/aes-armv4.pl b/crypto/aes/asm/aes-armv4.pl
index 456a469679..9367f1f33b 100644
--- a/crypto/aes/asm/aes-armv4.pl
+++ b/crypto/aes/asm/aes-armv4.pl
@@ -39,9 +39,10 @@
 # Profiler-assisted and platform-specific optimization resulted in 16%
 # improvement on Cortex A8 core and ~21.5 cycles per byte.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -49,9 +50,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $s0=&quot;r0&quot;;
diff --git a/crypto/aes/asm/aes-c64xplus.pl b/crypto/aes/asm/aes-c64xplus.pl
index b418c57798..d290afc0af 100644
--- a/crypto/aes/asm/aes-c64xplus.pl
+++ b/crypto/aes/asm/aes-c64xplus.pl
@@ -37,8 +37,7 @@
 #	cost of 8x increased pressure on L1D. 8x because you'd have
 #	to interleave both Te and Td tables...
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($TEA,$TEB)=(&quot;A5&quot;,&quot;B5&quot;);
 ($KPA,$KPB)=(&quot;A3&quot;,&quot;B1&quot;);
diff --git a/crypto/aes/asm/aes-mips.pl b/crypto/aes/asm/aes-mips.pl
index c93edc6ea3..c64933e93c 100644
--- a/crypto/aes/asm/aes-mips.pl
+++ b/crypto/aes/asm/aes-mips.pl
@@ -65,8 +65,12 @@
 # ($t0,$t1,$t2,$t3,$t8,$t9)=map(&quot;\$$_&quot;,(12..15,24,25));
 # ($s0,$s1,$s2,$s3,$s4,$s5,$s6,$s7)=map(&quot;\$$_&quot;,(16..23));
 # ($gp,$sp,$fp,$ra)=map(&quot;\$$_&quot;,(28..31));
-#
-$flavour = shift || &quot;o32&quot;; # supported flavours are o32,n32,64,nubi32,nubi64
+
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+$flavour ||= &quot;o32&quot;; # supported flavours are o32,n32,64,nubi32,nubi64
 
 if ($flavour =~ /64|n32/i) {
 	$PTR_LA=&quot;dla&quot;;
@@ -95,17 +99,13 @@ $pf = ($flavour =~ /nubi/i) ? $t0 : $t2;
 
 $big_endian=(`echo MIPSEB | $ENV{CC} -E -`=~/MIPSEB/)?0:1 if ($ENV{CC});
 
-for (@ARGV) {	$output=$_ if (/\w[\w\-]*\.\w+$/);	}
-open STDOUT,&quot;&gt;$output&quot;;
-
 if (!defined($big_endian))
 {    $big_endian=(unpack('L',pack('N',1))==1);   }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
-
 my ($MSB,$LSB)=(0,3);	# automatically converted to little-endian
 
+$output and open STDOUT,&quot;&gt;$output&quot;;
+
 $code.=&lt;&lt;___;
 #include &quot;mips_arch.h&quot;
 
diff --git a/crypto/aes/asm/aes-parisc.pl b/crypto/aes/asm/aes-parisc.pl
index b962e99923..96ba998656 100644
--- a/crypto/aes/asm/aes-parisc.pl
+++ b/crypto/aes/asm/aes-parisc.pl
@@ -28,9 +28,12 @@
 #
 # Special thanks to polarhome.com for providing HP-UX account.
 
-$flavour = shift;
-$output = shift;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/aes/asm/aes-ppc.pl b/crypto/aes/asm/aes-ppc.pl
index 8a3110a9a6..b235b00b83 100644
--- a/crypto/aes/asm/aes-ppc.pl
+++ b/crypto/aes/asm/aes-ppc.pl
@@ -36,7 +36,10 @@
 # ppc_AES_encrypt_compact operates at 42 cycles per byte, while
 # ppc_AES_decrypt_compact - at 55 (in 64-bit build).
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -59,7 +62,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=32*$SIZE_T;
 
diff --git a/crypto/aes/asm/aes-s390x.pl b/crypto/aes/asm/aes-s390x.pl
index 9a15091803..1affce3fd2 100644
--- a/crypto/aes/asm/aes-s390x.pl
+++ b/crypto/aes/asm/aes-s390x.pl
@@ -89,7 +89,10 @@
 # instructions, which deliver ~70% improvement at 8KB block size over
 # vanilla km-based code, 37% - at most like 512-bytes block size.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -99,8 +102,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $softonly=0;	# allow hardware support
 
diff --git a/crypto/aes/asm/aes-sparcv9.pl b/crypto/aes/asm/aes-sparcv9.pl
index c847da3692..f80638639d 100755
--- a/crypto/aes/asm/aes-sparcv9.pl
+++ b/crypto/aes/asm/aes-sparcv9.pl
@@ -37,8 +37,7 @@
 # optimal decrypt procedure]. Compared to GNU C generated code both
 # procedures are more than 60% faster:-)
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $frame=&quot;STACK_FRAME&quot;;
 $bias=&quot;STACK_BIAS&quot;;
diff --git a/crypto/aes/asm/aes-x86_64.pl b/crypto/aes/asm/aes-x86_64.pl
index 6e1dcef230..6ab747d99a 100755
--- a/crypto/aes/asm/aes-x86_64.pl
+++ b/crypto/aes/asm/aes-x86_64.pl
@@ -33,9 +33,10 @@
 #
 # (*) with hyper-threading off
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -44,7 +45,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $verticalspin=1;	# unlike 32-bit version $verticalspin performs
diff --git a/crypto/aes/asm/aesfx-sparcv9.pl b/crypto/aes/asm/aesfx-sparcv9.pl
index eea611d84c..c59970d5cf 100644
--- a/crypto/aes/asm/aesfx-sparcv9.pl
+++ b/crypto/aes/asm/aesfx-sparcv9.pl
@@ -33,8 +33,7 @@
 # instructions and improve single-block and short-input performance
 # with misaligned data.
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 {
 my ($inp,$out,$key,$rounds,$tmp,$mask) = map(&quot;%o$_&quot;,(0..5));
diff --git a/crypto/aes/asm/aesni-mb-x86_64.pl b/crypto/aes/asm/aesni-mb-x86_64.pl
index 7223de8a3d..72f55dbd0a 100644
--- a/crypto/aes/asm/aesni-mb-x86_64.pl
+++ b/crypto/aes/asm/aesni-mb-x86_64.pl
@@ -42,9 +42,10 @@
 # (*)	Sandy/Ivy Bridge are known to handle high interleave factors
 #	suboptimally;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -74,7 +75,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 # void aesni_multi_cbc_encrypt (
diff --git a/crypto/aes/asm/aesni-sha1-x86_64.pl b/crypto/aes/asm/aesni-sha1-x86_64.pl
index eb8364feb0..800bd5ffa0 100644
--- a/crypto/aes/asm/aesni-sha1-x86_64.pl
+++ b/crypto/aes/asm/aesni-sha1-x86_64.pl
@@ -88,9 +88,10 @@
 # (**)	Execution is fully dominated by integer code sequence and
 #	SIMD still hardly shows [in single-process benchmark;-]
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -114,7 +115,8 @@ $shaext=1;	### set to zero if compiling for 1.0.1
 
 $stitched_decrypt=0;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 # void aesni_cbc_sha1_enc(const void *inp,
diff --git a/crypto/aes/asm/aesni-sha256-x86_64.pl b/crypto/aes/asm/aesni-sha256-x86_64.pl
index e182ecc55a..0a1dec777b 100644
--- a/crypto/aes/asm/aesni-sha256-x86_64.pl
+++ b/crypto/aes/asm/aesni-sha256-x86_64.pl
@@ -44,9 +44,10 @@
 #	-evp aes-256-cbc-hmac-sha256' will vary by percent or two;
 # (***)	these are SHAEXT results;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -77,7 +78,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 $shaext=$avx;	### set to zero if compiling for 1.0.1
 $avx=1		if (!$shaext &amp;&amp; $avx);
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $func=&quot;aesni_cbc_sha256_enc&quot;;
diff --git a/crypto/aes/asm/aesni-x86.pl b/crypto/aes/asm/aesni-x86.pl
index 6b96195791..2d04fd6ef9 100644
--- a/crypto/aes/asm/aesni-x86.pl
+++ b/crypto/aes/asm/aesni-x86.pl
@@ -76,9 +76,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open OUT,&quot;&gt;$output&quot;;
-*STDOUT=*OUT;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/aes/asm/aesni-x86_64.pl b/crypto/aes/asm/aesni-x86_64.pl
index 406377a66f..486ebc8d95 100644
--- a/crypto/aes/asm/aesni-x86_64.pl
+++ b/crypto/aes/asm/aesni-x86_64.pl
@@ -192,9 +192,10 @@ $PREFIX=&quot;aesni&quot;;	# if $PREFIX is set to &quot;AES&quot;, the script
 			# generates drop-in replacement for
 			# crypto/aes/asm/aes-x86_64.pl:-)
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -203,7 +204,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $movkey = $PREFIX eq &quot;aesni&quot; ? &quot;movups&quot; : &quot;movups&quot;;
diff --git a/crypto/aes/asm/aesp8-ppc.pl b/crypto/aes/asm/aesp8-ppc.pl
index 44056e31aa..97734b4b1d 100755
--- a/crypto/aes/asm/aesp8-ppc.pl
+++ b/crypto/aes/asm/aesp8-ppc.pl
@@ -43,7 +43,10 @@
 # POWER9[le]	4.02/0.86	0.84	1.05
 # POWER9[be]	3.99/0.78	0.79	0.97
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -70,7 +73,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=8*$SIZE_T;
 $prefix=&quot;aes_p8&quot;;
diff --git a/crypto/aes/asm/aest4-sparcv9.pl b/crypto/aes/asm/aest4-sparcv9.pl
index cfbdda7d53..d34a7ef02a 100644
--- a/crypto/aes/asm/aest4-sparcv9.pl
+++ b/crypto/aes/asm/aest4-sparcv9.pl
@@ -75,8 +75,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;sparcv9_modes.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $::evp=1;	# if $evp is set to 0, script generates module with
 # AES_[en|de]crypt, AES_set_[en|de]crypt_key and AES_cbc_encrypt entry
diff --git a/crypto/aes/asm/aesv8-armx.pl b/crypto/aes/asm/aesv8-armx.pl
index 3b3a53bf30..c132d1d7fe 100755
--- a/crypto/aes/asm/aesv8-armx.pl
+++ b/crypto/aes/asm/aesv8-armx.pl
@@ -56,15 +56,18 @@
 # (**)	numbers after slash are for 32-bit code, which is 3x-
 #	interleaved;
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $prefix=&quot;aes_v8&quot;;
diff --git a/crypto/aes/asm/bsaes-armv7.pl b/crypto/aes/asm/bsaes-armv7.pl
index 7f5219bc75..b917dbf1e5 100644
--- a/crypto/aes/asm/bsaes-armv7.pl
+++ b/crypto/aes/asm/bsaes-armv7.pl
@@ -50,9 +50,10 @@
 # April-August 2013
 # Add CBC, CTR and XTS subroutines and adapt for kernel use; courtesy of Ard.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -60,9 +61,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 my ($inp,$out,$len,$key)=(&quot;r0&quot;,&quot;r1&quot;,&quot;r2&quot;,&quot;r3&quot;);
diff --git a/crypto/aes/asm/bsaes-x86_64.pl b/crypto/aes/asm/bsaes-x86_64.pl
index 44651d437a..6593f7a22e 100644
--- a/crypto/aes/asm/bsaes-x86_64.pl
+++ b/crypto/aes/asm/bsaes-x86_64.pl
@@ -97,9 +97,10 @@
 #
 #						&lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -108,7 +109,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my ($inp,$out,$len,$key,$ivp)=(&quot;%rdi&quot;,&quot;%rsi&quot;,&quot;%rdx&quot;,&quot;%rcx&quot;);
diff --git a/crypto/aes/asm/vpaes-armv8.pl b/crypto/aes/asm/vpaes-armv8.pl
index c7839b3208..4bf4630e3d 100755
--- a/crypto/aes/asm/vpaes-armv8.pl
+++ b/crypto/aes/asm/vpaes-armv8.pl
@@ -38,15 +38,18 @@
 #	code, but it's constant-time and therefore preferred;
 # (***)	presented for reference/comparison purposes;
 
-$flavour = shift;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $code.=&lt;&lt;___;
diff --git a/crypto/aes/asm/vpaes-ppc.pl b/crypto/aes/asm/vpaes-ppc.pl
index f77deed272..1b839e8cae 100644
--- a/crypto/aes/asm/vpaes-ppc.pl
+++ b/crypto/aes/asm/vpaes-ppc.pl
@@ -35,7 +35,10 @@
 # (**)	Inadequate POWER6 performance is due to astronomic AltiVec
 #	latency, 9 cycles per simple logical operation.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -61,7 +64,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    || die &quot;can't call $xlate: $!&quot;;
 
 $code.=&lt;&lt;___;
 .machine	&quot;any&quot;
diff --git a/crypto/aes/asm/vpaes-x86.pl b/crypto/aes/asm/vpaes-x86.pl
index 4a0491a608..c1417a8f74 100644
--- a/crypto/aes/asm/vpaes-x86.pl
+++ b/crypto/aes/asm/vpaes-x86.pl
@@ -58,9 +58,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open OUT,&quot;&gt;$output&quot;;
-*STDOUT=*OUT;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$x86only = $ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/aes/asm/vpaes-x86_64.pl b/crypto/aes/asm/vpaes-x86_64.pl
index d304003173..51ff5df4d3 100644
--- a/crypto/aes/asm/vpaes-x86_64.pl
+++ b/crypto/aes/asm/vpaes-x86_64.pl
@@ -54,9 +54,10 @@
 #
 #						&lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -65,7 +66,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $PREFIX=&quot;vpaes&quot;;
diff --git a/crypto/aes/build.info b/crypto/aes/build.info
index 0ba1758d68..aac88012b4 100644
--- a/crypto/aes/build.info
+++ b/crypto/aes/build.info
@@ -67,51 +67,48 @@ DEFINE[../../providers/fips]=$AESDEF
 
 GENERATE[aes-ia64.s]=asm/aes-ia64.S
 
-GENERATE[aes-586.s]=asm/aes-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[aes-586.s]=asm/aes-586.pl
 DEPEND[aes-586.s]=../perlasm/x86asm.pl
-GENERATE[vpaes-x86.s]=asm/vpaes-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[vpaes-x86.s]=asm/vpaes-x86.pl
 DEPEND[vpaes-586.s]=../perlasm/x86asm.pl
-GENERATE[aesni-x86.s]=asm/aesni-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[aesni-x86.s]=asm/aesni-x86.pl
 DEPEND[aesni-586.s]=../perlasm/x86asm.pl
 
-GENERATE[aes-x86_64.s]=asm/aes-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[vpaes-x86_64.s]=asm/vpaes-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[bsaes-x86_64.s]=asm/bsaes-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[aesni-x86_64.s]=asm/aesni-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[aesni-sha1-x86_64.s]=asm/aesni-sha1-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[aesni-sha256-x86_64.s]=asm/aesni-sha256-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[aesni-mb-x86_64.s]=asm/aesni-mb-x86_64.pl $(PERLASM_SCHEME)
+GENERATE[aes-x86_64.s]=asm/aes-x86_64.pl
+GENERATE[vpaes-x86_64.s]=asm/vpaes-x86_64.pl
+GENERATE[bsaes-x86_64.s]=asm/bsaes-x86_64.pl
+GENERATE[aesni-x86_64.s]=asm/aesni-x86_64.pl
+GENERATE[aesni-sha1-x86_64.s]=asm/aesni-sha1-x86_64.pl
+GENERATE[aesni-sha256-x86_64.s]=asm/aesni-sha256-x86_64.pl
+GENERATE[aesni-mb-x86_64.s]=asm/aesni-mb-x86_64.pl
 
-GENERATE[aes-sparcv9.S]=asm/aes-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[aes-sparcv9.S]=asm/aes-sparcv9.pl
 INCLUDE[aes-sparcv9.o]=..
-GENERATE[aest4-sparcv9.S]=asm/aest4-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[aest4-sparcv9.S]=asm/aest4-sparcv9.pl
 INCLUDE[aest4-sparcv9.o]=..
 DEPEND[aest4-sparcv9.S]=../perlasm/sparcv9_modes.pl
-GENERATE[aesfx-sparcv9.S]=asm/aesfx-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[aesfx-sparcv9.S]=asm/aesfx-sparcv9.pl
 INCLUDE[aesfx-sparcv9.o]=..
 
-GENERATE[aes-ppc.s]=asm/aes-ppc.pl $(PERLASM_SCHEME)
-GENERATE[vpaes-ppc.s]=asm/vpaes-ppc.pl $(PERLASM_SCHEME)
-GENERATE[aesp8-ppc.s]=asm/aesp8-ppc.pl $(PERLASM_SCHEME)
+GENERATE[aes-ppc.s]=asm/aes-ppc.pl
+GENERATE[vpaes-ppc.s]=asm/vpaes-ppc.pl
+GENERATE[aesp8-ppc.s]=asm/aesp8-ppc.pl
 
-GENERATE[aes-parisc.s]=asm/aes-parisc.pl $(PERLASM_SCHEME)
+GENERATE[aes-parisc.s]=asm/aes-parisc.pl
 
-GENERATE[aes-mips.S]=asm/aes-mips.pl $(PERLASM_SCHEME)
+GENERATE[aes-mips.S]=asm/aes-mips.pl
 INCLUDE[aes-mips.o]=..
 
-GENERATE[aesv8-armx.S]=asm/aesv8-armx.pl $(PERLASM_SCHEME)
+GENERATE[aesv8-armx.S]=asm/aesv8-armx.pl
 INCLUDE[aesv8-armx.o]=..
-GENERATE[vpaes-armv8.S]=asm/vpaes-armv8.pl $(PERLASM_SCHEME)
+GENERATE[vpaes-armv8.S]=asm/vpaes-armv8.pl
 
-GENERATE[aes-armv4.S]=asm/aes-armv4.pl $(PERLASM_SCHEME)
+GENERATE[aes-armv4.S]=asm/aes-armv4.pl
 INCLUDE[aes-armv4.o]=..
-GENERATE[bsaes-armv7.S]=asm/bsaes-armv7.pl $(PERLASM_SCHEME)
+GENERATE[bsaes-armv7.S]=asm/bsaes-armv7.pl
 INCLUDE[bsaes-armv7.o]=..
 
-GENERATE[aes-s390x.S]=asm/aes-s390x.pl $(PERLASM_SCHEME)
+GENERATE[aes-s390x.S]=asm/aes-s390x.pl
 INCLUDE[aes-s390x.o]=..
 
-GENERATE[aes-c64xplus.S]=asm/aes-c64xplus.pl $(PERLASM_SCHEME)
+GENERATE[aes-c64xplus.S]=asm/aes-c64xplus.pl
diff --git a/crypto/alphacpuid.pl b/crypto/alphacpuid.pl
index 5abb82d133..50a413438f 100644
--- a/crypto/alphacpuid.pl
+++ b/crypto/alphacpuid.pl
@@ -7,8 +7,7 @@
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 print &lt;&lt;'___';
 .text
diff --git a/crypto/arm64cpuid.pl b/crypto/arm64cpuid.pl
index f25c6373a4..920277666c 100755
--- a/crypto/arm64cpuid.pl
+++ b/crypto/arm64cpuid.pl
@@ -7,15 +7,18 @@
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $code.=&lt;&lt;___;
diff --git a/crypto/armv4cpuid.pl b/crypto/armv4cpuid.pl
index f8aeec64f0..6367cbffd7 100644
--- a/crypto/armv4cpuid.pl
+++ b/crypto/armv4cpuid.pl
@@ -7,15 +7,18 @@
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $code.=&lt;&lt;___;
diff --git a/crypto/bf/asm/bf-586.pl b/crypto/bf/asm/bf-586.pl
index 91b17c1b58..8622f5b12a 100644
--- a/crypto/bf/asm/bf-586.pl
+++ b/crypto/bf/asm/bf-586.pl
@@ -12,8 +12,7 @@ push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 require &quot;cbc.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/bf/build.info b/crypto/bf/build.info
index cc06212dfc..59d5bbcfe3 100644
--- a/crypto/bf/build.info
+++ b/crypto/bf/build.info
@@ -13,6 +13,5 @@ ENDIF
 
 SOURCE[../../libcrypto]=bf_skey.c bf_ecb.c bf_cfb64.c bf_ofb64.c $BFASM
 
-GENERATE[bf-586.s]=asm/bf-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[bf-586.s]=asm/bf-586.pl
 DEPEND[bf-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/bn/asm/alpha-mont.pl b/crypto/bn/asm/alpha-mont.pl
index 2d282a1f7a..b46c79ca4f 100644
--- a/crypto/bn/asm/alpha-mont.pl
+++ b/crypto/bn/asm/alpha-mont.pl
@@ -22,8 +22,7 @@
 # I.e. if you compare 1GHz 21264 and 2GHz Opteron, you'll observe ~2x
 # difference.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 # int bn_mul_mont(
 $rp=&quot;a0&quot;;	# BN_ULONG *rp,
diff --git a/crypto/bn/asm/armv4-gf2m.pl b/crypto/bn/asm/armv4-gf2m.pl
index 0bf6f63ec5..e7a865581f 100644
--- a/crypto/bn/asm/armv4-gf2m.pl
+++ b/crypto/bn/asm/armv4-gf2m.pl
@@ -39,9 +39,10 @@
 #
 # <A HREF="http://conradoplg.cryptoland.net/files/2010/12/mocrysen13.pdf">http://conradoplg.cryptoland.net/files/2010/12/mocrysen13.pdf</A>
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -49,9 +50,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $1&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $code=&lt;&lt;___;
diff --git a/crypto/bn/asm/armv4-mont.pl b/crypto/bn/asm/armv4-mont.pl
index 7e0a4d8145..72c883fe9f 100644
--- a/crypto/bn/asm/armv4-mont.pl
+++ b/crypto/bn/asm/armv4-mont.pl
@@ -54,9 +54,10 @@
 # integer-only on Cortex-A8, ~10-210% on Cortex-A15, ~70-450% on
 # Snapdragon S4.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+my $flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -64,9 +65,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $1&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $num=&quot;r0&quot;;	# starts as num argument, but holds &amp;tp[num-1]
diff --git a/crypto/bn/asm/armv8-mont.pl b/crypto/bn/asm/armv8-mont.pl
index c755555d88..3e92881bc0 100755
--- a/crypto/bn/asm/armv8-mont.pl
+++ b/crypto/bn/asm/armv8-mont.pl
@@ -40,15 +40,18 @@
 # 50-70% improvement for RSA4096 sign. RSA2048 sign is ~25% faster
 # on Cortex-A57 and ~60-100% faster on others.
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+my $flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $1&quot;;
 *STDOUT=*OUT;
 
 ($lo0,$hi0,$aj,$m0,$alo,$ahi,
diff --git a/crypto/bn/asm/bn-586.pl b/crypto/bn/asm/bn-586.pl
index 12b51953ab..287162161c 100644
--- a/crypto/bn/asm/bn-586.pl
+++ b/crypto/bn/asm/bn-586.pl
@@ -11,8 +11,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/bn/asm/c64xplus-gf2m.pl b/crypto/bn/asm/c64xplus-gf2m.pl
index c77fc5eef4..d4913867d0 100644
--- a/crypto/bn/asm/c64xplus-gf2m.pl
+++ b/crypto/bn/asm/c64xplus-gf2m.pl
@@ -23,8 +23,7 @@
 # totally unfair, because this module utilizes Galois Field Multiply
 # instruction.
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($rp,$a1,$a0,$b1,$b0)=(&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;,&quot;B6&quot;,&quot;A8&quot;);   # argument vector
 
diff --git a/crypto/bn/asm/co-586.pl b/crypto/bn/asm/co-586.pl
index a0f5a46979..d9263094b4 100644
--- a/crypto/bn/asm/co-586.pl
+++ b/crypto/bn/asm/co-586.pl
@@ -10,8 +10,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/bn/asm/ia64-mont.pl b/crypto/bn/asm/ia64-mont.pl
index 1ab5d94eaa..ce51b17ef9 100644
--- a/crypto/bn/asm/ia64-mont.pl
+++ b/crypto/bn/asm/ia64-mont.pl
@@ -67,7 +67,8 @@
 # hereafter less for longer keys, while verify - by 74-13%.
 # DSA performance improves by 115-30%.
 
-$output=pop;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
 
 if ($^O eq &quot;hpux&quot;) {
     $ADDP=&quot;addp4&quot;;
diff --git a/crypto/bn/asm/mips-mont.pl b/crypto/bn/asm/mips-mont.pl
index 3386128ab8..c0b4629184 100644
--- a/crypto/bn/asm/mips-mont.pl
+++ b/crypto/bn/asm/mips-mont.pl
@@ -52,8 +52,12 @@
 # ($t0,$t1,$t2,$t3,$t8,$t9)=map(&quot;\$$_&quot;,(12..15,24,25));
 # ($s0,$s1,$s2,$s3,$s4,$s5,$s6,$s7)=map(&quot;\$$_&quot;,(16..23));
 # ($gp,$sp,$fp,$ra)=map(&quot;\$$_&quot;,(28..31));
-#
-$flavour = shift || &quot;o32&quot;; # supported flavours are o32,n32,64,nubi32,nubi64
+
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+# supported flavours are o32,n32,64,nubi32,nubi64, default is o32
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : &quot;o32&quot;;
 
 if ($flavour =~ /64|n32/i) {
 	$PTR_ADD=&quot;daddu&quot;;	# incidentally works even on n32
@@ -74,8 +78,7 @@ $SAVED_REGS_MASK = ($flavour =~ /nubi/i) ? 0x00fff000 : 0x00ff0000;
 #
 ######################################################################
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64|n32/i) {
 	$LD=&quot;ld&quot;;
diff --git a/crypto/bn/asm/mips.pl b/crypto/bn/asm/mips.pl
index 35971769a6..af44c9786e 100644
--- a/crypto/bn/asm/mips.pl
+++ b/crypto/bn/asm/mips.pl
@@ -54,9 +54,10 @@
 # has to content with 40-85% improvement depending on benchmark and
 # key length, more for longer keys.
 
-$flavour = shift || &quot;o32&quot;;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : &quot;o32&quot;;
 
 if ($flavour =~ /64|n32/i) {
 	$LD=&quot;ld&quot;;
@@ -91,6 +92,8 @@ if ($flavour =~ /64|n32/i) {
 	$code=&quot;#if !(defined (__mips_isa_rev) &amp;&amp; (__mips_isa_rev &gt;= 6))\n.set     mips2\n#endif\n&quot;;
 }
 
+$output and open STDOUT,&quot;&gt;$output&quot;;
+
 # Below is N32/64 register layout used in the original module.
 #
 ($zero,$at,$v0,$v1)=map(&quot;\$$_&quot;,(0..3));
diff --git a/crypto/bn/asm/parisc-mont.pl b/crypto/bn/asm/parisc-mont.pl
index 1d66c21f05..1420840d62 100644
--- a/crypto/bn/asm/parisc-mont.pl
+++ b/crypto/bn/asm/parisc-mont.pl
@@ -69,10 +69,12 @@
 

 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 
-$flavour = shift;
-$output = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/bn/asm/ppc-mont.pl b/crypto/bn/asm/ppc-mont.pl
index 6e6f3a65b8..01c8d11bae 100644
--- a/crypto/bn/asm/ppc-mont.pl
+++ b/crypto/bn/asm/ppc-mont.pl
@@ -41,7 +41,10 @@
 # builds. On low-end 32-bit processors performance improvement turned
 # to be marginal...
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /32/) {
 	$BITS=	32;
@@ -94,7 +97,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $sp=&quot;r1&quot;;
 $toc=&quot;r2&quot;;
diff --git a/crypto/bn/asm/ppc.pl b/crypto/bn/asm/ppc.pl
index 21f69636c8..4b4e6c6100 100644
--- a/crypto/bn/asm/ppc.pl
+++ b/crypto/bn/asm/ppc.pl
@@ -103,7 +103,10 @@
 #        Performance increase of ~60%
 #        Based on submission from Suresh N. Chari of IBM
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /32/) {
 	$BITS=	32;
@@ -159,7 +162,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $data=&lt;&lt;EOF;
 #--------------------------------------------------------------------
diff --git a/crypto/bn/asm/ppc64-mont.pl b/crypto/bn/asm/ppc64-mont.pl
index b0277d95d6..4420a14a0a 100644
--- a/crypto/bn/asm/ppc64-mont.pl
+++ b/crypto/bn/asm/ppc64-mont.pl
@@ -80,7 +80,10 @@
 # ppc-mont.pl, but improvement coefficient is not as impressive
 # for longer keys...
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /32/) {
 	$SIZE_T=4;
@@ -108,7 +111,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=64;	# padded frame header
 $TRANSFER=16*8;
diff --git a/crypto/bn/asm/rsaz-avx2.pl b/crypto/bn/asm/rsaz-avx2.pl
index fddb12ffff..66822abed4 100755
--- a/crypto/bn/asm/rsaz-avx2.pl
+++ b/crypto/bn/asm/rsaz-avx2.pl
@@ -37,9 +37,10 @@
 # (***)	scalar AD*X code is faster than AVX2 and is preferred code
 #	path for Broadwell;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -72,7 +73,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|based on LLVM) ([3-
 	$addx = ($ver&gt;=3.03);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT = *OUT;
 
 if ($avx&gt;1) {{{
diff --git a/crypto/bn/asm/rsaz-x86_64.pl b/crypto/bn/asm/rsaz-x86_64.pl
index e3fe2e7cc4..c41d8e521e 100755
--- a/crypto/bn/asm/rsaz-x86_64.pl
+++ b/crypto/bn/asm/rsaz-x86_64.pl
@@ -52,9 +52,10 @@
 #	purposes;
 # (**)	MULX was attempted, but found to give only marginal improvement;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -63,7 +64,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if (`$ENV{CC} -Wa,-v -c -o /dev/null -x assembler /dev/null 2&gt;&amp;1`
diff --git a/crypto/bn/asm/s390x-gf2m.pl b/crypto/bn/asm/s390x-gf2m.pl
index afe8d35548..85e5eaa84f 100644
--- a/crypto/bn/asm/s390x-gf2m.pl
+++ b/crypto/bn/asm/s390x-gf2m.pl
@@ -32,7 +32,10 @@
 #	so that improvement coefficients can vary from one specific
 #	setup to another.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
         $SIZE_T=4;
@@ -42,8 +45,7 @@ if ($flavour =~ /3[12]/) {
         $g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $stdframe=16*$SIZE_T+4*8;
 
diff --git a/crypto/bn/asm/s390x-mont.pl b/crypto/bn/asm/s390x-mont.pl
index 2e823989e3..00b2d46798 100644
--- a/crypto/bn/asm/s390x-mont.pl
+++ b/crypto/bn/asm/s390x-mont.pl
@@ -51,7 +51,10 @@
 # On z990 it was measured to perform 2.6-2.2 times better than
 # compiler-generated code, less for longer keys...
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -61,8 +64,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $stdframe=16*$SIZE_T+4*8;
 
diff --git a/crypto/bn/asm/sparct4-mont.pl b/crypto/bn/asm/sparct4-mont.pl
index 8e981be2a5..76fffaf268 100755
--- a/crypto/bn/asm/sparct4-mont.pl
+++ b/crypto/bn/asm/sparct4-mont.pl
@@ -83,8 +83,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;sparcv9_modes.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $code.=&lt;&lt;___;
 #include &quot;sparc_arch.h&quot;
diff --git a/crypto/bn/asm/sparcv9-gf2m.pl b/crypto/bn/asm/sparcv9-gf2m.pl
index d2973f0bcd..d4dda79219 100644
--- a/crypto/bn/asm/sparcv9-gf2m.pl
+++ b/crypto/bn/asm/sparcv9-gf2m.pl
@@ -25,8 +25,7 @@
 # ~100-230% faster than gcc-generated code and ~35-90% faster than
 # the pure SPARCv9 code path.
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $locals=16*8;
 
diff --git a/crypto/bn/asm/sparcv9-mont.pl b/crypto/bn/asm/sparcv9-mont.pl
index 04c22f8d11..6348c2a63b 100644
--- a/crypto/bn/asm/sparcv9-mont.pl
+++ b/crypto/bn/asm/sparcv9-mont.pl
@@ -49,8 +49,7 @@
 # module still have hidden potential [see TODO list there], which is
 # estimated to be larger than 20%...
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 # int bn_mul_mont(
 $rp=&quot;%i0&quot;;	# BN_ULONG *rp,
diff --git a/crypto/bn/asm/sparcv9a-mont.pl b/crypto/bn/asm/sparcv9a-mont.pl
index af22d41306..a1170c7639 100755
--- a/crypto/bn/asm/sparcv9a-mont.pl
+++ b/crypto/bn/asm/sparcv9a-mont.pl
@@ -62,8 +62,10 @@
 # key length, more for longer keys] on USI&amp;II cores and 30-80% - on
 # USIII&amp;IV.
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $fname=&quot;bn_mul_mont_fpu&quot;;
 
diff --git a/crypto/bn/asm/via-mont.pl b/crypto/bn/asm/via-mont.pl
index 1b5cdd8f3a..d873082d4b 100644
--- a/crypto/bn/asm/via-mont.pl
+++ b/crypto/bn/asm/via-mont.pl
@@ -88,8 +88,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/bn/asm/vis3-mont.pl b/crypto/bn/asm/vis3-mont.pl
index 9e8f498f97..53f9920efe 100644
--- a/crypto/bn/asm/vis3-mont.pl
+++ b/crypto/bn/asm/vis3-mont.pl
@@ -25,8 +25,7 @@
 # for reference purposes, because T4 has dedicated Montgomery
 # multiplication and squaring *instructions* that deliver even more.
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $frame = &quot;STACK_FRAME&quot;;
 $bias = &quot;STACK_BIAS&quot;;
diff --git a/crypto/bn/asm/x86-gf2m.pl b/crypto/bn/asm/x86-gf2m.pl
index 8bcfcb4f8e..bcc6de08a9 100644
--- a/crypto/bn/asm/x86-gf2m.pl
+++ b/crypto/bn/asm/x86-gf2m.pl
@@ -43,8 +43,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$x86only = $ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/bn/asm/x86-mont.pl b/crypto/bn/asm/x86-mont.pl
index 22baf8fc26..864816fb1a 100755
--- a/crypto/bn/asm/x86-mont.pl
+++ b/crypto/bn/asm/x86-mont.pl
@@ -37,8 +37,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/bn/asm/x86_64-gf2m.pl b/crypto/bn/asm/x86_64-gf2m.pl
index d0a73575e0..f312a0c72a 100644
--- a/crypto/bn/asm/x86_64-gf2m.pl
+++ b/crypto/bn/asm/x86_64-gf2m.pl
@@ -27,9 +27,10 @@
 # these coefficients are not ones for bn_GF2m_mul_2x2 itself, as not
 # all CPU time is burnt in it...
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -38,7 +39,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 ($lo,$hi)=(&quot;%rax&quot;,&quot;%rdx&quot;);	$a=$lo;
diff --git a/crypto/bn/asm/x86_64-mont.pl b/crypto/bn/asm/x86_64-mont.pl
index ede009fc16..aa06345fa2 100755
--- a/crypto/bn/asm/x86_64-mont.pl
+++ b/crypto/bn/asm/x86_64-mont.pl
@@ -46,9 +46,10 @@
 #
 # Add MULX/ADOX/ADCX code path.
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -57,7 +58,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if (`$ENV{CC} -Wa,-v -c -o /dev/null -x assembler /dev/null 2&gt;&amp;1`
diff --git a/crypto/bn/asm/x86_64-mont5.pl b/crypto/bn/asm/x86_64-mont5.pl
index 6331566c0c..d6d2764e22 100755
--- a/crypto/bn/asm/x86_64-mont5.pl
+++ b/crypto/bn/asm/x86_64-mont5.pl
@@ -31,9 +31,10 @@
 # the np argument is not just modulus value, but one interleaved
 # with 0. This is to optimize post-condition...
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -42,7 +43,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if (`$ENV{CC} -Wa,-v -c -o /dev/null -x assembler /dev/null 2&gt;&amp;1`
diff --git a/crypto/bn/build.info b/crypto/bn/build.info
index c2df4e07c9..669256d8e3 100644
--- a/crypto/bn/build.info
+++ b/crypto/bn/build.info
@@ -116,58 +116,54 @@ INCLUDE[../../libcrypto]=../../crypto/include
 
 INCLUDE[bn_exp.o]=..
 
-GENERATE[bn-586.s]=asm/bn-586.pl \
-	$(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[bn-586.s]=asm/bn-586.pl
 DEPEND[bn-586.s]=../perlasm/x86asm.pl
-GENERATE[co-586.s]=asm/co-586.pl \
-	$(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[co-586.s]=asm/co-586.pl
 DEPEND[co-586.s]=../perlasm/x86asm.pl
-GENERATE[x86-mont.s]=asm/x86-mont.pl \
-	$(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[x86-mont.s]=asm/x86-mont.pl
 DEPEND[x86-mont.s]=../perlasm/x86asm.pl
-GENERATE[x86-gf2m.s]=asm/x86-gf2m.pl \
-	$(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[x86-gf2m.s]=asm/x86-gf2m.pl
 DEPEND[x86-gf2m.s]=../perlasm/x86asm.pl
 
-GENERATE[sparcv9a-mont.S]=asm/sparcv9a-mont.pl $(PERLASM_SCHEME)
+GENERATE[sparcv9a-mont.S]=asm/sparcv9a-mont.pl
 INCLUDE[sparcv9a-mont.o]=..
-GENERATE[sparcv9-mont.S]=asm/sparcv9-mont.pl $(PERLASM_SCHEME)
+GENERATE[sparcv9-mont.S]=asm/sparcv9-mont.pl
 INCLUDE[sparcv9-mont.o]=..
-GENERATE[vis3-mont.S]=asm/vis3-mont.pl $(PERLASM_SCHEME)
+GENERATE[vis3-mont.S]=asm/vis3-mont.pl
 INCLUDE[vis3-mont.o]=..
-GENERATE[sparct4-mont.S]=asm/sparct4-mont.pl $(PERLASM_SCHEME)
+GENERATE[sparct4-mont.S]=asm/sparct4-mont.pl
 INCLUDE[sparct4-mont.o]=..
-GENERATE[sparcv9-gf2m.S]=asm/sparcv9-gf2m.pl $(PERLASM_SCHEME)
+GENERATE[sparcv9-gf2m.S]=asm/sparcv9-gf2m.pl
 INCLUDE[sparcv9-gf2m.o]=..
 
-GENERATE[bn-mips.S]=asm/mips.pl $(PERLASM_SCHEME)
+GENERATE[bn-mips.S]=asm/mips.pl
 INCLUDE[bn-mips.o]=..
-GENERATE[mips-mont.S]=asm/mips-mont.pl $(PERLASM_SCHEME)
+GENERATE[mips-mont.S]=asm/mips-mont.pl
 INCLUDE[mips-mont.o]=..
 
-GENERATE[s390x-mont.S]=asm/s390x-mont.pl $(PERLASM_SCHEME)
-GENERATE[s390x-gf2m.s]=asm/s390x-gf2m.pl $(PERLASM_SCHEME)
+GENERATE[s390x-mont.S]=asm/s390x-mont.pl
+GENERATE[s390x-gf2m.s]=asm/s390x-gf2m.pl
 
-GENERATE[x86_64-mont.s]=asm/x86_64-mont.pl $(PERLASM_SCHEME)
-GENERATE[x86_64-mont5.s]=asm/x86_64-mont5.pl $(PERLASM_SCHEME)
-GENERATE[x86_64-gf2m.s]=asm/x86_64-gf2m.pl $(PERLASM_SCHEME)
-GENERATE[rsaz-x86_64.s]=asm/rsaz-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[rsaz-avx2.s]=asm/rsaz-avx2.pl $(PERLASM_SCHEME)
+GENERATE[x86_64-mont.s]=asm/x86_64-mont.pl
+GENERATE[x86_64-mont5.s]=asm/x86_64-mont5.pl
+GENERATE[x86_64-gf2m.s]=asm/x86_64-gf2m.pl
+GENERATE[rsaz-x86_64.s]=asm/rsaz-x86_64.pl
+GENERATE[rsaz-avx2.s]=asm/rsaz-avx2.pl
 
 GENERATE[bn-ia64.s]=asm/ia64.S
-GENERATE[ia64-mont.s]=asm/ia64-mont.pl $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[ia64-mont.s]=asm/ia64-mont.pl
 
-GENERATE[parisc-mont.s]=asm/parisc-mont.pl $(PERLASM_SCHEME)
+GENERATE[parisc-mont.s]=asm/parisc-mont.pl
 
 # ppc - AIX, Linux, MacOS X...
-GENERATE[bn-ppc.s]=asm/ppc.pl $(PERLASM_SCHEME)
-GENERATE[ppc-mont.s]=asm/ppc-mont.pl $(PERLASM_SCHEME)
-GENERATE[ppc64-mont.s]=asm/ppc64-mont.pl $(PERLASM_SCHEME)
+GENERATE[bn-ppc.s]=asm/ppc.pl
+GENERATE[ppc-mont.s]=asm/ppc-mont.pl
+GENERATE[ppc64-mont.s]=asm/ppc64-mont.pl
 
-GENERATE[alpha-mont.S]=asm/alpha-mont.pl $(PERLASM_SCHEME)
+GENERATE[alpha-mont.S]=asm/alpha-mont.pl
 
-GENERATE[armv4-mont.S]=asm/armv4-mont.pl $(PERLASM_SCHEME)
+GENERATE[armv4-mont.S]=asm/armv4-mont.pl
 INCLUDE[armv4-mont.o]=..
-GENERATE[armv4-gf2m.S]=asm/armv4-gf2m.pl $(PERLASM_SCHEME)
+GENERATE[armv4-gf2m.S]=asm/armv4-gf2m.pl
 INCLUDE[armv4-gf2m.o]=..
-GENERATE[armv8-mont.S]=asm/armv8-mont.pl $(PERLASM_SCHEME)
+GENERATE[armv8-mont.S]=asm/armv8-mont.pl
diff --git a/crypto/build.info b/crypto/build.info
index 961bfd6f60..6c77f95108 100644
--- a/crypto/build.info
+++ b/crypto/build.info
@@ -86,25 +86,24 @@ DEPEND[cversion.o]=buildinf.h
 GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(LIB_CFLAGS) $(CPPFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
 DEPEND[buildinf.h]=../configdata.pm
 
-GENERATE[uplink-x86.s]=../ms/uplink-x86.pl $(PERLASM_SCHEME)
-GENERATE[uplink-x86_64.s]=../ms/uplink-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[uplink-ia64.s]=../ms/uplink-ia64.pl $(PERLASM_SCHEME)
+GENERATE[uplink-x86.s]=../ms/uplink-x86.pl
+GENERATE[uplink-x86_64.s]=../ms/uplink-x86_64.pl
+GENERATE[uplink-ia64.s]=../ms/uplink-ia64.pl
 
-GENERATE[x86cpuid.s]=x86cpuid.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[x86cpuid.s]=x86cpuid.pl
 DEPEND[x86cpuid.s]=perlasm/x86asm.pl
 
-GENERATE[x86_64cpuid.s]=x86_64cpuid.pl $(PERLASM_SCHEME)
+GENERATE[x86_64cpuid.s]=x86_64cpuid.pl
 
 GENERATE[ia64cpuid.s]=ia64cpuid.S
-GENERATE[ppccpuid.s]=ppccpuid.pl $(PERLASM_SCHEME)
-GENERATE[pariscid.s]=pariscid.pl $(PERLASM_SCHEME)
+GENERATE[ppccpuid.s]=ppccpuid.pl
+GENERATE[pariscid.s]=pariscid.pl
 GENERATE[alphacpuid.s]=alphacpuid.pl
-GENERATE[arm64cpuid.S]=arm64cpuid.pl $(PERLASM_SCHEME)
+GENERATE[arm64cpuid.S]=arm64cpuid.pl
 INCLUDE[arm64cpuid.o]=.
-GENERATE[armv4cpuid.S]=armv4cpuid.pl $(PERLASM_SCHEME)
+GENERATE[armv4cpuid.S]=armv4cpuid.pl
 INCLUDE[armv4cpuid.o]=.
-GENERATE[s390xcpuid.S]=s390xcpuid.pl $(PERLASM_SCHEME)
+GENERATE[s390xcpuid.S]=s390xcpuid.pl
 INCLUDE[s390xcpuid.o]=.
 
 IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
diff --git a/crypto/camellia/asm/cmll-x86.pl b/crypto/camellia/asm/cmll-x86.pl
index 5d20669597..1a3ec88b39 100644
--- a/crypto/camellia/asm/cmll-x86.pl
+++ b/crypto/camellia/asm/cmll-x86.pl
@@ -49,8 +49,7 @@ require &quot;x86asm.pl&quot;;
 
 $OPENSSL=1;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/camellia/asm/cmll-x86_64.pl b/crypto/camellia/asm/cmll-x86_64.pl
index 8bebc808a9..bd1e4c060f 100644
--- a/crypto/camellia/asm/cmll-x86_64.pl
+++ b/crypto/camellia/asm/cmll-x86_64.pl
@@ -36,9 +36,10 @@
 # EM64T, pre-Core2 Intel x86_64 CPU, is not as impressive, because it
 # apparently emulates some of 64-bit operations in [32-bit] microcode.
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -47,7 +48,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 sub hi() { my $r=shift; $r =~ s/%[er]([a-d])x/%\1h/;    $r; }
diff --git a/crypto/camellia/asm/cmllt4-sparcv9.pl b/crypto/camellia/asm/cmllt4-sparcv9.pl
index 3b2a7050f5..0b3448ee58 100644
--- a/crypto/camellia/asm/cmllt4-sparcv9.pl
+++ b/crypto/camellia/asm/cmllt4-sparcv9.pl
@@ -53,8 +53,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;sparcv9_modes.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $::evp=1;	# if $evp is set to 0, script generates module with
 # Camellia_[en|de]crypt, Camellia_set_key and Camellia_cbc_encrypt
diff --git a/crypto/camellia/build.info b/crypto/camellia/build.info
index 8d74b9f095..c10babc726 100644
--- a/crypto/camellia/build.info
+++ b/crypto/camellia/build.info
@@ -15,11 +15,9 @@ ENDIF
 
 SOURCE[../../libcrypto]=cmll_ecb.c cmll_ofb.c cmll_cfb.c cmll_ctr.c $CMLLASM
 
-GENERATE[cmll-x86.s]=asm/cmll-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) \
-        $(PROCESSOR)
+GENERATE[cmll-x86.s]=asm/cmll-x86.pl
 DEPEND[cmll-x86.s]=../perlasm/x86asm.pl
-GENERATE[cmll-x86_64.s]=asm/cmll-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[cmllt4-sparcv9.S]=asm/cmllt4-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[cmll-x86_64.s]=asm/cmll-x86_64.pl
+GENERATE[cmllt4-sparcv9.S]=asm/cmllt4-sparcv9.pl
 INCLUDE[cmllt4-sparcv9.o]=..
 DEPEND[cmllt4-sparcv9.S]=../perlasm/sparcv9_modes.pl
diff --git a/crypto/cast/asm/cast-586.pl b/crypto/cast/asm/cast-586.pl
index ad47b406da..9e8d7d9b43 100644
--- a/crypto/cast/asm/cast-586.pl
+++ b/crypto/cast/asm/cast-586.pl
@@ -18,8 +18,7 @@ push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 require &quot;cbc.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/cast/build.info b/crypto/cast/build.info
index 97779c2250..e21e6d55ee 100644
--- a/crypto/cast/build.info
+++ b/crypto/cast/build.info
@@ -14,6 +14,5 @@ ENDIF
 
 SOURCE[../../libcrypto]=c_skey.c c_ecb.c $CASTASM c_cfb64.c c_ofb64.c
 
-GENERATE[cast-586.s]=asm/cast-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[cast-586.s]=asm/cast-586.pl
 DEPEND[cast-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/chacha/asm/chacha-armv4.pl b/crypto/chacha/asm/chacha-armv4.pl
index c4402961d4..8a9f6c4f19 100755
--- a/crypto/chacha/asm/chacha-armv4.pl
+++ b/crypto/chacha/asm/chacha-armv4.pl
@@ -34,9 +34,10 @@
 #	but then Snapdragon S4 and Cortex-A8 results get
 #	20-25% worse;
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -44,9 +45,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 sub AUTOLOAD()		# thunk [simplified] x86-style perlasm
diff --git a/crypto/chacha/asm/chacha-armv8.pl b/crypto/chacha/asm/chacha-armv8.pl
index 1f51017388..aed873d57e 100755
--- a/crypto/chacha/asm/chacha-armv8.pl
+++ b/crypto/chacha/asm/chacha-armv8.pl
@@ -44,15 +44,18 @@
 #
 # (*)	slower than 4+1:-(
 
-$flavour=shift;
-$output=shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 sub AUTOLOAD()		# thunk [simplified] x86-style perlasm
diff --git a/crypto/chacha/asm/chacha-c64xplus.pl b/crypto/chacha/asm/chacha-c64xplus.pl
index d81d8ce775..dfa89229b0 100755
--- a/crypto/chacha/asm/chacha-c64xplus.pl
+++ b/crypto/chacha/asm/chacha-c64xplus.pl
@@ -24,8 +24,7 @@
 # dependent on input length. This module on the other hand is free
 # from such limitation.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($OUT,$INP,$LEN,$KEYB,$COUNTERA)=(&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;,&quot;B6&quot;,&quot;A8&quot;);
 ($KEYA,$COUNTERB,$STEP)=(&quot;A7&quot;,&quot;B7&quot;,&quot;A3&quot;);
diff --git a/crypto/chacha/asm/chacha-ia64.pl b/crypto/chacha/asm/chacha-ia64.pl
index dd090603a9..e3641426fc 100644
--- a/crypto/chacha/asm/chacha-ia64.pl
+++ b/crypto/chacha/asm/chacha-ia64.pl
@@ -15,8 +15,7 @@
 # pass runs slower than expected... Overall result is 15.6 cpb, two
 # cycles more than theoretical estimate.
 
-$output = pop;
-open STDOUT, &quot;&gt;$output&quot; if $output;
+$output = pop and open STDOUT, &quot;&gt;$output&quot;;
 
 my @k = map(&quot;r$_&quot;,(16..31));
 my @x = map(&quot;r$_&quot;,(38..53));
diff --git a/crypto/chacha/asm/chacha-ppc.pl b/crypto/chacha/asm/chacha-ppc.pl
index b1cb0bdc66..1db31fa978 100755
--- a/crypto/chacha/asm/chacha-ppc.pl
+++ b/crypto/chacha/asm/chacha-ppc.pl
@@ -44,7 +44,10 @@
 #	instructions, which is why switch to vector-only code pays
 #	off that much;
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -69,7 +72,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $LOCALS=6*$SIZE_T;
 $FRAME=$LOCALS+64+18*$SIZE_T;	# 64 is for local variables
diff --git a/crypto/chacha/asm/chacha-s390x.pl b/crypto/chacha/asm/chacha-s390x.pl
index 1f22b26147..1f577b86cd 100755
--- a/crypto/chacha/asm/chacha-s390x.pl
+++ b/crypto/chacha/asm/chacha-s390x.pl
@@ -42,7 +42,10 @@ use FindBin qw($Bin);
 use lib &quot;$Bin/../..&quot;;
 use perlasm::s390x qw(:DEFAULT :VX :LD AUTOLOAD LABEL INCLUDE);
 
-my $flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+my $flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 my ($z,$SIZE_T);
 if ($flavour =~ /3[12]/) {
@@ -53,9 +56,6 @@ if ($flavour =~ /3[12]/) {
 	$SIZE_T=8;
 }
 
-my $output;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-
 my $sp=&quot;%r15&quot;;
 my $stdframe=16*$SIZE_T+4*8;
 
diff --git a/crypto/chacha/asm/chacha-x86.pl b/crypto/chacha/asm/chacha-x86.pl
index 5fec22eccf..bcd8eb4b6a 100755
--- a/crypto/chacha/asm/chacha-x86.pl
+++ b/crypto/chacha/asm/chacha-x86.pl
@@ -40,8 +40,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/chacha/asm/chacha-x86_64.pl b/crypto/chacha/asm/chacha-x86_64.pl
index 5584f01704..b854e2e332 100755
--- a/crypto/chacha/asm/chacha-x86_64.pl
+++ b/crypto/chacha/asm/chacha-x86_64.pl
@@ -58,9 +58,10 @@
 # (vi)	even though Skylake-X can execute AVX512F code and deliver 0.57
 #	cpb in single thread, the corresponding capability is suppressed;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -89,7 +90,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 # input parameter block
diff --git a/crypto/chacha/build.info b/crypto/chacha/build.info
index e8eeaf0ce9..9757739682 100644
--- a/crypto/chacha/build.info
+++ b/crypto/chacha/build.info
@@ -26,15 +26,14 @@ ENDIF
 
 SOURCE[../../libcrypto]=$CHACHAASM
 
-GENERATE[chacha-x86.s]=asm/chacha-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
-GENERATE[chacha-x86_64.s]=asm/chacha-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[chacha-ppc.s]=asm/chacha-ppc.pl $(PERLASM_SCHEME)
-GENERATE[chacha-armv4.S]=asm/chacha-armv4.pl $(PERLASM_SCHEME)
+GENERATE[chacha-x86.s]=asm/chacha-x86.pl
+GENERATE[chacha-x86_64.s]=asm/chacha-x86_64.pl
+GENERATE[chacha-ppc.s]=asm/chacha-ppc.pl
+GENERATE[chacha-armv4.S]=asm/chacha-armv4.pl
 INCLUDE[chacha-armv4.o]=..
-GENERATE[chacha-armv8.S]=asm/chacha-armv8.pl $(PERLASM_SCHEME)
+GENERATE[chacha-armv8.S]=asm/chacha-armv8.pl
 INCLUDE[chacha-armv8.o]=..
 INCLUDE[chacha-s390x.o]=..
-GENERATE[chacha-c64xplus.S]=asm/chacha-c64xplus.pl $(PERLASM_SCHEME)
-GENERATE[chacha-s390x.S]=asm/chacha-s390x.pl $(PERLASM_SCHEME)
-GENERATE[chacha-ia64.S]=asm/chacha-ia64.pl $(PERLASM_SCHEME)
+GENERATE[chacha-c64xplus.S]=asm/chacha-c64xplus.pl
+GENERATE[chacha-s390x.S]=asm/chacha-s390x.pl
+GENERATE[chacha-ia64.S]=asm/chacha-ia64.pl
diff --git a/crypto/des/asm/crypt586.pl b/crypto/des/asm/crypt586.pl
index ab5d173468..b611b4e983 100644
--- a/crypto/des/asm/crypt586.pl
+++ b/crypto/des/asm/crypt586.pl
@@ -13,8 +13,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/des/asm/des-586.pl b/crypto/des/asm/des-586.pl
index 3d2953884f..483f19503f 100644
--- a/crypto/des/asm/des-586.pl
+++ b/crypto/des/asm/des-586.pl
@@ -20,8 +20,7 @@ require &quot;desboth.pl&quot;;
 # format.
 #
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/des/asm/dest4-sparcv9.pl b/crypto/des/asm/dest4-sparcv9.pl
index a7de3a51f0..0cf25add75 100644
--- a/crypto/des/asm/dest4-sparcv9.pl
+++ b/crypto/des/asm/dest4-sparcv9.pl
@@ -34,8 +34,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;sparcv9_modes.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $code.=&lt;&lt;___;
 #include &quot;sparc_arch.h&quot;
diff --git a/crypto/des/build.info b/crypto/des/build.info
index 33dd90c89a..774bad754b 100644
--- a/crypto/des/build.info
+++ b/crypto/des/build.info
@@ -23,12 +23,10 @@ SOURCE[../../libcrypto]=$COMMON\
 SOURCE[../../providers/fips]=$COMMON
 
 GENERATE[des_enc-sparc.S]=asm/des_enc.m4
-GENERATE[dest4-sparcv9.S]=asm/dest4-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[dest4-sparcv9.S]=asm/dest4-sparcv9.pl
 INCLUDE[dest4-sparcv9.o]=..
 
-GENERATE[des-586.s]=asm/des-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[des-586.s]=asm/des-586.pl
 DEPEND[des-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
-GENERATE[crypt586.s]=asm/crypt586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[crypt586.s]=asm/crypt586.pl
 DEPEND[crypt586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/ec/asm/ecp_nistz256-armv4.pl b/crypto/ec/asm/ecp_nistz256-armv4.pl
index 43a675b4b2..4e6bfef4b5 100755
--- a/crypto/ec/asm/ecp_nistz256-armv4.pl
+++ b/crypto/ec/asm/ecp_nistz256-armv4.pl
@@ -33,9 +33,10 @@
 # on benchmark. Lower coefficients are for ECDSA sign, server-side
 # operation. Keep in mind that +200% means 3x improvement.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -43,9 +44,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call  $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $code.=&lt;&lt;___;
diff --git a/crypto/ec/asm/ecp_nistz256-armv8.pl b/crypto/ec/asm/ecp_nistz256-armv8.pl
index 4daa8cc026..2bcf130bb6 100644
--- a/crypto/ec/asm/ecp_nistz256-armv8.pl
+++ b/crypto/ec/asm/ecp_nistz256-armv8.pl
@@ -31,15 +31,18 @@
 # on benchmark. Lower coefficients are for ECDSA sign, server-side
 # operation. Keep in mind that +400% means 5x improvement.
 
-$flavour = shift;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 {
diff --git a/crypto/ec/asm/ecp_nistz256-avx2.pl b/crypto/ec/asm/ecp_nistz256-avx2.pl
index b8f783499d..275aabb4a2 100755
--- a/crypto/ec/asm/ecp_nistz256-avx2.pl
+++ b/crypto/ec/asm/ecp_nistz256-avx2.pl
@@ -15,9 +15,10 @@
 # S.Gueron and V.Krasnov, &quot;Fast Prime Field Elliptic Curve Cryptography with
 #                          256 Bit Primes&quot;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -26,7 +27,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if (`$ENV{CC} -Wa,-v -c -o /dev/null -x assembler /dev/null 2&gt;&amp;1`
diff --git a/crypto/ec/asm/ecp_nistz256-ppc64.pl b/crypto/ec/asm/ecp_nistz256-ppc64.pl
index c06a7c0d02..944380107a 100755
--- a/crypto/ec/asm/ecp_nistz256-ppc64.pl
+++ b/crypto/ec/asm/ecp_nistz256-ppc64.pl
@@ -25,15 +25,18 @@
 # POWER7		+260-530%
 # POWER8		+220-340%
 
-$flavour = shift;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}ppc-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my $sp=&quot;r1&quot;;
diff --git a/crypto/ec/asm/ecp_nistz256-sparcv9.pl b/crypto/ec/asm/ecp_nistz256-sparcv9.pl
index 8878a1466e..3956a4a901 100755
--- a/crypto/ec/asm/ecp_nistz256-sparcv9.pl
+++ b/crypto/ec/asm/ecp_nistz256-sparcv9.pl
@@ -31,8 +31,7 @@
 # on benchmark. Lower coefficients are for ECDSA sign, server-side
 # operation. Keep in mind that +200% means 3x improvement.
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $code.=&lt;&lt;___;
 #include &quot;sparc_arch.h&quot;
diff --git a/crypto/ec/asm/ecp_nistz256-x86.pl b/crypto/ec/asm/ecp_nistz256-x86.pl
index 8f6b126417..b1b0b6bc47 100755
--- a/crypto/ec/asm/ecp_nistz256-x86.pl
+++ b/crypto/ec/asm/ecp_nistz256-x86.pl
@@ -42,8 +42,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/ec/asm/ecp_nistz256-x86_64.pl b/crypto/ec/asm/ecp_nistz256-x86_64.pl
index 7fbc3eb4ac..53b60ddbf3 100755
--- a/crypto/ec/asm/ecp_nistz256-x86_64.pl
+++ b/crypto/ec/asm/ecp_nistz256-x86_64.pl
@@ -40,9 +40,10 @@
 # higher - for ECDSA sign, relatively fastest server-side operation.
 # Keep in mind that +100% means 2x improvement.
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -51,7 +52,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if (`$ENV{CC} -Wa,-v -c -o /dev/null -x assembler /dev/null 2&gt;&amp;1`
diff --git a/crypto/ec/asm/x25519-ppc64.pl b/crypto/ec/asm/x25519-ppc64.pl
index 5f6bff1850..e2e0a14f49 100755
--- a/crypto/ec/asm/x25519-ppc64.pl
+++ b/crypto/ec/asm/x25519-ppc64.pl
@@ -27,15 +27,18 @@
 # this module delivers more than 2x improvement, and when it does,
 # from 12% to 30% improvement was measured...
 
-$flavour = shift;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}ppc-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my $sp = &quot;r1&quot;;
diff --git a/crypto/ec/asm/x25519-x86_64.pl b/crypto/ec/asm/x25519-x86_64.pl
index b32a0415d9..14583bd747 100755
--- a/crypto/ec/asm/x25519-x86_64.pl
+++ b/crypto/ec/asm/x25519-x86_64.pl
@@ -61,9 +61,10 @@
 #	C implementation, so that comparison is always against
 #	2^51 radix;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -72,7 +73,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if (`$ENV{CC} -Wa,-v -c -o /dev/null -x assembler /dev/null 2&gt;&amp;1`
diff --git a/crypto/ec/build.info b/crypto/ec/build.info
index 449172c704..2befa3e77f 100644
--- a/crypto/ec/build.info
+++ b/crypto/ec/build.info
@@ -60,24 +60,23 @@ DEFINE[../../libcrypto]=$ECDEF
 SOURCE[../../providers/fips]=$COMMON
 DEFINE[../../providers/fips]=$ECDEF
 
-GENERATE[ecp_nistz256-x86.s]=asm/ecp_nistz256-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[ecp_nistz256-x86.s]=asm/ecp_nistz256-x86.pl
 
-GENERATE[ecp_nistz256-x86_64.s]=asm/ecp_nistz256-x86_64.pl $(PERLASM_SCHEME)
+GENERATE[ecp_nistz256-x86_64.s]=asm/ecp_nistz256-x86_64.pl
 
-GENERATE[ecp_nistz256-avx2.s]=asm/ecp_nistz256-avx2.pl $(PERLASM_SCHEME)
+GENERATE[ecp_nistz256-avx2.s]=asm/ecp_nistz256-avx2.pl
 
-GENERATE[ecp_nistz256-sparcv9.S]=asm/ecp_nistz256-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[ecp_nistz256-sparcv9.S]=asm/ecp_nistz256-sparcv9.pl
 INCLUDE[ecp_nistz256-sparcv9.o]=..
 
-GENERATE[ecp_nistz256-armv4.S]=asm/ecp_nistz256-armv4.pl $(PERLASM_SCHEME)
+GENERATE[ecp_nistz256-armv4.S]=asm/ecp_nistz256-armv4.pl
 INCLUDE[ecp_nistz256-armv4.o]=..
-GENERATE[ecp_nistz256-armv8.S]=asm/ecp_nistz256-armv8.pl $(PERLASM_SCHEME)
+GENERATE[ecp_nistz256-armv8.S]=asm/ecp_nistz256-armv8.pl
 INCLUDE[ecp_nistz256-armv8.o]=..
-GENERATE[ecp_nistz256-ppc64.s]=asm/ecp_nistz256-ppc64.pl $(PERLASM_SCHEME)
+GENERATE[ecp_nistz256-ppc64.s]=asm/ecp_nistz256-ppc64.pl
 
-GENERATE[x25519-x86_64.s]=asm/x25519-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[x25519-ppc64.s]=asm/x25519-ppc64.pl $(PERLASM_SCHEME)
+GENERATE[x25519-x86_64.s]=asm/x25519-x86_64.pl
+GENERATE[x25519-ppc64.s]=asm/x25519-ppc64.pl
 
 INCLUDE[curve448/arch_32/f_impl.o]=curve448/arch_32 curve448
 INCLUDE[curve448/f_generic.o]=curve448/arch_32 curve448
diff --git a/crypto/md5/asm/md5-586.pl b/crypto/md5/asm/md5-586.pl
index ea59ed9109..74b82f02cd 100644
--- a/crypto/md5/asm/md5-586.pl
+++ b/crypto/md5/asm/md5-586.pl
@@ -18,8 +18,10 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/md5/asm/md5-sparcv9.pl b/crypto/md5/asm/md5-sparcv9.pl
index db46fff7fe..fd77b8b1de 100644
--- a/crypto/md5/asm/md5-sparcv9.pl
+++ b/crypto/md5/asm/md5-sparcv9.pl
@@ -24,8 +24,10 @@
 # single-process result on 8-core processor, or ~11GBps per 2.85GHz
 # socket.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 use integer;
 
diff --git a/crypto/md5/asm/md5-x86_64.pl b/crypto/md5/asm/md5-x86_64.pl
index adc2321df3..c3d82455d1 100755
--- a/crypto/md5/asm/md5-x86_64.pl
+++ b/crypto/md5/asm/md5-x86_64.pl
@@ -119,9 +119,10 @@ EOF
 }
 
 no warnings qw(uninitialized);
-my $flavour = shift;
-my $output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+my $flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 my $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -130,7 +131,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; my $dir=$1; my $xlate;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $code .= &lt;&lt;EOF;
diff --git a/crypto/md5/build.info b/crypto/md5/build.info
index 3b91abf332..081e0b08bd 100644
--- a/crypto/md5/build.info
+++ b/crypto/md5/build.info
@@ -17,10 +17,9 @@ ENDIF
 SOURCE[../../libcrypto]=md5_dgst.c md5_one.c md5_sha1.c $MD5ASM
 DEFINE[../../libcrypto]=$MD5DEF
 
-GENERATE[md5-586.s]=asm/md5-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[md5-586.s]=asm/md5-586.pl
 
-GENERATE[md5-x86_64.s]=asm/md5-x86_64.pl $(PERLASM_SCHEME)
+GENERATE[md5-x86_64.s]=asm/md5-x86_64.pl
 
-GENERATE[md5-sparcv9.S]=asm/md5-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[md5-sparcv9.S]=asm/md5-sparcv9.pl
 INCLUDE[md5-sparcv9.o]=..
diff --git a/crypto/modes/asm/aesni-gcm-x86_64.pl b/crypto/modes/asm/aesni-gcm-x86_64.pl
index dcdb6a2db3..d5ab0457f8 100644
--- a/crypto/modes/asm/aesni-gcm-x86_64.pl
+++ b/crypto/modes/asm/aesni-gcm-x86_64.pl
@@ -40,9 +40,10 @@
 # [1] <A HREF="http://rt.openssl.org/Ticket/Display.html?id=2900&amp;user=guest&amp;pass=guest">http://rt.openssl.org/Ticket/Display.html?id=2900&amp;user=guest&amp;pass=guest</A>
 # [2] <A HREF="http://www.intel.com/content/dam/www/public/us/en/documents/software-support/enabling-high-performance-gcm.pdf">http://www.intel.com/content/dam/www/public/us/en/documents/software-support/enabling-high-performance-gcm.pdf</A>
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -70,7 +71,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if ($avx&gt;1) {{{
diff --git a/crypto/modes/asm/ghash-armv4.pl b/crypto/modes/asm/ghash-armv4.pl
index 1391b1b6e0..9a3a1f4e8d 100644
--- a/crypto/modes/asm/ghash-armv4.pl
+++ b/crypto/modes/asm/ghash-armv4.pl
@@ -78,9 +78,10 @@
 # *native* byte order on current platform. See gcm128.c for working
 # example...
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -88,9 +89,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $Xi=&quot;r0&quot;;	# argument block
diff --git a/crypto/modes/asm/ghash-c64xplus.pl b/crypto/modes/asm/ghash-c64xplus.pl
index 1611219806..70cef3bc0f 100644
--- a/crypto/modes/asm/ghash-c64xplus.pl
+++ b/crypto/modes/asm/ghash-c64xplus.pl
@@ -26,8 +26,7 @@
 # better, because theoretical [though not necessarily achievable]
 # estimate for &quot;4-bit&quot; table-driven implementation is ~12 cycles.
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($Xip,$Htable,$inp,$len)=(&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;,&quot;B6&quot;);	# arguments
 
diff --git a/crypto/modes/asm/ghash-parisc.pl b/crypto/modes/asm/ghash-parisc.pl
index 6f45e4614b..4eccdc71be 100644
--- a/crypto/modes/asm/ghash-parisc.pl
+++ b/crypto/modes/asm/ghash-parisc.pl
@@ -27,9 +27,12 @@
 #
 # Special thanks to polarhome.com for providing HP-UX account.
 
-$flavour = shift;
-$output = shift;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/modes/asm/ghash-s390x.pl b/crypto/modes/asm/ghash-s390x.pl
index 260c49a789..5355a30748 100644
--- a/crypto/modes/asm/ghash-s390x.pl
+++ b/crypto/modes/asm/ghash-s390x.pl
@@ -44,7 +44,10 @@
 # it's actually almost 2 times slower. Which is the reason why
 # KIMD-GHASH is not used in gcm_gmult_4bit.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -54,8 +57,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $softonly=0;
 
diff --git a/crypto/modes/asm/ghash-sparcv9.pl b/crypto/modes/asm/ghash-sparcv9.pl
index 281b5f9a61..b8b102282f 100644
--- a/crypto/modes/asm/ghash-sparcv9.pl
+++ b/crypto/modes/asm/ghash-sparcv9.pl
@@ -53,8 +53,7 @@
 # saturates at ~15.5x single-process result on 8-core processor,
 # or ~20.5GBps per 2.85GHz socket.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $frame=&quot;STACK_FRAME&quot;;
 $bias=&quot;STACK_BIAS&quot;;
diff --git a/crypto/modes/asm/ghash-x86.pl b/crypto/modes/asm/ghash-x86.pl
index 12d63ceea2..5372b48704 100644
--- a/crypto/modes/asm/ghash-x86.pl
+++ b/crypto/modes/asm/ghash-x86.pl
@@ -135,8 +135,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$x86only = $ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/modes/asm/ghash-x86_64.pl b/crypto/modes/asm/ghash-x86_64.pl
index a5d216abc9..7a3412c032 100644
--- a/crypto/modes/asm/ghash-x86_64.pl
+++ b/crypto/modes/asm/ghash-x86_64.pl
@@ -90,9 +90,10 @@
 #
 # [1] <A HREF="http://rt.openssl.org/Ticket/Display.html?id=2900&amp;user=guest&amp;pass=guest">http://rt.openssl.org/Ticket/Display.html?id=2900&amp;user=guest&amp;pass=guest</A>
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -120,7 +121,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $do4xaggr=1;
diff --git a/crypto/modes/asm/ghashp8-ppc.pl b/crypto/modes/asm/ghashp8-ppc.pl
index 1ae84bed25..44add7958e 100755
--- a/crypto/modes/asm/ghashp8-ppc.pl
+++ b/crypto/modes/asm/ghashp8-ppc.pl
@@ -32,8 +32,10 @@
 # aggregated reduction - by 170% or 2.7x (resulting in 0.55 cpb).
 # POWER9 delivers 0.51 cpb.
 
-$flavour=shift;
-$output =shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T=8;
@@ -61,7 +63,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour $output&quot; || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 my ($Xip,$Htbl,$inp,$len)=map(&quot;r$_&quot;,(3..6));	# argument block
 
diff --git a/crypto/modes/asm/ghashv8-armx.pl b/crypto/modes/asm/ghashv8-armx.pl
index fbc49d1c5b..aa5251df9f 100644
--- a/crypto/modes/asm/ghashv8-armx.pl
+++ b/crypto/modes/asm/ghashv8-armx.pl
@@ -46,15 +46,18 @@
 #
 # (*)	presented for reference/comparison purposes;
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $Xi=&quot;x0&quot;;	# argument block
diff --git a/crypto/modes/build.info b/crypto/modes/build.info
index 506e04d5fa..f5badff1bb 100644
--- a/crypto/modes/build.info
+++ b/crypto/modes/build.info
@@ -58,20 +58,19 @@ DEFINE[../../providers/fips]=$MODESDEF
 
 INCLUDE[gcm128.o]=..
 
-GENERATE[ghash-ia64.s]=asm/ghash-ia64.pl $(LIB_CFLAGS) $(LIB_CPPFLAGS)
-GENERATE[ghash-x86.s]=asm/ghash-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
-GENERATE[ghash-x86_64.s]=asm/ghash-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[aesni-gcm-x86_64.s]=asm/aesni-gcm-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[ghash-sparcv9.S]=asm/ghash-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[ghash-ia64.s]=asm/ghash-ia64.pl
+GENERATE[ghash-x86.s]=asm/ghash-x86.pl
+GENERATE[ghash-x86_64.s]=asm/ghash-x86_64.pl
+GENERATE[aesni-gcm-x86_64.s]=asm/aesni-gcm-x86_64.pl
+GENERATE[ghash-sparcv9.S]=asm/ghash-sparcv9.pl
 INCLUDE[ghash-sparcv9.o]=..
-GENERATE[ghash-alpha.S]=asm/ghash-alpha.pl $(PERLASM_SCHEME)
-GENERATE[ghash-parisc.s]=asm/ghash-parisc.pl $(PERLASM_SCHEME)
-GENERATE[ghashp8-ppc.s]=asm/ghashp8-ppc.pl $(PERLASM_SCHEME)
-GENERATE[ghash-armv4.S]=asm/ghash-armv4.pl $(PERLASM_SCHEME)
+GENERATE[ghash-alpha.S]=asm/ghash-alpha.pl
+GENERATE[ghash-parisc.s]=asm/ghash-parisc.pl
+GENERATE[ghashp8-ppc.s]=asm/ghashp8-ppc.pl
+GENERATE[ghash-armv4.S]=asm/ghash-armv4.pl
 INCLUDE[ghash-armv4.o]=..
-GENERATE[ghashv8-armx.S]=asm/ghashv8-armx.pl $(PERLASM_SCHEME)
+GENERATE[ghashv8-armx.S]=asm/ghashv8-armx.pl
 INCLUDE[ghashv8-armx.o]=..
-GENERATE[ghash-s390x.S]=asm/ghash-s390x.pl $(PERLASM_SCHEME)
+GENERATE[ghash-s390x.S]=asm/ghash-s390x.pl
 INCLUDE[ghash-s390x.o]=..
-GENERATE[ghash-c64xplus.S]=asm/ghash-c64xplus.pl $(PERLASM_SCHEME)
+GENERATE[ghash-c64xplus.S]=asm/ghash-c64xplus.pl
diff --git a/crypto/pariscid.pl b/crypto/pariscid.pl
index 47fdce9513..aafcb2a9bc 100644
--- a/crypto/pariscid.pl
+++ b/crypto/pariscid.pl
@@ -7,9 +7,12 @@
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
 
-$flavour = shift;
-$output = shift;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/poly1305/asm/poly1305-armv4.pl b/crypto/poly1305/asm/poly1305-armv4.pl
index 38622af1ab..8d6049829d 100755
--- a/crypto/poly1305/asm/poly1305-armv4.pl
+++ b/crypto/poly1305/asm/poly1305-armv4.pl
@@ -28,9 +28,10 @@
 #	the cost of 15/12% regression on Cortex-A5/A7, it's even possible
 #	to improve Cortex-A9 result, but then A5/A7 loose more than 20%;
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -38,9 +39,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 ($ctx,$inp,$len,$padbit)=map(&quot;r$_&quot;,(0..3));
diff --git a/crypto/poly1305/asm/poly1305-armv8.pl b/crypto/poly1305/asm/poly1305-armv8.pl
index b5dd61e1a9..5ebc57298e 100755
--- a/crypto/poly1305/asm/poly1305-armv8.pl
+++ b/crypto/poly1305/asm/poly1305-armv8.pl
@@ -35,15 +35,18 @@
 #	i.e. measured result is worse than expected, presumably binary
 #	translator is not almighty;
 
-$flavour=shift;
-$output=shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my ($ctx,$inp,$len,$padbit) = map(&quot;x$_&quot;,(0..3));
diff --git a/crypto/poly1305/asm/poly1305-c64xplus.pl b/crypto/poly1305/asm/poly1305-c64xplus.pl
index b858e8079e..2bcdced7f4 100755
--- a/crypto/poly1305/asm/poly1305-c64xplus.pl
+++ b/crypto/poly1305/asm/poly1305-c64xplus.pl
@@ -26,8 +26,7 @@
 # time dependent on input length. This module on the other hand is free
 # from such limitation.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($CTXA,$INPB,$LEN,$PADBIT)=(&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;,&quot;B6&quot;);
 ($H0,$H1,$H2,$H3,$H4,$H4a)=(&quot;A8&quot;,&quot;B8&quot;,&quot;A10&quot;,&quot;B10&quot;,&quot;B2&quot;,$LEN);
diff --git a/crypto/poly1305/asm/poly1305-mips.pl b/crypto/poly1305/asm/poly1305-mips.pl
index 65d6b5cdf3..a2504347c2 100755
--- a/crypto/poly1305/asm/poly1305-mips.pl
+++ b/crypto/poly1305/asm/poly1305-mips.pl
@@ -56,7 +56,11 @@
 #
 ######################################################################
 
-$flavour = shift || &quot;o32&quot;; # supported flavours are o32,n32,64,nubi32,nubi64
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+# supported flavours are o32,n32,64,nubi32,nubi64, default is o32
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : &quot;o32&quot;;
 
 die &quot;MIPS64 only&quot; unless ($flavour =~ /64|n32/i);
 
@@ -431,7 +435,7 @@ poly1305_emit:
 ___
 }
 
-$output=pop and open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 print $code;
 close STDOUT;
 
diff --git a/crypto/poly1305/asm/poly1305-ppc.pl b/crypto/poly1305/asm/poly1305-ppc.pl
index 2770f5e79d..fa11afc6e0 100755
--- a/crypto/poly1305/asm/poly1305-ppc.pl
+++ b/crypto/poly1305/asm/poly1305-ppc.pl
@@ -52,7 +52,10 @@
 # not, not one usable in the context. Improvement is ~40% over -m64
 # result above and is ~1.43 on little-endian systems.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -79,7 +82,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=24*$SIZE_T;
 
diff --git a/crypto/poly1305/asm/poly1305-ppcfp.pl b/crypto/poly1305/asm/poly1305-ppcfp.pl
index e563513308..7109165667 100755
--- a/crypto/poly1305/asm/poly1305-ppcfp.pl
+++ b/crypto/poly1305/asm/poly1305-ppcfp.pl
@@ -27,7 +27,10 @@
 # POWER7		3.50/+30%
 # POWER8		3.75/+10%
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -54,7 +57,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $LOCALS=6*$SIZE_T;
 $FRAME=$LOCALS+6*8+18*8;
diff --git a/crypto/poly1305/asm/poly1305-s390x.pl b/crypto/poly1305/asm/poly1305-s390x.pl
index 73efdd9e6d..7f1f8347ed 100755
--- a/crypto/poly1305/asm/poly1305-s390x.pl
+++ b/crypto/poly1305/asm/poly1305-s390x.pl
@@ -47,7 +47,10 @@ use FindBin qw($Bin);
 use lib &quot;$Bin/../..&quot;;
 use perlasm::s390x qw(:DEFAULT :LD :GE :EI :MI1 :VX AUTOLOAD LABEL INCLUDE);
 
-my $flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+my $flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 my ($z,$SIZE_T);
 if ($flavour =~ /3[12]/) {
@@ -58,9 +61,6 @@ if ($flavour =~ /3[12]/) {
 	$SIZE_T=8;
 }
 
-my $output;
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-
 my $stdframe=16*$SIZE_T+4*8;
 my $sp=&quot;%r15&quot;;
 
diff --git a/crypto/poly1305/asm/poly1305-sparcv9.pl b/crypto/poly1305/asm/poly1305-sparcv9.pl
index 442b2e2cfb..d7b67b8593 100755
--- a/crypto/poly1305/asm/poly1305-sparcv9.pl
+++ b/crypto/poly1305/asm/poly1305-sparcv9.pl
@@ -41,17 +41,16 @@
 # (***)	Multi-process benchmark saturates at ~12.5x single-process
 #	result on 8-core processor, or ~21GBps per 2.85GHz socket.
 
-my $output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+
+open STDOUT,&quot;&gt;$output&quot; if $output;
 
 my ($ctx,$inp,$len,$padbit,$shl,$shr)	= map(&quot;%i$_&quot;,(0..5));
 my ($r0,$r1,$r2,$r3,$s1,$s2,$s3,$h4)	= map(&quot;%l$_&quot;,(0..7));
 my ($h0,$h1,$h2,$h3, $t0,$t1,$t2)	= map(&quot;%o$_&quot;,(0..5,7));
 my ($d0,$d1,$d2,$d3)			= map(&quot;%g$_&quot;,(1..4));
 
-my $output = pop;
-open STDOUT,&quot;&gt;$stdout&quot;;
-
 $code.=&lt;&lt;___;
 #include &quot;sparc_arch.h&quot;
 
diff --git a/crypto/poly1305/asm/poly1305-x86.pl b/crypto/poly1305/asm/poly1305-x86.pl
index e8cbe9fd53..9aa1bc1600 100755
--- a/crypto/poly1305/asm/poly1305-x86.pl
+++ b/crypto/poly1305/asm/poly1305-x86.pl
@@ -47,8 +47,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/poly1305/asm/poly1305-x86_64.pl b/crypto/poly1305/asm/poly1305-x86_64.pl
index 12f971767b..c27d8779f1 100755
--- a/crypto/poly1305/asm/poly1305-x86_64.pl
+++ b/crypto/poly1305/asm/poly1305-x86_64.pl
@@ -63,9 +63,10 @@
 # (***)	strangely enough performance seems to vary from core to core,
 #	listed result is best case;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -94,7 +95,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my ($ctx,$inp,$len,$padbit)=(&quot;%rdi&quot;,&quot;%rsi&quot;,&quot;%rdx&quot;,&quot;%rcx&quot;);
diff --git a/crypto/poly1305/build.info b/crypto/poly1305/build.info
index cab28f4bdb..29cdf4c861 100644
--- a/crypto/poly1305/build.info
+++ b/crypto/poly1305/build.info
@@ -32,19 +32,18 @@ ENDIF
 SOURCE[../../libcrypto]=poly1305_ameth.c poly1305.c $POLY1305ASM
 DEFINE[../../libcrypto]=$POLY1305DEF
 
-GENERATE[poly1305-sparcv9.S]=asm/poly1305-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[poly1305-sparcv9.S]=asm/poly1305-sparcv9.pl
 INCLUDE[poly1305-sparcv9.o]=..
-GENERATE[poly1305-x86.s]=asm/poly1305-x86.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
-GENERATE[poly1305-x86_64.s]=asm/poly1305-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[poly1305-ppc.s]=asm/poly1305-ppc.pl $(PERLASM_SCHEME)
-GENERATE[poly1305-ppcfp.s]=asm/poly1305-ppcfp.pl $(PERLASM_SCHEME)
-GENERATE[poly1305-armv4.S]=asm/poly1305-armv4.pl $(PERLASM_SCHEME)
+GENERATE[poly1305-x86.s]=asm/poly1305-x86.pl
+GENERATE[poly1305-x86_64.s]=asm/poly1305-x86_64.pl
+GENERATE[poly1305-ppc.s]=asm/poly1305-ppc.pl
+GENERATE[poly1305-ppcfp.s]=asm/poly1305-ppcfp.pl
+GENERATE[poly1305-armv4.S]=asm/poly1305-armv4.pl
 INCLUDE[poly1305-armv4.o]=..
-GENERATE[poly1305-armv8.S]=asm/poly1305-armv8.pl $(PERLASM_SCHEME)
+GENERATE[poly1305-armv8.S]=asm/poly1305-armv8.pl
 INCLUDE[poly1305-armv8.o]=..
-GENERATE[poly1305-mips.S]=asm/poly1305-mips.pl $(PERLASM_SCHEME)
+GENERATE[poly1305-mips.S]=asm/poly1305-mips.pl
 INCLUDE[poly1305-mips.o]=..
-GENERATE[poly1305-c64xplus.S]=asm/poly1305-c64xplus.pl $(PERLASM_SCHEME)
+GENERATE[poly1305-c64xplus.S]=asm/poly1305-c64xplus.pl
 INCLUDE[poly1305-s390x.o]=..
-GENERATE[poly1305-s390x.S]=asm/poly1305-s390x.pl $(PERLASM_SCHEME)
+GENERATE[poly1305-s390x.S]=asm/poly1305-s390x.pl
diff --git a/crypto/ppccpuid.pl b/crypto/ppccpuid.pl
index 0c1e124730..de5d7e2667 100755
--- a/crypto/ppccpuid.pl
+++ b/crypto/ppccpuid.pl
@@ -7,14 +7,18 @@
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}ppc-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 if ($flavour=~/64/) {
     $CMPLI=&quot;cmpldi&quot;;
diff --git a/crypto/rc4/asm/rc4-586.pl b/crypto/rc4/asm/rc4-586.pl
index db43ca8381..ad9674070d 100644
--- a/crypto/rc4/asm/rc4-586.pl
+++ b/crypto/rc4/asm/rc4-586.pl
@@ -68,8 +68,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$x86only = $ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/rc4/asm/rc4-c64xplus.pl b/crypto/rc4/asm/rc4-c64xplus.pl
index f4e0814c0d..0167b05e6a 100644
--- a/crypto/rc4/asm/rc4-c64xplus.pl
+++ b/crypto/rc4/asm/rc4-c64xplus.pl
@@ -186,7 +186,6 @@ rc4_options:
 	.align	4
 ___
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 print $code;
 close STDOUT;
diff --git a/crypto/rc4/asm/rc4-md5-x86_64.pl b/crypto/rc4/asm/rc4-md5-x86_64.pl
index 83a298552b..c9381ca9b2 100644
--- a/crypto/rc4/asm/rc4-md5-x86_64.pl
+++ b/crypto/rc4/asm/rc4-md5-x86_64.pl
@@ -53,9 +53,10 @@ my $D=&quot;#&quot; if (!$md5);	# if set to &quot;#&quot;, MD5 is stitched into RC4(),
 			# to be able to use 'openssl speed rc4' for
 			# benchmarking the stitched subroutine...
 
-my $flavour = shift;
-my $output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+my $output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+my $flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 my $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -64,7 +65,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; my $dir=$1; my $xlate;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my ($dat,$in0,$out,$ctx,$inp,$len, $func,$nargs);
diff --git a/crypto/rc4/asm/rc4-parisc.pl b/crypto/rc4/asm/rc4-parisc.pl
index 7194575087..a60f2f9ea5 100644
--- a/crypto/rc4/asm/rc4-parisc.pl
+++ b/crypto/rc4/asm/rc4-parisc.pl
@@ -27,9 +27,12 @@
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 
-$flavour = shift;
-$output = shift;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/rc4/asm/rc4-s390x.pl b/crypto/rc4/asm/rc4-s390x.pl
index 858ce153f8..c90013cf29 100644
--- a/crypto/rc4/asm/rc4-s390x.pl
+++ b/crypto/rc4/asm/rc4-s390x.pl
@@ -30,7 +30,10 @@
 # remains z/Architecture specific. On z990 it was measured to perform
 # 50% better than code generated by gcc 4.3.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -40,8 +43,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $rp=&quot;%r14&quot;;
 $sp=&quot;%r15&quot;;
diff --git a/crypto/rc4/asm/rc4-x86_64.pl b/crypto/rc4/asm/rc4-x86_64.pl
index 42e711b4eb..ebca0473ab 100755
--- a/crypto/rc4/asm/rc4-x86_64.pl
+++ b/crypto/rc4/asm/rc4-x86_64.pl
@@ -111,9 +111,10 @@
 #	but more than likely at the cost of the others (see rc4-586.pl
 #	to get the idea)...
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -122,7 +123,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $dat=&quot;%rdi&quot;;	    # arg1
diff --git a/crypto/rc4/build.info b/crypto/rc4/build.info
index 30e36bac10..abc0c52d0c 100644
--- a/crypto/rc4/build.info
+++ b/crypto/rc4/build.info
@@ -19,13 +19,12 @@ ENDIF
 
 SOURCE[../../libcrypto]=$RC4ASM
 
-GENERATE[rc4-586.s]=asm/rc4-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[rc4-586.s]=asm/rc4-586.pl
 DEPEND[rc4-586.s]=../perlasm/x86asm.pl
 
-GENERATE[rc4-x86_64.s]=asm/rc4-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[rc4-md5-x86_64.s]=asm/rc4-md5-x86_64.pl $(PERLASM_SCHEME)
+GENERATE[rc4-x86_64.s]=asm/rc4-x86_64.pl
+GENERATE[rc4-md5-x86_64.s]=asm/rc4-md5-x86_64.pl
 
-GENERATE[rc4-parisc.s]=asm/rc4-parisc.pl $(PERLASM_SCHEME)
-GENERATE[rc4-c64xplus.s]=asm/rc4-c64xplus.pl $(PERLASM_SCHEME)
-GENERATE[rc4-s390x.s]=asm/rc4-s390x.pl $(PERLASM_SCHEME)
+GENERATE[rc4-parisc.s]=asm/rc4-parisc.pl
+GENERATE[rc4-c64xplus.s]=asm/rc4-c64xplus.pl
+GENERATE[rc4-s390x.s]=asm/rc4-s390x.pl
diff --git a/crypto/rc5/asm/rc5-586.pl b/crypto/rc5/asm/rc5-586.pl
index 592cbd7c76..70ff5d4180 100644
--- a/crypto/rc5/asm/rc5-586.pl
+++ b/crypto/rc5/asm/rc5-586.pl
@@ -12,8 +12,7 @@ push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 require &quot;cbc.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/rc5/build.info b/crypto/rc5/build.info
index 5780f3c5f9..c684d1ee2e 100644
--- a/crypto/rc5/build.info
+++ b/crypto/rc5/build.info
@@ -15,6 +15,5 @@ ENDIF
 SOURCE[../../libcrypto]=\
         rc5_skey.c rc5_ecb.c $RC5ASM rc5cfb64.c rc5ofb64.c
 
-GENERATE[rc5-586.s]=asm/rc5-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[rc5-586.s]=asm/rc5-586.pl
 DEPEND[rc5-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/ripemd/asm/rmd-586.pl b/crypto/ripemd/asm/rmd-586.pl
index 6d619b8f89..f6b283c941 100644
--- a/crypto/ripemd/asm/rmd-586.pl
+++ b/crypto/ripemd/asm/rmd-586.pl
@@ -16,8 +16,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/ripemd/build.info b/crypto/ripemd/build.info
index e2db293228..c4baf63141 100644
--- a/crypto/ripemd/build.info
+++ b/crypto/ripemd/build.info
@@ -15,6 +15,5 @@ ENDIF
 SOURCE[../../libcrypto]=rmd_dgst.c rmd_one.c $RMD160ASM
 DEFINE[../../libcrypto]=$RMD160DEF
 
-GENERATE[rmd-586.s]=asm/rmd-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[rmd-586.s]=asm/rmd-586.pl
 DEPEND[rmd-586.s]=../perlasm/x86asm.pl
diff --git a/crypto/s390xcpuid.pl b/crypto/s390xcpuid.pl
index 0bb1004245..36f742068b 100755
--- a/crypto/s390xcpuid.pl
+++ b/crypto/s390xcpuid.pl
@@ -6,7 +6,10 @@
 # in the file LICENSE in the source distribution or at
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -16,8 +19,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $ra=&quot;%r14&quot;;
 $sp=&quot;%r15&quot;;
diff --git a/crypto/sha/asm/keccak1600-armv4.pl b/crypto/sha/asm/keccak1600-armv4.pl
index 0bfee48f84..1ab0e8119a 100755
--- a/crypto/sha/asm/keccak1600-armv4.pl
+++ b/crypto/sha/asm/keccak1600-armv4.pl
@@ -70,9 +70,10 @@
 #	Cortex-Mx, x&gt;=3. Otherwise, non-NEON results for NEON-capable
 #	processors are presented mostly for reference purposes.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -80,9 +81,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 my @C = map(&quot;r$_&quot;,(0..9));
diff --git a/crypto/sha/asm/keccak1600-armv8.pl b/crypto/sha/asm/keccak1600-armv8.pl
index 662069089a..515491a9db 100755
--- a/crypto/sha/asm/keccak1600-armv8.pl
+++ b/crypto/sha/asm/keccak1600-armv8.pl
@@ -59,15 +59,18 @@
 #	Cortex-A57 to 25% on Cortex-A53. While in comparison to older
 #	compiler this code is at least 2x faster...
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my @rhotates = ([  0,  1, 62, 28, 27 ],
diff --git a/crypto/sha/asm/keccak1600-avx2.pl b/crypto/sha/asm/keccak1600-avx2.pl
index 56aeb0d95e..a56756fb31 100755
--- a/crypto/sha/asm/keccak1600-avx2.pl
+++ b/crypto/sha/asm/keccak1600-avx2.pl
@@ -476,7 +476,6 @@ iotas:
 .asciz	&quot;Keccak-1600 absorb and squeeze for AVX2, CRYPTOGAMS by &lt;appro\@openssl.org&gt;&quot;
 ___
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 print $code;
 close STDOUT;
diff --git a/crypto/sha/asm/keccak1600-avx512.pl b/crypto/sha/asm/keccak1600-avx512.pl
index bbad46db7d..be4a7acec2 100755
--- a/crypto/sha/asm/keccak1600-avx512.pl
+++ b/crypto/sha/asm/keccak1600-avx512.pl
@@ -545,7 +545,6 @@ iotas:
 .asciz	&quot;Keccak-1600 absorb and squeeze for AVX-512F, CRYPTOGAMS by &lt;appro\@openssl.org&gt;&quot;
 ___
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 print $code;
 close STDOUT;
diff --git a/crypto/sha/asm/keccak1600-avx512vl.pl b/crypto/sha/asm/keccak1600-avx512vl.pl
index 86d260120e..8616050a24 100755
--- a/crypto/sha/asm/keccak1600-avx512vl.pl
+++ b/crypto/sha/asm/keccak1600-avx512vl.pl
@@ -386,7 +386,6 @@ iotas:
 .asciz	&quot;Keccak-1600 absorb and squeeze for AVX512VL, CRYPTOGAMS by &lt;appro\@openssl.org&gt;&quot;
 ___
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 print $code;
 close STDOUT;
diff --git a/crypto/sha/asm/keccak1600-c64x.pl b/crypto/sha/asm/keccak1600-c64x.pl
index b196b618cd..7433c9987e 100755
--- a/crypto/sha/asm/keccak1600-c64x.pl
+++ b/crypto/sha/asm/keccak1600-c64x.pl
@@ -879,7 +879,6 @@ iotas:
 	.align	4
 ___
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 print $code;
 close STDOUT;
diff --git a/crypto/sha/asm/keccak1600-mmx.pl b/crypto/sha/asm/keccak1600-mmx.pl
index d7a390d843..8be05a1f58 100755
--- a/crypto/sha/asm/keccak1600-mmx.pl
+++ b/crypto/sha/asm/keccak1600-mmx.pl
@@ -65,8 +65,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/sha/asm/keccak1600-ppc64.pl b/crypto/sha/asm/keccak1600-ppc64.pl
index 876632b1e7..6f5906352d 100755
--- a/crypto/sha/asm/keccak1600-ppc64.pl
+++ b/crypto/sha/asm/keccak1600-ppc64.pl
@@ -37,7 +37,10 @@
 #	much better (but watch out for them generating code specific
 #	to processor they execute on).
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -53,7 +56,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=24*$SIZE_T+6*$SIZE_T+32;
 $LOCALS=6*$SIZE_T;
diff --git a/crypto/sha/asm/keccak1600-s390x.pl b/crypto/sha/asm/keccak1600-s390x.pl
index 2d5cb417fa..99cbee30b6 100755
--- a/crypto/sha/asm/keccak1600-s390x.pl
+++ b/crypto/sha/asm/keccak1600-s390x.pl
@@ -30,7 +30,10 @@
 # amount of instruction and assumed instruction issue rate. It's ~2.5x
 # faster than compiler-generated code.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -40,8 +43,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 my @A = map([ 8*$_, 8*($_+1), 8*($_+2), 8*($_+3), 8*($_+4) ], (0,5,10,15,20));
 
diff --git a/crypto/sha/asm/keccak1600-x86_64.pl b/crypto/sha/asm/keccak1600-x86_64.pl
index fda4ee1290..80c7cc437d 100755
--- a/crypto/sha/asm/keccak1600-x86_64.pl
+++ b/crypto/sha/asm/keccak1600-x86_64.pl
@@ -50,9 +50,10 @@
 #	improved by 14% by replacing rotates with double-precision
 #	shift with same register as source and destination.
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -61,7 +62,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 my @A = map([ 8*$_-100, 8*($_+1)-100, 8*($_+2)-100,
diff --git a/crypto/sha/asm/keccak1600p8-ppc.pl b/crypto/sha/asm/keccak1600p8-ppc.pl
index 9a97cfdbf8..0fdc23f689 100755
--- a/crypto/sha/asm/keccak1600p8-ppc.pl
+++ b/crypto/sha/asm/keccak1600p8-ppc.pl
@@ -25,7 +25,10 @@
 # successor can achieve higher scalar instruction issue rate, then
 # this module will loose... And it does on POWER9 with 12.0 vs. 9.4.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -48,7 +51,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=6*$SIZE_T+13*16;	# 13*16 is for v20-v31 offload
 
diff --git a/crypto/sha/asm/sha1-586.pl b/crypto/sha/asm/sha1-586.pl
index abc84dd6e9..6622b02176 100644
--- a/crypto/sha/asm/sha1-586.pl
+++ b/crypto/sha/asm/sha1-586.pl
@@ -123,8 +123,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/sha/asm/sha1-armv4-large.pl b/crypto/sha/asm/sha1-armv4-large.pl
index cd0b95ade8..24fc5bf430 100644
--- a/crypto/sha/asm/sha1-armv4-large.pl
+++ b/crypto/sha/asm/sha1-armv4-large.pl
@@ -75,9 +75,10 @@
 #
 # Add ARMv8 code path performing at 2.35 cpb on Apple A7.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -85,9 +86,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $ctx=&quot;r0&quot;;
diff --git a/crypto/sha/asm/sha1-armv8.pl b/crypto/sha/asm/sha1-armv8.pl
index 12403eb783..f9f3c5f3cf 100644
--- a/crypto/sha/asm/sha1-armv8.pl
+++ b/crypto/sha/asm/sha1-armv8.pl
@@ -33,15 +33,18 @@
 # (**)	Keep in mind that Denver relies on binary translation, which
 #	optimizes compiler output at run-time.
 
-$flavour = shift;
-$output  = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}arm-xlate.pl&quot; and -f $xlate ) or
 ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate arm-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $1&quot;;
 *STDOUT=*OUT;
 
 ($ctx,$inp,$num)=(&quot;x0&quot;,&quot;x1&quot;,&quot;x2&quot;);
diff --git a/crypto/sha/asm/sha1-c64xplus.pl b/crypto/sha/asm/sha1-c64xplus.pl
index 0a45d2fecd..66f15e22fd 100644
--- a/crypto/sha/asm/sha1-c64xplus.pl
+++ b/crypto/sha/asm/sha1-c64xplus.pl
@@ -32,8 +32,7 @@
 # service routines are expected to preserve it and for own well-being
 # zero it upon entry.
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($CTX,$INP,$NUM) = (&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;);		# arguments
 
diff --git a/crypto/sha/asm/sha1-ia64.pl b/crypto/sha/asm/sha1-ia64.pl
index b0c10f8a4b..f1b412dcf2 100644
--- a/crypto/sha/asm/sha1-ia64.pl
+++ b/crypto/sha/asm/sha1-ia64.pl
@@ -21,7 +21,8 @@
 # Performance under big-endian OS such as HP-UX is 179MBps*1GHz, which
 # is &gt;50% better than HP C and &gt;2x better than gcc.
 
-$output = pop;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
 
 $code=&lt;&lt;___;
 .ident  \&quot;sha1-ia64.s, version 1.3\&quot;
diff --git a/crypto/sha/asm/sha1-mb-x86_64.pl b/crypto/sha/asm/sha1-mb-x86_64.pl
index 243ac5efd9..0804c580be 100644
--- a/crypto/sha/asm/sha1-mb-x86_64.pl
+++ b/crypto/sha/asm/sha1-mb-x86_64.pl
@@ -38,9 +38,10 @@
 #	in real-life application are somewhat lower, e.g. for 2KB
 #	fragments they range from 30% to 100% (on Haswell);
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -70,7 +71,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 # void sha1_multi_block (
diff --git a/crypto/sha/asm/sha1-mips.pl b/crypto/sha/asm/sha1-mips.pl
index 86bd88b04a..0f23b6b074 100644
--- a/crypto/sha/asm/sha1-mips.pl
+++ b/crypto/sha/asm/sha1-mips.pl
@@ -52,8 +52,12 @@
 # ($t0,$t1,$t2,$t3,$t8,$t9)=map(&quot;\$$_&quot;,(12..15,24,25));
 # ($s0,$s1,$s2,$s3,$s4,$s5,$s6,$s7)=map(&quot;\$$_&quot;,(16..23));
 # ($gp,$sp,$fp,$ra)=map(&quot;\$$_&quot;,(28..31));
-#
-$flavour = shift || &quot;o32&quot;; # supported flavours are o32,n32,64,nubi32,nubi64
+
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+# supported flavours are o32,n32,64,nubi32,nubi64, default is o32
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : &quot;o32&quot;; 
 
 if ($flavour =~ /64|n32/i) {
 	$PTR_ADD=&quot;daddu&quot;;	# incidentally works even on n32
@@ -77,8 +81,7 @@ if ($flavour =~ /64|n32/i) {
 
 $big_endian=(`echo MIPSEB | $ENV{CC} -E -`=~/MIPSEB/)?0:1 if ($ENV{CC});
 
-for (@ARGV) {	$output=$_ if (/\w[\w\-]*\.\w+$/);   }
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if (!defined($big_endian))
             {   $big_endian=(unpack('L',pack('N',1))==1);   }
diff --git a/crypto/sha/asm/sha1-parisc.pl b/crypto/sha/asm/sha1-parisc.pl
index 11f5b39997..00c85378e2 100644
--- a/crypto/sha/asm/sha1-parisc.pl
+++ b/crypto/sha/asm/sha1-parisc.pl
@@ -26,9 +26,12 @@
 #
 # Special thanks to polarhome.com for providing HP-UX account.
 
-$flavour = shift;
-$output = shift;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/sha/asm/sha1-ppc.pl b/crypto/sha/asm/sha1-ppc.pl
index ec33895df2..f7a75b743e 100755
--- a/crypto/sha/asm/sha1-ppc.pl
+++ b/crypto/sha/asm/sha1-ppc.pl
@@ -26,7 +26,10 @@
 # PPC970,gcc-4.0.0	+76%	+59%
 # Power6,xlc-7		+68%	+33%
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T	=8;
@@ -53,7 +56,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour &quot;.shift || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 $FRAME=24*$SIZE_T+64;
 $LOCALS=6*$SIZE_T;
diff --git a/crypto/sha/asm/sha1-s390x.pl b/crypto/sha/asm/sha1-s390x.pl
index 020a1f1b18..091e1c00b3 100644
--- a/crypto/sha/asm/sha1-s390x.pl
+++ b/crypto/sha/asm/sha1-s390x.pl
@@ -40,7 +40,10 @@
 
 $kimdfunc=1;	# magic function code for kimd instruction
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -50,8 +53,7 @@ if ($flavour =~ /3[12]/) {
 	$g=&quot;g&quot;;
 }
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 $K_00_39=&quot;%r0&quot;; $K=$K_00_39;
 $K_40_79=&quot;%r1&quot;;
diff --git a/crypto/sha/asm/sha1-sparcv9.pl b/crypto/sha/asm/sha1-sparcv9.pl
index e5c70257e4..8ef8b5fee0 100644
--- a/crypto/sha/asm/sha1-sparcv9.pl
+++ b/crypto/sha/asm/sha1-sparcv9.pl
@@ -32,8 +32,7 @@
 # single-process result on 8-core processor, or ~9GBps per 2.85GHz
 # socket.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 @X=(&quot;%o0&quot;,&quot;%o1&quot;,&quot;%o2&quot;,&quot;%o3&quot;,&quot;%o4&quot;,&quot;%o5&quot;,&quot;%g1&quot;,&quot;%o7&quot;);
 $rot1m=&quot;%g2&quot;;
diff --git a/crypto/sha/asm/sha1-sparcv9a.pl b/crypto/sha/asm/sha1-sparcv9a.pl
index ec6533614f..e0ccea2a98 100644
--- a/crypto/sha/asm/sha1-sparcv9a.pl
+++ b/crypto/sha/asm/sha1-sparcv9a.pl
@@ -47,8 +47,7 @@ for (@ARGV)	{ $bits=64 if (/\-m64/ || /\-xarch\=v9/); }
 if ($bits==64)	{ $bias=2047; $frame=192; }
 else		{ $bias=0;    $frame=112; }
 
-$output=shift;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $ctx=&quot;%i0&quot;;
 $inp=&quot;%i1&quot;;
diff --git a/crypto/sha/asm/sha1-thumb.pl b/crypto/sha/asm/sha1-thumb.pl
index fe380e9f97..dbe5754700 100644
--- a/crypto/sha/asm/sha1-thumb.pl
+++ b/crypto/sha/asm/sha1-thumb.pl
@@ -26,8 +26,7 @@
 # by over 40%, while code increases by only 10% or 32 bytes. But once
 # again, the goal was to establish _size_ benchmark, not performance.
 
-$output=shift;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $inline=0;
 #$cheat_on_binutils=1;
diff --git a/crypto/sha/asm/sha1-x86_64.pl b/crypto/sha/asm/sha1-x86_64.pl
index 5352afc3e9..ab10d360c1 100755
--- a/crypto/sha/asm/sha1-x86_64.pl
+++ b/crypto/sha/asm/sha1-x86_64.pl
@@ -93,9 +93,10 @@
 #	because SSSE3 code is compiled unconditionally;
 # (**)	SHAEXT result
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -126,7 +127,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 $shaext=1;	### set to zero if compiling for 1.0.1
 $avx=1		if (!$shaext &amp;&amp; $avx);
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $ctx=&quot;%rdi&quot;;	# 1st arg
diff --git a/crypto/sha/asm/sha256-586.pl b/crypto/sha/asm/sha256-586.pl
index 3693f328f0..b28b62ab07 100644
--- a/crypto/sha/asm/sha256-586.pl
+++ b/crypto/sha/asm/sha256-586.pl
@@ -73,8 +73,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/sha/asm/sha256-armv4.pl b/crypto/sha/asm/sha256-armv4.pl
index cd01fcb57b..80c697e00c 100644
--- a/crypto/sha/asm/sha256-armv4.pl
+++ b/crypto/sha/asm/sha256-armv4.pl
@@ -44,9 +44,10 @@
 #
 # Add ARMv8 code path performing at 2.0 cpb on Apple A7.
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -54,9 +55,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $ctx=&quot;r0&quot;;	$t0=&quot;r0&quot;;
diff --git a/crypto/sha/asm/sha256-c64xplus.pl b/crypto/sha/asm/sha256-c64xplus.pl
index 19d0f7222d..480b49e4d0 100644
--- a/crypto/sha/asm/sha256-c64xplus.pl
+++ b/crypto/sha/asm/sha256-c64xplus.pl
@@ -26,8 +26,7 @@
 # service routines are expected to preserve it and for own well-being
 # zero it upon entry.
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 ($CTXA,$INP,$NUM) = (&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;);            # arguments
  $K256=&quot;A3&quot;;
diff --git a/crypto/sha/asm/sha256-mb-x86_64.pl b/crypto/sha/asm/sha256-mb-x86_64.pl
index b2dba456b9..167d332405 100644
--- a/crypto/sha/asm/sha256-mb-x86_64.pl
+++ b/crypto/sha/asm/sha256-mb-x86_64.pl
@@ -39,9 +39,10 @@
 #	in real-life application are somewhat lower, e.g. for 2KB
 #	fragments they range from 75% to 130% (on Haswell);
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -71,7 +72,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 	$avx = ($2&gt;=3.0) + ($2&gt;3.0);
 }
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 # void sha256_multi_block (
diff --git a/crypto/sha/asm/sha512-586.pl b/crypto/sha/asm/sha512-586.pl
index e823f65b1a..c20a673dfc 100644
--- a/crypto/sha/asm/sha512-586.pl
+++ b/crypto/sha/asm/sha512-586.pl
@@ -59,8 +59,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0],$ARGV[$#ARGV] eq &quot;386&quot;);
 
diff --git a/crypto/sha/asm/sha512-armv4.pl b/crypto/sha/asm/sha512-armv4.pl
index 39c943b449..410dde2cde 100644
--- a/crypto/sha/asm/sha512-armv4.pl
+++ b/crypto/sha/asm/sha512-armv4.pl
@@ -57,9 +57,10 @@ $hi=&quot;HI&quot;;
 $lo=&quot;LO&quot;;
 # ====================================================================
 
-$flavour = shift;
-if ($flavour=~/\w[\w\-]*\.\w+$/) { $output=$flavour; undef $flavour; }
-else { while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {} }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -67,9 +68,10 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open STDOUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 $ctx=&quot;r0&quot;;	# parameter block
diff --git a/crypto/sha/asm/sha512-armv8.pl b/crypto/sha/asm/sha512-armv8.pl
index b9ba05ba3b..2051157cca 100644
--- a/crypto/sha/asm/sha512-armv8.pl
+++ b/crypto/sha/asm/sha512-armv8.pl
@@ -54,8 +54,10 @@
 # deliver much less improvement, likely *negative* on Cortex-A5x.
 # Which is why NEON support is limited to SHA256.]
 
-$output=pop;
-$flavour=pop;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
@@ -63,10 +65,11 @@ if ($flavour &amp;&amp; $flavour ne &quot;void&quot;) {
     ( $xlate=&quot;${dir}../../perlasm/arm-xlate.pl&quot; and -f $xlate) or
     die &quot;can't locate arm-xlate.pl&quot;;
 
-    open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour $output&quot;;
+    open OUT,&quot;| \&quot;$^X\&quot; $xlate $flavour \&quot;$output\&quot;&quot;
+        or die &quot;can't call $xlate: $!&quot;;
     *STDOUT=*OUT;
 } else {
-    open STDOUT,&quot;&gt;$output&quot;;
+    $output and open STDOUT,&quot;&gt;$output&quot;;
 }
 
 if ($output =~ /512/) {
diff --git a/crypto/sha/asm/sha512-c64xplus.pl b/crypto/sha/asm/sha512-c64xplus.pl
index 270343522e..b7a12544b9 100644
--- a/crypto/sha/asm/sha512-c64xplus.pl
+++ b/crypto/sha/asm/sha512-c64xplus.pl
@@ -29,8 +29,7 @@
 # service routines are expected to preserve it and for own well-being
 # zero it upon entry.
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
+($output = pop) =~ m|\.\w+$| and open STDOUT,&quot;&gt;$output&quot;;
 
 ($CTXA,$INP,$NUM) = (&quot;A4&quot;,&quot;B4&quot;,&quot;A6&quot;);            # arguments
  $K512=&quot;A3&quot;;
diff --git a/crypto/sha/asm/sha512-ia64.pl b/crypto/sha/asm/sha512-ia64.pl
index b6fb43a304..eccc6c92e7 100755
--- a/crypto/sha/asm/sha512-ia64.pl
+++ b/crypto/sha/asm/sha512-ia64.pl
@@ -75,7 +75,8 @@
 # To generate code, pass the file name with either 256 or 512 in its
 # name and compiler flags.
 
-$output=pop;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
 
 if ($output =~ /512.*\.[s|asm]/) {
 	$SZ=8;
@@ -107,7 +108,7 @@ if ($output =~ /512.*\.[s|asm]/) {
 	$rounds=64;
 } else { die &quot;nonsense $output&quot;; }
 
-open STDOUT,&quot;&gt;$output&quot; || die &quot;can't open $output: $!&quot;;
+$output and (open STDOUT,&quot;&gt;$output&quot; or die &quot;can't open $output: $!&quot;);
 
 if ($^O eq &quot;hpux&quot;) {
     $ADDP=&quot;addp4&quot;;
diff --git a/crypto/sha/asm/sha512-mips.pl b/crypto/sha/asm/sha512-mips.pl
index 727b36bd3c..c581bdcb04 100644
--- a/crypto/sha/asm/sha512-mips.pl
+++ b/crypto/sha/asm/sha512-mips.pl
@@ -56,7 +56,14 @@
 # ($s0,$s1,$s2,$s3,$s4,$s5,$s6,$s7)=map(&quot;\$$_&quot;,(16..23));
 # ($gp,$sp,$fp,$ra)=map(&quot;\$$_&quot;,(28..31));
 #
-$flavour = shift || &quot;o32&quot;; # supported flavours are o32,n32,64,nubi32,nubi64
+# if $output doesn't have an extension, it's not an output file
+# so use it for $flavour.
+
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+# supported flavours are o32,n32,64,nubi32,nubi64, default is o32
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : &quot;o32&quot;;
 
 if ($flavour =~ /64|n32/i) {
 	$PTR_LA=&quot;dla&quot;;
@@ -83,7 +90,6 @@ $pf = ($flavour =~ /nubi/i) ? $t0 : $t2;
 
 $big_endian=(`echo MIPSEB | $ENV{CC} -E -`=~/MIPSEB/)?0:1 if ($ENV{CC});
 
-for (@ARGV) {	$output=$_ if (/\w[\w\-]*\.\w+$/);	}
 open STDOUT,&quot;&gt;$output&quot;;
 
 if (!defined($big_endian)) { $big_endian=(unpack('L',pack('N',1))==1); }
diff --git a/crypto/sha/asm/sha512-parisc.pl b/crypto/sha/asm/sha512-parisc.pl
index 66774e2fa1..f406426928 100755
--- a/crypto/sha/asm/sha512-parisc.pl
+++ b/crypto/sha/asm/sha512-parisc.pl
@@ -32,9 +32,12 @@
 #
 # Special thanks to polarhome.com for providing HP-UX account.
 
-$flavour = shift;
-$output = shift;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($flavour =~ /64/) {
 	$LEVEL		=&quot;2.0W&quot;;
diff --git a/crypto/sha/asm/sha512-ppc.pl b/crypto/sha/asm/sha512-ppc.pl
index 424fe66f89..722621ec3f 100755
--- a/crypto/sha/asm/sha512-ppc.pl
+++ b/crypto/sha/asm/sha512-ppc.pl
@@ -41,8 +41,10 @@
 # block signals prior calling this routine. For the record, in 32-bit
 # context R2 serves as TLS pointer, while in 64-bit context - R13.
 
-$flavour=shift;
-$output =shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T=8;
@@ -69,7 +71,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour $output&quot; || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 if ($output =~ /512/) {
 	$func=&quot;sha512_block_ppc&quot;;
diff --git a/crypto/sha/asm/sha512-s390x.pl b/crypto/sha/asm/sha512-s390x.pl
index 9b38603b88..65cb883166 100644
--- a/crypto/sha/asm/sha512-s390x.pl
+++ b/crypto/sha/asm/sha512-s390x.pl
@@ -43,7 +43,10 @@
 # remains z/Architecture specific. On z990 SHA256 was measured to
 # perform 2.4x and SHA512 - 13x better than code generated by gcc 4.3.
 
-$flavour = shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /3[12]/) {
 	$SIZE_T=4;
@@ -71,7 +74,6 @@ $tbl=&quot;%r13&quot;;
 $T1=&quot;%r14&quot;;
 $sp=&quot;%r15&quot;;
 
-while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
 open STDOUT,&quot;&gt;$output&quot;;
 
 if ($output =~ /512/) {
diff --git a/crypto/sha/asm/sha512-sparcv9.pl b/crypto/sha/asm/sha512-sparcv9.pl
index daf6d2260a..fca6e863da 100644
--- a/crypto/sha/asm/sha512-sparcv9.pl
+++ b/crypto/sha/asm/sha512-sparcv9.pl
@@ -56,8 +56,10 @@
 # saturates at 11.5x single-process result on 8-core processor, or
 # ~11/16GBps per 2.85GHz socket.
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+
+$output and open STDOUT,&quot;&gt;$output&quot;;
 
 if ($output =~ /512/) {
 	$label=&quot;512&quot;;
diff --git a/crypto/sha/asm/sha512-x86_64.pl b/crypto/sha/asm/sha512-x86_64.pl
index 18a4385eed..ef84b090db 100755
--- a/crypto/sha/asm/sha512-x86_64.pl
+++ b/crypto/sha/asm/sha512-x86_64.pl
@@ -109,9 +109,10 @@
 #	below certain limit makes no difference/sense; to conserve
 #	space SHA256 XOP code path is therefore omitted;
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -142,7 +143,8 @@ if (!$avx &amp;&amp; `$ENV{CC} -v 2&gt;&amp;1` =~ /((?:^clang|LLVM) version|.*based on LLVM) ([
 $shaext=1;	### set to zero if compiling for 1.0.1
 $avx=1		if (!$shaext &amp;&amp; $avx);
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 if ($output =~ /512/) {
diff --git a/crypto/sha/asm/sha512p8-ppc.pl b/crypto/sha/asm/sha512p8-ppc.pl
index 4721e0afd3..9ee3ed7734 100755
--- a/crypto/sha/asm/sha512p8-ppc.pl
+++ b/crypto/sha/asm/sha512p8-ppc.pl
@@ -40,8 +40,10 @@
 # SHA256	9.7 [15.8]	11.2 [12.5]
 # SHA512	6.1 [10.3]	7.0 [7.9]
 
-$flavour=shift;
-$output =shift;
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 if ($flavour =~ /64/) {
 	$SIZE_T=8;
@@ -64,7 +66,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../perlasm/ppc-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate ppc-xlate.pl&quot;;
 
-open STDOUT,&quot;| $^X $xlate $flavour $output&quot; || die &quot;can't call $xlate: $!&quot;;
+open STDOUT,&quot;| $^X $xlate $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 
 if ($output =~ /512/) {
 	$bits=512;
diff --git a/crypto/sha/build.info b/crypto/sha/build.info
index 187d0c495a..67d9fd4723 100644
--- a/crypto/sha/build.info
+++ b/crypto/sha/build.info
@@ -79,89 +79,86 @@ DEFINE[../../libcrypto]=$SHA1DEF $KECCAK1600DEF
 SOURCE[../../providers/fips]= $COMMON
 DEFINE[../../providers/fips]= $SHA1DEF $KECCAK1600DEF
 
-GENERATE[sha1-586.s]=asm/sha1-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[sha1-586.s]=asm/sha1-586.pl
 DEPEND[sha1-586.s]=../perlasm/x86asm.pl
-GENERATE[sha256-586.s]=asm/sha256-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[sha256-586.s]=asm/sha256-586.pl
 DEPEND[sha256-586.s]=../perlasm/x86asm.pl
-GENERATE[sha512-586.s]=asm/sha512-586.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[sha512-586.s]=asm/sha512-586.pl
 DEPEND[sha512-586.s]=../perlasm/x86asm.pl
 
-GENERATE[sha1-ia64.s]=asm/sha1-ia64.pl $(LIB_CFLAGS) $(LIB_CPPFLAGS)
-GENERATE[sha256-ia64.s]=asm/sha512-ia64.pl $(LIB_CFLAGS) $(LIB_CPPFLAGS)
-GENERATE[sha512-ia64.s]=asm/sha512-ia64.pl $(LIB_CFLAGS) $(LIB_CPPFLAGS)
+GENERATE[sha1-ia64.s]=asm/sha1-ia64.pl
+GENERATE[sha256-ia64.s]=asm/sha512-ia64.pl
+GENERATE[sha512-ia64.s]=asm/sha512-ia64.pl
 
-GENERATE[sha1-alpha.S]=asm/sha1-alpha.pl $(PERLASM_SCHEME)
+GENERATE[sha1-alpha.S]=asm/sha1-alpha.pl
 
-GENERATE[sha1-x86_64.s]=asm/sha1-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[sha1-mb-x86_64.s]=asm/sha1-mb-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[sha256-x86_64.s]=asm/sha512-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[sha256-mb-x86_64.s]=asm/sha256-mb-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[sha512-x86_64.s]=asm/sha512-x86_64.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600-x86_64.s]=asm/keccak1600-x86_64.pl $(PERLASM_SCHEME)
+GENERATE[sha1-x86_64.s]=asm/sha1-x86_64.pl
+GENERATE[sha1-mb-x86_64.s]=asm/sha1-mb-x86_64.pl
+GENERATE[sha256-x86_64.s]=asm/sha512-x86_64.pl
+GENERATE[sha256-mb-x86_64.s]=asm/sha256-mb-x86_64.pl
+GENERATE[sha512-x86_64.s]=asm/sha512-x86_64.pl
+GENERATE[keccak1600-x86_64.s]=asm/keccak1600-x86_64.pl
 
-GENERATE[sha1-sparcv9a.S]=asm/sha1-sparcv9a.pl $(PERLASM_SCHEME)
-GENERATE[sha1-sparcv9.S]=asm/sha1-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[sha1-sparcv9a.S]=asm/sha1-sparcv9a.pl
+GENERATE[sha1-sparcv9.S]=asm/sha1-sparcv9.pl
 INCLUDE[sha1-sparcv9.o]=..
-GENERATE[sha256-sparcv9.S]=asm/sha512-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[sha256-sparcv9.S]=asm/sha512-sparcv9.pl
 INCLUDE[sha256-sparcv9.o]=..
-GENERATE[sha512-sparcv9.S]=asm/sha512-sparcv9.pl $(PERLASM_SCHEME)
+GENERATE[sha512-sparcv9.S]=asm/sha512-sparcv9.pl
 INCLUDE[sha512-sparcv9.o]=..
 
-GENERATE[sha1-ppc.s]=asm/sha1-ppc.pl $(PERLASM_SCHEME)
-GENERATE[sha256-ppc.s]=asm/sha512-ppc.pl $(PERLASM_SCHEME)
-GENERATE[sha512-ppc.s]=asm/sha512-ppc.pl $(PERLASM_SCHEME)
-GENERATE[sha256p8-ppc.s]=asm/sha512p8-ppc.pl $(PERLASM_SCHEME)
-GENERATE[sha512p8-ppc.s]=asm/sha512p8-ppc.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600-ppc64.s]=asm/keccak1600-ppc64.pl $(PERLASM_SCHEME)
+GENERATE[sha1-ppc.s]=asm/sha1-ppc.pl
+GENERATE[sha256-ppc.s]=asm/sha512-ppc.pl
+GENERATE[sha512-ppc.s]=asm/sha512-ppc.pl
+GENERATE[sha256p8-ppc.s]=asm/sha512p8-ppc.pl
+GENERATE[sha512p8-ppc.s]=asm/sha512p8-ppc.pl
+GENERATE[keccak1600-ppc64.s]=asm/keccak1600-ppc64.pl
 
-GENERATE[sha1-parisc.s]=asm/sha1-parisc.pl $(PERLASM_SCHEME)
-GENERATE[sha256-parisc.s]=asm/sha512-parisc.pl $(PERLASM_SCHEME)
-GENERATE[sha512-parisc.s]=asm/sha512-parisc.pl $(PERLASM_SCHEME)
+GENERATE[sha1-parisc.s]=asm/sha1-parisc.pl
+GENERATE[sha256-parisc.s]=asm/sha512-parisc.pl
+GENERATE[sha512-parisc.s]=asm/sha512-parisc.pl
 
-GENERATE[sha1-mips.S]=asm/sha1-mips.pl $(PERLASM_SCHEME)
+GENERATE[sha1-mips.S]=asm/sha1-mips.pl
 INCLUDE[sha1-mips.o]=..
-GENERATE[sha256-mips.S]=asm/sha512-mips.pl $(PERLASM_SCHEME)
+GENERATE[sha256-mips.S]=asm/sha512-mips.pl
 INCLUDE[sha256-mips.o]=..
-GENERATE[sha512-mips.S]=asm/sha512-mips.pl $(PERLASM_SCHEME)
+GENERATE[sha512-mips.S]=asm/sha512-mips.pl
 INCLUDE[sha512-mips.o]=..
 
-GENERATE[sha1-armv4-large.S]=asm/sha1-armv4-large.pl $(PERLASM_SCHEME)
+GENERATE[sha1-armv4-large.S]=asm/sha1-armv4-large.pl
 INCLUDE[sha1-armv4-large.o]=..
-GENERATE[sha256-armv4.S]=asm/sha256-armv4.pl $(PERLASM_SCHEME)
+GENERATE[sha256-armv4.S]=asm/sha256-armv4.pl
 INCLUDE[sha256-armv4.o]=..
-GENERATE[sha512-armv4.S]=asm/sha512-armv4.pl $(PERLASM_SCHEME)
+GENERATE[sha512-armv4.S]=asm/sha512-armv4.pl
 INCLUDE[sha512-armv4.o]=..
-GENERATE[keccak1600-armv4.S]=asm/keccak1600-armv4.pl $(PERLASM_SCHEME)
+GENERATE[keccak1600-armv4.S]=asm/keccak1600-armv4.pl
 INCLUDE[keccak1600-armv4.o]=..
 
-GENERATE[sha1-armv8.S]=asm/sha1-armv8.pl $(PERLASM_SCHEME)
+GENERATE[sha1-armv8.S]=asm/sha1-armv8.pl
 INCLUDE[sha1-armv8.o]=..
-GENERATE[sha256-armv8.S]=asm/sha512-armv8.pl $(PERLASM_SCHEME)
+GENERATE[sha256-armv8.S]=asm/sha512-armv8.pl
 INCLUDE[sha256-armv8.o]=..
-GENERATE[sha512-armv8.S]=asm/sha512-armv8.pl $(PERLASM_SCHEME)
+GENERATE[sha512-armv8.S]=asm/sha512-armv8.pl
 INCLUDE[sha512-armv8.o]=..
-GENERATE[keccak1600-armv8.S]=asm/keccak1600-armv8.pl $(PERLASM_SCHEME)
+GENERATE[keccak1600-armv8.S]=asm/keccak1600-armv8.pl
 
-GENERATE[sha1-s390x.S]=asm/sha1-s390x.pl $(PERLASM_SCHEME)
+GENERATE[sha1-s390x.S]=asm/sha1-s390x.pl
 INCLUDE[sha1-s390x.o]=..
-GENERATE[sha256-s390x.S]=asm/sha512-s390x.pl $(PERLASM_SCHEME)
+GENERATE[sha256-s390x.S]=asm/sha512-s390x.pl
 INCLUDE[sha256-s390x.o]=..
-GENERATE[sha512-s390x.S]=asm/sha512-s390x.pl $(PERLASM_SCHEME)
+GENERATE[sha512-s390x.S]=asm/sha512-s390x.pl
 INCLUDE[sha512-s390x.o]=..
-GENERATE[keccak1600-s390x.S]=asm/keccak1600-s390x.pl $(PERLASM_SCHEME)
+GENERATE[keccak1600-s390x.S]=asm/keccak1600-s390x.pl
 
-GENERATE[sha1-c64xplus.S]=asm/sha1-c64xplus.pl $(PERLASM_SCHEME)
-GENERATE[sha256-c64xplus.S]=asm/sha256-c64xplus.pl $(PERLASM_SCHEME)
-GENERATE[sha512-c64xplus.S]=asm/sha512-c64xplus.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600-c64x.S]=asm/keccak1600-c64x.pl $(PERLASM_SCHEME)
+GENERATE[sha1-c64xplus.S]=asm/sha1-c64xplus.pl
+GENERATE[sha256-c64xplus.S]=asm/sha256-c64xplus.pl
+GENERATE[sha512-c64xplus.S]=asm/sha512-c64xplus.pl
+GENERATE[keccak1600-c64x.S]=asm/keccak1600-c64x.pl
 
 # These are not yet used
-GENERATE[keccak1600-avx2.S]=asm/keccak1600-avx2.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600-avx512.S]=asm/keccak1600-avx512.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600-avx512vl.S]=asm/keccak1600-avx512vl.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600-mmx.S]=asm/keccak1600-mmx.pl $(PERLASM_SCHEME)
-GENERATE[keccak1600p8-ppc.S]=asm/keccak1600p8-ppc.pl $(PERLASM_SCHEME)
-GENERATE[sha1-thumb.S]=asm/sha1-thumb.pl $(PERLASM_SCHEME)
+GENERATE[keccak1600-avx2.S]=asm/keccak1600-avx2.pl
+GENERATE[keccak1600-avx512.S]=asm/keccak1600-avx512.pl
+GENERATE[keccak1600-avx512vl.S]=asm/keccak1600-avx512vl.pl
+GENERATE[keccak1600-mmx.S]=asm/keccak1600-mmx.pl
+GENERATE[keccak1600p8-ppc.S]=asm/keccak1600p8-ppc.pl
+GENERATE[sha1-thumb.S]=asm/sha1-thumb.pl
diff --git a/crypto/whrlpool/asm/wp-mmx.pl b/crypto/whrlpool/asm/wp-mmx.pl
index a0ab3a0acb..39cd220456 100644
--- a/crypto/whrlpool/asm/wp-mmx.pl
+++ b/crypto/whrlpool/asm/wp-mmx.pl
@@ -56,8 +56,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/crypto/whrlpool/asm/wp-x86_64.pl b/crypto/whrlpool/asm/wp-x86_64.pl
index 03e902079e..e5b51501e9 100644
--- a/crypto/whrlpool/asm/wp-x86_64.pl
+++ b/crypto/whrlpool/asm/wp-x86_64.pl
@@ -37,9 +37,10 @@
 # 3 on Opteron] and which is *unacceptably* slow with 64-bit
 # operand.
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -48,7 +49,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; my $dir=$1; my $xlate;
 ( $xlate=&quot;${dir}../../perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+    or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 sub L() { $code.=&quot;.byte	&quot;.join(','<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>).&quot;\n&quot;; }
diff --git a/crypto/whrlpool/build.info b/crypto/whrlpool/build.info
index f67bf41b5e..3276bd1237 100644
--- a/crypto/whrlpool/build.info
+++ b/crypto/whrlpool/build.info
@@ -20,8 +20,7 @@ ENDIF
 SOURCE[../../libcrypto]=wp_dgst.c $WPASM
 DEFINE[../../libcrypto]=$WPDEF
 
-GENERATE[wp-mmx.s]=asm/wp-mmx.pl \
-        $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
+GENERATE[wp-mmx.s]=asm/wp-mmx.pl
 DEPEND[wp-mmx.s]=../perlasm/x86asm.pl
 
-GENERATE[wp-x86_64.s]=asm/wp-x86_64.pl $(PERLASM_SCHEME)
+GENERATE[wp-x86_64.s]=asm/wp-x86_64.pl
\ No newline at end of file
diff --git a/crypto/x86_64cpuid.pl b/crypto/x86_64cpuid.pl
index 6b3373708e..43e53d6fd4 100644
--- a/crypto/x86_64cpuid.pl
+++ b/crypto/x86_64cpuid.pl
@@ -7,9 +7,10 @@
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -18,7 +19,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+     or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 ($arg1,$arg2,$arg3,$arg4)=$win64?(&quot;%rcx&quot;,&quot;%rdx&quot;,&quot;%r8&quot;, &quot;%r9&quot;) :	# Win64 order
diff --git a/crypto/x86cpuid.pl b/crypto/x86cpuid.pl
index f15d55723b..bf8020d2af 100644
--- a/crypto/x86cpuid.pl
+++ b/crypto/x86cpuid.pl
@@ -10,9 +10,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC, &quot;${dir}perlasm&quot;, &quot;perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output = pop;
-open OUT,&quot;&gt;$output&quot;;
-*STDOUT=*OUT;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/engines/asm/e_padlock-x86.pl b/engines/asm/e_padlock-x86.pl
index 73e72e61e7..f579a4d933 100644
--- a/engines/asm/e_padlock-x86.pl
+++ b/engines/asm/e_padlock-x86.pl
@@ -42,8 +42,7 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}&quot;,&quot;${dir}../../crypto/perlasm&quot;);
 require &quot;x86asm.pl&quot;;
 
-$output=pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output=pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/engines/asm/e_padlock-x86_64.pl b/engines/asm/e_padlock-x86_64.pl
index 63a0532094..7982f19932 100644
--- a/engines/asm/e_padlock-x86_64.pl
+++ b/engines/asm/e_padlock-x86_64.pl
@@ -19,9 +19,10 @@
 # Assembler helpers for Padlock engine. See even e_padlock-x86.pl for
 # details.
 
-$flavour = shift;
-$output  = shift;
-if ($flavour =~ /\./) { $output = $flavour; undef $flavour; }
+# $output is the last argument if it looks like a file (it has an extension)
+# $flavour is the first argument if it doesn't look like a file
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+$flavour = $#ARGV &gt;= 0 &amp;&amp; $ARGV[0] !~ m|\.| ? shift : undef;
 
 $win64=0; $win64=1 if ($flavour =~ /[nm]asm|mingw64/ || $output =~ /\.asm$/);
 
@@ -30,7 +31,8 @@ $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 ( $xlate=&quot;${dir}../../crypto/perlasm/x86_64-xlate.pl&quot; and -f $xlate) or
 die &quot;can't locate x86_64-xlate.pl&quot;;
 
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;$xlate\&quot; $flavour \&quot;$output\&quot;&quot;
+     or die &quot;can't call $xlate: $!&quot;;
 *STDOUT=*OUT;
 
 $code=&quot;.text\n&quot;;
diff --git a/engines/build.info b/engines/build.info
index 77aab6d525..fca41358e9 100644
--- a/engines/build.info
+++ b/engines/build.info
@@ -86,7 +86,6 @@ IF[{- !$disabled{&quot;engine&quot;} -}]
       GENERATE[ossltest.ld]=../util/engines.num
     ENDIF
   ENDIF
-  GENERATE[e_padlock-x86.s]=asm/e_padlock-x86.pl \
-    $(PERLASM_SCHEME) $(LIB_CFLAGS) $(LIB_CPPFLAGS) $(PROCESSOR)
-  GENERATE[e_padlock-x86_64.s]=asm/e_padlock-x86_64.pl $(PERLASM_SCHEME)
+  GENERATE[e_padlock-x86.s]=asm/e_padlock-x86.pl
+  GENERATE[e_padlock-x86_64.s]=asm/e_padlock-x86_64.pl
 ENDIF
diff --git a/ms/uplink-ia64.pl b/ms/uplink-ia64.pl
index 7287544079..757e77d29f 100755
--- a/ms/uplink-ia64.pl
+++ b/ms/uplink-ia64.pl
@@ -6,8 +6,7 @@
 # in the file LICENSE in the source distribution or at
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
 push(@INC,&quot;${dir}.&quot;);
diff --git a/ms/uplink-x86.pl b/ms/uplink-x86.pl
index 300ed0d3a8..bad4901802 100755
--- a/ms/uplink-x86.pl
+++ b/ms/uplink-x86.pl
@@ -12,8 +12,7 @@ require &quot;x86asm.pl&quot;;
 
 require &quot;uplink-common.pl&quot;;
 
-$output = pop;
-open STDOUT,&quot;&gt;$output&quot;;
+$output = pop and open STDOUT,&quot;&gt;$output&quot;;
 
 &amp;asm_init($ARGV[0]);
 
diff --git a/ms/uplink-x86_64.pl b/ms/uplink-x86_64.pl
index 9efe5ab98b..5564c2c7ba 100755
--- a/ms/uplink-x86_64.pl
+++ b/ms/uplink-x86_64.pl
@@ -6,9 +6,12 @@
 # in the file LICENSE in the source distribution or at
 # <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
-$output=pop;
+# $output is the last argument if it looks like a file (it has an extension)
+$output = $#ARGV &gt;= 0 &amp;&amp; $ARGV[$#ARGV] =~ m|\.\w+$| ? pop : undef;
+
 $0 =~ m/(.*[\/\\])[^\/\\]+$/; $dir=$1;
-open OUT,&quot;| \&quot;$^X\&quot; \&quot;${dir}../crypto/perlasm/x86_64-xlate.pl\&quot; \&quot;$output\&quot;&quot;;
+open OUT,&quot;| \&quot;$^X\&quot; \&quot;${dir}../crypto/perlasm/x86_64-xlate.pl\&quot; \&quot;$output\&quot;&quot;
+    or die &quot;can't call ${dir}../crypto/perlasm/x86_64-xlate.pl: $!&quot;;
 *STDOUT=*OUT;
 push(@INC,&quot;${dir}.&quot;);
 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025147.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="025154.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25151">[ date ]</a>
              <a href="thread.html#25151">[ thread ]</a>
              <a href="subject.html#25151">[ subject ]</a>
              <a href="author.html#25151">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
