<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1441312003.206850.21793.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001741.html">
   <LINK REL="Next"  HREF="001743.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1441312003.206850.21793.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Thu Sep  3 20:26:43 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001741.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="001743.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1742">[ date ]</a>
              <a href="thread.html#1742">[ thread ]</a>
              <a href="subject.html#1742">[ subject ]</a>
              <a href="author.html#1742">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  64b25758edca688a30f02c260262150f7ad0bc7d (commit)
      from  fb4844bbc62fb014c115cd8fd2fc4304cba6eb89 (commit)


- Log -----------------------------------------------------------------
commit 64b25758edca688a30f02c260262150f7ad0bc7d
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at akamai.com</A>&gt;
Date:   Thu Sep 3 09:15:26 2015 -0400

    remove 0 assignments.
    
    After openssl_zalloc, cleanup more &quot;set to 0/NULL&quot; assignments.
    Many are from github feedback.
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 apps/s_cb.c                 |  9 +--------
 crypto/asn1/a_object.c      |  7 +------
 crypto/asn1/ameth_lib.c     | 35 ++---------------------------------
 crypto/asn1/asn1_lib.c      |  5 +----
 crypto/asn1/tasn_prn.c      |  8 ++------
 crypto/asn1/x_info.c        | 12 ++----------
 crypto/asn1/x_pkey.c        |  7 -------
 crypto/bio/bf_buff.c        | 10 +++-------
 crypto/bio/bf_nbio.c        |  3 +--
 crypto/bio/bss_dgram.c      |  3 ---
 crypto/bn/bn_ctx.c          |  6 +-----
 crypto/bn/bn_lib.c          |  6 +-----
 crypto/buffer/buffer.c      |  6 +-----
 crypto/comp/c_zlib.c        | 19 ++-----------------
 crypto/conf/conf_mod.c      |  3 +--
 crypto/dh/dh_lib.c          | 15 +--------------
 crypto/dh/dh_pmeth.c        | 12 ++----------
 crypto/dsa/dsa_lib.c        | 15 +--------------
 crypto/ec/ec_key.c          |  8 +-------
 crypto/ec/ec_lib.c          | 16 ++--------------
 crypto/ec/ec_mult.c         |  5 +----
 crypto/ec/ec_pmeth.c        | 11 +----------
 crypto/ecdsa/ecs_lib.c      |  9 +--------
 crypto/engine/eng_dyn.c     | 13 +++----------
 crypto/engine/eng_openssl.c |  7 ++-----
 crypto/evp/bio_b64.c        |  8 +-------
 crypto/evp/bio_enc.c        |  8 ++------
 crypto/evp/bio_ok.c         | 10 +---------
 crypto/evp/pmeth_lib.c      | 30 +-----------------------------
 crypto/hmac/hm_pmeth.c      |  7 ++-----
 crypto/lhash/lhash.c        | 26 +++-----------------------
 crypto/objects/o_names.c    |  6 +-----
 crypto/ocsp/ocsp_ht.c       |  3 +--
 crypto/rsa/rsa_lib.c        | 18 +-----------------
 crypto/rsa/rsa_pmeth.c      | 11 +----------
 crypto/stack/stack.c        |  8 ++------
 crypto/ui/ui_lib.c          |  5 +----
 crypto/x509/x509_lu.c       | 20 ++------------------
 crypto/x509/x_name.c        |  4 +---
 crypto/x509v3/Makefile      | 29 +++++++++++++++--------------
 crypto/x509v3/pcy_data.c    |  7 ++-----
 crypto/x509v3/pcy_node.c    |  4 ++--
 crypto/x509v3/pcy_tree.c    |  6 +-----
 engines/e_capi.c            |  7 +------
 ssl/ssl_conf.c              | 18 +-----------------
 ssl/ssl_lib.c               | 43 +------------------------------------------
 ssl/ssl_sess.c              | 19 +------------------
 47 files changed, 78 insertions(+), 469 deletions(-)

diff --git a/apps/s_cb.c b/apps/s_cb.c
index 07ce997..a1305d3 100644
--- a/apps/s_cb.c
+++ b/apps/s_cb.c
@@ -991,14 +991,7 @@ static int ssl_excert_prepend(SSL_EXCERT **pexc)
 {
     SSL_EXCERT *exc = app_malloc(sizeof(*exc), &quot;prepend cert&quot;);
 
-    exc-&gt;certfile = NULL;
-    exc-&gt;keyfile = NULL;
-    exc-&gt;chainfile = NULL;
-    exc-&gt;cert = NULL;
-    exc-&gt;key = NULL;
-    exc-&gt;chain = NULL;
-    exc-&gt;prev = NULL;
-    exc-&gt;build_chain = 0;
+    memset(exc, 0, sizeof(*exc));
 
     exc-&gt;next = *pexc;
     *pexc = exc;
diff --git a/crypto/asn1/a_object.c b/crypto/asn1/a_object.c
index ab37fa3..44473dc 100644
--- a/crypto/asn1/a_object.c
+++ b/crypto/asn1/a_object.c
@@ -345,16 +345,11 @@ ASN1_OBJECT *ASN1_OBJECT_new(void)
 {
     ASN1_OBJECT *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         ASN1err(ASN1_F_ASN1_OBJECT_NEW, ERR_R_MALLOC_FAILURE);
         return (NULL);
     }
-    ret-&gt;length = 0;
-    ret-&gt;data = NULL;
-    ret-&gt;nid = 0;
-    ret-&gt;sn = NULL;
-    ret-&gt;ln = NULL;
     ret-&gt;flags = ASN1_OBJECT_FLAG_DYNAMIC;
     return (ret);
 }
diff --git a/crypto/asn1/ameth_lib.c b/crypto/asn1/ameth_lib.c
index 155de83..feef015 100644
--- a/crypto/asn1/ameth_lib.c
+++ b/crypto/asn1/ameth_lib.c
@@ -296,48 +296,17 @@ EVP_PKEY_ASN1_METHOD *EVP_PKEY_asn1_new(int id, int flags,
         ameth-&gt;info = BUF_strdup(info);
         if (!ameth-&gt;info)
             goto err;
-    } else
-        ameth-&gt;info = NULL;
+    }
 
     if (pem_str) {
         ameth-&gt;pem_str = BUF_strdup(pem_str);
         if (!ameth-&gt;pem_str)
             goto err;
-    } else
-        ameth-&gt;pem_str = NULL;
-
-    ameth-&gt;pub_decode = 0;
-    ameth-&gt;pub_encode = 0;
-    ameth-&gt;pub_cmp = 0;
-    ameth-&gt;pub_print = 0;
-
-    ameth-&gt;priv_decode = 0;
-    ameth-&gt;priv_encode = 0;
-    ameth-&gt;priv_print = 0;
-
-    ameth-&gt;old_priv_encode = 0;
-    ameth-&gt;old_priv_decode = 0;
-
-    ameth-&gt;item_verify = 0;
-    ameth-&gt;item_sign = 0;
-
-    ameth-&gt;pkey_size = 0;
-    ameth-&gt;pkey_bits = 0;
-
-    ameth-&gt;param_decode = 0;
-    ameth-&gt;param_encode = 0;
-    ameth-&gt;param_missing = 0;
-    ameth-&gt;param_copy = 0;
-    ameth-&gt;param_cmp = 0;
-    ameth-&gt;param_print = 0;
-
-    ameth-&gt;pkey_free = 0;
-    ameth-&gt;pkey_ctrl = 0;
+    }
 
     return ameth;
 
  err:
-
     EVP_PKEY_asn1_free(ameth);
     return NULL;
 
diff --git a/crypto/asn1/asn1_lib.c b/crypto/asn1/asn1_lib.c
index 94b5ad5..3b36644 100644
--- a/crypto/asn1/asn1_lib.c
+++ b/crypto/asn1/asn1_lib.c
@@ -348,15 +348,12 @@ ASN1_STRING *ASN1_STRING_type_new(int type)
 {
     ASN1_STRING *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         ASN1err(ASN1_F_ASN1_STRING_TYPE_NEW, ERR_R_MALLOC_FAILURE);
         return (NULL);
     }
-    ret-&gt;length = 0;
     ret-&gt;type = type;
-    ret-&gt;data = NULL;
-    ret-&gt;flags = 0;
     return (ret);
 }
 
diff --git a/crypto/asn1/tasn_prn.c b/crypto/asn1/tasn_prn.c
index 716db8f..5314c61 100644
--- a/crypto/asn1/tasn_prn.c
+++ b/crypto/asn1/tasn_prn.c
@@ -85,16 +85,12 @@ ASN1_PCTX default_pctx = {
 ASN1_PCTX *ASN1_PCTX_new(void)
 {
     ASN1_PCTX *ret;
-    ret = OPENSSL_malloc(sizeof(*ret));
+
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         ASN1err(ASN1_F_ASN1_PCTX_NEW, ERR_R_MALLOC_FAILURE);
         return NULL;
     }
-    ret-&gt;flags = 0;
-    ret-&gt;nm_flags = 0;
-    ret-&gt;cert_flags = 0;
-    ret-&gt;oid_flags = 0;
-    ret-&gt;str_flags = 0;
     return ret;
 }
 
diff --git a/crypto/asn1/x_info.c b/crypto/asn1/x_info.c
index 5be934c..0a75e49 100644
--- a/crypto/asn1/x_info.c
+++ b/crypto/asn1/x_info.c
@@ -64,22 +64,14 @@
 
 X509_INFO *X509_INFO_new(void)
 {
-    X509_INFO *ret = NULL;
+    X509_INFO *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         ASN1err(ASN1_F_X509_INFO_NEW, ERR_R_MALLOC_FAILURE);
         return (NULL);
     }
-
-    ret-&gt;enc_cipher.cipher = NULL;
-    ret-&gt;enc_len = 0;
-    ret-&gt;enc_data = NULL;
-
     ret-&gt;references = 1;
-    ret-&gt;x509 = NULL;
-    ret-&gt;crl = NULL;
-    ret-&gt;x_pkey = NULL;
     return (ret);
 }
 
diff --git a/crypto/asn1/x_pkey.c b/crypto/asn1/x_pkey.c
index 0710419..0665aab 100644
--- a/crypto/asn1/x_pkey.c
+++ b/crypto/asn1/x_pkey.c
@@ -70,17 +70,10 @@ X509_PKEY *X509_PKEY_new(void)
     if (!ret)
         goto err;
 
-    ret-&gt;version = 0;
     ret-&gt;enc_algor = X509_ALGOR_new();
     ret-&gt;enc_pkey = ASN1_OCTET_STRING_new();
     if (!ret-&gt;enc_algor || !ret-&gt;enc_pkey)
         goto err;
-    ret-&gt;dec_pkey = NULL;
-    ret-&gt;key_length = 0;
-    ret-&gt;key_data = NULL;
-    ret-&gt;key_free = 0;
-    ret-&gt;cipher.cipher = NULL;
-    memset(ret-&gt;cipher.iv, 0, EVP_MAX_IV_LENGTH);
     ret-&gt;references = 1;
     return ret;
 err:
diff --git a/crypto/bio/bf_buff.c b/crypto/bio/bf_buff.c
index 4fd8d15..b7a3772 100644
--- a/crypto/bio/bf_buff.c
+++ b/crypto/bio/bf_buff.c
@@ -91,27 +91,23 @@ BIO_METHOD *BIO_f_buffer(void)
 
 static int buffer_new(BIO *bi)
 {
-    BIO_F_BUFFER_CTX *ctx = OPENSSL_malloc(sizeof(*ctx));
+    BIO_F_BUFFER_CTX *ctx = OPENSSL_zalloc(sizeof(*ctx));
 
     if (ctx == NULL)
         return (0);
+    ctx-&gt;ibuf_size = DEFAULT_BUFFER_SIZE;
     ctx-&gt;ibuf = OPENSSL_malloc(DEFAULT_BUFFER_SIZE);
     if (ctx-&gt;ibuf == NULL) {
         OPENSSL_free(ctx);
         return (0);
     }
+    ctx-&gt;obuf_size = DEFAULT_BUFFER_SIZE;
     ctx-&gt;obuf = OPENSSL_malloc(DEFAULT_BUFFER_SIZE);
     if (ctx-&gt;obuf == NULL) {
         OPENSSL_free(ctx-&gt;ibuf);
         OPENSSL_free(ctx);
         return (0);
     }
-    ctx-&gt;ibuf_size = DEFAULT_BUFFER_SIZE;
-    ctx-&gt;obuf_size = DEFAULT_BUFFER_SIZE;
-    ctx-&gt;ibuf_len = 0;
-    ctx-&gt;ibuf_off = 0;
-    ctx-&gt;obuf_len = 0;
-    ctx-&gt;obuf_off = 0;
 
     bi-&gt;init = 1;
     bi-&gt;ptr = (char *)ctx;
diff --git a/crypto/bio/bf_nbio.c b/crypto/bio/bf_nbio.c
index 7980711..2a2e314 100644
--- a/crypto/bio/bf_nbio.c
+++ b/crypto/bio/bf_nbio.c
@@ -102,13 +102,12 @@ static int nbiof_new(BIO *bi)
 {
     NBIO_TEST *nt;
 
-    if ((nt = OPENSSL_malloc(sizeof(*nt))) == NULL)
+    if ((nt = OPENSSL_zalloc(sizeof(*nt))) == NULL)
         return (0);
     nt-&gt;lrn = -1;
     nt-&gt;lwn = -1;
     bi-&gt;ptr = (char *)nt;
     bi-&gt;init = 1;
-    bi-&gt;flags = 0;
     return (1);
 }
 
diff --git a/crypto/bio/bss_dgram.c b/crypto/bio/bss_dgram.c
index bbb9aca..91474fc 100644
--- a/crypto/bio/bss_dgram.c
+++ b/crypto/bio/bss_dgram.c
@@ -225,10 +225,7 @@ static int dgram_new(BIO *bi)
 
     if (data == NULL)
         return 0;
-    bi-&gt;init = 0;
-    bi-&gt;num = 0;
     bi-&gt;ptr = data;
-    bi-&gt;flags = 0;
     return (1);
 }
 
diff --git a/crypto/bn/bn_ctx.c b/crypto/bn/bn_ctx.c
index 660e626..756d404 100644
--- a/crypto/bn/bn_ctx.c
+++ b/crypto/bn/bn_ctx.c
@@ -190,17 +190,13 @@ BN_CTX *BN_CTX_new(void)
 {
     BN_CTX *ret;
 
-    if ((ret = OPENSSL_malloc(sizeof(*ret))) == NULL) {
+    if ((ret = OPENSSL_zalloc(sizeof(*ret))) == NULL) {
         BNerr(BN_F_BN_CTX_NEW, ERR_R_MALLOC_FAILURE);
         return NULL;
     }
     /* Initialise the structure */
     BN_POOL_init(&amp;ret-&gt;pool);
     BN_STACK_init(&amp;ret-&gt;stack);
-    ret-&gt;used = 0;
-    ret-&gt;err_stack = 0;
-    ret-&gt;too_many = 0;
-    ret-&gt;flags = 0;
     return ret;
 }
 
diff --git a/crypto/bn/bn_lib.c b/crypto/bn/bn_lib.c
index 2ca6bea..3b07d7d 100644
--- a/crypto/bn/bn_lib.c
+++ b/crypto/bn/bn_lib.c
@@ -275,15 +275,11 @@ BIGNUM *BN_new(void)
 {
     BIGNUM *ret;
 
-    if ((ret = OPENSSL_malloc(sizeof(*ret))) == NULL) {
+    if ((ret = OPENSSL_zalloc(sizeof(*ret))) == NULL) {
         BNerr(BN_F_BN_NEW, ERR_R_MALLOC_FAILURE);
         return (NULL);
     }
     ret-&gt;flags = BN_FLG_MALLOCED;
-    ret-&gt;top = 0;
-    ret-&gt;neg = 0;
-    ret-&gt;dmax = 0;
-    ret-&gt;d = NULL;
     bn_check_top(ret);
     return (ret);
 }
diff --git a/crypto/buffer/buffer.c b/crypto/buffer/buffer.c
index 5ee11f4..705037b 100644
--- a/crypto/buffer/buffer.c
+++ b/crypto/buffer/buffer.c
@@ -81,15 +81,11 @@ BUF_MEM *BUF_MEM_new(void)
 {
     BUF_MEM *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         BUFerr(BUF_F_BUF_MEM_NEW, ERR_R_MALLOC_FAILURE);
         return (NULL);
     }
-    ret-&gt;flags = 0;
-    ret-&gt;length = 0;
-    ret-&gt;max = 0;
-    ret-&gt;data = NULL;
     return (ret);
 }
 
diff --git a/crypto/comp/c_zlib.c b/crypto/comp/c_zlib.c
index 4747511..ea01ba4 100644
--- a/crypto/comp/c_zlib.c
+++ b/crypto/comp/c_zlib.c
@@ -166,7 +166,7 @@ struct zlib_state {
 static int zlib_stateful_init(COMP_CTX *ctx)
 {
     int err;
-    struct zlib_state *state = OPENSSL_malloc(sizeof(*state));
+    struct zlib_state *state = OPENSSL_zalloc(sizeof(*state));
 
     if (state == NULL)
         goto err;
@@ -176,8 +176,6 @@ static int zlib_stateful_init(COMP_CTX *ctx)
     state-&gt;istream.opaque = Z_NULL;
     state-&gt;istream.next_in = Z_NULL;
     state-&gt;istream.next_out = Z_NULL;
-    state-&gt;istream.avail_in = 0;
-    state-&gt;istream.avail_out = 0;
     err = inflateInit_(&amp;state-&gt;istream, ZLIB_VERSION, sizeof(z_stream));
     if (err != Z_OK)
         goto err;
@@ -187,8 +185,6 @@ static int zlib_stateful_init(COMP_CTX *ctx)
     state-&gt;ostream.opaque = Z_NULL;
     state-&gt;ostream.next_in = Z_NULL;
     state-&gt;ostream.next_out = Z_NULL;
-    state-&gt;ostream.avail_in = 0;
-    state-&gt;ostream.avail_out = 0;
     err = deflateInit_(&amp;state-&gt;ostream, Z_DEFAULT_COMPRESSION,
                        ZLIB_VERSION, sizeof(z_stream));
     if (err != Z_OK)
@@ -367,28 +363,17 @@ static int bio_zlib_new(BIO *bi)
         return 0;
     }
 # endif
-    ctx = OPENSSL_malloc(sizeof(*ctx));
+    ctx = OPENSSL_zalloc(sizeof(*ctx));
     if (!ctx) {
         COMPerr(COMP_F_BIO_ZLIB_NEW, ERR_R_MALLOC_FAILURE);
         return 0;
     }
-    ctx-&gt;ibuf = NULL;
-    ctx-&gt;obuf = NULL;
     ctx-&gt;ibufsize = ZLIB_DEFAULT_BUFSIZE;
     ctx-&gt;obufsize = ZLIB_DEFAULT_BUFSIZE;
     ctx-&gt;zin.zalloc = Z_NULL;
     ctx-&gt;zin.zfree = Z_NULL;
-    ctx-&gt;zin.next_in = NULL;
-    ctx-&gt;zin.avail_in = 0;
-    ctx-&gt;zin.next_out = NULL;
-    ctx-&gt;zin.avail_out = 0;
     ctx-&gt;zout.zalloc = Z_NULL;
     ctx-&gt;zout.zfree = Z_NULL;
-    ctx-&gt;zout.next_in = NULL;
-    ctx-&gt;zout.avail_in = 0;
-    ctx-&gt;zout.next_out = NULL;
-    ctx-&gt;zout.avail_out = 0;
-    ctx-&gt;odone = 0;
     ctx-&gt;comp_level = Z_DEFAULT_COMPRESSION;
     bi-&gt;init = 1;
     bi-&gt;ptr = (char *)ctx;
diff --git a/crypto/conf/conf_mod.c b/crypto/conf/conf_mod.c
index 7fbb4ad..c23a0f6 100644
--- a/crypto/conf/conf_mod.c
+++ b/crypto/conf/conf_mod.c
@@ -281,7 +281,7 @@ static CONF_MODULE *module_add(DSO *dso, const char *name,
         supported_modules = sk_CONF_MODULE_new_null();
     if (supported_modules == NULL)
         return NULL;
-    tmod = OPENSSL_malloc(sizeof(*tmod));
+    tmod = OPENSSL_zalloc(sizeof(*tmod));
     if (tmod == NULL)
         return NULL;
 
@@ -289,7 +289,6 @@ static CONF_MODULE *module_add(DSO *dso, const char *name,
     tmod-&gt;name = BUF_strdup(name);
     tmod-&gt;init = ifunc;
     tmod-&gt;finish = ffunc;
-    tmod-&gt;links = 0;
 
     if (!sk_CONF_MODULE_push(supported_modules, tmod)) {
         OPENSSL_free(tmod);
diff --git a/crypto/dh/dh_lib.c b/crypto/dh/dh_lib.c
index 4e087d0..49f82d8 100644
--- a/crypto/dh/dh_lib.c
+++ b/crypto/dh/dh_lib.c
@@ -107,7 +107,7 @@ DH *DH_new(void)
 
 DH *DH_new_method(ENGINE *engine)
 {
-    DH *ret = OPENSSL_malloc(sizeof(*ret));
+    DH *ret = OPENSSL_zalloc(sizeof(*ret));
 
     if (ret == NULL) {
         DHerr(DH_F_DH_NEW_METHOD, ERR_R_MALLOC_FAILURE);
@@ -136,19 +136,6 @@ DH *DH_new_method(ENGINE *engine)
     }
 #endif
 
-    ret-&gt;pad = 0;
-    ret-&gt;version = 0;
-    ret-&gt;p = NULL;
-    ret-&gt;g = NULL;
-    ret-&gt;length = 0;
-    ret-&gt;pub_key = NULL;
-    ret-&gt;priv_key = NULL;
-    ret-&gt;q = NULL;
-    ret-&gt;j = NULL;
-    ret-&gt;seed = NULL;
-    ret-&gt;seedlen = 0;
-    ret-&gt;counter = NULL;
-    ret-&gt;method_mont_p = NULL;
     ret-&gt;references = 1;
     ret-&gt;flags = ret-&gt;meth-&gt;flags;
     CRYPTO_new_ex_data(CRYPTO_EX_INDEX_DH, ret, &amp;ret-&gt;ex_data);
diff --git a/crypto/dh/dh_pmeth.c b/crypto/dh/dh_pmeth.c
index 751428c..ff27221 100644
--- a/crypto/dh/dh_pmeth.c
+++ b/crypto/dh/dh_pmeth.c
@@ -98,22 +98,14 @@ typedef struct {
 static int pkey_dh_init(EVP_PKEY_CTX *ctx)
 {
     DH_PKEY_CTX *dctx;
-    dctx = OPENSSL_malloc(sizeof(*dctx));
+
+    dctx = OPENSSL_zalloc(sizeof(*dctx));
     if (!dctx)
         return 0;
     dctx-&gt;prime_len = 1024;
     dctx-&gt;subprime_len = -1;
     dctx-&gt;generator = 2;
-    dctx-&gt;use_dsa = 0;
-    dctx-&gt;md = NULL;
-    dctx-&gt;rfc5114_param = 0;
-
     dctx-&gt;kdf_type = EVP_PKEY_DH_KDF_NONE;
-    dctx-&gt;kdf_oid = NULL;
-    dctx-&gt;kdf_md = NULL;
-    dctx-&gt;kdf_ukm = NULL;
-    dctx-&gt;kdf_ukmlen = 0;
-    dctx-&gt;kdf_outlen = 0;
 
     ctx-&gt;data = dctx;
     ctx-&gt;keygen_info = dctx-&gt;gentmp;
diff --git a/crypto/dsa/dsa_lib.c b/crypto/dsa/dsa_lib.c
index a4a8163..b78a2bf 100644
--- a/crypto/dsa/dsa_lib.c
+++ b/crypto/dsa/dsa_lib.c
@@ -115,7 +115,7 @@ DSA *DSA_new_method(ENGINE *engine)
 {
     DSA *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         DSAerr(DSA_F_DSA_NEW_METHOD, ERR_R_MALLOC_FAILURE);
         return (NULL);
@@ -142,19 +142,6 @@ DSA *DSA_new_method(ENGINE *engine)
     }
 #endif
 
-    ret-&gt;pad = 0;
-    ret-&gt;version = 0;
-    ret-&gt;p = NULL;
-    ret-&gt;q = NULL;
-    ret-&gt;g = NULL;
-
-    ret-&gt;pub_key = NULL;
-    ret-&gt;priv_key = NULL;
-
-    ret-&gt;kinv = NULL;
-    ret-&gt;r = NULL;
-    ret-&gt;method_mont_p = NULL;
-
     ret-&gt;references = 1;
     ret-&gt;flags = ret-&gt;meth-&gt;flags &amp; ~DSA_FLAG_NON_FIPS_ALLOW;
     CRYPTO_new_ex_data(CRYPTO_EX_INDEX_DSA, ret, &amp;ret-&gt;ex_data);
diff --git a/crypto/ec/ec_key.c b/crypto/ec/ec_key.c
index a954c8e..2380097 100644
--- a/crypto/ec/ec_key.c
+++ b/crypto/ec/ec_key.c
@@ -67,7 +67,7 @@
 
 EC_KEY *EC_KEY_new(void)
 {
-    EC_KEY *ret = OPENSSL_malloc(sizeof(*ret));
+    EC_KEY *ret = OPENSSL_zalloc(sizeof(*ret));
 
     if (ret == NULL) {
         ECerr(EC_F_EC_KEY_NEW, ERR_R_MALLOC_FAILURE);
@@ -75,14 +75,8 @@ EC_KEY *EC_KEY_new(void)
     }
 
     ret-&gt;version = 1;
-    ret-&gt;flags = 0;
-    ret-&gt;group = NULL;
-    ret-&gt;pub_key = NULL;
-    ret-&gt;priv_key = NULL;
-    ret-&gt;enc_flag = 0;
     ret-&gt;conv_form = POINT_CONVERSION_UNCOMPRESSED;
     ret-&gt;references = 1;
-    ret-&gt;method_data = NULL;
     return (ret);
 }
 
diff --git a/crypto/ec/ec_lib.c b/crypto/ec/ec_lib.c
index cd08a55..793645d 100644
--- a/crypto/ec/ec_lib.c
+++ b/crypto/ec/ec_lib.c
@@ -83,37 +83,25 @@ EC_GROUP *EC_GROUP_new(const EC_METHOD *meth)
         return NULL;
     }
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         ECerr(EC_F_EC_GROUP_NEW, ERR_R_MALLOC_FAILURE);
         return NULL;
     }
 
     ret-&gt;meth = meth;
-
-    ret-&gt;extra_data = NULL;
-    ret-&gt;mont_data = NULL;
-
-    ret-&gt;generator = NULL;
     ret-&gt;order = BN_new();
-    ret-&gt;cofactor = NULL;
     if (!ret-&gt;order)
         goto err;
     ret-&gt;cofactor = BN_new();
     if (!ret-&gt;cofactor)
         goto err;
-
-    ret-&gt;curve_name = 0;
     ret-&gt;asn1_flag = OPENSSL_EC_NAMED_CURVE;
     ret-&gt;asn1_form = POINT_CONVERSION_UNCOMPRESSED;
-
-    ret-&gt;seed = NULL;
-    ret-&gt;seed_len = 0;
-
     if (!meth-&gt;group_init(ret))
         goto err;
-
     return ret;
+
  err:
     BN_free(ret-&gt;order);
     BN_free(ret-&gt;cofactor);
diff --git a/crypto/ec/ec_mult.c b/crypto/ec/ec_mult.c
index 09f042e..a3d9885 100644
--- a/crypto/ec/ec_mult.c
+++ b/crypto/ec/ec_mult.c
@@ -100,17 +100,14 @@ static EC_PRE_COMP *ec_pre_comp_new(const EC_GROUP *group)
     if (!group)
         return NULL;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (!ret) {
         ECerr(EC_F_EC_PRE_COMP_NEW, ERR_R_MALLOC_FAILURE);
         return ret;
     }
     ret-&gt;group = group;
     ret-&gt;blocksize = 8;         /* default */
-    ret-&gt;numblocks = 0;
     ret-&gt;w = 4;                 /* default */
-    ret-&gt;points = NULL;
-    ret-&gt;num = 0;
     ret-&gt;references = 1;
     return ret;
 }
diff --git a/crypto/ec/ec_pmeth.c b/crypto/ec/ec_pmeth.c
index 5ca8ed9..aa1fa9f 100644
--- a/crypto/ec/ec_pmeth.c
+++ b/crypto/ec/ec_pmeth.c
@@ -92,22 +92,13 @@ static int pkey_ec_init(EVP_PKEY_CTX *ctx)
 {
     EC_PKEY_CTX *dctx;
 
-    dctx = OPENSSL_malloc(sizeof(*dctx));
+    dctx = OPENSSL_zalloc(sizeof(*dctx));
     if (!dctx)
         return 0;
-    dctx-&gt;gen_group = NULL;
-    dctx-&gt;md = NULL;
 
     dctx-&gt;cofactor_mode = -1;
-    dctx-&gt;co_key = NULL;
     dctx-&gt;kdf_type = EVP_PKEY_ECDH_KDF_NONE;
-    dctx-&gt;kdf_md = NULL;
-    dctx-&gt;kdf_outlen = 0;
-    dctx-&gt;kdf_ukm = NULL;
-    dctx-&gt;kdf_ukmlen = 0;
-
     ctx-&gt;data = dctx;
-
     return 1;
 }
 
diff --git a/crypto/ecdsa/ecs_lib.c b/crypto/ecdsa/ecs_lib.c
index 0db3534..f3007e5 100644
--- a/crypto/ecdsa/ecs_lib.c
+++ b/crypto/ecdsa/ecs_lib.c
@@ -251,7 +251,7 @@ ECDSA_METHOD *ECDSA_METHOD_new(ECDSA_METHOD *ecdsa_meth)
 {
     ECDSA_METHOD *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         ECDSAerr(ECDSA_F_ECDSA_METHOD_NEW, ERR_R_MALLOC_FAILURE);
         return NULL;
@@ -259,13 +259,6 @@ ECDSA_METHOD *ECDSA_METHOD_new(ECDSA_METHOD *ecdsa_meth)
 
     if (ecdsa_meth)
         *ret = *ecdsa_meth;
-    else {
-        ret-&gt;ecdsa_sign_setup = 0;
-        ret-&gt;ecdsa_do_sign = 0;
-        ret-&gt;ecdsa_do_verify = 0;
-        ret-&gt;name = NULL;
-        ret-&gt;flags = 0;
-    }
     ret-&gt;flags |= ECDSA_METHOD_FLAG_ALLOCATED;
     return ret;
 }
diff --git a/crypto/engine/eng_dyn.c b/crypto/engine/eng_dyn.c
index 777f440..100b050 100644
--- a/crypto/engine/eng_dyn.c
+++ b/crypto/engine/eng_dyn.c
@@ -208,22 +208,15 @@ static int dynamic_set_data_ctx(ENGINE *e, dynamic_data_ctx **ctx)
         ENGINEerr(ENGINE_F_DYNAMIC_SET_DATA_CTX, ERR_R_MALLOC_FAILURE);
         return 0;
     }
-    c-&gt;dynamic_dso = NULL;
-    c-&gt;v_check = NULL;
-    c-&gt;bind_engine = NULL;
-    c-&gt;DYNAMIC_LIBNAME = NULL;
-    c-&gt;no_vcheck = 0;
-    c-&gt;engine_id = NULL;
-    c-&gt;list_add_value = 0;
-    c-&gt;DYNAMIC_F1 = &quot;v_check&quot;;
-    c-&gt;DYNAMIC_F2 = &quot;bind_engine&quot;;
-    c-&gt;dir_load = 1;
     c-&gt;dirs = sk_OPENSSL_STRING_new_null();
     if (!c-&gt;dirs) {
         ENGINEerr(ENGINE_F_DYNAMIC_SET_DATA_CTX, ERR_R_MALLOC_FAILURE);
         OPENSSL_free(c);
         return 0;
     }
+    c-&gt;DYNAMIC_F1 = &quot;v_check&quot;;
+    c-&gt;DYNAMIC_F2 = &quot;bind_engine&quot;;
+    c-&gt;dir_load = 1;
     CRYPTO_w_lock(CRYPTO_LOCK_ENGINE);
     if ((*ctx = (dynamic_data_ctx *)ENGINE_get_ex_data(e,
                                                        dynamic_ex_data_idx))
diff --git a/crypto/engine/eng_openssl.c b/crypto/engine/eng_openssl.c
index eaf0618..4bc9b2e 100644
--- a/crypto/engine/eng_openssl.c
+++ b/crypto/engine/eng_openssl.c
@@ -425,13 +425,10 @@ typedef struct {
 static int ossl_hmac_init(EVP_PKEY_CTX *ctx)
 {
     OSSL_HMAC_PKEY_CTX *hctx;
-    hctx = OPENSSL_malloc(sizeof(*hctx));
+
+    hctx = OPENSSL_zalloc(sizeof(*hctx));
     if (!hctx)
         return 0;
-    hctx-&gt;md = NULL;
-    hctx-&gt;ktmp.data = NULL;
-    hctx-&gt;ktmp.length = 0;
-    hctx-&gt;ktmp.flags = 0;
     hctx-&gt;ktmp.type = V_ASN1_OCTET_STRING;
     HMAC_CTX_init(&amp;hctx-&gt;ctx);
     EVP_PKEY_CTX_set_data(ctx, hctx);
diff --git a/crypto/evp/bio_b64.c b/crypto/evp/bio_b64.c
index dcb9695..00febc7 100644
--- a/crypto/evp/bio_b64.c
+++ b/crypto/evp/bio_b64.c
@@ -115,18 +115,12 @@ static int b64_new(BIO *bi)
 {
     BIO_B64_CTX *ctx;
 
-    ctx = OPENSSL_malloc(sizeof(*ctx));
+    ctx = OPENSSL_zalloc(sizeof(*ctx));
     if (ctx == NULL)
         return (0);
 
-    ctx-&gt;buf_len = 0;
-    ctx-&gt;tmp_len = 0;
-    ctx-&gt;tmp_nl = 0;
-    ctx-&gt;buf_off = 0;
     ctx-&gt;cont = 1;
     ctx-&gt;start = 1;
-    ctx-&gt;encode = 0;
-
     bi-&gt;init = 1;
     bi-&gt;ptr = (char *)ctx;
     bi-&gt;flags = 0;
diff --git a/crypto/evp/bio_enc.c b/crypto/evp/bio_enc.c
index bf74a0a..2e6ce33 100644
--- a/crypto/evp/bio_enc.c
+++ b/crypto/evp/bio_enc.c
@@ -112,17 +112,13 @@ static int enc_new(BIO *bi)
 {
     BIO_ENC_CTX *ctx;
 
-    ctx = OPENSSL_malloc(sizeof(*ctx));
+    ctx = OPENSSL_zalloc(sizeof(*ctx));
     if (ctx == NULL)
         return (0);
-    EVP_CIPHER_CTX_init(&amp;ctx-&gt;cipher);
 
-    ctx-&gt;buf_len = 0;
-    ctx-&gt;buf_off = 0;
+    EVP_CIPHER_CTX_init(&amp;ctx-&gt;cipher);
     ctx-&gt;cont = 1;
-    ctx-&gt;finished = 0;
     ctx-&gt;ok = 1;
-
     bi-&gt;init = 0;
     bi-&gt;ptr = (char *)ctx;
     bi-&gt;flags = 0;
diff --git a/crypto/evp/bio_ok.c b/crypto/evp/bio_ok.c
index 9fdf6bc..8658f88 100644
--- a/crypto/evp/bio_ok.c
+++ b/crypto/evp/bio_ok.c
@@ -176,21 +176,13 @@ static int ok_new(BIO *bi)
 {
     BIO_OK_CTX *ctx;
 
-    ctx = OPENSSL_malloc(sizeof(*ctx));
+    ctx = OPENSSL_zalloc(sizeof(*ctx));
     if (ctx == NULL)
         return (0);
 
-    ctx-&gt;buf_len = 0;
-    ctx-&gt;buf_off = 0;
-    ctx-&gt;buf_len_save = 0;
-    ctx-&gt;buf_off_save = 0;
     ctx-&gt;cont = 1;
-    ctx-&gt;finished = 0;
-    ctx-&gt;blockout = 0;
     ctx-&gt;sigio = 1;
-
     EVP_MD_CTX_init(&amp;ctx-&gt;md);
-
     bi-&gt;init = 0;
     bi-&gt;ptr = (char *)ctx;
     bi-&gt;flags = 0;
diff --git a/crypto/evp/pmeth_lib.c b/crypto/evp/pmeth_lib.c
index f317471..a2d8382 100644
--- a/crypto/evp/pmeth_lib.c
+++ b/crypto/evp/pmeth_lib.c
@@ -165,7 +165,7 @@ static EVP_PKEY_CTX *int_ctx_new(EVP_PKEY *pkey, ENGINE *e, int id)
         return NULL;
     }
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (!ret) {
 #ifndef OPENSSL_NO_ENGINE
         if (e)
@@ -178,8 +178,6 @@ static EVP_PKEY_CTX *int_ctx_new(EVP_PKEY *pkey, ENGINE *e, int id)
     ret-&gt;pmeth = pmeth;
     ret-&gt;operation = EVP_PKEY_OP_UNDEFINED;
     ret-&gt;pkey = pkey;
-    ret-&gt;peerkey = NULL;
-    ret-&gt;pkey_gencb = 0;
     if (pkey)
         CRYPTO_add(&amp;pkey-&gt;references, 1, CRYPTO_LOCK_EVP_PKEY);
     ret-&gt;data = NULL;
@@ -204,32 +202,6 @@ EVP_PKEY_METHOD *EVP_PKEY_meth_new(int id, int flags)
 
     pmeth-&gt;pkey_id = id;
     pmeth-&gt;flags = flags | EVP_PKEY_FLAG_DYNAMIC;
-    pmeth-&gt;init = 0;
-    pmeth-&gt;copy = 0;
-    pmeth-&gt;cleanup = 0;
-    pmeth-&gt;paramgen_init = 0;
-    pmeth-&gt;paramgen = 0;
-    pmeth-&gt;keygen_init = 0;
-    pmeth-&gt;keygen = 0;
-    pmeth-&gt;sign_init = 0;
-    pmeth-&gt;sign = 0;
-    pmeth-&gt;verify_init = 0;
-    pmeth-&gt;verify = 0;
-    pmeth-&gt;verify_recover_init = 0;
-    pmeth-&gt;verify_recover = 0;
-    pmeth-&gt;signctx_init = 0;
-    pmeth-&gt;signctx = 0;
-    pmeth-&gt;verifyctx_init = 0;
-    pmeth-&gt;verifyctx = 0;
-    pmeth-&gt;encrypt_init = 0;
-    pmeth-&gt;encrypt = 0;
-    pmeth-&gt;decrypt_init = 0;
-    pmeth-&gt;decrypt = 0;
-    pmeth-&gt;derive_init = 0;
-    pmeth-&gt;derive = 0;
-    pmeth-&gt;ctrl = 0;
-    pmeth-&gt;ctrl_str = 0;
-
     return pmeth;
 }
 
diff --git a/crypto/hmac/hm_pmeth.c b/crypto/hmac/hm_pmeth.c
index fcccb58..ff9dbe3 100644
--- a/crypto/hmac/hm_pmeth.c
+++ b/crypto/hmac/hm_pmeth.c
@@ -75,13 +75,10 @@ typedef struct {
 static int pkey_hmac_init(EVP_PKEY_CTX *ctx)
 {
     HMAC_PKEY_CTX *hctx;
-    hctx = OPENSSL_malloc(sizeof(*hctx));
+
+    hctx = OPENSSL_zalloc(sizeof(*hctx));
     if (!hctx)
         return 0;
-    hctx-&gt;md = NULL;
-    hctx-&gt;ktmp.data = NULL;
-    hctx-&gt;ktmp.length = 0;
-    hctx-&gt;ktmp.flags = 0;
     hctx-&gt;ktmp.type = V_ASN1_OCTET_STRING;
     HMAC_CTX_init(&amp;hctx-&gt;ctx);
 
diff --git a/crypto/lhash/lhash.c b/crypto/lhash/lhash.c
index 0c9ce8f..4018b60 100644
--- a/crypto/lhash/lhash.c
+++ b/crypto/lhash/lhash.c
@@ -113,40 +113,20 @@ static LHASH_NODE **getrn(_LHASH *lh, const void *data, unsigned long *rhash);
 _LHASH *lh_new(LHASH_HASH_FN_TYPE h, LHASH_COMP_FN_TYPE c)
 {
     _LHASH *ret;
-    int i;
 
-    if ((ret = OPENSSL_malloc(sizeof(*ret))) == NULL)
+    if ((ret = OPENSSL_zalloc(sizeof(*ret))) == NULL)
         goto err0;
-    if ((ret-&gt;b = OPENSSL_malloc(sizeof(*ret-&gt;b) * MIN_NODES)) == NULL)
+    if ((ret-&gt;b = OPENSSL_zalloc(sizeof(*ret-&gt;b) * MIN_NODES)) == NULL)
         goto err1;
-    for (i = 0; i &lt; MIN_NODES; i++)
-        ret-&gt;b[i] = NULL;
     ret-&gt;comp = ((c == NULL) ? (LHASH_COMP_FN_TYPE)strcmp : c);
     ret-&gt;hash = ((h == NULL) ? (LHASH_HASH_FN_TYPE)lh_strhash : h);
     ret-&gt;num_nodes = MIN_NODES / 2;
     ret-&gt;num_alloc_nodes = MIN_NODES;
-    ret-&gt;p = 0;
     ret-&gt;pmax = MIN_NODES / 2;
     ret-&gt;up_load = UP_LOAD;
     ret-&gt;down_load = DOWN_LOAD;
-    ret-&gt;num_items = 0;
-
-    ret-&gt;num_expands = 0;
-    ret-&gt;num_expand_reallocs = 0;
-    ret-&gt;num_contracts = 0;
-    ret-&gt;num_contract_reallocs = 0;
-    ret-&gt;num_hash_calls = 0;
-    ret-&gt;num_comp_calls = 0;
-    ret-&gt;num_insert = 0;
-    ret-&gt;num_replace = 0;
-    ret-&gt;num_delete = 0;
-    ret-&gt;num_no_delete = 0;
-    ret-&gt;num_retrieve = 0;
-    ret-&gt;num_retrieve_miss = 0;
-    ret-&gt;num_hash_comps = 0;
-
-    ret-&gt;error = 0;
     return (ret);
+
  err1:
     OPENSSL_free(ret);
  err0:
diff --git a/crypto/objects/o_names.c b/crypto/objects/o_names.c
index d861b6d..7a24ad0 100644
--- a/crypto/objects/o_names.c
+++ b/crypto/objects/o_names.c
@@ -83,7 +83,7 @@ int OBJ_NAME_new_index(unsigned long (*hash_func) (const char *),
     names_type_num++;
     for (i = sk_NAME_FUNCS_num(name_funcs_stack); i &lt; names_type_num; i++) {
         MemCheck_off();
-        name_funcs = OPENSSL_malloc(sizeof(*name_funcs));
+        name_funcs = OPENSSL_zalloc(sizeof(*name_funcs));
         MemCheck_on();
         if (!name_funcs) {
             OBJerr(OBJ_F_OBJ_NAME_NEW_INDEX, ERR_R_MALLOC_FAILURE);
@@ -91,10 +91,6 @@ int OBJ_NAME_new_index(unsigned long (*hash_func) (const char *),
         }
         name_funcs-&gt;hash_func = lh_strhash;
         name_funcs-&gt;cmp_func = OPENSSL_strcmp;
-        name_funcs-&gt;free_func = 0; /* NULL is often declared to * ((void
-                                    * *)0), which according * to Compaq C is
-                                    * not really * compatible with a function
-                                    * * pointer.  -- Richard Levitte */
         MemCheck_off();
         sk_NAME_FUNCS_push(name_funcs_stack, name_funcs);
         MemCheck_on();
diff --git a/crypto/ocsp/ocsp_ht.c b/crypto/ocsp/ocsp_ht.c
index 582ef9c..2c92ee7 100644
--- a/crypto/ocsp/ocsp_ht.c
+++ b/crypto/ocsp/ocsp_ht.c
@@ -113,7 +113,7 @@ static int parse_http_line1(char *line);
 
 OCSP_REQ_CTX *OCSP_REQ_CTX_new(BIO *io, int maxline)
 {
-    OCSP_REQ_CTX *rctx = OPENSSL_malloc(sizeof(*rctx));
+    OCSP_REQ_CTX *rctx = OPENSSL_zalloc(sizeof(*rctx));
 
     if (!rctx)
         return NULL;
@@ -121,7 +121,6 @@ OCSP_REQ_CTX *OCSP_REQ_CTX_new(BIO *io, int maxline)
     rctx-&gt;max_resp_len = OCSP_MAX_RESP_LENGTH;
     rctx-&gt;mem = BIO_new(BIO_s_mem());
     rctx-&gt;io = io;
-    rctx-&gt;asn1_len = 0;
     if (maxline &gt; 0)
         rctx-&gt;iobuflen = maxline;
     else
diff --git a/crypto/rsa/rsa_lib.c b/crypto/rsa/rsa_lib.c
index f62fd73..c64dad4 100644
--- a/crypto/rsa/rsa_lib.c
+++ b/crypto/rsa/rsa_lib.c
@@ -125,7 +125,7 @@ RSA *RSA_new_method(ENGINE *engine)
 {
     RSA *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL) {
         RSAerr(RSA_F_RSA_NEW_METHOD, ERR_R_MALLOC_FAILURE);
         return NULL;
@@ -153,23 +153,7 @@ RSA *RSA_new_method(ENGINE *engine)
     }
 #endif
 
-    ret-&gt;pad = 0;
-    ret-&gt;version = 0;
-    ret-&gt;n = NULL;
-    ret-&gt;e = NULL;
-    ret-&gt;d = NULL;
-    ret-&gt;p = NULL;
-    ret-&gt;q = NULL;
-    ret-&gt;dmp1 = NULL;
-    ret-&gt;dmq1 = NULL;
-    ret-&gt;iqmp = NULL;
     ret-&gt;references = 1;
-    ret-&gt;_method_mod_n = NULL;
-    ret-&gt;_method_mod_p = NULL;
-    ret-&gt;_method_mod_q = NULL;
-    ret-&gt;blinding = NULL;
-    ret-&gt;mt_blinding = NULL;
-    ret-&gt;bignum_data = NULL;
     ret-&gt;flags = ret-&gt;meth-&gt;flags &amp; ~RSA_FLAG_NON_FIPS_ALLOW;
     if (!CRYPTO_new_ex_data(CRYPTO_EX_INDEX_RSA, ret, &amp;ret-&gt;ex_data)) {
 #ifndef OPENSSL_NO_ENGINE
diff --git a/crypto/rsa/rsa_pmeth.c b/crypto/rsa/rsa_pmeth.c
index ac83de3..dd7b7dd 100644
--- a/crypto/rsa/rsa_pmeth.c
+++ b/crypto/rsa/rsa_pmeth.c
@@ -97,21 +97,12 @@ typedef struct {
 static int pkey_rsa_init(EVP_PKEY_CTX *ctx)
 {
     RSA_PKEY_CTX *rctx;
-    rctx = OPENSSL_malloc(sizeof(*rctx));
+    rctx = OPENSSL_zalloc(sizeof(*rctx));
     if (!rctx)
         return 0;
     rctx-&gt;nbits = 1024;
-    rctx-&gt;pub_exp = NULL;
     rctx-&gt;pad_mode = RSA_PKCS1_PADDING;
-    rctx-&gt;md = NULL;
-    rctx-&gt;mgf1md = NULL;
-    rctx-&gt;tbuf = NULL;
-
     rctx-&gt;saltlen = -2;
-
-    rctx-&gt;oaep_label = NULL;
-    rctx-&gt;oaep_labellen = 0;
-
     ctx-&gt;data = rctx;
     ctx-&gt;keygen_info = rctx-&gt;gentmp;
     ctx-&gt;keygen_info_count = 2;
diff --git a/crypto/stack/stack.c b/crypto/stack/stack.c
index c7643db..e9d80a7 100644
--- a/crypto/stack/stack.c
+++ b/crypto/stack/stack.c
@@ -150,19 +150,15 @@ _STACK *sk_new_null(void)
 _STACK *sk_new(int (*c) (const void *, const void *))
 {
     _STACK *ret;
-    int i;
 
-    if ((ret = OPENSSL_malloc(sizeof(_STACK))) == NULL)
+    if ((ret = OPENSSL_zalloc(sizeof(_STACK))) == NULL)
         goto err;
     if ((ret-&gt;data = OPENSSL_malloc(sizeof(*ret-&gt;data) * MIN_NODES)) == NULL)
         goto err;
-    for (i = 0; i &lt; MIN_NODES; i++)
-        ret-&gt;data[i] = NULL;
     ret-&gt;comp = c;
     ret-&gt;num_alloc = MIN_NODES;
-    ret-&gt;num = 0;
-    ret-&gt;sorted = 0;
     return (ret);
+
  err:
     OPENSSL_free(ret);
     return (NULL);
diff --git a/crypto/ui/ui_lib.c b/crypto/ui/ui_lib.c
index 654d74f..6837bd6 100644
--- a/crypto/ui/ui_lib.c
+++ b/crypto/ui/ui_lib.c
@@ -74,7 +74,7 @@ UI *UI_new(void)
 
 UI *UI_new_method(const UI_METHOD *method)
 {
-    UI *ret = OPENSSL_malloc(sizeof(*ret));
+    UI *ret = OPENSSL_zalloc(sizeof(*ret));
 
     if (ret == NULL) {
         UIerr(UI_F_UI_NEW_METHOD, ERR_R_MALLOC_FAILURE);
@@ -85,9 +85,6 @@ UI *UI_new_method(const UI_METHOD *method)
     else
         ret-&gt;meth = method;
 
-    ret-&gt;strings = NULL;
-    ret-&gt;user_data = NULL;
-    ret-&gt;flags = 0;
     CRYPTO_new_ex_data(CRYPTO_EX_INDEX_UI, ret, &amp;ret-&gt;ex_data);
     return ret;
 }
diff --git a/crypto/x509/x509_lu.c b/crypto/x509/x509_lu.c
index 2bd8de6..c53f1e5 100644
--- a/crypto/x509/x509_lu.c
+++ b/crypto/x509/x509_lu.c
@@ -68,15 +68,11 @@ X509_LOOKUP *X509_LOOKUP_new(X509_LOOKUP_METHOD *method)
 {
     X509_LOOKUP *ret;
 
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (ret == NULL)
         return NULL;
 
-    ret-&gt;init = 0;
-    ret-&gt;skip = 0;
     ret-&gt;method = method;
-    ret-&gt;method_data = NULL;
-    ret-&gt;store_ctx = NULL;
     if ((method-&gt;new_item != NULL) &amp;&amp; !method-&gt;new_item(ret)) {
         OPENSSL_free(ret);
         return NULL;
@@ -185,27 +181,15 @@ X509_STORE *X509_STORE_new(void)
 {
     X509_STORE *ret;
 
-    if ((ret = OPENSSL_malloc(sizeof(*ret))) == NULL)
+    if ((ret = OPENSSL_zalloc(sizeof(*ret))) == NULL)
         return NULL;
     ret-&gt;objs = sk_X509_OBJECT_new(x509_object_cmp);
     ret-&gt;cache = 1;
     ret-&gt;get_cert_methods = sk_X509_LOOKUP_new_null();
-    ret-&gt;verify = 0;
-    ret-&gt;verify_cb = 0;
 
     if ((ret-&gt;param = X509_VERIFY_PARAM_new()) == NULL)
         return NULL;
 
-    ret-&gt;get_issuer = 0;
-    ret-&gt;check_issued = 0;
-    ret-&gt;check_revocation = 0;
-    ret-&gt;get_crl = 0;
-    ret-&gt;check_crl = 0;
-    ret-&gt;cert_crl = 0;
-    ret-&gt;lookup_certs = 0;
-    ret-&gt;lookup_crls = 0;
-    ret-&gt;cleanup = 0;
-
     if (!CRYPTO_new_ex_data(CRYPTO_EX_INDEX_X509_STORE, ret, &amp;ret-&gt;ex_data)) {
         sk_X509_OBJECT_free(ret-&gt;objs);
         OPENSSL_free(ret);
diff --git a/crypto/x509/x_name.c b/crypto/x509/x_name.c
index f8fd337..9bf1523 100644
--- a/crypto/x509/x_name.c
+++ b/crypto/x509/x_name.c
@@ -133,7 +133,7 @@ IMPLEMENT_ASN1_DUP_FUNCTION(X509_NAME)
 
 static int x509_name_ex_new(ASN1_VALUE **val, const ASN1_ITEM *it)
 {
-    X509_NAME *ret = OPENSSL_malloc(sizeof(*ret));
+    X509_NAME *ret = OPENSSL_zalloc(sizeof(*ret));
 
     if (!ret)
         goto memerr;
@@ -141,8 +141,6 @@ static int x509_name_ex_new(ASN1_VALUE **val, const ASN1_ITEM *it)
         goto memerr;
     if ((ret-&gt;bytes = BUF_MEM_new()) == NULL)
         goto memerr;
-    ret-&gt;canon_enc = NULL;
-    ret-&gt;canon_enclen = 0;
     ret-&gt;modified = 1;
     *val = (ASN1_VALUE *)ret;
     return 1;
diff --git a/crypto/x509v3/Makefile b/crypto/x509v3/Makefile
index 516e7ad..5c47467 100644
--- a/crypto/x509v3/Makefile
+++ b/crypto/x509v3/Makefile
@@ -505,20 +505,21 @@ v3_prn.o: ../../include/openssl/stack.h ../../include/openssl/symhacks.h
 v3_prn.o: ../../include/openssl/x509.h ../../include/openssl/x509_vfy.h
 v3_prn.o: ../../include/openssl/x509v3.h ../include/internal/cryptlib.h
 v3_prn.o: v3_prn.c
-v3_purp.o: ../../e_os.h ../../include/openssl/asn1.h
-v3_purp.o: ../../include/openssl/bio.h ../../include/openssl/buffer.h
-v3_purp.o: ../../include/openssl/conf.h ../../include/openssl/crypto.h
-v3_purp.o: ../../include/openssl/e_os2.h ../../include/openssl/ec.h
-v3_purp.o: ../../include/openssl/ecdh.h ../../include/openssl/ecdsa.h
-v3_purp.o: ../../include/openssl/err.h ../../include/openssl/evp.h
-v3_purp.o: ../../include/openssl/lhash.h ../../include/openssl/obj_mac.h
-v3_purp.o: ../../include/openssl/objects.h ../../include/openssl/opensslconf.h
-v3_purp.o: ../../include/openssl/opensslv.h ../../include/openssl/ossl_typ.h
-v3_purp.o: ../../include/openssl/pkcs7.h ../../include/openssl/safestack.h
-v3_purp.o: ../../include/openssl/sha.h ../../include/openssl/stack.h
-v3_purp.o: ../../include/openssl/symhacks.h ../../include/openssl/x509.h
-v3_purp.o: ../../include/openssl/x509_vfy.h ../../include/openssl/x509v3.h
-v3_purp.o: ../include/internal/cryptlib.h v3_purp.c
+v3_purp.o: ../../e_os.h ../../include/internal/numbers.h
+v3_purp.o: ../../include/openssl/asn1.h ../../include/openssl/bio.h
+v3_purp.o: ../../include/openssl/buffer.h ../../include/openssl/conf.h
+v3_purp.o: ../../include/openssl/crypto.h ../../include/openssl/e_os2.h
+v3_purp.o: ../../include/openssl/ec.h ../../include/openssl/ecdh.h
+v3_purp.o: ../../include/openssl/ecdsa.h ../../include/openssl/err.h
+v3_purp.o: ../../include/openssl/evp.h ../../include/openssl/lhash.h
+v3_purp.o: ../../include/openssl/obj_mac.h ../../include/openssl/objects.h
+v3_purp.o: ../../include/openssl/opensslconf.h ../../include/openssl/opensslv.h
+v3_purp.o: ../../include/openssl/ossl_typ.h ../../include/openssl/pkcs7.h
+v3_purp.o: ../../include/openssl/safestack.h ../../include/openssl/sha.h
+v3_purp.o: ../../include/openssl/stack.h ../../include/openssl/symhacks.h
+v3_purp.o: ../../include/openssl/x509.h ../../include/openssl/x509_vfy.h
+v3_purp.o: ../../include/openssl/x509v3.h ../include/internal/cryptlib.h
+v3_purp.o: v3_purp.c
 v3_scts.o: ../../e_os.h ../../include/openssl/asn1.h
 v3_scts.o: ../../include/openssl/bio.h ../../include/openssl/buffer.h
 v3_scts.o: ../../include/openssl/conf.h ../../include/openssl/crypto.h
diff --git a/crypto/x509v3/pcy_data.c b/crypto/x509v3/pcy_data.c
index c29641f..bb2760a 100644
--- a/crypto/x509v3/pcy_data.c
+++ b/crypto/x509v3/pcy_data.c
@@ -98,7 +98,7 @@ X509_POLICY_DATA *policy_data_new(POLICYINFO *policy,
             return NULL;
     } else
         id = NULL;
-    ret = OPENSSL_malloc(sizeof(*ret));
+    ret = OPENSSL_zalloc(sizeof(*ret));
     if (!ret)
         return NULL;
     ret-&gt;expected_policy_set = sk_ASN1_OBJECT_new_null();
@@ -110,8 +110,6 @@ X509_POLICY_DATA *policy_data_new(POLICYINFO *policy,
 
     if (crit)
         ret-&gt;flags = POLICY_DATA_FLAG_CRITICAL;
-    else
-        ret-&gt;flags = 0;
 
     if (id)
         ret-&gt;valid_policy = id;
@@ -123,8 +121,7 @@ X509_POLICY_DATA *policy_data_new(POLICYINFO *policy,
     if (policy) {
         ret-&gt;qualifier_set = policy-&gt;qualifiers;
         policy-&gt;qualifiers = NULL;
-    } else
-        ret-&gt;qualifier_set = NULL;
+    }
 
     return ret;
 }
diff --git a/crypto/x509v3/pcy_node.c b/crypto/x509v3/pcy_node.c
index 855fe3e..64f979a 100644
--- a/crypto/x509v3/pcy_node.c
+++ b/crypto/x509v3/pcy_node.c
@@ -114,12 +114,12 @@ X509_POLICY_NODE *level_add_node(X509_POLICY_LEVEL *level,
                                  X509_POLICY_TREE *tree)
 {
     X509_POLICY_NODE *node;
-    node = OPENSSL_malloc(sizeof(*node));
+
+    node = OPENSSL_zalloc(sizeof(*node));
     if (!node)
         return NULL;
     node-&gt;data = data;
     node-&gt;parent = parent;
-    node-&gt;nchild = 0;
     if (level) {
         if (OBJ_obj2nid(data-&gt;valid_policy) == NID_any_policy) {
             if (level-&gt;anyPolicy)
diff --git a/crypto/x509v3/pcy_tree.c b/crypto/x509v3/pcy_tree.c
index 2a41903..c6be015 100644
--- a/crypto/x509v3/pcy_tree.c
+++ b/crypto/x509v3/pcy_tree.c
@@ -217,7 +217,7 @@ static int tree_init(X509_POLICY_TREE **ptree, STACK_OF(X509) *certs,
     }
 
     /* If we get this far initialize the tree */
-    tree = OPENSSL_malloc(sizeof(*tree));
+    tree = OPENSSL_zalloc(sizeof(*tree));
     if (!tree)
         return 0;
     tree-&gt;levels = OPENSSL_zalloc(sizeof(*tree-&gt;levels) * n);
@@ -225,10 +225,6 @@ static int tree_init(X509_POLICY_TREE **ptree, STACK_OF(X509) *certs,
         OPENSSL_free(tree);
         return 0;
     }
-    tree-&gt;flags = 0;
-    tree-&gt;extra_data = NULL;
-    tree-&gt;auth_policies = NULL;
-    tree-&gt;user_policies = NULL;
     tree-&gt;nlevel = n;
     level = tree-&gt;levels;
 
diff --git a/engines/e_capi.c b/engines/e_capi.c
index 450f89e..8b3cfee 100644
--- a/engines/e_capi.c
+++ b/engines/e_capi.c
@@ -1573,23 +1573,18 @@ void capi_free_key(CAPI_KEY * key)
 
 static CAPI_CTX *capi_ctx_new()
 {
-    CAPI_CTX *ctx = OPENSSL_malloc(sizeof(*ctx));
+    CAPI_CTX *ctx = OPENSSL_zalloc(sizeof(*ctx));
 
     if (!ctx) {
         CAPIerr(CAPI_F_CAPI_CTX_NEW, ERR_R_MALLOC_FAILURE);
         return NULL;
     }
-    ctx-&gt;cspname = NULL;
     ctx-&gt;csptype = PROV_RSA_FULL;
     ctx-&gt;dump_flags = CAPI_DMP_SUMMARY | CAPI_DMP_FNAME;
     ctx-&gt;keytype = AT_KEYEXCHANGE;
-    ctx-&gt;storename = NULL;
-    ctx-&gt;ssl_client_store = NULL;
     ctx-&gt;store_flags = CERT_STORE_OPEN_EXISTING_FLAG |
         CERT_STORE_READONLY_FLAG | CERT_SYSTEM_STORE_CURRENT_USER;
     ctx-&gt;lookup_method = CAPI_LU_SUBSTR;
-    ctx-&gt;debug_level = 0;
-    ctx-&gt;debug_file = NULL;
     ctx-&gt;client_cert_select = cert_select_simple;
     return ctx;
 }
diff --git a/ssl/ssl_conf.c b/ssl/ssl_conf.c
index 5c320cb..0a4625c 100644
--- a/ssl/ssl_conf.c
+++ b/ssl/ssl_conf.c
@@ -771,24 +771,8 @@ int SSL_CONF_cmd_value_type(SSL_CONF_CTX *cctx, const char *cmd)
 
 SSL_CONF_CTX *SSL_CONF_CTX_new(void)
 {
-    SSL_CONF_CTX *ret = OPENSSL_malloc(sizeof(*ret));
-    size_t i;
+    SSL_CONF_CTX *ret = OPENSSL_zalloc(sizeof(*ret));
 
-    if (ret) {
-        ret-&gt;flags = 0;
-        ret-&gt;prefix = NULL;
-        ret-&gt;prefixlen = 0;
-        ret-&gt;ssl = NULL;
-        ret-&gt;ctx = NULL;
-        ret-&gt;poptions = NULL;
-        ret-&gt;pcert_flags = NULL;
-        ret-&gt;pvfy_flags = NULL;
-        ret-&gt;tbl = NULL;
-        ret-&gt;ntbl = 0;
-        for (i = 0; i &lt; SSL_PKEY_NUM; i++)
-            ret-&gt;cert_filename[i] = NULL;
-        ret-&gt;canames = NULL;
-    }
     return ret;
 }
 
diff --git a/ssl/ssl_lib.c b/ssl/ssl_lib.c
index b1d4771..fe07d2c 100644
--- a/ssl/ssl_lib.c
+++ b/ssl/ssl_lib.c
@@ -1688,41 +1688,16 @@ SSL_CTX *SSL_CTX_new(const SSL_METHOD *meth)
         goto err;
 
     ret-&gt;method = meth;
-    ret-&gt;cert_store = NULL;
     ret-&gt;session_cache_mode = SSL_SESS_CACHE_SERVER;
     ret-&gt;session_cache_size = SSL_SESSION_CACHE_MAX_SIZE_DEFAULT;
-    ret-&gt;session_cache_head = NULL;
-    ret-&gt;session_cache_tail = NULL;
-
-    /* We take the system default */
+    /* We take the system default. */
     ret-&gt;session_timeout = meth-&gt;get_timeout();
-
-    ret-&gt;new_session_cb = 0;
-    ret-&gt;remove_session_cb = 0;
-    ret-&gt;get_session_cb = 0;
-    ret-&gt;generate_session_id = 0;
-
     ret-&gt;references = 1;
-    ret-&gt;quiet_shutdown = 0;
-    ret-&gt;info_callback = NULL;
-    ret-&gt;app_verify_callback = 0;
-    ret-&gt;app_verify_arg = NULL;
     ret-&gt;max_cert_list = SSL_MAX_CERT_LIST_DEFAULT;
-    ret-&gt;read_ahead = 0;
-    ret-&gt;msg_callback = 0;
-    ret-&gt;msg_callback_arg = NULL;
     ret-&gt;verify_mode = SSL_VERIFY_NONE;
-    ret-&gt;sid_ctx_length = 0;
-    ret-&gt;default_verify_callback = NULL;
     if ((ret-&gt;cert = ssl_cert_new()) == NULL)
         goto err;
 
-    ret-&gt;default_passwd_callback = 0;
-    ret-&gt;default_passwd_callback_userdata = NULL;
-    ret-&gt;client_cert_cb = 0;
-    ret-&gt;app_gen_cookie_cb = 0;
-    ret-&gt;app_verify_cookie_cb = 0;
-
     ret-&gt;sessions = lh_SSL_SESSION_new();
     if (ret-&gt;sessions == NULL)
         goto err;
@@ -1756,39 +1731,23 @@ SSL_CTX *SSL_CTX_new(const SSL_METHOD *meth)
 
     CRYPTO_new_ex_data(CRYPTO_EX_INDEX_SSL_CTX, ret, &amp;ret-&gt;ex_data);
 
-    ret-&gt;extra_certs = NULL;
     /* No compression for DTLS */
     if (!(meth-&gt;ssl3_enc-&gt;enc_flags &amp; SSL_ENC_FLAG_DTLS))
         ret-&gt;comp_methods = SSL_COMP_get_compression_methods();
 
     ret-&gt;max_send_fragment = SSL3_RT_MAX_PLAIN_LENGTH;
 
-    ret-&gt;tlsext_servername_callback = 0;
-    ret-&gt;tlsext_servername_arg = NULL;
     /* Setup RFC4507 ticket keys */
     if ((RAND_bytes(ret-&gt;tlsext_tick_key_name, 16) &lt;= 0)
         || (RAND_bytes(ret-&gt;tlsext_tick_hmac_key, 16) &lt;= 0)
         || (RAND_bytes(ret-&gt;tlsext_tick_aes_key, 16) &lt;= 0))
         ret-&gt;options |= SSL_OP_NO_TICKET;
 
-    ret-&gt;tlsext_status_cb = 0;
-    ret-&gt;tlsext_status_arg = NULL;
-
-#ifndef OPENSSL_NO_NEXTPROTONEG
-    ret-&gt;next_protos_advertised_cb = 0;
-    ret-&gt;next_proto_select_cb = 0;
-#endif
-#ifndef OPENSSL_NO_PSK
-    ret-&gt;psk_identity_hint = NULL;
-    ret-&gt;psk_client_callback = NULL;
-    ret-&gt;psk_server_callback = NULL;
-#endif
 #ifndef OPENSSL_NO_SRP
     if (!SSL_CTX_SRP_CTX_init(ret))
         goto err;
 #endif
 #ifndef OPENSSL_NO_ENGINE
-    ret-&gt;client_cert_engine = NULL;
 # ifdef OPENSSL_SSL_CLIENT_ENGINE_AUTO
 #  define eng_strx(x)     #x
 #  define eng_str(x)      eng_strx(x)
diff --git a/ssl/ssl_sess.c b/ssl/ssl_sess.c
index 3e980bf..3774db4 100644
--- a/ssl/ssl_sess.c
+++ b/ssl/ssl_sess.c
@@ -196,31 +196,14 @@ SSL_SESSION *SSL_SESSION_new(void)
     ss = OPENSSL_zalloc(sizeof(*ss));
     if (ss == NULL) {
         SSLerr(SSL_F_SSL_SESSION_NEW, ERR_R_MALLOC_FAILURE);
-        return (0);
+        return (NULL);
     }
 
     ss-&gt;verify_result = 1;      /* avoid 0 (= X509_V_OK) just in case */
     ss-&gt;references = 1;
     ss-&gt;timeout = 60 * 5 + 4;   /* 5 minute timeout by default */
     ss-&gt;time = (unsigned long)time(NULL);
-    ss-&gt;prev = NULL;
-    ss-&gt;next = NULL;
-    ss-&gt;compress_meth = 0;
-    ss-&gt;tlsext_hostname = NULL;
-#ifndef OPENSSL_NO_EC
-    ss-&gt;tlsext_ecpointformatlist_length = 0;
-    ss-&gt;tlsext_ecpointformatlist = NULL;
-    ss-&gt;tlsext_ellipticcurvelist_length = 0;
-    ss-&gt;tlsext_ellipticcurvelist = NULL;
-#endif
     CRYPTO_new_ex_data(CRYPTO_EX_INDEX_SSL_SESSION, ss, &amp;ss-&gt;ex_data);
-#ifndef OPENSSL_NO_PSK
-    ss-&gt;psk_identity_hint = NULL;
-    ss-&gt;psk_identity = NULL;
-#endif
-#ifndef OPENSSL_NO_SRP
-    ss-&gt;srp_username = NULL;
-#endif
     return (ss);
 }
 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001741.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="001743.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1742">[ date ]</a>
              <a href="thread.html#1742">[ thread ]</a>
              <a href="subject.html#1742">[ subject ]</a>
              <a href="author.html#1742">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
