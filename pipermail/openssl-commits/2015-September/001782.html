<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1441768726.113335.5844.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001781.html">
   <LINK REL="Next"  HREF="001783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1441768726.113335.5844.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Wed Sep  9 03:18:46 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001781.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="001783.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1782">[ date ]</a>
              <a href="thread.html#1782">[ thread ]</a>
              <a href="subject.html#1782">[ subject ]</a>
              <a href="author.html#1782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  4d60c7e10f1d7ebe34842f96e13b64db7fc2dc1b (commit)
      from  ff2f6bb0845ef859954f7c36b2b302c60088c4c7 (commit)


- Log -----------------------------------------------------------------
commit 4d60c7e10f1d7ebe34842f96e13b64db7fc2dc1b
Author: David Woodhouse &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.Woodhouse at intel.com</A>&gt;
Date:   Tue Sep 8 22:51:17 2015 -0400

    RT3969: Add OPENSSL_SYS_UEFI
    
    This provides support for building in the EDK II reference implementation
    of UEFI. Most UEFI firmware in existence uses OpenSSL for implementing
    the core cryptographic functionality needed for Secure Boot.
    
    This has always previously been handled with external patches to OpenSSL
    but we are now making a concerted effort to eliminate those.
    
    In this mode, we don't actually use the OpenSSL makefiles; we process
    the MINFO file generated by 'make files' and incorporate it into the
    EDK2 build system.
    
    Since EDK II builds for various targets with varying word size and we
    need to have a single prepackaged configuration, we deliberately don't
    hard-code the setting of SIXTY_FOUR_BIT vs. THIRTY_TWO_BIT in
    opensslconf.h. We bypass that for OPENSSL_SYS_UEFI and allow EDK II
    itself to set those, depending on the architecture.
    
    For x86_64, EDK II sets SIXTY_FOUR_BIT and thus uses 'long long' for the
    64-bit type, even when building with GCC where 'long' is also 64-bit. We
    do this because the Microsoft toolchain has 32-bit 'long'.
    
    Signed-off-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at akamai.com</A>&gt;
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/10-main.conf |  7 +++++++
 crypto/opensslconf.h.in     |  2 +-
 crypto/rand/rand_egd.c      |  2 +-
 e_os.h                      |  2 +-
 include/openssl/e_os2.h     | 17 ++++++++++++++++-
 5 files changed, 26 insertions(+), 4 deletions(-)

diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 15af87e..3230d86 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -1207,6 +1207,13 @@
         shared_extension =&gt; &quot;.dll.a&quot;,
     },
 
+#### UEFI
+    &quot;UEFI&quot; =&gt; {
+        cc               =&gt; &quot;cc&quot;,
+        cflags           =&gt; &quot;-DL_ENDIAN -O&quot;,
+        sys_id           =&gt; &quot;UEFI&quot;,
+    },
+
 #### UWIN
     &quot;UWIN&quot; =&gt; {
         cc               =&gt; &quot;cc&quot;,
diff --git a/crypto/opensslconf.h.in b/crypto/opensslconf.h.in
index 4429c91..c37dbba 100644
--- a/crypto/opensslconf.h.in
+++ b/crypto/opensslconf.h.in
@@ -73,7 +73,7 @@
 #endif
 #endif
 
-#if defined(HEADER_BN_H) &amp;&amp; !defined(CONFIG_HEADER_BN_H)
+#if defined(HEADER_BN_H) &amp;&amp; !defined(CONFIG_HEADER_BN_H) &amp;&amp; !defined(OPENSSL_SYS_UEFI)
 #define CONFIG_HEADER_BN_H
 #undef BN_LLONG
 
diff --git a/crypto/rand/rand_egd.c b/crypto/rand/rand_egd.c
index 44ed4bb..d062dd6 100644
--- a/crypto/rand/rand_egd.c
+++ b/crypto/rand/rand_egd.c
@@ -95,7 +95,7 @@
  *   RAND_egd() is a wrapper for RAND_egd_bytes() with numbytes=255.
  */
 
-#if defined(OPENSSL_SYS_WIN32) || defined(OPENSSL_SYS_VMS) || defined(OPENSSL_SYS_MSDOS) || defined(OPENSSL_SYS_VXWORKS) || defined(OPENSSL_SYS_NETWARE) || defined(OPENSSL_SYS_VOS)
+#if defined(OPENSSL_SYS_WIN32) || defined(OPENSSL_SYS_VMS) || defined(OPENSSL_SYS_MSDOS) || defined(OPENSSL_SYS_VXWORKS) || defined(OPENSSL_SYS_NETWARE) || defined(OPENSSL_SYS_VOS) || defined(OPENSSL_SYS_UEFI)
 int RAND_query_egd_bytes(const char *path, unsigned char *buf, int bytes)
 {
     return (-1);
diff --git a/e_os.h b/e_os.h
index 4c1b4aa..b3a3338 100644
--- a/e_os.h
+++ b/e_os.h
@@ -112,7 +112,7 @@ extern &quot;C&quot; {
 #  define MSDOS
 # endif
 
-# if defined(MSDOS) &amp;&amp; !defined(GETPID_IS_MEANINGLESS)
+# if (defined(MSDOS) || defined(OPENSSL_SYS_UEFI)) &amp;&amp; !defined(GETPID_IS_MEANINGLESS)
 #  define GETPID_IS_MEANINGLESS
 # endif
 
diff --git a/include/openssl/e_os2.h b/include/openssl/e_os2.h
index 9f7dcf1..6ef1f39 100644
--- a/include/openssl/e_os2.h
+++ b/include/openssl/e_os2.h
@@ -90,7 +90,13 @@ extern &quot;C&quot; {
  * For 32 bit environment, there seems to be the CygWin environment and then
  * all the others that try to do the same thing Microsoft does...
  */
-# if defined(OPENSSL_SYS_UWIN)
+/*
+ * UEFI lives here because it might be built with a Microsoft toolchain and
+ * we need to avoid the false positive match on Windows.
+ */
+# if defined(OPENSSL_SYS_UEFI)
+#  undef OPENSSL_SYS_UNIX
+# elif defined(OPENSSL_SYS_UWIN)
 #  undef OPENSSL_SYS_UNIX
 #  define OPENSSL_SYS_WIN32_UWIN
 # else
@@ -277,6 +283,15 @@ extern &quot;C&quot; {
 /* Standard integer types */
 # if defined(__osf__) || defined(__sgi) || defined(__hpux) || defined(OPENSSL_SYS_VMS)
 #  include &lt;inttypes.h&gt;
+# elif defined(OPENSSL_SYS_UEFI)
+typedef INT8 int8_t;
+typedef UINT8 uint8_t;
+typedef INT16 int16_t;
+typedef UINT16 uint16_t;
+typedef INT32 int32_t;
+typedef UINT32 uint32_t;
+typedef INT64 int64_t;
+typedef UINT64 uint64_t;
 # elif defined(_MSC_VER) &amp;&amp; _MSC_VER&lt;=1500
 /*
  * minimally required typdefs for systems not supporting inttypes.h or
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001781.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="001783.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1782">[ date ]</a>
              <a href="thread.html#1782">[ thread ]</a>
              <a href="subject.html#1782">[ subject ]</a>
              <a href="author.html#1782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
