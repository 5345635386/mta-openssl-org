<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-May/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1464129963.709071.30839.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007530.html">
   <LINK REL="Next"  HREF="007533.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1464129963.709071.30839.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Tue May 24 22:46:03 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="007530.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="007533.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7531">[ date ]</a>
              <a href="thread.html#7531">[ thread ]</a>
              <a href="subject.html#7531">[ subject ]</a>
              <a href="author.html#7531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  b202bf675b54dddf268d168a9a7c5db9f62e05ae (commit)
       via  05a7aee0e2b9102c8b2ececdc1dfdb727c453c95 (commit)
      from  73b61c7e14115ae98c174bfdd7c7733d6cc7e909 (commit)


- Log -----------------------------------------------------------------
commit b202bf675b54dddf268d168a9a7c5db9f62e05ae
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon May 16 14:58:33 2016 +0200

    Complete the list of files to clean up on Windows
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 05a7aee0e2b9102c8b2ececdc1dfdb727c453c95
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon May 16 14:54:39 2016 +0200

    Communicate Configure generated header files to build files
    
    Add Configure generated header files to $unified_info{generate}.  This
    makes sure the build files will pick them up with the rest for the
    GENERATED macro, and thereby make sure they get cleaned away by 'make
    clean'
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/common.tmpl           |  2 ++
 Configurations/unix-Makefile.tmpl    |  7 ++++++-
 Configurations/windows-makefile.tmpl | 13 ++++++++++++-
 Configure                            |  7 +++++++
 4 files changed, 27 insertions(+), 2 deletions(-)

diff --git a/Configurations/common.tmpl b/Configurations/common.tmpl
index af1746a..e3f49e7 100644
--- a/Configurations/common.tmpl
+++ b/Configurations/common.tmpl
@@ -42,6 +42,8 @@
      my $bin = shift;
      my %opts = @_;
      if ($unified_info{generate}-&gt;{$src}) {
+         die &quot;$src is generated by Configure, should not appear in build file\n&quot;
+             if ref $unified_info{generate}-&gt;{$src} eq &quot;&quot;;
          my $script = $unified_info{generate}-&gt;{$src}-&gt;[0];
          $OUT .= generatesrc(src =&gt; $src,
                              generator =&gt; $unified_info{generate}-&gt;{$src},
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index 469bd32..8c27ba9 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -84,7 +84,12 @@ DEPS={- join(&quot; &quot;, map { (my $x = $_) =~ s|\.o$|$depext|; $x; }
                   grep { $unified_info{sources}-&gt;{$_}-&gt;[0] =~ /\.c$/ }
                   keys %{$unified_info{sources}}); -}
 {- output_on() if $disabled{makedepend}; &quot;&quot; -}
-GENERATED={- join(&quot; &quot;, map { (my $x = $_) =~ s|\.S$|\.s|; $x } keys %{$unified_info{generate}}) -}
+GENERATED={- join(&quot; &quot;,
+                  ( map { (my $x = $_) =~ s|\.S$|\.s|; $x }
+                    grep { defined $unified_info{generate}-&gt;{$_} }
+                    map { @{$unified_info{sources}-&gt;{$_}} }
+                    grep { /\.o$/ } keys %{$unified_info{sources}} ),
+                  ( grep { /\.h$/ } keys %{$unified_info{generate}} )) -}
 
 {- output_off() if $disabled{apps}; &quot;&quot; -}
 BIN_SCRIPTS=$(BLDDIR)/tools/c_rehash
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index d72c7bc..454f2ed 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -77,6 +77,12 @@ DEPS={- join(&quot; &quot;, map { (my $x = $_) =~ s|\.o$|$depext|; $x; }
                   grep { $unified_info{sources}-&gt;{$_}-&gt;[0] =~ /\.c$/ }
                   keys %{$unified_info{sources}}); -}
 {- output_on() if $disabled{makedepend}; &quot;&quot; -}
+GENERATED={- join(&quot; &quot;,
+                  ( map { (my $x = $_) =~ s|\.[sS]$|\.asm|; $x }
+                    grep { defined $unified_info{generate}-&gt;{$_} }
+                    map { @{$unified_info{sources}-&gt;{$_}} }
+                    grep { /\.o$/ } keys %{$unified_info{sources}} ),
+                  ( grep { /\.h$/ } keys %{$unified_info{generate}} )) -}
 
 # Do not edit these manually. Use Configure with --prefix or --openssldir
 # to change this!  Short explanation in the top comment in Configure
@@ -171,18 +177,23 @@ uninstall: uninstall_docs uninstall_sw
 
 libclean:
 	$(PERL) -e &quot;map { m/(.*)\.dll$$/; unlink glob &quot;&quot;&quot;$$1.*&quot;&quot;&quot;; } @ARGV&quot; $(SHLIBS)
+	$(PERL) -e &quot;map { m/(.*)\.dll$$/; unlink glob &quot;&quot;&quot;apps/$$1.*&quot;&quot;&quot;; } @ARGV&quot; $(SHLIBS)
+	$(PERL) -e &quot;map { m/(.*)\.dll$$/; unlink glob &quot;&quot;&quot;test/$$1.*&quot;&quot;&quot;; } @ARGV&quot; $(SHLIBS)
 	-del /Q /F $(LIBS)
 	-del /Q ossl_static.pdb
 
 clean: libclean
 	-del /Q /F $(PROGRAMS) $(TESTPROGS) $(ENGINES) $(SCRIPTS)
-	-del /Q /S /F *.asm
+	-del /Q /S /F $(GENERATED)
 	-del /Q /S /F *.d
 	-del /Q /S /F *.obj
 	-del /Q /S /F *.pdb
 	-del /Q /S /F *.exp
 	-del /Q /S /F engines\*.ilk
 	-del /Q /S /F engines\*.lib
+	-del /Q /S /F apps\*.lib
+	-del /Q /S /F engines\*.manifest
+	-del /Q /S /F apps\*.manifest
 
 depend:
 
diff --git a/Configure b/Configure
index 215ffb8..95d457c 100755
--- a/Configure
+++ b/Configure
@@ -1731,6 +1731,13 @@ EOF
         }
     }
 
+    ### Add information about files generated by Configure
+    foreach (map { abs2rel($_) } @generated_headers) {
+        die &quot;Configure gerenerated header file $_ has a GENERATE in a build.info\n&quot;
+            if $unified_info{generate}-&gt;{$_};
+        $unified_info{generate}-&gt;{$_} = &quot;Generated by Configure&quot;;
+    }
+
     ### Make unified_info a bit more efficient
     # One level structures
     foreach ((&quot;programs&quot;, &quot;libraries&quot;, &quot;engines&quot;, &quot;scripts&quot;, &quot;extra&quot;, &quot;overrides&quot;)) {
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007530.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="007533.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7531">[ date ]</a>
              <a href="thread.html#7531">[ thread ]</a>
              <a href="subject.html#7531">[ subject ]</a>
              <a href="author.html#7531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
