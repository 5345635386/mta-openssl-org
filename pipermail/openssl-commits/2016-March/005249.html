<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1457518932.719492.12271.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005248.html">
   <LINK REL="Next"  HREF="005253.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1457518932.719492.12271.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Wed Mar  9 10:22:12 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005248.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="005253.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5249">[ date ]</a>
              <a href="thread.html#5249">[ thread ]</a>
              <a href="subject.html#5249">[ subject ]</a>
              <a href="author.html#5249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  b32b896166199b497bf98da6a5c5b50d8811851f (commit)
       via  0c1167fd61cb2a5816955739a20fce095e95992e (commit)
       via  9a1394c54e9e5d21476ee6fb5d15d1d14dd4fdf5 (commit)
       via  2d32d3be154f2f658a5884d1e46b0ba56d1e6c59 (commit)
       via  08479bbb03c20efffe99ad467243169c8eeb5079 (commit)
       via  2fe730362812e3c7d364197449a9439e3cb5915b (commit)
       via  7c0e1aa6e2b24d76169573703b1455ef178667d9 (commit)
      from  1a66190888c730f466d9d7ba0c3b044a78a80ded (commit)


- Log -----------------------------------------------------------------
commit b32b896166199b497bf98da6a5c5b50d8811851f
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Tue Mar 8 14:44:46 2016 +0100

    Adapt INSTALL and related notes for Windows
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 0c1167fd61cb2a5816955739a20fce095e95992e
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Mar 7 19:18:42 2016 +0100

    Adapt appveyor.yml for the new unified build
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 9a1394c54e9e5d21476ee6fb5d15d1d14dd4fdf5
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Mar 7 14:12:45 2016 +0100

    Adapt the Windows makefile template to source generation
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 2d32d3be154f2f658a5884d1e46b0ba56d1e6c59
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Mar 5 19:59:30 2016 +0100

    Don't run the TLSProxy based tests in native Windows
    
    There are issues binding listening ports.  This may be analyzed more
    thoroughly later on.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 08479bbb03c20efffe99ad467243169c8eeb5079
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Mar 5 20:02:05 2016 +0100

    Unified - name native Windows shared libraries like MingW builds do
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 2fe730362812e3c7d364197449a9439e3cb5915b
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Mar 2 16:12:22 2016 +0100

    Unified - extract settings from util/pl/VC-32.pl and make the config settings
    
    This introduces the settings loutflag and aroutflag, because different
    Windows tools that do the same thing have different ways to specify
    the output file.
    
    The Borland C++ config is commented away for the monent, perhaps
    permanently.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 7c0e1aa6e2b24d76169573703b1455ef178667d9
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Mar 2 12:29:56 2016 +0100

    Unified - a native Windows makefile template
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/00-base-templates.conf |  10 +-
 Configurations/10-main.conf           | 212 ++++++++++++++++++---
 Configurations/windows-makefile.tmpl  | 342 ++++++++++++++++++++++++++++++++++
 INSTALL                               |  28 ++-
 INSTALL.WIN =&gt; NOTES.WIN              | 226 ++++++++++------------
 appveyor.yml                          |  13 +-
 build.info                            |   3 +
 test/recipes/70-test_sslcertstatus.t  |   2 +-
 test/recipes/70-test_sslextension.t   |   2 +-
 test/recipes/70-test_sslsessiontick.t |   2 +-
 test/recipes/70-test_sslskewith0p.t   |   2 +-
 test/recipes/70-test_sslvertol.t      |   2 +-
 test/recipes/70-test_tlsextms.t       |   2 +-
 test/recipes/90-test_networking.t     |   2 +-
 14 files changed, 679 insertions(+), 169 deletions(-)
 create mode 100644 Configurations/windows-makefile.tmpl
 rename INSTALL.WIN =&gt; NOTES.WIN (56%)

diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
index 4308c5c..cbb5675 100644
--- a/Configurations/00-base-templates.conf
+++ b/Configurations/00-base-templates.conf
@@ -89,7 +89,15 @@
                 }
                 return (); },
 
-        build_scheme    =&gt; [ &quot;mk1mf&quot; ],
+        ld              =&gt; &quot;link&quot;,
+        lflags          =&gt; &quot;/nologo&quot;,
+        loutflag        =&gt; &quot;/out:&quot;,
+        ar              =&gt; &quot;lib&quot;,
+        arflags         =&gt; &quot;/nologo&quot;,
+        aroutflag       =&gt; &quot;/out:&quot;,
+
+        build_file      =&gt; &quot;makefile&quot;,
+        build_scheme    =&gt; [ &quot;unified&quot;, &quot;windows&quot; ],
     },
 
     BASE_VMS =&gt; {
diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 576ac45..fa9af88 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -17,6 +17,79 @@ sub combine {
     return sub { add(@stuff)-&gt;(); }
 }
 
+# Helper functions for the Windows configs
+my $vc_win64a_info = {};
+sub vc_win64a_info {
+    unless (%$vc_win64a_info) {
+        if (`nasm -v 2&gt;NUL` =~ /NASM version ([0-9]+\.[0-9]+)/ &amp;&amp; $1 &gt;= 2.0) {
+            $vc_win64a_info = { as        =&gt; &quot;nasm&quot;,
+                                asflags   =&gt; &quot;-f win64 -DNEAR -Ox -g&quot;,
+                                asoutflag =&gt; &quot;-o&quot; };
+        } else {
+            $vc_win64a_info = { as        =&gt; &quot;ml64&quot;,
+                                asflags   =&gt; &quot;/c /Cp /Cx /Zi&quot;,
+                                asoutflag =&gt; &quot;/Fo&quot; };
+        }
+    }
+    return $vc_win64a_info;
+}
+
+my $vc_wince_info = {};
+sub vc_wince_info {
+    unless (%$vc_wince_info) {
+        # sanity check
+        die '%OSVERSION% is not defined' if (!defined($ENV{'OSVERSION'}));
+        die '%PLATFORM% is not defined'  if (!defined($ENV{'PLATFORM'}));
+        die '%TARGETCPU% is not defined' if (!defined($ENV{'TARGETCPU'}));
+
+        #
+        # Idea behind this is to mimic flags set by eVC++ IDE...
+        #
+        my $wcevers = $ENV{'OSVERSION'};                    # WCENNN
+        die '%OSVERSION% value is insane'
+            if ($wcevers !~ /^WCE([1-9])([0-9]{2})$/);
+        my $wcecdefs = &quot;-D_WIN32_WCE=$1$2 -DUNDER_CE=$1$2&quot;; # -D_WIN32_WCE=NNN
+        my $wcelflag = &quot;/subsystem:windowsce,$1.$2&quot;;        # ...,N.NN
+
+        my $wceplatf =  $ENV{'PLATFORM'};
+        my $wceplatf =~ tr/a-z0-9 /A-Z0-9_/d;
+        my $wcecdefs .= &quot; -DWCE_PLATFORM_$wceplatf&quot;;
+
+        my $wcetgt = $ENV{'TARGETCPU'};                     # just shorter name...
+      SWITCH: for($wcetgt) {
+          /^X86/        &amp;&amp; do { $wcecdefs.=&quot; -Dx86 -D_X86_ -D_i386_ -Di_386_&quot;;
+                                $wcelflag.=&quot; /machine:X86&quot;;     last; };
+          /^ARMV4[IT]/  &amp;&amp; do { $wcecdefs.=&quot; -DARM -D_ARM_ -D$wcetgt&quot;;
+                                $wcecdefs.=&quot; -DTHUMB -D_THUMB_&quot; if($wcetgt=~/T$/);
+                                $wcecdefs.=&quot; -QRarch4T -QRinterwork-return&quot;;
+                                $wcelflag.=&quot; /machine:THUMB&quot;;   last; };
+          /^ARM/        &amp;&amp; do { $wcecdefs.=&quot; -DARM -D_ARM_ -D$wcetgt&quot;;
+                                $wcelflag.=&quot; /machine:ARM&quot;;     last; };
+          /^MIPSIV/     &amp;&amp; do { $wcecdefs.=&quot; -DMIPS -D_MIPS_ -DR4000 -D$wcetgt&quot;;
+                                $wcecdefs.=&quot; -D_MIPS64 -QMmips4 -QMn32&quot;;
+                                $wcelflag.=&quot; /machine:MIPSFPU&quot;; last; };
+          /^MIPS16/     &amp;&amp; do { $wcecdefs.=&quot; -DMIPS -D_MIPS_ -DR4000 -D$wcetgt&quot;;
+                                $wcecdefs.=&quot; -DMIPSII -QMmips16&quot;;
+                                $wcelflag.=&quot; /machine:MIPS16&quot;;  last; };
+          /^MIPSII/     &amp;&amp; do { $wcecdefs.=&quot; -DMIPS -D_MIPS_ -DR4000 -D$wcetgt&quot;;
+                                $wcecdefs.=&quot; -QMmips2&quot;;
+                                $wcelflag.=&quot; /machine:MIPS&quot;;    last; };
+          /^R4[0-9]{3}/ &amp;&amp; do { $wcecdefs.=&quot; -DMIPS -D_MIPS_ -DR4000&quot;;
+                                $wcelflag.=&quot; /machine:MIPS&quot;;    last; };
+          /^SH[0-9]/    &amp;&amp; do { $wcecdefs.=&quot; -D$wcetgt -D_${wcetgt}_ -DSHx&quot;;
+                                $wcecdefs.=&quot; -Qsh4&quot; if ($wcetgt =~ /^SH4/);
+                                $wcelflag.=&quot; /machine:$wcetgt&quot;; last; };
+          { $wcecdefs.=&quot; -D$wcetgt -D_${wcetgt}_&quot;;
+            $wcelflag.=&quot; /machine:$wcetgt&quot;;                     last; };
+      }
+
+        $vc_wince_info = { cflags =&gt; $wcecdefs,
+                           lflags =&gt; $wcelflag };
+    }
+    return $vc_wince_info;
+}
+
+
 %targets = (
 
 #### Basic configs that should work on any 32-bit box
@@ -1155,60 +1228,153 @@ sub combine {
 # positives in some situations. Disabling it altogether masks both
 # legitimate and false cases, but as we compile on multiple platforms,
 # we rely on other compilers to catch legitimate cases.
+#
+# Also note that we force threads no matter what.  Configuring &quot;no-threads&quot;
+# is ignored.
     &quot;VC-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
         template         =&gt; 1,
         cc               =&gt; &quot;cl&quot;,
         cflags           =&gt; &quot;-W3 -wd4090 -Gs0 -GF -Gy -nologo -DOPENSSL_SYS_WIN32 -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -D_CRT_SECURE_NO_DEPRECATE&quot;,
+        coutflag         =&gt; &quot;/Fo&quot;,
+        lib_cflags       =&gt; &quot;/Zl /Zi /Fdlib&quot;,
+        dso_cflags       =&gt; &quot;/Zi&quot;,
+        bin_cflags       =&gt; &quot;/Zi /Fdapp&quot;,
+        lflags           =&gt; add(&quot;/debug&quot;),
+        shared_cflag     =&gt; &quot;-D_WINDLL&quot;,
+        shared_ldflag    =&gt; &quot;/dll&quot;,
         shared_target    =&gt; &quot;win-shared&quot;, # meaningless except it gives Configure a hint
+        thread_scheme    =&gt; &quot;winthreads&quot;,
         dso_scheme       =&gt; &quot;win32&quot;,
     },
+    &quot;VC-noCE-common&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;VC-common&quot;, &quot;uplink_common&quot; ],
+        cflags           =&gt; add(picker(default =&gt; &quot;-DUNICODE -D_UNICODE&quot;,
+                                       debug   =&gt;
+                                       sub {
+                                           ($disabled{shared} ? &quot;/MT&quot; : &quot;/MD&quot;)
+                                               .&quot;d /Od -DDEBUG -D_DEBUG&quot;;
+                                       },
+                                       release =&gt;
+                                       sub {
+                                           ($disabled{shared} ? &quot;/MT&quot; : &quot;/MD&quot;)
+                                               .&quot; /Ox /O2 /Ob2&quot;;
+                                       })),
+        bin_lflags       =&gt; add(&quot;/subsystem:console /opt:ref&quot;),
+        ex_libs          =&gt; sub {
+            my @ex_libs = ();
+            push @ex_libs, 'ws2_32.lib' unless $disabled{sock};
+            push @ex_libs, 'gdi32.lib advapi32.lib crypt32.lib user32.lib';
+            return join(&quot; &quot;, @ex_libs);
+        },
+    },
+    &quot;VC-WIN64-common&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;VC-noCE-common&quot; ],
+        ex_libs          =&gt; sub {
+            my @ex_libs = ();
+            push @ex_libs, 'bufferoverflowu.lib' if (`cl 2&gt;&amp;1` =~ /14\.00\.4[0-9]{4}\./);
+            return join(&quot; &quot;, @_, @ex_libs);
+        },
+        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT EXPORT_VAR_AS_FN&quot;,
+        build_scheme     =&gt; add(&quot;VC-W64&quot;, { separator =&gt; undef }),
+    },
     &quot;VC-WIN64I&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;VC-common&quot;, asm(&quot;ia64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-DUNICODE -D_UNICODE&quot;),
+        inherit_from     =&gt; [ &quot;VC-WIN64-common&quot;, asm(&quot;ia64_asm&quot;) ],
+        as               =&gt; &quot;ias&quot;,
+        asflags          =&gt; &quot;-d debug&quot;,
+        asoutflag        =&gt; &quot;-o&quot;,
         sys_id           =&gt; &quot;WIN64I&quot;,
-        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT EXPORT_VAR_AS_FN&quot;,
-        bn_obj           =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s/bn\-//; $r; },
-        rc4_obj          =&gt; &quot;&quot;,
+        rc4_asm_src      =&gt; &quot;&quot;,
         perlasm_scheme   =&gt; &quot;ias&quot;,
-        build_scheme     =&gt; add(&quot;VC-W64&quot;, { separator =&gt; undef }),
     },
     &quot;VC-WIN64A&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;VC-common&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-DUNICODE -D_UNICODE&quot;),
+        inherit_from     =&gt; [ &quot;VC-WIN64-common&quot;, asm(&quot;x86_64_asm&quot;) ],
+        as               =&gt; sub { vc_win64a_info()-&gt;{as} },
+        asflags          =&gt; sub { vc_win64a_info()-&gt;{asflags} },
+        asoutflag        =&gt; sub { vc_win64a_info()-&gt;{asoutflag} },
         sys_id           =&gt; &quot;WIN64A&quot;,
-        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT EXPORT_VAR_AS_FN&quot;,
-        bn_obj           =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s/x86_64\-gcc/bn_asm/; $r; },
+        bn_asm_src       =&gt; sub { return undef unless @_;
+                                  my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s|asm/x86_64-gcc|bn_asm|; $r; },
         perlasm_scheme   =&gt; &quot;auto&quot;,
-        build_scheme     =&gt; add(&quot;VC-W64&quot;, { separator =&gt; undef }),
     },
     &quot;VC-WIN32&quot; =&gt; {
         # x86 Win32 target defaults to ANSI API, if you want UNICODE,
         # configure with 'perl Configure VC-WIN32 -DUNICODE -D_UNICODE'
-        inherit_from     =&gt; [ &quot;VC-common&quot;, asm(&quot;x86_asm&quot;) ],
+        inherit_from     =&gt; [ &quot;VC-noCE-common&quot;, asm(&quot;x86_asm&quot;) ],
+        as               =&gt; sub { my $ver=`nasm -v 2&gt;NUL`;
+                                  my $vew=`nasmw -v 2&gt;NUL`;
+                                  return $ver ge $vew ? &quot;nasm&quot; : &quot;nasmw&quot; },
+        asflags          =&gt; &quot;-f win32&quot;,
+        asoutflag        =&gt; &quot;-o&quot;,
+        ex_libs          =&gt; sub {
+            my @ex_libs = ();
+            # WIN32 UNICODE build gets linked with unicows.lib for
+            # backward compatibility with Win9x.
+            push @ex_libs, 'unicows.lib'
+                if (grep { $_ eq &quot;UNICODE&quot; } @user_defines);
+            return join(&quot; &quot;, @ex_libs, @_);
+        },
         sys_id           =&gt; &quot;WIN32&quot;,
         bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
         perlasm_scheme   =&gt; &quot;win32n&quot;,
         build_scheme     =&gt; add(&quot;VC-W32&quot;, { separator =&gt; undef }),
     },
     &quot;VC-CE&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
+        inherit_from     =&gt; [ &quot;VC-common&quot; ],
+        as               =&gt; &quot;ml&quot;,
+        asflags          =&gt; &quot;/nologo /Cp /coff /c /Cx /Zi&quot;,
+        asoutflag        =&gt; &quot;/Fo&quot;,
         cc               =&gt; &quot;cl&quot;,
+        cflags           =&gt;
+            picker(default =&gt;
+                   combine('/W3 /WX /GF /Gy /nologo -DUNICODE -D_UNICODE -DOPENSSL_SYS_WINCE -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -DDSO_WIN32 -DNO_CHMOD -DOPENSSL_SMALL_FOOTPRINT',
+                           sub { vc_wince_info()-&gt;{cflags}; },
+                           sub { defined($ENV{'WCECOMPAT'})
+                                     ? '-I$(WCECOMPAT)/include' : (); },
+                           sub { defined($ENV{'PORTSDK_LIBPATH'})
+                                     ? '-I$(PORTSDK_LIBPATH)/../../include' : (); },
+                           sub { `cl 2&gt;&amp;1` =~ /Version ([0-9]+)\./ &amp;&amp; $1&gt;=14
+                                     ? ($disabled{shared} ? &quot; /MT&quot; : &quot; /MD&quot;)
+                                     : &quot; /MC&quot;; }),
+                   debug   =&gt; &quot;/Od -DDEBUG -D_DEBUG&quot;,
+                   release =&gt; &quot;/O1i&quot;),
+        lflags           =&gt; combine(&quot;/nologo /opt:ref&quot;,
+                                    sub { vc_wince_info()-&gt;{lflags}; },
+                                    sub { defined($ENV{PORTSDK_LIBPATH})
+                                              ? &quot;/entry:mainCRTstartup&quot; : (); }),
         sys_id           =&gt; &quot;WINCE&quot;,
         bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
-        dso_scheme       =&gt; &quot;win32&quot;,
+        ex_libs          =&gt; sub {
+            my @ex_libs = ();
+            push @ex_libs, 'ws2.lib' unless $disabled{sock};
+            push @ex_libs, 'crypt32.lib';
+            if (defined($ENV{WCECOMPAT})) {
+                my $x = '$(WCECOMPAT)/lib';
+                if (-f &quot;$x/$ENV{TARGETCPU}/wcecompatex.lib&quot;) {
+                    $x .= '/$(TARGETCPU)/wcecompatex.lib';
+                } else {
+                    $x .= '/wcecompatex.lib';
+                }
+                push @ex_libs, $x;
+            }
+            push @ex_libs, '$(PORTSDK_LIBPATH)/portlib.lib'
+                if (defined($ENV{'PORTSDK_LIBPATH'}));
+            push @ex_libs, ' /nodefaultlib coredll.lib corelibc.lib'
+                if ($ENV{'TARGETCPU'} eq &quot;X86&quot;);
+            return @ex_libs;
+        },
         build_scheme     =&gt; add(&quot;VC-WCE&quot;, { separator =&gt; undef }),
     },
 
-#### Borland C++ 4.5
-    &quot;BC-32&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
-        cc               =&gt; &quot;bcc32&quot;,
-        sys_id           =&gt; &quot;WIN32&quot;,
-        bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
-        dso_scheme       =&gt; &quot;win32&quot;,
-        build_scheme     =&gt; add(&quot;BC&quot;, { separator =&gt; undef }),
-    },
+###### Borland C++ 4.5
+##    &quot;BC-32&quot; =&gt; {
+##        inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
+##        cc               =&gt; &quot;bcc32&quot;,
+##        sys_id           =&gt; &quot;WIN32&quot;,
+##        bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
+##        dso_scheme       =&gt; &quot;win32&quot;,
+##        build_scheme     =&gt; add(&quot;BC&quot;, { separator =&gt; undef }),
+##    },
 
 #### MinGW
     &quot;mingw&quot; =&gt; {
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
new file mode 100644
index 0000000..77cc377
--- /dev/null
+++ b/Configurations/windows-makefile.tmpl
@@ -0,0 +1,342 @@
+##
+## Makefile for OpenSSL
+##
+## {- join(&quot;\n## &quot;, @autowarntext) -}
+{-
+ our $objext = $target{obj_extension} || &quot;.obj&quot;;
+ our $depext = $target{dep_extension} || &quot;.d&quot;;
+ our $exeext = $target{exe_extension} || &quot;.exe&quot;;
+ our $libext = $target{lib_extension} || &quot;.lib&quot;;
+ our $shlibext = $target{shared_extension} || &quot;.dll&quot;;
+ our $shlibextimport = $target{shared_import_extension} || &quot;.lib&quot;;
+ our $dsoext = $target{dso_extension} || &quot;.dll&quot;;
+
+ sub shlib {
+     return () if $disabled{shared};
+     my $lib = shift;
+     return $unified_info{sharednames}-&gt;{$lib} . $shlibext;
+ }
+
+ sub shlib_import {
+     return () if $disabled{shared};
+     my $lib = shift;
+     return $lib . $shlibextimport;
+ }
+
+ sub dso {
+     my $dso = shift;
+
+     return $dso . $dsoext;
+ }
+ '';
+-}
+
+PLATFORM={- $config{target} -}
+SRCDIR={- $config{sourcedir} -}
+BLDDIR={- $config{builddir} -}
+
+VERSION={- $config{version} -}
+MAJOR={- $config{major} -}
+MINOR={- $config{minor} -}
+
+SHLIB_VERSION_NUMBER={- $config{shlib_version_number} -}
+
+LIBS={- join(&quot; &quot;, map { $_.$libext } @{$unified_info{libraries}}) -}
+SHLIBS={- join(&quot; &quot;, map { shlib($_) } @{$unified_info{libraries}}) -}
+ENGINES={- join(&quot; &quot;, map { dso($_) } @{$unified_info{engines}}) -}
+PROGRAMS={- join(&quot; &quot;, map { $_.$exeext } grep { !m|^test\\| } @{$unified_info{programs}}) -}
+TESTPROGS={- join(&quot; &quot;, map { $_.$exeext } grep { m|^test\\| } @{$unified_info{programs}}) -}
+SCRIPTS={- join(&quot; &quot;, @{$unified_info{scripts}}) -}
+
+DEPS={- join(&quot; &quot;, map { (my $x = $_) =~ s|\.o$|$depext|; $x; }
+                  grep { $unified_info{sources}-&gt;{$_}-&gt;[0] =~ /\.c$/ }
+                  keys %{$unified_info{sources}}); -}
+
+# Do not edit these manually. Use Configure with --prefix or --openssldir
+# to change this!  Short explanation in the top comment in Configure
+INSTALLTOP={- # $prefix is used in the OPENSSLDIR perl snippet
+	      #
+	      our $prefix = $config{prefix} || &quot;/usr/local&quot;;
+              $prefix -}
+OPENSSLDIR={- #
+	      # The logic here is that if no --openssldir was given,
+	      # OPENSSLDIR will get the value from $prefix plus &quot;/ssl&quot;.
+	      # If --openssldir was given and the value is an absolute
+	      # path, OPENSSLDIR will get its value without change.
+	      # If the value from --openssldir is a relative path,
+	      # OPENSSLDIR will get $prefix with the --openssldir
+	      # value appended as a subdirectory.
+	      #
+              use File::Spec::Functions;
+              our $openssldir =
+                  $config{openssldir} ?
+                      (file_name_is_absolute($config{openssldir}) ?
+                           $config{openssldir}
+                           : catdir($prefix, $config{openssldir}))
+                      : catdir($prefix, &quot;ssl&quot;);
+              $openssldir -}
+LIBDIR={- #
+          # if $prefix/lib$target{multilib} is not an existing
+          # directory, then assume that it's not searched by linker
+          # automatically, in which case adding $target{multilib} suffix
+          # causes more grief than we're ready to tolerate, so don't...
+          our $multilib =
+              -d &quot;$prefix/lib$target{multilib}&quot; ? $target{multilib} : &quot;&quot;;
+          our $libdir = $config{libdir} || &quot;lib$multilib&quot;;
+          $libdir -}
+ENGINESDIR={- use File::Spec::Functions;
+              our $enginesdir = catdir($prefix,$libdir,&quot;engines&quot;);
+	      $enginesdir -}
+
+CC={- $target{cc} -}
+CFLAGS={- join(&quot; &quot;,(map { &quot;-D&quot;.$_} @{$target{defines}}, @{$config{defines}})) -} {- join(&quot; &quot;, quotify_l(&quot;-DENGINESDIR=\&quot;$enginesdir\&quot;&quot;, &quot;-DOPENSSLDIR=\&quot;$openssldir\&quot;&quot;)) -} {- $target{cflags} -} {- $config{cflags} -}
+COUTFLAG={- $target{coutflag} || &quot;/Fo&quot; -}
+LD={- $target{ld} || &quot;link&quot; -}
+LDFLAGS={- $target{lflags} -}
+LDOUTFLAG={- $target{loutflag} || &quot;/out:&quot; -}
+EX_LIBS={- $target{ex_libs} -}
+LIB_CFLAGS={- join(&quot; &quot;, $target{lib_cflags}, $target{shared_cflag}) || &quot;&quot; -}
+SHARED_LDFLAGS={- $target{shared_ldflag} || &quot;&quot; -}
+DSO_CFLAGS={- join(&quot; &quot;, $target{dso_cflags}, $target{shared_cflag}) || &quot;&quot; -}
+DSO_LDFLAGS={- join(&quot; &quot;, $target{dso_lflags}, $target{shared_ldflag}) || &quot;&quot; -}
+BIN_CFLAGS={- $target{bin_cflags} -}
+BIN_LDFLAGS={- $target{bin_lflags} -}
+
+PERL={- $config{perl} -}
+
+AR={- $target{ar} -}
+ARFLAGS= {- $target{arflags} -}
+AROUTFLAG={- $target{aroutflag} || &quot;/out:&quot; -}
+
+AS={- $target{as} -}
+ASFLAGS={- $target{asflags} -}
+ASOUTFLAG={- $target{asoutflag} -}
+PERLASM_SCHEME= {- $target{perlasm_scheme} -}
+
+PROCESSOR= {- $config{processor} -}
+
+# The main targets ###################################################
+
+all: configdata.pm build_libs_nodep build_engines_nodep build_apps_nodep depend
+
+build_libs: configdata.pm build_libs_nodep depend
+build_libs_nodep: $(LIBS)
+build_engines: configdata.pm build_engines_nodep depend
+build_engines_nodep: $(ENGINES)
+build_apps: configdata.pm build_apps_nodep depend
+build_apps_nodep: $(PROGRAMS) $(SCRIPTS)
+build_tests: configdata.pm build_tests_nodep depend
+build_tests_nodep: $(TESTPROGS)
+
+test tests: build_tests_nodep build_apps_nodep build_engines_nodep depend
+	set SRCTOP=$(SRCDIR)
+	set BLDTOP=$(BLDDIR)
+	set PERL=$(PERL)
+	$(PERL) $(SRCDIR)\test\run_tests.pl $(TESTS)
+
+list-tests:
+	@set TOP=$(SRCDIR)
+	@set PERL=$(PERL)
+	@$(PERL) $(SRCDIR)\test\run_tests.pl list
+
+depend:
+
+# Building targets ###################################################
+
+configdata.pm: {- $config{build_file_template} -} $(SRCDIR)\Configure
+	@echo &quot;Detected changed: $?&quot;
+	@echo &quot;Reconfiguring...&quot;
+	$(PERL) $(SRCDIR)\Configure reconf
+	@echo &quot;**************************************************&quot;
+	@echo &quot;***                                            ***&quot;
+	@echo &quot;***   Please run the same make command again   ***&quot;
+	@echo &quot;***                                            ***&quot;
+	@echo &quot;**************************************************&quot;
+	@( exit 1 )
+
+{-
+ use File::Basename;
+ use File::Spec::Functions qw/:DEFAULT abs2rel rel2abs/;
+
+ # Helper function to figure out dependencies on libraries
+ # It takes a list of library names and outputs a list of dependencies
+ sub compute_lib_depends {
+     if ($disabled{shared}) {
+	 return map { $_.$libext } @_;
+     }
+     return map { shlib_import($_) } @_;
+ }
+
+  sub generatesrc {
+      my %args = @_;
+      (my $target = $args{src}) =~ s/\.[sS]$/.asm/;
+      my $generator = join(&quot; &quot;, @{$args{generator}});
+
+      if ($target !~ /\.asm$/) {
+          return &lt;&lt;&quot;EOF&quot;;
+$target: $args{generator}-&gt;[0]
+	\$(PERL) $generator &gt; \$@
+EOF
+      } else {
+          if ($args{generator}-&gt;[0] =~ /\.pl$/) {
+              $generator = '$(PERL) '.$generator;
+          } elsif ($args{generator}-&gt;[0] =~ /\.S$/) {
+              $generator = undef;
+          } else {
+              die &quot;Generator type for $src unknown: $generator\n&quot;;
+          }
+
+          if (defined($generator)) {
+              # If the target is named foo.S in build.info, we want to
+              # end up generating foo.s in two steps.
+              if ($args{src} =~ /\.S$/) {
+                   return &lt;&lt;&quot;EOF&quot;;
+$target: $args{generator}-&gt;[0]
+	set ASM=\$(AS)
+	set CC=\$(CC)
+	$generator \$@.S
+	\$(CC) \$(CFLAGS) /EP /C \$@.S &gt; \$@
+        del /Q \$@.S
+EOF
+              }
+              # Otherwise....
+              return &lt;&lt;&quot;EOF&quot;;
+$target: $args{generator}-&gt;[0]
+	set ASM=\$(AS)
+	set CC=\$(CC)
+	$generator \$@
+EOF
+          }
+          return &lt;&lt;&quot;EOF&quot;;
+$target: $args{generator}-&gt;[0]
+	\$(CC) \$(CFLAGS) /EP /C \$&lt; &gt; \$@
+EOF
+      }
+  }
+
+ sub src2obj {
+     my %args = @_;
+     my $obj = $args{obj};
+     my @srcs = map { (my $x = $_) =~ s/\.[sS]$/.asm/; $x } ( @{$args{srcs}} );
+     my $srcs = join(&quot; &quot;,  @srcs);
+     my $deps = join(&quot; &quot;, @srcs, @{$args{deps}});
+     my $incs = join(&quot;&quot;, map { &quot; /I &quot;.$_ } @{$args{incs}});
+     my $ecflags = { lib =&gt; '$(LIB_CFLAGS)',
+		     dso =&gt; '$(DSO_CFLAGS)',
+		     bin =&gt; '$(BIN_CFLAGS)' } -&gt; {$args{intent}};
+     my $makedepprog = $config{makedepprog};
+     if ($srcs[0] =~ /\.asm$/) {
+         return &lt;&lt;&quot;EOF&quot;;
+$obj$objext: $deps
+	\$(AS) \$(ASFLAGS) \$(ASOUTFLAG)\$\@ $srcs
+EOF
+     }
+     return &lt;&lt;&quot;EOF&quot;;
+$obj$depext: $deps
+	\$(CC) \$(CFLAGS) $ecflags$inc /Zs /showIncludes $srcs 2&gt;&amp;1 | \\
+	    \$(PERL) -n &lt;&lt; &gt; $obj$depext
+chomp;
+s/^Note: including file: *//;
+\$\$collect{\$\$_} = 1;
+END { print '$obj$objext: ',join(&quot; &quot;, sort keys \%collect),&quot;\\n&quot; }
+&lt;&lt;KEEP
+$obj$objext: $obj$depext
+	\$(CC) \$(CFLAGS) $ecflags$incs -c \$(COUTFLAG)\$\@ @&lt;&lt;
+$srcs
+&lt;&lt;KEEP
+EOF
+ }
+
+ # On Unix, we build shlibs from static libs, so we're ignoring the
+ # object file array.  We *know* this routine is only called when we've
+ # configure 'shared'.
+ sub libobj2shlib {
+     my %args = @_;
+     my $lib = $args{lib};
+     my $shlib = $args{shlib};
+     (my $mkdef_key = $lib) =~ s/^lib//i;
+     my $objs = join(&quot;\n&quot;, map { $_.$objext } @{$args{objs}});
+     my $linklibs = join(&quot;&quot;,
+			 map { &quot;\n$_&quot; } compute_lib_depends(@{$args{deps}}));
+     my $deps = join(&quot; &quot;,
+		     (map { $_.$objext } @{$args{objs}}),
+		     compute_lib_depends(@{$args{deps}}));
+     my $ordinalsfile = defined($args{ordinals}) ? $args{ordinals}-&gt;[1] : &quot;&quot;;
+     my $mkdef_pl = abs2rel(rel2abs(catfile($config{sourcedir},
+					    &quot;util&quot;, &quot;mkdef.pl&quot;)),
+			    rel2abs($config{builddir}));
+     my $target = shlib_import($lib);
+     return &lt;&lt;&quot;EOF&quot;
+$target: $deps $ordinalsfile
+	\$(PERL) $mkdef_pl &quot;$mkdef_key&quot; 32 &gt; $shlib.def
+	\$(LD) \$(LDFLAGS) \$(SHARED_LDFLAGS) \\
+		/implib:$target \$(LDOUTFLAG)$shlib$shlibext /def:$shlib.def @&lt;&lt;
+$objs$linklibs \$(EX_LIBS)
+&lt;&lt;
+EOF
+ }
+ sub obj2dso {
+     my %args = @_;
+     my $dso = $args{lib};
+     my $dso_n = basename($dso);
+     my $objs = join(&quot;\n&quot;, map { $_.$objext } @{$args{objs}});
+     my $linklibs = join(&quot;&quot;,
+			 map { &quot;\n$_&quot; } compute_lib_depends(@{$args{deps}}));
+     my $deps = join(&quot; &quot;,
+		     (map { $_.$objext } @{$args{objs}}),
+		     compute_lib_depends(@{$args{deps}}));
+     return &lt;&lt;&quot;EOF&quot;;
+$dso$dsoext: $deps
+	\$(LD) \$(LDFLAGS) \$(DSO_LDFLAGS) \$(LDOUTFLAG)$dso$dsoext /def:&lt;&lt; @&lt;&lt;
+LIBRARY         $dso_n
+EXPORTS
+    bind_engine		@1
+    v_check		@2
+&lt;&lt;
+$objs$linklibs \$(EX_LIBS)
+&lt;&lt;
+EOF
+ }
+ sub obj2lib {
+     my %args = @_;
+     my $lib = $args{lib};
+     my $objs = join(&quot;\n&quot;, map { $_.$objext } @{$args{objs}});
+     my $deps = join(&quot; &quot;, map { $_.$objext } @{$args{objs}});
+     return &lt;&lt;&quot;EOF&quot;;
+$lib$libext: $deps
+	\$(AR) \$(ARFLAGS) \$(AROUTFLAG)$lib$libext @&lt;&lt;
+$objs
+&lt;&lt;
+EOF
+ }
+ sub obj2bin {
+     my %args = @_;
+     my $bin = $args{bin};
+     my $objs = join(&quot;\n&quot;, map { $_.$objext } @{$args{objs}});
+     my $linklibs = join(&quot;&quot;,
+			 map { &quot;\n$_&quot; } compute_lib_depends(@{$args{deps}}));
+     my $deps = join(&quot; &quot;,
+		     (map { $_.$objext } @{$args{objs}}),
+		     compute_lib_depends(@{$args{deps}}));
+     return &lt;&lt;&quot;EOF&quot;;
+$bin$exeext: $deps
+	\$(LD) \$(LDFLAGS) \$(BIN_LDFLAGS) \$(LDOUTFLAG)$bin$exeext @&lt;&lt;
+$objs setargv.obj$linklibs \$(EX_LIBS)
+&lt;&lt;
+EOF
+  }
+  sub in2script {
+      my %args = @_;
+      my $script = $args{script};
+      my $sources = join(&quot; &quot;, @{$args{sources}});
+      my $dofile = abs2rel(rel2abs(catfile($config{sourcedir},
+                                           &quot;util&quot;, &quot;dofile.pl&quot;)),
+                           rel2abs($config{builddir}));
+      return &lt;&lt;&quot;EOF&quot;;
+$script: $sources
+	\$(PERL) &quot;-I\$(BLDDIR)&quot; -Mconfigdata &quot;$dofile&quot; \\
+	    &quot;-o$target{build_file}&quot; $sources &gt; &quot;$script&quot;
+EOF
+  }
+  &quot;&quot;    # Important!  This becomes part of the template result.
+-}
diff --git a/INSTALL b/INSTALL
index a96eb8f..4799d62 100644
--- a/INSTALL
+++ b/INSTALL
@@ -3,7 +3,7 @@
  ---------------------------------
 
  [Installation on DOS (with djgpp), Windows, MacOS (before MacOS X)
-  and NetWare is described in INSTALL.DJGPP, INSTALL.WIN, INSTALL.MacOS
+  and NetWare is described in INSTALL.DJGPP, INSTALL.MacOS
   and INSTALL.NW.
   
   This document describes installation on the main supported operating
@@ -22,7 +22,8 @@
  For more details regarding specific platforms, there are these notes
  available:
 
-  * NOTES.VMS
+  * NOTES.VMS (OpenVMS)
+  * NOTES.WIN (any Windows except for Windows CE)
 
  Quick Start
  -----------
@@ -43,6 +44,12 @@
     $ mms test
     $ mms install
 
+  on Windows (only pick one of the targets for configuration):
+
+    $ perl Configure { VC-WIN32 | VC-WIN64A | VC-WIN64I | VC-CE }
+    $ nmake
+    $ nmake test
+
  [If any of these steps fails, see section Installation in Detail below.]
 
  This will build and install OpenSSL in the default location, which is:
@@ -50,6 +57,7 @@
   Unix:    normal installation directories under /usr/local
   OpenVMS: SYS$COMMON:[OPENSSL-'version'...], where 'version' is the
            OpenSSL version number ('major'_'minor').
+  Windows: currently don't have an install function     &lt;TBA&gt;
 
  If you want to install it anywhere else, run config like this:
 
@@ -152,6 +160,8 @@
 
  1a. Configure OpenSSL for your operation system automatically:
 
+     NOTE: This is not available on Windows.
+
        $ ./config [options]                             # Unix
 
        or
@@ -235,6 +245,13 @@
 
        $ @[PATH.TO.OPENSSL.SOURCE]Configure {target} {options}
 
+     Windows example:
+
+       $ C:
+       $ mkdir \temp-openssl
+       $ cd \temp-openssl
+       $ perl d:\PATH\TO\OPENSSL\SOURCE\Configure {target} {options}
+
      Paths can be relative just as well as absolute.  Configure will
      do its best to translate them to relative paths whenever possible.
 
@@ -242,6 +259,7 @@
 
        $ make                                           # Unix
        $ mms                                            ! (or mmk) OpenVMS
+       $ nmake                                          # Windows
 
      This will build the OpenSSL libraries (libcrypto.a and libssl.a on
      Unix, corresponding on other platforms) and the OpenSSL binary
@@ -268,6 +286,7 @@
 
        $ make test                                      # Unix
        $ mms test                                       ! OpenVMS
+       $ nmake test                                     # Windows
 
      If some tests fail, look at the output.  There may be reasons for
      the failure that isn't a problem in OpenSSL itself (like a
@@ -279,11 +298,15 @@
        $ DEFINE HARNESS_VERBOSE YES
        $ mms test                                       ! OpenVMS
 
+       $ set HARNESS_VERBOSE=yes
+       $ nmake test                                     # Windows
+
      If you want to run just one or a few specific tests, you can use
      the make variable TESTS to specify them, like this:
 
        $ make TESTS='test_rsa test_dsa' test            # Unix
        $ mms/macro=&quot;TESTS=test_rsa test_dsa&quot; test       ! OpenVMS
+       $ nmake TESTS='test_rsa test_dsa' test           # Windows
 
      And of course, you can combine (Unix example shown):
        
@@ -293,6 +316,7 @@
 
        $ make list-tests                                # Unix
        $ mms list-tests                                 ! OpenVMS
+       $ nmake list-tests                               # Windows
 
      Have a look at the manual for the perl module Test::Harness to
      see what other HARNESS_* variables there are.
diff --git a/INSTALL.WIN b/NOTES.WIN
similarity index 56%
rename from INSTALL.WIN
rename to NOTES.WIN
index 084388e..c204278 100644
--- a/INSTALL.WIN
+++ b/NOTES.WIN
@@ -1,29 +1,111 @@
 
- INSTALLATION ON WINDOWS PLATFORMS
- ---------------------------------
+ NOTES FOR THE WINDOWS PLATFORMS
+ ===============================
 
- [Instructions for building for Windows CE can be found in INSTALL.WCE]
+ [Notes for Windows CE can be found in INSTALL.WCE]
 
- Here are a few comments about building OpenSSL for Windows environments.
+ Requirement details for native (Visual C++) builds
+ --------------------------------------------------
 
- - you need Perl.  Unless you will build on Cygwin, you will need
-   ActiveState Perl, available from <A HREF="http://www.activestate.com/ActivePerl.">http://www.activestate.com/ActivePerl.</A>  
+ - You need Perl.  We recommend ActiveState Perl, available from
+   <A HREF="http://www.activestate.com/ActivePerl.">http://www.activestate.com/ActivePerl.</A>
    You also need the perl module Text::Template, available on CPAN.
    Please read README.PERL for more information.
 
- - one of the following C compilers:
+ - You need a C compiler.  OpenSSL has been tested to build with these:
 
-  * Visual C++
-  * GNU C (Cygwin or MinGW)
+   * Visual C++
 
-- Netwide Assembler, a.k.a. NASM, available from <A HREF="http://www.nasm.us,">http://www.nasm.us,</A>
-  is required if you intend to utilize assembler modules. Note that NASM
-  is now the only supported assembler. Without this the &quot;Configure&quot; step below
-  must be done with the &quot;no-asm&quot; option. The Microsoft provided assembler is NOT
-  supported.
+ - Netwide Assembler, a.k.a. NASM, available from <A HREF="http://www.nasm.us,">http://www.nasm.us,</A>
+   is required if you intend to utilize assembler modules. Note that NASM
+   is the only supported assembler. The Microsoft provided assembler is NOT
+   supported.
 
- Visual C++
- ----------
+
+ GNU C (Cygwin)
+ --------------
+
+ Cygwin implements a Posix/Unix runtime system (cygwin1.dll) on top of the
+ Windows subsystem and provides a bash shell and GNU tools environment.
+ Consequently, a make of OpenSSL with Cygwin is virtually identical to the
+ Unix procedure. It is also possible to create Windows binaries that only
+ use the Microsoft C runtime system (msvcrt.dll or crtdll.dll) using
+ MinGW. MinGW can be used in the Cygwin development environment or in a
+ standalone setup as described in the following section.
+
+ To build OpenSSL using Cygwin, you need to:
+
+ * Install Cygwin (see <A HREF="http://cygwin.com/">http://cygwin.com/</A>)
+
+ * Install Perl and ensure it is in the path. Both Cygwin perl
+   (5.6.1-2 or newer) and ActivePerl work.
+
+ * Run the Cygwin bash shell
+
+ Apart from that, follow the Unix instructions in INSTALL.
+
+ NOTE: &quot;make test&quot; and normal file operations may fail in directories
+ mounted as text (i.e. mount -t c:\somewhere /home) due to Cygwin
+ stripping of carriage returns. To avoid this ensure that a binary
+ mount is used, e.g. mount -b c:\somewhere /home.
+
+
+ GNU C (MinGW/MSYS)
+ -------------
+
+ * Compiler and shell environment installation:
+
+   MinGW and MSYS are available from <A HREF="http://www.mingw.org/,">http://www.mingw.org/,</A> both are
+   required. Run the installers and do whatever magic they say it takes
+   to start MSYS bash shell with GNU tools on its PATH.
+
+   Alternativelly, one can use MSYS2 from <A HREF="http://msys2.github.io/,">http://msys2.github.io/,</A>
+   which includes MingW (32-bit and 64-bit).
+
+ * It is also possible to cross-compile it on Linux by configuring
+   with './Configure --cross-compile-prefix=i386-mingw32- mingw ...'.
+   Other possible cross compile prefixes include x86_64-w64-mingw32-
+   and i686-w64-mingw32-.
+
+
+ Linking your application
+ ------------------------
+
+ If you link with static OpenSSL libraries then you're expected to
+ additionally link your application with WS2_32.LIB, ADVAPI32.LIB,
+ GDI32.LIB and USER32.LIB. Those developing non-interactive service
+ applications might feel concerned about linking with the latter two,
+ as they are justly associated with interactive desktop, which is not
+ available to service processes. The toolkit is designed to detect in
+ which context it's currently executed, GUI, console app or service,
+ and act accordingly, namely whether or not to actually make GUI calls.
+ Additionally those who wish to /DELAYLOAD:GDI32.DLL and /DELAYLOAD:USER32.DLL
+ and actually keep them off service process should consider
+ implementing and exporting from .exe image in question own
+ _OPENSSL_isservice not relying on USER32.DLL.
+ E.g., on Windows Vista and later you could:
+
+	__declspec(dllexport) __cdecl BOOL _OPENSSL_isservice(void)
+	{   DWORD sess;
+	    if (ProcessIdToSessionId(GetCurrentProcessId(),&amp;sess))
+	        return sess==0;
+	    return FALSE;
+	}
+
+ If you link with OpenSSL .DLLs, then you're expected to include into
+ your application code small &quot;shim&quot; snippet, which provides glue between
+ OpenSSL BIO layer and your compiler run-time. See the OPENSSL_Applink
+ manual page for further details.
+
+
+ &quot;Classic&quot; builds (Visual C++)
+ ----------------
+
+ [OpenSSL was classically built using a script called mk1mf.  This is
+  still available by configuring with --classic.  The notes below are
+  using this flag, and are tentative.  Use with care.
+
+  NOTE: this won't be available for long.]
 
  If you want to compile in the assembly language routines with Visual
  C++, then you will need the Netwide Assembler binary, nasmw.exe or nasm.exe, to
@@ -35,7 +117,7 @@
 
  For Win32:
 
- &gt; perl Configure VC-WIN32 --prefix=c:\some\openssl\dir
+ &gt; perl Configure VC-WIN32 --classic --prefix=c:\some\openssl\dir
  &gt; ms\do_nasm
 
  Note: replace the last line above with the following if not using the assembly
@@ -45,12 +127,12 @@
 
  For Win64/x64:
 
- &gt; perl Configure VC-WIN64A --prefix=c:\some\openssl\dir
+ &gt; perl Configure VC-WIN64A --classic --prefix=c:\some\openssl\dir
  &gt; ms\do_win64a
 
  For Win64/IA64:
 
- &gt; perl Configure VC-WIN64I --prefix=c:\some\openssl\dir
+ &gt; perl Configure VC-WIN64I --classic --prefix=c:\some\openssl\dir
  &gt; ms\do_win64i
 
  Where the prefix argument specifies where OpenSSL will be installed to.
@@ -84,109 +166,3 @@
 
  You can also build a static version of the library using the Makefile
  ms\nt.mak
-
- GNU C (Cygwin)
- --------------
-
- Cygwin implements a Posix/Unix runtime system (cygwin1.dll) on top of the
- Windows subsystem and provides a bash shell and GNU tools environment.
- Consequently, a make of OpenSSL with Cygwin is virtually identical to the
- Unix procedure. It is also possible to create Windows binaries that only
- use the Microsoft C runtime system (msvcrt.dll or crtdll.dll) using
- MinGW. MinGW can be used in the Cygwin development environment or in a
- standalone setup as described in the following section.
-
- To build OpenSSL using Cygwin:
-
- * Install Cygwin (see <A HREF="http://cygwin.com/">http://cygwin.com/</A>)
-
- * Install Perl and ensure it is in the path. Both Cygwin perl
-   (5.6.1-2 or newer) and ActivePerl work.
-
- * Run the Cygwin bash shell
-
- * $ tar zxvf openssl-x.x.x.tar.gz
-   $ cd openssl-x.x.x
-
-   To build the Cygwin version of OpenSSL:
-
-   $ ./config
-   [...]
-   $ make
-   [...]
-   $ make test
-   $ make install
-
-   This will create a default install in /usr/local/ssl.
-
-   To build the MinGW version (native Windows) in Cygwin:
-
-   $ ./Configure mingw
-   [...]
-   $ make
-   [...]
-   $ make test
-   $ make install
-
- Cygwin Notes:
-
- &quot;make test&quot; and normal file operations may fail in directories
- mounted as text (i.e. mount -t c:\somewhere /home) due to Cygwin
- stripping of carriage returns. To avoid this ensure that a binary
- mount is used, e.g. mount -b c:\somewhere /home.
-
- GNU C (MinGW/MSYS)
- -------------
-
- * Compiler and shell environment installation:
-
-   MinGW and MSYS are available from <A HREF="http://www.mingw.org/,">http://www.mingw.org/,</A> both are
-   required. Run the installers and do whatever magic they say it takes
-   to start MSYS bash shell with GNU tools on its PATH.
-
- * Compile OpenSSL:
-
-   $ ./config
-   [...]
-   $ make
-   [...]
-   $ make test
-
-   This will create the library and binaries in root source directory
-   and openssl.exe application in apps directory.
-
-   It is also possible to cross-compile it on Linux by configuring
-   with './Configure --cross-compile-prefix=i386-mingw32- mingw ...'. Other
-   possible targets include x86_64-w64-mingw32- and i686-w64-mingw32-.
-
-   libcrypto.a and libssl.a are the static libraries. To use the DLLs,
-   link with libcrypto32.a and libssl32.a instead.
-
- Linking your application
- ------------------------
-
- If you link with static OpenSSL libraries [those built with ms/nt.mak],
- then you're expected to additionally link your application with
- WS2_32.LIB, ADVAPI32.LIB, GDI32.LIB and USER32.LIB. Those developing
- non-interactive service applications might feel concerned about linking
- with the latter two, as they are justly associated with interactive
- desktop, which is not available to service processes. The toolkit is
- designed to detect in which context it's currently executed, GUI,
- console app or service, and act accordingly, namely whether or not to
- actually make GUI calls. Additionally those who wish to
- /DELAYLOAD:GDI32.DLL and /DELAYLOAD:USER32.DLL and actually keep them
- off service process should consider implementing and exporting from
- .exe image in question own _OPENSSL_isservice not relying on USER32.DLL.
- E.g., on Windows Vista and later you could:
-
-	__declspec(dllexport) __cdecl BOOL _OPENSSL_isservice(void)
-	{   DWORD sess;
-	    if (ProcessIdToSessionId(GetCurrentProcessId(),&amp;sess))
-	        return sess==0;
-	    return FALSE;
-	}
-
- If you link with OpenSSL .DLLs, then you're expected to include into
- your application code small &quot;shim&quot; snippet, which provides glue between
- OpenSSL BIO layer and your compiler run-time. See the OPENSSL_Applink
- manual page for further details.
diff --git a/appveyor.yml b/appveyor.yml
index dda4dba..6367c3d 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -15,28 +15,19 @@ before_build:
         If ($env:Platform -Match &quot;x86&quot;) {
             $env:VCVARS_PLATFORM=&quot;x86&quot;
             $env:TARGET=&quot;VC-WIN32&quot;
-            $env:DO=&quot;do_ms&quot;
         } Else {
             $env:VCVARS_PLATFORM=&quot;amd64&quot;
             $env:TARGET=&quot;VC-WIN64A&quot;
-            $env:DO=&quot;do_win64a&quot;
-        }
-    - ps: &gt;-
-        If ($env:Configuration -Like &quot;*shared*&quot;) {
-            $env:MAK=&quot;ntdll.mak&quot;
-        } Else {
-            $env:MAK=&quot;nt.mak&quot;
         }
     - ps: $env:VSCOMNTOOLS=(Get-Content (&quot;env:VS&quot; + &quot;$env:VSVER&quot; + &quot;0COMNTOOLS&quot;))
     - call &quot;%VSCOMNTOOLS%\..\..\VC\vcvarsall.bat&quot; %VCVARS_PLATFORM%
     - perl Configure %TARGET% no-asm
-    - call ms\%DO%
 
 build_script:
-    - nmake /f ms\%MAK%
+    - nmake
 
 test_script:
-    - nmake /f ms\%MAK% test
+    - nmake test
 
 notifications:
     - provider: Email
diff --git a/build.info b/build.info
index f56b531..1a201c3 100644
--- a/build.info
+++ b/build.info
@@ -12,6 +12,9 @@ IF[{- $config{target} =~ /^Cygwin/ -}]
 ELSIF[{- $config{target} =~ /^mingw/ -}]
  SHARED_NAME[libcrypto]=libcrypto-{- $config{shlib_major}.&quot;_&quot;.$config{shlib_minor} -}{- $config{target} eq &quot;mingw64&quot; ? &quot;-x64&quot; : &quot;&quot; -}
  SHARED_NAME[libssl]=libssl-{- $config{shlib_major}.&quot;_&quot;.$config{shlib_minor} -}{- $config{target} eq &quot;mingw64&quot; ? &quot;-x64&quot; : &quot;&quot; -}
+ELSIF[{- $config{target} =~ /^VC-/ -}]
+ SHARED_NAME[libcrypto]=libcrypto-{- $config{shlib_major}.&quot;_&quot;.$config{shlib_minor} -}{- $config{target} =~ /^VC-WIN64/ ? &quot;-x64&quot; : &quot;&quot; -}
+ SHARED_NAME[libssl]=libssl-{- $config{shlib_major}.&quot;_&quot;.$config{shlib_minor} -}{- $config{target} =~ /^VC-WIN64/ ? &quot;-x64&quot; : &quot;&quot; -}
 ENDIF
 
 # VMS has a cultural standard where all libraries are prefixed.
diff --git a/test/recipes/70-test_sslcertstatus.t b/test/recipes/70-test_sslcertstatus.t
index ffcb279..216804c 100755
--- a/test/recipes/70-test_sslcertstatus.t
+++ b/test/recipes/70-test_sslcertstatus.t
@@ -61,7 +61,7 @@ my $test_name = &quot;test_sslcertstatus&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
diff --git a/test/recipes/70-test_sslextension.t b/test/recipes/70-test_sslextension.t
index 93bb6fe..f9a6573 100755
--- a/test/recipes/70-test_sslextension.t
+++ b/test/recipes/70-test_sslextension.t
@@ -61,7 +61,7 @@ my $test_name = &quot;test_sslextension&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
diff --git a/test/recipes/70-test_sslsessiontick.t b/test/recipes/70-test_sslsessiontick.t
index 16ef4ea..f13c7ba 100755
--- a/test/recipes/70-test_sslsessiontick.t
+++ b/test/recipes/70-test_sslsessiontick.t
@@ -62,7 +62,7 @@ my $test_name = &quot;test_sslsessiontick&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
diff --git a/test/recipes/70-test_sslskewith0p.t b/test/recipes/70-test_sslskewith0p.t
index 850820d..90fcf30 100755
--- a/test/recipes/70-test_sslskewith0p.t
+++ b/test/recipes/70-test_sslskewith0p.t
@@ -61,7 +61,7 @@ my $test_name = &quot;test_sslskewith0p&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
diff --git a/test/recipes/70-test_sslvertol.t b/test/recipes/70-test_sslvertol.t
index 02c9a3b..a35eab9 100755
--- a/test/recipes/70-test_sslvertol.t
+++ b/test/recipes/70-test_sslvertol.t
@@ -61,7 +61,7 @@ my $test_name = &quot;test_sslextension&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
diff --git a/test/recipes/70-test_tlsextms.t b/test/recipes/70-test_tlsextms.t
index 55e3d75..06b4d9e 100644
--- a/test/recipes/70-test_tlsextms.t
+++ b/test/recipes/70-test_tlsextms.t
@@ -62,7 +62,7 @@ my $test_name = &quot;test_tlsextms&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
diff --git a/test/recipes/90-test_networking.t b/test/recipes/90-test_networking.t
index 84d616d..16ece75 100644
--- a/test/recipes/90-test_networking.t
+++ b/test/recipes/90-test_networking.t
@@ -61,7 +61,7 @@ my $test_name = &quot;test_networking&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;TLSProxy isn't usable on $^O&quot;
-    if $^O =~ /^VMS$/;
+    if $^O =~ /^(VMS|MSWin32)$/;
 
 plan skip_all =&gt; &quot;$test_name needs the dynamic engine feature enabled&quot;
     if disabled(&quot;engine&quot;) || disabled(&quot;dynamic-engine&quot;);
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005248.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="005253.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5249">[ date ]</a>
              <a href="thread.html#5249">[ thread ]</a>
              <a href="subject.html#5249">[ subject ]</a>
              <a href="author.html#5249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
