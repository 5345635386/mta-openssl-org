<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1430430536.424282.19612.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000986.html">
   <LINK REL="Next"  HREF="000988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1430430536.424282.19612.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Thu Apr 30 21:48:56 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000986.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="000988.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#987">[ date ]</a>
              <a href="thread.html#987">[ thread ]</a>
              <a href="subject.html#987">[ subject ]</a>
              <a href="author.html#987">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  68dc682499ea3fe27d909c946d7abd39062d6efd (commit)
      from  222561fe8ef510f336417a666f69f81ddc9b8fe4 (commit)


- Log -----------------------------------------------------------------
commit 68dc682499ea3fe27d909c946d7abd39062d6efd
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
Date:   Thu Apr 30 17:48:31 2015 -0400

    In apps, malloc or die
    
    No point in proceeding if you're out of memory.  So change
    *all* OPENSSL_malloc calls in apps to use the new routine which
    prints a message and exits.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 apps/apps.c          | 36 +++++++++++++++--------------
 apps/apps.h          |  1 +
 apps/ca.c            | 64 +++++++++++-----------------------------------------
 apps/cms.c           |  6 +----
 apps/dgst.c          | 11 ++-------
 apps/dhparam.c       |  6 +----
 apps/dsaparam.c      | 13 +++--------
 apps/ecparam.c       | 20 ++++------------
 apps/enc.c           |  9 ++------
 apps/engine.c        | 10 +++-----
 apps/openssl.c       |  4 +---
 apps/passwd.c        | 17 ++++----------
 apps/pkeyutl.c       | 11 ++++-----
 apps/rsa.c           | 17 +++++---------
 apps/rsautl.c        |  8 ++-----
 apps/s_cb.c          | 26 ++++-----------------
 apps/s_client.c      | 43 +++++++++++++++--------------------
 apps/s_server.c      | 62 ++++++++++++++++++--------------------------------
 apps/s_socket.c      |  6 +----
 apps/speed.c         | 22 ++++--------------
 apps/srp.c           | 21 +++--------------
 apps/ts.c            |  8 ++-----
 apps/vms_decc_init.c |  2 +-
 apps/x509.c          | 13 ++---------
 24 files changed, 126 insertions(+), 310 deletions(-)

diff --git a/apps/apps.c b/apps/apps.c
index 9475fe3..f74b968 100644
--- a/apps/apps.c
+++ b/apps/apps.c
@@ -180,7 +180,7 @@ int chopup_args(ARGS *arg, char *buf)
     arg-&gt;argc = 0;
     if (arg-&gt;size == 0) {
         arg-&gt;size = 20;
-        arg-&gt;argv = OPENSSL_malloc(sizeof(char *) * arg-&gt;size);
+        arg-&gt;argv = app_malloc(sizeof(char *) * arg-&gt;size, &quot;argv space&quot;);
         if (arg-&gt;argv == NULL)
             return 0;
     }
@@ -367,13 +367,7 @@ int password_callback(char *buf, int bufsiz, int verify, PW_CB_DATA *cb_tmp)
             ok = UI_add_input_string(ui, prompt, ui_flags, buf,
                                      PW_MIN_LENGTH, bufsiz - 1);
         if (ok &gt;= 0 &amp;&amp; verify) {
-            buff = OPENSSL_malloc(bufsiz);
-            if (!buff) {
-                BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-                UI_free(ui);
-                OPENSSL_free(prompt);
-                return 0;
-            }
+            buff = app_malloc(bufsiz, &quot;password buffer&quot;);
             ok = UI_add_verify_string(ui, prompt, ui_flags, buff,
                                       PW_MIN_LENGTH, bufsiz - 1, buf);
         }
@@ -989,6 +983,21 @@ static int load_certs_crls(const char *file, int format,
     return rv;
 }
 
+void* app_malloc(int sz, const char *what)
+{
+    void *vp = OPENSSL_malloc(sz);
+
+    if (vp == NULL) {
+        BIO_printf(bio_err, &quot;%s: Could not allocate %d bytes for %s\n&quot;,
+                opt_getprog(), sz, what);
+        ERR_print_errors(bio_err);
+        exit(1);
+    }
+    return vp;
+}
+
+
+
 STACK_OF(X509) *load_certs(const char *file, int format,
                            const char *pass, ENGINE *e, const char *desc)
 {
@@ -1585,11 +1594,7 @@ CA_DB *load_index(char *dbfile, DB_ATTR *db_attr)
         }
     }
 
-    if ((retdb = OPENSSL_malloc(sizeof(CA_DB))) == NULL) {
-        fprintf(stderr, &quot;Out of memory\n&quot;);
-        goto err;
-    }
-
+    retdb = app_malloc(sizeof *retdb, &quot;new DB&quot;);
     retdb-&gt;db = tmpdb;
     tmpdb = NULL;
     if (db_attr)
@@ -2230,10 +2235,7 @@ unsigned char *next_protos_parse(unsigned short *outlen, const char *in)
     if (len &gt;= 65535)
         return NULL;
 
-    out = OPENSSL_malloc(strlen(in) + 1);
-    if (!out)
-        return NULL;
-
+    out = app_malloc(strlen(in) + 1, &quot;NPN buffer&quot;);
     for (i = 0; i &lt;= len; ++i) {
         if (i == len || in[i] == ',') {
             if (i - start &gt; 255) {
diff --git a/apps/apps.h b/apps/apps.h
index 5b24233..e55dcd6 100644
--- a/apps/apps.h
+++ b/apps/apps.h
@@ -469,6 +469,7 @@ typedef struct ca_db_st {
     TXT_DB *db;
 } CA_DB;
 
+void* app_malloc(int sz, const char *what);
 BIGNUM *load_serial(char *serialfile, int create, ASN1_INTEGER **retai);
 int save_serial(char *serialfile, char *suffix, BIGNUM *serial,
                 ASN1_INTEGER **retai);
diff --git a/apps/ca.c b/apps/ca.c
index a3e0bda..bc7c3fd 100644
--- a/apps/ca.c
+++ b/apps/ca.c
@@ -491,21 +491,11 @@ end_of_options:
         const char *s = X509_get_default_cert_area();
         size_t len;
 
+        len = strlen(s) + 1 + sizeof(CONFIG_FILE);
+        tofree = app_malloc(len, &quot;config filename&quot;);
 #ifdef OPENSSL_SYS_VMS
-        len = strlen(s) + sizeof(CONFIG_FILE);
-        tofree = OPENSSL_malloc(len);
-        if (!tofree) {
-            BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-            goto end;
-        }
         strcpy(tofree, s);
 #else
-        len = strlen(s) + sizeof(CONFIG_FILE) + 1;
-        tofree = OPENSSL_malloc(len);
-        if (!tofree) {
-            BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-            goto end;
-        }
         BUF_strlcpy(tofree, s, len);
         BUF_strlcat(tofree, &quot;/&quot;, len);
 #endif
@@ -1975,17 +1965,17 @@ static int do_body(X509 **xret, EVP_PKEY *pkey, X509 *x509,
         goto end;
 
     /* We now just add it to the database */
-    row[DB_type] = OPENSSL_malloc(2);
+    row[DB_type] = app_malloc(2, &quot;row db type&quot;);
 
     tm = X509_get_notAfter(ret);
-    row[DB_exp_date] = OPENSSL_malloc(tm-&gt;length + 1);
+    row[DB_exp_date] = app_malloc(tm-&gt;length + 1, &quot;row expdate&quot;);
     memcpy(row[DB_exp_date], tm-&gt;data, tm-&gt;length);
     row[DB_exp_date][tm-&gt;length] = '\0';
 
     row[DB_rev_date] = NULL;
 
     /* row[DB_serial] done already */
-    row[DB_file] = OPENSSL_malloc(8);
+    row[DB_file] = app_malloc(8, &quot;row file&quot;);
     row[DB_name] = X509_NAME_oneline(X509_get_subject_name(ret), NULL, 0);
 
     if ((row[DB_type] == NULL) || (row[DB_exp_date] == NULL) ||
@@ -1997,11 +1987,7 @@ static int do_body(X509 **xret, EVP_PKEY *pkey, X509 *x509,
     row[DB_type][0] = 'V';
     row[DB_type][1] = '\0';
 
-    if ((irow = OPENSSL_malloc(sizeof(char *) * (DB_NUMBER + 1))) == NULL) {
-        BIO_printf(bio_err, &quot;Memory allocation failure\n&quot;);
-        goto end;
-    }
-
+    irow = app_malloc(sizeof(char *) * (DB_NUMBER + 1), &quot;row space&quot;);
     for (i = 0; i &lt; DB_NUMBER; i++) {
         irow[i] = row[i];
         row[i] = NULL;
@@ -2223,34 +2209,25 @@ static int do_revoke(X509 *x509, CA_DB *db, int type, char *value)
                    row[DB_serial], row[DB_name]);
 
         /* We now just add it to the database */
-        row[DB_type] = OPENSSL_malloc(2);
+        row[DB_type] = app_malloc(2, &quot;row type&quot;);
 
         tm = X509_get_notAfter(x509);
-        row[DB_exp_date] = OPENSSL_malloc(tm-&gt;length + 1);
+        row[DB_exp_date] = app_malloc(tm-&gt;length + 1, &quot;row exp_data&quot;);
         memcpy(row[DB_exp_date], tm-&gt;data, tm-&gt;length);
         row[DB_exp_date][tm-&gt;length] = '\0';
 
         row[DB_rev_date] = NULL;
 
         /* row[DB_serial] done already */
-        row[DB_file] = OPENSSL_malloc(8);
+        row[DB_file] = app_malloc(8, &quot;row filename&quot;);
 
         /* row[DB_name] done already */
 
-        if ((row[DB_type] == NULL) || (row[DB_exp_date] == NULL) ||
-            (row[DB_file] == NULL)) {
-            BIO_printf(bio_err, &quot;Memory allocation failure\n&quot;);
-            goto end;
-        }
         BUF_strlcpy(row[DB_file], &quot;unknown&quot;, 8);
         row[DB_type][0] = 'V';
         row[DB_type][1] = '\0';
 
-        if ((irow = OPENSSL_malloc(sizeof(char *) * (DB_NUMBER + 1))) == NULL) {
-            BIO_printf(bio_err, &quot;Memory allocation failure\n&quot;);
-            goto end;
-        }
-
+        irow = app_malloc(sizeof(char *) * (DB_NUMBER + 1), &quot;row ptr&quot;);
         for (i = 0; i &lt; DB_NUMBER; i++) {
             irow[i] = row[i];
             row[i] = NULL;
@@ -2312,11 +2289,7 @@ static int get_certificate_status(const char *serial, CA_DB *db)
         row[i] = NULL;
 
     /* Malloc needed char spaces */
-    row[DB_serial] = OPENSSL_malloc(strlen(serial) + 2);
-    if (row[DB_serial] == NULL) {
-        BIO_printf(bio_err, &quot;Malloc failure\n&quot;);
-        goto end;
-    }
+    row[DB_serial] = app_malloc(strlen(serial) + 2, &quot;row serial#&quot;);
 
     if (strlen(serial) % 2) {
         /*
@@ -2385,11 +2358,7 @@ static int do_updatedb(CA_DB *db)
 
     /* get actual time and make a string */
     a_tm = X509_gmtime_adj(a_tm, 0);
-    a_tm_s = OPENSSL_malloc(a_tm-&gt;length + 1);
-    if (a_tm_s == NULL) {
-        cnt = -1;
-        goto end;
-    }
+    a_tm_s = (char *)OPENSSL_malloc(a_tm-&gt;length + 1);
 
     memcpy(a_tm_s, a_tm-&gt;data, a_tm-&gt;length);
     a_tm_s[a_tm-&gt;length] = '\0';
@@ -2429,11 +2398,8 @@ static int do_updatedb(CA_DB *db)
         }
     }
 
- end:
-
     ASN1_UTCTIME_free(a_tm);
     OPENSSL_free(a_tm_s);
-
     return (cnt);
 }
 
@@ -2533,11 +2499,7 @@ char *make_revocation_str(int rev_type, char *rev_arg)
     if (other)
         i += strlen(other) + 1;
 
-    str = OPENSSL_malloc(i);
-
-    if (!str)
-        return NULL;
-
+    str = app_malloc(i, &quot;revocation reason&quot;);
     BUF_strlcpy(str, (char *)revtm-&gt;data, i);
     if (reason) {
         BUF_strlcat(str, &quot;,&quot;, i);
diff --git a/apps/cms.c b/apps/cms.c
index 16dbc0c..907b108 100644
--- a/apps/cms.c
+++ b/apps/cms.c
@@ -570,11 +570,7 @@ int cms_main(int argc, char **argv)
             }
             if (key_param == NULL || key_param-&gt;idx != keyidx) {
                 cms_key_param *nparam;
-                nparam = OPENSSL_malloc(sizeof(cms_key_param));
-                if (!nparam) {
-                    BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-                    goto end;
-                }
+                nparam = app_malloc(sizeof *nparam, &quot;key param buffer&quot;);
                 nparam-&gt;idx = keyidx;
                 if ((nparam-&gt;param = sk_OPENSSL_STRING_new_null()) == NULL)
                     goto end;
diff --git a/apps/dgst.c b/apps/dgst.c
index 106e939..3ff4750 100644
--- a/apps/dgst.c
+++ b/apps/dgst.c
@@ -139,10 +139,7 @@ int dgst_main(int argc, char **argv)
     int engine_impl = 0;
 
     prog = opt_progname(argv[0]);
-    if ((buf = OPENSSL_malloc(BUFSIZE)) == NULL) {
-        BIO_printf(bio_err, &quot;%s: out of memory\n&quot;, prog);
-        goto end;
-    }
+    buf = app_malloc(BUFSIZE, &quot;I/O buffer&quot;);
     md = EVP_get_digestbyname(prog);
 
     prog = opt_init(argc, argv, dgst_options);
@@ -394,11 +391,7 @@ int dgst_main(int argc, char **argv)
             goto end;
         }
         siglen = EVP_PKEY_size(sigkey);
-        sigbuf = OPENSSL_malloc(siglen);
-        if (!sigbuf) {
-            BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-            goto end;
-        }
+        sigbuf = app_malloc(siglen, &quot;signature buffer&quot;);
         siglen = BIO_read(sigbio, sigbuf, siglen);
         BIO_free(sigbio);
         if (siglen &lt;= 0) {
diff --git a/apps/dhparam.c b/apps/dhparam.c
index e7fa7ae..c66c591 100644
--- a/apps/dhparam.c
+++ b/apps/dhparam.c
@@ -379,11 +379,7 @@ int dhparam_main(int argc, char **argv)
 
         len = BN_num_bytes(dh-&gt;p);
         bits = BN_num_bits(dh-&gt;p);
-        data = OPENSSL_malloc(len);
-        if (data == NULL) {
-            perror(&quot;OPENSSL_malloc&quot;);
-            goto end;
-        }
+        data = app_malloc(len, &quot;print a BN&quot;);
         BIO_printf(out, &quot;#ifndef HEADER_DH_H\n&quot;
                         &quot;# include &lt;openssl/dh.h&gt;\n&quot;
                         &quot;#endif\n&quot;
diff --git a/apps/dsaparam.c b/apps/dsaparam.c
index 5aa6e2c..afc8a82 100644
--- a/apps/dsaparam.c
+++ b/apps/dsaparam.c
@@ -268,16 +268,9 @@ int dsaparam_main(int argc, char **argv)
     }
 
     if (C) {
-        unsigned char *data;
-        int len, bits_p;
-
-        len = BN_num_bytes(dsa-&gt;p);
-        bits_p = BN_num_bits(dsa-&gt;p);
-        data = OPENSSL_malloc(len + 20);
-        if (data == NULL) {
-            perror(&quot;OPENSSL_malloc&quot;);
-            goto end;
-        }
+        int len = BN_num_bytes(dsa-&gt;p);
+        int bits_p = BN_num_bits(dsa-&gt;p);
+        unsigned char *data = app_malloc(len + 20, &quot;BN space&quot;);
 
         BIO_printf(bio_out, &quot;DSA *get_dsa%d()\n{\n&quot;, bits_p);
         print_bignum_var(bio_out, dsa-&gt;p, &quot;dsap&quot;, len, data);
diff --git a/apps/ecparam.c b/apps/ecparam.c
index f316793..5b39e83 100644
--- a/apps/ecparam.c
+++ b/apps/ecparam.c
@@ -229,16 +229,10 @@ int ecparam_main(int argc, char **argv)
 
     if (list_curves) {
         EC_builtin_curve *curves = NULL;
-        size_t crv_len = 0;
-        size_t n = 0;
-
-        crv_len = EC_get_builtin_curves(NULL, 0);
-
-        curves = OPENSSL_malloc((int)(sizeof(EC_builtin_curve) * crv_len));
-
-        if (curves == NULL)
-            goto end;
+        size_t crv_len = EC_get_builtin_curves(NULL, 0);
+        size_t n;
 
+        curves = app_malloc((int)(sizeof *curves * crv_len), &quot;list curves&quot;);
         if (!EC_get_builtin_curves(curves, crv_len)) {
             OPENSSL_free(curves);
             goto end;
@@ -346,7 +340,7 @@ int ecparam_main(int argc, char **argv)
                 || (ec_gen = BN_new()) == NULL
                 || (ec_order = BN_new()) == NULL
                 || (ec_cofactor = BN_new()) == NULL) {
-            perror(&quot;OPENSSL_malloc&quot;);
+            perror(&quot;Can't allocate BN&quot;);
             goto end;
         }
 
@@ -388,11 +382,7 @@ int ecparam_main(int argc, char **argv)
         if ((tmp_len = (size_t)BN_num_bytes(ec_cofactor)) &gt; buf_len)
             buf_len = tmp_len;
 
-        buffer = OPENSSL_malloc(buf_len);
-        if (buffer == NULL) {
-            perror(&quot;OPENSSL_malloc&quot;);
-            goto end;
-        }
+        buffer = app_malloc(buf_len, &quot;BN buffer&quot;);
 
         BIO_printf(out, &quot;EC_GROUP *get_ec_group_%d(void)\n{\n&quot;, len);
         print_bignum_var(out, ec_p, &quot;ec_p&quot;, len, buffer);
diff --git a/apps/enc.c b/apps/enc.c
index c6b8d2b..83067b8 100644
--- a/apps/enc.c
+++ b/apps/enc.c
@@ -313,13 +313,8 @@ int enc_main(int argc, char **argv)
     if (verbose)
         BIO_printf(bio_err, &quot;bufsize=%d\n&quot;, bsize);
 
-    strbuf = OPENSSL_malloc(SIZE);
-    buff = OPENSSL_malloc(EVP_ENCODE_LENGTH(bsize));
-    if ((buff == NULL) || (strbuf == NULL)) {
-        BIO_printf(bio_err, &quot;OPENSSL_malloc failure %ld\n&quot;,
-                   (long)EVP_ENCODE_LENGTH(bsize));
-        goto end;
-    }
+    strbuf = app_malloc(SIZE, &quot;strbuf&quot;);
+    buff = app_malloc(EVP_ENCODE_LENGTH(bsize), &quot;evp buffer&quot;);
 
     if (debug) {
         BIO_set_callback(in, BIO_debug_callback);
diff --git a/apps/engine.c b/apps/engine.c
index 7dcc1b0..448802b 100644
--- a/apps/engine.c
+++ b/apps/engine.c
@@ -98,9 +98,7 @@ static int append_buf(char **buf, const char *s, int *size, int step)
 
     if (*buf == NULL) {
         *size = step;
-        *buf = OPENSSL_malloc(*size);
-        if (*buf == NULL)
-            return 0;
+        *buf = app_malloc(*size, &quot;engine buffer&quot;);
         **buf = '\0';
     }
 
@@ -211,8 +209,7 @@ static int util_verbose(ENGINE *e, int verbose, BIO *out, const char *indent)
             if ((len = ENGINE_ctrl(e, ENGINE_CTRL_GET_NAME_LEN_FROM_CMD, num,
                                    NULL, NULL)) &lt;= 0)
                 goto err;
-            if ((name = OPENSSL_malloc(len + 1)) == NULL)
-                goto err;
+            name = app_malloc(len + 1, &quot;name buffer&quot;);
             if (ENGINE_ctrl(e, ENGINE_CTRL_GET_NAME_FROM_CMD, num, name,
                             NULL) &lt;= 0)
                 goto err;
@@ -221,8 +218,7 @@ static int util_verbose(ENGINE *e, int verbose, BIO *out, const char *indent)
                                    NULL, NULL)) &lt; 0)
                 goto err;
             if (len &gt; 0) {
-                if ((desc = OPENSSL_malloc(len + 1)) == NULL)
-                    goto err;
+                desc = app_malloc(len + 1, &quot;description buffer&quot;);
                 if (ENGINE_ctrl(e, ENGINE_CTRL_GET_DESC_FROM_CMD, num, desc,
                                 NULL) &lt;= 0)
                     goto err;
diff --git a/apps/openssl.c b/apps/openssl.c
index 786f5d3..f6013f7 100644
--- a/apps/openssl.c
+++ b/apps/openssl.c
@@ -204,9 +204,7 @@ static char *make_config_name()
     char *p;
 
     len = strlen(t) + strlen(OPENSSL_CONF) + 2;
-    p = OPENSSL_malloc(len);
-    if (p == NULL)
-        return NULL;
+    p = app_malloc(len, &quot;config filename buffer&quot;);
     BUF_strlcpy(p, t, len);
 #ifndef OPENSSL_SYS_VMS
     BUF_strlcat(p, &quot;/&quot;, len);
diff --git a/apps/passwd.c b/apps/passwd.c
index 3c6fd52..c529792 100644
--- a/apps/passwd.c
+++ b/apps/passwd.c
@@ -221,12 +221,9 @@ int passwd_main(int argc, char **argv)
         /* no passwords on the command line */
 
         passwd_malloc_size = pw_maxlen + 2;
-        /*
-         * longer than necessary so that we can warn about truncation
-         */
-        passwd = passwd_malloc = OPENSSL_malloc(passwd_malloc_size);
-        if (passwd_malloc == NULL)
-            goto end;
+        /* longer than necessary so that we can warn about truncation */
+        passwd = passwd_malloc =
+            app_malloc(passwd_malloc_size, &quot;password buffer&quot;);
     }
 
     if ((in == NULL) &amp;&amp; (passwds == NULL)) {
@@ -426,9 +423,7 @@ static int do_passwd(int passed_salt, char **salt_p, char **salt_malloc_p,
 # ifndef OPENSSL_NO_DES
         if (usecrypt) {
             if (*salt_malloc_p == NULL) {
-                *salt_p = *salt_malloc_p = OPENSSL_malloc(3);
-                if (*salt_malloc_p == NULL)
-                    goto end;
+                *salt_p = *salt_malloc_p = app_malloc(3, &quot;salt buffer&quot;);
             }
             if (RAND_bytes((unsigned char *)*salt_p, 2) &lt;= 0)
                 goto end;
@@ -447,9 +442,7 @@ static int do_passwd(int passed_salt, char **salt_p, char **salt_malloc_p,
             int i;
 
             if (*salt_malloc_p == NULL) {
-                *salt_p = *salt_malloc_p = OPENSSL_malloc(9);
-                if (*salt_malloc_p == NULL)
-                    goto end;
+                *salt_p = *salt_malloc_p = app_malloc(9, &quot;salt buffer&quot;);
             }
             if (RAND_bytes((unsigned char *)*salt_p, 8) &lt;= 0)
                 goto end;
diff --git a/apps/pkeyutl.c b/apps/pkeyutl.c
index da7dc2e..3afe0eb 100644
--- a/apps/pkeyutl.c
+++ b/apps/pkeyutl.c
@@ -299,13 +299,10 @@ int pkeyutl_main(int argc, char **argv)
     rv = do_keyop(ctx, pkey_op, NULL, (size_t *)&amp;buf_outlen,
                   buf_in, (size_t)buf_inlen);
     if (rv &gt; 0) {
-        buf_out = OPENSSL_malloc(buf_outlen);
-        if (!buf_out)
-            rv = -1;
-        else
-            rv = do_keyop(ctx, pkey_op,
-                          buf_out, (size_t *)&amp;buf_outlen,
-                          buf_in, (size_t)buf_inlen);
+        buf_out = app_malloc(buf_outlen, &quot;buffer output&quot;);
+        rv = do_keyop(ctx, pkey_op,
+                      buf_out, (size_t *)&amp;buf_outlen,
+                      buf_in, (size_t)buf_inlen);
     }
     if (rv &lt;= 0) {
         ERR_print_errors(bio_err);
diff --git a/apps/rsa.c b/apps/rsa.c
index c8b05e6..0a8e198 100644
--- a/apps/rsa.c
+++ b/apps/rsa.c
@@ -344,19 +344,14 @@ int rsa_main(int argc, char **argv)
     }
 # ifndef OPENSSL_NO_RC4
     else if (outformat == FORMAT_NETSCAPE) {
-        unsigned char *p, *pp;
-        int size;
+        unsigned char *p, *save;
+        int size = i2d_RSA_NET(rsa, NULL, NULL, 0);
 
-        i = 1;
-        size = i2d_RSA_NET(rsa, NULL, NULL, 0);
-        if ((p = OPENSSL_malloc(size)) == NULL) {
-            BIO_printf(bio_err, &quot;Memory allocation failure\n&quot;);
-            goto end;
-        }
-        pp = p;
+        save = p = app_malloc(size, &quot;RSA i2d buffer&quot;);
         i2d_RSA_NET(rsa, &amp;p, NULL, 0);
-        BIO_write(out, (char *)pp, size);
-        OPENSSL_free(pp);
+        BIO_write(out, (char *)save, size);
+        OPENSSL_free(save);
+        i = 1;
     }
 # endif
     else if (outformat == FORMAT_PEM) {
diff --git a/apps/rsautl.c b/apps/rsautl.c
index 67cb76e..f138293 100644
--- a/apps/rsautl.c
+++ b/apps/rsautl.c
@@ -257,12 +257,8 @@ int rsautl_main(int argc, char **argv)
 
     keysize = RSA_size(rsa);
 
-    rsa_in = OPENSSL_malloc(keysize * 2);
-    rsa_out = OPENSSL_malloc(keysize);
-    if (!rsa_in || !rsa_out) {
-        BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-        goto end;
-    }
+    rsa_in = app_malloc(keysize * 2, &quot;hold rsa key&quot;);
+    rsa_out = app_malloc(keysize, &quot;output rsa key&quot;);
 
     /* Read the input data */
     rsa_inlen = BIO_read(in, rsa_in, keysize * 2);
diff --git a/apps/s_cb.c b/apps/s_cb.c
index 1d026b6..1f2d371 100644
--- a/apps/s_cb.c
+++ b/apps/s_cb.c
@@ -439,11 +439,7 @@ int ssl_print_curves(BIO *out, SSL *s, int noshared)
     ncurves = SSL_get1_curves(s, NULL);
     if (ncurves &lt;= 0)
         return 1;
-    curves = OPENSSL_malloc(ncurves * sizeof(int));
-    if (!curves) {
-        BIO_printf(out, &quot;Out of memory\n&quot;);
-        return 0;
-    }
+    curves = app_malloc(ncurves * sizeof(int), &quot;curves to print&quot;);
     SSL_get1_curves(s, curves);
 
     BIO_puts(out, &quot;Supported Elliptic Curves: &quot;);
@@ -955,12 +951,7 @@ int generate_cookie_callback(SSL *ssl, unsigned char *cookie,
         OPENSSL_assert(0);
         break;
     }
-    buffer = OPENSSL_malloc(length);
-
-    if (buffer == NULL) {
-        BIO_printf(bio_err, &quot;out of memory\n&quot;);
-        return 0;
-    }
+    buffer = app_malloc(length, &quot;cookie generate buffer&quot;);
 
     switch (peer.sa.sa_family) {
     case AF_INET:
@@ -1028,12 +1019,7 @@ int verify_cookie_callback(SSL *ssl, unsigned char *cookie,
         OPENSSL_assert(0);
         break;
     }
-    buffer = OPENSSL_malloc(length);
-
-    if (buffer == NULL) {
-        BIO_printf(bio_err, &quot;out of memory\n&quot;);
-        return 0;
-    }
+    buffer = app_malloc(length, &quot;cookie verify buffer&quot;);
 
     switch (peer.sa.sa_family) {
     case AF_INET:
@@ -1187,10 +1173,8 @@ void ssl_ctx_set_excert(SSL_CTX *ctx, SSL_EXCERT *exc)
 
 static int ssl_excert_prepend(SSL_EXCERT **pexc)
 {
-    SSL_EXCERT *exc;
-    exc = OPENSSL_malloc(sizeof(SSL_EXCERT));
-    if (!exc)
-        return 0;
+    SSL_EXCERT *exc = app_malloc(sizeof *exc, &quot;prepend cert&quot;);
+
     exc-&gt;certfile = NULL;
     exc-&gt;keyfile = NULL;
     exc-&gt;chainfile = NULL;
diff --git a/apps/s_client.c b/apps/s_client.c
index fdd1f5c..344c88c 100644
--- a/apps/s_client.c
+++ b/apps/s_client.c
@@ -385,14 +385,10 @@ static int ssl_srp_verify_param_cb(SSL *s, void *arg)
 static char *ssl_give_srp_client_pwd_cb(SSL *s, void *arg)
 {
     SRP_ARG *srp_arg = (SRP_ARG *)arg;
-    char *pass = OPENSSL_malloc(PWD_STRLEN + 1);
+    char *pass = app_malloc(PWD_STRLEN + 1, &quot;SRP password buffer&quot;);
     PW_CB_DATA cb_tmp;
     int l;
 
-    if (!pass) {
-        BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-        return NULL;
-    }
     cb_tmp.password = (char *)srp_arg-&gt;srppassin;
     cb_tmp.prompt_info = &quot;SRP user&quot;;
     if ((l = password_callback(pass, PWD_STRLEN, 0, &amp;cb_tmp)) &lt; 0) {
@@ -712,13 +708,12 @@ int s_client_main(int argc, char **argv)
     verify_depth = 0;
     verify_error = X509_V_OK;
     vpm = X509_VERIFY_PARAM_new();
-    cbuf = OPENSSL_malloc(BUFSIZZ);
-    sbuf = OPENSSL_malloc(BUFSIZZ);
-    mbuf = OPENSSL_malloc(BUFSIZZ);
+    cbuf = app_malloc(BUFSIZZ, &quot;cbuf&quot;);
+    sbuf = app_malloc(BUFSIZZ, &quot;sbuf&quot;);
+    mbuf = app_malloc(BUFSIZZ, &quot;mbuf&quot;);
     cctx = SSL_CONF_CTX_new();
 
-    if (vpm == NULL || cctx == NULL
-        || cbuf == NULL || sbuf == NULL || mbuf == NULL) {
+    if (vpm == NULL || cctx == NULL) {
         BIO_printf(bio_err, &quot;%s: out of memory\n&quot;, prog);
         goto end;
     }
@@ -2176,22 +2171,20 @@ static void print_stuff(BIO *bio, SSL *s, int full)
         BIO_printf(bio, &quot;Keying material exporter:\n&quot;);
         BIO_printf(bio, &quot;    Label: '%s'\n&quot;, keymatexportlabel);
         BIO_printf(bio, &quot;    Length: %i bytes\n&quot;, keymatexportlen);
-        exportedkeymat = OPENSSL_malloc(keymatexportlen);
-        if (exportedkeymat != NULL) {
-            if (!SSL_export_keying_material(s, exportedkeymat,
-                                            keymatexportlen,
-                                            keymatexportlabel,
-                                            strlen(keymatexportlabel),
-                                            NULL, 0, 0)) {
-                BIO_printf(bio, &quot;    Error\n&quot;);
-            } else {
-                BIO_printf(bio, &quot;    Keying material: &quot;);
-                for (i = 0; i &lt; keymatexportlen; i++)
-                    BIO_printf(bio, &quot;%02X&quot;, exportedkeymat[i]);
-                BIO_printf(bio, &quot;\n&quot;);
-            }
-            OPENSSL_free(exportedkeymat);
+        exportedkeymat = app_malloc(keymatexportlen, &quot;export key&quot;);
+        if (!SSL_export_keying_material(s, exportedkeymat,
+                                        keymatexportlen,
+                                        keymatexportlabel,
+                                        strlen(keymatexportlabel),
+                                        NULL, 0, 0)) {
+            BIO_printf(bio, &quot;    Error\n&quot;);
+        } else {
+            BIO_printf(bio, &quot;    Keying material: &quot;);
+            for (i = 0; i &lt; keymatexportlen; i++)
+                BIO_printf(bio, &quot;%02X&quot;, exportedkeymat[i]);
+            BIO_printf(bio, &quot;\n&quot;);
         }
+        OPENSSL_free(exportedkeymat);
     }
     BIO_printf(bio, &quot;---\n&quot;);
     X509_free(peer);
diff --git a/apps/s_server.c b/apps/s_server.c
index f8bec24..21d2d37 100644
--- a/apps/s_server.c
+++ b/apps/s_server.c
@@ -447,6 +447,7 @@ static BIO_METHOD methods_ebcdic = {
     ebcdic_free,
 };
 
+/* This struct is &quot;unwarranted chumminess with the compiler.&quot; */
 typedef struct {
     size_t alloced;
     char buff[1];
@@ -461,9 +462,7 @@ static int ebcdic_new(BIO *bi)
 {
     EBCDIC_OUTBUFF *wbuf;
 
-    wbuf = OPENSSL_malloc(sizeof(EBCDIC_OUTBUFF) + 1024);
-    if (!wbuf)
-        return 0;
+    wbuf = app_malloc(sizeof(EBCDIC_OUTBUFF) + 1024, &quot;ebcdef wbuf&quot;);
     wbuf-&gt;alloced = 1024;
     wbuf-&gt;buff[0] = '\0';
 
@@ -518,9 +517,7 @@ static int ebcdic_write(BIO *b, const char *in, int inl)
         num = num + num;        /* double the size */
         if (num &lt; inl)
             num = inl;
-        wbuf = OPENSSL_malloc(sizeof(EBCDIC_OUTBUFF) + num);
-        if (!wbuf)
-            return 0;
+        wbuf = app_malloc(sizeof(EBCDIC_OUTBUFF) + num, &quot;grow ebcdic wbuf&quot;);
         OPENSSL_free(b-&gt;ptr);
 
         wbuf-&gt;alloced = num;
@@ -2018,10 +2015,7 @@ static int sv_body(char *hostname, int s, int stype, unsigned char *context)
     struct timeval *timeoutp;
 #endif
 
-    if ((buf = OPENSSL_malloc(bufsize)) == NULL) {
-        BIO_printf(bio_err, &quot;out of memory\n&quot;);
-        goto err;
-    }
+    buf = app_malloc(bufsize, &quot;server buffer&quot;);
 #ifdef FIONBIO
     if (s_nbio) {
         unsigned long sl = 1;
@@ -2542,22 +2536,20 @@ static int init_ssl_connection(SSL *con)
         BIO_printf(bio_s_out, &quot;Keying material exporter:\n&quot;);
         BIO_printf(bio_s_out, &quot;    Label: '%s'\n&quot;, keymatexportlabel);
         BIO_printf(bio_s_out, &quot;    Length: %i bytes\n&quot;, keymatexportlen);
-        exportedkeymat = OPENSSL_malloc(keymatexportlen);
-        if (exportedkeymat != NULL) {
-            if (!SSL_export_keying_material(con, exportedkeymat,
-                                            keymatexportlen,
-                                            keymatexportlabel,
-                                            strlen(keymatexportlabel),
-                                            NULL, 0, 0)) {
-                BIO_printf(bio_s_out, &quot;    Error\n&quot;);
-            } else {
-                BIO_printf(bio_s_out, &quot;    Keying material: &quot;);
-                for (i = 0; i &lt; keymatexportlen; i++)
-                    BIO_printf(bio_s_out, &quot;%02X&quot;, exportedkeymat[i]);
-                BIO_printf(bio_s_out, &quot;\n&quot;);
-            }
-            OPENSSL_free(exportedkeymat);
+        exportedkeymat = app_malloc(keymatexportlen, &quot;export key&quot;);
+        if (!SSL_export_keying_material(con, exportedkeymat,
+                                        keymatexportlen,
+                                        keymatexportlabel,
+                                        strlen(keymatexportlabel),
+                                        NULL, 0, 0)) {
+            BIO_printf(bio_s_out, &quot;    Error\n&quot;);
+        } else {
+            BIO_printf(bio_s_out, &quot;    Keying material: &quot;);
+            for (i = 0; i &lt; keymatexportlen; i++)
+                BIO_printf(bio_s_out, &quot;%02X&quot;, exportedkeymat[i]);
+            BIO_printf(bio_s_out, &quot;\n&quot;);
         }
+        OPENSSL_free(exportedkeymat);
     }
 
     return (1);
@@ -2593,9 +2585,7 @@ static int www_body(char *hostname, int s, int stype, unsigned char *context)
     int total_bytes = 0;
 #endif
 
-    buf = OPENSSL_malloc(bufsize);
-    if (buf == NULL)
-        return (0);
+    buf = app_malloc(bufsize, &quot;server www buffer&quot;);
     io = BIO_new(BIO_f_buffer());
     ssl_bio = BIO_new(BIO_f_ssl());
     if ((io == NULL) || (ssl_bio == NULL))
@@ -2962,9 +2952,7 @@ static int rev_body(char *hostname, int s, int stype, unsigned char *context)
     KSSL_CTX *kctx;
 #endif
 
-    buf = OPENSSL_malloc(bufsize);
-    if (buf == NULL)
-        return (0);
+    buf = app_malloc(bufsize, &quot;server rev buffer&quot;);
     io = BIO_new(BIO_f_buffer());
     ssl_bio = BIO_new(BIO_f_ssl());
     if ((io == NULL) || (ssl_bio == NULL))
@@ -3161,15 +3149,9 @@ static simple_ssl_session *first = NULL;
 
 static int add_session(SSL *ssl, SSL_SESSION *session)
 {
-    simple_ssl_session *sess;
+    simple_ssl_session *sess = app_malloc(sizeof *sess, &quot;get session&quot;);
     unsigned char *p;
 
-    sess = OPENSSL_malloc(sizeof(simple_ssl_session));
-    if (!sess) {
-        BIO_printf(bio_err, &quot;Out of memory adding to external cache\n&quot;);
-        return 0;
-    }
-
     SSL_SESSION_get_id(session, &amp;sess-&gt;idlen);
     sess-&gt;derlen = i2d_SSL_SESSION(session, NULL);
     if (sess-&gt;derlen &lt; 0) {
@@ -3179,8 +3161,8 @@ static int add_session(SSL *ssl, SSL_SESSION *session)
     }
 
     sess-&gt;id = BUF_memdup(SSL_SESSION_get_id(session, NULL), sess-&gt;idlen);
-    sess-&gt;der = OPENSSL_malloc(sess-&gt;derlen);
-    if (!sess-&gt;id || !sess-&gt;der) {
+    sess-&gt;der = app_malloc(sess-&gt;derlen, &quot;get session buffer&quot;);
+    if (!sess-&gt;id) {
         BIO_printf(bio_err, &quot;Out of memory adding to external cache\n&quot;);
         OPENSSL_free(sess-&gt;id);
         OPENSSL_free(sess-&gt;der);
diff --git a/apps/s_socket.c b/apps/s_socket.c
index 050426a..caa5b61 100644
--- a/apps/s_socket.c
+++ b/apps/s_socket.c
@@ -562,11 +562,7 @@ static int do_accept(int acc_sock, int *sock, char **host)
         *host = NULL;
         /* return(0); */
     } else {
-        if ((*host = OPENSSL_malloc(strlen(h1-&gt;h_name) + 1)) == NULL) {
-            perror(&quot;OPENSSL_malloc&quot;);
-            closesocket(ret);
-            return (0);
-        }
+        *host = app_malloc(strlen(h1-&gt;h_name) + 1, &quot;copy hostname&quot;);
         BUF_strlcpy(*host, h1-&gt;h_name, strlen(h1-&gt;h_name) + 1);
 
         h2 = GetHostByName(*host);
diff --git a/apps/speed.c b/apps/speed.c
index 7dfdda8..720ab1c 100644
--- a/apps/speed.c
+++ b/apps/speed.c
@@ -791,17 +791,9 @@ int speed_main(int argc, char **argv)
         ecdh_doit[i] = 0;
 #endif
 
-    if ((buf_malloc = OPENSSL_malloc((int)BUFSIZE + misalign)) == NULL) {
-        BIO_printf(bio_err, &quot;out of memory\n&quot;);
-        goto end;
-    }
-    if ((buf2_malloc = OPENSSL_malloc((int)BUFSIZE + misalign)) == NULL) {
-        BIO_printf(bio_err, &quot;out of memory\n&quot;);
-        goto end;
-    }
+    buf = buf_malloc = app_malloc((int)BUFSIZE + misalign, &quot;input buffer&quot;);
+    buf2 = buf2_malloc = app_malloc((int)BUFSIZE + misalign, &quot;output buffer&quot;);
     misalign = 0;
-    buf = buf_malloc;
-    buf2 = buf2_malloc;
 
     prog = opt_init(argc, argv, speed_options);
     while ((o = opt_next()) != OPT_EOF) {
@@ -2452,13 +2444,8 @@ static void multiblock_speed(const EVP_CIPHER *evp_cipher)
     EVP_CIPHER_CTX ctx;
     double d = 0.0;
 
-    inp = OPENSSL_malloc(mblengths[num - 1]);
-    out = OPENSSL_malloc(mblengths[num - 1] + 1024);
-    if (!inp || !out) {
-        BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-        goto end;
-    }
-
+    inp = app_malloc(mblengths[num - 1], &quot;multiblock input buffer&quot;);
+    out = app_malloc(mblengths[num - 1] + 1024, &quot;multiblock output buffer&quot;);
     EVP_CIPHER_CTX_init(&amp;ctx);
     EVP_EncryptInit_ex(&amp;ctx, evp_cipher, NULL, no_key, no_iv);
     EVP_CIPHER_CTX_ctrl(&amp;ctx, EVP_CTRL_AEAD_SET_MAC_KEY, sizeof(no_key),
@@ -2541,7 +2528,6 @@ static void multiblock_speed(const EVP_CIPHER *evp_cipher)
         fprintf(stdout, &quot;\n&quot;);
     }
 
-end:
     if (inp)
         OPENSSL_free(inp);
     if (out)
diff --git a/apps/srp.c b/apps/srp.c
index bbbe1a9..b984c14 100644
--- a/apps/srp.c
+++ b/apps/srp.c
@@ -138,11 +138,7 @@ static int update_index(CA_DB *db, char **row)
     char **irow;
     int i;
 
-    if ((irow = OPENSSL_malloc(sizeof(char *) * (DB_NUMBER + 1))) == NULL) {
-        BIO_printf(bio_err, &quot;Memory allocation failure\n&quot;);
-        return 0;
-    }
-
+    irow = app_malloc(sizeof(char *) * (DB_NUMBER + 1), &quot;row pointers&quot;);
     for (i = 0; i &lt; DB_NUMBER; i++) {
         irow[i] = row[i];
         row[i] = NULL;
@@ -363,23 +359,12 @@ int srp_main(int argc, char **argv)
             configfile = getenv(&quot;SSLEAY_CONF&quot;);
         if (configfile == NULL) {
             const char *s = X509_get_default_cert_area();
-            size_t len;
+            size_t len = strlen(s) + 1 + sizeof(CONFIG_FILE);
 
+            tofree = app_malloc(len, &quot;config filename space&quot;);
 # ifdef OPENSSL_SYS_VMS
-            len = strlen(s) + sizeof(CONFIG_FILE);
-            tofree = OPENSSL_malloc(len);
-            if (!tofree) {
-                BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-                goto end;
-            }
             strcpy(tofree, s);
 # else
-            len = strlen(s) + sizeof(CONFIG_FILE) + 1;
-            tofree = OPENSSL_malloc(len);
-            if (!tofree) {
-                BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-                goto end;
-            }
             BUF_strlcpy(tofree, s, len);
             BUF_strlcat(tofree, &quot;/&quot;, len);
 # endif
diff --git a/apps/ts.c b/apps/ts.c
index e0f4313..3cfdc79 100644
--- a/apps/ts.c
+++ b/apps/ts.c
@@ -576,10 +576,7 @@ static int create_digest(BIO *input, char *digest, const EVP_MD *md,
         unsigned char buffer[4096];
         int length;
 
-        *md_value = OPENSSL_malloc(md_value_len);
-        if (*md_value == 0)
-            goto err;
-
+        *md_value = app_malloc(md_value_len, &quot;digest buffer&quot;);
         EVP_DigestInit(&amp;md_ctx, md);
         while ((length = BIO_read(input, buffer, sizeof(buffer))) &gt; 0) {
             EVP_DigestUpdate(&amp;md_ctx, buffer, length);
@@ -624,8 +621,7 @@ static ASN1_INTEGER *create_nonce(int bits)
     OPENSSL_free(nonce-&gt;data);
     /* Allocate at least one byte. */
     nonce-&gt;length = len - i;
-    if (!(nonce-&gt;data = OPENSSL_malloc(nonce-&gt;length + 1)))
-        goto err;
+    nonce-&gt;data = app_malloc(nonce-&gt;length + 1, &quot;nonce buffer&quot;);
     memcpy(nonce-&gt;data, buf + i, nonce-&gt;length);
 
     return nonce;
diff --git a/apps/vms_decc_init.c b/apps/vms_decc_init.c
index 1717dae..3ec7b54 100644
--- a/apps/vms_decc_init.c
+++ b/apps/vms_decc_init.c
@@ -130,7 +130,7 @@ char **copy_argv(int *argc, char *argv[])
      */
 
     int i, count = *argc;
-    char **newargv = OPENSSL_malloc((count + 1) * sizeof *newargv);
+    char **newargv = app_malloc((count + 1) * sizeof *newargv, &quot;argv copy&quot;);
 
     for (i = 0; i &lt; count; i++)
         newargv[i] = argv[i];
diff --git a/apps/x509.c b/apps/x509.c
index e1cc3cd..5418cce 100644
--- a/apps/x509.c
+++ b/apps/x509.c
@@ -783,12 +783,7 @@ int x509_main(int argc, char **argv)
                                 &quot; */\n&quot;, buf);
 
                 len = i2d_X509(x, NULL);
-                m = OPENSSL_malloc(len);
-                if (!m) {
-                    BIO_printf(bio_err, &quot;Out of memory\n&quot;);
-                    goto end;
-                }
-
+                m = app_malloc(len, &quot;x509 name buffer&quot;);
                 d = (unsigned char *)m;
                 len = i2d_X509_NAME(X509_get_subject_name(x), &amp;d);
                 print_array(out, &quot;the_subject_name&quot;, len, (unsigned char *)m);
@@ -976,11 +971,7 @@ static ASN1_INTEGER *x509_load_serial(char *CAfile, char *serialfile,
     len = ((serialfile == NULL)
            ? (strlen(CAfile) + strlen(POSTFIX) + 1)
            : (strlen(serialfile))) + 1;
-    buf = OPENSSL_malloc(len);
-    if (buf == NULL) {
-        BIO_printf(bio_err, &quot;out of mem\n&quot;);
-        goto end;
-    }
+    buf = app_malloc(len, &quot;serial# buffer&quot;);
     if (serialfile == NULL) {
         BUF_strlcpy(buf, CAfile, len);
         for (p = buf; *p; p++)
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000986.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="000988.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#987">[ date ]</a>
              <a href="thread.html#987">[ thread ]</a>
              <a href="subject.html#987">[ subject ]</a>
              <a href="author.html#987">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
