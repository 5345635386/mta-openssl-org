<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1583116620.202281.12445.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027750.html">
   <LINK REL="Next"  HREF="027764.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1583116620.202281.12445.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Mon Mar  2 02:37:00 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="027750.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="027764.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27751">[ date ]</a>
              <a href="thread.html#27751">[ thread ]</a>
              <a href="subject.html#27751">[ subject ]</a>
              <a href="author.html#27751">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  97ace6c2dae451ce8e3b099cf242968ecff128af (commit)
       via  fe909ee4aeb6eb64f6f31a1544c5d3c81c5fe1f1 (commit)
       via  19cf4404d5174a41d46a781155ad513a3502c609 (commit)
       via  a3f1fc25017ef768a956b88edee4aaf851a58db2 (commit)
       via  e42921790267d54054cde1596711219b72a184ad (commit)
       via  ad5be194c6b08e89f9a6e2a78b85ff19a3c40d40 (commit)
      from  2888fc1590ad31633be7a99e7288dcecd35e800c (commit)


- Log -----------------------------------------------------------------
commit 97ace6c2dae451ce8e3b099cf242968ecff128af
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Thu Feb 27 02:07:50 2020 +0100

    .travis.yml: Remove NOUPDATE support
    
    It was a temporary measure to deal with the fact that util/progs.pl
    didn't work right at all times, but that has now been fixed.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11185">https://github.com/openssl/openssl/pull/11185</A>)

commit fe909ee4aeb6eb64f6f31a1544c5d3c81c5fe1f1
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Feb 26 14:52:04 2020 +0100

    Remove apps/progs.c and apps/progs.h
    
    Since they are generated in build time, there's not need to keep them
    in the source tree.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11185">https://github.com/openssl/openssl/pull/11185</A>)

commit 19cf4404d5174a41d46a781155ad513a3502c609
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Feb 26 14:42:10 2020 +0100

    Configure: Diverse cleanups
    
    There were some remaining old code and comments that don't serve a
    purpose any longer.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11185">https://github.com/openssl/openssl/pull/11185</A>)

commit a3f1fc25017ef768a956b88edee4aaf851a58db2
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Feb 26 14:39:16 2020 +0100

    Build: Generate apps/progs.c and apps/progs.h in build time
    
    util/progs.pl depends on the build tree (on configdata.pm,
    specifically), so it needs to be run from the build tree.  But why
    stop there?  We might as well generate apps/progs.c and apps/progs.h
    when building.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11185">https://github.com/openssl/openssl/pull/11185</A>)

commit e42921790267d54054cde1596711219b72a184ad
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Feb 26 14:35:17 2020 +0100

    build.info: Implement simply substitutions in variable values
    
    Use case: having a variable with multiple source files in its value,
    and wanting to refer to the corresponding object file.
    
        $SRCS=foo.c bar.c
        SOURCE[program]=$SRCS
        DEPEND[${SRCS/.c/.o}]=prog.h
    
        GENERATE[prog.h]=...
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11185">https://github.com/openssl/openssl/pull/11185</A>)

commit ad5be194c6b08e89f9a6e2a78b85ff19a3c40d40
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Wed Feb 26 14:30:38 2020 +0100

    build.info: Make it possible to have more than one item in KEYWORD[]
    
    So far, the &quot;index&quot; part of KEYWORD[whatever] could only handle one
    item.  There are cases, however, where we want to add the exact same
    value to multiple items.  This is especially helpful if a variable
    that may have multi-item values are used in the &quot;index&quot; part.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11185">https://github.com/openssl/openssl/pull/11185</A>)

-----------------------------------------------------------------------

Summary of changes:
 .travis.yml                          |   4 +-
 Configurations/descrip.mms.tmpl      |   4 +-
 Configurations/unix-Makefile.tmpl    |  10 +-
 Configurations/windows-makefile.tmpl |   4 +-
 Configure                            | 228 +++++++++++---------
 apps/build.info                      |  15 +-
 apps/progs.c                         | 402 -----------------------------------
 apps/progs.h                         | 123 -----------
 doc/internal/man7/build.info.pod     |  56 +++--
 9 files changed, 187 insertions(+), 659 deletions(-)
 delete mode 100644 apps/progs.c
 delete mode 100644 apps/progs.h

diff --git a/.travis.yml b/.travis.yml
index b6d698ae76..a015eb4053 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -65,7 +65,7 @@ matrix:
         - os: linux
           arch: arm64
           compiler: gcc
-          env: CONFIG_OPTS=&quot;no-asm no-deprecated enable-buildtest-c++ --strict-warnings -D_DEFAULT_SOURCE&quot; BUILDONLY=&quot;yes&quot; NOUPDATE=&quot;yes&quot; CHECKDOCS=&quot;yes&quot; CPPFLAGS=&quot;-ansi&quot;
+          env: CONFIG_OPTS=&quot;no-asm no-deprecated enable-buildtest-c++ --strict-warnings -D_DEFAULT_SOURCE&quot; BUILDONLY=&quot;yes&quot; CHECKDOCS=&quot;yes&quot; CPPFLAGS=&quot;-ansi&quot;
         - os: linux
           arch: s390x
           compiler: gcc
@@ -212,7 +212,7 @@ script:
     - if [ -n &quot;$DESTDIR&quot; ]; then
           cd _build;
       fi
-    - if [ -z &quot;$NOUPDATE&quot; ] &amp;&amp; ! $make update; then
+    - if ! $make update; then
           echo -e '\052\052 FAILED -- MAKE UPDATE';
           travis_terminate 1;
       fi
diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index bf22e40dc4..8ce6e78999 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -140,8 +140,8 @@ HTMLDOCS3={- join(&quot;, &quot;, map { &quot;-\n\t&quot;.$_ } @{$unified_info{htmldocs}-&gt;{man3}}) -
 HTMLDOCS5={- join(&quot;, &quot;, map { &quot;-\n\t&quot;.$_ } @{$unified_info{htmldocs}-&gt;{man5}}) -}
 HTMLDOCS7={- join(&quot;, &quot;, map { &quot;-\n\t&quot;.$_ } @{$unified_info{htmldocs}-&gt;{man7}}) -}
 
-APPS_OPENSSL={- use File::Spec::Functions;
-                catfile(&quot;apps&quot;,&quot;openssl&quot;) -}
+APPS_OPENSSL=&quot;{- use File::Spec::Functions;
+                 catfile(&quot;apps&quot;,&quot;openssl&quot;) -}&quot;
 
 # DESTDIR is for package builders so that they can configure for, say,
 # SYS$COMMON:[OPENSSL] and yet have everything installed in STAGING:[USER].
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index ac24687609..a019779993 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -195,8 +195,8 @@ MANDOCS7={-
              fill_lines(&quot; &quot;, $COLUMNS - 9, map { platform-&gt;bin($_) }
                         @{$unified_info{mandocs}-&gt;{man7}})) -}
 
-APPS_OPENSSL={- use File::Spec::Functions;
-                catfile(&quot;apps&quot;,&quot;openssl&quot;) -}
+APPS_OPENSSL=&quot;{- use File::Spec::Functions;
+                 catfile(&quot;apps&quot;,&quot;openssl&quot;) -}&quot;
 
 # DESTDIR is for package builders so that they can configure for, say,
 # /usr/ and yet have everything installed to /tmp/somedir/usr/.
@@ -962,12 +962,6 @@ lint:
 generate_apps:
 	( cd $(SRCDIR); $(PERL) VMS/VMSify-conf.pl \
 				&lt; apps/openssl.cnf &gt; apps/openssl-vms.cnf )
-	@ : {- output_off() if $disabled{apps}; &quot;&quot; -}
-	( b=`pwd`; cd $(SRCDIR); \
-	  $(PERL) -I$$b apps/progs.pl -H $(APPS_OPENSSL) &gt; apps/progs.h )
-	( b=`pwd`; cd $(SRCDIR); \
-	  $(PERL) -I$$b apps/progs.pl -C $(APPS_OPENSSL) &gt; apps/progs.c )
-	@ : {- output_on() if $disabled{apps}; &quot;&quot; -}
 
 generate_crypto_bn:
 	( cd $(SRCDIR); $(PERL) crypto/bn/bn_prime.pl &gt; crypto/bn/bn_prime.h )
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index 859d3a6324..c49b32f0e1 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -130,8 +130,8 @@ HTMLDOCS5_BLDDIRS={- my %dirs = map { dirname($_) =&gt; 1 } @HTMLDOCS5;
 HTMLDOCS7_BLDDIRS={- my %dirs = map { dirname($_) =&gt; 1 } @HTMLDOCS7;
                      join(' ', sort keys %dirs) -}
 
-APPS_OPENSSL={- use File::Spec::Functions;
-                &quot;\&quot;&quot;.catfile(&quot;apps&quot;,&quot;openssl&quot;).&quot;\&quot;&quot; -}
+APPS_OPENSSL=&quot;{- use File::Spec::Functions;
+                 catfile(&quot;apps&quot;,&quot;openssl&quot;) -}&quot;
 
 # Do not edit these manually. Use Configure with --prefix or --openssldir
 # to change this!  Short explanation in the top comment in Configure
diff --git a/Configure b/Configure
index 7b3e6ccbd3..19b57d90b8 100755
--- a/Configure
+++ b/Configure
@@ -1807,23 +1807,62 @@ if ($builder eq &quot;unified&quot;) {
         # contains a dollar sign, it had better be escaped, or it will be
         # taken for a variable name prefix.
         my %variables = ();
-        my $variable_re = qr/\$(?P&lt;VARIABLE&gt;[[:alpha:]][[:alnum:]_]*)/;
+        # Variable name syntax
+        my $variable_name_re = qr/(?P&lt;VARIABLE&gt;[[:alpha:]][[:alnum:]_]*)/;
+        # Value modifier syntaxes
+        my $variable_subst_re = qr/\/(?P&lt;RE&gt;(?:\\\/|.)*?)\/(?P&lt;SUBST&gt;.*?)/;
+        # Put it all together
+        my $variable_re = qr/\$
+                             (?|
+                                 # Simple case, just the name
+                                 ${variable_name_re}
+                             |
+                                 # Expressive case, with braces and possible
+                                 # modifier expressions
+                                 \{
+                                 ${variable_name_re}
+                                 (?:
+                                     # Pile on modifier expressions,
+                                     # separated by |
+                                     ${variable_subst_re}
+                                 )
+                                 \}
+                             )/x;
         my $expand_variables = sub {
             my $value = '';
             my $value_rest = shift;
 
             if ($ENV{CONFIGURE_DEBUG_VARIABLE_EXPAND}) {
                 print STDERR
-                    &quot;DEBUG[\$expand_variables] Parsed '$value_rest' into:\n&quot;
+                    &quot;DEBUG[\$expand_variables] Parsed '$value_rest' ...\n&quot;
             }
             while ($value_rest =~ /(?&lt;!\\)${variable_re}/) {
-                $value .= $`;
-                $value .= $variables{$+{VARIABLE}};
                 $value_rest = $';
+                $value .= $`;
+
+                my $variable_value = $variables{$+{VARIABLE}};
+
+                # Process modifier expressions, if present
+                if (defined $+{RE}) {
+                    # We must save important %+ values, because the s///
+                    # below clears them
+                    my $re = $+{RE};
+                    my $subst = $+{SUBST};
+
+                    $variable_value =~ s/\Q$re\E/$subst/g;
+
+                    if ($ENV{CONFIGURE_DEBUG_VARIABLE_EXPAND}) {
+                        print STDERR
+                            &quot;DEBUG[\$expand_variables] ... and substituted &quot;,
+                            &quot;'$re' with '$subst'\n&quot;;
+                    }
+                }
+
+                $value .= $variable_value;
             }
             if ($ENV{CONFIGURE_DEBUG_VARIABLE_EXPAND}) {
                 print STDERR
-                    &quot;DEBUG[\$expand_variables] ... '$value$value_rest'\n&quot;;
+                    &quot;DEBUG[\$expand_variables] ... into: '$value$value_rest'\n&quot;;
             }
             return $value . $value_rest;
         };
@@ -1857,6 +1896,34 @@ if ($builder eq &quot;unified&quot;) {
             }
         };
 
+        # Support for pushing values on multiple indexes of a given hash
+        # array.
+        my $push_to = sub {
+            my $valueref = shift;
+            my $index_str = shift; # May be undef or empty
+            my $attrref = shift;   # May be undef
+            my $attr_str = shift;
+            my @values = @_;
+
+            if (defined $index_str) {
+                my @indexes = ( '' );
+                if ($index_str !~ m|^\s*$|) {
+                    @indexes = tokenize($index_str);
+                }
+                foreach (@indexes) {
+                    push @{$valueref-&gt;{$_}}, @values;
+                    if (defined $attrref) {
+                        $handle_attributes-&gt;($attr_str, \$$attrref-&gt;{$_},
+                                             @values);
+                    }
+                }
+            } else {
+                push @$valueref, @values;
+                $handle_attributes-&gt;($attr_str, $attrref, @values)
+                    if defined $attrref;
+            }
+        };
+
         # We want to detect configdata.pm in the source tree, so we
         # don't use it if the build tree is different.
         my $src_configdata = cleanfile($srcdir, &quot;configdata.pm&quot;, $blddir);
@@ -1937,88 +2004,64 @@ if ($builder eq &quot;unified&quot;) {
                 }
             },
             qr/^\s* PROGRAMS ${attribs_re} \s* =  ${value_re} $/x
-            =&gt; sub {
-                if (!@skip || $skip[$#skip] &gt; 0) {
-                    my @p = tokenize($expand_variables-&gt;($+{VALUE}));
-                    push @programs, @p;
-                    $handle_attributes-&gt;($+{ATTRIBS},
-                                         \$attributes{programs},
-                                         @p);
-                }
-            },
+            =&gt; sub { $push_to-&gt;(\@programs, undef,
+                                \$attributes{programs}, $+{ATTRIBS},
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* LIBS ${attribs_re} \s* =  ${value_re} $/x
-            =&gt; sub {
-                if (!@skip || $skip[$#skip] &gt; 0) {
-                    my @l = tokenize($expand_variables-&gt;($+{VALUE}));
-                    push @libraries, @l;
-                    $handle_attributes-&gt;($+{ATTRIBS},
-                                         \$attributes{libraries},
-                                         @l);
-                }
-            },
+            =&gt; sub { $push_to-&gt;(\@libraries, undef,
+                                \$attributes{libraries}, $+{ATTRIBS},
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* MODULES ${attribs_re} \s* =  ${value_re} $/x
-            =&gt; sub {
-                if (!@skip || $skip[$#skip] &gt; 0) {
-                    my @m = tokenize($expand_variables-&gt;($+{VALUE}));
-                    push @modules, @m;
-                    $handle_attributes-&gt;($+{ATTRIBS},
-                                         \$attributes{modules},
-                                         @m);
-                }
-            },
+            =&gt; sub { $push_to-&gt;(\@modules, undef,
+                                \$attributes{modules}, $+{ATTRIBS},
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* SCRIPTS ${attribs_re} \s* =  ${value_re} $/x
-            =&gt; sub {
-                if (!@skip || $skip[$#skip] &gt; 0) {
-                    my @s = tokenize($expand_variables-&gt;($+{VALUE}));
-                    push @scripts, @s;
-                    $handle_attributes-&gt;($+{ATTRIBS},
-                                         \$attributes{scripts},
-                                         @s);
-                }
-            },
+            =&gt; sub { $push_to-&gt;(\@scripts, undef,
+                                \$attributes{scripts}, $+{ATTRIBS},
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* HTMLDOCS ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$htmldocs{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%htmldocs, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef,
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* MANDOCS ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$mandocs{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
-            qr/^\s* ORDINALS ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$ordinals{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%mandocs, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef,
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* SOURCE ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$sources{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%sources, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef,
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* SHARED_SOURCE ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$shared_sources{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%shared_sources, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef,
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* INCLUDE ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$includes{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%includes, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef,
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* DEFINE ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$defines{$expand_variables-&gt;($+{INDEX})}},
-                         tokenize($expand_variables-&gt;($+{VALUE}))
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%defines, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef,
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* DEPEND ${index_re} ${attribs_re} = ${value_re} $/x
-            =&gt; sub {
-                if (!@skip || $skip[$#skip] &gt; 0) {
-                    my $i = $expand_variables-&gt;($+{INDEX});
-                    my @d = tokenize($expand_variables-&gt;($+{VALUE}));
-                    push @{$depends{$i}}, @d;
-                    $handle_attributes-&gt;($+{ATTRIBS},
-                                         \$attributes{depends}-&gt;{$i},
-                                         @d);
-                }
-            },
+            =&gt; sub { $push_to-&gt;(\%depends, $expand_variables-&gt;($+{INDEX}),
+                                \$attributes{depends}, $+{ATTRIBS},
+                                tokenize($expand_variables-&gt;($+{VALUE})))
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* GENERATE ${index_re} = ${value_re} $/x
-            =&gt; sub { push @{$generate{$expand_variables-&gt;($+{INDEX})}},
-                         $+{VALUE}
-                         if !@skip || $skip[$#skip] &gt; 0 },
+            =&gt; sub { $push_to-&gt;(\%generate, $expand_variables-&gt;($+{INDEX}),
+                                undef, undef, $+{VALUE})
+                         if !@skip || $skip[$#skip] &gt; 0; },
             qr/^\s* (?:\#.*)? $/x =&gt; sub { },
             &quot;OTHERWISE&quot; =&gt; sub { die &quot;Something wrong with this line:\n$_\nat $sourced/$f&quot; },
             &quot;BEFORE&quot; =&gt; sub {
@@ -2078,9 +2121,9 @@ EOF
             foreach (@{$sources{$dest}}) {
                 my $s = cleanfile($sourced, $_, $blddir);
 
-                # If it isn't in the source tree, we assume it's generated
-                # in the build tree
-                if ($s eq $src_configdata || ! -f $s || $generate{$_}) {
+                # If it's generated or we simply don't find it in the source
+                # tree, we assume it's in the build tree.
+                if ($s eq $src_configdata || $generate{$_} || ! -f $s) {
                     $s = cleanfile($buildd, $_, $blddir);
                 }
                 # We recognise C++, C and asm files
@@ -2110,9 +2153,9 @@ EOF
             foreach (@{$shared_sources{$dest}}) {
                 my $s = cleanfile($sourced, $_, $blddir);
 
-                # If it isn't in the source tree, we assume it's generated
-                # in the build tree
-                if ($s eq $src_configdata || ! -f $s || $generate{$_}) {
+                # If it's generated or we simply don't find it in the source
+                # tree, we assume it's in the build tree.
+                if ($s eq $src_configdata || $generate{$_} || ! -f $s) {
                     $s = cleanfile($buildd, $_, $blddir);
                 }
 
@@ -2152,8 +2195,7 @@ EOF
             my $gen = $generator[0];
             $generator[0] = cleanfile($sourced, $gen, $blddir);
 
-            # If the generator isn't in the source tree, we assume it's
-            # generated in the build tree
+            # If the generator is itself generated, it's in the build tree
             if ($generate{$gen}) {
                 $generator[0] = cleanfile($buildd, $gen, $blddir);
             }
@@ -2175,23 +2217,14 @@ EOF
 
                 # If we know it's generated, or assume it is because we can't
                 # find it in the source tree, we set file we depend on to be
-                # in the build tree rather than the source tree, and assume
-                # and that there are lines to build it in a BEGINRAW..ENDRAW
-                # section or in the Makefile template.
+                # in the build tree rather than the source tree.
                 if ($d eq $src_configdata
-                    || ! -f $d
                     || (grep { $d eq $_ }
                         map { cleanfile($srcdir, $_, $blddir) }
-                        grep { /\.h$/ } keys %{$unified_info{generate}})) {
+                        grep { /\.h$/ } keys %{$unified_info{generate}})
+                    || ! -f $d) {
                     $d = cleanfile($buildd, $_, $blddir);
                 }
-                # Take note if the file to depend on is being renamed
-                # Take extra care with files ending with .a, they should
-                # be treated without that extension, and the extension
-                # should be added back after treatment.
-                $d =~ /(\.a)?$/;
-                my $e = $1 // &quot;&quot;;
-                $d = $`.$e;
                 $unified_info{depends}-&gt;{$ddest}-&gt;{$d} = 1;
 
                 # Fix up associated attributes
@@ -2230,9 +2263,6 @@ EOF
                 # be a generated file in the build tree.
                 if (! -f $ddest) {
                     $ddest = cleanfile($buildd, $dest, $blddir);
-                    if ($unified_info{rename}-&gt;{$ddest}) {
-                        $ddest = $unified_info{rename}-&gt;{$ddest};
-                    }
                 }
             }
             foreach my $v (@{$defines{$dest}}) {
diff --git a/apps/build.info b/apps/build.info
index 1b931c8ac1..495e56065e 100644
--- a/apps/build.info
+++ b/apps/build.info
@@ -19,6 +19,10 @@ $OPENSSLSRC=\
         s_client.c s_server.c s_time.c sess_id.c smime.c speed.c \
         spkac.c srp.c ts.c verify.c version.c x509.c rehash.c storeutl.c \
         list.c info.c provider.c fipsinstall.c
+IF[{- !$disabled{'deprecated-3.0'} -}]
+  $OPENSSLSRC=$OPENSSLSRC \
+        dhparam.c dsa.c dsaparam.c gendsa.c rsa.c rsautl.c genrsa.c
+ENDIF
 
 IF[{- !$disabled{apps} -}]
   PROGRAMS=openssl
@@ -26,15 +30,18 @@ IF[{- !$disabled{apps} -}]
   INCLUDE[openssl]=.. ../include include
   DEPEND[openssl]=libapps.a ../libssl
 
+  DEPEND[${OPENSSLSRC/.c/.o}]=progs.h
+  GENERATE[progs.c]=progs.pl -C $(APPS_OPENSSL)
+  GENERATE[progs.h]=progs.pl -H $(APPS_OPENSSL)
+  # progs.pl tries to read all 'openssl' sources, including progs.c, so we make
+  # sure things are generated in the correct order.
+  DEPEND[progs.h]=progs.c
+
   IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
     GENERATE[openssl.rc]=../util/mkrc.pl openssl
     SOURCE[openssl]=openssl.rc
   ENDIF
 
-  IF[{- !$disabled{'deprecated-3.0'} -}]
-    SOURCE[openssl]=dhparam.c dsa.c dsaparam.c gendsa.c rsa.c rsautl.c genrsa.c
-  ENDIF
-
   SCRIPTS{misc}=CA.pl
   SOURCE[CA.pl]=CA.pl.in
   # linkname tells build files that a symbolic link or copy of this script
diff --git a/apps/progs.c b/apps/progs.c
deleted file mode 100644
index 3492c93e25..0000000000
--- a/apps/progs.c
+++ /dev/null
@@ -1,402 +0,0 @@
-/*
- * WARNING: do not edit!
- * Generated by apps/progs.pl
- *
- * Copyright 1995-2020 The OpenSSL Project Authors. All Rights Reserved.
- *
- * Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
- * this file except in compliance with the License.  You can obtain a copy
- * in the file LICENSE in the source distribution or at
- * <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
- */
-
-#include &quot;progs.h&quot;
-
-FUNCTION functions[] = {
-    {FT_general, &quot;asn1parse&quot;, asn1parse_main, asn1parse_options, NULL},
-    {FT_general, &quot;ca&quot;, ca_main, ca_options, NULL},
-#ifndef OPENSSL_NO_SOCK
-    {FT_general, &quot;ciphers&quot;, ciphers_main, ciphers_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CMS
-    {FT_general, &quot;cms&quot;, cms_main, cms_options, NULL},
-#endif
-    {FT_general, &quot;crl&quot;, crl_main, crl_options, NULL},
-    {FT_general, &quot;crl2pkcs7&quot;, crl2pkcs7_main, crl2pkcs7_options, NULL},
-    {FT_general, &quot;dgst&quot;, dgst_main, dgst_options, NULL},
-#if !defined(OPENSSL_NO_DH) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;dhparam&quot;, dhparam_main, dhparam_options, &quot;pkeyparam&quot;},
-#endif
-#if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;dsa&quot;, dsa_main, dsa_options, &quot;pkey&quot;},
-#endif
-#if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;dsaparam&quot;, dsaparam_main, dsaparam_options, &quot;pkeyparam&quot;},
-#endif
-#if !defined(OPENSSL_NO_EC) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;ec&quot;, ec_main, ec_options, &quot;pkey&quot;},
-#endif
-#if !defined(OPENSSL_NO_EC) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;ecparam&quot;, ecparam_main, ecparam_options, &quot;pkeyparam&quot;},
-#endif
-    {FT_general, &quot;enc&quot;, enc_main, enc_options, NULL},
-#ifndef OPENSSL_NO_ENGINE
-    {FT_general, &quot;engine&quot;, engine_main, engine_options, NULL},
-#endif
-    {FT_general, &quot;errstr&quot;, errstr_main, errstr_options, NULL},
-    {FT_general, &quot;fipsinstall&quot;, fipsinstall_main, fipsinstall_options, NULL},
-#if !defined(OPENSSL_NO_DSA) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;gendsa&quot;, gendsa_main, gendsa_options, &quot;genpkey&quot;},
-#endif
-    {FT_general, &quot;genpkey&quot;, genpkey_main, genpkey_options, NULL},
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;genrsa&quot;, genrsa_main, genrsa_options, &quot;genpkey&quot;},
-#endif
-    {FT_general, &quot;help&quot;, help_main, help_options, NULL},
-    {FT_general, &quot;info&quot;, info_main, info_options, NULL},
-    {FT_general, &quot;kdf&quot;, kdf_main, kdf_options, NULL},
-    {FT_general, &quot;list&quot;, list_main, list_options, NULL},
-    {FT_general, &quot;mac&quot;, mac_main, mac_options, NULL},
-    {FT_general, &quot;nseq&quot;, nseq_main, nseq_options, NULL},
-#ifndef OPENSSL_NO_OCSP
-    {FT_general, &quot;ocsp&quot;, ocsp_main, ocsp_options, NULL},
-#endif
-    {FT_general, &quot;passwd&quot;, passwd_main, passwd_options, NULL},
-#ifndef OPENSSL_NO_DES
-    {FT_general, &quot;pkcs12&quot;, pkcs12_main, pkcs12_options, NULL},
-#endif
-    {FT_general, &quot;pkcs7&quot;, pkcs7_main, pkcs7_options, NULL},
-    {FT_general, &quot;pkcs8&quot;, pkcs8_main, pkcs8_options, NULL},
-    {FT_general, &quot;pkey&quot;, pkey_main, pkey_options, NULL},
-    {FT_general, &quot;pkeyparam&quot;, pkeyparam_main, pkeyparam_options, NULL},
-    {FT_general, &quot;pkeyutl&quot;, pkeyutl_main, pkeyutl_options, NULL},
-    {FT_general, &quot;prime&quot;, prime_main, prime_options, NULL},
-    {FT_general, &quot;provider&quot;, provider_main, provider_options, NULL},
-    {FT_general, &quot;rand&quot;, rand_main, rand_options, NULL},
-    {FT_general, &quot;rehash&quot;, rehash_main, rehash_options, NULL},
-    {FT_general, &quot;req&quot;, req_main, req_options, NULL},
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;rsa&quot;, rsa_main, rsa_options, &quot;pkey&quot;},
-#endif
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DEPRECATED_3_0)
-    {FT_general, &quot;rsautl&quot;, rsautl_main, rsautl_options, &quot;pkeyutl&quot;},
-#endif
-#ifndef OPENSSL_NO_SOCK
-    {FT_general, &quot;s_client&quot;, s_client_main, s_client_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SOCK
-    {FT_general, &quot;s_server&quot;, s_server_main, s_server_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SOCK
-    {FT_general, &quot;s_time&quot;, s_time_main, s_time_options, NULL},
-#endif
-    {FT_general, &quot;sess_id&quot;, sess_id_main, sess_id_options, NULL},
-    {FT_general, &quot;smime&quot;, smime_main, smime_options, NULL},
-    {FT_general, &quot;speed&quot;, speed_main, speed_options, NULL},
-    {FT_general, &quot;spkac&quot;, spkac_main, spkac_options, NULL},
-#ifndef OPENSSL_NO_SRP
-    {FT_general, &quot;srp&quot;, srp_main, srp_options, NULL},
-#endif
-    {FT_general, &quot;storeutl&quot;, storeutl_main, storeutl_options, NULL},
-#ifndef OPENSSL_NO_TS
-    {FT_general, &quot;ts&quot;, ts_main, ts_options, NULL},
-#endif
-    {FT_general, &quot;verify&quot;, verify_main, verify_options, NULL},
-    {FT_general, &quot;version&quot;, version_main, version_options, NULL},
-    {FT_general, &quot;x509&quot;, x509_main, x509_options, NULL},
-#ifndef OPENSSL_NO_MD2
-    {FT_md, &quot;md2&quot;, dgst_main, NULL, NULL},
-#endif
-#ifndef OPENSSL_NO_MD4
-    {FT_md, &quot;md4&quot;, dgst_main, NULL, NULL},
-#endif
-    {FT_md, &quot;md5&quot;, dgst_main, NULL, NULL},
-#ifndef OPENSSL_NO_GOST
-    {FT_md, &quot;gost&quot;, dgst_main, NULL, NULL},
-#endif
-    {FT_md, &quot;sha1&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha224&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha256&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha384&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha512&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha512-224&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha512-256&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha3-224&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha3-256&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha3-384&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;sha3-512&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;shake128&quot;, dgst_main, NULL, NULL},
-    {FT_md, &quot;shake256&quot;, dgst_main, NULL, NULL},
-#ifndef OPENSSL_NO_MDC2
-    {FT_md, &quot;mdc2&quot;, dgst_main, NULL, NULL},
-#endif
-#ifndef OPENSSL_NO_RMD160
-    {FT_md, &quot;rmd160&quot;, dgst_main, NULL, NULL},
-#endif
-#ifndef OPENSSL_NO_BLAKE2
-    {FT_md, &quot;blake2b512&quot;, dgst_main, NULL, NULL},
-#endif
-#ifndef OPENSSL_NO_BLAKE2
-    {FT_md, &quot;blake2s256&quot;, dgst_main, NULL, NULL},
-#endif
-#ifndef OPENSSL_NO_SM3
-    {FT_md, &quot;sm3&quot;, dgst_main, NULL, NULL},
-#endif
-    {FT_cipher, &quot;aes-128-cbc&quot;, enc_main, enc_options, NULL},
-    {FT_cipher, &quot;aes-128-ecb&quot;, enc_main, enc_options, NULL},
-    {FT_cipher, &quot;aes-192-cbc&quot;, enc_main, enc_options, NULL},
-    {FT_cipher, &quot;aes-192-ecb&quot;, enc_main, enc_options, NULL},
-    {FT_cipher, &quot;aes-256-cbc&quot;, enc_main, enc_options, NULL},
-    {FT_cipher, &quot;aes-256-ecb&quot;, enc_main, enc_options, NULL},
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-ctr&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-cfb1&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-128-cfb8&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-ctr&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-cfb1&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-192-cfb8&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-ctr&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-cfb1&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_ARIA
-    {FT_cipher, &quot;aria-256-cfb8&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAMELLIA
-    {FT_cipher, &quot;camellia-128-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAMELLIA
-    {FT_cipher, &quot;camellia-128-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAMELLIA
-    {FT_cipher, &quot;camellia-192-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAMELLIA
-    {FT_cipher, &quot;camellia-192-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAMELLIA
-    {FT_cipher, &quot;camellia-256-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAMELLIA
-    {FT_cipher, &quot;camellia-256-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-    {FT_cipher, &quot;base64&quot;, enc_main, enc_options, NULL},
-#ifdef ZLIB
-    {FT_cipher, &quot;zlib&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des3&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;desx&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_IDEA
-    {FT_cipher, &quot;idea&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SEED
-    {FT_cipher, &quot;seed&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC4
-    {FT_cipher, &quot;rc4&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC4
-    {FT_cipher, &quot;rc4-40&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_BF
-    {FT_cipher, &quot;bf&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAST
-    {FT_cipher, &quot;cast&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC5
-    {FT_cipher, &quot;rc5&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede3&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede3-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede3-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_DES
-    {FT_cipher, &quot;des-ede3-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_IDEA
-    {FT_cipher, &quot;idea-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_IDEA
-    {FT_cipher, &quot;idea-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_IDEA
-    {FT_cipher, &quot;idea-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_IDEA
-    {FT_cipher, &quot;idea-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SEED
-    {FT_cipher, &quot;seed-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SEED
-    {FT_cipher, &quot;seed-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SEED
-    {FT_cipher, &quot;seed-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SEED
-    {FT_cipher, &quot;seed-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2-64-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC2
-    {FT_cipher, &quot;rc2-40-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_BF
-    {FT_cipher, &quot;bf-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_BF
-    {FT_cipher, &quot;bf-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_BF
-    {FT_cipher, &quot;bf-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_BF
-    {FT_cipher, &quot;bf-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAST
-    {FT_cipher, &quot;cast5-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAST
-    {FT_cipher, &quot;cast5-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAST
-    {FT_cipher, &quot;cast5-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAST
-    {FT_cipher, &quot;cast5-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_CAST
-    {FT_cipher, &quot;cast-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC5
-    {FT_cipher, &quot;rc5-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC5
-    {FT_cipher, &quot;rc5-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC5
-    {FT_cipher, &quot;rc5-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_RC5
-    {FT_cipher, &quot;rc5-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SM4
-    {FT_cipher, &quot;sm4-cbc&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SM4
-    {FT_cipher, &quot;sm4-ecb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SM4
-    {FT_cipher, &quot;sm4-cfb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SM4
-    {FT_cipher, &quot;sm4-ofb&quot;, enc_main, enc_options, NULL},
-#endif
-#ifndef OPENSSL_NO_SM4
-    {FT_cipher, &quot;sm4-ctr&quot;, enc_main, enc_options, NULL},
-#endif
-    {0, NULL, NULL, NULL, NULL}
-};
diff --git a/apps/progs.h b/apps/progs.h
deleted file mode 100644
index 04e9c4e922..0000000000
--- a/apps/progs.h
+++ /dev/null
@@ -1,123 +0,0 @@
-/*
- * WARNING: do not edit!
- * Generated by apps/progs.pl
- *
- * Copyright 1995-2020 The OpenSSL Project Authors. All Rights Reserved.
- *
- * Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
- * this file except in compliance with the License.  You can obtain a copy
- * in the file LICENSE in the source distribution or at
- * <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
- */
-
-#include &quot;function.h&quot;
-
-extern int asn1parse_main(int argc, char *argv[]);
-extern int ca_main(int argc, char *argv[]);
-extern int ciphers_main(int argc, char *argv[]);
-extern int cms_main(int argc, char *argv[]);
-extern int crl_main(int argc, char *argv[]);
-extern int crl2pkcs7_main(int argc, char *argv[]);
-extern int dgst_main(int argc, char *argv[]);
-extern int dhparam_main(int argc, char *argv[]);
-extern int dsa_main(int argc, char *argv[]);
-extern int dsaparam_main(int argc, char *argv[]);
-extern int ec_main(int argc, char *argv[]);
-extern int ecparam_main(int argc, char *argv[]);
-extern int enc_main(int argc, char *argv[]);
-extern int engine_main(int argc, char *argv[]);
-extern int errstr_main(int argc, char *argv[]);
-extern int fipsinstall_main(int argc, char *argv[]);
-extern int gendsa_main(int argc, char *argv[]);
-extern int genpkey_main(int argc, char *argv[]);
-extern int genrsa_main(int argc, char *argv[]);
-extern int help_main(int argc, char *argv[]);
-extern int info_main(int argc, char *argv[]);
-extern int kdf_main(int argc, char *argv[]);
-extern int list_main(int argc, char *argv[]);
-extern int mac_main(int argc, char *argv[]);
-extern int nseq_main(int argc, char *argv[]);
-extern int ocsp_main(int argc, char *argv[]);
-extern int passwd_main(int argc, char *argv[]);
-extern int pkcs12_main(int argc, char *argv[]);
-extern int pkcs7_main(int argc, char *argv[]);
-extern int pkcs8_main(int argc, char *argv[]);
-extern int pkey_main(int argc, char *argv[]);
-extern int pkeyparam_main(int argc, char *argv[]);
-extern int pkeyutl_main(int argc, char *argv[]);
-extern int prime_main(int argc, char *argv[]);
-extern int provider_main(int argc, char *argv[]);
-extern int rand_main(int argc, char *argv[]);
-extern int rehash_main(int argc, char *argv[]);
-extern int req_main(int argc, char *argv[]);
-extern int rsa_main(int argc, char *argv[]);
-extern int rsautl_main(int argc, char *argv[]);
-extern int s_client_main(int argc, char *argv[]);
-extern int s_server_main(int argc, char *argv[]);
-extern int s_time_main(int argc, char *argv[]);
-extern int sess_id_main(int argc, char *argv[]);
-extern int smime_main(int argc, char *argv[]);
-extern int speed_main(int argc, char *argv[]);
-extern int spkac_main(int argc, char *argv[]);
-extern int srp_main(int argc, char *argv[]);
-extern int storeutl_main(int argc, char *argv[]);
-extern int ts_main(int argc, char *argv[]);
-extern int verify_main(int argc, char *argv[]);
-extern int version_main(int argc, char *argv[]);
-extern int x509_main(int argc, char *argv[]);
-
-extern const OPTIONS asn1parse_options[];
-extern const OPTIONS ca_options[];
-extern const OPTIONS ciphers_options[];
-extern const OPTIONS cms_options[];
-extern const OPTIONS crl_options[];
-extern const OPTIONS crl2pkcs7_options[];
-extern const OPTIONS dgst_options[];
-extern const OPTIONS dhparam_options[];
-extern const OPTIONS dsa_options[];
-extern const OPTIONS dsaparam_options[];
-extern const OPTIONS ec_options[];
-extern const OPTIONS ecparam_options[];
-extern const OPTIONS enc_options[];
-extern const OPTIONS engine_options[];
-extern const OPTIONS errstr_options[];
-extern const OPTIONS fipsinstall_options[];
-extern const OPTIONS gendsa_options[];
-extern const OPTIONS genpkey_options[];
-extern const OPTIONS genrsa_options[];
-extern const OPTIONS help_options[];
-extern const OPTIONS info_options[];
-extern const OPTIONS kdf_options[];
-extern const OPTIONS list_options[];
-extern const OPTIONS mac_options[];
-extern const OPTIONS nseq_options[];
-extern const OPTIONS ocsp_options[];
-extern const OPTIONS passwd_options[];
-extern const OPTIONS pkcs12_options[];
-extern const OPTIONS pkcs7_options[];
-extern const OPTIONS pkcs8_options[];
-extern const OPTIONS pkey_options[];
-extern const OPTIONS pkeyparam_options[];
-extern const OPTIONS pkeyutl_options[];
-extern const OPTIONS prime_options[];
-extern const OPTIONS provider_options[];
-extern const OPTIONS rand_options[];
-extern const OPTIONS rehash_options[];
-extern const OPTIONS req_options[];
-extern const OPTIONS rsa_options[];
-extern const OPTIONS rsautl_options[];
-extern const OPTIONS s_client_options[];
-extern const OPTIONS s_server_options[];
-extern const OPTIONS s_time_options[];
-extern const OPTIONS sess_id_options[];
-extern const OPTIONS smime_options[];
-extern const OPTIONS speed_options[];
-extern const OPTIONS spkac_options[];
-extern const OPTIONS srp_options[];
-extern const OPTIONS storeutl_options[];
-extern const OPTIONS ts_options[];
-extern const OPTIONS verify_options[];
-extern const OPTIONS version_options[];
-extern const OPTIONS x509_options[];
-
-extern FUNCTION functions[];
diff --git a/doc/internal/man7/build.info.pod b/doc/internal/man7/build.info.pod
index 2be709f770..f6ca49067d 100644
--- a/doc/internal/man7/build.info.pod
+++ b/doc/internal/man7/build.info.pod
@@ -24,7 +24,7 @@ B&lt;MODULES=&gt; I&lt;name&gt; ...
 
 B&lt;SCRIPTS=&gt; I&lt;name&gt; ...
 
-B&lt;DEPEND[&gt;I&lt;item&gt;B&lt;]=&gt; I&lt;otheritem&gt; ...
+B&lt;DEPEND[&gt;I&lt;items&gt;B&lt;]=&gt; I&lt;otheritem&gt; ...
 
 B&lt;GENERATE[&gt;I&lt;item&gt;B&lt;]=&gt; I&lt;generator&gt; I&lt;generator-args&gt; ...
 
@@ -32,9 +32,9 @@ B&lt;SOURCE[&gt;I&lt;item&gt;B&lt;]=&gt; I&lt;file&gt; ...
 
 B&lt;SHARED_SOURCE[&gt;I&lt;item&gt;B&lt;]=&gt; I&lt;file&gt; ...
 
-B&lt;DEFINE[&gt;I&lt;item&gt;B&lt;]=&gt; I&lt;name&gt;[B&lt;=&gt;I&lt;value&gt;] ...
+B&lt;DEFINE[&gt;I&lt;items&gt;B&lt;]=&gt; I&lt;name&gt;[B&lt;=&gt;I&lt;value&gt;] ...
 
-B&lt;INCLUDE[&gt;I&lt;item&gt;B&lt;]=&gt; I&lt;dir&gt; ...
+B&lt;INCLUDE[&gt;I&lt;items&gt;B&lt;]=&gt; I&lt;dir&gt; ...
 
 B&lt;$&gt;I&lt;VARIABLE&gt;B&lt;=&gt;I&lt;value&gt;
 
@@ -122,7 +122,7 @@ syntax is one of:
 
 =item B&lt;I&lt;KEYWORD&gt;&gt; B&lt;=&gt; I&lt;value&gt; ...
 
-=item B&lt;I&lt;KEYWORD&gt;[&gt;I&lt;item&gt;B&lt;]&gt; B&lt;=&gt; I&lt;value&gt; ...
+=item B&lt;I&lt;KEYWORD&gt;[&gt;I&lt;items&gt;B&lt;]&gt; B&lt;=&gt; I&lt;value&gt; ...
 
 =back
 
@@ -154,8 +154,14 @@ F&lt;foo.c&gt; and F&lt;details.c&gt;, and that it depends on the library
 C&lt;libcookie&gt; (in other words, the library will be included when
 linking that program together).
 
-For any indexed statement for which the item hasn't been specified
-through any plain statement, or where the item exists but the indexed
+Multiple space separated items are allowed too:
+
+    SOURCE[foo]=foo.c
+    SOURCE[details]=details.c
+    DEPEND[foo details]=libcookie
+
+For any indexed statement for which the items haven't been specified
+through any plain statement, or where the items exists but the indexed
 statement does not apply, the value is simply ignored by the build
 file generators.
 
@@ -169,7 +175,7 @@ variations on how they are treated.
 =item B&lt;I&lt;KEYWORD&gt;{&gt; I&lt;attrib&gt; | I&lt;attrib&gt;B&lt;=&gt;I&lt;attrib-value&gt; [,...]B&lt;}&gt;
 B&lt;=&gt; I&lt;value&gt; ...
 
-=item B&lt;I&lt;KEYWORD&gt;[&gt;I&lt;item&gt;B&lt;]{&gt; I&lt;attrib&gt; | I&lt;attrib&gt;B&lt;=&gt;I&lt;attrib-value&gt;
+=item B&lt;I&lt;KEYWORD&gt;[&gt;I&lt;items&gt;B&lt;]{&gt; I&lt;attrib&gt; | I&lt;attrib&gt;B&lt;=&gt;I&lt;attrib-value&gt;
 [,...]B&lt;}&gt; B&lt;=&gt; I&lt;value&gt; ...
 
 =back
@@ -264,6 +270,22 @@ part of is tokenized&gt;.
 
 I&lt;Variable assignment values are not tokenized.&gt;
 
+Variable references can be one of:
+
+=over 4
+
+=item B&lt;$&gt;I&lt;NAME&gt; or B&lt;${&gt;I&lt;NAME&gt;B&lt;}&gt;
+
+Simple reference; the variable reference is replaced with its value,
+verbatim.
+
+=item B&lt;${&gt;I&lt;NAME&gt;B&lt;/&gt;I&lt;str&gt;B&lt;/&gt;I&lt;subst&gt;B&lt;}&gt;
+
+Substitution reference; the variable reference is replaced with its
+value, modified by replacing all occurences of I&lt;str&gt; with I&lt;subst&gt;.
+
+=back
+
 =head2 Scope
 
 Most of the statement values are accumulated globally from all the
@@ -411,15 +433,15 @@ C&lt;noinst&gt;, while the script C&lt;bar&gt; will.
 
 =over 4
 
-=item B&lt;DEPEND[&gt;I&lt;item&gt;B&lt;]&gt; B&lt;=&gt; I&lt;file&gt; ...
+=item B&lt;DEPEND[&gt;I&lt;items&gt;B&lt;]&gt; B&lt;=&gt; I&lt;file&gt; ...
 
-Collects dependencies, where I&lt;item&gt; depends on the given I&lt;file&gt;s.
+Collects dependencies, where I&lt;items&gt; depend on the given I&lt;file&gt;s.
 
-As a special case, the I&lt;item&gt; may be empty, for which the build file
+As a special case, the I&lt;items&gt; may be empty, for which the build file
 generators should make the whole build depend on the given I&lt;file&gt;s,
-rather than some specific I&lt;item&gt;.
+rather than the specific I&lt;items&gt;.
 
-The I&lt;item&gt; may be any program, library, module, script, or any
+The I&lt;items&gt; may be any program, library, module, script, or any
 filename used as a value anywhere.
 
 B&lt;DEPEND&gt; statements may have attributes, which apply to each
@@ -473,19 +495,19 @@ given with B&lt;LIBS&gt; or B&lt;MODULES&gt;.  For libraries, the given filenames
 are only used for their shared form, so if the item is a library name
 ending with C&lt;.a&gt;, the filenames will be ignored.
 
-=item B&lt;DEFINE[&gt;I&lt;item&gt;B&lt;]&gt; B&lt;=&gt; I&lt;name&gt;[B&lt;=&gt;I&lt;value&gt;] ...
+=item B&lt;DEFINE[&gt;I&lt;items&gt;B&lt;]&gt; B&lt;=&gt; I&lt;name&gt;[B&lt;=&gt;I&lt;value&gt;] ...
 
 Collects I&lt;name&gt; / I&lt;value&gt; pairs (or just I&lt;name&gt; with no defined
-value if no I&lt;value&gt; is given) associated with I&lt;item&gt;.
+value if no I&lt;value&gt; is given) associated with I&lt;items&gt;.
 
 The build file generators will decide what to do with them.  For
 example, these pairs should become C macro definitions whenever a
 C&lt;.c&gt; file is built into an object file.
 
-=item B&lt;INCLUDE[&gt;I&lt;item&gt;B&lt;]&gt; B&lt;=&gt; I&lt;dir&gt; ...
+=item B&lt;INCLUDE[&gt;I&lt;items&gt;B&lt;]&gt; B&lt;=&gt; I&lt;dir&gt; ...
 
 Collects inclusion directories that will be used when building the
-I&lt;item&gt; components (object files and whatever else).  This is used at
+I&lt;items&gt; components (object files and whatever else).  This is used at
 the discretion of the build file generators.
 
 =back
@@ -568,7 +590,7 @@ the exception of conditional statements and variable assignments.
 
 =item &quot;indexed statement&quot;
 
-Any F&lt;build.info&gt; statement of the form B&lt;I&lt;KEYWORD&gt;[&gt;I&lt;item&gt;B&lt;]=&gt;I&lt;values&gt;,
+Any F&lt;build.info&gt; statement of the form B&lt;I&lt;KEYWORD&gt;[&gt;I&lt;items&gt;B&lt;]=&gt;I&lt;values&gt;,
 with the exception of conditional statements.
 
 =item &quot;intermediate file&quot;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027750.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="027764.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27751">[ date ]</a>
              <a href="thread.html#27751">[ thread ]</a>
              <a href="subject.html#27751">[ subject ]</a>
              <a href="author.html#27751">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
