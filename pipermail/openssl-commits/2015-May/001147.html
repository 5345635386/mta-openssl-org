<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-May/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1432335003.469487.19516.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001142.html">
   <LINK REL="Next"  HREF="001152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Matt Caswell</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1432335003.469487.19516.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">matt at openssl.org
       </A><BR>
    <I>Fri May 22 22:50:03 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001142.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="001152.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1147">[ date ]</a>
              <a href="thread.html#1147">[ thread ]</a>
              <a href="subject.html#1147">[ subject ]</a>
              <a href="author.html#1147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  efee575ad464bfb60bf72dcb73f9b51768f4b1a1 (commit)
      from  7cc18d8158b5fc2676393d99b51c30c135502107 (commit)


- Log -----------------------------------------------------------------
commit efee575ad464bfb60bf72dcb73f9b51768f4b1a1
Author: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
Date:   Tue May 19 16:03:02 2015 +0100

    Fix off-by-one in BN_rand
    
    If BN_rand is called with |bits| set to 1 and |top| set to 1 then a 1 byte
    buffer overflow can occur. There are no such instances within the OpenSSL at
    the moment.
    
    Thanks to Mateusz Kocielski (LogicalTrust), Marek Kroemeke, Filip Palian for
    discovering and reporting this issue.
    
    Reviewed-by: Kurt Roeckx &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">kurt at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 crypto/bn/bn_rand.c    | 7 ++++++-
 doc/crypto/BN_rand.pod | 3 ++-
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/crypto/bn/bn_rand.c b/crypto/bn/bn_rand.c
index 4dd3f92..2764c8a 100644
--- a/crypto/bn/bn_rand.c
+++ b/crypto/bn/bn_rand.c
@@ -122,6 +122,11 @@ static int bnrand(int pseudorand, BIGNUM *rnd, int bits, int top, int bottom)
     int ret = 0, bit, bytes, mask;
     time_t tim;
 
+    if (bits &lt; 0 || (bits == 1 &amp;&amp; top &gt; 0)) {
+        BNerr(BN_F_BNRAND, BN_R_BITS_TOO_SMALL);
+        return 0;
+    }
+
     if (bits == 0) {
         BN_zero(rnd);
         return 1;
@@ -168,7 +173,7 @@ static int bnrand(int pseudorand, BIGNUM *rnd, int bits, int top, int bottom)
         }
     }
 
-    if (top != -1) {
+    if (top &gt;= 0) {
         if (top) {
             if (bit == 0) {
                 buf[0] = 1;
diff --git a/doc/crypto/BN_rand.pod b/doc/crypto/BN_rand.pod
index d6b975c..bd6bc86 100644
--- a/doc/crypto/BN_rand.pod
+++ b/doc/crypto/BN_rand.pod
@@ -24,7 +24,8 @@ most significant bit of the random number can be zero. If B&lt;top&gt; is 0,
 it is set to 1, and if B&lt;top&gt; is 1, the two most significant bits of
 the number will be set to 1, so that the product of two such random
 numbers will always have 2*B&lt;bits&gt; length.  If B&lt;bottom&gt; is true, the
-number will be odd.
+number will be odd. The value of B&lt;bits&gt; must be zero or greater. If B&lt;bits&gt; is
+1 then B&lt;top&gt; cannot also be 1.
 
 BN_pseudo_rand() does the same, but pseudo-random numbers generated by
 this function are not necessarily unpredictable. They can be used for
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001142.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="001152.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1147">[ date ]</a>
              <a href="thread.html#1147">[ thread ]</a>
              <a href="subject.html#1147">[ subject ]</a>
              <a href="author.html#1147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
