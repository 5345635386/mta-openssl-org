<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2021-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1618823464.153326.30521.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033907.html">
   <LINK REL="Next"  HREF="033910.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>beldmit at gmail.com</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1618823464.153326.30521.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">beldmit at gmail.com
       </A><BR>
    <I>Mon Apr 19 09:11:04 UTC 2021</I>
    <P><UL>
        <LI>Previous message: <A HREF="033907.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="033910.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33909">[ date ]</a>
              <a href="thread.html#33909">[ thread ]</a>
              <a href="subject.html#33909">[ subject ]</a>
              <a href="author.html#33909">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  5ae52001e115452ca285713feb1c2feaf07902ad (commit)
       via  daf98015aac8bf392cf95edf9a54d845c1c22fd7 (commit)
       via  491a1e3363228e8276ee293a86acd7a961ffe9d3 (commit)
       via  16f2a44435fccbd7466b0659220c765a17e5d0c0 (commit)
       via  96d4ec6724a9ecc5d193172d0cf1a347f428372a (commit)
       via  6afb36342d4bc63a774fd96088ededfc00401e1d (commit)
       via  5fee3fe2760d65a141873601c4b7b9fd2fc5c7b1 (commit)
       via  c4f4cb14e3f06362c2ee9e0e480b816ab46f15b6 (commit)
       via  55aa235e85e156bf71c339804ef317ad4d0f27a5 (commit)
       via  d5a6b54b49905cdb4edfe1e1caf9656896171cb6 (commit)
       via  847f41d97c966707d45da5640792e3bd8f8d23fd (commit)
       via  583a9f1f6b0d0842f8d63a21c335b24494fc67bc (commit)
       via  f1ee757daaf8ea1000c6558abd1ffc8ad5234c09 (commit)
       via  a8368d573e5b4553e7344dd37239da6d72480832 (commit)
       via  a75a87561b491fc9b96b15153eba1f5e142280c5 (commit)
       via  830cd025b199fab165a378884fb5b4373799bde9 (commit)
       via  8557bdde4836b4dc63ad305c9f3c648816a05e86 (commit)
       via  e15eff3aaabe17be37ec42ae7ca342cbf2a2733c (commit)
       via  118faf5ffe2ba495407f482a8d8438b7d266815c (commit)
       via  23f3242ffe8613411714eb9350275371059c7bfe (commit)
       via  1bb381227b432676451ead3f9d4b92352464e9cc (commit)
      from  a4afa6c1d00c027a5afc8974a298e0f54607f1b5 (commit)


- Log -----------------------------------------------------------------
commit 5ae52001e115452ca285713feb1c2feaf07902ad
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Mon Dec 14 23:31:49 2020 +0000

    Remove crypt32.lib from C++Builder configuration
    
    `import32.lib` serves the purpose for most Windows API libraries, including this one. For example, with a GNU `grep` utility:
    
    &gt;tdump %BDS%\lib\win32c\release\import32.lib | grep -B 3 -A 1 CertOpenStore
    171E32 COMENT  Purge: Yes, List: Yes, Class: 160 (0A0h), SubClass: 1 (01h)
        Dynamic link import (IMPDEF)
          Imported by: name
          Internal Name: CertOpenStore
          Module Name: CRYPT32.dll
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit daf98015aac8bf392cf95edf9a54d845c1c22fd7
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sun Dec 13 18:04:43 2020 +0000

    Link with uplink module
    
    The Clang-based `bcc32c.exe` expects AT&amp;T syntax for inline assembly.
    References:
     - <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Differences_Between_Clang-enhanced_C%2B%2B_Compilers_and_Previous-Generation_C%2B%2B_Compilers#Inline_Assembly">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Differences_Between_Clang-enhanced_C%2B%2B_Compilers_and_Previous-Generation_C%2B%2B_Compilers#Inline_Assembly</A>
     - <A HREF="https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html">https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html</A>
     - <A HREF="https://sourceware.org/binutils/docs/as/i386_002dVariations.html">https://sourceware.org/binutils/docs/as/i386_002dVariations.html</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 491a1e3363228e8276ee293a86acd7a961ffe9d3
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sun Dec 13 18:01:46 2020 +0000

    Link with .def files
    
    MSVC's `link.exe` automatically finds `__cdecl` C functions (which are
    decorated with a leading underscore by the compiler) when they are
    mentioned in a `.def` file without the leading underscore.  This is an
    [under-documented feature][1] of MSVC's `link.exe`.  C++Builder's
    `ilink32.exe` doesn't do this, and thus needs the name-translation in
    the `.def` file.  Then `implib.exe` needs to be told to re-add it.
    
    (The Clang-based `bcc32c.exe` doesn't implement the [`-vu` or `-u-`][2]
    options to skip adding the leading underscore to `__cdecl` C function
    names, so this is the only way to have things work with non-underscored
    export names in the DLLs.)
    
    [1]: <A HREF="https://github.com/MicrosoftDocs/cpp-docs/issues/2653">https://github.com/MicrosoftDocs/cpp-docs/issues/2653</A>
    [2]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Options_Not_Supported_by_Clang-enhanced_C%2B%2B_Compilers#BCC32_Options_that_Are_Not_Supported_by_Clang-enhanced_C.2B.2B_Compilers">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Options_Not_Supported_by_Clang-enhanced_C%2B%2B_Compilers#BCC32_Options_that_Are_Not_Supported_by_Clang-enhanced_C.2B.2B_Compilers</A>
    
    Also silence linker warnings on duplicate symbols and ensure that error-
    case cleanup in link rules work in C++Builder's `make.exe`.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 16f2a44435fccbd7466b0659220c765a17e5d0c0
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Thu Dec 10 14:53:07 2020 +0000

    Generate dependency information
    
    The Clang-based `bcc32c.exe` doesn't implement the `-Hp` option, so we
    have to use [`cpp32.exe`][1] instead.  Therefore, change the dependency-
    emitting command to use `$(CPP)` instead of `$(CC)`, which which also
    uncovered the [existing bug of `2&gt;&amp;1` before `&gt; $dep`][2].  Also
    C++Builder's `make.exe` doesn't implement `2&gt;&amp;1` in its command runner,
    so wrap the whole line in a `cmd /C`.
    
    [1]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/CPP32.EXE,_the_C_Compiler_Preprocessor">http://docwiki.embarcadero.com/RADStudio/Sydney/en/CPP32.EXE,_the_C_Compiler_Preprocessor</A>
    [2]: <A HREF="https://ss64.com/nt/syntax-redirection.html">https://ss64.com/nt/syntax-redirection.html</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 96d4ec6724a9ecc5d193172d0cf1a347f428372a
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Wed Dec 9 00:45:11 2020 +0000

    Avoid more MSVC-specific C runtime library functions
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 6afb36342d4bc63a774fd96088ededfc00401e1d
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Wed Dec 9 00:29:14 2020 +0000

    Build resource files
    
    We need to compile with [brcc32.exe][1] and link with [ilink32.exe][2].
    The latter expects the `.res` files to be given in the final comma-
    separated section in the command line (after the `.def` file).
    
    [1]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/BRCC32.EXE,_the_Resource_Compiler">http://docwiki.embarcadero.com/RADStudio/Sydney/en/BRCC32.EXE,_the_Resource_Compiler</A>
    [2]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Using_ILINK32_and_ILINK64_on_the_Command_Line#Command-Line_Elements">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Using_ILINK32_and_ILINK64_on_the_Command_Line#Command-Line_Elements</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 5fee3fe2760d65a141873601c4b7b9fd2fc5c7b1
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sun Dec 6 23:04:45 2020 +0000

    Support DLL builds + Fix C RTL variants
    
    We need to generate a import library without the version in the
    filename. MSVC's `link.exe` accommodates this with the [`/implib:`
    option][1], while C++Builder needs a separate run of [`implib.exe`][2].
    Also fix the variants of the [C runtime library and startup objects][3].
    
    [1]: <A HREF="https://docs.microsoft.com/en-us/cpp/build/reference/implib-name-import-library?view=msvc-160">https://docs.microsoft.com/en-us/cpp/build/reference/implib-name-import-library?view=msvc-160</A>
    [2]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/IMPLIB.EXE,_the_Import_Library_Tool_for_Win32">http://docwiki.embarcadero.com/RADStudio/Sydney/en/IMPLIB.EXE,_the_Import_Library_Tool_for_Win32</A>
    [3]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Static_Runtime_Libraries">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Static_Runtime_Libraries</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit c4f4cb14e3f06362c2ee9e0e480b816ab46f15b6
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 28 22:56:53 2020 +0000

    Ensure cw32mt.lib and import32.lib are linked to in no-sock mode
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 55aa235e85e156bf71c339804ef317ad4d0f27a5
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 28 02:21:03 2020 +0000

    Document C++Builder usage in NOTES-WINDOWS.md
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit d5a6b54b49905cdb4edfe1e1caf9656896171cb6
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 28 02:11:28 2020 +0000

    Replace &quot;ld_wildcard_args&quot; with &quot;bin_lflags&quot;
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 847f41d97c966707d45da5640792e3bd8f8d23fd
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Fri Nov 27 14:22:38 2020 +0000

    Add explanation + bugtracker link for quoted dependency workarounds
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 583a9f1f6b0d0842f8d63a21c335b24494fc67bc
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Thu Nov 26 15:38:40 2020 +0000

    Use cmd.exe to export env vars before commands
    
    Microsoft NMake runs the entire command block in a single `cmd.exe`
    session, so environment variables exported with `set` are seen by the
    following commands. C++Builder's `make.exe` doesn't use `cmd.exe` but
    executes each command line separately. While it emulates only certain
    shell features itself, `set` isn't one of them.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit f1ee757daaf8ea1000c6558abd1ffc8ad5234c09
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Thu Nov 19 23:39:12 2020 +0000

    Resurrect and modernize C++Builder config
    
    Similar configuration to what was deleted in 8e56a422, updated for the
    unified build scheme. Use the [Clang-based `bcc32c.exe`][1] to avoid a
    [bug][2] with the old one, and increase the `tlib.exe` page size to 256.
    Also avoid MSVC-specific C runtime library functions.
    
    [1]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Win32_Clang-enhanced_Compilers">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Win32_Clang-enhanced_Compilers</A>
    [2]: <A HREF="https://quality.embarcadero.com/browse/RSP-31630">https://quality.embarcadero.com/browse/RSP-31630</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit a8368d573e5b4553e7344dd37239da6d72480832
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Thu Nov 19 23:25:22 2020 +0000

    Avoid redirection to quoted filename
    
    C++Builder's `make.exe` cannot handle a command output redirection to a
    quoted filename, saying: &quot;The system cannot find the file specified.&quot;
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit a75a87561b491fc9b96b15153eba1f5e142280c5
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Thu Nov 19 17:57:46 2020 +0000

    Generalize link rule in windows-makefile.tmpl
    
    C++Builder's [`ilink32.exe`][1] expects its different types of input /
    output files to be in a particular sequence and comma-separated -- even
    in the response file as experimentation revealed, contrary to what is
    documented. The lines of the response file need to end with `+`.
    
    Also [`setargv.obj`][2] is MSVC-specific. The C++Builder equivalent is
    [`wildargs.obj`][3].
    
    [1]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Using_ILINK32_and_ILINK64_on_the_Command_Line">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Using_ILINK32_and_ILINK64_on_the_Command_Line</A>
    [2]: <A HREF="https://docs.microsoft.com/en-us/cpp/c-language/expanding-wildcard-arguments?view=msvc-160">https://docs.microsoft.com/en-us/cpp/c-language/expanding-wildcard-arguments?view=msvc-160</A>
    [3]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/Wildcard_Arguments">http://docwiki.embarcadero.com/RADStudio/Sydney/en/Wildcard_Arguments</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 830cd025b199fab165a378884fb5b4373799bde9
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Mon Nov 16 22:52:44 2020 +0000

    Ensure at least one command if no dependencies
    
    C++Builder's `make.exe` complains if a target has no dependencies (e.g.
    after variable expansion) and no lines of commands. Ensure there is a
    blank command line if the dependency list is entirely made of variables.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 8557bdde4836b4dc63ad305c9f3c648816a05e86
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sun Nov 15 20:57:49 2020 +0000

    Avoid quoting dependency filepaths in build tree
    
    C++Builder's `make.exe` has a bug in finding the rule of a quoted
    dependency that doesn't exist in the filesystem. So for example:
    
        A: &quot;src\B&quot; &quot;out\C&quot;
        	touch $@
        out\C:
        	mkdir out
        	touch $@
    
    leads to:
        Fatal: '&quot;out\C&quot;' does not exist - don't know how to make it
    
    This happens even with the `-N` option, and is different behavior from
    Microsoft NMake which documents the feature of [quoted filepaths][1].
    
    Commit cb663908 quoted all dependency filepaths, in case they are used
    in a out-of-source build. The quoting is not done for target names,
    however, which implies that the build directory is still expected to not
    have spaces. It follows that we only need to quote non-generated source
    files in dependency lists, since generated source files will be created
    in the build directory.
    
    Change the logic accordingly as a workaround, so that it works at least
    for in-source builds with C++Builder's `make.exe`.
    
    [1]: <A HREF="https://docs.microsoft.com/cpp/build/reference/long-filenames-in-a-makefile?view=msvc-160">https://docs.microsoft.com/cpp/build/reference/long-filenames-in-a-makefile?view=msvc-160</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit e15eff3aaabe17be37ec42ae7ca342cbf2a2733c
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 7 20:49:47 2020 +0000

    Generalize delimiter in archiver response file
    
    While [`lib.exe` of MSVC][1] expects newline-delimited response file
    lines, [`tlib.exe` of C++Builder][2] expects lines to end with `&amp;` in
    order to read the next line.
    
    [1]: <A HREF="https://docs.microsoft.com/cpp/build/reference/running-lib?view=msvc-160#lib-command-files">https://docs.microsoft.com/cpp/build/reference/running-lib?view=msvc-160#lib-command-files</A>
    [2]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/TLIB.EXE,_the_Library_Manager#Response_Files">http://docwiki.embarcadero.com/RADStudio/Sydney/en/TLIB.EXE,_the_Library_Manager#Response_Files</A>
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 118faf5ffe2ba495407f482a8d8438b7d266815c
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 7 14:11:05 2020 +0000

    Avoid space between &quot;-I&quot; and include directory
    
    The space is problematic with C++Builder (`bcc32.exe`). MSVC (`cl.exe`)
    doesn't care.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 23f3242ffe8613411714eb9350275371059c7bfe
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 7 13:13:34 2020 +0000

    Move VS Tools configuration to VC-common target
    
    The Windows toolchain is composed of utilites from both the Windows SDK
    and the Visual Studio Build Tools. Move the configuration of the latter
    utilities into the `VC-common` template inside `10-main.conf`, while
    leaving the former utilities in `BASE_Windows`. This allows for other
    Windows compilers to be configured inheriting from `BASE_Windows`.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

commit 1bb381227b432676451ead3f9d4b92352464e9cc
Author: Tanzinul Islam &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tanzinul.islam at gmail.com</A>&gt;
Date:   Sat Nov 7 12:52:30 2020 +0000

    Avoid &quot;&amp;&amp;&quot; in windows-makefile.tmpl
    
    The `make.exe` utility shipped with Embarcadero C++Builder has a special
    meaning for the [`&amp;&amp;` operator in commands][1]. This meaning is retained
    even in Microsoft NMake compatibility mode (`make -N`). Split all
    commands using this shell (`cmd.exe`) operator into two commands.
    
    [1]: <A HREF="http://docwiki.embarcadero.com/RADStudio/Sydney/en/MAKE_Rules_(Explicit_and_Implicit">http://docwiki.embarcadero.com/RADStudio/Sydney/en/MAKE_Rules_(Explicit_and_Implicit</A>)_and_Commands#MAKE_Command_Operators
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13540">https://github.com/openssl/openssl/pull/13540</A>)

-----------------------------------------------------------------------

Summary of changes:
 .gitignore                                    |   2 +
 Configurations/00-base-templates.conf         |   8 --
 Configurations/10-main.conf                   |  19 +++-
 Configurations/50-cppbuilder.conf             |  56 ++++++++++++
 Configurations/platform/Windows/cppbuilder.pm |  16 ++++
 Configurations/windows-makefile.tmpl          | 126 +++++++++++++++-----------
 Configure                                     |   6 +-
 NOTES-WINDOWS.md                              |  30 ++++++
 apps/build.info                               |   2 +-
 apps/cmp.c                                    |   2 +-
 apps/lib/apps.c                               |   2 +-
 apps/lib/build.info                           |   2 +-
 build.info                                    |   2 +-
 crypto/bio/bss_file.c                         |   2 +-
 crypto/build.info                             |   2 +-
 crypto/conf/conf_sap.c                        |   2 +-
 crypto/init.c                                 |   2 +-
 ms/applink.c                                  |   6 ++
 ms/uplink.c                                   |  19 +++-
 test/build.info                               |   2 +-
 test/conf_include_test.c                      |   4 +-
 test/testutil/driver.c                        |   2 +-
 util/add-depends.pl                           |  19 +++-
 util/mkdef.pl                                 |   8 +-
 24 files changed, 254 insertions(+), 87 deletions(-)
 create mode 100644 Configurations/50-cppbuilder.conf
 create mode 100644 Configurations/platform/Windows/cppbuilder.pm

diff --git a/.gitignore b/.gitignore
index 7a07450106..b88ede1d59 100644
--- a/.gitignore
+++ b/.gitignore
@@ -212,6 +212,7 @@ providers/common/include/prov/der_sm2.h
 *.exp
 *.lib
 *.pdb
+*.tds
 *.ilk
 *.def
 *.rc
@@ -227,6 +228,7 @@ cscope.*
 *.d
 *.d.tmp
 pod2htmd.tmp
+MAKE0[0-9][0-9][0-9].@@@
 
 # Windows manifest files
 *.manifest
diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
index 1da5c5f0d0..0e5d38d5a6 100644
--- a/Configurations/00-base-templates.conf
+++ b/Configurations/00-base-templates.conf
@@ -108,14 +108,6 @@ my %targets=(
                 return ();
             },
 
-        LD              =&gt; &quot;link&quot;,
-        LDFLAGS         =&gt; &quot;/nologo&quot;,
-        ldoutflag       =&gt; &quot;/out:&quot;,
-        AR              =&gt; &quot;lib&quot;,
-        ARFLAGS         =&gt; &quot;/nologo&quot;,
-        aroutflag       =&gt; &quot;/out:&quot;,
-        RC               =&gt; &quot;rc&quot;,
-        rcoutflag        =&gt; &quot;/fo&quot;,
         MT              =&gt; &quot;mt&quot;,
         MTFLAGS         =&gt; &quot;-nologo&quot;,
         mtinflag        =&gt; &quot;-manifest &quot;,
diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 9529bbfe5c..f5e5754b3a 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -1275,10 +1275,22 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
         template         =&gt; 1,
         CC               =&gt; &quot;cl&quot;,
-        CPP              =&gt; '$(CC) /EP /C',
+        CPP              =&gt; '&quot;$(CC)&quot; /EP /C',
         CFLAGS           =&gt; &quot;/W3 /wd4090 /nologo&quot;,
-        LDFLAGS          =&gt; add(&quot;/debug&quot;),
         coutflag         =&gt; &quot;/Fo&quot;,
+        cpp_depend_flags =&gt; &quot;/Zs /showIncludes&quot;,
+        LD               =&gt; &quot;link&quot;,
+        LDFLAGS          =&gt; &quot;/nologo /debug&quot;,
+        ldoutflag        =&gt; &quot;/out:&quot;,
+        ldpostoutflag    =&gt; &quot;&quot;,
+        ld_resp_delim    =&gt; &quot;\n&quot;,
+        bin_lflags       =&gt; &quot;setargv.obj&quot;,
+        AR               =&gt; &quot;lib&quot;,
+        ARFLAGS          =&gt; &quot;/nologo&quot;,
+        aroutflag        =&gt; &quot;/out:&quot;,
+        ar_resp_delim    =&gt; &quot;\n&quot;,
+        RC               =&gt; &quot;rc&quot;,
+        rcoutflag        =&gt; &quot;/fo&quot;,
         defines          =&gt; add(&quot;OPENSSL_SYS_WIN32&quot;, &quot;WIN32_LEAN_AND_MEAN&quot;,
                                 &quot;UNICODE&quot;, &quot;_UNICODE&quot;,
                                 &quot;_CRT_SECURE_NO_DEPRECATE&quot;,
@@ -1291,6 +1303,9 @@ my %targets = (
         shared_defflag   =&gt; '',
         shared_ldflag    =&gt; &quot;/dll&quot;,
         shared_target    =&gt; &quot;win-shared&quot;, # meaningless except it gives Configure a hint
+        lddefflag        =&gt; &quot;/def:&quot;,
+        ldresflag        =&gt; &quot; &quot;,
+        ld_implib_flag   =&gt; &quot;/implib:&quot;,
         thread_scheme    =&gt; &quot;winthreads&quot;,
         dso_scheme       =&gt; &quot;win32&quot;,
         perl_platform    =&gt; 'Windows::MSVC',
diff --git a/Configurations/50-cppbuilder.conf b/Configurations/50-cppbuilder.conf
new file mode 100644
index 0000000000..1c47a4c2be
--- /dev/null
+++ b/Configurations/50-cppbuilder.conf
@@ -0,0 +1,56 @@
+my %targets = (
+    &quot;BC-32&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
+        sys_id           =&gt; &quot;WIN32&quot;,
+        bn_ops           =&gt; &quot;BN_LLONG&quot;,
+        thread_scheme    =&gt; &quot;winthreads&quot;,
+        cc               =&gt; &quot;bcc32c&quot;,
+        CPP              =&gt; &quot;cpp32 -oCON -Sc -Sr&quot;,
+        defines          =&gt; add(&quot;WIN32_LEAN_AND_MEAN&quot;, &quot;OPENSSL_SYS_WIN32&quot;,
+                                &quot;L_ENDIAN&quot;, &quot;DSO_WIN32&quot;, &quot;_stricmp=stricmp&quot;,
+                                &quot;_strnicmp=strnicmp&quot;, &quot;_malloca=malloc&quot;,
+                                &quot;_freea=free&quot;, &quot;_setmode=setmode&quot;),
+        cflags           =&gt; picker(default =&gt; add(&quot;-q -c&quot;,
+                                                  threads(&quot;-tM&quot;),
+                                                  shared(&quot;-tR&quot;)),
+                                   debug   =&gt; &quot;-Od -v -vi- -D_DEBUG&quot;,
+                                   release =&gt; &quot;-O2&quot;),
+        bin_cflags       =&gt; &quot;-tWC&quot;,
+        lib_cflags       =&gt; shared(&quot;-tWD -D_WINDLL -D_DLL&quot;),
+        coutflag         =&gt; &quot;-o&quot;,
+        cpp_depend_flags =&gt; &quot;-Hp&quot;,
+        LD               =&gt; &quot;ilink32&quot;,
+        LDFLAGS          =&gt; picker(default =&gt; &quot;-x -Gn -q -w-dup&quot;,
+                                   debug   =&gt; '-j&quot;$(BDS)\lib\win32c\debug&quot; ' .
+                                              '-L&quot;$(BDS)\lib\win32c\debug&quot; -v',
+                                   release =&gt; '-j&quot;$(BDS)\lib\win32c\release&quot; ' .
+                                              '-L&quot;$(BDS)\lib\win32c\release&quot;'),
+        bin_lflags       =&gt; &quot;-ap -Tpe c0x32.obj wildargs.obj&quot;,
+        ldoutflag        =&gt; &quot;,&quot;,
+        ldpostoutflag    =&gt; &quot;,,&quot;,
+        ld_resp_delim    =&gt; &quot; +\n&quot;,
+        ex_libs          =&gt; add(sub {
+            my @ex_libs = (&quot;import32.lib&quot;,
+                           ($disabled{shared}
+                            ? ($disabled{threads} ? &quot;cw32.lib&quot; : &quot;cw32mt.lib&quot;)
+                            : ($disabled{threads} ? &quot;cw32i.lib&quot; : &quot;cw32mti.lib&quot;)));
+            push @ex_libs, &quot;ws2_32.lib&quot; unless $disabled{sock};
+            return join(&quot; &quot;, @ex_libs);
+        }),
+        AR               =&gt; &quot;tlib&quot;,
+        ARFLAGS          =&gt; &quot;/P256 /N /u&quot;,
+        ar_resp_delim    =&gt; &quot; &amp;\n&quot;,
+        RC               =&gt; &quot;brcc32&quot;,
+        RCFLAGS          =&gt; '-i&quot;$(BDS)\include\windows\sdk&quot;',
+        rcoutflag        =&gt; &quot;-fo&quot;,
+        shared_target    =&gt; &quot;win-shared&quot;,
+        shared_ldflag    =&gt; &quot;-aa -Tpd c0d32.obj&quot;,
+        lddefflag        =&gt; &quot;,&quot;,
+        ldresflag        =&gt; &quot;,&quot;,
+        ld_implib_rule   =&gt; 'implib -a $&lt; $**',
+        dso_scheme       =&gt; &quot;win32&quot;,
+        shared_defflag   =&gt; '',
+        perl_platform    =&gt; 'Windows::cppbuilder',
+        uplink_arch      =&gt; 'common',
+    }
+);
diff --git a/Configurations/platform/Windows/cppbuilder.pm b/Configurations/platform/Windows/cppbuilder.pm
new file mode 100644
index 0000000000..b4d208d6d4
--- /dev/null
+++ b/Configurations/platform/Windows/cppbuilder.pm
@@ -0,0 +1,16 @@
+package platform::Windows::cppbuilder;
+
+use vars qw(@ISA);
+
+require platform::Windows::MSVC;
<A HREF="../../../mailman/listinfo/openssl-commits.html">+ at ISA</A> = qw(platform::Windows::MSVC);
+
+sub pdbext              { '.tds' }
+
+# C++Builder's Clang-based compilers prepend an underscore to __cdecl-convention
+# C functions, and the linker needs those as the InternalName in the .def file.
+sub export2internal {
+    return &quot;_$_[1]&quot;;
+}
+
+1;
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index 050d618a23..6ceab7e94d 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -29,7 +29,7 @@
  sub dependmagic {
      my $target = shift;
 
-     return &quot;$target: build_generated\n\t\$(MAKE) /\$(MAKEFLAGS) depend &amp;&amp; \$(MAKE) /\$(MAKEFLAGS) _$target\n_$target&quot;;
+     return &quot;$target: build_generated\n\t\$(MAKE) /\$(MAKEFLAGS) depend\n\t\$(MAKE) /\$(MAKEFLAGS) _$target\n_$target&quot;;
  }
  '';
 -}
@@ -226,10 +226,10 @@ libdir={- file_name_is_absolute($libdir)
 ##### User defined commands and flags ################################
 
 CC=&quot;{- $config{CC} -}&quot;
-CPP=&quot;{- $config{CPP} -}&quot;
+CPP={- $config{CPP} -}
 CPPFLAGS={- our $cppflags1 = join(&quot; &quot;,
                                   (map { &quot;-D&quot;.$_} @{$config{CPPDEFINES}}),
-                                  (map { &quot; -I &quot;.$_} @{$config{CPPINCLUDES}}),
+                                  (map { &quot; -I&quot;.$_} @{$config{CPPINCLUDES}}),
                                   @{$config{CPPFLAGS}}) -}
 CFLAGS={- join(' ', @{$config{CFLAGS}}) -}
 LD=&quot;{- $config{LD} -}&quot;
@@ -388,11 +388,15 @@ PROCESSOR= {- $config{processor} -}
 
 build_docs: build_html_docs
 build_html_docs: $(HTMLDOCS1) $(HTMLDOCS3) $(HTMLDOCS5) $(HTMLDOCS7)
-
+	@
 build_generated: $(GENERATED_MANDATORY)
+	@
 build_libs_nodep: $(LIBS) {- join(&quot; &quot;,map { platform-&gt;sharedlib_import($_) // () } @{$unified_info{libraries}}) -}
+	@
 build_modules_nodep: $(MODULES)
+	@
 build_programs_nodep: $(PROGRAMS) $(SCRIPTS)
+	@
 
 # Kept around for backward compatibility
 build_apps build_tests: build_programs
@@ -411,19 +415,14 @@ all: build_sw build_docs
 test: tests
 {- dependmagic('tests'); -}: build_programs_nodep build_modules_nodep copy-utils
 	@{- output_off() if $disabled{tests}; &quot;&quot; -}
-	set SRCTOP=$(SRCDIR)
-	set BLDTOP=$(BLDDIR)
-	set PERL=$(PERL)
-	set FIPSKEY=$(FIPSKEY)
-	&quot;$(PERL)&quot; &quot;$(SRCDIR)\test\run_tests.pl&quot; $(TESTS)
+	cmd /C &quot;set &quot;SRCTOP=$(SRCDIR)&quot; &amp; set &quot;BLDTOP=$(BLDDIR)&quot; &amp; set &quot;PERL=$(PERL)&quot; &amp; set &quot;FIPSKEY=$(FIPSKEY)&quot; &amp; &quot;$(PERL)&quot; &quot;$(SRCDIR)\test\run_tests.pl&quot; $(TESTS)&quot;
 	@{- if ($disabled{tests}) { output_on(); } else { output_off(); } &quot;&quot; -}
 	@$(ECHO) &quot;Tests are not supported with your chosen Configure options&quot;
 	@{- output_on() if !$disabled{tests}; &quot;&quot; -}
 
 list-tests:
 	@{- output_off() if $disabled{tests}; &quot;&quot; -}
-	@set SRCTOP=$(SRCDIR)
-	@&quot;$(PERL)&quot; &quot;$(SRCDIR)\test\run_tests.pl&quot; list
+	@cmd /C &quot;set &quot;SRCTOP=$(SRCDIR)&quot; &amp; &quot;$(PERL)&quot; &quot;$(SRCDIR)\test\run_tests.pl&quot; list&quot;
 	@{- if ($disabled{tests}) { output_on(); } else { output_off(); } &quot;&quot; -}
 	@$(ECHO) &quot;Tests are not supported with your chosen Configure options&quot;
 	@{- output_on() if !$disabled{tests}; &quot;&quot; -}
@@ -621,7 +620,7 @@ reconfigure reconf:
 
 {-
  use File::Basename;
- use File::Spec::Functions qw/:DEFAULT abs2rel rel2abs/;
+ use File::Spec::Functions qw/:DEFAULT abs2rel rel2abs file_name_is_absolute/;
 
  # Helper function to figure out dependencies on libraries
  # It takes a list of library names and outputs a list of dependencies
@@ -640,16 +639,23 @@ $args{target}: $deps
 EOF
   }
 
+  # This function (and the next) avoids quoting paths of generated dependencies
+  # (in the build tree), but quotes paths of non-generated dependencies (in the
+  # source tree). This is a workaround for a limitation of C++Builder's make.exe
+  # in handling quoted paths: <A HREF="https://quality.embarcadero.com/browse/RSP-31756">https://quality.embarcadero.com/browse/RSP-31756</A>
   sub generatesrc {
       my %args = @_;
       my $gen0 = $args{generator}-&gt;[0];
       my $gen_args = join('', map { &quot; $_&quot; }
                               @{$args{generator}}[1..$#{$args{generator}}]);
-      my $gen_incs = join(&quot;&quot;, map { &quot; -I \&quot;$_\&quot;&quot; } @{$args{generator_incs}});
-      my $incs = join(&quot;&quot;, map { &quot; -I \&quot;$_\&quot;&quot; } @{$args{incs}});
+      my $gen_incs = join(&quot;&quot;, map { &quot; -I\&quot;$_\&quot;&quot; } @{$args{generator_incs}});
+      my $incs = join(&quot;&quot;, map { &quot; -I\&quot;$_\&quot;&quot; } @{$args{incs}});
       my $defs = join(&quot;&quot;, map { &quot; -D&quot;.$_ } @{$args{defs}});
       my $deps = @{$args{deps}} ?
-          '&quot;'.join('&quot; &quot;', @{$args{generator_deps}}, @{$args{deps}}).'&quot;' : '';
+          join(' ',
+               map { file_name_is_absolute($_) || ($_ =~ m|^../|) ? &quot;\&quot;$_\&quot;&quot; : $_ }
+               (@{$args{generator_deps}}, @{$args{deps}}))
+          : '';
 
       if ($args{src} =~ /\.html$/) {
           #
@@ -704,22 +710,22 @@ EOF
               if ($args{src} =~ /\.S$/) {
                    return &lt;&lt;&quot;EOF&quot;;
 $target: &quot;$gen0&quot; $deps
-	set ASM=\$(AS)
-	$generator \$@.S
-	\$(CPP) $incs $cppflags $defs \$@.S &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
+	cmd /C &quot;set &quot;ASM=\$(AS)&quot; &amp; $generator \$@.S&quot;
+	\$(CPP) $incs $cppflags $defs \$@.S &gt; \$@.i
+	move /Y \$@.i \$@
         del /Q \$@.S
 EOF
               }
               # Otherwise....
               return &lt;&lt;&quot;EOF&quot;;
 $target: &quot;$gen0&quot; $deps
-	set ASM=\$(AS)
-	$generator \$@
+	cmd /C &quot;set &quot;ASM=\$(AS)&quot; &amp; $generator \$@&quot;
 EOF
           }
           return &lt;&lt;&quot;EOF&quot;;
 $target: &quot;$gen0&quot; $deps
-	\$(CPP) $incs $cppflags $defs &quot;$gen0&quot; &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
+	\$(CPP) $incs $cppflags $defs &quot;$gen0&quot; &gt; \$@.i
+	move /Y \$@.i \$@
 EOF
       } elsif ($gen0 =~ m|^.*\.in$|) {
           #
@@ -785,8 +791,10 @@ EOF
                ? platform-&gt;asm($x) : $x }
          ( @{$args{srcs}} );
      my $srcs = '&quot;'.join('&quot; &quot;',  @srcs).'&quot;';
-     my $deps = '&quot;'.join('&quot; &quot;', @srcs, @{$args{deps}}).'&quot;';
-     my $incs = join(&quot;&quot;, map { ' -I &quot;'.$_.'&quot;' } @{$args{incs}});
+     my $deps = join(' ',
+                     map { file_name_is_absolute($_) || ($_ =~ m|^../|) ? &quot;\&quot;$_\&quot;&quot; : $_ }
+                     (@srcs, @{$args{deps}}));
+     my $incs = join(&quot;&quot;, map { ' -I&quot;'.$_.'&quot;' } @{$args{incs}});
      my $defs = join(&quot;&quot;, map { &quot; -D&quot;.$_ } @{$args{defs}});
      my $cflags = { shlib =&gt; ' $(LIB_CFLAGS)',
 		    lib =&gt; ' $(LIB_CFLAGS)',
@@ -819,7 +827,8 @@ EOF
      } elsif ($srcs[0] =~ /.S$/) {
          return &lt;&lt;&quot;EOF&quot;;
 $obj: $deps
-	\$(CC) /EP -D__ASSEMBLER__ $cflags $defs $srcs &gt; \$@.asm &amp;&amp; \$(AS) $asflags \$(ASOUTFLAG)\$\@ \$@.asm
+	\$(CC) /EP -D__ASSEMBLER__ $cflags $defs $srcs &gt; \$@.asm
+	\$(AS) $asflags \$(ASOUTFLAG)\$\@ \$@.asm
 EOF
      }
      my $recipe = &lt;&lt;&quot;EOF&quot;;
@@ -827,7 +836,7 @@ $obj: $deps
 	\$(CC) $cflags $defs -c \$(COUTFLAG)\$\@ $srcs
 EOF
      $recipe .= &lt;&lt;&quot;EOF&quot;	unless $disabled{makedepend};
-	\$(CC) $cflags $defs /Zs /showIncludes $srcs 2&gt;&amp;1 &gt; $dep
+	cmd /C &quot;\$(CPP) $cflags $defs $target{cpp_depend_flags} $srcs &gt; $dep 2&gt;&amp;1&quot;
 EOF
      return $recipe;
  }
@@ -839,31 +848,38 @@ EOF
      my %args = @_;
      my $lib = $args{lib};
      my @objs = map { platform-&gt;convertext($_) }
-                grep { platform-&gt;isobj($_) || platform-&gt;isres($_) }
+                grep { platform-&gt;isobj($_) }
+                @{$args{objs}};
+     my @ress = map { platform-&gt;convertext($_) }
+                grep { platform-&gt;isres($_) }
                 @{$args{objs}};
      my @defs = map { platform-&gt;def($_) }
                 grep { platform-&gt;isdef($_) }
                 @{$args{objs}};
      my @deps = compute_lib_depends(@{$args{deps}});
      die &quot;More than one exported symbols list&quot; if scalar @defs &gt; 1;
-     my $linklibs = join(&quot;&quot;, map { &quot;$_\n&quot; } @deps);
-     my $objs = join(&quot;\n&quot;, @objs);
-     my $deps = join(&quot; &quot;, @objs, @defs, @deps);
+     my $linklibs = join(&quot;&quot;, map { &quot;$_$target{ld_resp_delim}&quot; } @deps);
+     my $objs = join($target{ld_resp_delim}, @objs);
+     my $ress = join($target{ld_resp_delim}, @ress);
+     my $deps = join(&quot; &quot;, @objs, @ress, @defs, @deps);
      my $import = platform-&gt;sharedlib_import($lib);
      my $dll =  platform-&gt;sharedlib($lib);
-     my $shared_def = join(&quot;&quot;, map { &quot; /def:$_&quot; } @defs);
+     my $shared_def = $target{lddefflag} . join(&quot;&quot;, @defs);
+     my $implib_rule = $target{ld_implib_rule} || &quot;&quot;;
+     my $implib_flag = $target{ld_implib_flag}
+                       ? &quot;$target{ld_implib_flag}$import&quot;
+                       : &quot;&quot;;
      return &lt;&lt;&quot;EOF&quot;
 # The import library may look like a static library, but it is not.
 # We MUST make the import library depend on the DLL, in case someone
 # mistakenly removes the latter.
 $import: $dll
+	$implib_rule
 $dll: $deps
 	IF EXIST $full.manifest DEL /F /Q $full.manifest
 	IF EXIST \$@ DEL /F /Q \$@
-	\$(LD) \$(LDFLAGS) \$(LIB_LDFLAGS) \\
-		/implib:$import \$(LDOUTFLAG)$dll$shared_def @&lt;&lt; || (DEL /Q \$(\@B).* $import &amp;&amp; EXIT 1)
-$objs
-$linklibs\$(LIB_EX_LIBS)
+	cmd /C &quot;\$(LD) \$(LDFLAGS) \$(LIB_LDFLAGS) @&lt;&lt; $implib_flag || (DEL /Q \$(\@B).* $import &amp; EXIT 1)&quot;
+$objs$target{ld_resp_delim}\$(LDOUTFLAG)$dll$target{ldpostoutflag}$target{ld_resp_delim}$linklibs\$(LIB_EX_LIBS)$target{ld_resp_delim}$shared_def$target{ldresflag}$ress
 &lt;&lt;
 	IF EXIST $dll.manifest \\
 	   \$(MT) \$(MTFLAGS) \$(MTINFLAG)$dll.manifest \$(MTOUTFLAG)$dll
@@ -880,23 +896,26 @@ EOF
      my $dso = platform-&gt;dso($args{module});
      my $dso_n = platform-&gt;dsoname($args{module});
      my @objs = map { platform-&gt;convertext($_) }
-                grep { platform-&gt;isobj($_) || platform-&gt;isres($_) }
+                grep { platform-&gt;isobj($_) }
+                @{$args{objs}};
+     my @ress = map { platform-&gt;convertext($_) }
+                grep { platform-&gt;isres($_) }
                 @{$args{objs}};
      my @defs = map { platform-&gt;def($_) }
                 grep { platform-&gt;isdef($_) }
                 @{$args{objs}};
      my @deps = compute_lib_depends(@{$args{deps}});
-     my $objs = join(&quot;\n&quot;, @objs);
-     my $linklibs = join(&quot;&quot;, map { &quot;$_\n&quot; } @deps);
-     my $deps = join(&quot; &quot;, @objs, @defs, @deps);
-     my $shared_def = join(&quot;&quot;, map { &quot; /def:$_&quot; } @defs);
+     die &quot;More than one exported symbols list&quot; if scalar @defs &gt; 1;
+     my $objs = join($target{ld_resp_delim}, @objs);
+     my $ress = join($target{ld_resp_delim}, @ress);
+     my $linklibs = join(&quot;&quot;, map { &quot;$_$target{ld_resp_delim}&quot; } @deps);
+     my $deps = join(&quot; &quot;, @objs, @ress, @defs, @deps);
+     my $shared_def = $target{lddefflag} . join(&quot;&quot;, @defs);
      return &lt;&lt;&quot;EOF&quot;;
 $dso: $deps
 	IF EXIST $dso.manifest DEL /F /Q $dso.manifest
-	\$(LD) \$(LDFLAGS) \$(DSO_LDFLAGS) \\
-		\$(LDOUTFLAG)$dso$shared_def @&lt;&lt; || (DEL /Q \$(\@B).* $dso_n.* &amp;&amp; EXIT 1)
-$objs
-$linklibs \$(DSO_EX_LIBS)
+	cmd /C &quot;\$(LD) \$(LDFLAGS) \$(DSO_LDFLAGS) @&lt;&lt; || (DEL /Q \$(\@B).* $dso_n.* &amp; EXIT 1)&quot;
+$objs$target{ld_resp_delim}\$(LDOUTFLAG)$dso$target{ldpostoutflag}$target{ld_resp_delim}$linklibs \$(DSO_EX_LIBS)$target{ld_resp_delim}$shared_def$target{ldresflag}$ress
 &lt;&lt;
 	IF EXIST $dso.manifest \\
 	   \$(MT) \$(MTFLAGS) \$(MTINFLAG)$dso.manifest \$(MTOUTFLAG)$dso
@@ -906,7 +925,7 @@ EOF
      my %args = @_;
      my $lib = platform-&gt;staticlib($args{lib});
      my @objs = map { platform-&gt;obj($_) } @{$args{objs}};
-     my $objs = join(&quot;\n&quot;, @objs);
+     my $objs = join($target{ar_resp_delim}, @objs);
      my $deps = join(&quot; &quot;, @objs);
      return &lt;&lt;&quot;EOF&quot;;
 $lib: $deps
@@ -919,19 +938,20 @@ EOF
      my %args = @_;
      my $bin = platform-&gt;bin($args{bin});
      my @objs = map { platform-&gt;convertext($_) }
-                grep { platform-&gt;isobj($_) || platform-&gt;isres($_) }
+                grep { platform-&gt;isobj($_) }
+                @{$args{objs}};
+     my @ress = map { platform-&gt;convertext($_) }
+                grep { platform-&gt;isres($_) }
                 @{$args{objs}};
      my @deps = compute_lib_depends(@{$args{deps}});
-     my $objs = join(&quot;\n&quot;, @objs);
-     my $linklibs = join(&quot;&quot;, map { &quot;$_\n&quot; } @deps);
-     my $deps = join(&quot; &quot;, @objs, @deps);
+     my $objs = join($target{ld_resp_delim}, @objs);
+     my $linklibs = join(&quot;&quot;, map { &quot;$_$target{ld_resp_delim}&quot; } @deps);
+     my $deps = join(&quot; &quot;, @objs, @ress, @deps);
      return &lt;&lt;&quot;EOF&quot;;
 $bin: $deps
 	IF EXIST $bin.manifest DEL /F /Q $bin.manifest
-	\$(LD) \$(LDFLAGS) \$(BIN_LDFLAGS) \$(LDOUTFLAG)$bin @&lt;&lt;
-$objs
-setargv.obj
-$linklibs\$(BIN_EX_LIBS)
+	\$(LD) \$(LDFLAGS) \$(BIN_LDFLAGS) @&lt;&lt;
+$objs$target{ld_resp_delim}\$(LDOUTFLAG)$bin$target{ldpostoutflag}$target{ld_resp_delim}$linklibs\$(BIN_EX_LIBS)$target{ldresflag}$target{ldresflag}$ress
 &lt;&lt;
 	IF EXIST $bin.manifest \\
 	   \$(MT) \$(MTFLAGS) \$(MTINFLAG)$bin.manifest \$(MTOUTFLAG)$bin
@@ -947,7 +967,7 @@ EOF
       return &lt;&lt;&quot;EOF&quot;;
 $script: $sources
 	&quot;\$(PERL)&quot; &quot;-I\$(BLDDIR)&quot; -Mconfigdata &quot;$dofile&quot; \\
-	    &quot;-o$target{build_file}&quot; $sources &gt; &quot;$script&quot;
+	    &quot;-o$target{build_file}&quot; $sources &gt; \$@
 EOF
   }
   sub generatedir {
diff --git a/Configure b/Configure
index e36c5d93aa..76c27bacb8 100755
--- a/Configure
+++ b/Configure
@@ -1533,10 +1533,10 @@ unless ($disabled{asm}) {
 
 # Check for makedepend capabilities.
 if (!$disabled{makedepend}) {
-    if ($config{target} =~ /^(VC|vms)-/) {
-        # For VC- and vms- targets, there's nothing more to do here.  The
+    if ($config{target} =~ /^(VC|BC|vms)-/) {
+        # For VC-, BC- and vms- targets, there's nothing more to do here.  The
         # functionality is hard coded in the corresponding build files for
-        # cl (Windows) and CC/DECC (VMS).
+        # cl/cpp32 (Windows) and CC/DECC (VMS).
     } elsif (($predefined_C{__GNUC__} // -1) &gt;= 3
              &amp;&amp; !($predefined_C{__APPLE_CC__} &amp;&amp; !$predefined_C{__clang__})) {
         # We know that GNU C version 3 and up as well as all clang
diff --git a/NOTES-WINDOWS.md b/NOTES-WINDOWS.md
index dca13a7260..7ca8de299e 100644
--- a/NOTES-WINDOWS.md
+++ b/NOTES-WINDOWS.md
@@ -2,6 +2,8 @@ Notes for Windows platforms
 ===========================
 
  - [Native builds using Visual C++](#native-builds-using-visual-c++)
+ - [Native builds using Embarcadero C++Builder](
+   #native-builds-using-embarcadero-c++-builder)
  - [Native builds using MinGW](#native-builds-using-mingw)
  - [Linking native applications](#linking-native-applications)
  - [Hosted builds using Cygwin](#hosted-builds-using-cygwin)
@@ -13,6 +15,8 @@ There are various options to build and run OpenSSL on the Windows platforms.
 To build a native OpenSSL you can either use:
 
     Microsoft Visual C++ (MSVC) C compiler on the command line
+or
+    Embarcadero C++Builder
 or
     MinGW cross compiler
     run on the GNU-like development environment MSYS2
@@ -119,6 +123,32 @@ Special notes for Universal Windows Platform builds, aka VC-*-UWP
    &quot;vcvarsall.bat&quot; before you compile. For example, if you want to build
    &quot;arm64&quot; builds, you should run &quot;vcvarsall.bat x86_arm64 uwp&quot;.
 
+Native builds using Embarcadero C++Builder
+=========================================
+
+This toolchain (a descendant of Turbo/Borland C++) is an alternative to MSVC.
+OpenSSL currently includes an experimental 32-bit configuration targeting the
+Clang-based compiler (bcc32c.exe) in v10.3.3 Community Edition.
+&lt;<A HREF="https://www.embarcadero.com/products/cbuilder/starter">https://www.embarcadero.com/products/cbuilder/starter</A>&gt;
+
+ 1. Install Perl.
+
+ 2. Open the RAD Studio Command Prompt.
+
+ 3. Go to the root of the OpenSSL source directory and run:
+    perl Configure BC-32 --prefix=%CD%
+
+ 4. make -N
+
+ 5. make -N test
+
+ 6. Build your program against this OpenSSL:
+    * Set your include search path to the &quot;include&quot; subdirectory of OpenSSL.
+    * Set your library search path to the OpenSSL source directory.
+
+Note that this is very experimental. Support for 64-bit and other Configure
+options is still pending.
+
 Native builds using MinGW
 =========================
 
diff --git a/apps/build.info b/apps/build.info
index 146e9009f5..06759b2f94 100644
--- a/apps/build.info
+++ b/apps/build.info
@@ -71,7 +71,7 @@ IF[{- !$disabled{apps} -}]
   # always depend on a changed configuration.
   DEPEND[progs.c]=../configdata.pm
 
-  IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
+  IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-|BC-)/ -}]
     GENERATE[openssl.rc]=../util/mkrc.pl openssl
     SOURCE[openssl]=openssl.rc
   ENDIF
diff --git a/apps/cmp.c b/apps/cmp.c
index 50282315d8..644fb545d2 100644
--- a/apps/cmp.c
+++ b/apps/cmp.c
@@ -20,7 +20,7 @@
 #include &quot;cmp_mock_srv.h&quot;
 
 /* tweaks needed due to missing unistd.h on Windows */
-#ifdef _WIN32
+#if defined(_WIN32) &amp;&amp; !defined(__BORLANDC__)
 # define access _access
 #endif
 #ifndef F_OK
diff --git a/apps/lib/apps.c b/apps/lib/apps.c
index df4edfb837..7eadf5a4b5 100644
--- a/apps/lib/apps.c
+++ b/apps/lib/apps.c
@@ -50,7 +50,7 @@ static int WIN32_rename(const char *from, const char *to);
 # include &lt;conio.h&gt;
 #endif
 
-#if defined(OPENSSL_SYS_MSDOS) &amp;&amp; !defined(_WIN32)
+#if defined(OPENSSL_SYS_MSDOS) &amp;&amp; !defined(_WIN32) || defined(__BORLANDC__)
 # define _kbhit kbhit
 #endif
 
diff --git a/apps/lib/build.info b/apps/lib/build.info
index c352f7086d..340ce29b09 100644
--- a/apps/lib/build.info
+++ b/apps/lib/build.info
@@ -1,5 +1,5 @@
 # Auxiliary program source
-IF[{- $config{target} =~ /^(?:VC-|mingw)/ -}]
+IF[{- $config{target} =~ /^(?:VC-|mingw|BC-)/ -}]
   # It's called 'init', but doesn't have much 'init' in it...
   $AUXLIBAPPSSRC=win32_init.c
 ENDIF
diff --git a/build.info b/build.info
index f631d6c780..6c91e22309 100644
--- a/build.info
+++ b/build.info
@@ -79,7 +79,7 @@ IF[{- defined $target{shared_defflag} -}]
   GENERATE[libssl.ld]=util/libssl.num libssl
 ENDIF
 
-IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
+IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-|BC-)/ -}]
   GENERATE[libcrypto.rc]=util/mkrc.pl libcrypto
   GENERATE[libssl.rc]=util/mkrc.pl libssl
 
diff --git a/crypto/bio/bss_file.c b/crypto/bio/bss_file.c
index 981a5e7b59..41c3a59665 100644
--- a/crypto/bio/bss_file.c
+++ b/crypto/bio/bss_file.c
@@ -216,7 +216,7 @@ static long file_ctrl(BIO *b, int cmd, long num, void *ptr)
 #   define _IOB_ENTRIES 20
 #  endif
         /* Safety net to catch purely internal BIO_set_fp calls */
-#  if defined(_MSC_VER) &amp;&amp; _MSC_VER&gt;=1900
+#  if (defined(_MSC_VER) &amp;&amp; _MSC_VER&gt;=1900) || defined(__BORLANDC__)
         if (ptr == stdin || ptr == stdout || ptr == stderr)
             BIO_clear_flags(b, BIO_FLAGS_UPLINK_INTERNAL);
 #  elif defined(_IOB_ENTRIES)
diff --git a/crypto/build.info b/crypto/build.info
index 3b78431f80..3e1c295aea 100644
--- a/crypto/build.info
+++ b/crypto/build.info
@@ -131,6 +131,6 @@ INCLUDE[armv4cpuid.o]=.
 GENERATE[s390xcpuid.S]=s390xcpuid.pl
 INCLUDE[s390xcpuid.o]=.
 
-IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
+IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-|BC-)/ -}]
   SHARED_SOURCE[../libcrypto]=dllmain.c
 ENDIF
diff --git a/crypto/conf/conf_sap.c b/crypto/conf/conf_sap.c
index 4188f9113a..5cd018c167 100644
--- a/crypto/conf/conf_sap.c
+++ b/crypto/conf/conf_sap.c
@@ -15,7 +15,7 @@
 #include &lt;openssl/asn1.h&gt;
 #include &lt;openssl/engine.h&gt;
 
-#ifdef _WIN32
+#if defined(_WIN32) &amp;&amp; !defined(__BORLANDC__)
 # define strdup _strdup
 #endif
 
diff --git a/crypto/init.c b/crypto/init.c
index bf5c17da6d..788abe52e8 100644
--- a/crypto/init.c
+++ b/crypto/init.c
@@ -89,7 +89,7 @@ DEFINE_RUN_ONCE_STATIC(ossl_init_register_atexit)
     fprintf(stderr, &quot;OPENSSL_INIT: ossl_init_register_atexit()\n&quot;);
 #endif
 #ifndef OPENSSL_SYS_UEFI
-# ifdef _WIN32
+# if defined(_WIN32) &amp;&amp; !defined(__BORLANDC__)
     /* We use _onexit() in preference because it gets called on DLL unload */
     if (_onexit(win32atexit) == NULL)
         return 0;
diff --git a/ms/applink.c b/ms/applink.c
index d19966a33e..2cf3a92f18 100644
--- a/ms/applink.c
+++ b/ms/applink.c
@@ -38,6 +38,12 @@
 # include &lt;io.h&gt;
 # include &lt;fcntl.h&gt;
 
+# ifdef __BORLANDC__
+   /* _lseek in &lt;io.h&gt; is a function-like macro so we can't take its address */
+#  undef _lseek
+#  define _lseek lseek
+# endif
+
 static void *app_stdin(void)
 {
     return stdin;
diff --git a/ms/uplink.c b/ms/uplink.c
index 8c61a7ed1d..f924eb3e58 100644
--- a/ms/uplink.c
+++ b/ms/uplink.c
@@ -99,14 +99,29 @@ void OPENSSL_Uplink(volatile void **table, int index)
     table[index] = func;
 }
 
-#if defined(_MSC_VER) &amp;&amp; defined(_M_IX86)
-# define LAZY(i)         \
+#if (defined(_MSC_VER) || defined(__BORLANDC__)) &amp;&amp; defined(_M_IX86)
+# if defined(_MSC_VER)
+#  define LAZY(i)         \
 __declspec(naked) static void lazy##i (void) {  \
         _asm    push i                          \
         _asm    push OFFSET OPENSSL_UplinkTable \
         _asm    call OPENSSL_Uplink             \
         _asm    add  esp,8                      \
         _asm    jmp  OPENSSL_UplinkTable+4*i    }
+# elif defined(__BORLANDC__) &amp;&amp; defined(__clang__)
+void *OPENSSL_UplinkTable[26]; /* C++Builder requires declaration before use */
+#  define LAZY(i)         \
+__declspec(naked) static void lazy##i (void) { \
+    __asm__(&quot;pushl $&quot; #i &quot;; &quot;                  \
+            &quot;pushl %0; &quot;                       \
+            &quot;call  %P1; &quot;                      \
+            &quot;addl  $8, %%esp; &quot;                \
+            &quot;jmp   *%2 &quot;                       \
+            : /* no outputs */                 \
+            : &quot;i&quot; (OPENSSL_UplinkTable),       \
+              &quot;i&quot; (OPENSSL_Uplink),            \
+              &quot;m&quot; (OPENSSL_UplinkTable[i]));   }
+# endif
 
 # if APPLINK_MAX&gt;25
 #  error &quot;Add more stubs...&quot;
diff --git a/test/build.info b/test/build.info
index b31e5dedd5..8043f0d3be 100644
--- a/test/build.info
+++ b/test/build.info
@@ -5,7 +5,7 @@
 # be useful here.
 #
 # Auxiliary program source (copied from ../apps/build.info)
-IF[{- $config{target} =~ /^(?:VC-|mingw)/ -}]
+IF[{- $config{target} =~ /^(?:VC-|mingw|BC-)/ -}]
   # It's called 'init', but doesn't have much 'init' in it...
   $AUXLIBAPPSSRC=../apps/lib/win32_init.c
 ENDIF
diff --git a/test/conf_include_test.c b/test/conf_include_test.c
index 0cf8d49740..a38c4913d2 100644
--- a/test/conf_include_test.c
+++ b/test/conf_include_test.c
@@ -16,7 +16,9 @@
 #ifdef _WIN32
 # include &lt;direct.h&gt;
 # define DIRSEP &quot;/\\&quot;
-# define chdir _chdir
+# ifndef __BORLANDC__
+#  define chdir _chdir
+# endif
 # define DIRSEP_PRESERVE 0
 #elif !defined(OPENSSL_NO_POSIX_IO)
 # include &lt;unistd.h&gt;
diff --git a/test/testutil/driver.c b/test/testutil/driver.c
index 0b50e2ae16..702f7b2caa 100644
--- a/test/testutil/driver.c
+++ b/test/testutil/driver.c
@@ -19,7 +19,7 @@
 
 #include &quot;platform.h&quot;            /* From libapps */
 
-#ifdef _WIN32
+#if defined(_WIN32) &amp;&amp; !defined(__BORLANDC__)
 # define strdup _strdup
 #endif
 
diff --git a/util/add-depends.pl b/util/add-depends.pl
index 1a87cdd364..6fdc5e5ef4 100644
--- a/util/add-depends.pl
+++ b/util/add-depends.pl
@@ -161,8 +161,7 @@ my %procedures = (
         },
     'VC' =&gt;
         sub {
-            # For the moment, we only support Visual C on native Windows, or
-            # compatible compilers.  With those, the flags /Zs /showIncludes
+            # On Windows, with Microsoft Visual C the flags /Zs /showIncludes
             # give us the necessary output to be able to create dependencies
             # that nmake (or any 'make' implementation) should be able to read,
             # with a bit of help.  The output we're interested in looks like
@@ -170,6 +169,15 @@ my %procedures = (
             #
             #   Note: including file: {whatever header file}
             #
+            # With Embarcadero C++Builder's preprocessor (cpp32.exe) the -Hp
+            # flag gives us the preprocessed output annotated with the following
+            # note whenever a #include file is read:
+            #
+            #    Including -&gt;-&gt;{whatever header file}
+            #
+            # where each &quot;-&gt;&quot; indicates the nesting level of the #include.  The
+            # logic here is otherwise the same as the 'VC' case.
+            #
             # Since there's no object file name at all in that information,
             # we must construct it ourselves.
 
@@ -180,13 +188,14 @@ my %procedures = (
             # warnings, so we simply discard anything that doesn't start with
             # the Note:
 
-            if (/^Note: including file: */) {
+            if (/^Note: including file: */ or /^Including (-&gt;)*/) {
                 (my $tail = $') =~ s/\s*\R$//;
 
                 # VC gives us absolute paths for all include files, so to
                 # remove system header dependencies, we need to check that
-                # they don't match $abs_srcdir or $abs_blddir.
-                $tail = canonpath($tail);
+                # they don't match $abs_srcdir or $abs_blddir.  C++Builder gives
+                # us relative paths when possible, so convert to absolute paths.
+                $tail = rel2abs($tail);
 
                 unless (defined $depconv_cache{$tail}) {
                     my $dep = $tail;
diff --git a/util/mkdef.pl b/util/mkdef.pl
index a4772e9c8f..3207040e25 100755
--- a/util/mkdef.pl
+++ b/util/mkdef.pl
@@ -295,12 +295,16 @@ sub writer_windows {
 ; Definition file for the DLL version of the $libname library from OpenSSL
 ;
 
-LIBRARY         $libname
+LIBRARY         &quot;$libname&quot;
 
 EXPORTS
 _____
     for (@_) {
-        print &quot;    &quot;,$_-&gt;name(),&quot;\n&quot;;
+        print &quot;    &quot;,$_-&gt;name();
+        if (platform-&gt;can('export2internal')) {
+            print &quot;=&quot;. platform-&gt;export2internal($_-&gt;name());
+        }
+        print &quot;\n&quot;;
     }
 }
 
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033907.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="033910.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33909">[ date ]</a>
              <a href="thread.html#33909">[ thread ]</a>
              <a href="subject.html#33909">[ subject ]</a>
              <a href="author.html#33909">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
