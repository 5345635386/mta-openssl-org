<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2018-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1517259455.284624.11443.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017807.html">
   <LINK REL="Next"  HREF="017831.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1517259455.284624.11443.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Mon Jan 29 20:57:35 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="017807.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="017831.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17820">[ date ]</a>
              <a href="thread.html#17820">[ thread ]</a>
              <a href="subject.html#17820">[ subject ]</a>
              <a href="author.html#17820">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  7187f0e1ea22e63454ec46f128d669acf1128a8f (commit)
       via  2da0130b98ec1a2f69d2506419fee9edf7d10563 (commit)
       via  917a1b2e069ba807417c8dffaa8f1e5214813de8 (commit)
       via  ca3724142a759703dace678e73613cfda6c00cd0 (commit)
       via  f9856cc5b47ce850698f2ae2ddf7d32198af9652 (commit)
       via  b1fafff631e1a10d96a45e4899667d0683a9ba09 (commit)
      from  711a8b999e7a0733f349e7f330fa3fa013e995fd (commit)


- Log -----------------------------------------------------------------
commit 7187f0e1ea22e63454ec46f128d669acf1128a8f
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Jan 29 18:33:32 2018 +0100

    To make it less surprising and confusing, leave a message on configdata.pm
    
    This message will ONLY be visible in OpenSSL 1.1.1, it will not show
    in 1.1.1a or any other release or update.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5185">https://github.com/openssl/openssl/pull/5185</A>)

commit 2da0130b98ec1a2f69d2506419fee9edf7d10563
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Jan 29 18:22:33 2018 +0100

    Make Travis and Appveyor display the configuration data dump
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5185">https://github.com/openssl/openssl/pull/5185</A>)

commit 917a1b2e069ba807417c8dffaa8f1e5214813de8
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Jan 29 18:19:36 2018 +0100

    Document the use of configdata.pm as a script
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5185">https://github.com/openssl/openssl/pull/5185</A>)

commit ca3724142a759703dace678e73613cfda6c00cd0
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Jan 29 17:33:58 2018 +0100

    Move the display of disabled features to configdata.pm as well.
    
    The additional possibility is:
    
    perl configdata.pm --options            Display the features, both
                                            enabled and disabled, and
                                            display defined macro and
                                            skipped directories where
                                            applicable.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5185">https://github.com/openssl/openssl/pull/5185</A>)

commit f9856cc5b47ce850698f2ae2ddf7d32198af9652
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Jan 29 08:20:26 2018 +0100

    Have the build files use the executable configdata.pm
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5185">https://github.com/openssl/openssl/pull/5185</A>)

commit b1fafff631e1a10d96a45e4899667d0683a9ba09
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon Jan 29 06:19:17 2018 +0100

    Make configdata.pm runnable and move all display of information there
    
    The &quot;make variable&quot; information displayed by Configure was selective
    and incomplete, and possibly undesirable (too verbose).
    
    Instead, we make configdata.pm and have the user run it to get the
    information they desire, and also make it possible to have it perform
    a reconfiguration.
    
    Possibilities so far:
    
    perl configdata.pm --dump               Displays everything (i.e. the
                                            combined output from
                                            --command-line, --environment,
                                            --make-variables and
                                            --build-parameters.
    perl configdata.pm --command-line       Displays the config command
                                            line.
    perl configdata.pm --envirnoment        Displays the recorded
                                            environment variables.
    perl configdata.pm --make-variables     Displays the configured &quot;make
                                            variables&quot;.
    perl configdata.pm --build-parameters   Displays the build file and
                                            the template files to create
                                            it.
    perl configdata.pm --reconfigure        Re-runs the configuration with
                                            the recorded environment
                                            variables.
    
    --verbose can be used to have --reconfigure be a bit more verbose.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5185">https://github.com/openssl/openssl/pull/5185</A>)

-----------------------------------------------------------------------

Summary of changes:
 .travis.yml                          |   1 +
 CHANGES                              |   5 +
 Configurations/descrip.mms.tmpl      |   3 +-
 Configurations/unix-Makefile.tmpl    |   3 +-
 Configurations/windows-makefile.tmpl |   3 +-
 Configure                            | 402 +++++++++++++++++++++++++++--------
 INSTALL                              |  16 ++
 NEWS                                 |   1 +
 README                               |   3 +-
 appveyor.yml                         |   1 +
 10 files changed, 337 insertions(+), 101 deletions(-)

diff --git a/.travis.yml b/.travis.yml
index 4fec1ca..b361059 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -151,6 +151,7 @@ before_script:
           fi;
           $srcdir/config -v $CONFIG_OPTS;
       fi
+    - ./configdata.pm --dump
     - cd $top
 
 script:
diff --git a/CHANGES b/CHANGES
index b3aa741..f0807c6 100644
--- a/CHANGES
+++ b/CHANGES
@@ -9,6 +9,11 @@
 
  Changes between 1.1.0f and 1.1.1 [xx XXX xxxx]
 
+  *) Changed Configure so it only says what it does and doesn't dump
+     so much data.  Instead, ./configdata.pm should be used as a script
+     to display all sorts of configuration data.
+     [Richard Levitte]
+
   *) Added processing of &quot;make variables&quot; to Configure.
      [Richard Levitte]
 
diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index 87c6834..8876d3c 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -545,8 +545,7 @@ debug_logicals :
 # Building targets ###################################################
 
 configdata.pm : $(SRCDIR)Configure $(SRCDIR)config.com {- join(&quot; &quot;, @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}
-        @ WRITE SYS$OUTPUT &quot;Reconfiguring...&quot;
-        perl $(SRCDIR)Configure reconf
+        perl configdata.pm -r -v
         @ WRITE SYS$OUTPUT &quot;*************************************************&quot;
         @ WRITE SYS$OUTPUT &quot;***                                           ***&quot;
         @ WRITE SYS$OUTPUT &quot;***   Please run the same mms command again   ***&quot;
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index 27d804c..22e5263 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -785,8 +785,7 @@ openssl.pc:
 
 configdata.pm: $(SRCDIR)/Configure $(SRCDIR)/config {- join(&quot; &quot;, @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}
 	@echo &quot;Detected changed: $?&quot;
-	@echo &quot;Reconfiguring...&quot;
-	$(PERL) $(SRCDIR)/Configure reconf
+	$(PERL) configdata.pm -r -v
 	@echo &quot;**************************************************&quot;
 	@echo &quot;***                                            ***&quot;
 	@echo &quot;***   Please run the same make command again   ***&quot;
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index 082ce07..8548073 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -370,8 +370,7 @@ uninstall_html_docs:
 
 configdata.pm: &quot;$(SRCDIR)\Configure&quot; {- join(&quot; &quot;, map { '&quot;'.$_.'&quot;' } @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}
 	@echo &quot;Detected changed: $?&quot;
-	@echo &quot;Reconfiguring...&quot;
-	&quot;$(PERL)&quot; &quot;$(SRCDIR)\Configure&quot; reconf
+	&quot;$(PERL)&quot; configdata.pm -r -v
 	@echo &quot;**************************************************&quot;
 	@echo &quot;***                                            ***&quot;
 	@echo &quot;***   Please run the same make command again   ***&quot;
diff --git a/Configure b/Configure
index a137cb2..8410e42 100755
--- a/Configure
+++ b/Configure
@@ -226,11 +226,6 @@ if (grep /^reconf(igure)?$/, @argvcopy) {
 	die &quot;Incorrect data to reconfigure, please do a normal configuration\n&quot;
 	    if (grep(/^reconf/<A HREF="../../../mailman/listinfo/openssl-commits.html">, at argvcopy</A>));
 	$config{perlenv} = $configdata::config{perlenv} // {};
-
-	print &quot;Reconfiguring with: &quot;, join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at argvcopy</A>), &quot;\n&quot;;
-	foreach (sort keys %{$config{perlenv}}) {
-	    print &quot;    $_ = $config{perlenv}-&gt;{$_}\n&quot;;
-	}
     } else {
 	die &quot;Insufficient data to reconfigure, please do a normal configuration\n&quot;;
     }
@@ -1029,68 +1024,6 @@ foreach my $feature (@{$target{enable}}) {
     }
 }
 
-foreach (sort (keys %disabled))
-	{
-	$config{options} .= &quot; no-$_&quot;;
-
-	printf &quot;    no-%-12s %-10s&quot;, $_, &quot;[$disabled{$_}]&quot;;
-
-	if (/^dso$/)
-		{ }
-	elsif (/^threads$/)
-		{ }
-	elsif (/^shared$/)
-		{ }
-	elsif (/^pic$/)
-		{ }
-	elsif (/^zlib$/)
-		{ }
-	elsif (/^dynamic-engine$/)
-		{ }
-	elsif (/^makedepend$/)
-		{ }
-	elsif (/^zlib-dynamic$/)
-		{ }
-	elsif (/^sse2$/)
-		{ }
-	elsif (/^engine$/)
-		{
-		@{$config{dirs}} = grep !/^engines$/, @{$config{dirs}};
-		@{$config{sdirs}} = grep !/^engine$/, @{$config{sdirs}};
-		push @{$config{openssl_other_defines}}, &quot;OPENSSL_NO_ENGINE&quot;;
-		print &quot; OPENSSL_NO_ENGINE (skip engines)&quot;;
-		}
-	else
-		{
-		my ($WHAT, $what);
-
-		($WHAT = $what = $_) =~ tr/[\-a-z]/[_A-Z]/;
-
-		# Fix up C macro end names
-		$WHAT = &quot;RMD160&quot; if $what eq &quot;ripemd&quot;;
-
-		# fix-up crypto/directory name(s)
-		$what = &quot;ripemd&quot; if $what eq &quot;rmd160&quot;;
-		$what = &quot;whrlpool&quot; if $what eq &quot;whirlpool&quot;;
-
-		if ($what ne &quot;async&quot; &amp;&amp; $what ne &quot;err&quot;
-		    &amp;&amp; grep { $_ eq $what } @{$config{sdirs}})
-			{
-			push @{$config{openssl_algorithm_defines}}, &quot;OPENSSL_NO_$WHAT&quot;;
-			@{$config{sdirs}} = grep { $_ ne $what} @{$config{sdirs}};
-
-			print &quot; OPENSSL_NO_$WHAT (skip dir)&quot;;
-			}
-		else
-			{
-			push @{$config{openssl_other_defines}}, &quot;OPENSSL_NO_$WHAT&quot;;
-			print &quot; OPENSSL_NO_$WHAT&quot;;
-			}
-		}
-
-	print &quot;\n&quot;;
-	}
-
 $target{cxxflags}//=$target{cflags} if $target{cxx};
 $target{exe_extension}=&quot;&quot;;
 $target{exe_extension}=&quot;.exe&quot; if ($config{target} eq &quot;DJGPP&quot;
@@ -1155,6 +1088,46 @@ $config{plib_lflags} = [ $target{plib_lflags} ];
 # Allow overriding the build file name
 $config{build_file} = env('BUILDFILE') || $target{build_file} || &quot;Makefile&quot;;
 
+# ALL USE OF %useradd MUST BE DONE FROM HERE ON
+%useradd = undef;
+
+my %disabled_info = ();         # For configdata.pm
+foreach my $what (sort keys %disabled) {
+    $config{options} .= &quot; no-$what&quot;;
+
+    if (!grep { $what eq $_ } ( 'dso', 'threads', 'shared', 'pic',
+                                'dynamic-engine', 'makedepend',
+                                'zlib-dynamic', 'zlib', 'sse2' )) {
+        (my $WHAT = uc $what) =~ s|-|_|g;
+
+        # Fix up C macro end names
+        $WHAT = &quot;RMD160&quot; if $what eq &quot;ripemd&quot;;
+
+        # fix-up crypto/directory name(s)
+        $what = &quot;ripemd&quot; if $what eq &quot;rmd160&quot;;
+        $what = &quot;whrlpool&quot; if $what eq &quot;whirlpool&quot;;
+
+        my $macro = $disabled_info{$what}-&gt;{macro} = &quot;OPENSSL_NO_$WHAT&quot;;
+
+        if ((grep { $what eq $_ } @{$config{sdirs}})
+                &amp;&amp; $what ne 'async' &amp;&amp; $what ne 'err') {
+            @{$config{sdirs}} = grep { $what ne $_} @{$config{sdirs}};
+            $disabled_info{$what}-&gt;{skipped} = [ catdir('crypto', $what) ];
+
+            if ($what ne 'engine') {
+                push @{$config{openssl_algorithm_defines}}, $macro;
+            } else {
+                @{$config{dirs}} = grep !/^engines$/, @{$config{dirs}};
+                push @{$disabled_info{engine}-&gt;{skipped}}, catdir('engines');
+                push @{$config{openssl_other_defines}}, $macro;
+            }
+        } else {
+            push @{$config{openssl_other_defines}}, $macro;
+        }
+
+    }
+}
+
 # Make sure build_scheme is consistent.
 $target{build_scheme} = [ $target{build_scheme} ]
     if ref($target{build_scheme}) ne &quot;ARRAY&quot;;
@@ -2176,8 +2149,11 @@ foreach (grep /_(asm|aux)_src$/, keys %target) {
 
 # Write down our configuration where it fits #########################
 
+print &quot;Creating configdata.pm\n&quot;;
 open(OUT,&quot;&gt;configdata.pm&quot;) || die &quot;unable to create configdata.pm: $!\n&quot;;
 print OUT &lt;&lt;&quot;EOF&quot;;
+#! $config{hashbangperl}
+
 package configdata;
 
 use strict;
@@ -2312,36 +2288,265 @@ if ($builder eq &quot;unified&quot;) {
 
 EOF
 }
-print OUT &quot;1;\n&quot;;
-close(OUT);
+print OUT &quot;my \%makevars = (\n&quot;;
+foreach (sort keys %user) {
+    print OUT '    ',$_,' ' x (20 - length $_),'=&gt; ',
+        &quot;'&quot;,$user_to_target{$_} || lc $_,&quot;',\n&quot;;
+}
+print OUT &quot;);\n&quot;;
+print OUT &quot;my \%disabled_info = (\n&quot;;
+foreach my $what (sort keys %disabled_info) {
+    print OUT &quot;    '$what' =&gt; {\n&quot;;
+    foreach my $info (sort keys %{$disabled_info{$what}}) {
+        if (ref $disabled_info{$what}-&gt;{$info} eq 'ARRAY') {
+            print OUT &quot;        $info =&gt; [ &quot;,
+                join(', ', map { &quot;'$_'&quot; } @{$disabled_info{$what}-&gt;{$info}}),
+                &quot; ],\n&quot;;
+        } else {
+            print OUT &quot;        $info =&gt; '&quot;, $disabled_info{$what}-&gt;{$info},
+                &quot;',\n&quot;;
+        }
+    }
+    print OUT &quot;    },\n&quot;;
+}
+print OUT &quot;);\n&quot;;
+print OUT &lt;&lt; 'EOF';
+# If run directly, we can give some answers, and even reconfigure
+unless (caller) {
+    use Getopt::Long;
+    use File::Spec::Functions;
+    use File::Basename;
+    use Pod::Usage;
+
+    my $here = dirname($0);
+
+    my $dump = undef;
+    my $cmdline = undef;
+    my $options = undef;
+    my $envvars = undef;
+    my $makevars = undef;
+    my $buildparams = undef;
+    my $reconf = undef;
+    my $verbose = undef;
+    my $help = undef;
+    my $man = undef;
+    GetOptions('dump|d'                 =&gt; \$dump,
+               'command-line|c'         =&gt; \$cmdline,
+               'options|o'              =&gt; \$options,
+               'environment|e'          =&gt; \$envvars,
+               'make-variables|m'       =&gt; \$makevars,
+               'build-parameters|b'     =&gt; \$buildparams,
+               'reconfigure|reconf|r'   =&gt; \$reconf,
+               'verbose|v'              =&gt; \$verbose,
+               'help'                   =&gt; \$help,
+               'man'                    =&gt; \$man)
+        or die &quot;Errors in command line arguments\n&quot;;
+
+    unless ($dump || $cmdline || $options || $envvars || $makevars
+            || $buildparams || $reconf || $verbose || $help || $man) {
+        print STDERR &lt;&lt;&quot;_____&quot;;
+You must give at least one option.
+For more information, do '$0 --help'
+_____
+        exit(2);
+    }
+
+    if ($help) {
+        pod2usage(-exitval =&gt; 0,
+                  -verbose =&gt; 1);
+    }
+    if ($man) {
+        pod2usage(-exitval =&gt; 0,
+                  -verbose =&gt; 2);
+    }
+    if ($dump || $cmdline) {
+        print &quot;\n(with current working directory = $here)&quot;;
+        print &quot;\nCommand line:\n\n&quot;;
+        print '    ',join(' ',
+                          $config{perl},
+                          catfile($config{sourcedir}, 'Configure'),
+                          @{$config{perlargv}}), &quot;\n&quot;;
+    }
+    if ($dump || $options) {
+        my $longest = 0;
+        foreach my $what (@disablables) {
+            $longest = length($what) if $longest &lt; length($what);
+        }
+        print &quot;\nEnabled features:\n\n&quot;;
+        foreach my $what (@disablables) {
+            print &quot;    $what\n&quot; unless $disabled{$what};
+        }
+        print &quot;\nDisabled features:\n\n&quot;;
+        foreach my $what (@disablables) {
+            if ($disabled{$what}) {
+                print &quot;    $what&quot;, ' ' x ($longest - length($what) + 1),
+                    &quot;[$disabled{$what}]&quot;, ' ' x (10 - length($disabled{$what}));
+                print $disabled_info{$what}-&gt;{macro}
+                    if $disabled_info{$what}-&gt;{macro};
+                print ' (skip ',
+                    join(', ', @{$disabled_info{$what}-&gt;{skipped}}),
+                    ')'
+                    if $disabled_info{$what}-&gt;{skipped};
+                print &quot;\n&quot;;
+            }
+        }
+    }
+    if ($dump || $envvars) {
+        print &quot;\nRecorded environment:\n\n&quot;;
+        foreach (sort keys %{$config{perlenv}}) {
+            print '    ',$_,' = ',($config{perlenv}-&gt;{$_} || ''),&quot;\n&quot;;
+        }
+    }
+    if ($dump || $makevars) {
+        print &quot;\nMakevars:\n\n&quot;;
+        foreach (sort keys %makevars) {
+            print '    ',$_,' ' x (16 - length $_),'= ',
+                (ref $config{$makevars{$_}} eq 'ARRAY'
+                 ? join(' ', @{$config{$makevars{$_}}})
+                 : $config{$makevars{$_}}),
+                &quot;\n&quot;
+                if defined $config{$makevars{$_}};
+        }
+
+        my @buildfile = ($config{builddir}, $config{build_file});
+        unshift @buildfile, $here
+            unless file_name_is_absolute($config{builddir});
+        my $buildfile = canonpath(catdir(@buildfile));
+        print &lt;&lt;&quot;_____&quot;;
+
+NOTE: These variables only represent the configuration view.  The build file
+template may have processed these variables further, please have a look at the
+build file for more exact data:
+    $buildfile
+_____
+    }
+    if ($dump || $buildparams) {
+        my @buildfile = ($config{builddir}, $config{build_file});
+        unshift @buildfile, $here
+            unless file_name_is_absolute($config{builddir});
+        print &quot;\nbuild file:\n\n&quot;;
+        print &quot;    &quot;, canonpath(catfile(@buildfile)),&quot;\n&quot;;
+
+        print &quot;\nbuild file templates:\n\n&quot;;
+        foreach (@{$config{build_file_templates}}) {
+            my @tmpl = ($_);
+            unshift @tmpl, $here
+                unless file_name_is_absolute($config{sourcedir});
+            print '    ',canonpath(catfile(@tmpl)),&quot;\n&quot;;
+        }
+    }
+    if ($reconf) {
+        if ($verbose) {
+            print 'Reconfiguring with: ', join(' ',@{$config{perlargv}}), &quot;\n&quot;;
+	    foreach (sort keys %{$config{perlenv}}) {
+	        print '    ',$_,' = ',($config{perlenv}-&gt;{$_} || &quot;&quot;),&quot;\n&quot;;
+	    }
+        }
+
+        chdir $here;
+        exec $^X,catfile($config{sourcedir}, 'Configure'),'reconf';
+    }
+}
+
+1;
+
+__END__
+
+=head1 NAME
+
+configdata.pm - configuration data for OpenSSL builds
+
+=head1 SYNOPSIS
+
+Interactive:
+
+  perl configdata.pm [options]
+
+As data bank module:
+
+  use configdata;
+
+=head1 DESCRIPTION
+
+This module can be used in two modes, interactively and as a module containing
+all the data recorded by OpenSSL's Configure script.
+
+When used interactively, simply run it as any perl script, with at least one
+option, and you will get the information you ask for.  See L&lt;/OPTIONS&gt; below.
+
+When loaded as a module, you get a few databanks with useful information to
+perform build related tasks.  The databanks are:
+
+    %config             Configured things.
+    %target             The OpenSSL config target with all inheritances
+                        resolved.
+    %disabled           The features that are disabled.
+    @disablables        The list of features that can be disabled.
+    %withargs           All data given through --with-THING options.
+    %unified_info       All information that was computed from the build.info
+                        files.
+
+=head1 OPTIONS
+
+=over 4
+
+=item B&lt;--help&gt;
+
+Print a brief help message and exit.
+
+=item B&lt;--man&gt;
 
-print &quot;\n&quot;;
-print &quot;PROCESSOR     =$config{processor}\n&quot; if $config{processor};
-print &quot;PERL          =$config{perl}\n&quot;;
-print &quot;PERLVERSION   =$Config{version} for $Config{archname}\n&quot;;
-print &quot;HASHBANGPERL  =$config{hashbangperl}\n&quot;;
-print &quot;DEFINES       =&quot;,join(&quot; &quot;, @{$config{defines}}),&quot;\n&quot;
-    if defined $config{defines};
-print &quot;INCLUDES      =&quot;,join(&quot; &quot;, @{$config{includes}}),&quot;\n&quot;
-    if defined $config{includes};
-print &quot;CPPFLAGS      =&quot;,join(&quot; &quot;, @{$config{cppflags}}),&quot;\n&quot;
-    if defined $config{cppflags};
-print &quot;CC            =$config{cross_compile_prefix}$config{cc}\n&quot;;
-print &quot;CFLAGS        =&quot;,join(&quot; &quot;, @{$config{cflags}}),&quot;\n&quot;
-    if defined $config{cflags};
-print &quot;CXX           =$config{cross_compile_prefix}$config{cxx}\n&quot;
-    if defined $config{cxx};
-print &quot;CXXFLAGS      =&quot;,join(&quot; &quot;, @{$config{cxxflags}}),&quot;\n&quot;
-    if defined $config{cxxflags};
-print &quot;LD            =$config{cross_compile_prefix}$config{ld}\n&quot;
-    if defined $config{ld};
-print &quot;LDFLAGS       =&quot;,join(&quot; &quot;, @{$config{lflags}}),&quot;\n&quot;
-    if defined $config{lflags};
-print &quot;EX_LIBS       =&quot;,join(&quot; &quot;, @{$config{ex_libs}}),&quot;\n&quot;
-    if defined $config{ex_libs};
+Print the manual page and exit.
+
+=item B&lt;--dump&gt; | B&lt;-c&gt;
+
+Print all relevant configuration data.  This is equivalent to B&lt;--command-line&gt;
+B&lt;--options&gt; B&lt;--environment&gt; B&lt;--make-variables&gt; B&lt;--build-parameters&gt;.
+
+=item B&lt;--command-line&gt; | B&lt;-c&gt;
+
+Print the current configuration command line.
+
+=item B&lt;--options&gt; | B&lt;-o&gt;
+
+Print the features, both enabled and disabled, and display defined macro and
+skipped directories where applicable.
+
+=item B&lt;--environment&gt; | B&lt;-e&gt;
+
+Print the environment variables and their values at the time of configuration.
+
+=item B&lt;--make-variables&gt; | B&lt;-m&gt;
+
+Print the main make variables generated in the current configuration
+
+=item B&lt;--build-parameters&gt; | B&lt;-b&gt;
+
+Print the build parameters, i.e. build file and build file templates.
+
+=item B&lt;--reconfigure&gt; | B&lt;--reconf&gt; | B&lt;-r&gt;
+
+Redo the configuration.
+
+=item B&lt;--verbose&gt; | B&lt;-v&gt;
+
+Verbose output.
+
+=back
+
+=cut
+
+EOF
+close(OUT);
+if ($builder_platform eq 'unix') {
+    my $mode = (0755 &amp; ~umask);
+    chmod $mode, 'configdata.pm'
+        or warn sprintf(&quot;WARNING: Couldn't change mode for 'configdata.pm' to 0%03o: %s\n&quot;,$mode,$!);
+}
 
 my %builders = (
     unified =&gt; sub {
+        print 'Creating ',$target{build_file},&quot;\n&quot;;
         run_dofile(catfile($blddir, $target{build_file}),
                    @{$config{build_file_templates}});
     },
@@ -2349,6 +2554,17 @@ my %builders = (
 
 $builders{$builder}-&gt;($builder_platform, @builder_opts);
 
+# Show a note on the use of configdata.pm, but ONLY for release 1.1.1
+# (i.e. this message disappears with the following update, 1.1.1a)
+print &lt;&lt;&quot;EOF&quot; if ($config{version_num} =~ m|^0x1010100.L$|);
+
+NOTE: Starting with OpenSSL 1.1.1, 'Configure' doesn't display all the disabled
+options or the &quot;make variables&quot; with their values.  Instead, you must use
+'configdata.pm' as a script to get a display of the configuration data.  For
+help, please do this:
+
+        perl configdata.pm --help
+EOF
 print &lt;&lt;&quot;EOF&quot; if ($disabled{threads} eq &quot;unavailable&quot;);
 
 The library could not be configured for supporting multi-threaded
diff --git a/INSTALL b/INSTALL
index 006f72d..f8702e4 100644
--- a/INSTALL
+++ b/INSTALL
@@ -625,6 +625,22 @@
                    precedence over environment variables that are defined
                    when reconfiguring.
 
+ Displaying configuration data
+ -----------------------------
+
+ The configuration script itself will say very little, and finishes by
+ creating &quot;configdata.pm&quot;.  This perl module can be loaded by other scripts
+ to find all the configuration data, and it can also be used as a script to
+ display all sorts of configuration data in a human readable form.
+
+ For more information, please do:
+
+       $ ./configdata.pm --help                         # Unix
+
+       or
+
+       $ perl configdata.pm --help                      # Windows and VMS
+
  Installation in Detail
  ----------------------
 
diff --git a/NEWS b/NEWS
index 038a673..0fb5314 100644
--- a/NEWS
+++ b/NEWS
@@ -7,6 +7,7 @@
 
   Major changes between OpenSSL 1.1.0f and OpenSSL 1.1.1 [under development]
 
+      o Move the display of configuration data to configdata.pm.
       o Allow GNU style &quot;make variables&quot; to be used with Configure.
       o Add a STORE module (OSSL_STORE)
       o Claim the namespaces OSSL and OPENSSL, represented as symbol prefixes
diff --git a/README b/README
index b6dfda7..fb0334b 100644
--- a/README
+++ b/README
@@ -68,8 +68,7 @@
  and create an issue on GitHub:
 
     - OpenSSL version: output of 'openssl version -a'
-    - Any &quot;Configure&quot; options that you selected during compilation of the
-      library if applicable (see INSTALL)
+    - Configuration data: output of 'perl configdata.pm --dump'
     - OS Name, Version, Hardware platform
     - Compiler Details (name, version)
     - Application Details (name, version)
diff --git a/appveyor.yml b/appveyor.yml
index 75b1ccf..b3165d5 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -31,6 +31,7 @@ before_build:
     - mkdir _build
     - cd _build
     - perl ..\Configure %TARGET% %SHARED%
+    - perl configdata.pm --dump
     - cd ..
     - ps: &gt;-
         if (-not $env:APPVEYOR_PULL_REQUEST_NUMBER`
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017807.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="017831.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17820">[ date ]</a>
              <a href="thread.html#17820">[ thread ]</a>
              <a href="subject.html#17820">[ subject ]</a>
              <a href="author.html#17820">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
