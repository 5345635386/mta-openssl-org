<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2018-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1517131503.795047.23855.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017756.html">
   <LINK REL="Next"  HREF="017775.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1517131503.795047.23855.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Sun Jan 28 09:25:03 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="017756.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="017775.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17770">[ date ]</a>
              <a href="thread.html#17770">[ thread ]</a>
              <a href="subject.html#17770">[ subject ]</a>
              <a href="author.html#17770">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  3c0c6b97e1910258bfac31be407c2d8b8cded76c (commit)
       via  d76117b9ad9105f179fe6f1e77c5d31cb668019c (commit)
       via  36f7be2c2f35bc408c38de611566fae0de0a3b58 (commit)
       via  085ed4f15a8a5eb9ac7fd1151f7a3308d4372c04 (commit)
       via  5b18235a186dd28ec7a37ed95e29f4ab61f2bcbe (commit)
       via  8c3bc594e0c74926bfefb84b8bae8a2fac82e465 (commit)
      from  df05f155a69b96b174e0e47bc689bf729de684b6 (commit)


- Log -----------------------------------------------------------------
commit 3c0c6b97e1910258bfac31be407c2d8b8cded76c
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Jan 27 16:53:07 2018 +0100

    Add a note on Configure variable processing in NEWS and CHANGES
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5177">https://github.com/openssl/openssl/pull/5177</A>)

commit d76117b9ad9105f179fe6f1e77c5d31cb668019c
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Jan 27 13:06:39 2018 +0100

    Make sure all our config targets inherit a BASE template
    
    There were a small number that inherited no BASE, the now inherit
    BASE_unix.
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5177">https://github.com/openssl/openssl/pull/5177</A>)

commit 36f7be2c2f35bc408c38de611566fae0de0a3b58
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Jan 27 13:01:44 2018 +0100

    We need Unixly defaults for config targets that don't inherit a BASE
    
    Ideally, each config target should inherit a base to get their
    platform specific defaults.  Unfortunately, that is currently not the
    case, so we duplicate the Unixly defaults from the BASE_unix template
    into the DEFAULT template.
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5177">https://github.com/openssl/openssl/pull/5177</A>)

commit 085ed4f15a8a5eb9ac7fd1151f7a3308d4372c04
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sat Jan 27 12:13:35 2018 +0100

    Stop having Unix defaults in Configure (partial)
    
    Default values belong in the DEFAULT config target template, in
    Configurations/00-base-templates.conf.
    
    This isn't a complete move, but takes care of the most blatant
    examples.
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5177">https://github.com/openssl/openssl/pull/5177</A>)

commit 5b18235a186dd28ec7a37ed95e29f4ab61f2bcbe
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Fri Jan 26 19:56:44 2018 +0100

    Processing GNU-style &quot;make variables&quot; - implementation
    
    Support the following &quot;make variables&quot;:
    
    AR              (GNU compatible)
    ARFLAGS         (GNU Compatible)
    AS              (GNU Compatible)
    ASFLAGS         (GNU Compatible)
    CC              (GNU Compatible)
    CFLAGS          (GNU Compatible)
    CXX             (GNU Compatible)
    CXXFLAGS        (GNU Compatible)
    CPP             (GNU Compatible)
    CPPFLAGS        (GNU Compatible)
    CPPDEFINES      List of CPP macro definitions.  Alternative for -D
    CPPINCLUDES     List of CPP inclusion directories.  Alternative for -I
    HASHBANGPERL    Perl invocation to be inserted after '#!' in public
                    perl scripts.
    LDFLAGS         (GNU Compatible)
    LDLIBS          (GNU Compatible)
    RANLIB          Program to generate library archive index
    RC              Program to manipulate Windows resources
    RCFLAGS         Flags for $(RC)
    RM              (GNU Compatible)
    
    Setting one of these overrides the corresponding data from our config
    targets.  However, flags given directly on the configuration command
    line are additional, and are therefore added to the flags coming from
    one of the variables above or the config target.
    
    Fixes #2420
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5177">https://github.com/openssl/openssl/pull/5177</A>)

commit 8c3bc594e0c74926bfefb84b8bae8a2fac82e465
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Tue Jan 23 13:54:55 2018 +0100

    Processing GNU-style &quot;make variables&quot; - separate CPP flags from C flags
    
    C preprocessor flags get separated from C flags, which has the
    advantage that we don't get loads of macro definitions and inclusion
    directory specs when linking shared libraries, DSOs and programs.
    
    This is a step to add support for &quot;make variables&quot; when configuring.
    
    Reviewed-by: Tim Hudson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/5177">https://github.com/openssl/openssl/pull/5177</A>)

-----------------------------------------------------------------------

Summary of changes:
 CHANGES                               |   3 +
 Configurations/00-base-templates.conf |  27 ++-
 Configurations/10-main.conf           | 368 +++++++++++++++++++++-------------
 Configurations/90-team.conf           |  14 +-
 Configurations/README                 |  18 +-
 Configurations/descrip.mms.tmpl       |  43 ++--
 Configurations/shared-info.pl         |   4 +-
 Configurations/unix-Makefile.tmpl     |  61 ++++--
 Configurations/windows-makefile.tmpl  |  66 +++---
 Configure                             | 292 ++++++++++++++++++---------
 INSTALL                               |  70 ++++++-
 NEWS                                  |   2 +-
 crypto/aes/build.info                 |  12 +-
 crypto/bf/build.info                  |   4 +-
 crypto/bn/build.info                  |  15 +-
 crypto/build.info                     |   6 +-
 crypto/camellia/build.info            |   4 +-
 crypto/cast/build.info                |   4 +-
 crypto/chacha/build.info              |   4 +-
 crypto/des/build.info                 |   6 +-
 crypto/ec/build.info                  |   4 +-
 crypto/md5/build.info                 |   3 +-
 crypto/modes/build.info               |   7 +-
 crypto/poly1305/build.info            |   4 +-
 crypto/rc4/build.info                 |   4 +-
 crypto/rc5/build.info                 |   3 +-
 crypto/ripemd/build.info              |   3 +-
 crypto/sha/build.info                 |  21 +-
 crypto/whrlpool/build.info            |   4 +-
 engines/build.info                    |   4 +-
 30 files changed, 747 insertions(+), 333 deletions(-)

diff --git a/CHANGES b/CHANGES
index 67f0746..b3aa741 100644
--- a/CHANGES
+++ b/CHANGES
@@ -9,6 +9,9 @@
 
  Changes between 1.1.0f and 1.1.1 [xx XXX xxxx]
 
+  *) Added processing of &quot;make variables&quot; to Configure.
+     [Richard Levitte]
+
   *) Added SHA512/224 and SHA512/256 algorithm support.
      [Paul Dale]
 
diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
index f153992..72cbde2 100644
--- a/Configurations/00-base-templates.conf
+++ b/Configurations/00-base-templates.conf
@@ -4,6 +4,8 @@ my %targets=(
 	template	=&gt; 1,
 
 	cflags		=&gt; &quot;&quot;,
+	cppflags	=&gt; &quot;&quot;,
+	lflags		=&gt; &quot;&quot;,
 	defines		=&gt; [],
 	thread_scheme	=&gt; &quot;(unknown)&quot;, # Assume we don't know
 	thread_defines	=&gt; [],
@@ -36,8 +38,22 @@ my %targets=(
 	shared_rcflag	=&gt; &quot;&quot;,
 	shared_extension	=&gt; &quot;&quot;,
 
-        build_scheme    =&gt; [ &quot;unified&quot;, &quot;unix&quot; ],
-        build_file      =&gt; &quot;Makefile&quot;,
+	#### Defaults for the benefit of the config targets who don't inherit
+	#### a BASE and assume Unixly defaults
+	#### THESE WILL DISAPPEAR IN OpenSSL 1.2
+	build_scheme	=&gt; [ &quot;unified&quot;, &quot;unix&quot; ],
+	build_file	=&gt; &quot;Makefile&quot;,
+
+	ar		=&gt; &quot;ar&quot;,
+	arflags		=&gt; &quot;r&quot;,
+	cc		=&gt; &quot;cc&quot;,
+	hashbangperl	=&gt; &quot;/usr/bin/env perl&quot;,
+	ranlib		=&gt; sub { which(&quot;$config{cross_compile_prefix}ranlib&quot;) ?
+				     &quot;\$(CROSS_COMPILE)ranlib&quot; : &quot;true&quot;; },
+	rc		=&gt; &quot;windres&quot;,
+
+	#### THESE WILL BE ENABLED IN OpenSSL 1.2
+	#hashbangperl	=&gt; &quot;PERL&quot;, # Only Unix actually cares
     },
 
     BASE_common =&gt; {
@@ -59,12 +75,19 @@ my %targets=(
         inherit_from    =&gt; [ &quot;BASE_common&quot; ],
         template        =&gt; 1,
 
+        ar              =&gt; &quot;ar&quot;,
+        arflags         =&gt; &quot;r&quot;,
+        cc              =&gt; &quot;cc&quot;,
         lflags          =&gt;
             sub { $withargs{zlib_lib} ? &quot;-L&quot;.$withargs{zlib_lib} : () },
         ex_libs         =&gt;
             sub { !defined($disabled{zlib})
                   &amp;&amp; defined($disabled{&quot;zlib-dynamic&quot;})
                   ? &quot;-lz&quot; : () },
+        hashbangperl    =&gt; &quot;/usr/bin/env perl&quot;, # Only Unix actually cares
+        ranlib          =&gt; sub { which(&quot;$config{cross_compile_prefix}ranlib&quot;) ?
+                                     &quot;\$(CROSS_COMPILE)ranlib&quot; : &quot;true&quot;; },
+        rc              =&gt; &quot;windres&quot;,
 
         build_scheme    =&gt; [ &quot;unified&quot;, &quot;unix&quot; ],
         build_file      =&gt; &quot;Makefile&quot;,
diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index f085a90..21b4f3b 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -107,7 +107,7 @@ sub vc_wince_info {
             $wcelflag.=&quot; /machine:$wcetgt&quot;;                     last; };
       }
 
-        $vc_wince_info = { cflags =&gt; $wcecdefs,
+        $vc_wince_info = { cppflags =&gt; $wcecdefs,
                            lflags =&gt; $wcelflag };
     }
     return $vc_wince_info;
@@ -148,6 +148,7 @@ my %targets = (
 
 #### Basic configs that should work on any 32-bit box
     &quot;gcc&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; picker(debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
@@ -155,6 +156,7 @@ my %targets = (
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
     &quot;cc&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
         cflags           =&gt; &quot;-O&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
@@ -164,9 +166,10 @@ my %targets = (
     &quot;vos-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-Wall -DOPENSSL_SYS_VOS -D_POSIX_C_SOURCE=200112L -D_BSD -D_VOS_EXTENDED_NAMES -DB_ENDIAN&quot;,
+        cflags           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-O0 -g&quot;,
                                    release =&gt; &quot;-O3&quot;),
+        cppflags         =&gt; &quot;-D_POSIX_C_SOURCE=200112L -D_BSD -D_VOS_EXTENDED_NAMES -DB_ENDIAN&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         sys_id           =&gt; &quot;VOS&quot;,
         lflags           =&gt; add(&quot;-Wl,-map&quot;),
@@ -178,7 +181,7 @@ my %targets = (
     &quot;solaris-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         template         =&gt; 1,
-        cflags           =&gt; &quot;-DFILIO_H&quot;,
+        cppflags         =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -ldl&quot;),
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -192,10 +195,11 @@ my %targets = (
         # failures [at least] in 32-bit build.
         inherit_from     =&gt; [ &quot;solaris-common&quot;, asm(&quot;x86_elf_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-Wall -DL_ENDIAN&quot;,
+        cflags           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
                                               debug   =&gt; &quot;-O0 -g&quot;,
                                               release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
                                        threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; add(&quot;-DL_DEBIAN&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         shared_cflag     =&gt; &quot;-fPIC&quot;,
@@ -212,10 +216,11 @@ my %targets = (
         #                        -- &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
         inherit_from     =&gt; [ &quot;solaris-common&quot;, asm(&quot;x86_64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-m64 -Wall -DL_ENDIAN&quot;,
+        cflags           =&gt; add_before(picker(default =&gt; &quot;-m64 -Wall&quot;,
                                               debug   =&gt; &quot;-O0 -g&quot;,
                                               release =&gt; &quot;-O3&quot;),
                                        threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; add(&quot;-DL_DEBIAN&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
@@ -240,10 +245,10 @@ my %targets = (
     &quot;solaris64-x86_64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;solaris-common&quot;, asm(&quot;x86_64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-xarch=generic64 -xstrconst -Xa -DL_ENDIAN&quot;,
+        cflags           =&gt; add_before(picker(default =&gt; &quot;-xarch=generic64 -xstrconst -Xa&quot;,
                                               debug   =&gt; &quot;-g&quot;,
-                                              release =&gt; &quot;-xO5 -xdepend -xbuiltin&quot;),
-                                       threads(&quot;-D_REENTRANT&quot;)),
+                                              release =&gt; &quot;-xO5 -xdepend -xbuiltin&quot;)),
+        cppflags         =&gt; add(&quot;-DL_DEBIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         thread_scheme    =&gt; &quot;pthreads&quot;,
         lflags           =&gt; add(threads(&quot;-mt&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
@@ -258,10 +263,11 @@ my %targets = (
     &quot;solaris-sparcv7-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;solaris-common&quot; ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-Wall -DB_ENDIAN -DBN_DIV2W&quot;,
+        cflags           =&gt; add_before(picker(default =&gt; &quot;-Wall&quot;,
                                               debug   =&gt; &quot;-O0 -g&quot;,
                                               release =&gt; &quot;-O3&quot;),
                                        threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; add(&quot;-DB_DEBIAN -DBN_DIV2W&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         shared_cflag     =&gt; &quot;-fPIC&quot;,
@@ -291,10 +297,11 @@ my %targets = (
     &quot;solaris-sparcv7-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;solaris-common&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; add_before(picker(default =&gt; &quot;-xstrconst -Xa -DB_ENDIAN -DBN_DIV2W&quot;,
+        cflags           =&gt; add_before(picker(default =&gt; &quot;-xstrconst -Xa&quot;,
                                               debug   =&gt; &quot;-g&quot;,
-                                              release =&gt; &quot;-xO5 -xdepend&quot;),
-                                       threads(&quot;-D_REENTRANT&quot;)),
+                                              release =&gt; &quot;-xO5 -xdepend&quot;)),
+        cppflags         =&gt; add(&quot;-DB_DEBIAN -DBN_DIV2W&quot;,
+                                threads(&quot;-D_REENTRANT&quot;)),
         lflags           =&gt; add(threads(&quot;-mt&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -322,9 +329,10 @@ my %targets = (
     &quot;irix-mips3-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-mabi=n32 -DB_ENDIAN -DBN_DIV3W&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-mabi=n32&quot;,
                                            debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3&quot;),
+                                           release =&gt; &quot;-O3&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT&quot;,
@@ -338,9 +346,10 @@ my %targets = (
     &quot;irix-mips3-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-n32 -mips3 -use_readonly_const -G0 -rdata_shared -DB_ENDIAN -DBN_DIV3W&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-n32 -mips3 -use_readonly_const -G0 -rdata_shared&quot;,
                                            debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O2&quot;),
+                                           release =&gt; &quot;-O2&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT&quot;,
@@ -355,9 +364,10 @@ my %targets = (
     &quot;irix64-mips4-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-mabi=64 -mips4 -DB_ENDIAN -DBN_DIV3W&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-mabi=64 -mips4&quot;,
                                            debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3&quot;),
+                                           release =&gt; &quot;-O3&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT_LONG&quot;,
@@ -371,9 +381,10 @@ my %targets = (
     &quot;irix64-mips4-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-64 -mips4 -use_readonly_const -G0 -rdata_shared -DB_ENDIAN -DBN_DIV3W&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-64 -mips4 -use_readonly_const -G0 -rdata_shared&quot;,
                                            debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O2&quot;),
+                                           release =&gt; &quot;-O2&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN -DBN_DIV3W&quot;,
                                     threads(&quot;-D_SGI_MP_SOURCE&quot;)),
         ex_libs          =&gt; add(threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR SIXTY_FOUR_BIT_LONG&quot;,
@@ -415,10 +426,10 @@ my %targets = (
     &quot;hpux-parisc-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-DB_ENDIAN -DBN_DIV2W&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
+        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;),
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DB_DEBIAN -DBN_DIV2W&quot;,
         ex_libs          =&gt; add(&quot;-Wl,+s -ldld&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -435,10 +446,9 @@ my %targets = (
     &quot;hpux64-parisc2-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;parisc20_64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-DB_ENDIAN&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-D_REENTRANT&quot;)),
+        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
+                                           release =&gt; &quot;-O3&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -454,9 +464,10 @@ my %targets = (
     &quot;hpux-parisc-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;+Optrs_strongly_typed -Ae +ESlit -DB_ENDIAN -DBN_DIV2W -DMD32_XARRAY&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;+Optrs_strongly_typed -Ae +ESlit&quot;,
                                            debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O3&quot;),
+                                           release =&gt; &quot;+O3&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN -DBN_DIV2W -DMD32_XARRAY&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-Wl,+s -ldld&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;RC4_CHAR&quot;,
@@ -475,9 +486,10 @@ my %targets = (
     &quot;hpux64-parisc2-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;parisc20_64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;+DD64 +Optrs_strongly_typed -Ae +ESlit -DB_ENDIAN -DMD32_XARRAY&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;+DD64 +Optrs_strongly_typed -Ae +ESlit&quot;,
                                            debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O3&quot;),
+                                           release =&gt; &quot;+O3&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN -DMD32_XARRAY&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
@@ -494,10 +506,10 @@ my %targets = (
     &quot;hpux-ia64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-Ae +DD32 +Olit=all -z -DB_ENDIAN&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-Ae +DD32 +Olit=all -z&quot;,
                                            debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O2&quot;),
-                                    threads(&quot;-D_REENTRANT&quot;)),
+                                           release =&gt; &quot;+O2&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;,threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -511,10 +523,10 @@ my %targets = (
     &quot;hpux64-ia64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-Ae +DD64 +Olit=all -z -DB_ENDIAN&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-Ae +DD64 +Olit=all -z&quot;,
                                            debug   =&gt; &quot;+O0 +d -g&quot;,
-                                           release =&gt; &quot;+O3&quot;),
-                                    threads(&quot;-D_REENTRANT&quot;)),
+                                           release =&gt; &quot;+O3&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_DEBIAN&quot;, threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-lpthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -529,10 +541,10 @@ my %targets = (
     &quot;hpux-ia64-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-DB_ENDIAN&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
+        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;),
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DB_DEBIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -546,10 +558,11 @@ my %targets = (
     &quot;hpux64-ia64-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ia64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-mlp64 -DB_ENDIAN&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-mlp64&quot;,
                                            debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;),
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DB_DEBIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -565,7 +578,9 @@ my %targets = (
     &quot;MPE/iX-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-D_ENDIAN -DBN_DIV2W -O3 -D_POSIX_SOURCE -D_SOCKET_SOURCE -I/SYSLOG/PUB&quot;,
+        cflags           =&gt; &quot;-O3&quot;,
+        cppflags         =&gt; &quot;-D_ENDIAN -DBN_DIV2W -D_POSIX_SOURCE -D_SOCKET_SOURCE&quot;,
+        includes         =&gt; [ &quot;/SYSLOG/PUB&quot; ],
         sys_id           =&gt; &quot;MPE&quot;,
         lflags           =&gt; add(&quot;-L/SYSLOG/PUB&quot;),
         ex_libs          =&gt; add(&quot;-lsyslog -lsocket -lcurses&quot;),
@@ -580,8 +595,8 @@ my %targets = (
     &quot;tru64-alpha-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;alpha_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(&quot;-std=c9x -D_XOPEN_SOURCE=500 -D_OSF_SOURCE -O3&quot;,
-                                    threads(&quot;-pthread&quot;)),
+        cflags           =&gt; combine(&quot;-std=c9x -O3&quot;, threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-D_XOPEN_SOURCE=500 -D_OSF_SOURCE&quot;,
         ex_libs          =&gt; add(&quot;-lrt&quot;, threads(&quot;-pthread&quot;)), # for mlock(2)
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -592,8 +607,9 @@ my %targets = (
     &quot;tru64-alpha-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;alpha_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-std1 -D_XOPEN_SOURCE=500 -D_OSF_SOURCE -tune host -fast -readonly_strings&quot;,
+        cflags           =&gt; combine(&quot;-std1 -tune host -fast -readonly_strings&quot;,
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-D_XOPEN_SOURCE=500 -D_OSF_SOURCE&quot;,
         ex_libs          =&gt; add(&quot;-lrt&quot;, threads(&quot;-pthread&quot;)), # for mlock(2)
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -616,12 +632,13 @@ my %targets = (
                                            debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;),
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DOPENSSL_USE_NODELETE&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         shared_target    =&gt; &quot;linux-shared&quot;,
-        shared_cflag     =&gt; &quot;-fPIC -DOPENSSL_USE_NODELETE&quot;,
+        shared_cflag     =&gt; &quot;-fPIC&quot;,
         shared_ldflag    =&gt; &quot;-Wl,-znodelete&quot;,
         shared_extension =&gt; &quot;.so.\$(SHLIB_VERSION_NUMBER)&quot;,
     },
@@ -636,13 +653,15 @@ my %targets = (
     },
     &quot;linux-ppc64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;ppc64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m64 -DB_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-m64&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;linux64&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
     &quot;linux-ppc64le&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;ppc64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m64 -DL_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-m64&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;linux64le&quot;,
     },
 
@@ -696,21 +715,24 @@ my %targets = (
         # Configure script adds minimally required -march for assembly
         # support, if no -march was specified at command line.
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;mips32_asm&quot;) ],
-        cflags           =&gt; add(&quot;-mabi=32 -DBN_DIV3W&quot;),
+        cflags           =&gt; add(&quot;-mabi=32&quot;),
+        cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
         perlasm_scheme   =&gt; &quot;o32&quot;,
     },
     # mips32 and mips64 below refer to contemporary MIPS Architecture
     # specifications, MIPS32 and MIPS64, rather than to kernel bitness.
     &quot;linux-mips64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;mips64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-mabi=n32 -DBN_DIV3W&quot;),
+        cflags           =&gt; add(&quot;-mabi=n32&quot;),
+        cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT RC4_CHAR&quot;,
         perlasm_scheme   =&gt; &quot;n32&quot;,
         multilib         =&gt; &quot;32&quot;,
     },
     &quot;linux64-mips64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;mips64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-mabi=64 -DBN_DIV3W&quot;),
+        cflags           =&gt; add(&quot;-mabi=64&quot;),
+        cppflags         =&gt; add(&quot;-DBN_DIV3W&quot;),
         perlasm_scheme   =&gt; &quot;64&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
@@ -720,16 +742,17 @@ my %targets = (
     #### machines where gcc doesn't understand -m32 and -m64
     &quot;linux-elf&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_elf_asm&quot;) ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-DL_ENDIAN&quot;,
-                                       release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cflags           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
     &quot;linux-aout&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; add(picker(default =&gt; &quot;-DL_ENDIAN -Wall&quot;,
+        cflags           =&gt; add(picker(default =&gt; &quot;-Wall&quot;,
                                        debug   =&gt; &quot;-O0 -g&quot;,
                                        release =&gt; &quot;-O3 -fomit-frame-pointer&quot;)),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         perlasm_scheme   =&gt; &quot;a.out&quot;,
@@ -738,8 +761,9 @@ my %targets = (
     #### X86 / X86_64 targets
     &quot;linux-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-m32 -DL_ENDIAN&quot;,
+        cflags           =&gt; add(picker(default =&gt; &quot;-m32&quot;,
                                        release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
     },
@@ -751,7 +775,8 @@ my %targets = (
     },
     &quot;linux-x86_64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m64 -DL_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-m64&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
         multilib         =&gt; &quot;64&quot;,
@@ -764,7 +789,8 @@ my %targets = (
     },
     &quot;linux-x32&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-mx32 -DL_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-mx32&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
         perlasm_scheme   =&gt; &quot;elf32&quot;,
         multilib         =&gt; &quot;x32&quot;,
@@ -777,7 +803,8 @@ my %targets = (
 
     &quot;linux64-s390x&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;s390x_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m64 -DB_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-m64&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;64&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
@@ -799,7 +826,8 @@ my %targets = (
         # sysdeps/s390/dl-procinfo.c affecting ldconfig and ld.so.1...
         #
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;s390x_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m31 -Wa,-mzarch -DB_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-m31 -Wa,-mzarch&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_asm_src       =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s|asm/s390x\.S|bn_asm.c|; $r; },
         perlasm_scheme   =&gt; &quot;31&quot;,
         multilib         =&gt; &quot;/highgprs&quot;,
@@ -808,32 +836,36 @@ my %targets = (
     #### SPARC Linux setups
     &quot;linux-sparcv8&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;sparcv8_asm&quot;) ],
-        cflags           =&gt; add(&quot;-mcpu=v8 -DB_ENDIAN -DBN_DIV2W&quot;),
+        cflags           =&gt; add(&quot;-mcpu=v8&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
     },
     &quot;linux-sparcv9&quot; =&gt; {
         # it's a real mess with -mcpu=ultrasparc option under Linux,
         # but -Wa,-Av8plus should do the trick no matter what.
         inherit_from     =&gt; [ &quot;linux-generic32&quot;, asm(&quot;sparcv9_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m32 -mcpu=ultrasparc -Wa,-Av8plus -DB_ENDIAN -DBN_DIV2W&quot;),
+        cflags           =&gt; add(&quot;-m32 -mcpu=ultrasparc -Wa,-Av8plus&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN -DBN_DIV2W&quot;),
     },
     &quot;linux64-sparcv9&quot; =&gt; {
         # GCC 3.1 is a requirement
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;sparcv9_asm&quot;) ],
-        cflags           =&gt; add(&quot;-m64 -mcpu=ultrasparc -DB_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-m64 -mcpu=ultrasparc&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         multilib         =&gt; &quot;64&quot;,
     },
 
     &quot;linux-alpha-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;linux-generic64&quot;, asm(&quot;alpha_asm&quot;) ],
-        cflags           =&gt; add(&quot;-DL_ENDIAN&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
     },
     &quot;linux-c64xplus&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         # TI_CGT_C6000_7.3.x is a requirement
         cc               =&gt; &quot;cl6x&quot;,
-        cflags           =&gt; combine(&quot;--linux -ea=.s -eo=.o -mv6400+ -o2 -ox -ms -pden -DOPENSSL_SMALL_FOOTPRINT&quot;,
+        cflags           =&gt; &quot;--linux -ea=.s -eo=.o -mv6400+ -o2 -ox -ms -pden&quot;,
+        cppflags         =&gt; combine(&quot;-DOPENSSL_SMALL_FOOTPRINT&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         cpuid_asm_src    =&gt; &quot;c64xpluscpuid.s&quot;,
@@ -959,7 +991,8 @@ my %targets = (
         cflags           =&gt; combine(picker(default =&gt; &quot;-Wall&quot;,
                                            debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-pthread -D_THREAD_SAFE -D_REENTRANT&quot;)),
+                                    threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; threads(&quot;-D_THREAD_SAFE -D_REENTRANT&quot;),
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         enable           =&gt; add(&quot;devcryptoeng&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -976,8 +1009,8 @@ my %targets = (
 
     &quot;BSD-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic32&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-DL_ENDIAN&quot;,
-                                       release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cflags           =&gt; add(picker(release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         shared_target    =&gt; &quot;bsd-shared&quot;,
         perlasm_scheme   =&gt; &quot;a.out&quot;,
@@ -989,26 +1022,27 @@ my %targets = (
 
     &quot;BSD-sparcv8&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic32&quot;, asm(&quot;sparcv8_asm&quot;) ],
-        cflags           =&gt; add(&quot;-mcpu=v8 -DB_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-mcpu=v8&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
     },
     &quot;BSD-sparc64&quot; =&gt; {
         # -DMD32_REG_T=int doesn't actually belong in sparc64 target, it
         # simply *happens* to work around a compiler bug in gcc 3.3.3,
         # triggered by RIPEMD160 code.
         inherit_from     =&gt; [ &quot;BSD-generic64&quot;, asm(&quot;sparcv9_asm&quot;) ],
-        cflags           =&gt; add(&quot;-DB_ENDIAN -DMD32_REG_T=int&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN -DMD32_REG_T=int&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
     },
 
     &quot;BSD-ia64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic64&quot;, asm(&quot;ia64_asm&quot;) ],
-        cflags           =&gt; add_before(&quot;-DL_ENDIAN&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
     },
 
     &quot;BSD-x86_64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BSD-generic64&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cflags           =&gt; add_before(&quot;-DL_ENDIAN&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;elf&quot;,
     },
@@ -1016,7 +1050,8 @@ my %targets = (
     &quot;bsdi-elf-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-DPERL5 -DL_ENDIAN -fomit-frame-pointer -O3 -Wall&quot;,
+        cflags           =&gt; &quot;-fomit-frame-pointer -O3 -Wall&quot;,
+        cppflags         =&gt; &quot;-DPERL5 -DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
@@ -1047,7 +1082,8 @@ my %targets = (
     &quot;qnx4&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-DL_ENDIAN -DTERMIO&quot;,
+        cflags           =&gt; &quot;&quot;,
+        cppflags         =&gt; &quot;-DL_ENDIAN -DTERMIO&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;QNX6&quot; =&gt; {
@@ -1062,7 +1098,8 @@ my %targets = (
     &quot;QNX6-i386&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-DL_ENDIAN -O2 -Wall&quot;,
+        cflags           =&gt; &quot;-O2 -Wall&quot;,
+        cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-lsocket&quot;),
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         shared_target    =&gt; &quot;bsd-gcc-shared&quot;,
@@ -1084,24 +1121,24 @@ my %targets = (
     &quot;unixware-2.0&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-DFILIO_H -DNO_STRINGS_H&quot;,
-                                    threads(&quot;-Kthread&quot;)),
+        cflags           =&gt; combine(threads(&quot;-Kthread&quot;)),
+        cppflags         =&gt; &quot;-DFILIO_H -DNO_STRINGS_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -lresolv -lx&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
     },
     &quot;unixware-2.1&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-O -DFILIO_H&quot;,
-                                    threads(&quot;-Kthread&quot;)),
+        cflags           =&gt; combine(&quot;-O&quot;, threads(&quot;-Kthread&quot;)),
+        cppflags         =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl -lresolv -lx&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
     },
     &quot;unixware-7&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(&quot;-O -DFILIO_H -Kalloca&quot;,
-                                    threads(&quot;-Kthread&quot;)),
+        cflags           =&gt; combine(&quot;-O -Kalloca&quot;, threads(&quot;-Kthread&quot;)),
+        cppflags         =&gt; &quot;-DFILIO_H&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         thread_scheme    =&gt; &quot;uithreads&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
@@ -1114,8 +1151,9 @@ my %targets = (
     &quot;unixware-7-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_elf_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(&quot;-DL_ENDIAN -DFILIO_H -O3 -fomit-frame-pointer -Wall&quot;,
-                                    threads(&quot;-D_REENTRANT&quot;)),
+        cflags           =&gt; combine(&quot;-O3 -fomit-frame-pointer -Wall&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN -DFILIO_H&quot;,
+                                threads(&quot;-D_REENTRANT&quot;)),
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1161,10 +1199,10 @@ my %targets = (
     &quot;aix-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc32_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-DB_ENDIAN&quot;,
-                                           debug   =&gt; &quot;-O0 -g&quot;,
+        cflags           =&gt; combine(picker(debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O&quot;),
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -1179,10 +1217,11 @@ my %targets = (
     &quot;aix64-gcc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-maix64 -DB_ENDIAN&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-maix64&quot;,
                                            debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O&quot;),
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DB_ENDIAN&quot;,
         ex_libs          =&gt; add(threads(&quot;-pthread&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
@@ -1197,10 +1236,11 @@ my %targets = (
     &quot;aix-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc32_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-q32 -DB_ENDIAN -qmaxmem=16384 -qro -qroconst&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-q32 -qmaxmem=16384 -qro -qroconst&quot;,
                                            debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O&quot;),
-                                    threads(&quot;-qthreaded -D_THREAD_SAFE&quot;)),
+                                    threads(&quot;-qthreaded&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_THREAD_SAFE&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1215,10 +1255,11 @@ my %targets = (
     &quot;aix64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;ppc64_asm&quot;) ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-q64 -DB_ENDIAN -qmaxmem=16384 -qro -qroconst&quot;,
+        cflags           =&gt; combine(picker(default =&gt; &quot;-q64 -qmaxmem=16384 -qro -qroconst&quot;,
                                            debug   =&gt; &quot;-O0 -g&quot;,
                                            release =&gt; &quot;-O&quot;),
-                                    threads(&quot;-qthreaded -D_THREAD_SAFE&quot;)),
+                                    threads(&quot;-qthreaded&quot;)),
+        cppflags         =&gt; combine(&quot;-DB_ENDIAN&quot;, threads(&quot;-D_THREAD_SAFE&quot;)),
         sys_id           =&gt; &quot;AIX&quot;,
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1235,7 +1276,8 @@ my %targets = (
     &quot;BS2000-OSD&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;c89&quot;,
-        cflags           =&gt; &quot;-O -XLLML -XLLMK -XL -DB_ENDIAN -DCHARSET_EBCDIC&quot;,
+        cflags           =&gt; &quot;-O -XLLML -XLLMK -XL&quot;,
+        cppflags         =&gt; &quot;-DB_ENDIAN -DCHARSET_EBCDIC&quot;,
         ex_libs          =&gt; add(&quot;-lsocket -lnsl&quot;),
         bn_ops           =&gt; &quot;THIRTY_TWO_BIT RC4_CHAR&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
@@ -1256,8 +1298,11 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_Windows&quot; ],
         template         =&gt; 1,
         cc               =&gt; &quot;cl&quot;,
-        cflags           =&gt; &quot;-W3 -wd4090 -Gs0 -GF -Gy -nologo -DOPENSSL_SYS_WIN32 -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -D_CRT_SECURE_NO_DEPRECATE -D_WINSOCK_DEPRECATED_NO_WARNINGS&quot;,
-        defines          =&gt; add(sub { my @defs = ();
+        cflags           =&gt; &quot;-W3 -wd4090 -Gs0 -GF -Gy -nologo&quot;,
+        defines          =&gt; add(&quot;OPENSSL_SYS_WIN32&quot;, &quot;WIN32_LEAN_AND_MEAN&quot;,
+                                &quot;L_ENDIAN&quot;, &quot;_CRT_SECURE_NO_DEPRECATE&quot;,
+                                &quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;,
+                                sub { my @defs = ();
                                       unless ($disabled{&quot;zlib-dynamic&quot;}) {
                                           my $zlib =
                                               $withargs{zlib_lib} // &quot;ZLIB1&quot;;
@@ -1266,7 +1311,7 @@ my %targets = (
                                                       'LIBZ=&quot;' . $zlib . '&quot;');
                                       }
                                       return [ @defs ];
-                                    }),
+                                  }),
         coutflag         =&gt; &quot;/Fo&quot;,
         lib_cflags       =&gt; add(&quot;/Zi /Fdossl_static&quot;),
         dso_cflags       =&gt; &quot;/Zi /Fddso&quot;,
@@ -1281,17 +1326,18 @@ my %targets = (
     &quot;VC-noCE-common&quot; =&gt; {
         inherit_from     =&gt; [ &quot;VC-common&quot; ],
         template         =&gt; 1,
-        cflags           =&gt; add(picker(default =&gt; &quot;-DUNICODE -D_UNICODE&quot;,
-                                       debug   =&gt;
+        cflags           =&gt; add(picker(debug   =&gt;
                                        sub {
                                            ($disabled{shared} ? &quot;&quot; : &quot;/MDd&quot;)
-                                               .&quot; /Od -DDEBUG -D_DEBUG&quot;;
+                                               .&quot; /Od&quot;;
                                        },
                                        release =&gt;
                                        sub {
                                            ($disabled{shared} ? &quot;&quot; : &quot;/MD&quot;)
                                                .&quot; /O2&quot;;
                                        })),
+        defines          =&gt; add(picker(default =&gt; [ &quot;UNICODE&quot;, &quot;_UNICODE&quot; ],
+                                       debug   =&gt; [ &quot;DEBUG&quot;, &quot;_DEBUG&quot; ])),
         lib_cflags       =&gt; add(sub { $disabled{shared} ? &quot;/MT /Zl&quot; : () }),
         # Following might/should appears controversial, i.e. defining
         # /MDd without evaluating $disabled{shared}. It works in
@@ -1364,7 +1410,7 @@ my %targets = (
             # WIN32 UNICODE build gets linked with unicows.lib for
             # backward compatibility with Win9x.
             push @ex_libs, 'unicows.lib'
-                if (grep { $_ eq &quot;UNICODE&quot; } @user_defines);
+                if (grep { $_ eq &quot;UNICODE&quot; } @{$user{CPPDEFINES}});
             return join(&quot; &quot;, @ex_libs, @_);
         }),
         sys_id           =&gt; &quot;WIN32&quot;,
@@ -1380,17 +1426,24 @@ my %targets = (
         cc               =&gt; &quot;cl&quot;,
         cflags           =&gt;
             picker(default =&gt;
-                   combine('/W3 /WX /GF /Gy /nologo -DUNICODE -D_UNICODE -DOPENSSL_SYS_WINCE -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -DDSO_WIN32 -DNO_CHMOD -DOPENSSL_SMALL_FOOTPRINT',
+                   combine('/W3 /WX /GF /Gy /nologo',
                            sub { vc_wince_info()-&gt;{cflags}; },
-                           sub { defined(env('WCECOMPAT'))
-                                     ? '-I$(WCECOMPAT)/include' : (); },
-                           sub { defined(env('PORTSDK_LIBPATH'))
-                                     ? '-I$(PORTSDK_LIBPATH)/../../include' : (); },
                            sub { `cl 2&gt;&amp;1` =~ /Version ([0-9]+)\./ &amp;&amp; $1&gt;=14
                                      ? ($disabled{shared} ? &quot; /MT&quot; : &quot; /MD&quot;)
                                      : &quot; /MC&quot;; }),
-                   debug   =&gt; &quot;/Od -DDEBUG -D_DEBUG&quot;,
+                   debug   =&gt; &quot;/Od&quot;,
                    release =&gt; &quot;/O1i&quot;),
+        cppflags         =&gt; sub { vc_wince_info()-&gt;{defines}; },
+        defines          =&gt;
+            picker(default =&gt; [ &quot;UNICODE&quot;, &quot;_UNICODE&quot;, &quot;OPENSSL_SYS_WINCE&quot;,
+                                &quot;WIN32_LEAN_AND_MEAN&quot;, &quot;L_ENDIAN&quot;, &quot;DSO_WIN32&quot;,
+                                &quot;NO_CHMOD&quot;, &quot;OPENSSL_SMALL_FOOTPRINT&quot; ],
+                   debug   =&gt; [ &quot;DEBUG&quot;, &quot;_DEBUG&quot; ]),
+        includes         =&gt;
+            combine(sub { defined(env('WCECOMPAT'))
+                          ? '$(WCECOMPAT)/include' : (); },
+                    sub { defined(env('PORTSDK_LIBPATH'))
+                          ? '$(PORTSDK_LIBPATH)/../../include' : (); }),
         lflags           =&gt; add(combine(&quot;/nologo /opt:ref&quot;,
                                         sub { vc_wince_info()-&gt;{lflags}; },
                                         sub { defined(env('PORTSDK_LIBPATH'))
@@ -1424,10 +1477,11 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_asm&quot;),
                               sub { $disabled{shared} ? () : &quot;x86_uplink&quot; } ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN -DUNICODE -D_UNICODE -m32 -Wall&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
-                                    threads(&quot;-D_MT&quot;)),
+        cflags           =&gt; picker(default =&gt; &quot;-m32 -Wall&quot;,
+                                   debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
+        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN&quot;,
+                                    &quot;-DUNICODE -D_UNICODE&quot;, threads(&quot;-D_MT&quot;)),
         sys_id           =&gt; &quot;MINGW32&quot;,
         ex_libs          =&gt; add(&quot;-lws2_32 -lgdi32 -lcrypt32&quot;),
         bn_ops           =&gt; &quot;BN_LLONG EXPORT_VAR_AS_FN&quot;,
@@ -1435,7 +1489,7 @@ my %targets = (
         perlasm_scheme   =&gt; &quot;coff&quot;,
         dso_scheme       =&gt; &quot;win32&quot;,
         shared_target    =&gt; &quot;mingw-shared&quot;,
-        shared_cflag     =&gt; add(&quot;-D_WINDLL&quot;),
+        shared_cppflags  =&gt; add(&quot;_WINDLL&quot;),
         shared_ldflag    =&gt; &quot;-static-libgcc&quot;,
         shared_rcflag    =&gt; &quot;--target=pe-i386&quot;,
         shared_extension =&gt; &quot;.dll&quot;,
@@ -1453,10 +1507,11 @@ my %targets = (
         # Applink is never engaged and can as well be omitted.
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN -DUNICODE -D_UNICODE -m64 -Wall&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                    threads(&quot;-D_MT&quot;)),
+        cflags           =&gt; picker(default =&gt; &quot;-m64 -Wall&quot;,
+                                   debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cppflags         =&gt; combine(&quot;-DL_ENDIAN -DWIN32_LEAN_AND_MEAN&quot;,
+                                    &quot;-DUNICODE -D_UNICODE&quot;, threads(&quot;-D_MT&quot;)),
         sys_id           =&gt; &quot;MINGW64&quot;,
         ex_libs          =&gt; add(&quot;-lws2_32 -lgdi32 -lcrypt32&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT EXPORT_VAR_AS_FN&quot;,
@@ -1464,7 +1519,7 @@ my %targets = (
         perlasm_scheme   =&gt; &quot;mingw64&quot;,
         dso_scheme       =&gt; &quot;win32&quot;,
         shared_target    =&gt; &quot;mingw-shared&quot;,
-        shared_cflag     =&gt; add(&quot;-D_WINDLL&quot;),
+        shared_cppflags  =&gt; add(&quot;_WINDLL&quot;),
         shared_ldflag    =&gt; &quot;-static-libgcc&quot;,
         shared_rcflag    =&gt; &quot;--target=pe-x86-64&quot;,
         shared_extension =&gt; &quot;.dll&quot;,
@@ -1476,7 +1531,8 @@ my %targets = (
     &quot;UEFI&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-DL_ENDIAN -O&quot;,
+        cflags           =&gt; &quot;-O&quot;,
+        cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;UEFI&quot;,
     },
 
@@ -1484,7 +1540,8 @@ my %targets = (
     &quot;UWIN&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; &quot;-DTERMIOS -DL_ENDIAN -O -Wall&quot;,
+        cflags           =&gt; &quot;-O -Wall&quot;,
+        cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;UWIN&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         dso_scheme       =&gt; &quot;win32&quot;,
@@ -1494,31 +1551,33 @@ my %targets = (
     &quot;Cygwin-x86&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-DTERMIOS -DL_ENDIAN -Wall&quot;,
+        cflags           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3 -fomit-frame-pointer&quot;),
+        cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;CYGWIN&quot;,
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthread&quot;,
         perlasm_scheme   =&gt; &quot;coff&quot;,
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         shared_target    =&gt; &quot;cygwin-shared&quot;,
-        shared_cflag     =&gt; &quot;-D_WINDLL&quot;,
+        shared_cppflags  =&gt; &quot;-D_WINDLL&quot;,
         shared_extension =&gt; &quot;.dll&quot;,
     },
     &quot;Cygwin-x86_64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;x86_64_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; picker(default =&gt; &quot;-DTERMIOS -DL_ENDIAN -Wall&quot;,
+        cflags           =&gt; picker(default =&gt; &quot;-Wall&quot;,
                                    debug   =&gt; &quot;-g -O0&quot;,
                                    release =&gt; &quot;-O3&quot;),
+        cppflags         =&gt; &quot;-DTERMIOS -DL_ENDIAN&quot;,
         sys_id           =&gt; &quot;CYGWIN&quot;,
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthread&quot;,
         perlasm_scheme   =&gt; &quot;mingw64&quot;,
         dso_scheme       =&gt; &quot;dlfcn&quot;,
         shared_target    =&gt; &quot;cygwin-shared&quot;,
-        shared_cflag     =&gt; &quot;-D_WINDLL&quot;,
+        shared_cppflags  =&gt; &quot;-D_WINDLL&quot;,
         shared_extension =&gt; &quot;.dll&quot;,
     },
     # Backward compatibility for those using this target
@@ -1544,10 +1603,10 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         template         =&gt; 1,
         cc               =&gt; &quot;cc&quot;,
-        cflags           =&gt; combine(picker(default =&gt; &quot;&quot;,
-                                           debug   =&gt; &quot;-g -O0&quot;,
-                                           release =&gt; &quot;-O3&quot;),
-                                   threads(&quot;-D_REENTRANT&quot;)),
+        cflags           =&gt; picker(default =&gt; &quot;&quot;,
+                                   debug   =&gt; &quot;-g -O0&quot;,
+                                   release =&gt; &quot;-O3&quot;),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
         sys_id           =&gt; &quot;MACOSX&quot;,
         plib_lflags      =&gt; &quot;-Wl,-search_paths_first&quot;,
         bn_ops           =&gt; &quot;BN_LLONG RC4_CHAR&quot;,
@@ -1564,25 +1623,29 @@ my %targets = (
     # for PPC has no future, it was discontinued by vendor in 2009.
     &quot;darwin-ppc-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;ppc32_asm&quot;) ],
-        cflags           =&gt; add(&quot;-arch ppc -std=gnu9x -DB_ENDIAN -Wa,-force_cpusubtype_ALL&quot;),
+        cflags           =&gt; add(&quot;-arch ppc -std=gnu9x -Wa,-force_cpusubtype_ALL&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         perlasm_scheme   =&gt; &quot;osx32&quot;,
     },
     &quot;darwin64-ppc-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;ppc64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-arch ppc64 -std=gnu9x -DB_ENDIAN&quot;),
+        cflags           =&gt; add(&quot;-arch ppc64 -std=gnu9x&quot;),
+        cppflags         =&gt; add(&quot;-DB_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR&quot;,
         perlasm_scheme   =&gt; &quot;osx64&quot;,
     },
     &quot;darwin-i386-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;x86_asm&quot;) ],
-        cflags           =&gt; add(picker(default =&gt; &quot;-arch i386 -DL_ENDIAN&quot;,
+        cflags           =&gt; add(picker(default =&gt; &quot;-arch i386&quot;,
                                        release =&gt; &quot;-fomit-frame-pointer&quot;)),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;BN_LLONG RC4_INT&quot;,
         perlasm_scheme   =&gt; &quot;macosx&quot;,
     },
     &quot;darwin64-x86_64-cc&quot; =&gt; {
         inherit_from     =&gt; [ &quot;darwin-common&quot;, asm(&quot;x86_64_asm&quot;) ],
-        cflags           =&gt; add(&quot;-arch x86_64 -DL_ENDIAN -Wall&quot;),
+        cflags           =&gt; add(&quot;-arch x86_64 -Wall&quot;),
+        cppflags         =&gt; add(&quot;-DL_ENDIAN&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         perlasm_scheme   =&gt; &quot;macosx&quot;,
     },
@@ -1629,8 +1692,9 @@ my %targets = (
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         inherit_from     =&gt; [ asm(&quot;x86_elf_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; combine(&quot;-DL_ENDIAN -O3 -fomit-frame-pointer -Wall&quot;,
+        cflags           =&gt; combine(&quot;-O3 -fomit-frame-pointer -Wall&quot;,
                                     threads(&quot;-pthread&quot;)),
+        cppflags         =&gt; &quot;-DL_ENDIAN&quot;,
         ex_libs          =&gt; add(&quot;-ldl&quot;, threads(&quot;-pthread&quot;)),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1644,7 +1708,11 @@ my %targets = (
     &quot;vxworks-ppc60x&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-D_REENTRANT -mrtp -mhard-float -mstrict-align -fno-implicit-fp -DPPC32_fp60x -O2 -fstrength-reduce -fno-builtin -fno-strict-aliasing -Wall -DCPU=PPC32 -DTOOL_FAMILY=gnu -DTOOL=gnu -I\$(WIND_BASE)/target/usr/h -I\$(WIND_BASE)/target/usr/h/wrn/coreip&quot;,
+        cflags           =&gt; &quot;-mrtp -mhard-float -mstrict-align -fno-implicit-fp -O2 -fstrength-reduce -fno-builtin -fno-strict-aliasing -Wall&quot;,
+        cppflags         =&gt; combine(&quot;-D_REENTRANT -DPPC32_fp60x -DCPU=PPC32&quot;,
+                                    &quot;_DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/usr/h&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/usr/h/wrn/coreip&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-L \$(WIND_BASE)/target/usr/lib/ppc/PPC32/common&quot;),
         ex_libs          =&gt; add(&quot;-Wl,--defsym,__wrs_rtp_base=0xe0000000&quot;),
@@ -1652,7 +1720,11 @@ my %targets = (
     &quot;vxworks-ppcgen&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-D_REENTRANT -mrtp -msoft-float -mstrict-align -O1 -fno-builtin -fno-strict-aliasing -Wall -DCPU=PPC32 -DTOOL_FAMILY=gnu -DTOOL=gnu -I\$(WIND_BASE)/target/usr/h -I\$(WIND_BASE)/target/usr/h/wrn/coreip&quot;,
+        cflags           =&gt; &quot;-mrtp -msoft-float -mstrict-align -O1 -fno-builtin -fno-strict-aliasing -Wall&quot;,
+        cppflags         =&gt; combine(&quot;-D_REENTRANT -DPPC32 -DCPU=PPC32&quot;,
+                                    &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/usr/h&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/usr/h/wrn/coreip&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-L \$(WIND_BASE)/target/usr/lib/ppc/PPC32/sfcommon&quot;),
         ex_libs          =&gt; add(&quot;-Wl,--defsym,__wrs_rtp_base=0xe0000000&quot;),
@@ -1660,35 +1732,51 @@ my %targets = (
     &quot;vxworks-ppc405&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-g -msoft-float -mlongcall -DCPU=PPC405 -I\$(WIND_BASE)/target/h&quot;,
+        cflags           =&gt; &quot;-g -msoft-float -mlongcall&quot;,
+        cppflags         =&gt; combine(&quot;-D_REENTRANT -DPPC32 -DCPU=PPC405&quot;,
+                                    &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-r&quot;),
     },
     &quot;vxworks-ppc750&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-ansi -nostdinc -DPPC750 -D_REENTRANT -fvolatile -fno-builtin -fno-for-scope -fsigned-char -Wall -msoft-float -mlongcall -DCPU=PPC604 -I\$(WIND_BASE)/target/h \$(DEBUG_FLAG)&quot;,
+        cflags           =&gt; &quot;-ansi -nostdinc -fvolatile -fno-builtin -fno-for-scope -fsigned-char -Wall -msoft-float -mlongcall \$(DEBUG_FLAG)&quot;,
+        cppflags         =&gt; combine(&quot;-DPPC750 -D_REENTRANT -DCPU=PPC604&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-r&quot;),
     },
     &quot;vxworks-ppc750-debug&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-ansi -nostdinc -DPPC750 -D_REENTRANT -fvolatile -fno-builtin -fno-for-scope -fsigned-char -Wall -msoft-float -mlongcall -DCPU=PPC604 -I\$(WIND_BASE)/target/h -DPEDANTIC -DDEBUG -g&quot;,
+        cflags           =&gt; &quot;-ansi -nostdinc -fvolatile -fno-builtin -fno-for-scope -fsigned-char -Wall -msoft-float -mlongcall -g&quot;,
+        cppflags         =&gt; combine(&quot;-DPPC750 -D_REENTRANT -DCPU=PPC604&quot;,
+                                    &quot;-DPEDANTIC -DDEBUG&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-r&quot;),
     },
     &quot;vxworks-ppc860&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccppc&quot;,
-        cflags           =&gt; &quot;-nostdinc -msoft-float -DCPU=PPC860 -DNO_STRINGS_H -I\$(WIND_BASE)/target/h&quot;,
+        cflags           =&gt; &quot;-nostdinc -msoft-float&quot;,
+        cppflags         =&gt; combine(&quot;-DCPU=PPC860 -DNO_STRINGS_H&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-r&quot;),
     },
     &quot;vxworks-simlinux&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; &quot;ccpentium&quot;,
-        cflags           =&gt; &quot;-B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -D_VSB_CONFIG_FILE=\&quot;\$(WIND_BASE)/target/lib/h/config/vsbConfig.h\&quot; -DL_ENDIAN -DCPU=SIMLINUX -DTOOL_FAMILY=gnu -DTOOL=gnu -fno-builtin -fno-defer-pop -DNO_STRINGS_H -I\$(WIND_BASE)/target/h -I\$(WIND_BASE)/target/h/wrn/coreip -DOPENSSL_NO_HW_PADLOCK&quot;,
+        cflags           =&gt; &quot;-B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -fno-builtin -fno-defer-pop&quot;,
+        cppflags         =&gt; combine(&quot;-D_VSB_CONFIG_FILE=\&quot;\$(WIND_BASE)/target/lib/h/config/vsbConfig.h\&quot;&quot;,
+                                    &quot;-DL_ENDIAN -DCPU=SIMLINUX -DNO_STRINGS_H&quot;,
+                                    &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
+                                    &quot;-DOPENSSL_NO_HW_PADLOCK&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h/wrn/coreip&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-r&quot;),
         ranlib           =&gt; &quot;ranlibpentium&quot;,
@@ -1696,8 +1784,14 @@ my %targets = (
     &quot;vxworks-mips&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot;, asm(&quot;mips32_asm&quot;) ],
         cc               =&gt; &quot;ccmips&quot;,
-        cflags           =&gt; combine(&quot;-mrtp -mips2 -O -G 0 -B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -D_VSB_CONFIG_FILE=\&quot;\$(WIND_BASE)/target/lib/h/config/vsbConfig.h\&quot; -DCPU=MIPS32 -msoft-float -mno-branch-likely -DTOOL_FAMILY=gnu -DTOOL=gnu -fno-builtin -fno-defer-pop -DNO_STRINGS_H -I\$(WIND_BASE)/target/usr/h -I\$(WIND_BASE)/target/h/wrn/coreip&quot;,
-                                    threads(&quot;-D_REENTRANT&quot;)),
+        cflags           =&gt; &quot;-mrtp -mips2 -O -G 0 -B\$(WIND_BASE)/host/\$(WIND_HOST_TYPE)/lib/gcc-lib/ -msoft-float -mno-branch-likely -fno-builtin -fno-defer-pop&quot;,
+        cppflags         =&gt; combine(&quot;-D_VSB_CONFIG_FILE=\&quot;\$(WIND_BASE)/target/lib/h/config/vsbConfig.h\&quot;&quot;,
+                                    &quot;-DCPU=MIPS32 -DNO_STRINGS_H&quot;,
+                                    &quot;-DTOOL_FAMILY=gnu -DTOOL=gnu&quot;,
+                                    &quot;-DOPENSSL_NO_HW_PADLOCK&quot;,
+                                    threads(&quot;-D_REENTRANT&quot;),
+                                    &quot;-I\$(WIND_BASE)/target/h&quot;,
+                                    &quot;-I\$(WIND_BASE)/target/h/wrn/coreip&quot;),
         sys_id           =&gt; &quot;VXWORKS&quot;,
         lflags           =&gt; add(&quot;-L \$(WIND_BASE)/target/usr/lib/mips/MIPSI32/sfcommon&quot;),
         ex_libs          =&gt; add(&quot;-Wl,--defsym,__wrs_rtp_base=0xe0000000&quot;),
@@ -1710,7 +1804,7 @@ my %targets = (
     &quot;uClinux-dist&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; sub { env('CC') },
-        cflags           =&gt; combine(threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
         ex_libs          =&gt; add(&quot;\$(LDLIBS)&quot;),
         bn_ops           =&gt; &quot;BN_LLONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
@@ -1723,7 +1817,7 @@ my %targets = (
     &quot;uClinux-dist64&quot; =&gt; {
         inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
         cc               =&gt; sub { env('CC') },
-        cflags           =&gt; combine(threads(&quot;-D_REENTRANT&quot;)),
+        cppflags         =&gt; threads(&quot;-D_REENTRANT&quot;),
         ex_libs          =&gt; add(&quot;\$(LDLIBS)&quot;),
         bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG&quot;,
         thread_scheme    =&gt; &quot;pthreads&quot;,
diff --git a/Configurations/90-team.conf b/Configurations/90-team.conf
index 4d57f3f..3138218 100644
--- a/Configurations/90-team.conf
+++ b/Configurations/90-team.conf
@@ -3,18 +3,20 @@
 
 my %targets = (
     &quot;purify&quot; =&gt; {
+        inherit_from     =&gt; [ 'BASE_unix' ],
         cc               =&gt; &quot;purify gcc&quot;,
         cflags           =&gt; &quot;-g -Wall&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
         ex_libs          =&gt; add(&quot; &quot;,&quot;-lsocket -lnsl&quot;),
     },
     &quot;debug&quot; =&gt; {
+        inherit_from     =&gt; [ 'BASE_unix' ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; &quot;-DBN_DEBUG -DREF_DEBUG -DCONF_DEBUG -DBN_CTX_DEBUG -DOPENSSL_NO_ASM -ggdb -g2 -Wformat -Wshadow -Wmissing-prototypes -Wmissing-declarations -Werror&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;debug-erbridge&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;x86_64_asm&quot; ],
+        inherit_from     =&gt; [ 'BASE_unix', &quot;x86_64_asm&quot; ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; combine(&quot;$gcc_devteam_warn -DBN_DEBUG -DCONF_DEBUG -m64 -DL_ENDIAN -DTERMIO -g&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
@@ -30,7 +32,7 @@ my %targets = (
         multilib         =&gt; &quot;64&quot;,
     },
     &quot;debug-linux-pentium&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;x86_elf_asm&quot; ],
+        inherit_from     =&gt; [ 'BASE_unix', &quot;x86_elf_asm&quot; ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; combine(&quot;-DBN_DEBUG -DREF_DEBUG -DCONF_DEBUG -DBN_CTX_DEBUG -DL_ENDIAN -g -mcpu=pentium -Wall&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
@@ -40,7 +42,7 @@ my %targets = (
         dso_scheme       =&gt; &quot;dlfcn&quot;,
     },
     &quot;debug-linux-ppro&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;x86_elf_asm&quot; ],
+        inherit_from     =&gt; [ 'BASE_unix', &quot;x86_elf_asm&quot; ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; combine(&quot;-DBN_DEBUG -DREF_DEBUG -DCONF_DEBUG -DBN_CTX_DEBUG -DL_ENDIAN -g -mcpu=pentiumpro -Wall&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
@@ -50,6 +52,7 @@ my %targets = (
         dso_scheme       =&gt; &quot;dlfcn&quot;,
     },
     &quot;debug-linux-ia32-aes&quot; =&gt; {
+        inherit_from     =&gt; [ 'BASE_unix' ],
         cc               =&gt; &quot;gcc&quot;,
         cflags           =&gt; combine(&quot;-DL_ENDIAN -O3 -fomit-frame-pointer -Wall&quot;,
                                     threads(&quot;-D_REENTRANT&quot;)),
@@ -77,12 +80,13 @@ my %targets = (
         shared_extension =&gt; &quot;.so.\$(SHLIB_VERSION_NUMBER)&quot;,
     },
     &quot;dist&quot; =&gt; {
+        inherit_from     =&gt; [ 'BASE_unix' ],
         cc               =&gt; &quot;cc&quot;,
         cflags           =&gt; &quot;-O&quot;,
         thread_scheme    =&gt; &quot;(unknown)&quot;,
     },
     &quot;debug-test-64-clang&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;x86_64_asm&quot; ],
+        inherit_from     =&gt; [ 'BASE_unix', &quot;x86_64_asm&quot; ],
         cc               =&gt; &quot;clang&quot;,
         cflags           =&gt; combine(&quot;$gcc_devteam_warn -Wno-error=overlength-strings -Wno-error=extended-offsetof -Wno-error=language-extension-token -Wno-error=unused-const-variable -Wstrict-overflow -Qunused-arguments -DBN_DEBUG -DCONF_DEBUG -DDEBUG_SAFESTACK -DDEBUG_UNUSED -g3 -O3 -pipe&quot;,
                                     threads(&quot;${BSDthreads}&quot;)),
@@ -95,7 +99,7 @@ my %targets = (
         shared_extension =&gt; &quot;.so.\$(SHLIB_VERSION_NUMBER)&quot;,
     },
     &quot;darwin64-debug-test-64-clang&quot; =&gt; {
-        inherit_from     =&gt; [ &quot;x86_64_asm&quot; ],
+        inherit_from     =&gt; [ 'BASE_unix', &quot;x86_64_asm&quot; ],
         cc               =&gt; &quot;clang&quot;,
         cflags           =&gt; combine(&quot;-arch x86_64 -DL_ENDIAN $gcc_devteam_warn -Wno-error=overlength-strings -Wno-error=extended-offsetof -Wno-error=language-extension-token -Wno-error=unused-const-variable -Wstrict-overflow -Qunused-arguments -DBN_DEBUG -DCONF_DEBUG -DDEBUG_SAFESTACK -DDEBUG_UNUSED -g3 -O3 -pipe&quot;,
                                     threads(&quot;${BSDthreads}&quot;)),
diff --git a/Configurations/README b/Configurations/README
index 9d5dc5c..aa0c5fb 100644
--- a/Configurations/README
+++ b/Configurations/README
@@ -45,6 +45,19 @@ In each table entry, the following keys are significant:
                            Note: if the same feature is both enabled
                            and disabled, disable wins.
 
+        cpp             =&gt; The C preprocessor command, normally not
+                           given, as the build file defaults are
+                           usually good enough.
+        cppflags        =&gt; The C preprocessor flags.
+        defines         =&gt; As an alternative, macro definitions may be
+                           given here instead of in `cppflags'.  If
+                           given here, they MUST be as an array of the
+                           string such as &quot;MACRO=value&quot;, or just
+                           &quot;MACRO&quot; for definitions without value.
+        includes        =&gt; As an alternative, inclusion directories
+                           may be given here instead of in `cppflags'.
+                           If given here, the MUST be an array of
+                           strings, one directory specification each.
         cc              =&gt; The C compiler command, usually one of &quot;cc&quot;,
                            &quot;gcc&quot; or &quot;clang&quot;.  This command is normally
                            also used to link object files and
@@ -59,11 +72,6 @@ In each table entry, the following keys are significant:
         cxxflags        =&gt; Flags that are used at all times when
                            compiling C++ object files.  If unset, it
                            gets the same value as cflags.
-        defines         =&gt; As an alternative, macro definitions may be
-                           present here instead of in `cflags'.  If
-                           given here, they MUST be as an array of the
-                           string such as &quot;MACRO=value&quot;, or just
-                           &quot;MACRO&quot; for definitions without value.
         shared_cflag    =&gt; Extra compilation flags used when
                            compiling for shared libraries, typically
                            something like &quot;-fPIC&quot;.
diff --git a/Configurations/descrip.mms.tmpl b/Configurations/descrip.mms.tmpl
index 924dd9e..87c6834 100644
--- a/Configurations/descrip.mms.tmpl
+++ b/Configurations/descrip.mms.tmpl
@@ -171,12 +171,21 @@ OPENSSLDIR_C={- $osslprefix -}DATAROOT:[000000]
 # Where installed engines reside, for C
 ENGINESDIR_C={- $osslprefix -}ENGINES{- $sover_dirname.$target{pointer_size} -}:
 
-CC= {- $target{cc} -}
-CFLAGS= /DEFINE=({- join(&quot;,&quot;, @{$target{defines}}, @{$config{defines}},&quot;OPENSSLDIR=\&quot;\&quot;\&quot;\$(OPENSSLDIR_C)\&quot;\&quot;\&quot;&quot;,&quot;ENGINESDIR=\&quot;\&quot;\&quot;\$(ENGINESDIR_C)\&quot;\&quot;\&quot;&quot;) -}) {- $target{cflags} -} {- $config{cflags} -}
-CFLAGS_Q=$(CFLAGS)
-DEPFLAG= /DEFINE=({- join(&quot;,&quot;, @{$config{depdefines}}) -})
-LDFLAGS= {- $target{lflags} -}
-EX_LIBS= {- $target{ex_libs} ? &quot;,&quot;.$target{ex_libs} : &quot;&quot; -}{- $config{ex_libs} ? &quot;,&quot;.$config{ex_libs} : &quot;&quot; -}
+CC= {- $config{cc} -}
+DEFINES={- our $defines = join(&quot;,&quot;,
+                               '__dummy', # To make comma processing easier
+                               @{$config{defines}}) -}
+CPPFLAGS={- our $cppflags = join('', @{$config{cppflags}}) -}
+CPPFLAGS_Q={- $cppflags =~ s|&quot;|&quot;&quot;|g; $defines =~ s|&quot;|&quot;&quot;|g;
+              $cppflags.&quot;/DEFINE($defines)&quot; -}
+CFLAGS={- join('', @{$config{cflags}}) -}
+LDFLAGS= {- join('', @{$config{lflags}}) -}
+EX_LIBS= {- join('', map { ','.$_ } @{$config{ex_libs}}) -}
+LIB_DEFINES={- join(&quot;&quot;,
+                    (map { &quot;,$_&quot; }
+                     @{$target{shared_defines}},
+                     'OPENSSLDIR=&quot;&quot;&quot;$(OPENSSLDIR_C)&quot;&quot;&quot;',
+                     'ENGINESDIR=&quot;&quot;&quot;$(ENGINESDIR_C)&quot;&quot;&quot;')) -}
 LIB_CFLAGS={- $target{lib_cflags} // &quot;&quot; -}
 DSO_CFLAGS={- $target{dso_cflags} // &quot;&quot; -}
 BIN_CFLAGS={- $target{bin_cflags} // &quot;&quot; -}
@@ -191,8 +200,8 @@ PERL={- $config{perl} -}
 # dependent assembler flags. E.g. if you throw -mcpu=ultrasparc at SPARC
 # gcc, then the driver will automatically translate it to -xarch=v8plus
 # and pass it down to assembler.
-AS={- $target{as} -}
-ASFLAG={- $target{asflags} -}
+AS={- $config{as} -}
+ASFLAGS={- join('', @{$config{asflags}}) -}
 
 # .FIRST and .LAST are special targets with MMS and MMK.
 # The defines in there are for C.  includes that look like
@@ -605,16 +614,26 @@ EOF
       my $srcs =
           join(&quot;, &quot;,
                map { abs2rel(rel2abs($_), rel2abs($forward)) } @{$args{srcs}});
-      my $ecflags;
+      my $cflags = '$(CFLAGS)';
       if ($args{installed}) {
-          $ecflags = { lib =&gt; '$(LIB_CFLAGS)',
+          $cflags .= { lib =&gt; '$(LIB_CFLAGS)',
                        dso =&gt; '$(DSO_CFLAGS)',
                        bin =&gt; '$(BIN_CFLAGS)' } -&gt; {$args{intent}};
       } else {
-          $ecflags = { lib =&gt; '$(NO_INST_LIB_CFLAGS)',
+          $cflags .= { lib =&gt; '$(NO_INST_LIB_CFLAGS)',
                        dso =&gt; '$(NO_INST_DSO_CFLAGS)',
                        bin =&gt; '$(NO_INST_BIN_CFLAGS)' } -&gt; {$args{intent}};
       }
+      $cflags .= '$(CPPFLAGS)';
+      $cflags .= { lib =&gt; '$(LIB_CPPFLAGS)',
+		   dso =&gt; '$(DSO_CPPFLAGS)',
+		   bin =&gt; '$(BIN_CPPFLAGS)' } -&gt; {$args{intent}};
+      my $defines = '$(DEFINES)';
+      $defines .= { lib =&gt; '$(LIB_DEFINES)',
+		    dso =&gt; '$(DSO_DEFINES)',
+		    bin =&gt; '$(BIN_DEFINES)' } -&gt; {$args{intent}};
+      $cflags .= '/DEFINE=('.$defines.')';
+      
       my $incs_on = &quot;\@ !&quot;;
       my $incs_off = &quot;\@ !&quot;;
       my $incs = &quot;&quot;;
@@ -645,7 +664,7 @@ $obj.OBJ : $deps
         ${before}
         SET DEFAULT $forward
         $incs_on
-        \$(CC) \$(CFLAGS)${ecflags}${incs}${depbuild} /OBJECT=${objd}${objn}.OBJ /REPOSITORY=$backward $srcs
+        \$(CC) ${cflags}${incs}${depbuild} /OBJECT=${objd}${objn}.OBJ /REPOSITORY=$backward $srcs
         $incs_off
         SET DEFAULT $backward
         ${after}
diff --git a/Configurations/shared-info.pl b/Configurations/shared-info.pl
index c5ebfc6..d3e6941 100644
--- a/Configurations/shared-info.pl
+++ b/Configurations/shared-info.pl
@@ -13,12 +13,12 @@
 
 sub detect_gnu_ld {
     my @lines =
-        `$config{cross_compile_prefix}$target{cc} -Wl,-V /dev/null 2&gt;&amp;1`;
+        `$config{cross_compile_prefix}$config{cc} -Wl,-V /dev/null 2&gt;&amp;1`;
     return grep /^GNU ld/, @lines;
 }
 sub detect_gnu_cc {
     my @lines =
-        `$config{cross_compile_prefix}$target{cc} -v 2&gt;&amp;1`;
+        `$config{cross_compile_prefix}$config{cc} -v 2&gt;&amp;1`;
     return grep /gcc/, @lines;
 }
 
diff --git a/Configurations/unix-Makefile.tmpl b/Configurations/unix-Makefile.tmpl
index f5c1014..1eb5818 100644
--- a/Configurations/unix-Makefile.tmpl
+++ b/Configurations/unix-Makefile.tmpl
@@ -184,32 +184,42 @@ HTMLSUFFIX=html
 ECHO = echo
 
 CROSS_COMPILE= {- $config{cross_compile_prefix} -}
-CC= $(CROSS_COMPILE){- $target{cc} -}
-CFLAGS={- our $cflags2 = join(&quot; &quot;,(map { &quot;-D&quot;.$_} @{$target{defines}}, @{$config{defines}}),&quot;-DOPENSSLDIR=\&quot;\\\&quot;\$(OPENSSLDIR)\\\&quot;\&quot;&quot;,&quot;-DENGINESDIR=\&quot;\\\&quot;\$(ENGINESDIR)\\\&quot;\&quot;&quot;) -} {- $target{cflags} -} {- $config{cflags} -}
-CFLAGS_Q={- $cflags2 =~ s|([\\&quot;])|\\$1|g; $cflags2 -} {- $config{cflags} -}
-CXX= $(CROSS_COMPILE){- $target{cxx} -}
-CXXFLAGS={- our $cxxflags2 = join(&quot; &quot;,(map { &quot;-D&quot;.$_} @{$target{defines}}, @{$config{defines}}),&quot;-DOPENSSLDIR=\&quot;\\\&quot;\$(OPENSSLDIR)\\\&quot;\&quot;&quot;,&quot;-DENGINESDIR=\&quot;\\\&quot;\$(ENGINESDIR)\\\&quot;\&quot;&quot;) -} {- $target{cxxflags} -} {- $config{cxxflags} -} -std=c++11
-LDFLAGS= {- $config{lflags} -} {- $target{lflags} -}
-PLIB_LDFLAGS= {- $target{plib_lflags} -}
-EX_LIBS= {- $target{ex_libs} -} {- $config{ex_libs} -}
+CPPFLAGS={- our $cppflags = join(&quot; &quot;,
+                                 (map { &quot;-D&quot;.$_} @{$config{defines}}),
+                                 (map { &quot;-I&quot;.$_} @{$config{includes}}),
+                                 @{$config{cppflags}}) -}
+CPPFLAGS_Q={- $cppflags =~ s|([\\&quot;])|\\$1|g; $cppflags -}
+CC= $(CROSS_COMPILE){- $config{cc} -}
+CFLAGS={- join(' ', @{$config{cflags}}) -}
+CXX= $(CROSS_COMPILE){- $config{cxx} -}
+CXXFLAGS={- join(' ', @{$config{cxxflags}}) -} -std=c++11
+LDFLAGS= {- join(' ', @{$config{lflags}}) -}
+PLIB_LDFLAGS= {- join(' ', @{$config{plib_lflags}}) -}
+EX_LIBS= {- join(' ', @{$config{ex_libs}}) -}
+LIB_CPPFLAGS={- join(' ',
+                     (map { '-D'.$_ }
+                          ('OPENSSLDIR=&quot;\&quot;$(OPENSSLDIR)\&quot;&quot;',
+                           'ENGINESDIR=&quot;\&quot;$(ENGINESDIR)\&quot;&quot;')),
+                     $target{shared_cppflag}) || &quot;&quot; -}
 LIB_CFLAGS={- $target{shared_cflag} || &quot;&quot; -}
 LIB_CXXFLAGS={- $target{shared_cxxflag} || &quot;&quot; -}
 LIB_LDFLAGS={- $target{shared_ldflag}.&quot; &quot;.$config{shared_ldflag} -}
+DSO_CPPFLAGS={- $target{dso_cppflags} || &quot;&quot; -}
 DSO_CFLAGS={- $target{dso_cflags} || &quot;&quot; -}
 DSO_CXXFLAGS={- $target{dso_cxxflags} || &quot;&quot; -}
 DSO_LDFLAGS={- $target{dso_lflags} || &quot;&quot; -}
+BIN_CPPFLAGS={- $target{bin_cppflags} || &quot;&quot; -}
 BIN_CFLAGS={- $target{bin_cflags} || &quot;&quot; -}
 BIN_CXXFLAGS={- $target{bin_cxxflags} || &quot;&quot; -}
 BIN_LDFLAGS={- $target{bin_lflags} || &quot;&quot; -}
 
 PERL={- $config{perl} -}
 
-ARFLAGS= {- $target{arflags} -}
-AR=$(CROSS_COMPILE){- $target{ar} || &quot;ar&quot; -} $(ARFLAGS) r
-RANLIB= {- $target{ranlib} -}
-NM= $(CROSS_COMPILE){- $target{nm} || &quot;nm&quot; -}
-RCFLAGS={- $target{shared_rcflag} -}
+AR=$(CROSS_COMPILE){- $config{ar} -}
+ARFLAGS= {- join(' ', @{$config{arflags}}) -}
+RANLIB= {- $config{ranlib} -}
 RC= $(CROSS_COMPILE){- $target{rc} || &quot;windres&quot; -}
+RCFLAGS={- join(' ', @{$config{rcflags}}) -} {- $target{shared_rcflag} -}
 RM= rm -f
 RMDIR= rmdir
 TAR= {- $target{tar} || &quot;tar&quot; -}
@@ -225,8 +235,8 @@ TARFILE=        ../$(NAME).tar
 # dependent assembler flags. E.g. if you throw -mcpu=ultrasparc at SPARC
 # gcc, then the driver will automatically translate it to -xarch=v8plus
 # and pass it down to assembler.
-AS=$(CC) -c
-ASFLAG=$(CFLAGS)
+AS={- $config{as} || '$(CC) -c' -}
+ASFLAGS={- join(' ', @{$config{asflags}}) || '$(CFLAGS)' -}
 PERLASM_SCHEME= {- $target{perlasm_scheme} -}
 
 # For x86 assembler: Set PROCESSOR to 386 if you want to support
@@ -844,7 +854,7 @@ EOF
 $target: $args{generator}-&gt;[0] $deps
 	( trap &quot;rm -f \$@.*&quot; INT 0; \\
 	  $generator \$@.S; \\
-	  \$(CC) $incs \$(CFLAGS) -E \$@.S | \\
+	  \$(CC) $incs \$(CFLAGS) \$(CPPFLAGS) -E \$@.S | \\
 	  \$(PERL) -ne '/^#(line)?\\s*[0-9]+/ or print' &gt; \$@.i &amp;&amp; \\
 	  mv -f \$@.i \$@ )
 EOF
@@ -857,7 +867,7 @@ EOF
           }
           return &lt;&lt;&quot;EOF&quot;;
 $args{src}: $args{generator}-&gt;[0] $deps
-	\$(CC) $incs \$(CFLAGS) -E $args{generator}-&gt;[0] | \\
+	\$(CC) $incs \$(CFLAGS) \$(CPPFLAGS) -E $args{generator}-&gt;[0] | \\
 	\$(PERL) -ne '/^#(line)?\\s*[0-9]+/ or print' &gt; \$@
 EOF
       }
@@ -884,23 +894,34 @@ EOF
           }
       }
       my $cmd = '$(CC)';
-      my $cmdflags = '$(CFLAGS) -c';
+      my $cmdflags = '$(CFLAGS)';
+      my $cmdcompile = ' -c';
       my $makedepprog = $disabled{makedepend} ? undef : $config{makedepprog};
       if (grep /\.rc$/, @srcs) {
           $cmd = '$(RC)';
           $cmdflags = '$(RCFLAGS)';
+          $cmdcompile = '';
           $makedepprog = undef;
       } elsif (grep /\.(cc|cpp)$/, @srcs) {
           $cmd = '$(CXX)';
-          $cmdflags = '$(CXXFLAGS) -c';
+          $cmdflags = '$(CXXFLAGS)';
           $cmdflags .= ' ' . { lib =&gt; '$(LIB_CXXFLAGS)',
                                dso =&gt; '$(DSO_CXXFLAGS)',
                                bin =&gt; '$(BIN_CXXFLAGS)' } -&gt; {$args{intent}};
+          $cmdflags .= ' $(CPPFLAGS)';
+          $cmdflags .= ' ' . { lib =&gt; '$(LIB_CPPFLAGS)',
+                               dso =&gt; '$(DSO_CPPFLAGS)',
+                               bin =&gt; '$(BIN_CPPFLAGS)' } -&gt; {$args{intent}};
       } else {
           $cmdflags .= ' ' . { lib =&gt; '$(LIB_CFLAGS)',
                                dso =&gt; '$(DSO_CFLAGS)',
                                bin =&gt; '$(BIN_CFLAGS)' } -&gt; {$args{intent}};
+          $cmdflags .= ' $(CPPFLAGS)';
+          $cmdflags .= ' ' . { lib =&gt; '$(LIB_CPPFLAGS)',
+                               dso =&gt; '$(DSO_CPPFLAGS)',
+                               bin =&gt; '$(BIN_CPPFLAGS)' } -&gt; {$args{intent}};
       }
+      $cmdflags .= $cmdcompile;
       my $recipe = &lt;&lt;&quot;EOF&quot;;
 $obj$objext: $deps
 EOF
@@ -1033,7 +1054,7 @@ EOF
       my $objs = join(&quot; &quot;, @objs);
       return &lt;&lt;&quot;EOF&quot;;
 $lib$libext: $objs
-	\$(AR) \$\@ \$\?
+	\$(AR) \$(ARFLAGS) \$\@ \$\?
 	\$(RANLIB) \$\@ || echo Never mind.
 EOF
   }
diff --git a/Configurations/windows-makefile.tmpl b/Configurations/windows-makefile.tmpl
index aee8e88..082ce07 100644
--- a/Configurations/windows-makefile.tmpl
+++ b/Configurations/windows-makefile.tmpl
@@ -159,35 +159,47 @@ OPENSSLDIR=$(OPENSSLDIR_dev)$(OPENSSLDIR_dir)
 ENGINESDIR=$(ENGINESDIR_dev)$(ENGINESDIR_dir)
 !ENDIF
 
-CC={- $target{cc} -}
-CFLAGS={- join(&quot; &quot;,(map { &quot;-D&quot;.$_} @{$target{defines}}, @{$config{defines}})) -} {- join(&quot; &quot;, quotify_l(&quot;-DENGINESDIR=\&quot;$enginesdir\&quot;&quot;, &quot;-DOPENSSLDIR=\&quot;$openssldir\&quot;&quot;)) -} {- $target{cflags} -} {- $config{cflags} -}
+CC={- $config{cc} -}
+CPPFLAGS={- our $cppflags = join(&quot; &quot;,
+                                 (map { &quot;-D&quot;.$_} @{$config{defines}}),
+                                 (map { &quot; /I &quot;.$_} @{$config{includes}}),
+                                 @{$config{cppflags}}) -}
+CPPFLAGS_Q={- $cppflags =~ s|([\\&quot;])|\\$1|g; $cppflags -}
+CFLAGS={- join(' ', @{$config{cflags}}) -}
 COUTFLAG={- $target{coutflag} || &quot;/Fo&quot; -}$(OSSL_EMPTY)
-RC={- $target{rc} || &quot;rc&quot; -}
+RC={- $config{rc} -}
 RCOUTFLAG={- $target{rcoutflag} || &quot;/fo&quot; -}$(OSSL_EMPTY)
-LD={- $target{ld} || &quot;link&quot; -}
-LDFLAGS={- $target{lflags} -}
+LD={- $config{ld} -}
+LDFLAGS={- join(' ', @{$config{lflags}}) -}
 LDOUTFLAG={- $target{loutflag} || &quot;/out:&quot; -}$(OSSL_EMPTY)
-EX_LIBS={- $target{ex_libs} -}
-LIB_CFLAGS={- join(&quot; &quot;, $target{lib_cflags}, $target{shared_cflag}) || &quot;&quot; -}
-LIB_LDFLAGS={- $target{shared_ldflag} || &quot;&quot; -}
+EX_LIBS={- join(' ', @{$config{ex_libs}}) -}
+LIB_CPPFLAGS={- join(&quot; &quot;,
+                     $target{shared_cppflag} || &quot;&quot;,
+                     (map { quotiry_l(&quot;-D&quot;.$_) }
+                      'OPENSSLDIR=&quot;$(OPENSSLDIR)&quot;',
+                      'ENGINESDIR=&quot;$(ENGINESDIR)&quot;')) -}
+LIB_CFLAGS={- join(&quot; &quot;, $target{lib_cflags}, $target{shared_cflag}) -}
+LIB_LDFLAGS={- join(' ', $target{shared_ldflag}, $config{shared_ldflag}) -}
+DSO_CPPFLAGS={- $target{dso_cppflags} || &quot;&quot; -}
 DSO_CFLAGS={- $target{dso_cflags} || &quot;&quot; -}
 DSO_LDFLAGS={- $target{dso_ldflag} || &quot;&quot; -}
+BIN_CPPFLAGS={- $target{dso_cppflags} || &quot;&quot; -}
 BIN_CFLAGS={- $target{bin_cflags} -}
 BIN_LDFLAGS={- $target{bin_lflags} -}
 
 PERL={- $config{perl} -}
 
-AR={- $target{ar} -}
-ARFLAGS= {- $target{arflags} -}
+AR={- $config{ar} -}
+ARFLAGS= {- join(' ', @{$config{arflags}}) -}
 AROUTFLAG={- $target{aroutflag} || &quot;/out:&quot; -}$(OSSL_EMPTY)
 
-MT={- $target{mt} -}
-MTFLAGS= {- $target{mtflags} -}
+MT={- $config{mt} -}
+MTFLAGS= {- join(' ', @{$config{mtflags}}) -}
 MTINFLAG={- $target{mtinflag} || &quot;-manifest &quot; -}$(OSSL_EMPTY)
 MTOUTFLAG={- $target{mtoutflag} || &quot;-outputresource:&quot; -}$(OSSL_EMPTY)
 
-AS={- $target{as} -}
-ASFLAGS={- $target{asflags} -}
+AS={- $config{as} -}
+ASFLAGS={- join(' ', @{$config{asflags}}) -}
 ASOUTFLAG={- $target{asoutflag} -}$(OSSL_EMPTY)
 PERLASM_SCHEME= {- $target{perlasm_scheme} -}
 
@@ -302,10 +314,10 @@ install_dev:
 	@if &quot;$(INSTALLTOP)&quot;==&quot;&quot; ( echo INSTALLTOP should not be empty &amp; exit 1 )
 	@echo *** Installing development files
 	@&quot;$(PERL)&quot; &quot;$(SRCDIR)\util\mkdir-p.pl&quot; &quot;$(INSTALLTOP)\include\openssl&quot;
-	@rem {- output_off() unless grep { $_ eq &quot;OPENSSL_USE_APPLINK&quot; } @{$target{defines}}; &quot;&quot; -}
+	@rem {- output_off() unless grep { $_ eq &quot;OPENSSL_USE_APPLINK&quot; } @{$config{defines}}; &quot;&quot; -}
 	@&quot;$(PERL)&quot; &quot;$(SRCDIR)\util\copy.pl&quot; &quot;$(SRCDIR)\ms\applink.c&quot; \
 				       &quot;$(INSTALLTOP)\include\openssl&quot;
-	@rem {- output_on() unless grep { $_ eq &quot;OPENSSL_USE_APPLINK&quot; } @{$target{defines}}; &quot;&quot; -}
+	@rem {- output_on() unless grep { $_ eq &quot;OPENSSL_USE_APPLINK&quot; } @{$config{defines}}; &quot;&quot; -}
 	@&quot;$(PERL)&quot; &quot;$(SRCDIR)\util\copy.pl&quot; &quot;$(SRCDIR)\include\openssl\*.h&quot; \
 				       &quot;$(INSTALLTOP)\include\openssl&quot;
 	@&quot;$(PERL)&quot; &quot;$(SRCDIR)\util\copy.pl&quot; $(BLDDIR)\include\openssl\*.h \
@@ -427,7 +439,7 @@ EOF
 $target: &quot;$args{generator}-&gt;[0]&quot; $deps
 	set ASM=\$(AS)
 	$generator \$@.S
-	\$(CC) $incs \$(CFLAGS) /EP /C \$@.S &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
+	\$(CC) $incs \$(CFLAGS) \$(CPPFLAGS) /EP /C \$@.S &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
         del /Q \$@.S
 EOF
               }
@@ -440,7 +452,7 @@ EOF
           }
           return &lt;&lt;&quot;EOF&quot;;
 $target: &quot;$args{generator}-&gt;[0]&quot; $deps
-	\$(CC) $incs \$(CFLAGS) /EP /C &quot;$args{generator}-&gt;[0]&quot; &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
+	\$(CC) $incs \$(CFLAGS) \$(CPPFLAGS) /EP /C &quot;$args{generator}-&gt;[0]&quot; &gt; \$@.i &amp;&amp; move /Y \$@.i \$@
 EOF
       }
   }
@@ -457,9 +469,15 @@ EOF
              $incs .= ' /I &quot;'.$withargs{zlib_include}.'&quot;';
          }
      }
-     my $ecflags = { lib =&gt; '$(LIB_CFLAGS)',
-		     dso =&gt; '$(DSO_CFLAGS)',
-		     bin =&gt; '$(BIN_CFLAGS)' } -&gt; {$args{intent}};
+     my $cflags = '$(CFLAGS)';
+     $cflags .= { lib =&gt; ' $(LIB_CFLAGS)',
+		  dso =&gt; ' $(DSO_CFLAGS)',
+		  bin =&gt; ' $(BIN_CFLAGS)' } -&gt; {$args{intent}};
+     $cflags .= $incs;
+     $cflags .= ' $(CPPFLAGS)';
+     $cflags .= { lib =&gt; ' $(LIB_CPPFLAGS)',
+		  dso =&gt; ' $(DSO_CPPFLAGS)',
+		  bin =&gt; ' $(BIN_CPPFLAGS)' } -&gt; {$args{intent}};
      my $makedepprog = $config{makedepprog};
      if ($srcs[0] =~ /\.rc$/) {
          return &lt;&lt;&quot;EOF&quot;;
@@ -476,7 +494,7 @@ EOF
      }
      return &lt;&lt;&quot;EOF&quot;	if (!$disabled{makedepend});
 $obj$depext: $deps
-	\$(CC) \$(CFLAGS) $ecflags$inc /Zs /showIncludes $srcs 2&gt;&amp;1 | \\
+	\$(CC) $cflags /Zs /showIncludes $srcs 2&gt;&amp;1 | \\
 	    &quot;\$(PERL)&quot; -n &lt;&lt; &gt; $obj$depext
 chomp;
 s/^Note: including file: *//;
@@ -484,13 +502,13 @@ s/^Note: including file: *//;
 END { print '$obj$objext: ',join(&quot; &quot;, sort keys \%collect),&quot;\\n&quot; }
 &lt;&lt;
 $obj$objext: $obj$depext
-	\$(CC) $incs \$(CFLAGS) $ecflags -c \$(COUTFLAG)\$\@ @&lt;&lt;
+	\$(CC) $cflags -c \$(COUTFLAG)\$\@ @&lt;&lt;
 $srcs
 &lt;&lt;
 EOF
     return &lt;&lt;&quot;EOF&quot;	if ($disabled{makedepend});
 $obj$objext: $deps
-	\$(CC) $incs \$(CFLAGS) $ecflags -c \$(COUTFLAG)\$\@ $srcs
+	\$(CC) $cflags -c \$(COUTFLAG)\$\@ $srcs
 EOF
  }
 
diff --git a/Configure b/Configure
index ea00e8d..6c7f2b4 100755
--- a/Configure
+++ b/Configure
@@ -519,18 +519,72 @@ my $no_sse2=0;
 
 &amp;usage if ($#ARGV &lt; 0);
 
-my $user_cflags=&quot;&quot;;
-my @user_defines=();
+# For the &quot;make variables&quot; CINCLUDES and CDEFINES, we support lists with
+# platform specific list separators.  Users from those platforms should
+# recognise those separators from how you set up the PATH to find executables.
+# The default is the Unix like separator, :, but as an exception, we also
+# support the space as separator.
+my $list_separator_re =
+    { VMS           =&gt; qr/(?&lt;!\^),/,
+      MSWin32       =&gt; qr/(?&lt;!\\);/ } -&gt; {$^O} // qr/(?&lt;!\\)[:\s]/;
+# All the &quot;make variables&quot; we support
+my %user = (
+    AR          =&gt; undef,
+    ARFLAGS     =&gt; [],
+    AS          =&gt; undef,
+    ASFLAGS     =&gt; [],
+    CC          =&gt; undef,
+    CFLAGS      =&gt; [],
+    CXX         =&gt; undef,
+    CXXFLAGS    =&gt; [],
+    CPP         =&gt; undef,
+    CPPFLAGS    =&gt; [],  # -D, -I, -Wp,
+    CPPDEFINES  =&gt; [],  # Alternative for -D
+    CPPINCLUDES =&gt; [],  # Alternative for -I
+    HASHBANGPERL=&gt; undef,
+    LD          =&gt; undef,
+    LDFLAGS     =&gt; [],  # -L, -Wl,
+    LDLIBS      =&gt; [],  # -l
+    MT          =&gt; undef,
+    MTFLAGS     =&gt; [],
+    RANLIB      =&gt; undef,
+    RC          =&gt; undef,
+    RCFLAGS     =&gt; [],
+    RM          =&gt; undef,
+   );
+# The same but for flags given as Configure options.  These are *additional*
+# input, as opposed to the VAR=string option that override the corresponding
+# config target attributes
+my %useradd = (
+    CPPDEFINES  =&gt; [],
+    CPPINCLUDES =&gt; [],
+    CPPFLAGS    =&gt; [],
+    CFLAGS      =&gt; [],
+    CXXFLAGS    =&gt; [],
+    LDFLAGS     =&gt; [],
+    LDLIBS      =&gt; [],
+   );
+
+my %user_synonyms = (
+    HASHBANGPERL=&gt; 'PERL',
+    RC          =&gt; 'WINDRES',
+   );
+my %user_to_target = (
+    # If not given here, the value is the lc of the key
+    CPPDEFINES  =&gt; 'defines',
+    CPPINCLUDES =&gt; 'includes',
+    LDFLAGS     =&gt; 'lflags',
+    LDLIBS      =&gt; 'ex_libs',
+   );
+
 $config{openssl_api_defines}=[];
 $config{openssl_algorithm_defines}=[];
 $config{openssl_thread_defines}=[];
 $config{openssl_sys_defines}=[];
 $config{openssl_other_defines}=[];
-my $ldflags=&quot;&quot;;
-my $libs=&quot;&quot;;
-my $target=&quot;&quot;;
 $config{options}=&quot;&quot;;
 $config{build_type} = &quot;release&quot;;
+my $target=&quot;&quot;;
 
 my %unsupported_options = ();
 my %deprecated_options = ();
@@ -545,6 +599,16 @@ while (@argvcopy)
 	if (m|^(\w+)=(.+)?$|)
 		{
 		$config{perlenv}-&gt;{$1} = $2;
+		# Every time a variable is given as a configuration argument,
+		# it acts as a reset if the variable.
+		if (exists $user{$1})
+			{
+			$user{$1} = ref $user{$1} eq &quot;ARRAY&quot; ? [] : undef;
+			}
+		if (exists $useradd{$1})
+			{
+			$useradd{$1} = [];
+			}
 		next;
 		}
 
@@ -732,15 +796,15 @@ while (@argvcopy)
 			}
 		elsif (/^-L(.*)$/)
 			{
-			$ldflags.=$_.&quot; &quot;;
+			push @{$useradd{LDFLAGS}}, $_;
 			}
 		elsif (/^-l(.*)$/ or /^-Wl,/)
 			{
-			$libs.=$_.&quot; &quot;;
+			push @{$useradd{LDLIBS}}, $_;
 			}
 		elsif (/^-framework$/)
 			{
-			$libs.=$_.&quot; &quot;.shift(@argvcopy).&quot; &quot;;
+			push @{$useradd{LDLIBS}}, $_, shift(@argvcopy);
 			}
 		elsif (/^-rpath$/ or /^-R$/)
 			# -rpath is the OSF1 rpath flag
@@ -748,11 +812,11 @@ while (@argvcopy)
 			{
 			my $rpath = shift(@argvcopy) || &quot;&quot;;
 			$rpath .= &quot; &quot; if $rpath ne &quot;&quot;;
-			$libs.=$_.&quot; &quot;.$rpath;
+			push @{$useradd{LDFLAGS}}, $_, $rpath;
 			}
 		elsif (/^-static$/)
 			{
-			$libs.=$_.&quot; &quot;;
+			push @{$useradd{LDFLAGS}}, $_;
 			$disabled{&quot;dso&quot;} = &quot;forced&quot;;
 			$disabled{&quot;pic&quot;} = &quot;forced&quot;;
 			$disabled{&quot;shared&quot;} = &quot;forced&quot;;
@@ -760,12 +824,21 @@ while (@argvcopy)
 			}
 		elsif (/^-D(.*)$/)
 			{
-			push @user_defines, $1;
+			push @{$useradd{CPPDEFINES}}, $1;
+			}
+		elsif (/^-I(.*)$/)
+			{
+			push @{$useradd{CPPINCLUDES}}, $1;
+			}
+		elsif (/^-Wp,$/)
+			{
+			push @{$useradd{CPPFLAGS}}, $1;
 			}
 		else	# common if (/^[-+]/), just pass down...
 			{
 			$_ =~ s/%([0-9a-f]{1,2})/chr(hex($1))/gei;
-			$user_cflags.=&quot; &quot;.$_;
+			push @{$useradd{CFLAGS}}, $_;
+			push @{$useradd{CXXFLAGS}}, $_;
 			}
 		}
 	else
@@ -802,7 +875,20 @@ while (@argvcopy)
 		}
 	}
 
-if ($libs =~ /(^|\s)-Wl,-rpath,/
+foreach (keys %user) {
+    my $value = env($_);
+    $value //= defined $user_synonyms{$_} ? env($user_synonyms{$_}) : undef;
+
+    if (defined $value) {
+        if (ref $user{$_} eq 'ARRAY') {
+            $user{$_} = [ split /$list_separator_re/, $value ];
+        } elsif (!defined $user{$_}) {
+            $user{$_} = $value;
+        }
+    }
+}
+
+if (grep { $_ =~ /(^|\s)-Wl,-rpath,/ } ($user{LDLIBS} ? @{$user{LDLIBS}} : ())
     &amp;&amp; !$disabled{shared}
     &amp;&amp; !($disabled{asan} &amp;&amp; $disabled{msan} &amp;&amp; $disabled{ubsan})) {
     die &quot;***** Cannot simultaneously use -rpath, shared libraries, and\n&quot;,
@@ -1002,7 +1088,10 @@ foreach (sort (keys %disabled))
 			push @{$config{openssl_other_defines}}, &quot;OPENSSL_NO_$WHAT&quot;;
 			print &quot; OPENSSL_NO_$WHAT&quot;;
 
-			if (/^err$/)	{ push @user_defines, &quot;OPENSSL_NO_ERR&quot;; }
+			if (/^err$/)
+				{
+				push @{$useradd{CPPDEFINES}}, &quot;OPENSSL_NO_ERR&quot;;
+				}
 			}
 		}
 
@@ -1029,35 +1118,49 @@ $config{cross_compile_prefix} = env('CROSS_COMPILE')
 # Note: only Unix cares about HASHBANGPERL...  that explains
 # the default string.
 $config{perl} =    ($^O ne &quot;VMS&quot; ? $^X : &quot;perl&quot;);
-$config{hashbangperl} =
-    env('HASHBANGPERL')           || env('PERL')      || &quot;/usr/bin/env perl&quot;;
-$target{cc} =      env('CC')      || $target{cc}      || &quot;cc&quot;;
-$target{cxx} =     env('CXX')     || $target{cxx}     || &quot;c++&quot;;
-$target{ranlib} =  env('RANLIB')  || $target{ranlib}  ||
-                   (which(&quot;$config{cross_compile_prefix}ranlib&quot;) ?
-                          &quot;\$(CROSS_COMPILE)ranlib&quot; : &quot;true&quot;);
-$target{ar} =      env('AR')      || $target{ar}      || &quot;ar&quot;;
-$target{nm} =      env('NM')      || $target{nm}      || &quot;nm&quot;;
-$target{rc} =
-    env('RC')  || env('WINDRES')  || $target{rc}      || &quot;windres&quot;;
+foreach (keys %user) {
+    my $target_key = $user_to_target{$_} // lc $_;
+    my $ref_type = ref $user{$_};
+
+    # Temporary function.  Takes an intended ref type (empty string or &quot;ARRAY&quot;)
+    # and a value that's to be coerced into that type.
+    my $mkvalue = sub {
+        my $type = shift;
+        my $value = shift;
+        my $undef_p = shift;
+
+        die &quot;Too many arguments for \$mkvalue&quot; if @_;
+
+        while (ref $value eq 'CODE') {
+            $value = $value-&gt;();
+        }
+
+        if ($type eq 'ARRAY') {
+            return undef unless defined $value;
+            return undef if ref $value ne 'ARRAY' &amp;&amp; !$value;
+            return undef if ref $value eq 'ARRAY' &amp;&amp; !@$value;
+            return [ $value ] unless ref $value eq 'ARRAY';
+        }
+        return undef unless $value;
+        return $value;
+    };
+
+    $config{$target_key} =
+        $mkvalue-&gt;($ref_type, $user{$_})
+        || $mkvalue-&gt;($ref_type, $target{$target_key});
+    if (defined $useradd{$_} &amp;&amp; @{$useradd{$_}}) {
+        if (defined $config{$target_key}) {
+            push @{$config{$target_key}}, @{$useradd{$_}};
+        } else {
+            $config{$target_key} = [ @{$useradd{$_}} ];
+        }
+    }
+    delete $config{$target_key} unless defined $config{$target_key};
+}
+$config{plib_lflags} = [ $target{plib_lflags} ];
 
 # Allow overriding the build file name
-$target{build_file} = env('BUILDFILE') || $target{build_file} || &quot;Makefile&quot;;
-
-# Cache information necessary for reconfiguration
-$config{cc} = $target{cc};
-$config{cxx} = $target{cxx};
-$config{build_file} = $target{build_file};
-
-# For cflags, lflags, plib_lflags, ex_libs and defines, add the debug_
-# or release_ attributes.
-# Do it in such a way that no spurious space is appended (hence the grep).
-$config{defines} = [];
-$config{cflags} = &quot;&quot;;
-$config{cxxflags} = &quot;&quot;;
-$config{lflags} = &quot;&quot;;
-$config{ex_libs} = &quot;&quot;;
-$config{shared_ldflag} = &quot;&quot;;
+$config{build_file} = env('BUILDFILE') || $target{build_file} || &quot;Makefile&quot;;
 
 # Make sure build_scheme is consistent.
 $target{build_scheme} = [ $target{build_scheme} ]
@@ -1087,22 +1190,19 @@ foreach my $checker (($builder_platform.&quot;-&quot;.$target{build_file}.&quot;-checker.pm&quot;,
 
 push @{$config{defines}}, &quot;NDEBUG&quot;    if $config{build_type} eq &quot;release&quot;;
 
-if ($target =~ /^mingw/ &amp;&amp; `$target{cc} --target-help 2&gt;&amp;1` =~ m/-mno-cygwin/m)
+if ($target =~ /^mingw/ &amp;&amp; `$config{cc} --target-help 2&gt;&amp;1` =~ m/-mno-cygwin/m)
 	{
-	$config{cflags} .= &quot; -mno-cygwin&quot;;
-	$config{shared_ldflag} .= &quot; -mno-cygwin&quot;;
+	push @{$config{cflags}}, &quot;-mno-cygwin&quot;;
+	push @{$config{shared_ldflag}}, &quot;-mno-cygwin&quot;;
 	}
 
-if ($target =~ /linux.*-mips/ &amp;&amp; !$disabled{asm} &amp;&amp; $user_cflags !~ /-m(ips|arch=)/) {
+if ($target =~ /linux.*-mips/ &amp;&amp; !$disabled{asm}
+        &amp;&amp; !grep { $_ !~ /-m(ips|arch=)/ } @{$user{CFLAGS}}) {
 	# minimally required architecture flags for assembly modules
-	$config{cflags}=&quot;-mips2 $config{cflags}&quot; if ($target =~ /mips32/);
-	$config{cflags}=&quot;-mips3 $config{cflags}&quot; if ($target =~ /mips64/);
+	unshift @{$config{cflags}}, '-mips2' if ($target =~ /mips32/);
+	unshift @{$config{cflags}}, '-mips3' if ($target =~ /mips64/);
 }
 
-my $no_shared_warn=0;
-my $no_user_cflags=0;
-my $no_user_defines=0;
-
 # The DSO code currently always implements all functions so that no
 # applications will have to worry about that from a compilation point
 # of view. However, the &quot;method&quot;s may return zero unless that platform
@@ -1126,9 +1226,6 @@ if (!$disabled{dso} &amp;&amp; $target{dso_scheme} ne &quot;&quot;)
 		}
 	}
 
-$config{ex_libs}=&quot;$libs$config{ex_libs}&quot; if ($libs ne &quot;&quot;);
-$config{lflags}=&quot;$config{lflags}$ldflags&quot; if ($ldflags ne &quot;&quot;);
-
 # If threads aren't disabled, check how possible they are
 unless ($disabled{threads}) {
     if ($auto_threads) {
@@ -1145,7 +1242,7 @@ unless ($disabled{threads}) {
             # system-dependent compiler options that are necessary.  We
             # can't truly check that the given options are correct, but
             # we expect the user to know what [s]He is doing.
-            if ($no_user_cflags &amp;&amp; $no_user_defines) {
+            if (!@{$user{CFLAGS}} &amp;&amp; !@{$user{CPPDEFINES}}) {
                 die &quot;You asked for multi-threading support, but didn't\n&quot;
                     ,&quot;provide any system-specific compiler options\n&quot;;
             }
@@ -1156,9 +1253,7 @@ unless ($disabled{threads}) {
 # If threads still aren't disabled, add a C macro to ensure the source
 # code knows about it.  Any other flag is taken care of by the configs.
 unless($disabled{threads}) {
-    foreach ((&quot;defines&quot;, &quot;openssl_thread_defines&quot;)) {
-        push @{$config{$_}}, &quot;OPENSSL_THREADS&quot;;
-    }
+    push @{$config{openssl_thread_defines}}, &quot;OPENSSL_THREADS&quot;;
 }
 
 # With &quot;deprecated&quot; disable all deprecated features.
@@ -1166,6 +1261,7 @@ if (defined($disabled{&quot;deprecated&quot;})) {
         $config{api} = $maxapi;
 }
 
+my $no_shared_warn=0;
 if ($target{shared_target} eq &quot;&quot;)
 	{
 	$no_shared_warn = 1
@@ -1184,22 +1280,22 @@ if ($disabled{&quot;dynamic-engine&quot;}) {
 }
 
 unless ($disabled{asan}) {
-    $config{cflags} .= &quot;-fsanitize=address &quot;;
+    push @{$config{cflags}}, &quot;-fsanitize=address&quot;;
 }
 
 unless ($disabled{ubsan}) {
     # -DPEDANTIC or -fnosanitize=alignment may also be required on some
     # platforms.
-    $config{cflags} .= &quot;-fsanitize=undefined -fno-sanitize-recover=all &quot;;
+    push @{$config{cflags}}, &quot;-fsanitize=undefined&quot;, &quot;-fno-sanitize-recover=all&quot;;
 }
 
 unless ($disabled{msan}) {
-  $config{cflags} .= &quot;-fsanitize=memory &quot;;
+  push @{$config{cflags}}, &quot;-fsanitize=memory&quot;;
 }
 
 unless ($disabled{&quot;fuzz-libfuzzer&quot;} &amp;&amp; $disabled{&quot;fuzz-afl&quot;}
         &amp;&amp; $disabled{asan} &amp;&amp; $disabled{ubsan} &amp;&amp; $disabled{msan}) {
-    $config{cflags} .= &quot;-fno-omit-frame-pointer -g &quot;;
+    push @{$config{cflags}}, &quot;-fno-omit-frame-pointer&quot;, &quot;-g&quot;;
 }
 #
 # Platform fix-ups
@@ -1208,9 +1304,12 @@ unless ($disabled{&quot;fuzz-libfuzzer&quot;} &amp;&amp; $disabled{&quot;fuzz-afl&quot;}
 # This saves the build files from having to check
 if ($disabled{pic})
 	{
-	foreach (qw(shared_cflag shared_cxxflag shared_ldflag
-		    dso_cflags dso_cxxflags dso_lflags))
+	foreach (qw(shared_cflag shared_cxxflag shared_cppflag
+                    shared_defines shared_includes shared_ldflag
+		    dso_cflags dso_cxxflags dso_cppflags
+                    dso_defines dso_includes dso_lflags))
 		{
+		delete $config{$_};
 		$target{$_} = &quot;&quot;;
 		}
 	}
@@ -1283,7 +1382,7 @@ unless ($disabled{asm}) {
     }
 }
 
-my %predefined = compiler_predefined($target{cc});
+my %predefined = compiler_predefined($config{cc});
 
 # Check for makedepend capabilities.
 if (!$disabled{makedepend}) {
@@ -1294,7 +1393,7 @@ if (!$disabled{makedepend}) {
     } elsif ($predefined{__GNUC__} &gt;= 3) {
         # We know that GNU C version 3 and up as well as all clang
         # versions support dependency generation
-        $config{makedepprog} = &quot;\$(CROSS_COMPILE)$target{cc}&quot;;
+        $config{makedepprog} = &quot;\$(CROSS_COMPILE)$config{cc}&quot;;
     } else {
         # In all other cases, we look for 'makedepend', and disable the
         # capability if not found.
@@ -1333,7 +1432,8 @@ die &quot;Exactly one of SIXTY_FOUR_BIT|SIXTY_FOUR_BIT_LONG|THIRTY_TWO_BIT can be set
 
 # &quot;Stringify&quot; the C flags string.  This permits it to be made part of a string
 # and works as well on command lines.
-$config{cflags} =~ s/([\\\&quot;])/\\$1/g;
+$config{cflags} = [ map { (my $x = $_) =~ s/([\\\&quot;])/\\$1/g; $x }
+                        @{$config{cflags}} ];
 
 if (defined($config{api})) {
     $config{openssl_api_defines} = [ &quot;OPENSSL_MIN_API=&quot;.$apitable-&gt;{$config{api}} ];
@@ -1342,7 +1442,7 @@ if (defined($config{api})) {
 }
 
 if (defined($predefined{__clang__}) &amp;&amp; !$disabled{asm}) {
-    $config{cflags} .= &quot; -Qunused-arguments&quot;;
+    push @{$config{cflags}}, &quot;-Qunused-arguments&quot;;
 }
 
 if ($strict_warnings)
@@ -1355,13 +1455,15 @@ if ($strict_warnings)
 	$gcc_devteam_warn .= &quot; -Wmisleading-indentation&quot; if $gccver &gt;= 6;
 	foreach $wopt (split /\s+/, $gcc_devteam_warn)
 		{
-		$config{cflags} .= &quot; $wopt&quot; unless ($config{cflags} =~ /(?:^|\s)$wopt(?:\s|$)/)
+		push @{$config{cflags}}, $wopt
+			unless grep { $_ eq $wopt } @{$config{cflags}};
 		}
 	if (defined($predefined{__clang__}))
 		{
 		foreach $wopt (split /\s+/, $clang_devteam_warn)
 			{
-			$config{cflags} .= &quot; $wopt&quot; unless ($config{cflags} =~ /(?:^|\s)$wopt(?:\s|$)/)
+			push @{$config{cflags}}, $wopt
+				unless grep { $_ eq $wopt } @{$config{cflags}};
 			}
 		}
 	}
@@ -1370,21 +1472,15 @@ unless ($disabled{&quot;crypto-mdebug-backtrace&quot;})
 	{
 	foreach my $wopt (split /\s+/, $memleak_devteam_backtrace)
 		{
-		$config{cflags} .= &quot; $wopt&quot; unless ($config{cflags} =~ /(?:^|\s)$wopt(?:\s|$)/)
+		push @{$config{cflags}}, $wopt
+			unless grep { $_ eq $wopt } @{$config{cflags}};
 		}
 	if ($target =~ /^BSD-/)
 		{
-		$config{ex_libs} .= &quot; -lexecinfo&quot;;
+		push @{$config{ex_libs}}, &quot;-lexecinfo&quot;;
 		}
 	}
 
-if ($user_cflags ne &quot;&quot;) { $config{cflags}=&quot;$config{cflags}$user_cflags&quot;; $config{cxxflags}=&quot;$config{cxxflags}$user_cflags&quot;;}
-else                    { $no_user_cflags=1;  }
-if (@user_defines) { $config{defines}=[ @{$config{defines}}, @user_defines ]; }
-else               { $no_user_defines=1;    }
-
-# ALL MODIFICATIONS TO %config and %target MUST BE DONE FROM HERE ON
-
 unless ($disabled{afalgeng}) {
     $config{afalgeng}=&quot;&quot;;
     if ($target =~ m/^linux/) {
@@ -1409,6 +1505,8 @@ unless ($disabled{afalgeng}) {
 
 push @{$config{openssl_other_defines}}, &quot;OPENSSL_NO_AFALGENG&quot; if ($disabled{afalgeng});
 
+# ALL MODIFICATIONS TO %config and %target MUST BE DONE FROM HERE ON
+
 # If we use the unified build, collect information from build.info files
 my %unified_info = ();
 
@@ -2208,18 +2306,25 @@ print &quot;PROCESSOR     =$config{processor}\n&quot; if $config{processor};
 print &quot;PERL          =$config{perl}\n&quot;;
 print &quot;PERLVERSION   =$Config{version} for $Config{archname}\n&quot;;
 print &quot;HASHBANGPERL  =$config{hashbangperl}\n&quot;;
-print &quot;CC            =$config{cross_compile_prefix}$target{cc}\n&quot;;
-print &quot;CFLAG         =$target{cflags} $config{cflags}\n&quot;;
-print &quot;CXX           =$config{cross_compile_prefix}$target{cxx}\n&quot;
-    if defined $target{cxx};
-print &quot;CXXFLAG       =$target{cxxflags} $config{cxxflags}\n&quot;
-    if defined $target{cxx};
-print &quot;DEFINES       =&quot;,join(&quot; &quot;, @{$target{defines}}, @{$config{defines}}),&quot;\n&quot;;
-#print &quot;RANLIB        =&quot;, $target{ranlib} eq '$(CROSS_COMPILE)ranlib' ?
-#                             &quot;$config{cross_compile_prefix}ranlib&quot; :
-#                             &quot;$target{ranlib}&quot;, &quot;\n&quot;;
-print &quot;LDFLAGS       =$config{lflags} $target{lflags}\n&quot;;
-print &quot;EX_LIBS       =$target{ex_libs} $config{ex_libs}\n&quot;;
+print &quot;DEFINES       =&quot;,join(&quot; &quot;, @{$config{defines}}),&quot;\n&quot;
+    if defined $config{defines};
+print &quot;INCLUDES      =&quot;,join(&quot; &quot;, @{$config{includes}}),&quot;\n&quot;
+    if defined $config{includes};
+print &quot;CPPFLAGS      =&quot;,join(&quot; &quot;, @{$config{cppflags}}),&quot;\n&quot;
+    if defined $config{cppflags};
+print &quot;CC            =$config{cross_compile_prefix}$config{cc}\n&quot;;
+print &quot;CFLAGS        =&quot;,join(&quot; &quot;, @{$config{cflags}}),&quot;\n&quot;
+    if defined $config{cflags};
+print &quot;CXX           =$config{cross_compile_prefix}$config{cxx}\n&quot;
+    if defined $config{cxx};
+print &quot;CXXFLAGS      =&quot;,join(&quot; &quot;, @{$config{cxxflags}}),&quot;\n&quot;
+    if defined $config{cxxflags};
+print &quot;LD            =$config{cross_compile_prefix}$config{ld}\n&quot;
+    if defined $config{ld};
+print &quot;LDFLAGS       =&quot;,join(&quot; &quot;, @{$config{lflags}}),&quot;\n&quot;
+    if defined $config{lflags};
+print &quot;EX_LIBS       =&quot;,join(&quot; &quot;, @{$config{ex_libs}}),&quot;\n&quot;
+    if defined $config{ex_libs};
 
 my %builders = (
     unified =&gt; sub {
@@ -2689,9 +2794,12 @@ sub print_table_entry
 
     my @sequence = (
 	&quot;sys_id&quot;,
+	&quot;cpp&quot;,
+	&quot;cppflags&quot;,
+	&quot;defines&quot;,
+	&quot;includes&quot;,
 	&quot;cc&quot;,
 	&quot;cflags&quot;,
-	&quot;defines&quot;,
 	&quot;unistd&quot;,
 	&quot;ld&quot;,
 	&quot;lflags&quot;,
diff --git a/INSTALL b/INSTALL
index 5583817..3130fbe 100644
--- a/INSTALL
+++ b/INSTALL
@@ -516,7 +516,7 @@
                    whirlpool.  The &quot;ripemd&quot; algorithm is deprecated and if used
                    is synonymous with rmd160.
 
-  -Dxxx, lxxx, -Lxxx, -Wl, -rpath, -R, -framework, -static
+  -Dxxx, -Ixxx, -Wp, -lxxx, -Lxxx, -Wl, -rpath, -R, -framework, -static
                    These system specific options will be recognised and
                    passed through to the compiler to allow you to define
                    preprocessor symbols, specify additional libraries, library
@@ -527,11 +527,17 @@
                    unsuitable for execution on other, typically older,
                    processor. Consult your compiler documentation.
 
+                   Take note of the VAR=value documentation below and how
+                   these flags interact with those variables.
+
   -xxx, +xxx
                    Additional options that are not otherwise recognised are
                    passed through as they are to the compiler as well.  Again,
                    consult your compiler documentation.
 
+                   Take note of the VAR=value documentation below and how
+                   these flags interact with those variables.
+
   VAR=value
                    Assignment if environment variable for Configure.  These
                    work just like normal environment variable assignments,
@@ -540,6 +546,68 @@
                    the corresponding value in the inherited environment, if
                    there is one.
 
+                   The following variables are used as &quot;make variables&quot; and
+                   can be used as an alternative to giving preprocessor,
+                   compiler and linker options directly as configuration.
+                   The following variables are supported:
+
+                   AR              The static library archiver.
+                   ARFLAGS         Flags for the static library archiver.
+                   AS              The assembler compiler.
+                   ASFLAGS         Flags for the assembler compiler.
+                   CC              The C compiler.
+                   CFLAGS          Flags for the C compiler.
+                   CXX             The C++ compiler.
+                   CXXFLAGS        Flags for the C++ compiler.
+                   CPP             The C/C++ preprocessor.
+                   CPPFLAGS        Flags for the C/C++ preprocessor.
+                   CPPDEFINES      List of CPP macro definitions, separated
+                                   by a platform specific character (':' or
+                                   space for Unix, ';' for Windows, ',' for
+                                   VMS).  This can be used in place of -D.
+                   CPPINCLUDES     List of CPP inclusion directories, separated
+                                   the same way as for CPPDEFINES.  This can
+                                   be used in place of -I.
+                   HASHBANGPERL    Perl invocation to be inserted after '#!'
+                                   in public perl scripts.
+                   LD              The program linker (not used on Unix, $(CC)
+                                   is used there).
+                   LDFLAGS         Flags for the shared library, DSO and
+                                   program linker.
+                   LDLIBS          Extra libraries to use when linking.
+                                   Takes the form of a space separated list
+                                   of library specifications on Unix and
+                                   Windows, and as a comma separated list of
+                                   libraries on VMS.
+                   RANLIB          The library archive indexer.
+                   RC              The Windows resources manipulator.
+                   RCFLAGS         Flags for the Windows reources manipulator.
+                   RM              The command to remove files and directories.
+
+                   These can be mixed with flags given on the command line.
+                   Any variable assignment resets any corresponding flags
+                   given before it, so for example:
+
+                       ./config -DFOO CPPFLAGS=-DBAR -DCOOKIE
+
+                   Will end up having 'CPPFLAGS=-DBAR -DCOOKIE'.
+
+                   Here is how the flags documented above are collected as
+                   augmentation of these variables:
+
+                   -Dxxx           xxx is collected in CPPDEFINES
+                   -Ixxx           xxx is collected in CPPINCLUDES
+                   -Wp,xxx         collected in CPPFLAGS
+                   -Lxxx           collected in LDFLAGS
+                   -lxxx           collected in LDLIBS
+                   -Wp,xxx         collected in LDLIBS
+                   -rpath xxx      collected in LDLIBS
+                   -R xxx          collected in LDLIBS
+                   -framework xxx  collected in LDLIBS
+                   -static         collected in LDLIBS
+                   -xxx            collected in CFLAGS
+                   +xxx            collected in CFLAGS
+
   reconf
   reconfigure
                    Reconfigure from earlier data.  This fetches the previous
diff --git a/NEWS b/NEWS
index 73a5a25..038a673 100644
--- a/NEWS
+++ b/NEWS
@@ -7,7 +7,7 @@
 
   Major changes between OpenSSL 1.1.0f and OpenSSL 1.1.1 [under development]
 
-      o 
+      o Allow GNU style &quot;make variables&quot; to be used with Configure.
       o Add a STORE module (OSSL_STORE)
       o Claim the namespaces OSSL and OPENSSL, represented as symbol prefixes
 
diff --git a/crypto/aes/build.info b/crypto/aes/build.info
index 84c6220..102e863 100644
--- a/crypto/aes/build.info
+++ b/crypto/aes/build.info
@@ -5,11 +5,17 @@ SOURCE[../../libcrypto]=\
 
 GENERATE[aes-ia64.s]=asm/aes-ia64.S
 
-GENERATE[aes-586.s]=asm/aes-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[aes-586.s]=asm/aes-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[aes-586.s]=../perlasm/x86asm.pl
-GENERATE[vpaes-x86.s]=asm/vpaes-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[vpaes-x86.s]=asm/vpaes-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[vpaes-586.s]=../perlasm/x86asm.pl
-GENERATE[aesni-x86.s]=asm/aesni-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[aesni-x86.s]=asm/aesni-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[aesni-586.s]=../perlasm/x86asm.pl
 
 GENERATE[aes-x86_64.s]=asm/aes-x86_64.pl $(PERLASM_SCHEME)
diff --git a/crypto/bf/build.info b/crypto/bf/build.info
index 37a004e..b1e9e8a 100644
--- a/crypto/bf/build.info
+++ b/crypto/bf/build.info
@@ -2,5 +2,7 @@ LIBS=../../libcrypto
 SOURCE[../../libcrypto]=bf_skey.c bf_ecb.c bf_cfb64.c bf_ofb64.c \
         {- $target{bf_asm_src} -}
 
-GENERATE[bf-586.s]=asm/bf-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[bf-586.s]=asm/bf-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[bf-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/bn/build.info b/crypto/bn/build.info
index dbb4196..950464d 100644
--- a/crypto/bn/build.info
+++ b/crypto/bn/build.info
@@ -11,16 +11,20 @@ INCLUDE[../../libcrypto]=../../crypto/include
 INCLUDE[bn_exp.o]=..
 
 GENERATE[bn-586.s]=asm/bn-586.pl \
-	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[bn-586.s]=../perlasm/x86asm.pl
 GENERATE[co-586.s]=asm/co-586.pl \
-	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[co-586.s]=../perlasm/x86asm.pl
 GENERATE[x86-mont.s]=asm/x86-mont.pl \
-	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[x86-mont.s]=../perlasm/x86asm.pl
 GENERATE[x86-gf2m.s]=asm/x86-gf2m.pl \
-	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+	$(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[x86-gf2m.s]=../perlasm/x86asm.pl
 
 GENERATE[sparcv9a-mont.S]=asm/sparcv9a-mont.pl $(PERLASM_SCHEME)
@@ -49,7 +53,8 @@ GENERATE[rsaz-x86_64.s]=asm/rsaz-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[rsaz-avx2.s]=asm/rsaz-avx2.pl $(PERLASM_SCHEME)
 
 GENERATE[bn-ia64.s]=asm/ia64.S
-GENERATE[ia64-mont.s]=asm/ia64-mont.pl $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[ia64-mont.s]=asm/ia64-mont.pl \
+        $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 
 GENERATE[parisc-mont.s]=asm/parisc-mont.pl $(PERLASM_SCHEME)
 
diff --git a/crypto/build.info b/crypto/build.info
index 0d34750..a873219 100644
--- a/crypto/build.info
+++ b/crypto/build.info
@@ -11,14 +11,16 @@ EXTRA=  ../ms/uplink-x86.pl ../ms/uplink.c ../ms/applink.c \
         ppccpuid.pl pariscid.pl alphacpuid.pl arm64cpuid.pl armv4cpuid.pl
 
 DEPEND[cversion.o]=buildinf.h
-GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(CFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
+GENERATE[buildinf.h]=../util/mkbuildinf.pl &quot;$(CC) $(CFLAGS) $(CPPFLAGS_Q)&quot; &quot;$(PLATFORM)&quot;
 DEPEND[buildinf.h]=../configdata.pm
 
 GENERATE[uplink-x86.s]=../ms/uplink-x86.pl $(PERLASM_SCHEME)
 GENERATE[uplink-x86_64.s]=../ms/uplink-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[uplink-ia64.s]=../ms/uplink-ia64.pl $(PERLASM_SCHEME)
 
-GENERATE[x86cpuid.s]=x86cpuid.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[x86cpuid.s]=x86cpuid.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[x86cpuid.s]=perlasm/x86asm.pl
 
 GENERATE[x86_64cpuid.s]=x86_64cpuid.pl $(PERLASM_SCHEME)
diff --git a/crypto/camellia/build.info b/crypto/camellia/build.info
index fd78272..9f8d1e6 100644
--- a/crypto/camellia/build.info
+++ b/crypto/camellia/build.info
@@ -3,7 +3,9 @@ SOURCE[../../libcrypto]=\
         cmll_ecb.c cmll_ofb.c cmll_cfb.c cmll_ctr.c \
         {- $target{cmll_asm_src} -}
 
-GENERATE[cmll-x86.s]=asm/cmll-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[cmll-x86.s]=asm/cmll-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[cmll-x86.s]=../perlasm/x86asm.pl
 GENERATE[cmll-x86_64.s]=asm/cmll-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[cmllt4-sparcv9.S]=asm/cmllt4-sparcv9.pl $(PERLASM_SCHEME)
diff --git a/crypto/cast/build.info b/crypto/cast/build.info
index f6a25c9..1fd0c6f 100644
--- a/crypto/cast/build.info
+++ b/crypto/cast/build.info
@@ -2,5 +2,7 @@ LIBS=../../libcrypto
 SOURCE[../../libcrypto]=\
         c_skey.c c_ecb.c {- $target{cast_asm_src} -} c_cfb64.c c_ofb64.c
 
-GENERATE[cast-586.s]=asm/cast-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[cast-586.s]=asm/cast-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[cast-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/chacha/build.info b/crypto/chacha/build.info
index f99114c..a33386c 100644
--- a/crypto/chacha/build.info
+++ b/crypto/chacha/build.info
@@ -1,7 +1,9 @@
 LIBS=../../libcrypto
 SOURCE[../../libcrypto]={- $target{chacha_asm_src} -}
 
-GENERATE[chacha-x86.s]=asm/chacha-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[chacha-x86.s]=asm/chacha-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 GENERATE[chacha-x86_64.s]=asm/chacha-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[chacha-ppc.s]=asm/chacha-ppc.pl $(PERLASM_SCHEME)
 GENERATE[chacha-armv4.S]=asm/chacha-armv4.pl $(PERLASM_SCHEME)
diff --git a/crypto/des/build.info b/crypto/des/build.info
index 707c1e7..519db56 100644
--- a/crypto/des/build.info
+++ b/crypto/des/build.info
@@ -11,7 +11,9 @@ GENERATE[des_enc-sparc.S]=asm/des_enc.m4
 GENERATE[dest4-sparcv9.S]=asm/dest4-sparcv9.pl $(PERLASM_SCHEME)
 INCLUDE[dest4-sparcv9.o]=..
 
-GENERATE[des-586.s]=asm/des-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[des-586.s]=asm/des-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 DEPEND[des-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
-GENERATE[crypt586.s]=asm/crypt586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[crypt586.s]=asm/crypt586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 DEPEND[crypt586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/ec/build.info b/crypto/ec/build.info
index 6840887..7e5cad4 100644
--- a/crypto/ec/build.info
+++ b/crypto/ec/build.info
@@ -8,7 +8,9 @@ SOURCE[../../libcrypto]=\
         ecdsa_ossl.c ecdsa_sign.c ecdsa_vrf.c curve25519.c ecx_meth.c \
         {- $target{ec_asm_src} -}
 
-GENERATE[ecp_nistz256-x86.s]=asm/ecp_nistz256-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[ecp_nistz256-x86.s]=asm/ecp_nistz256-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 
 GENERATE[ecp_nistz256-x86_64.s]=asm/ecp_nistz256-x86_64.pl $(PERLASM_SCHEME)
 
diff --git a/crypto/md5/build.info b/crypto/md5/build.info
index 95e2be8..d1ea9cf 100644
--- a/crypto/md5/build.info
+++ b/crypto/md5/build.info
@@ -2,7 +2,8 @@ LIBS=../../libcrypto
 SOURCE[../../libcrypto]=\
         md5_dgst.c md5_one.c {- $target{md5_asm_src} -}
 
-GENERATE[md5-586.s]=asm/md5-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[md5-586.s]=asm/md5-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 
 GENERATE[md5-x86_64.s]=asm/md5-x86_64.pl $(PERLASM_SCHEME)
 
diff --git a/crypto/modes/build.info b/crypto/modes/build.info
index b794c50..d39b663 100644
--- a/crypto/modes/build.info
+++ b/crypto/modes/build.info
@@ -6,8 +6,11 @@ SOURCE[../../libcrypto]=\
 
 INCLUDE[gcm128.o]=..
 
-GENERATE[ghash-ia64.s]=asm/ghash-ia64.pl $(CFLAGS) $(LIB_CFLAGS)
-GENERATE[ghash-x86.s]=asm/ghash-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[ghash-ia64.s]=asm/ghash-ia64.pl \
+        $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
+GENERATE[ghash-x86.s]=asm/ghash-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 GENERATE[ghash-x86_64.s]=asm/ghash-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[aesni-gcm-x86_64.s]=asm/aesni-gcm-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[ghash-sparcv9.S]=asm/ghash-sparcv9.pl $(PERLASM_SCHEME)
diff --git a/crypto/poly1305/build.info b/crypto/poly1305/build.info
index dae9aa4..a990a91 100644
--- a/crypto/poly1305/build.info
+++ b/crypto/poly1305/build.info
@@ -6,7 +6,9 @@ SOURCE[../../libcrypto]=\
 
 GENERATE[poly1305-sparcv9.S]=asm/poly1305-sparcv9.pl $(PERLASM_SCHEME)
 INCLUDE[poly1305-sparcv9.o]=..
-GENERATE[poly1305-x86.s]=asm/poly1305-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[poly1305-x86.s]=asm/poly1305-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 GENERATE[poly1305-x86_64.s]=asm/poly1305-x86_64.pl $(PERLASM_SCHEME)
 GENERATE[poly1305-ppc.s]=asm/poly1305-ppc.pl $(PERLASM_SCHEME)
 GENERATE[poly1305-ppcfp.s]=asm/poly1305-ppcfp.pl $(PERLASM_SCHEME)
diff --git a/crypto/rc4/build.info b/crypto/rc4/build.info
index 8b1ed0e..dc44c0d 100644
--- a/crypto/rc4/build.info
+++ b/crypto/rc4/build.info
@@ -2,7 +2,9 @@ LIBS=../../libcrypto
 SOURCE[../../libcrypto]=\
         {- $target{rc4_asm_src} -}
 
-GENERATE[rc4-586.s]=asm/rc4-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[rc4-586.s]=asm/rc4-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[rc4-586.s]=../perlasm/x86asm.pl
 
 GENERATE[rc4-x86_64.s]=asm/rc4-x86_64.pl $(PERLASM_SCHEME)
diff --git a/crypto/rc5/build.info b/crypto/rc5/build.info
index baf8a0e..6a22594 100644
--- a/crypto/rc5/build.info
+++ b/crypto/rc5/build.info
@@ -2,5 +2,6 @@ LIBS=../../libcrypto
 SOURCE[../../libcrypto]=\
         rc5_skey.c rc5_ecb.c {- $target{rc5_asm_src} -} rc5cfb64.c rc5ofb64.c
 
-GENERATE[rc5-586.s]=asm/rc5-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[rc5-586.s]=asm/rc5-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 DEPEND[rc5-586.s]=../perlasm/x86asm.pl ../perlasm/cbc.pl
diff --git a/crypto/ripemd/build.info b/crypto/ripemd/build.info
index c45050c..9dc7a76 100644
--- a/crypto/ripemd/build.info
+++ b/crypto/ripemd/build.info
@@ -2,5 +2,6 @@ LIBS=../../libcrypto
 SOURCE[../../libcrypto]=\
         rmd_dgst.c rmd_one.c {- $target{rmd160_asm_src} -}
 
-GENERATE[rmd-586.s]=asm/rmd-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[rmd-586.s]=asm/rmd-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 DEPEND[rmd-586.s]=../perlasm/x86asm.pl
diff --git a/crypto/sha/build.info b/crypto/sha/build.info
index 728c156..4044b3f 100644
--- a/crypto/sha/build.info
+++ b/crypto/sha/build.info
@@ -3,16 +3,25 @@ SOURCE[../../libcrypto]=\
         sha1dgst.c sha1_one.c sha256.c sha512.c {- $target{sha1_asm_src} -} \
         keccak1600.c
 
-GENERATE[sha1-586.s]=asm/sha1-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[sha1-586.s]=asm/sha1-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[sha1-586.s]=../perlasm/x86asm.pl
-GENERATE[sha256-586.s]=asm/sha256-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[sha256-586.s]=asm/sha256-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[sha256-586.s]=../perlasm/x86asm.pl
-GENERATE[sha512-586.s]=asm/sha512-586.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[sha512-586.s]=asm/sha512-586.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[sha512-586.s]=../perlasm/x86asm.pl
 
-GENERATE[sha1-ia64.s]=asm/sha1-ia64.pl $(CFLAGS) $(LIB_CFLAGS)
-GENERATE[sha256-ia64.s]=asm/sha512-ia64.pl $(CFLAGS) $(LIB_CFLAGS)
-GENERATE[sha512-ia64.s]=asm/sha512-ia64.pl $(CFLAGS) $(LIB_CFLAGS)
+GENERATE[sha1-ia64.s]=asm/sha1-ia64.pl \
+        $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
+GENERATE[sha256-ia64.s]=asm/sha512-ia64.pl \
+        $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
+GENERATE[sha512-ia64.s]=asm/sha512-ia64.pl \
+        $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS)
 
 GENERATE[sha1-alpha.S]=asm/sha1-alpha.pl $(PERLASM_SCHEME)
 
diff --git a/crypto/whrlpool/build.info b/crypto/whrlpool/build.info
index 7f3a19e..6044d7b 100644
--- a/crypto/whrlpool/build.info
+++ b/crypto/whrlpool/build.info
@@ -1,7 +1,9 @@
 LIBS=../../libcrypto
 SOURCE[../../libcrypto]=wp_dgst.c {- $target{wp_asm_src} -}
 
-GENERATE[wp-mmx.s]=asm/wp-mmx.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+GENERATE[wp-mmx.s]=asm/wp-mmx.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
 DEPEND[wp-mmx.s]=../perlasm/x86asm.pl
 
 GENERATE[wp-x86_64.s]=asm/wp-x86_64.pl $(PERLASM_SCHEME)
diff --git a/engines/build.info b/engines/build.info
index d74d380..ad5cc16 100644
--- a/engines/build.info
+++ b/engines/build.info
@@ -37,6 +37,8 @@ IF[{- !$disabled{&quot;engine&quot;} -}]
     INCLUDE[ossltest]=../include
   ENDIF
 
-  GENERATE[e_padlock-x86.s]=asm/e_padlock-x86.pl $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(PROCESSOR)
+  GENERATE[e_padlock-x86.s]=asm/e_padlock-x86.pl \
+        $(PERLASM_SCHEME) $(CFLAGS) $(LIB_CFLAGS) $(CPPFLAGS) $(LIB_CPPFLAGS) \
+        $(PROCESSOR)
   GENERATE[e_padlock-x86_64.s]=asm/e_padlock-x86_64.pl $(PERLASM_SCHEME)
 ENDIF
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017756.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="017775.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17770">[ date ]</a>
              <a href="thread.html#17770">[ thread ]</a>
              <a href="subject.html#17770">[ subject ]</a>
              <a href="author.html#17770">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
