<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-May/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1589566873.929925.12625.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028779.html">
   <LINK REL="Next"  HREF="028781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>dev at ddvo.net</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1589566873.929925.12625.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">dev at ddvo.net
       </A><BR>
    <I>Fri May 15 18:21:13 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="028779.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="028781.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28780">[ date ]</a>
              <a href="thread.html#28780">[ thread ]</a>
              <a href="subject.html#28780">[ subject ]</a>
              <a href="author.html#28780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  6d382c74b375f1f8c44f04ec3de95ff781598a3b (commit)
       via  60d5331350a5e557908eed0ba7420dba2ad3b79f (commit)
       via  db71d315479762eefbf2bcda8be3b44b1867133f (commit)
      from  c6601bd2d728d4c61711a016c6267fb45910e7cd (commit)


- Log -----------------------------------------------------------------
commit 6d382c74b375f1f8c44f04ec3de95ff781598a3b
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Wed May 6 13:51:50 2020 +0200

    Use OSSL_STORE for load_{,pub}key() and load_cert() in apps/lib/apps.c
    
    This also adds the more flexible and general load_key_cert_crl()
    as well as helper functions get_passwd(), cleanse(), and clear_free()
    to be used also in apps/cmp.c etc.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">david.von.oheimb at siemens.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11755">https://github.com/openssl/openssl/pull/11755</A>)

commit 60d5331350a5e557908eed0ba7420dba2ad3b79f
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Fri May 8 10:56:14 2020 +0200

    Nit-fix: remove whitespace in doc/man3/EVP_PKEY_fromdata.pod causing warning
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">david.von.oheimb at siemens.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11755">https://github.com/openssl/openssl/pull/11755</A>)

commit db71d315479762eefbf2bcda8be3b44b1867133f
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu May 7 21:37:28 2020 +0200

    Guard use of struct tms with #ifdef __TMS like done earlier in apps/lib/apps.c
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    Reviewed-by: David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">david.von.oheimb at siemens.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/11755">https://github.com/openssl/openssl/pull/11755</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/ca.c                        |   9 +-
 apps/cmp.c                       | 153 +-------------
 apps/cms.c                       |  15 +-
 apps/crl.c                       |   6 +-
 apps/dgst.c                      |   2 +-
 apps/dsa.c                       |   2 +-
 apps/ec.c                        |   2 +-
 apps/enc.c                       |   2 +-
 apps/include/apps.h              |  17 +-
 apps/include/opt.h               |   4 +-
 apps/lib/apps.c                  | 432 ++++++++++++++++++---------------------
 apps/lib/s_cb.c                  |   4 +-
 apps/ocsp.c                      |  10 +-
 apps/pkey.c                      |   2 +-
 apps/pkeyutl.c                   |  10 +-
 apps/req.c                       |   2 +-
 apps/rsa.c                       |   2 +-
 apps/rsautl.c                    |   6 +-
 apps/s_client.c                  |  11 +-
 apps/s_server.c                  |  17 +-
 apps/smime.c                     |   8 +-
 apps/spkac.c                     |   2 +-
 apps/verify.c                    |   2 +-
 apps/x509.c                      |  20 +-
 crypto/store/store_lib.c         |   2 +
 doc/man1/openssl-ca.pod.in       |  18 +-
 doc/man1/openssl-cms.pod.in      |  14 +-
 doc/man1/openssl-crl.pod.in      |  24 ++-
 doc/man1/openssl-dgst.pod.in     |   4 +
 doc/man1/openssl-ec.pod.in       |  12 +-
 doc/man1/openssl-ocsp.pod.in     |   4 +-
 doc/man1/openssl-pkey.pod.in     |  12 +-
 doc/man1/openssl-pkeyutl.pod.in  |  14 +-
 doc/man1/openssl-req.pod.in      |   8 +-
 doc/man1/openssl-rsa.pod.in      |  12 +-
 doc/man1/openssl-rsautl.pod.in   |   8 +-
 doc/man1/openssl-s_client.pod.in |  16 +-
 doc/man1/openssl-s_server.pod.in |  32 +--
 doc/man1/openssl-smime.pod.in    |  14 +-
 doc/man1/openssl-spkac.pod.in    |  10 +-
 doc/man1/openssl-verify.pod.in   |   1 -
 doc/man1/openssl-x509.pod.in     |  42 ++--
 doc/man1/openssl.pod             |  34 +--
 doc/man3/EVP_PKEY_fromdata.pod   |   2 +-
 44 files changed, 472 insertions(+), 551 deletions(-)

diff --git a/apps/ca.c b/apps/ca.c
index a18ff0998e..d91b39c91c 100644
--- a/apps/ca.c
+++ b/apps/ca.c
@@ -215,12 +215,12 @@ const OPTIONS ca_options[] = {
     OPT_SECTION(&quot;Signing&quot;),
     {&quot;md&quot;, OPT_MD, 's', &quot;md to use; one of md2, md5, sha or sha1&quot;},
     {&quot;keyfile&quot;, OPT_KEYFILE, 's', &quot;Private key&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Private key file format (PEM or ENGINE)&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Private key file format (ENGINE, other values ignored)&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;key&quot;, OPT_KEY, 's', &quot;Key to decode the private key if it is encrypted&quot;},
     {&quot;cert&quot;, OPT_CERT, '&lt;', &quot;The CA cert&quot;},
     {&quot;certform&quot;, OPT_CERTFORM, 'F',
-     &quot;certificate input format (DER or PEM); default PEM&quot;},
+     &quot;certificate input format (DER/PEM/P12); has no effect&quot;},
     {&quot;selfsign&quot;, OPT_SELFSIGN, '-',
      &quot;Sign a cert with the key associated with it&quot;},
     {&quot;sigopt&quot;, OPT_SIGOPT, 's', &quot;Signature parameter in n:v form&quot;},
@@ -385,7 +385,7 @@ opthelp:
             certfile = opt_arg();
             break;
         case OPT_CERTFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;certformat))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;certformat))
                 goto opthelp;
             break;
         case OPT_SELFSIGN:
@@ -573,8 +573,7 @@ end_of_options:
         }
     }
     pkey = load_key(keyfile, keyformat, 0, key, e, &quot;CA private key&quot;);
-    if (key != NULL)
-        OPENSSL_cleanse(key, strlen(key));
+    cleanse(key);
     if (pkey == NULL)
         /* load_key() has already printed an appropriate message */
         goto end;
diff --git a/apps/cmp.c b/apps/cmp.c
index 7375b795ca..7a2ce2963d 100644
--- a/apps/cmp.c
+++ b/apps/cmp.c
@@ -46,157 +46,6 @@ DEFINE_STACK_OF(X509)
 DEFINE_STACK_OF(X509_EXTENSION)
 DEFINE_STACK_OF(OSSL_CMP_ITAV)
 
-/* start TODO remove when PR #11755 is merged */
-static char *get_passwd(const char *pass, const char *desc)
-{
-    char *result = NULL;
-
-    app_passwd(pass, NULL, &amp;result, NULL);
-    return result;
-}
-
-static void cleanse(char *str)
-{
-    if (str != NULL)
-        OPENSSL_cleanse(str, strlen(str));
-}
-
-static void clear_free(char *str)
-{
-    if (str != NULL)
-        OPENSSL_clear_free(str, strlen(str));
-}
-
-static int load_key_cert_crl(const char *uri, int maybe_stdin,
-                             const char *pass, const char *desc,
-                             EVP_PKEY **ppkey, X509 **pcert, X509_CRL **pcrl)
-{
-    PW_CB_DATA uidata;
-    OSSL_STORE_CTX *ctx = NULL;
-    int ret = 0;
-
-    if (ppkey != NULL)
-        *ppkey = NULL;
-    if (pcert != NULL)
-        *pcert = NULL;
-    if (pcrl != NULL)
-        *pcrl = NULL;
-
-    uidata.password = pass;
-    uidata.prompt_info = uri;
-
-    ctx = OSSL_STORE_open(uri, get_ui_method(), &amp;uidata, NULL, NULL);
-    if (ctx == NULL) {
-        BIO_printf(bio_err, &quot;Could not open file or uri %s for loading %s\n&quot;,
-                   uri, desc);
-        goto end;
-    }
-
-    for (;;) {
-        OSSL_STORE_INFO *info = OSSL_STORE_load(ctx);
-        int type = info == NULL ? 0 : OSSL_STORE_INFO_get_type(info);
-        const char *infostr =
-            info == NULL ? NULL : OSSL_STORE_INFO_type_string(type);
-        int err = 0;
-
-        if (info == NULL) {
-            if (OSSL_STORE_eof(ctx))
-                ret = 1;
-            break;
-        }
-
-        switch (type) {
-        case OSSL_STORE_INFO_PKEY:
-            if (ppkey != NULL &amp;&amp; *ppkey == NULL)
-                err = ((*ppkey = OSSL_STORE_INFO_get1_PKEY(info)) == NULL);
-            break;
-        case OSSL_STORE_INFO_CERT:
-            if (pcert != NULL &amp;&amp; *pcert == NULL)
-                err = ((*pcert = OSSL_STORE_INFO_get1_CERT(info)) == NULL);
-            break;
-        case OSSL_STORE_INFO_CRL:
-            if (pcrl != NULL &amp;&amp; *pcrl == NULL)
-                err = ((*pcrl = OSSL_STORE_INFO_get1_CRL(info)) == NULL);
-            break;
-        default:
-            /* skip any other type */
-            break;
-        }
-        OSSL_STORE_INFO_free(info);
-        if (err) {
-            BIO_printf(bio_err, &quot;Could not read %s of %s from %s\n&quot;,
-                       infostr, desc, uri);
-            break;
-        }
-    }
-
- end:
-    if (ctx != NULL)
-        OSSL_STORE_close(ctx);
-    if (!ret)
-        ERR_print_errors(bio_err);
-    return ret;
-}
-
-static
-EVP_PKEY *load_key_preliminary(const char *uri, int format, int may_stdin,
-                               const char *pass, ENGINE *e, const char *desc)
-{
-    EVP_PKEY *pkey = NULL;
-
-    if (desc == NULL)
-        desc = &quot;private key&quot;;
-
-    if (format == FORMAT_ENGINE) {
-        if (e == NULL) {
-            BIO_printf(bio_err, &quot;No engine specified for loading %s\n&quot;, desc);
-        } else {
-#ifndef OPENSSL_NO_ENGINE
-            PW_CB_DATA cb_data;
-
-            cb_data.password = pass;
-            cb_data.prompt_info = uri;
-            if (ENGINE_init(e)) {
-                pkey = ENGINE_load_private_key(e, uri,
-                                               (UI_METHOD *)get_ui_method(),
-                                               &amp;cb_data);
-                ENGINE_finish(e);
-            }
-            if (pkey == NULL) {
-                BIO_printf(bio_err, &quot;Cannot load %s from engine\n&quot;, desc);
-                ERR_print_errors(bio_err);
-            }
-#else
-            BIO_printf(bio_err, &quot;Engines not supported for loading %s\n&quot;, desc);
-#endif
-        }
-    } else {
-        (void)load_key_cert_crl(uri, may_stdin, pass, desc, &amp;pkey, NULL, NULL);
-    }
-
-    if (pkey == NULL) {
-        BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
-        ERR_print_errors(bio_err);
-    }
-    return pkey;
-}
-
-static X509 *load_cert_pass(const char *uri, int maybe_stdin,
-                            const char *pass, const char *desc)
-{
-    X509 *cert = NULL;
-
-    if (desc == NULL)
-        desc = &quot;certificate&quot;;
-    (void)load_key_cert_crl(uri, maybe_stdin, pass, desc, NULL, &amp;cert, NULL);
-    if (cert == NULL) {
-        BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
-        ERR_print_errors(bio_err);
-    }
-    return cert;
-}
-/* end TODO remove when PR #11755 is merged */
-
 static char *opt_config = NULL;
 #define CMP_SECTION &quot;cmp&quot;
 #define SECTION_NAME_MAX 40 /* max length of section name */
@@ -832,7 +681,7 @@ static EVP_PKEY *load_key_pwd(const char *uri, int format,
                               const char *pass, ENGINE *e, const char *desc)
 {
     char *pass_string = get_passwd(pass, desc);
-    EVP_PKEY *pkey = load_key_preliminary(uri, format, 0, pass_string, e, desc);
+    EVP_PKEY *pkey = load_key(uri, format, 0, pass_string, e, desc);
 
     clear_free(pass_string);
     return pkey;
diff --git a/apps/cms.c b/apps/cms.c
index 0c8af3dab7..6b5577ecee 100644
--- a/apps/cms.c
+++ b/apps/cms.c
@@ -196,7 +196,7 @@ const OPTIONS cms_options[] = {
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;inkey&quot;, OPT_INKEY, 's',
      &quot;Input private key (if not signer or recipient)&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Input private key format (PEM or ENGINE)&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Input private key format (ENGINE, other values ignored)&quot;},
     {&quot;keyopt&quot;, OPT_KEYOPT, 's', &quot;Set public key parameters as n:v pairs&quot;},
 
     OPT_SECTION(&quot;Mail header&quot;),
@@ -576,7 +576,7 @@ int cms_main(int argc, char **argv)
             if (operation == SMIME_ENCRYPT) {
                 if (encerts == NULL &amp;&amp; (encerts = sk_X509_new_null()) == NULL)
                     goto end;
-                cert = load_cert(opt_arg(), FORMAT_PEM,
+                cert = load_cert(opt_arg(), FORMAT_UNDEF,
                                  &quot;recipient certificate file&quot;);
                 if (cert == NULL)
                     goto end;
@@ -756,7 +756,7 @@ int cms_main(int argc, char **argv)
             if ((encerts = sk_X509_new_null()) == NULL)
                 goto end;
         while (*argv) {
-            if ((cert = load_cert(*argv, FORMAT_PEM,
+            if ((cert = load_cert(*argv, FORMAT_UNDEF,
                                   &quot;recipient certificate file&quot;)) == NULL)
                 goto end;
             sk_X509_push(encerts, cert);
@@ -774,7 +774,7 @@ int cms_main(int argc, char **argv)
     }
 
     if (recipfile != NULL &amp;&amp; (operation == SMIME_DECRYPT)) {
-        if ((recip = load_cert(recipfile, FORMAT_PEM,
+        if ((recip = load_cert(recipfile, FORMAT_UNDEF,
                                &quot;recipient certificate file&quot;)) == NULL) {
             ERR_print_errors(bio_err);
             goto end;
@@ -782,7 +782,7 @@ int cms_main(int argc, char **argv)
     }
 
     if (originatorfile != NULL) {
-        if ((originator = load_cert(originatorfile, FORMAT_PEM,
+        if ((originator = load_cert(originatorfile, FORMAT_UNDEF,
                                     &quot;originator certificate file&quot;)) == NULL) {
              ERR_print_errors(bio_err);
              goto end;
@@ -790,7 +790,7 @@ int cms_main(int argc, char **argv)
     }
 
     if (operation == SMIME_SIGN_RECEIPT) {
-        if ((signer = load_cert(signerfile, FORMAT_PEM,
+        if ((signer = load_cert(signerfile, FORMAT_UNDEF,
                                 &quot;receipt signer certificate file&quot;)) == NULL) {
             ERR_print_errors(bio_err);
             goto end;
@@ -1019,7 +1019,8 @@ int cms_main(int argc, char **argv)
             signerfile = sk_OPENSSL_STRING_value(sksigners, i);
             keyfile = sk_OPENSSL_STRING_value(skkeys, i);
 
-            signer = load_cert(signerfile, FORMAT_PEM, &quot;signer certificate&quot;);
+            signer = load_cert(signerfile, FORMAT_UNDEF,
+                               &quot;signer certificate&quot;);
             if (signer == NULL) {
                 ret = 2;
                 goto end;
diff --git a/apps/crl.c b/apps/crl.c
index 8028fef5de..d417642cce 100644
--- a/apps/crl.c
+++ b/apps/crl.c
@@ -34,9 +34,9 @@ const OPTIONS crl_options[] = {
 
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, '&lt;', &quot;Input file - default stdin&quot;},
-    {&quot;inform&quot;, OPT_INFORM, 'F', &quot;Input format; default PEM&quot;},
+    {&quot;inform&quot;, OPT_INFORM, 'F', &quot;CRL input format (DER or PEM); has no effect&quot;},
     {&quot;key&quot;, OPT_KEY, '&lt;', &quot;CRL signing Private key to use&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'F', &quot;Private key file format (PEM or ENGINE)&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'F', &quot;Private key file format (DER/PEM/P12); has no effect&quot;},
 
     OPT_SECTION(&quot;Output&quot;),
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;output file - default stdout&quot;},
@@ -122,7 +122,7 @@ int crl_main(int argc, char **argv)
             outfile = opt_arg();
             break;
         case OPT_KEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;keyformat))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;keyformat))
                 goto opthelp;
             break;
         case OPT_KEY:
diff --git a/apps/dgst.c b/apps/dgst.c
index 90aaf982ae..da162e6ed6 100644
--- a/apps/dgst.c
+++ b/apps/dgst.c
@@ -64,7 +64,7 @@ const OPTIONS dgst_options[] = {
     {&quot;c&quot;, OPT_C, '-', &quot;Print the digest with separating colons&quot;},
     {&quot;r&quot;, OPT_R, '-', &quot;Print the digest in coreutils format&quot;},
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output to filename rather than stdout&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Key file format (PEM or ENGINE)&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Key file format (ENGINE, other values ignored)&quot;},
     {&quot;hex&quot;, OPT_HEX, '-', &quot;Print as hex dump&quot;},
     {&quot;binary&quot;, OPT_BINARY, '-', &quot;Print in binary form&quot;},
     {&quot;d&quot;, OPT_DEBUG, '-', &quot;Print debug info&quot;},
diff --git a/apps/dsa.c b/apps/dsa.c
index 65397ab053..8ef802e0da 100644
--- a/apps/dsa.c
+++ b/apps/dsa.c
@@ -48,7 +48,7 @@ const OPTIONS dsa_options[] = {
 
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, 's', &quot;Input key&quot;},
-    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format, DER PEM PVK&quot;},
+    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format (DER/PEM/PVK); has no effect&quot;},
     {&quot;pubin&quot;, OPT_PUBIN, '-', &quot;Expect a public key in input file&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
 
diff --git a/apps/ec.c b/apps/ec.c
index 9cf6e1a545..43e2be1346 100644
--- a/apps/ec.c
+++ b/apps/ec.c
@@ -49,7 +49,7 @@ const OPTIONS ec_options[] = {
 
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, 's', &quot;Input file&quot;},
-    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format - DER or PEM&quot;},
+    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format (DER/PEM/P12/ENGINE)&quot;},
     {&quot;pubin&quot;, OPT_PUBIN, '-', &quot;Expect a public key in input file&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;check&quot;, OPT_CHECK, '-', &quot;check key consistency&quot;},
diff --git a/apps/enc.c b/apps/enc.c
index d7e99b43e7..4d59391c22 100644
--- a/apps/enc.c
+++ b/apps/enc.c
@@ -538,7 +538,7 @@ int enc_main(int argc, char **argv)
                 goto end;
             }
             /* wiping secret data as we no longer need it */
-            OPENSSL_cleanse(hkey, strlen(hkey));
+            cleanse(hkey);
         }
 
         if ((benc = BIO_new(BIO_f_cipher())) == NULL)
diff --git a/apps/include/apps.h b/apps/include/apps.h
index e168942e19..7789bd2b0a 100644
--- a/apps/include/apps.h
+++ b/apps/include/apps.h
@@ -102,19 +102,28 @@ int set_cert_ex(unsigned long *flags, const char *arg);
 int set_name_ex(unsigned long *flags, const char *arg);
 int set_ext_copy(int *copy_type, const char *arg);
 int copy_extensions(X509 *x, X509_REQ *req, int copy_type);
+char *get_passwd(const char *pass, const char *desc);
 int app_passwd(const char *arg1, const char *arg2, char **pass1, char **pass2);
 int add_oid_section(CONF *conf);
 X509_REQ *load_csr(const char *file, int format, const char *desc);
-X509 *load_cert(const char *file, int format, const char *desc);
-X509_CRL *load_crl(const char *infile, int format, const char *desc);
-EVP_PKEY *load_key(const char *file, int format, int maybe_stdin,
+X509 *load_cert_pass(const char *uri, int maybe_stdin,
+                     const char *pass, const char *desc);
+/* the format parameter is meanwhile not needed anymore and thus ignored */
+X509 *load_cert(const char *uri, int format, const char *desc);
+X509_CRL *load_crl(const char *uri, int format, const char *desc);
+void cleanse(char *str);
+void clear_free(char *str);
+EVP_PKEY *load_key(const char *uri, int format, int maybe_stdin,
                    const char *pass, ENGINE *e, const char *desc);
-EVP_PKEY *load_pubkey(const char *file, int format, int maybe_stdin,
+EVP_PKEY *load_pubkey(const char *uri, int format, int maybe_stdin,
                       const char *pass, ENGINE *e, const char *desc);
 int load_certs(const char *file, STACK_OF(X509) **certs, int format,
                const char *pass, const char *desc);
 int load_crls(const char *file, STACK_OF(X509_CRL) **crls, int format,
               const char *pass, const char *desc);
+int load_key_cert_crl(const char *uri, int maybe_stdin,
+                      const char *pass, const char *desc,
+                      EVP_PKEY **ppkey, X509 **pcert, X509_CRL **pcrl);
 X509_STORE *setup_verify(const char *CAfile, int noCAfile,
                          const char *CApath, int noCApath,
                          const char *CAstore, int noCAstore);
diff --git a/apps/include/opt.h b/apps/include/opt.h
index b4753dc42e..5afbad1bbe 100644
--- a/apps/include/opt.h
+++ b/apps/include/opt.h
@@ -132,9 +132,9 @@
         { &quot;xchain_build&quot;, OPT_X_CHAIN_BUILD, '-', \
             &quot;build certificate chain for the extended certificates&quot;}, \
         { &quot;xcertform&quot;, OPT_X_CERTFORM, 'F', \
-            &quot;format of Extended certificate (PEM or DER) PEM default &quot; }, \
+            &quot;format of Extended certificate (PEM/DER/P12); has no effect&quot; }, \
         { &quot;xkeyform&quot;, OPT_X_KEYFORM, 'F', \
-            &quot;format of Extended certificate's key (PEM or DER) PEM default&quot;}
+            &quot;format of Extended certificate's key (DER/PEM/P12); has no effect&quot;}
 
 # define OPT_X_CASES \
         OPT_X__FIRST: case OPT_X__LAST: break; \
diff --git a/apps/lib/apps.c b/apps/lib/apps.c
index 6facdf3e5b..8063a0e272 100644
--- a/apps/lib/apps.c
+++ b/apps/lib/apps.c
@@ -29,6 +29,7 @@
 #include &lt;openssl/x509.h&gt;
 #include &lt;openssl/x509v3.h&gt;
 #include &lt;openssl/pem.h&gt;
+#include &lt;openssl/store.h&gt;
 #include &lt;openssl/pkcs12.h&gt;
 #include &lt;openssl/ui.h&gt;
 #include &lt;openssl/safestack.h&gt;
@@ -209,6 +210,24 @@ int wrap_password_callback(char *buf, int bufsiz, int verify, void *userdata)
 
 static char *app_get_pass(const char *arg, int keepbio);
 
+char *get_passwd(const char *pass, const char *desc)
+{
+    char *result = NULL;
+
+    if (desc == NULL)
+        desc = &quot;&lt;unknown&gt;&quot;;
+    if (!app_passwd(pass, NULL, &amp;result, NULL))
+        BIO_printf(bio_err, &quot;Error getting password for %s\n&quot;, desc);
+    if (pass != NULL &amp;&amp; result == NULL) {
+        BIO_printf(bio_err,
+                   &quot;Trying plain input string (better precede with 'pass:')\n&quot;);
+        result = OPENSSL_strdup(pass);
+        if (result == NULL)
+            BIO_printf(bio_err, &quot;Out of memory getting password for %s\n&quot;, desc);
+    }
+    return result;
+}
+
 int app_passwd(const char *arg1, const char *arg2, char **pass1, char **pass2)
 {
     int same = arg1 != NULL &amp;&amp; arg2 != NULL &amp;&amp; strcmp(arg1, arg2) == 0;
@@ -412,126 +431,44 @@ int add_oid_section(CONF *conf)
     return 1;
 }
 
-static int load_pkcs12(BIO *in, const char *desc,
-                       pem_password_cb *pem_cb, PW_CB_DATA *cb_data,
-                       EVP_PKEY **pkey, X509 **cert, STACK_OF(X509) **ca)
-{
-    const char *pass;
-    char tpass[PEM_BUFSIZE];
-    int len, ret = 0;
-    PKCS12 *p12;
-
-    p12 = d2i_PKCS12_bio(in, NULL);
-    if (p12 == NULL) {
-        if (desc != NULL)
-            BIO_printf(bio_err, &quot;Error loading PKCS12 file for %s\n&quot;, desc);
-        else
-            BIO_printf(bio_err, &quot;Error loading PKCS12 file\n&quot;);
-        goto die;
-    }
-    /* See if an empty password will do */
-    if (PKCS12_verify_mac(p12, &quot;&quot;, 0) || PKCS12_verify_mac(p12, NULL, 0)) {
-        pass = &quot;&quot;;
-    } else {
-        if (pem_cb == NULL)
-            pem_cb = (pem_password_cb *)password_callback;
-        len = pem_cb(tpass, PEM_BUFSIZE, 0, cb_data);
-        if (len &lt; 0) {
-            BIO_printf(bio_err, &quot;Passphrase callback error for %s\n&quot;,
-                                desc != NULL ? desc : &quot;PKCS12 input&quot;);
-            goto die;
-        }
-        if (len &lt; PEM_BUFSIZE)
-            tpass[len] = 0;
-        if (!PKCS12_verify_mac(p12, tpass, len)) {
-            BIO_printf(bio_err,
-                       &quot;Mac verify error (wrong password?) in PKCS12 file for %s\n&quot;,
-                       desc != NULL ? desc : &quot;PKCS12 input&quot;);
-            goto die;
-        }
-        pass = tpass;
-    }
-    ret = PKCS12_parse(p12, pass, pkey, cert, ca);
- die:
-    PKCS12_free(p12);
-    return ret;
-}
-
-X509 *load_cert(const char *file, int format, const char *desc)
+X509 *load_cert_pass(const char *uri, int maybe_stdin,
+                     const char *pass, const char *desc)
 {
-    X509 *x = NULL;
-    BIO *cert;
-
-    if (format == FORMAT_HTTP) {
-#if !defined(OPENSSL_NO_SOCK)
-        x = X509_load_http(file, NULL, NULL, 0 /* timeout */);
-#endif
-        return x;
-    }
+    X509 *cert = NULL;
 
-    if (file == NULL) {
+    if (desc == NULL)
+        desc = &quot;certificate&quot;;
+    if (uri == NULL) {
         unbuffer(stdin);
-        cert = dup_bio_in(format);
-    } else {
-        cert = bio_open_default(file, 'r', format);
+        uri = &quot;&quot;;
     }
-    if (cert == NULL)
-        goto end;
-
-    if (format == FORMAT_ASN1) {
-        x = d2i_X509_bio(cert, NULL);
-    } else if (format == FORMAT_PEM) {
-        x = PEM_read_bio_X509_AUX(cert, NULL,
-                                  (pem_password_cb *)password_callback, NULL);
-    } else if (format == FORMAT_PKCS12) {
-        if (!load_pkcs12(cert, desc, NULL, NULL, NULL, &amp;x, NULL))
-            goto end;
-    } else {
-        print_format_error(format,
-#if !defined(OPENSSL_NO_OCSP) &amp;&amp; !defined(OPENSSL_NO_SOCK)
-                                   OPT_FMT_HTTP |
-#endif
-                                   OPT_FMT_PEMDER | OPT_FMT_PKCS12);
-    }
-
- end:
-    if (x == NULL &amp;&amp; desc != NULL) {
+    (void)load_key_cert_crl(uri, maybe_stdin, pass, desc, NULL, &amp;cert, NULL);
+    if (cert == NULL) {
         BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
         ERR_print_errors(bio_err);
     }
-    BIO_free(cert);
-    return x;
+    return cert;
 }
 
-X509_CRL *load_crl(const char *infile, int format, const char *desc)
+/* the format parameter is meanwhile not needed anymore and thus ignored */
+X509 *load_cert(const char *uri, int format, const char *desc)
 {
-    X509_CRL *x = NULL;
-    BIO *in = NULL;
-
-    if (format == FORMAT_HTTP) {
-#if !defined(OPENSSL_NO_SOCK)
-        x = X509_CRL_load_http(infile, NULL, NULL, 0 /* timeout */);
-#endif
-        return x;
-    }
+    return load_cert_pass(uri, 0, NULL, desc);
+}
 
-    in = bio_open_default(infile, 'r', format);
-    if (in == NULL)
-        goto end;
-    if (format == FORMAT_ASN1) {
-        x = d2i_X509_CRL_bio(in, NULL);
-    } else if (format == FORMAT_PEM) {
-        x = PEM_read_bio_X509_CRL(in, NULL, NULL, NULL);
-    } else
-        print_format_error(format, OPT_FMT_PEMDER);
+/* the format parameter is meanwhile not needed anymore and thus ignored */
+X509_CRL *load_crl(const char *uri, int format, const char *desc)
+{
+    X509_CRL *crl = NULL;
 
- end:
-    if (x == NULL &amp;&amp; desc != NULL) {
+    if (desc == NULL)
+        desc = &quot;CRL&quot;;
+    (void)load_key_cert_crl(uri, 0, NULL, desc, NULL, NULL, &amp;crl);
+    if (crl == NULL) {
         BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
         ERR_print_errors(bio_err);
     }
-    BIO_free(in);
-    return x;
+    return crl;
 }
 
 X509_REQ *load_csr(const char *file, int format, const char *desc)
@@ -539,6 +476,8 @@ X509_REQ *load_csr(const char *file, int format, const char *desc)
     X509_REQ *req = NULL;
     BIO *in;
 
+    if (desc == NULL)
+        desc = &quot;CSR&quot;;
     in = bio_open_default(file, 'r', format);
     if (in == NULL)
         goto end;
@@ -551,7 +490,7 @@ X509_REQ *load_csr(const char *file, int format, const char *desc)
         print_format_error(format, OPT_FMT_PEMDER);
 
  end:
-    if (req == NULL &amp;&amp; desc != NULL) {
+    if (req == NULL) {
         BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
         ERR_print_errors(bio_err);
     }
@@ -559,173 +498,92 @@ X509_REQ *load_csr(const char *file, int format, const char *desc)
     return req;
 }
 
-EVP_PKEY *load_key(const char *file, int format, int maybe_stdin,
+void cleanse(char *str)
+{
+    if (str != NULL)
+        OPENSSL_cleanse(str, strlen(str));
+}
+
+void clear_free(char *str)
+{
+    if (str != NULL)
+        OPENSSL_clear_free(str, strlen(str));
+}
+
+EVP_PKEY *load_key(const char *uri, int format, int may_stdin,
                    const char *pass, ENGINE *e, const char *desc)
 {
-    BIO *key = NULL;
     EVP_PKEY *pkey = NULL;
-    PW_CB_DATA cb_data;
 
-    cb_data.password = pass;
-    cb_data.prompt_info = file;
+    if (desc == NULL)
+        desc = &quot;private key&quot;;
 
-    if (file == NULL &amp;&amp; (!maybe_stdin || format == FORMAT_ENGINE)) {
-        BIO_printf(bio_err, &quot;No keyfile specified\n&quot;);
-        goto end;
-    }
     if (format == FORMAT_ENGINE) {
         if (e == NULL) {
-            BIO_printf(bio_err, &quot;No engine specified\n&quot;);
+            BIO_printf(bio_err, &quot;No engine specified for loading %s\n&quot;, desc);
         } else {
 #ifndef OPENSSL_NO_ENGINE
+            PW_CB_DATA cb_data;
+
+            cb_data.password = pass;
+            cb_data.prompt_info = uri;
             if (ENGINE_init(e)) {
-                pkey = ENGINE_load_private_key(e, file,
+                pkey = ENGINE_load_private_key(e, uri,
                                                (UI_METHOD *)get_ui_method(),
                                                &amp;cb_data);
                 ENGINE_finish(e);
             }
-            if (pkey == NULL &amp;&amp; desc != NULL) {
+            if (pkey == NULL) {
                 BIO_printf(bio_err, &quot;Cannot load %s from engine\n&quot;, desc);
                 ERR_print_errors(bio_err);
             }
 #else
-            BIO_printf(bio_err, &quot;Engines not supported\n&quot;);
+            BIO_printf(bio_err, &quot;Engines not supported for loading %s\n&quot;, desc);
 #endif
         }
-        goto end;
-    }
-    if (file == NULL &amp;&amp; maybe_stdin) {
-        unbuffer(stdin);
-        key = dup_bio_in(format);
     } else {
-        key = bio_open_default(file, 'r', format);
-    }
-    if (key == NULL)
-        goto end;
-    if (format == FORMAT_ASN1) {
-        pkey = d2i_PrivateKey_bio(key, NULL);
-    } else if (format == FORMAT_PEM) {
-        pkey = PEM_read_bio_PrivateKey(key, NULL, wrap_password_callback, &amp;cb_data);
-    } else if (format == FORMAT_PKCS12) {
-        if (!load_pkcs12(key, desc,
-                         (pem_password_cb *)password_callback, &amp;cb_data,
-                         &amp;pkey, NULL, NULL))
-            goto end;
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DSA) &amp;&amp; !defined (OPENSSL_NO_RC4)
-    } else if (format == FORMAT_MSBLOB) {
-        pkey = b2i_PrivateKey_bio(key);
-    } else if (format == FORMAT_PVK) {
-        pkey = b2i_PVK_bio(key, wrap_password_callback, &amp;cb_data);
-#endif
-    } else {
-        print_format_error(format, OPT_FMT_PEMDER | OPT_FMT_PKCS12
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DSA) &amp;&amp; !defined (OPENSSL_NO_RC4)
-                                 | OPT_FMT_MSBLOB | FORMAT_PVK
-#endif
-#ifndef OPENSSL_NO_ENGINE
-                                 | OPT_FMT_ENGINE
-#endif
-                           );
+        (void)load_key_cert_crl(uri, may_stdin, pass, desc, &amp;pkey, NULL, NULL);
     }
 
- end:
-    BIO_free(key);
-    if (pkey == NULL &amp;&amp; desc != NULL) {
+    if (pkey == NULL) {
         BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
         ERR_print_errors(bio_err);
     }
     return pkey;
 }
 
-EVP_PKEY *load_pubkey(const char *file, int format, int maybe_stdin,
+EVP_PKEY *load_pubkey(const char *uri, int format, int maybe_stdin,
                       const char *pass, ENGINE *e, const char *desc)
 {
-    BIO *key = NULL;
     EVP_PKEY *pkey = NULL;
-    PW_CB_DATA cb_data;
 
-    cb_data.password = pass;
-    cb_data.prompt_info = file;
+    if (desc == NULL)
+        desc = &quot;public key&quot;;
 
-    if (file == NULL &amp;&amp; (!maybe_stdin || format == FORMAT_ENGINE)) {
-        BIO_printf(bio_err, &quot;No keyfile specified\n&quot;);
-        goto end;
-    }
     if (format == FORMAT_ENGINE) {
         if (e == NULL) {
-            BIO_printf(bio_err, &quot;No engine specified\n&quot;);
+            BIO_printf(bio_err, &quot;No engine specified for loading %s\n&quot;, desc);
         } else {
 #ifndef OPENSSL_NO_ENGINE
-            pkey = ENGINE_load_public_key(e, file, (UI_METHOD *)get_ui_method(),
+            PW_CB_DATA cb_data;
+
+            cb_data.password = pass;
+            cb_data.prompt_info = uri;
+            pkey = ENGINE_load_public_key(e, uri, (UI_METHOD *)get_ui_method(),
                                           &amp;cb_data);
-            if (pkey == NULL &amp;&amp; desc != NULL) {
+            if (pkey == NULL) {
                 BIO_printf(bio_err, &quot;Cannot load %s from engine\n&quot;, desc);
                 ERR_print_errors(bio_err);
             }
 #else
-            BIO_printf(bio_err, &quot;Engines not supported\n&quot;);
+            BIO_printf(bio_err, &quot;Engines not supported for loading %s\n&quot;, desc);
 #endif
         }
-        goto end;
-    }
-    if (file == NULL &amp;&amp; maybe_stdin) {
-        unbuffer(stdin);
-        key = dup_bio_in(format);
-    } else {
-        key = bio_open_default(file, 'r', format);
-    }
-    if (key == NULL)
-        goto end;
-    if (format == FORMAT_ASN1) {
-        pkey = d2i_PUBKEY_bio(key, NULL);
-    } else if (format == FORMAT_ASN1RSA) {
-#ifndef OPENSSL_NO_RSA
-        RSA *rsa;
-        rsa = d2i_RSAPublicKey_bio(key, NULL);
-        if (rsa) {
-            pkey = EVP_PKEY_new();
-            if (pkey != NULL)
-                EVP_PKEY_set1_RSA(pkey, rsa);
-            RSA_free(rsa);
-        } else
-#else
-        BIO_printf(bio_err, &quot;RSA keys not supported\n&quot;);
-#endif
-            pkey = NULL;
-    } else if (format == FORMAT_PEMRSA) {
-#ifndef OPENSSL_NO_RSA
-        RSA *rsa;
-        rsa = PEM_read_bio_RSAPublicKey(key, NULL,
-                                        (pem_password_cb *)password_callback,
-                                        &amp;cb_data);
-        if (rsa != NULL) {
-            pkey = EVP_PKEY_new();
-            if (pkey != NULL)
-                EVP_PKEY_set1_RSA(pkey, rsa);
-            RSA_free(rsa);
-        } else
-#else
-        BIO_printf(bio_err, &quot;RSA keys not supported\n&quot;);
-#endif
-            pkey = NULL;
-    } else if (format == FORMAT_PEM) {
-        pkey = PEM_read_bio_PUBKEY(key, NULL,
-                                   (pem_password_cb *)password_callback,
-                                   &amp;cb_data);
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DSA)
-    } else if (format == FORMAT_MSBLOB) {
-        pkey = b2i_PublicKey_bio(key);
-#endif
     } else {
-        print_format_error(format, OPT_FMT_PEMDER
-#if !defined(OPENSSL_NO_RSA) &amp;&amp; !defined(OPENSSL_NO_DSA)
-                                 | OPT_FMT_MSBLOB
-#endif
-                           );
+        (void)load_key_cert_crl(uri, maybe_stdin, pass, desc, &amp;pkey,
+                                NULL, NULL);
     }
- end:
-    BIO_free(key);
-    if (pkey == NULL &amp;&amp; desc != NULL) {
+    if (pkey == NULL) {
         BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc);
         ERR_print_errors(bio_err);
     }
@@ -807,11 +665,8 @@ static int load_certs_crls(const char *file, int format,
             sk_X509_CRL_pop_free(*pcrls, X509_CRL_free);
             *pcrls = NULL;
         }
-        if (desc != NULL) {
-            BIO_printf(bio_err, &quot;Unable to load %s for %s\n&quot;,
-                       pcerts ? &quot;certificates&quot; : &quot;CRLs&quot;, desc);
-            ERR_print_errors(bio_err);
-        }
+        BIO_printf(bio_err, &quot;Unable to load %s\n&quot;, desc != NULL ? desc :
+                   pcerts != NULL ? &quot;certificates&quot; : &quot;CRLs&quot;);
     }
     return rv;
 }
@@ -847,6 +702,102 @@ int load_crls(const char *file, STACK_OF(X509_CRL) **crls, int format,
     return load_certs_crls(file, format, pass, desc, NULL, crls);
 }
 
+/*
+ * Load those types of credentials for which the result pointer is not NULL.
+ * Reads from stdio if uri is NULL and maybe_stdin is nonzero.
+ * For each type the first credential found in the store is loaded.
+ * May yield partial result even if rv == 0.
+ */
+int load_key_cert_crl(const char *uri, int maybe_stdin,
+                      const char *pass, const char *desc,
+                      EVP_PKEY **ppkey, X509 **pcert, X509_CRL **pcrl)
+{
+    PW_CB_DATA uidata;
+    OSSL_STORE_CTX *ctx = NULL;
+    int ret = 0;
+    /* TODO make use of the engine reference 'eng' when loading pkeys */
+
+    if (ppkey != NULL)
+        *ppkey = NULL;
+    if (pcert != NULL)
+        *pcert = NULL;
+    if (pcrl != NULL)
+        *pcrl = NULL;
+
+    if (desc == NULL)
+        desc = &quot;key/certificate/CRL&quot;;
+    uidata.password = pass;
+    uidata.prompt_info = uri;
+
+    if (uri == NULL) {
+        BIO *bio;
+
+        if (!maybe_stdin) {
+            BIO_printf(bio_err, &quot;No filename or uri specified for loading %s\n&quot;,
+                       desc);
+            goto end;
+        }
+        unbuffer(stdin);
+        bio = BIO_new_fp(stdin, 0);
+        if (bio != NULL)
+            ctx = OSSL_STORE_attach(bio, NULL, &quot;file&quot;, NULL,
+                                    get_ui_method(), &amp;uidata, NULL, NULL);
+        uri = &quot;&lt;stdin&gt;&quot;;
+    } else {
+        ctx = OSSL_STORE_open(uri, get_ui_method(), &amp;uidata, NULL, NULL);
+    }
+    if (ctx == NULL) {
+        BIO_printf(bio_err, &quot;Could not open file or uri %s for loading %s\n&quot;,
+                   uri, desc);
+        goto end;
+    }
+
+    for (;;) {
+        OSSL_STORE_INFO *info = OSSL_STORE_load(ctx);
+        int type = info == NULL ? 0 : OSSL_STORE_INFO_get_type(info);
+        const char *infostr =
+            info == NULL ? NULL : OSSL_STORE_INFO_type_string(type);
+        int err = 0;
+
+        if (info == NULL) {
+            if (OSSL_STORE_eof(ctx))
+                ret = 1;
+            break;
+        }
+
+        switch (type) {
+        case OSSL_STORE_INFO_PKEY:
+            if (ppkey != NULL &amp;&amp; *ppkey == NULL)
+                err = ((*ppkey = OSSL_STORE_INFO_get1_PKEY(info)) == NULL);
+            break;
+        case OSSL_STORE_INFO_CERT:
+            if (pcert != NULL &amp;&amp; *pcert == NULL)
+                err = ((*pcert = OSSL_STORE_INFO_get1_CERT(info)) == NULL);
+            break;
+        case OSSL_STORE_INFO_CRL:
+            if (pcrl != NULL &amp;&amp; *pcrl == NULL)
+                err = ((*pcrl = OSSL_STORE_INFO_get1_CRL(info)) == NULL);
+            break;
+        default:
+            /* skip any other type */
+            break;
+        }
+        OSSL_STORE_INFO_free(info);
+        if (err) {
+            BIO_printf(bio_err, &quot;Could not read %s of %s from %s\n&quot;,
+                       infostr, desc, uri);
+            break;
+        }
+    }
+
+ end:
+    OSSL_STORE_close(ctx);
+    if (!ret)
+        ERR_print_errors(bio_err);
+    return ret;
+}
+
+
 #define X509V3_EXT_UNKNOWN_MASK         (0xfL &lt;&lt; 16)
 /* Return error for unknown extensions */
 #define X509V3_EXT_DEFAULT              0
@@ -2320,17 +2271,30 @@ double app_tminterval(int stop, int usertime)
 double app_tminterval(int stop, int usertime)
 {
     double ret = 0;
-    struct tms rus;
-    clock_t now = times(&amp;rus);
+    clock_t now;
     static clock_t tmstart;
+    long int tck = sysconf(_SC_CLK_TCK);
+# ifdef __TMS
+    struct tms rus;
 
+    now = times(&amp;rus);
     if (usertime)
         now = rus.tms_utime;
+# else
+    if (usertime)
+        now = clock();          /* sum of user and kernel times */
+    else {
+        struct timeval tv;
+        gettimeofday(&amp;tv, NULL);
+        now = (clock_t)((unsigned long long)tv.tv_sec * tck +
+                        (unsigned long long)tv.tv_usec * (1000000 / tck)
+            );
+    }
+# endif
 
     if (stop == TM_START) {
         tmstart = now;
     } else {
-        long int tck = sysconf(_SC_CLK_TCK);
         ret = (now - tmstart) / (double)tck;
     }
 
diff --git a/apps/lib/s_cb.c b/apps/lib/s_cb.c
index 5f2f2792fa..34bc4a9995 100644
--- a/apps/lib/s_cb.c
+++ b/apps/lib/s_cb.c
@@ -1094,11 +1094,11 @@ int args_excert(int opt, SSL_EXCERT **pexc)
         exc-&gt;build_chain = 1;
         break;
     case OPT_X_CERTFORM:
-        if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;exc-&gt;certform))
+        if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;exc-&gt;certform))
             return 0;
         break;
     case OPT_X_KEYFORM:
-        if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;exc-&gt;keyform))
+        if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;exc-&gt;keyform))
             return 0;
         break;
     }
diff --git a/apps/ocsp.c b/apps/ocsp.c
index 5f9c5cf326..fd03611fe9 100644
--- a/apps/ocsp.c
+++ b/apps/ocsp.c
@@ -404,7 +404,8 @@ int ocsp_main(int argc, char **argv)
             path = opt_arg();
             break;
         case OPT_ISSUER:
-            issuer = load_cert(opt_arg(), FORMAT_PEM, &quot;issuer certificate&quot;);
+            issuer = load_cert(opt_arg(), FORMAT_UNDEF,
+                               &quot;issuer certificate&quot;);
             if (issuer == NULL)
                 goto end;
             if (issuers == NULL) {
@@ -416,7 +417,7 @@ int ocsp_main(int argc, char **argv)
             break;
         case OPT_CERT:
             X509_free(cert);
-            cert = load_cert(opt_arg(), FORMAT_PEM, &quot;certificate&quot;);
+            cert = load_cert(opt_arg(), FORMAT_UNDEF, &quot;certificate&quot;);
             if (cert == NULL)
                 goto end;
             if (cert_id_md == NULL)
@@ -560,7 +561,8 @@ int ocsp_main(int argc, char **argv)
     if (rsignfile != NULL) {
         if (rkeyfile == NULL)
             rkeyfile = rsignfile;
-        rsigner = load_cert(rsignfile, FORMAT_PEM, &quot;responder certificate&quot;);
+        rsigner = load_cert(rsignfile, FORMAT_UNDEF,
+                            &quot;responder certificate&quot;);
         if (rsigner == NULL) {
             BIO_printf(bio_err, &quot;Error loading responder certificate\n&quot;);
             goto end;
@@ -653,7 +655,7 @@ redo_accept:
     if (signfile != NULL) {
         if (keyfile == NULL)
             keyfile = signfile;
-        signer = load_cert(signfile, FORMAT_PEM, &quot;signer certificate&quot;);
+        signer = load_cert(signfile, FORMAT_UNDEF, &quot;signer certificate&quot;);
         if (signer == NULL) {
             BIO_printf(bio_err, &quot;Error loading signer certificate\n&quot;);
             goto end;
diff --git a/apps/pkey.c b/apps/pkey.c
index ec68185663..8aafcb4277 100644
--- a/apps/pkey.c
+++ b/apps/pkey.c
@@ -57,7 +57,7 @@ const OPTIONS pkey_options[] = {
 
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, 's', &quot;Input key&quot;},
-    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format (DER or PEM)&quot;},
+    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format (DER/PEM/P12/ENGINE)&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;pubin&quot;, OPT_PUBIN, '-',
      &quot;Read public key from input (default is private key)&quot;},
diff --git a/apps/pkeyutl.c b/apps/pkeyutl.c
index 1e3802045f..231547e291 100644
--- a/apps/pkeyutl.c
+++ b/apps/pkeyutl.c
@@ -71,11 +71,11 @@ const OPTIONS pkeyutl_options[] = {
     {&quot;inkey&quot;, OPT_INKEY, 's', &quot;Input private key file&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;peerkey&quot;, OPT_PEERKEY, 's', &quot;Peer key file used in key derivation&quot;},
-    {&quot;peerform&quot;, OPT_PEERFORM, 'E', &quot;Peer key format - default PEM&quot;},
+    {&quot;peerform&quot;, OPT_PEERFORM, 'E', &quot;Peer key format (DER/PEM/P12/ENGINE)&quot;},
     {&quot;certin&quot;, OPT_CERTIN, '-', &quot;Input is a cert with a public key&quot;},
     {&quot;rev&quot;, OPT_REV, '-', &quot;Reverse the order of the input buffer&quot;},
     {&quot;sigfile&quot;, OPT_SIGFILE, '&lt;', &quot;Signature file (verify operation only)&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format - default PEM&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format (ENGINE, other values ignored)&quot;},
 
     OPT_SECTION(&quot;Output&quot;),
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output file - default stdout&quot;},
@@ -157,11 +157,11 @@ int pkeyutl_main(int argc, char **argv)
             passinarg = opt_arg();
             break;
         case OPT_PEERFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;peerform))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;peerform))
                 goto opthelp;
             break;
         case OPT_KEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;keyform))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;keyform))
                 goto opthelp;
             break;
         case OPT_R_CASES:
@@ -519,7 +519,7 @@ static EVP_PKEY_CTX *init_ctx(const char *kdfalg, int *pkeysize,
         break;
 
     case KEY_CERT:
-        x = load_cert(keyfile, keyform, &quot;Certificate&quot;);
+        x = load_cert(keyfile, FORMAT_UNDEF, &quot;Certificate&quot;);
         if (x) {
             pkey = X509_get_pubkey(x);
             X509_free(x);
diff --git a/apps/req.c b/apps/req.c
index cba6952cad..a2212b988d 100644
--- a/apps/req.c
+++ b/apps/req.c
@@ -137,7 +137,7 @@ const OPTIONS req_options[] = {
 
     OPT_SECTION(&quot;Keys and Signing&quot;),
     {&quot;key&quot;, OPT_KEY, 's', &quot;Private key to use&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Key file format&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Key file format (ENGINE, other values ignored)&quot;},
     {&quot;pubkey&quot;, OPT_PUBKEY, '-', &quot;Output public key&quot;},
     {&quot;keyout&quot;, OPT_KEYOUT, '&gt;', &quot;File to send the key to&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Private key password source&quot;},
diff --git a/apps/rsa.c b/apps/rsa.c
index bb9bcb0bb2..9f91b72d20 100644
--- a/apps/rsa.c
+++ b/apps/rsa.c
@@ -45,7 +45,7 @@ const OPTIONS rsa_options[] = {
 
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, 's', &quot;Input file&quot;},
-    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format, one of DER PEM&quot;},
+    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;Input format (DER/PEM/P12/ENGINE&quot;},
     {&quot;pubin&quot;, OPT_PUBIN, '-', &quot;Expect a public key in input file&quot;},
     {&quot;RSAPublicKey_in&quot;, OPT_RSAPUBKEY_IN, '-', &quot;Input is an RSAPublicKey&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
diff --git a/apps/rsautl.c b/apps/rsautl.c
index f74ea3164f..0f9789c39c 100644
--- a/apps/rsautl.c
+++ b/apps/rsautl.c
@@ -51,7 +51,7 @@ const OPTIONS rsautl_options[] = {
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, '&lt;', &quot;Input file&quot;},
     {&quot;inkey&quot;, OPT_INKEY, 's', &quot;Input key&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format - default PEM&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format (ENGINE, other values ignored)&quot;},
     {&quot;pubin&quot;, OPT_PUBIN, '-', &quot;Input is an RSA public&quot;},
     {&quot;certin&quot;, OPT_CERTIN, '-', &quot;Input is a cert carrying an RSA public key&quot;},
     {&quot;rev&quot;, OPT_REV, '-', &quot;Reverse the order of the input buffer&quot;},
@@ -101,7 +101,7 @@ int rsautl_main(int argc, char **argv)
             ret = 0;
             goto end;
         case OPT_KEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;keyformat))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;keyformat))
                 goto opthelp;
             break;
         case OPT_IN:
@@ -197,7 +197,7 @@ int rsautl_main(int argc, char **argv)
         break;
 
     case KEY_CERT:
-        x = load_cert(keyfile, keyformat, &quot;Certificate&quot;);
+        x = load_cert(keyfile, FORMAT_UNDEF, &quot;Certificate&quot;);
         if (x) {
             pkey = X509_get_pubkey(x);
             X509_free(x);
diff --git a/apps/s_client.c b/apps/s_client.c
index 875ebf2253..8bab4e2827 100644
--- a/apps/s_client.c
+++ b/apps/s_client.c
@@ -636,12 +636,12 @@ const OPTIONS s_client_options[] = {
     OPT_SECTION(&quot;Identity&quot;),
     {&quot;cert&quot;, OPT_CERT, '&lt;', &quot;Client certificate file to use&quot;},
     {&quot;certform&quot;, OPT_CERTFORM, 'F',
-     &quot;Client certificate file format (PEM or DER) PEM default&quot;},
+     &quot;Client certificate file format (PEM/DER/P12); has no effect&quot;},
     {&quot;cert_chain&quot;, OPT_CERT_CHAIN, '&lt;',
      &quot;Client certificate chain file (in PEM format)&quot;},
     {&quot;build_chain&quot;, OPT_BUILD_CHAIN, '-', &quot;Build client certificate chain&quot;},
     {&quot;key&quot;, OPT_KEY, 's', &quot;Private key file to use; default is: -cert file&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Key format (PEM, DER or engine) PEM default&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Key format (ENGINE, other values ignored)&quot;},
     {&quot;pass&quot;, OPT_PASS, 's', &quot;Private key file pass phrase source&quot;},
     {&quot;verify&quot;, OPT_VERIFY, 'p', &quot;Turn on peer certificate verification&quot;},
     {&quot;nameopt&quot;, OPT_NAMEOPT, 's', &quot;Certificate subject/issuer name printing options&quot;},
@@ -1144,7 +1144,7 @@ int s_client_main(int argc, char **argv)
             sess_in = opt_arg();
             break;
         case OPT_CERTFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;cert_format))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;cert_format))
                 goto opthelp;
             break;
         case OPT_CRLFORM:
@@ -1378,7 +1378,7 @@ int s_client_main(int argc, char **argv)
             fallback_scsv = 1;
             break;
         case OPT_KEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;key_format))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;key_format))
                 goto opthelp;
             break;
         case OPT_PASS:
@@ -3137,8 +3137,7 @@ int s_client_main(int argc, char **argv)
     OPENSSL_clear_free(cbuf, BUFSIZZ);
     OPENSSL_clear_free(sbuf, BUFSIZZ);
     OPENSSL_clear_free(mbuf, BUFSIZZ);
-    if (proxypass != NULL)
-        OPENSSL_clear_free(proxypass, strlen(proxypass));
+    clear_free(proxypass);
     release_engine(e);
     BIO_free(bio_c_out);
     bio_c_out = NULL;
diff --git a/apps/s_server.c b/apps/s_server.c
index 7ac4221860..bbc311befd 100644
--- a/apps/s_server.c
+++ b/apps/s_server.c
@@ -813,7 +813,7 @@ const OPTIONS s_server_options[] = {
     {&quot;cert2&quot;, OPT_CERT2, '&lt;',
      &quot;Certificate file to use for servername; default is&quot; TEST_CERT2},
     {&quot;certform&quot;, OPT_CERTFORM, 'F',
-     &quot;Server certificate file format (PEM or DER) PEM default&quot;},
+     &quot;Server certificate file format (PEM/DER/P12); has no effect&quot;},
     {&quot;cert_chain&quot;, OPT_CERT_CHAIN, '&lt;',
      &quot;Server certificate chain file in PEM format&quot;},
     {&quot;build_chain&quot;, OPT_BUILD_CHAIN, '-', &quot;Build server certificate chain&quot;},
@@ -823,19 +823,18 @@ const OPTIONS s_server_options[] = {
      &quot;Private key file to use; default is -cert file or else&quot; TEST_CERT},
     {&quot;key2&quot;, OPT_KEY2, '&lt;',
      &quot;-Private Key file to use for servername if not in -cert2&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f',
-     &quot;Key format (PEM, DER or ENGINE) PEM default&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Key format (ENGINE, other values ignored)&quot;},
     {&quot;pass&quot;, OPT_PASS, 's', &quot;Private key file pass phrase source&quot;},
     {&quot;dcert&quot;, OPT_DCERT, '&lt;',
      &quot;Second server certificate file to use (usually for DSA)&quot;},
     {&quot;dcertform&quot;, OPT_DCERTFORM, 'F',
-     &quot;Second server certificate file format (PEM or DER) PEM default&quot;},
+     &quot;Second server certificate file format (PEM/DER/P12); has no effect&quot;},
     {&quot;dcert_chain&quot;, OPT_DCERT_CHAIN, '&lt;',
      &quot;second server certificate chain file in PEM format&quot;},
     {&quot;dkey&quot;, OPT_DKEY, '&lt;',
      &quot;Second private key file to use (usually for DSA)&quot;},
     {&quot;dkeyform&quot;, OPT_DKEYFORM, 'F',
-     &quot;Second key file format (PEM, DER or ENGINE) PEM default&quot;},
+     &quot;Second key file format (ENGINE, other values ignored)&quot;},
     {&quot;dpass&quot;, OPT_DPASS, 's', &quot;Second private key file pass phrase source&quot;},
     {&quot;dhparam&quot;, OPT_DHPARAM, '&lt;', &quot;DH parameters file to use&quot;},
     {&quot;servername&quot;, OPT_SERVERNAME, 's',
@@ -1246,14 +1245,14 @@ int s_server_main(int argc, char *argv[])
             s_serverinfo_file = opt_arg();
             break;
         case OPT_CERTFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;s_cert_format))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;s_cert_format))
                 goto opthelp;
             break;
         case OPT_KEY:
             s_key_file = opt_arg();
             break;
         case OPT_KEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;s_key_format))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;s_key_format))
                 goto opthelp;
             break;
         case OPT_PASS:
@@ -1268,14 +1267,14 @@ int s_server_main(int argc, char *argv[])
 #endif
             break;
         case OPT_DCERTFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;s_dcert_format))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;s_dcert_format))
                 goto opthelp;
             break;
         case OPT_DCERT:
             s_dcert_file = opt_arg();
             break;
         case OPT_DKEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;s_dkey_format))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;s_dkey_format))
                 goto opthelp;
             break;
         case OPT_DPASS:
diff --git a/apps/smime.c b/apps/smime.c
index 50f03fdc04..6b7d51b76a 100644
--- a/apps/smime.c
+++ b/apps/smime.c
@@ -63,7 +63,7 @@ const OPTIONS smime_options[] = {
      &quot;Output format SMIME (default), PEM or DER&quot;},
     {&quot;inkey&quot;, OPT_INKEY, 's',
      &quot;Input private key (if not signer or recipient)&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Input private key format (PEM or ENGINE)&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Input private key format (ENGINE, other values ignored)&quot;},
 #ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 #endif
@@ -429,7 +429,7 @@ int smime_main(int argc, char **argv)
         if (encerts == NULL)
             goto end;
         while (*argv != NULL) {
-            cert = load_cert(*argv, FORMAT_PEM,
+            cert = load_cert(*argv, FORMAT_UNDEF,
                              &quot;recipient certificate file&quot;);
             if (cert == NULL)
                 goto end;
@@ -448,7 +448,7 @@ int smime_main(int argc, char **argv)
     }
 
     if (recipfile != NULL &amp;&amp; (operation == SMIME_DECRYPT)) {
-        if ((recip = load_cert(recipfile, FORMAT_PEM,
+        if ((recip = load_cert(recipfile, FORMAT_UNDEF,
                                &quot;recipient certificate file&quot;)) == NULL) {
             ERR_print_errors(bio_err);
             goto end;
@@ -548,7 +548,7 @@ int smime_main(int argc, char **argv)
         for (i = 0; i &lt; sk_OPENSSL_STRING_num(sksigners); i++) {
             signerfile = sk_OPENSSL_STRING_value(sksigners, i);
             keyfile = sk_OPENSSL_STRING_value(skkeys, i);
-            signer = load_cert(signerfile, FORMAT_PEM,
+            signer = load_cert(signerfile, FORMAT_UNDEF,
                                &quot;signer certificate&quot;);
             if (signer == NULL)
                 goto end;
diff --git a/apps/spkac.c b/apps/spkac.c
index 03cc3d9199..2b4009d457 100644
--- a/apps/spkac.c
+++ b/apps/spkac.c
@@ -40,7 +40,7 @@ const OPTIONS spkac_options[] = {
     OPT_SECTION(&quot;Input&quot;),
     {&quot;in&quot;, OPT_IN, '&lt;', &quot;Input file&quot;},
     {&quot;key&quot;, OPT_KEY, '&lt;', &quot;Create SPKAC using private key&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Private key file format - default PEM (PEM, DER, or ENGINE)&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'f', &quot;Private key file format (ENGINE, other values ignored)&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;challenge&quot;, OPT_CHALLENGE, 's', &quot;Challenge string&quot;},
     {&quot;spkac&quot;, OPT_SPKAC, 's', &quot;Alternative SPKAC name&quot;},
diff --git a/apps/verify.c b/apps/verify.c
index 558866806f..e0eaaabe20 100644
--- a/apps/verify.c
+++ b/apps/verify.c
@@ -256,7 +256,7 @@ static int check(X509_STORE *ctx, const char *file,
     STACK_OF(X509) *chain = NULL;
     int num_untrusted;
 
-    x = load_cert(file, FORMAT_PEM, &quot;certificate file&quot;);
+    x = load_cert(file, FORMAT_UNDEF, &quot;certificate file&quot;);
     if (x == NULL)
         goto end;
 
diff --git a/apps/x509.c b/apps/x509.c
index a2a52e41b1..ea083abc64 100644
--- a/apps/x509.c
+++ b/apps/x509.c
@@ -78,13 +78,13 @@ const OPTIONS x509_options[] = {
 #endif
 
     {&quot;inform&quot;, OPT_INFORM, 'f',
-     &quot;Input format - default PEM (one of DER or PEM)&quot;},
+     &quot;CSR input format (DER or PEM) - default PEM&quot;},
     {&quot;in&quot;, OPT_IN, '&lt;', &quot;Input file - default stdin&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Private key password/pass-phrase source&quot;},
     {&quot;outform&quot;, OPT_OUTFORM, 'f',
-     &quot;Output format - default PEM (one of DER or PEM)&quot;},
+     &quot;Output format (DER or PEM) - default PEM&quot;},
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output file - default stdout&quot;},
-    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format - default PEM&quot;},
+    {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format (ENGINE, other values ignored)&quot;},
     {&quot;req&quot;, OPT_REQ, '-', &quot;Input is a certificate request, sign and output&quot;},
     {&quot;vfyopt&quot;, OPT_VFYOPT, 's', &quot;Verification parameter in n:v form&quot;},
 
@@ -152,8 +152,8 @@ const OPTIONS x509_options[] = {
     {&quot;extfile&quot;, OPT_EXTFILE, '&lt;', &quot;File with X509V3 extensions to add&quot;},
     OPT_R_OPTIONS,
     OPT_PROV_OPTIONS,
-    {&quot;CAform&quot;, OPT_CAFORM, 'F', &quot;CA format - default PEM&quot;},
-    {&quot;CAkeyform&quot;, OPT_CAKEYFORM, 'E', &quot;CA key format - default PEM&quot;},
+    {&quot;CAform&quot;, OPT_CAFORM, 'F', &quot;CA cert format (PEM/DER/P12); has no effect&quot;},
+    {&quot;CAkeyform&quot;, OPT_CAKEYFORM, 'E', &quot;CA key format (ENGINE, other values ignored)&quot;},
     {&quot;sigopt&quot;, OPT_SIGOPT, 's', &quot;Signature parameter in n:v form&quot;},
     {&quot;CAcreateserial&quot;, OPT_CACREATESERIAL, '-',
      &quot;Create serial number file if it does not exist&quot;},
@@ -228,7 +228,7 @@ int x509_main(int argc, char **argv)
             ret = 0;
             goto end;
         case OPT_INFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;informat))
+            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;informat))
                 goto opthelp;
             break;
         case OPT_IN:
@@ -239,15 +239,15 @@ int x509_main(int argc, char **argv)
                 goto opthelp;
             break;
         case OPT_KEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;keyformat))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;keyformat))
                 goto opthelp;
             break;
         case OPT_CAFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PEMDER, &amp;CAformat))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;CAformat))
                 goto opthelp;
             break;
         case OPT_CAKEYFORM:
-            if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;CAkeyformat))
+            if (!opt_format(opt_arg(), OPT_FMT_ANY, &amp;CAkeyformat))
                 goto opthelp;
             break;
         case OPT_OUT:
@@ -631,7 +631,7 @@ int x509_main(int argc, char **argv)
         if (!X509_set_pubkey(x, fkey != NULL ? fkey : X509_REQ_get0_pubkey(req)))
             goto end;
     } else {
-        x = load_cert(infile, informat, &quot;Certificate&quot;);
+        x = load_cert(infile, FORMAT_UNDEF, &quot;Certificate&quot;);
         if (x == NULL)
             goto end;
         if (fkey != NULL &amp;&amp; !X509_set_pubkey(x, fkey))
diff --git a/crypto/store/store_lib.c b/crypto/store/store_lib.c
index 15c0862019..e1fc591894 100644
--- a/crypto/store/store_lib.c
+++ b/crypto/store/store_lib.c
@@ -231,6 +231,8 @@ int OSSL_STORE_close(OSSL_STORE_CTX *ctx)
 {
     int loader_ret;
 
+    if (ctx == NULL)
+        return 1;
     OSSL_TRACE1(STORE, &quot;Closing %p\n&quot;, (void *)ctx-&gt;loader_ctx);
     loader_ret = ctx-&gt;loader-&gt;close(ctx-&gt;loader_ctx);
 
diff --git a/doc/man1/openssl-ca.pod.in b/doc/man1/openssl-ca.pod.in
index 0202661845..35b36afbb4 100644
--- a/doc/man1/openssl-ca.pod.in
+++ b/doc/man1/openssl-ca.pod.in
@@ -32,11 +32,11 @@ B&lt;openssl&gt; B&lt;ca&gt;
 [B&lt;-md&gt; I&lt;arg&gt;]
 [B&lt;-policy&gt; I&lt;arg&gt;]
 [B&lt;-keyfile&gt; I&lt;arg&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-key&gt; I&lt;arg&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
 [B&lt;-cert&gt; I&lt;file&gt;]
-[B&lt;-certform&gt; B&lt;DER&gt;|&lt;PEM&gt;]
+[B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;]
 [B&lt;-selfsign&gt;]
 [B&lt;-in&gt; I&lt;file&gt;]
 [B&lt;-inform&gt; B&lt;DER&gt;|&lt;PEM&gt;]
@@ -142,18 +142,19 @@ F&lt;.pem&gt; appended.
 
 The CA certificate file.
 
-=item B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
 
 The format of the data in certificate input files.
-The default is PEM.
+This option has no effect and is retained for backward compatibility only.
 
 =item B&lt;-keyfile&gt; I&lt;filename&gt;
 
 The private key to sign requests with.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
-The format of the private key file; the default is B&lt;PEM&gt;.
+The format of the private key input file; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-sigopt&gt; I&lt;nm&gt;:I&lt;v&gt;
@@ -788,6 +789,11 @@ retained mainly for compatibility reasons.
 
 The B&lt;-section&gt; option was added in OpenSSL 3.0.0.
 
+The B&lt;-certform&gt; option has become obsolete in OpenSSL 3.0.0 and has no effect.
+
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 SEE ALSO
 
 L&lt;openssl(1)&gt;,
diff --git a/doc/man1/openssl-cms.pod.in b/doc/man1/openssl-cms.pod.in
index 4fbb7c0e16..375d358703 100644
--- a/doc/man1/openssl-cms.pod.in
+++ b/doc/man1/openssl-cms.pod.in
@@ -36,7 +36,7 @@ B&lt;openssl&gt; B&lt;cms&gt;
 [B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;SMIME&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;SMIME&gt;]
 [B&lt;-rctform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;SMIME&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-stream&gt;]
 [B&lt;-indef&gt;]
 [B&lt;-noindef&gt;]
@@ -82,7 +82,7 @@ B&lt;openssl&gt; B&lt;cms&gt;
 {- $OpenSSL::safe::opt_r_synopsis -}
 {- $OpenSSL::safe::opt_engine_synopsis -}
 {- $OpenSSL::safe::opt_provider_synopsis -}
-[I&lt;cert.pem&gt; ...]
+[I&lt;recipient-cert&gt; ...]
 
 =for openssl ifdef des-wrap engine
 
@@ -235,9 +235,10 @@ The output format of the CMS structure (if one is being written);
 the default is B&lt;SMIME&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The format of the private key file; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-rctform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;SMIME&gt;
@@ -370,7 +371,7 @@ the MIME type multipart/signed is used.
 
 Allows additional certificates to be specified. When signing these will
 be included with the message. When verifying these will be searched for
-the signers certificates. The certificates should be in PEM format.
+the signers certificates.
 
 =item B&lt;-certsout&gt; I&lt;file&gt;
 
@@ -493,7 +494,7 @@ Any verification errors cause the command to exit.
 
 {- $OpenSSL::safe::opt_provider_item -}
 
-=item I&lt;cert.pem&gt; ...
+=item I&lt;recipient-cert&gt; ...
 
 One or more certificates of message recipients: used when encrypting
 a message.
@@ -766,6 +767,9 @@ was added in OpenSSL 1.0.2.
 
 The -no_alt_chains option was added in OpenSSL 1.0.2b.
 
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2008-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-crl.pod.in b/doc/man1/openssl-crl.pod.in
index 409f0b6020..19e72f1b60 100644
--- a/doc/man1/openssl-crl.pod.in
+++ b/doc/man1/openssl-crl.pod.in
@@ -12,7 +12,7 @@ B&lt;openssl&gt; B&lt;crl&gt;
 [B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-key&gt; I&lt;filename&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;]
 [B&lt;-text&gt;]
 [B&lt;-in&gt; I&lt;filename&gt;]
 [B&lt;-out&gt; I&lt;filename&gt;]
@@ -45,19 +45,24 @@ This command processes CRL files in DER or PEM format.
 
 Print out a usage message.
 
-=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
 
-The input and output formats of the CRL; the default is B&lt;PEM&gt;.
+The CRL input format.
+This option has no effect and is retained for backward compatibility only.
+
+=item B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+
+The CRL output format; the default is B&lt;PEM&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-key&gt; I&lt;filename&gt;
 
 The private key to be used to sign the CRL.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
 
-The format of the private key file; the default is B&lt;PEM&gt;.
-See L&lt;openssl(1)/Format Options&gt; for details.
+The format of the private key file.
+This option has no effect and is retained for backward compatibility only.
 
 =item B&lt;-in&gt; I&lt;filename&gt;
 
@@ -136,7 +141,7 @@ Convert a CRL file from PEM to DER:
 
 Output the text form of a DER encoded certificate:
 
- openssl crl -in crl.der -inform DER -text -noout
+ openssl crl -in crl.der -text -noout
 
 =head1 BUGS
 
@@ -151,6 +156,11 @@ L&lt;openssl-ca(1)&gt;,
 L&lt;openssl-x509(1)&gt;,
 L&lt;ossl_store-file(7)&gt;
 
+=head1 HISTORY
+
+The B&lt;-inform&gt; and B&lt;-keyform&gt; options have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-dgst.pod.in b/doc/man1/openssl-dgst.pod.in
index 84bd133f84..22c07a5a7f 100644
--- a/doc/man1/openssl-dgst.pod.in
+++ b/doc/man1/openssl-dgst.pod.in
@@ -103,6 +103,7 @@ command instead for this.
 =item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The format of the key to sign with; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-sigopt&gt; I&lt;nm&gt;:I&lt;v&gt;
@@ -247,6 +248,9 @@ L&lt;openssl-mac(1)&gt;
 The default digest was changed from MD5 to SHA256 in OpenSSL 1.1.0.
 The FIPS-related options were removed in OpenSSL 1.1.0.
 
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-ec.pod.in b/doc/man1/openssl-ec.pod.in
index cad26289b4..c1e92ef51e 100644
--- a/doc/man1/openssl-ec.pod.in
+++ b/doc/man1/openssl-ec.pod.in
@@ -13,7 +13,7 @@ openssl-ec - EC key processing
 
 B&lt;openssl&gt; B&lt;ec&gt;
 [B&lt;-help&gt;]
-[B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-in&gt; I&lt;filename&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
@@ -52,9 +52,15 @@ PKCS#8 private key format use the L&lt;openssl-pkcs8(1)&gt; command.
 
 Print out a usage message.
 
-=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
-The input and formats; the default is B&lt;PEM&gt;.
+The key input format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
+See L&lt;openssl(1)/Format Options&gt; for details.
+
+=item B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+
+The key output formats; the default is B&lt;PEM&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 Private keys are an SEC1 private key or PKCS#8 format.
diff --git a/doc/man1/openssl-ocsp.pod.in b/doc/man1/openssl-ocsp.pod.in
index e227f50e75..a738ddbdd7 100644
--- a/doc/man1/openssl-ocsp.pod.in
+++ b/doc/man1/openssl-ocsp.pod.in
@@ -103,8 +103,8 @@ specify output filename, default is standard output.
 =item B&lt;-issuer&gt; I&lt;filename&gt;
 
 This specifies the current issuer certificate. This option can be used
-multiple times. The certificate specified in I&lt;filename&gt; must be in
-PEM format. This option B&lt;MUST&gt; come before any B&lt;-cert&gt; options.
+multiple times.
+This option B&lt;MUST&gt; come before any B&lt;-cert&gt; options.
 
 =item B&lt;-cert&gt; I&lt;filename&gt;
 
diff --git a/doc/man1/openssl-pkey.pod.in b/doc/man1/openssl-pkey.pod.in
index a678bd7516..de1bef954c 100644
--- a/doc/man1/openssl-pkey.pod.in
+++ b/doc/man1/openssl-pkey.pod.in
@@ -13,7 +13,7 @@ openssl-pkey - public or private key processing command
 
 B&lt;openssl&gt; B&lt;pkey&gt;
 [B&lt;-help&gt;]
-[B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-in&gt; I&lt;filename&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
@@ -48,9 +48,15 @@ converted between various forms and their components printed out.
 
 Print out a usage message.
 
-=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
-The input and formats; the default is B&lt;PEM&gt;.
+The key input format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
+See L&lt;openssl(1)/Format Options&gt; for details.
+
+=item B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+
+The key output formats; the default is B&lt;PEM&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-in&gt; I&lt;filename&gt;
diff --git a/doc/man1/openssl-pkeyutl.pod.in b/doc/man1/openssl-pkeyutl.pod.in
index 0a65f6acc5..d823f0b851 100644
--- a/doc/man1/openssl-pkeyutl.pod.in
+++ b/doc/man1/openssl-pkeyutl.pod.in
@@ -15,10 +15,10 @@ B&lt;openssl&gt; B&lt;pkeyutl&gt;
 [B&lt;-out&gt; I&lt;file&gt;]
 [B&lt;-sigfile&gt; I&lt;file&gt;]
 [B&lt;-inkey&gt; I&lt;file&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
 [B&lt;-peerkey&gt; I&lt;file&gt;]
-[B&lt;-peerform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-peerform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-pubin&gt;]
 [B&lt;-certin&gt;]
 [B&lt;-rev&gt;]
@@ -89,9 +89,10 @@ Signature file, required for B&lt;-verify&gt; operations only
 
 The input key file, by default it should be a private key.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-passin&gt; I&lt;arg&gt;
@@ -103,9 +104,10 @@ see L&lt;openssl(1)/Pass Phrase Options&gt;.
 
 The peer key file, used by key derivation (agreement) operations.
 
-=item B&lt;-peerform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-peerform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The peer key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-pubin&gt;
@@ -402,6 +404,10 @@ L&lt;openssl-kdf(1)&gt;
 L&lt;EVP_PKEY_CTX_set_hkdf_md(3)&gt;,
 L&lt;EVP_PKEY_CTX_set_tls1_prf_md(3)&gt;,
 
+=head1 HISTORY
+
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
 
 =head1 COPYRIGHT
 
diff --git a/doc/man1/openssl-req.pod.in b/doc/man1/openssl-req.pod.in
index 397bf552ad..ab6b3d78a2 100644
--- a/doc/man1/openssl-req.pod.in
+++ b/doc/man1/openssl-req.pod.in
@@ -25,7 +25,7 @@ B&lt;openssl&gt; B&lt;req&gt;
 [B&lt;-pkeyopt&gt; I&lt;opt&gt;:I&lt;value&gt;]
 [B&lt;-nodes&gt;]
 [B&lt;-key&gt; I&lt;filename&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-keyout&gt; I&lt;filename&gt;]
 [B&lt;-keygen_engine&gt; I&lt;id&gt;]
 [B&lt;-I&lt;digest&gt;&gt;]
@@ -186,9 +186,10 @@ See L&lt;openssl-genpkey(1)/KEY GENERATION OPTIONS&gt; for more details.
 This specifies the file to read the private key from. It also
 accepts PKCS#8 format private keys for PEM format files.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The format of the private key; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-keyout&gt; I&lt;filename&gt;
@@ -691,6 +692,9 @@ L&lt;x509v3_config(5)&gt;
 
 The B&lt;-section&gt; option was added in OpenSSL 3.0.0.
 
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-rsa.pod.in b/doc/man1/openssl-rsa.pod.in
index 5dacdf9313..b2477b2b2c 100644
--- a/doc/man1/openssl-rsa.pod.in
+++ b/doc/man1/openssl-rsa.pod.in
@@ -13,7 +13,7 @@ openssl-rsa - RSA key processing command
 
 B&lt;openssl&gt; B&lt;rsa&gt;
 [B&lt;-help&gt;]
-[B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-in&gt; I&lt;filename&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
@@ -61,9 +61,15 @@ L&lt;openssl-pkcs8(1)&gt; command.
 Print out a usage message.
 
 
-=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
-The input and formats; the default is B&lt;PEM&gt;.
+The key input format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
+See L&lt;openssl(1)/Format Options&gt; for details.
+
+=item B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+
+The key output format; the default is B&lt;PEM&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
diff --git a/doc/man1/openssl-rsautl.pod.in b/doc/man1/openssl-rsautl.pod.in
index 2461db537d..5383fe2116 100644
--- a/doc/man1/openssl-rsautl.pod.in
+++ b/doc/man1/openssl-rsautl.pod.in
@@ -14,7 +14,7 @@ B&lt;openssl&gt; B&lt;rsautl&gt;
 [B&lt;-rev&gt;]
 [B&lt;-out&gt; I&lt;file&gt;]
 [B&lt;-inkey&gt; I&lt;file&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-pubin&gt;]
 [B&lt;-certin&gt;]
 [B&lt;-sign&gt;]
@@ -76,9 +76,10 @@ default.
 
 The input key file, by default it should be an RSA private key.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-pubin&gt;
@@ -237,6 +238,9 @@ L&lt;openssl-genrsa(1)&gt;
 
 This command was deprecated in OpenSSL 3.0.
 
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-s_client.pod.in b/doc/man1/openssl-s_client.pod.in
index 5f04358a84..4d6b54a5e3 100644
--- a/doc/man1/openssl-s_client.pod.in
+++ b/doc/man1/openssl-s_client.pod.in
@@ -29,14 +29,14 @@ B&lt;openssl&gt; B&lt;s_client&gt;
 [B&lt;-verifyCApath&gt; I&lt;dir&gt;]
 [B&lt;-verifyCAstore&gt; I&lt;uri&gt;]
 [B&lt;-cert&gt; I&lt;filename&gt;]
-[B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;]
 [B&lt;-cert_chain&gt; I&lt;filename&gt;]
 [B&lt;-build_chain&gt;]
 [B&lt;-CRL&gt; I&lt;filename&gt;]
 [B&lt;-CRLform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-crl_download&gt;]
 [B&lt;-key&gt; I&lt;filename&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-pass&gt; I&lt;arg&gt;]
 [B&lt;-chainCAfile&gt; I&lt;filename&gt;]
 [B&lt;-chainCApath&gt; I&lt;directory&gt;]
@@ -240,10 +240,10 @@ The default is not to use a certificate.
 
 The chain for the client certificate may be specified using B&lt;-cert_chain&gt;.
 
-=item B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
 
 The client certificate file format to use; the default is B&lt;PEM&gt;.
-see L&lt;openssl(1)/Format Options&gt;.
+This option has no effect and is retained for backward compatibility only.
 
 =item B&lt;-cert_chain&gt;
 
@@ -273,9 +273,10 @@ Download CRL from distribution points in the certificate.
 The client private key file to use.
 If not specified then the certificate file will be used to read also the key.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-pass&gt; I&lt;arg&gt;
@@ -894,6 +895,11 @@ L&lt;ossl_store-file(7)&gt;
 The B&lt;-no_alt_chains&gt; option was added in OpenSSL 1.1.0.
 The B&lt;-name&gt; option was added in OpenSSL 1.1.1.
 
+The B&lt;-certform&gt; option has become obsolete in OpenSSL 3.0.0 and has no effect.
+
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-s_server.pod.in b/doc/man1/openssl-s_server.pod.in
index c9f4bfc11b..8e5da51c40 100644
--- a/doc/man1/openssl-s_server.pod.in
+++ b/doc/man1/openssl-s_server.pod.in
@@ -20,19 +20,19 @@ B&lt;openssl&gt; B&lt;s_server&gt;
 [B&lt;-Verify&gt; I&lt;int&gt;]
 [B&lt;-cert&gt; I&lt;infile&gt;]
 [B&lt;-cert2&gt; I&lt;infile&gt;]
-[B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;]
 [B&lt;-cert_chain&gt; I&lt;infile&gt;]
 [B&lt;-build_chain&gt;]
 [B&lt;-serverinfo&gt; I&lt;val&gt;]
 [B&lt;-key&gt; I&lt;infile&gt;]
 [B&lt;-key2&gt; I&lt;infile&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-pass&gt; I&lt;val&gt;]
 [B&lt;-dcert&gt; I&lt;infile&gt;]
-[B&lt;-dcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
+[B&lt;-dcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;]
 [B&lt;-dcert_chain&gt; I&lt;infile&gt;]
 [B&lt;-dkey&gt; I&lt;infile&gt;]
-[B&lt;-dkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-dkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-dpass&gt; I&lt;val&gt;]
 [B&lt;-nbio_test&gt;]
 [B&lt;-crlf&gt;]
@@ -220,10 +220,10 @@ certificate and some require a certificate with a certain public key type:
 for example the DSS cipher suites require a certificate containing a DSS
 (DSA) key. If not specified then the filename F&lt;server.pem&gt; will be used.
 
-=item B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-certform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
 
-The server certificate file format; the default is B&lt;PEM&gt;.
-See L&lt;openssl(1)/Format Options&gt; for details.
+The server certificate file format.
+This option has no effect and is retained for backward compatibility only.
 
 =item B&lt;-cert_chain&gt;
 
@@ -248,9 +248,10 @@ ServerHello extension will be returned.
 The private key to use. If not specified then the certificate file will
 be used.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-pass&gt; I&lt;val&gt;
@@ -276,14 +277,15 @@ A file containing untrusted certificates to use when attempting to build the
 server certificate chain when a certificate specified via the B&lt;-dcert&gt; option
 is in use.
 
-=item B&lt;-dcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-dcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
 
-The format of the additional certificate file; the default is B&lt;PEM&gt;.
-See L&lt;openssl(1)/Format Options&gt;.
+The format of the additional certificate file.
+This option has no effect and is retained for backward compatibility only.
 
-=item B&lt;-dkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-dkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The format of the additional private key; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt;.
 
 =item B&lt;-dpass&gt; I&lt;val&gt;
@@ -822,6 +824,12 @@ The -no_alt_chains option was added in OpenSSL 1.1.0.
 The
 -allow-no-dhe-kex and -prioritize_chacha options were added in OpenSSL 1.1.1.
 
+All B&lt;-keyform&gt; and B&lt;-dkeyform&gt; values except B&lt;ENGINE&gt;
+have become obsolete in OpenSSL 3.0.0 and have no effect.
+
+The B&lt;-certform&gt; and B&lt;-dcertform&gt; options have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-smime.pod.in b/doc/man1/openssl-smime.pod.in
index 13a0e4a47e..4dce01a46e 100644
--- a/doc/man1/openssl-smime.pod.in
+++ b/doc/man1/openssl-smime.pod.in
@@ -32,7 +32,7 @@ B&lt;openssl&gt; B&lt;smime&gt;
 [B&lt;-recip&gt; I&lt; file&gt;]
 [B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;SMIME&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;SMIME&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
 [B&lt;-inkey&gt; I&lt;file_or_id&gt;]
 [B&lt;-out&gt; I&lt;file&gt;]
@@ -50,7 +50,7 @@ B&lt;openssl&gt; B&lt;smime&gt;
 {- $OpenSSL::safe::opt_r_synopsis -}
 {- $OpenSSL::safe::opt_v_synopsis -}
 {- $OpenSSL::safe::opt_provider_synopsis -}
-I&lt;cert.pem&gt; ...
+I&lt;recipcert&gt; ...
 
 =for openssl ifdef engine
 
@@ -125,9 +125,10 @@ The output format of the PKCS#7 (S/MIME) structure (if one is being written);
 the default is B&lt;SMIME&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-stream&gt;, B&lt;-indef&gt;, B&lt;-noindef&gt;
@@ -235,7 +236,7 @@ option is present B&lt;CRLF&gt; is used instead.
 
 Allows additional certificates to be specified. When signing these will
 be included with the message. When verifying these will be searched for
-the signers certificates. The certificates should be in PEM format.
+the signers certificates.
 
 =item B&lt;-signer&gt; I&lt;file&gt;
 
@@ -291,7 +292,7 @@ Any verification errors cause the command to exit.
 
 {- $OpenSSL::safe::opt_provider_item -}
 
-=item I&lt;cert.pem&gt; ...
+=item I&lt;recipcert&gt; ...
 
 One or more certificates of message recipients, used when encrypting
 a message.
@@ -479,6 +480,9 @@ added in OpenSSL 1.0.0
 
 The -no_alt_chains option was added in OpenSSL 1.1.0.
 
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-spkac.pod.in b/doc/man1/openssl-spkac.pod.in
index 72e4788fd1..ca7d097d85 100644
--- a/doc/man1/openssl-spkac.pod.in
+++ b/doc/man1/openssl-spkac.pod.in
@@ -16,7 +16,7 @@ B&lt;openssl&gt; B&lt;spkac&gt;
 [B&lt;-in&gt; I&lt;filename&gt;]
 [B&lt;-out&gt; I&lt;filename&gt;]
 [B&lt;-key&gt; I&lt;keyfile&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-passin&gt; I&lt;arg&gt;]
 [B&lt;-challenge&gt; I&lt;string&gt;]
 [B&lt;-pubkey&gt;]
@@ -59,9 +59,10 @@ Create an SPKAC file using the private key in I&lt;keyfile&gt;. The
 B&lt;-in&gt;, B&lt;-noout&gt;, B&lt;-spksect&gt; and B&lt;-verify&gt; options are ignored if
 present.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-passin&gt; I&lt;arg&gt;
@@ -148,6 +149,11 @@ to be used in a &quot;replay attack&quot;.
 L&lt;openssl(1)&gt;,
 L&lt;openssl-ca(1)&gt;
 
+=head1 HISTORY
+
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
+and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl-verify.pod.in b/doc/man1/openssl-verify.pod.in
index e4e394faa6..7271efe833 100644
--- a/doc/man1/openssl-verify.pod.in
+++ b/doc/man1/openssl-verify.pod.in
@@ -99,7 +99,6 @@ with a B&lt;-&gt;.
 
 One or more certificates to verify. If no certificates are given,
 this command will attempt to read a certificate from standard input.
-Certificates must be in PEM format.
 If a certificate chain has multiple problems, this program tries to
 display all of them.
 
diff --git a/doc/man1/openssl-x509.pod.in b/doc/man1/openssl-x509.pod.in
index b8fd2a4041..918c91b34b 100644
--- a/doc/man1/openssl-x509.pod.in
+++ b/doc/man1/openssl-x509.pod.in
@@ -11,9 +11,9 @@ B&lt;openssl&gt; B&lt;x509&gt;
 [B&lt;-help&gt;]
 [B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
 [B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
-[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
-[B&lt;-CAform&gt; B&lt;DER&gt;|B&lt;PEM&gt;]
-[B&lt;-CAkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;]
+[B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
+[B&lt;-CAform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;]
+[B&lt;-CAkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;]
 [B&lt;-in&gt; I&lt;filename&gt;]
 [B&lt;-out&gt; I&lt;filename&gt;]
 [B&lt;-serial&gt;]
@@ -100,13 +100,18 @@ various sections.
 
 Print out a usage message.
 
-=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-inform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
 
-The input and formats; the default is B&lt;PEM&gt;.
+The CSR input format; the default is B&lt;PEM&gt;.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
-The input is normally an X.509 certificate, but this can change if other
-options such as B&lt;-req&gt; are used.
+The input is normally an X.509 certificate file of any format,
+but this can change if other options such as B&lt;-req&gt; are used.
+
+B&lt;-outform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+
+The output format; the default is B&lt;PEM&gt;.
+See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-in&gt; I&lt;filename&gt;
 
@@ -355,8 +360,7 @@ can thus behave like a &quot;mini CA&quot;.
 =item B&lt;-signkey&gt; I&lt;arg&gt;
 
 This option causes the input file to be self signed using the supplied
-private key or engine. The private key's format is specified with the
-B&lt;-keyform&gt; option.
+private key or engine.
 
 It sets the issuer name to the subject name (i.e., makes it self-issued)
 and changes the public key to the supplied value (unless overridden by
@@ -392,14 +396,21 @@ certificate is being created from another certificate (for example with
 the B&lt;-signkey&gt; or the B&lt;-CA&gt; options). Normally all extensions are
 retained.
 
-=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-keyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
 
 The key format; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
-=item B&lt;-CAform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-CAkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;ENGINE&gt;
+=item B&lt;-CAform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;,
+
+The format for the CA certificate.
+This option has no effect and is retained for backward compatibility.
 
-The format for the CA certificate and key; the default is B&lt;PEM&gt;.
+=item B&lt;-CAkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;|B&lt;ENGINE&gt;
+
+The format for the CA key; the default is B&lt;PEM&gt;.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
 See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-days&gt; I&lt;arg&gt;
@@ -502,8 +513,6 @@ self-signed, for instance when the key cannot be used for signing, such as DH.
 It can also be used in conjunction with b&lt;-new&gt; and B&lt;-subj&gt; to directly
 generate a certificate containing any desired public key.
 
-The format of the key file can be specified using the B&lt;-keyform&gt; option.
-
 =item B&lt;-subj&gt; I&lt;arg&gt;
 
 When a certificate is created set its subject name to the given value.
@@ -821,6 +830,11 @@ of the distinguished name. In OpenSSL 1.0.0 and later it is based on a canonical
 version of the DN using SHA1. This means that any directories using the old
 form must have their links rebuilt using L&lt;openssl-rehash(1)&gt; or similar.
 
+All B&lt;-keyform&gt; and B&lt;-CAkeyform&gt; values except B&lt;ENGINE&gt;
+have become obsolete in OpenSSL 3.0.0 and have no effect.
+
+The B&lt;-CAform&gt; option has become obsolete in OpenSSL 3.0.0 and has no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man1/openssl.pod b/doc/man1/openssl.pod
index 1cdcd8b8bb..7170a98448 100644
--- a/doc/man1/openssl.pod
+++ b/doc/man1/openssl.pod
@@ -525,7 +525,12 @@ parameters start with a minus sign:
 =head2 Format Options
 
 Several OpenSSL commands can take input or generate output in a variety
-of formats. The list of acceptable formats, and the default, is
+of formats.
+Since OpenSSL 3.0 keys, single certificates, and CRLs can be read from
+files in any of the B&lt;DER&gt;, B&lt;PEM&gt;, or B&lt;P12&gt; formats,
+while specifying their input format is no more needed.
+
+The list of acceptable formats, and the default, is
 described in each command documentation.  The list of formats is
 described below. Both uppercase and lowercase are accepted.
 
@@ -618,6 +623,8 @@ The format of the input or output streams.
 =item B&lt;-keyform&gt; I&lt;format&gt;
 
 Format of a private key input source.
+The only value with effect is B&lt;ENGINE&gt;; all others have become obsolete.
+See L&lt;openssl(1)/Format Options&gt; for details.
 
 =item B&lt;-CRLform&gt; I&lt;format&gt;
 
@@ -789,12 +796,6 @@ OpenSSL command to generate an alternative chain.
 
 =over 4
 
-=item B&lt;-xchain_build&gt;
-
-Specify whether the application should build the certificate chain to be
-provided to the server for the extra certificates via the B&lt;-xkey&gt;,
-B&lt;-xcert&gt;, and B&lt;-xchain&gt; options.
-
 =item B&lt;-xkey&gt; I&lt;infile&gt;, B&lt;-xcert&gt; I&lt;infile&gt;, B&lt;-xchain&gt;
 
 Specify an extra certificate, private key and certificate chain. These behave
@@ -802,21 +803,21 @@ in the same manner as the B&lt;-cert&gt;, B&lt;-key&gt; and B&lt;-cert_chain&gt; options.  When
 specified, the callback returning the first valid chain will be in use by the
 client.
 
-=item B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
-
-The input format for the extra certificate and key, respectively.
-See L&lt;openssl(1)/Format Options&gt; for details.
-
 =item B&lt;-xchain_build&gt;
 
 Specify whether the application should build the certificate chain to be
 provided to the server for the extra certificates via the B&lt;-xkey&gt;,
 B&lt;-xcert&gt;, and B&lt;-xchain&gt; options.
 
-=item B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;, B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;
+=item B&lt;-xcertform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
 
-The input format for the extra certificate and key, respectively.
-See L&lt;openssl(1)/Format Options&gt; for details.
+The input format for the extra certificate.
+This option has no effect and is retained for backward compatibility only.
+
+=item B&lt;-xkeyform&gt; B&lt;DER&gt;|B&lt;PEM&gt;|B&lt;P12&gt;
+
+The input format for the extra key.
+This option has no effect and is retained for backward compatibility only.
 
 =back
 
@@ -1403,6 +1404,9 @@ manual pages.
 The B&lt;-issuer_checks&gt; option is deprecated as of OpenSSL 1.1.0 and
 is silently ignored.
 
+The B&lt;-xcertform&gt; and B&lt;-xkeyform&gt; options
+are obsolete since OpenSSL 3.0.0 and have no effect.
+
 =head1 COPYRIGHT
 
 Copyright 2000-2020 The OpenSSL Project Authors. All Rights Reserved.
diff --git a/doc/man3/EVP_PKEY_fromdata.pod b/doc/man3/EVP_PKEY_fromdata.pod
index 71ba642180..526109386e 100644
--- a/doc/man3/EVP_PKEY_fromdata.pod
+++ b/doc/man3/EVP_PKEY_fromdata.pod
@@ -103,7 +103,7 @@ TODO Write a set of cookbook documents and link to them.
      OSSL_PARAM_ulong(&quot;d&quot;, &amp;rsa_d),
      OSSL_PARAM_END
  };
-     
+
  int main()
  {
      EVP_PKEY_CTX *ctx = EVP_PKEY_CTX_new_from_name(NULL, &quot;RSA&quot;, NULL);
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028779.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="028781.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28780">[ date ]</a>
              <a href="thread.html#28780">[ thread ]</a>
              <a href="subject.html#28780">[ subject ]</a>
              <a href="author.html#28780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
