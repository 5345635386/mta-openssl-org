<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl/openssl] fea151: Obtain PSS salt length from provider
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2022-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl/openssl%5D%20fea151%3A%20Obtain%20PSS%20salt%20length%20from%20provider&In-Reply-To=%3Copenssl/openssl/push/refs/heads/openssl-3.1/3956fc-db2fc0%40github.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037987.html">
   <LINK REL="Next"  HREF="037990.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl/openssl] fea151: Obtain PSS salt length from provider</H1>
    <B>Clemens Lang</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl/openssl%5D%20fea151%3A%20Obtain%20PSS%20salt%20length%20from%20provider&In-Reply-To=%3Copenssl/openssl/push/refs/heads/openssl-3.1/3956fc-db2fc0%40github.com%3E"
       TITLE="[openssl/openssl] fea151: Obtain PSS salt length from provider">noreply at github.com
       </A><BR>
    <I>Fri Dec  9 15:37:01 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="037987.html">[openssl/openssl] a09f6a: Fuzz checker CI: Use more generic include dir for ...
</A></li>
        <LI>Next message (by thread): <A HREF="037990.html">[openssl/openssl] 17bd38: Obtain PSS salt length from provider
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37989">[ date ]</a>
              <a href="thread.html#37989">[ thread ]</a>
              <a href="subject.html#37989">[ subject ]</a>
              <a href="author.html#37989">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  Branch: refs/heads/openssl-3.1
  Home:   <A HREF="https://github.com/openssl/openssl">https://github.com/openssl/openssl</A>
  Commit: fea151a24de59f546e6d485f352c309953f38e1d
      <A HREF="https://github.com/openssl/openssl/commit/fea151a24de59f546e6d485f352c309953f38e1d">https://github.com/openssl/openssl/commit/fea151a24de59f546e6d485f352c309953f38e1d</A>
  Author: Clemens Lang &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">cllang at redhat.com</A>&gt;
  Date:   2022-12-09 (Fri, 09 Dec 2022)

  Changed paths:
    M crypto/cms/cms_rsa.c
    M crypto/rsa/rsa_ameth.c
    M test/recipes/15-test_rsapss.t
    M test/recipes/80-test_cms.t

  Log Message:
  -----------
  Obtain PSS salt length from provider

Rather than computing the PSS salt length again in core using
ossl_rsa_ctx_to_pss_string, which calls rsa_ctx_to_pss and computes the
salt length, obtain it from the provider using the
OSSL_SIGNATURE_PARAM_ALGORITHM_ID param to handle the case where the
interpretation of the magic constants in the provider differs from that
of OpenSSL core.

Add tests that verify that the rsa_pss_saltlen:max,
rsa_pss_saltlen:&lt;integer&gt; and rsa_pss_saltlen:digest options work and
put the computed digest length into the CMS_ContentInfo struct when
using CMS. Do not add a test for the salt length generated by a provider
when no specific rsa_pss_saltlen option is defined, since that number
could change between providers and provider versions, and we want to
preserve compatibility with older providers.

Signed-off-by: Clemens Lang &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">cllang at redhat.com</A>&gt;

Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;

(cherry picked from commit 5a3bbe1712435d577bbc5ec046906979e8471d8b)

(Merged from <A HREF="https://github.com/openssl/openssl/pull/19862">https://github.com/openssl/openssl/pull/19862</A>)


  Commit: db2fc00945bd128b873d9f66944dfde49f8a3853
      <A HREF="https://github.com/openssl/openssl/commit/db2fc00945bd128b873d9f66944dfde49f8a3853">https://github.com/openssl/openssl/commit/db2fc00945bd128b873d9f66944dfde49f8a3853</A>
  Author: Clemens Lang &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">cllang at redhat.com</A>&gt;
  Date:   2022-12-09 (Fri, 09 Dec 2022)

  Changed paths:
    M CHANGES.md
    M crypto/rsa/rsa_ameth.c
    M crypto/rsa/rsa_pss.c
    M doc/man3/EVP_PKEY_CTX_ctrl.pod
    M doc/man7/EVP_SIGNATURE-RSA.pod
    M include/openssl/core_names.h
    M include/openssl/rsa.h
    M providers/implementations/signature/rsa_sig.c
    M test/recipes/15-test_rsapss.t
    M test/recipes/25-test_req.t
    M test/recipes/80-test_cms.t
    M test/smime-certs/mksmime-certs.sh
    A test/smime-certs/smrsa1024.pem

  Log Message:
  -----------
  signature: Clamp PSS salt len to MD len

FIPS 186-4 section 5 &quot;The RSA Digital Signature Algorithm&quot;, subsection
5.5 &quot;PKCS #1&quot; says: &quot;For RSASSA-PSS [&#8230;] the length (in bytes) of the
salt (sLen) shall satisfy 0 &lt;= sLen &lt;= hLen, where hLen is the length of
the hash function output block (in bytes).&quot;

Introduce a new option RSA_PSS_SALTLEN_AUTO_DIGEST_MAX and make it the
default. The new value will behave like RSA_PSS_SALTLEN_AUTO, but will
not use more than the digest length when signing, so that FIPS 186-4 is
not violated. This value has two advantages when compared with
RSA_PSS_SALTLEN_DIGEST: (1) It will continue to do auto-detection when
verifying signatures for maximum compatibility, where
RSA_PSS_SALTLEN_DIGEST would fail for other digest sizes. (2) It will
work for combinations where the maximum salt length is smaller than the
digest size, which typically happens with large digest sizes (e.g.,
SHA-512) and small RSA keys.

J.-S. Coron shows in &quot;Optimal Security Proofs for PSS and Other
Signature Schemes. Advances in Cryptology &#8211; Eurocrypt 2002, volume 2332
of Lecture Notes in Computer Science, pp. 272 &#8211; 287. Springer Verlag,
2002.&quot; that longer salts than the output size of modern hash functions
do not increase security: &quot;For example,for an application in which at
most one billion signatures will be generated, k0 = 30 bits of random
salt are actually sufficient to guarantee the same level of security as
RSA, and taking a larger salt does not increase the security level.&quot;

Signed-off-by: Clemens Lang &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">cllang at redhat.com</A>&gt;

Reviewed-by: Dmitry Belyavskiy &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">beldmit at gmail.com</A>&gt;
Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tomas at openssl.org</A>&gt;

(cherry picked from commit 6c73ca4a2f4ea71f4a880670624e7b2fdb6f32da)

(Merged from <A HREF="https://github.com/openssl/openssl/pull/19862">https://github.com/openssl/openssl/pull/19862</A>)


Compare: <A HREF="https://github.com/openssl/openssl/compare/3956fc91afc9...db2fc00945bd">https://github.com/openssl/openssl/compare/3956fc91afc9...db2fc00945bd</A>
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="037987.html">[openssl/openssl] a09f6a: Fuzz checker CI: Use more generic include dir for ...
</A></li>
	<LI>Next message (by thread): <A HREF="037990.html">[openssl/openssl] 17bd38: Obtain PSS salt length from provider
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37989">[ date ]</a>
              <a href="thread.html#37989">[ thread ]</a>
              <a href="subject.html#37989">[ subject ]</a>
              <a href="author.html#37989">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
