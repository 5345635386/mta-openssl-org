<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-October/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1444758543.443396.26403.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002004.html">
   <LINK REL="Next"  HREF="002006.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Andy Polyakov</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1444758543.443396.26403.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">appro at openssl.org
       </A><BR>
    <I>Tue Oct 13 17:49:03 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002004.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="002006.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2005">[ date ]</a>
              <a href="thread.html#2005">[ thread ]</a>
              <a href="subject.html#2005">[ subject ]</a>
              <a href="author.html#2005">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  2d2a83543f757cf3a48a1a0e412aee183a6d539b (commit)
       via  82987e6119403661c45f781a8b6748941c15ade6 (commit)
       via  85833408b4fb6e109cb05bf8dbe9cdb6bd8f280d (commit)
       via  4ada8be2a6c538ee66a9a35a182052f359fc94b3 (commit)
      from  1dce6c3f9eef0da2866b82d816dc945883427060 (commit)


- Log -----------------------------------------------------------------
commit 2d2a83543f757cf3a48a1a0e412aee183a6d539b
Author: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
Date:   Mon Oct 12 22:31:20 2015 +0200

    testlib/OpenSSL/Test.pm: remove redundant 'cmd /c', MSWin32 Perl can take care of itself.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 82987e6119403661c45f781a8b6748941c15ade6
Author: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
Date:   Mon Oct 12 22:26:14 2015 +0200

    Harmonize do_rehash_rule with updated test/recipies/25-test_verify.t.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 85833408b4fb6e109cb05bf8dbe9cdb6bd8f280d
Author: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
Date:   Mon Oct 12 22:24:27 2015 +0200

    Test suite: chomp-&gt;s/\R// to harmonize with mingw 'make test'.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 4ada8be2a6c538ee66a9a35a182052f359fc94b3
Author: Andy Polyakov &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;
Date:   Mon Oct 12 22:16:07 2015 +0200

    Test suite: minimal required to get mingw 'make test' work under Linux.
    
    (part by Alessandro Ghedini)
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 test/recipes/00-check_testexes.t      |  6 +++---
 test/recipes/10-test_bn.t             |  2 +-
 test/recipes/20-test_enc.t            |  2 +-
 test/recipes/25-test_req.t            |  2 +-
 test/recipes/25-test_verify.t         |  3 +++
 test/recipes/70-test_sslextension.t   |  2 +-
 test/recipes/70-test_sslsessiontick.t |  2 +-
 test/recipes/70-test_sslskewith0p.t   |  2 +-
 test/recipes/70-test_sslvertol.t      |  2 +-
 test/recipes/80-test_ssl.t            |  2 +-
 test/recipes/tconversion.pl           | 12 ++++++++++--
 test/testlib/OpenSSL/Test.pm          | 14 ++++++++++----
 test/testlib/OpenSSL/Test/Utils.pm    |  2 +-
 util/mk1mf.pl                         |  4 ++--
 util/pl/VC-32.pl                      |  1 +
 util/pl/unix.pl                       |  3 ++-
 util/shlib_wrap.sh                    |  2 +-
 17 files changed, 41 insertions(+), 22 deletions(-)

diff --git a/test/recipes/00-check_testexes.t b/test/recipes/00-check_testexes.t
index 3ab38c7..c086f7f 100644
--- a/test/recipes/00-check_testexes.t
+++ b/test/recipes/00-check_testexes.t
@@ -12,7 +12,7 @@ my $OpenSSL_ver = &quot;&quot;;
 my $Makefile = top_file(&quot;Makefile&quot;);
 if (open(FH, $Makefile)) {
     $OpenSSL_ver =
-	(map { chomp; s/^VERSION=([^\s]*)\s*$//; $1 } grep { /^VERSION=/ } &lt;FH&gt;)[0];
+	(map { s/\R//; s/^VERSION=([^\s]*)\s*$//; $1 } grep { /^VERSION=/ } &lt;FH&gt;)[0];
     close FH;
 }
 
@@ -24,14 +24,14 @@ plan skip_all =&gt; &quot;because MINFO not found. If you want this test to run, please
 my $MINFO_ver = &quot;&quot;;
 
 while(&lt;FH&gt;) {
-    chomp;
+    s/\R//;	# chomp;
     if (/^VERSION=([^\s]*)\s*$/) {
 	$MINFO_ver = $1;
     }
     last if /^RELATIVE_DIRECTORY=test$/;
 }
 while(&lt;FH&gt;) {
-    chomp;
+    s/\R//;	# chomp;
     last if /^EXE=/;
 }
 close FH;
diff --git a/test/recipes/10-test_bn.t b/test/recipes/10-test_bn.t
index 29b449f..a01d9bf 100644
--- a/test/recipes/10-test_bn.t
+++ b/test/recipes/10-test_bn.t
@@ -25,7 +25,7 @@ my $init = ok(run(test([&quot;bntest&quot;], stdout =&gt; $testresults)), 'initialize');
 	     @lines = &lt;DATA&gt;;
 	     close DATA;
 	 }
-	 chomp(@lines);
+	 map { s/\R//; } @lines;	# chomp(@lines);
 
 	 plan tests =&gt; scalar grep(/^print /, @lines);
 
diff --git a/test/recipes/20-test_enc.t b/test/recipes/20-test_enc.t
index bd5a436..836d979 100644
--- a/test/recipes/20-test_enc.t
+++ b/test/recipes/20-test_enc.t
@@ -21,7 +21,7 @@ my $test = catfile(&quot;.&quot;, &quot;p&quot;);
 my $cmd = &quot;openssl&quot;;
 
 my @ciphers =
-    map { chomp; s/^\s+//; s/\s+$//; split /\s+/ }
+    map { s/^\s+//; s/\s+$//; split /\s+/ }
     run(app([$cmd, &quot;list&quot;, &quot;-cipher-commands&quot;]), capture =&gt; 1);
 
 plan tests =&gt; 1 + (scalar @ciphers)*2;
diff --git a/test/recipes/25-test_req.t b/test/recipes/25-test_req.t
index 4f9de77..ce1f869 100644
--- a/test/recipes/25-test_req.t
+++ b/test/recipes/25-test_req.t
@@ -31,7 +31,7 @@ sub run_conversion {
 	open DATA, &quot;req-check.err&quot;;
       SKIP: {
 	  plan skip_all =&gt; &quot;skipping req conversion test for $reqfile&quot;
-	      if grep /Unknown Public Key/, map { chomp } &lt;DATA&gt;;
+	      if grep /Unknown Public Key/, map { s/\R//; } &lt;DATA&gt;;
 
 	  tconversion(&quot;req&quot;, &quot;testreq.pem&quot;, @openssl_args);
 	}
diff --git a/test/recipes/25-test_verify.t b/test/recipes/25-test_verify.t
index 10897a1..7c0f091 100644
--- a/test/recipes/25-test_verify.t
+++ b/test/recipes/25-test_verify.t
@@ -8,6 +8,9 @@ use OpenSSL::Test qw/:DEFAULT top_dir top_file/;
 
 setup(&quot;test_verify&quot;);
 
+plan skip_all =&gt; &quot;no rehash.time was found.&quot;
+    unless (-f top_file(&quot;rehash.time&quot;));
+
 plan tests =&gt; 1;
 
 note(&quot;Expect some failures and expired certificate&quot;);
diff --git a/test/recipes/70-test_sslextension.t b/test/recipes/70-test_sslextension.t
index 4aa3f61..bd99b19 100755
--- a/test/recipes/70-test_sslextension.t
+++ b/test/recipes/70-test_sslextension.t
@@ -60,7 +60,7 @@ my $test_name = &quot;test_sslextension&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;$test_name can only be performed with OpenSSL configured shared&quot;
-    unless (map { chomp; s/^SHARED_LIBS=\s*//; $_ }
+    unless (map { s/\R//; s/^SHARED_LIBS=\s*//; $_ }
 	    grep { /^SHARED_LIBS=/ }
 	    do { local @ARGV = ( top_file(&quot;Makefile&quot;) ); &lt;&gt; })[0] ne &quot;&quot;;
 
diff --git a/test/recipes/70-test_sslsessiontick.t b/test/recipes/70-test_sslsessiontick.t
index a7a450a..9209fd7 100755
--- a/test/recipes/70-test_sslsessiontick.t
+++ b/test/recipes/70-test_sslsessiontick.t
@@ -61,7 +61,7 @@ my $test_name = &quot;test_sslsessiontick&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;$test_name can only be performed with OpenSSL configured shared&quot;
-    unless (map { chomp; s/^SHARED_LIBS=\s*//; $_ }
+    unless (map { s/\R//; s/^SHARED_LIBS=\s*//; $_ }
 	    grep { /^SHARED_LIBS=/ }
 	    do { local @ARGV = ( top_file(&quot;Makefile&quot;) ); &lt;&gt; })[0] ne &quot;&quot;;
 
diff --git a/test/recipes/70-test_sslskewith0p.t b/test/recipes/70-test_sslskewith0p.t
index d8d74b3..3f5e131 100755
--- a/test/recipes/70-test_sslskewith0p.t
+++ b/test/recipes/70-test_sslskewith0p.t
@@ -60,7 +60,7 @@ my $test_name = &quot;test_sslskewith0p&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;$test_name can only be performed with OpenSSL configured shared&quot;
-    unless (map { chomp; s/^SHARED_LIBS=\s*//; $_ }
+    unless (map { s/\R//; s/^SHARED_LIBS=\s*//; $_ }
 	    grep { /^SHARED_LIBS=/ }
 	    do { local @ARGV = ( top_file(&quot;Makefile&quot;) ); &lt;&gt; })[0] ne &quot;&quot;;
 
diff --git a/test/recipes/70-test_sslvertol.t b/test/recipes/70-test_sslvertol.t
index 9717f80..78c6410 100755
--- a/test/recipes/70-test_sslvertol.t
+++ b/test/recipes/70-test_sslvertol.t
@@ -60,7 +60,7 @@ my $test_name = &quot;test_sslextension&quot;;
 setup($test_name);
 
 plan skip_all =&gt; &quot;$test_name can only be performed with OpenSSL configured shared&quot;
-    unless (map { chomp; s/^SHARED_LIBS=\s*//; $_ }
+    unless (map { s/\R//; s/^SHARED_LIBS=\s*//; $_ }
 	    grep { /^SHARED_LIBS=/ }
 	    do { local @ARGV = ( top_file(&quot;Makefile&quot;) ); &lt;&gt; })[0] ne &quot;&quot;;
 
diff --git a/test/recipes/80-test_ssl.t b/test/recipes/80-test_ssl.t
index 6e5e22e..5f520de 100644
--- a/test/recipes/80-test_ssl.t
+++ b/test/recipes/80-test_ssl.t
@@ -414,7 +414,7 @@ sub testssl {
 		      map { split(/:/, $_) }
 		      run(app([&quot;openssl&quot;, &quot;ciphers&quot;, &quot;${_}:$ciphers&quot;]),
                           capture =&gt; 1);
-		  chomp @c;
+		  map { s/\R//; } @c;  # chomp @c;
 		  $protocolciphersuitcount += scalar @c;
 		  $_ =&gt; [ @c ] } @protocols;
 
diff --git a/test/recipes/tconversion.pl b/test/recipes/tconversion.pl
index 011dcbf..07e3406 100644
--- a/test/recipes/tconversion.pl
+++ b/test/recipes/tconversion.pl
@@ -68,14 +68,14 @@ sub tconversion {
       }
 
       if ($testtype ne &quot;p7d&quot;) {
-	  is(compare_text(&quot;$testtype-fff.p&quot;, &quot;$testtype-f.p&quot;), 0,
+	  is(cmp_text(&quot;$testtype-fff.p&quot;, &quot;$testtype-f.p&quot;), 0,
 	     'comparing orig to p');
       }
 
       foreach my $to (@conversionforms) {
 	  next if $to eq &quot;d&quot;;
 	  foreach my $from (@conversionforms) {
-	      is(compare_text(&quot;$testtype-f.$to&quot;, &quot;$testtype-ff.$from$to&quot;), 0,
+	      is(cmp_text(&quot;$testtype-f.$to&quot;, &quot;$testtype-ff.$from$to&quot;), 0,
 		 &quot;comparing $to to $from$to&quot;);
 	  }
       }
@@ -85,4 +85,12 @@ sub tconversion {
     unlink glob &quot;$testtype-fff.*&quot;;
 }
 
+sub cmp_text {
+    return compare_text(@_, sub {
+        $_[0] =~ s/\R//g;
+        $_[1] =~ s/\R//g;
+        return $_[0] ne $_[1];
+    });
+}
+
 1;
diff --git a/test/testlib/OpenSSL/Test.pm b/test/testlib/OpenSSL/Test.pm
index c64d68d..06accb5 100644
--- a/test/testlib/OpenSSL/Test.pm
+++ b/test/testlib/OpenSSL/Test.pm
@@ -284,8 +284,6 @@ sub run {
     my $prefix = &quot;&quot;;
     if ( $^O eq &quot;VMS&quot; ) {	# VMS
 	$prefix = &quot;pipe &quot;;
-    } elsif ($^O eq &quot;MSWin32&quot;) { # MSYS
-	$prefix = &quot;cmd /c &quot;;
     }
 
     my @r = ();
@@ -357,7 +355,7 @@ operating system.
 =cut
 
 sub top_dir {
-    return __top_file(@_, &quot;&quot;);	# This caters for operating systems that have
+    return __top_dir(@_);	# This caters for operating systems that have
 				# a very distinct syntax for directories.
 }
 
@@ -577,6 +575,12 @@ sub __top_file {
     return catfile($directories{TOP}<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,$f);
 }
 
+sub __top_dir {
+    BAIL_OUT(&quot;Must run setup() first&quot;) if (! $test_name);
+
+    return catdir($directories{TOP}<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>);
+}
+
 sub __test_file {
     BAIL_OUT(&quot;Must run setup() first&quot;) if (! $test_name);
 
@@ -668,7 +672,9 @@ sub __fixup_cmd {
     my $prefix = __top_file(&quot;util&quot;, &quot;shlib_wrap.sh&quot;).&quot; &quot;;
     my $ext = $ENV{&quot;EXE_EXT&quot;} || &quot;&quot;;
 
-    if ( $^O eq &quot;VMS&quot; ) {	# VMS
+    if (defined($ENV{EXE_SHELL})) {
+	$prefix = &quot;$ENV{EXE_SHELL} &quot;;
+    } elsif ($^O eq &quot;VMS&quot; ) {	# VMS
 	$prefix = &quot;mcr &quot;;
 	$ext = &quot;.exe&quot;;
     } elsif ($^O eq &quot;MSWin32&quot;) { # Windows
diff --git a/test/testlib/OpenSSL/Test/Utils.pm b/test/testlib/OpenSSL/Test/Utils.pm
index fc9b533..5312c20 100644
--- a/test/testlib/OpenSSL/Test/Utils.pm
+++ b/test/testlib/OpenSSL/Test/Utils.pm
@@ -46,7 +46,7 @@ my $disabled_set = 0;
 sub check_disabled {
 #print STDERR &quot;Running check_disabled\n&quot;;
     foreach (run(app([&quot;openssl&quot;, &quot;list&quot;, &quot;-disabled&quot;]), capture =&gt; 1)) {
-        chomp;
+        s/\R//;         # chomp;
         next if /:/;    # skip header
         $disabled{lc $_} = 1;
     }
diff --git a/util/mk1mf.pl b/util/mk1mf.pl
index 9d8a47d..491a1bb 100755
--- a/util/mk1mf.pl
+++ b/util/mk1mf.pl
@@ -779,8 +779,8 @@ reallyclean:
 
 EOF
 
-$rules .= &amp;do_rehash_rule(&quot;rehash&quot;, &quot;certs apps&quot;);
-$rules .= &amp;do_test_rule(&quot;test&quot;, &quot;rehash&quot;, &quot;run_tests.pl&quot;);
+$rules .= &amp;do_rehash_rule(&quot;rehash.time&quot;, &quot;certs apps&quot;);
+$rules .= &amp;do_test_rule(&quot;test&quot;, &quot;rehash.time&quot;, &quot;run_tests.pl&quot;);
 
 my $platform_cpp_symbol = &quot;MK1MF_PLATFORM_$platform&quot;;
 $platform_cpp_symbol =~ s/-/_/g;
diff --git a/util/pl/VC-32.pl b/util/pl/VC-32.pl
index a2d35c6..8cb4835 100644
--- a/util/pl/VC-32.pl
+++ b/util/pl/VC-32.pl
@@ -307,6 +307,7 @@ $target: $deps
 	set OPENSSL=\$(BIN_D)${o}openssl.exe
 	set OPENSSL_DEBUG_MEMORY=on
 	\$(PERL) tools/c_rehash certs/demo
+	echo off &gt; $target
 EOF
     return $ret
 }
diff --git a/util/pl/unix.pl b/util/pl/unix.pl
index 528d4d0..c1fa1ff 100644
--- a/util/pl/unix.pl
+++ b/util/pl/unix.pl
@@ -193,7 +193,8 @@ $target: $deps
 	(OPENSSL=&quot;`pwd`/util/opensslwrap.sh&quot;; \\
 	OPENSSL_DEBUG_MEMORY=on; \\
 	export OPENSSL OPENSSL_DEBUG_MEMORY; \\
-	\$(PERL) tools/c_rehash certs/demo)
+	\$(PERL) tools/c_rehash certs/demo; \\
+	touch $target)
 EOF
     return $ret
 }
diff --git a/util/shlib_wrap.sh b/util/shlib_wrap.sh
index 8775cb5..646b0fe 100755
--- a/util/shlib_wrap.sh
+++ b/util/shlib_wrap.sh
@@ -88,7 +88,7 @@ if [ -f &quot;$LIBCRYPTOSO&quot; -a -z &quot;$preload_var&quot; ]; then
 	export LD_PRELOAD _RLD_LIST DYLD_INSERT_LIBRARIES
 fi
 
-cmd=&quot;$1${EXE_EXT}&quot;
+cmd=&quot;$1&quot;; [ -x &quot;$cmd&quot; ] || cmd=&quot;$cmd${EXE_EXT}&quot;
 shift
 if [ $# -eq 0 ]; then
 	exec &quot;$cmd&quot;	# old sh, such as Tru64 4.x, fails to expand empty &quot;$@&quot;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002004.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="002006.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2005">[ date ]</a>
              <a href="thread.html#2005">[ thread ]</a>
              <a href="subject.html#2005">[ subject ]</a>
              <a href="author.html#2005">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
