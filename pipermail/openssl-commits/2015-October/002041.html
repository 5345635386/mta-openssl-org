<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-October/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1445622834.037453.6147.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002040.html">
   <LINK REL="Next"  HREF="002044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1445622834.037453.6147.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Fri Oct 23 17:53:54 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002040.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="002044.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2041">[ date ]</a>
              <a href="thread.html#2041">[ thread ]</a>
              <a href="subject.html#2041">[ subject ]</a>
              <a href="author.html#2041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  070c23325af4526c9a8532a60d63522c58d5554b (commit)
       via  8cf9d71a3a43d9b98a8a278d47dc08088a954a7b (commit)
       via  3240e7cf5f651d9d94814b4d494fbe294e463b72 (commit)
       via  d900a015b5a89ea2018e6122dd2738925e4d68ab (commit)
       via  c2319cf9fce87a2e82efb6e58ced11a85190dc3d (commit)
       via  3f6c7691870d1cd2ad0e0c83638cef3f35a0b548 (commit)
       via  8acaabec429b39f9436f6a88006384d72d292539 (commit)
       via  4428c7dba8f6f407d915c1226f4e0f673e8be241 (commit)
      from  dad0b512e649336440e2b3cc9d667c56d9a91eff (commit)


- Log -----------------------------------------------------------------
commit 070c23325af4526c9a8532a60d63522c58d5554b
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 22:00:27 2015 +0200

    Remove useless code
    
    RT#4081
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 8cf9d71a3a43d9b98a8a278d47dc08088a954a7b
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 14:50:27 2015 +0200

    Check memory allocation
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 3240e7cf5f651d9d94814b4d494fbe294e463b72
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 14:41:09 2015 +0200

    Fix references to various RFCs
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit d900a015b5a89ea2018e6122dd2738925e4d68ab
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 14:40:42 2015 +0200

    Fix typos
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit c2319cf9fce87a2e82efb6e58ced11a85190dc3d
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 14:39:58 2015 +0200

    Set salt length after the malloc has succeeded
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 3f6c7691870d1cd2ad0e0c83638cef3f35a0b548
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 14:38:57 2015 +0200

    Fix memory leaks and other mistakes on errors
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 8acaabec429b39f9436f6a88006384d72d292539
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Thu Oct 8 14:37:21 2015 +0200

    Replace malloc+strlcpy with strdup
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 4428c7dba8f6f407d915c1226f4e0f673e8be241
Author: Alessandro Ghedini &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">alessandro at ghedini.me</A>&gt;
Date:   Fri Oct 2 15:16:08 2015 +0200

    Do not treat 0 return value from BIO_get_fd() as error
    
    0 is a valid file descriptor.
    
    RT#4068
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 apps/apps.c                             |  3 --
 apps/ca.c                               | 12 ++----
 apps/ecparam.c                          |  2 -
 apps/engine.c                           |  5 ---
 apps/gendsa.c                           |  2 -
 apps/ocsp.c                             |  2 +-
 crypto/aes/asm/aesni-x86.pl             |  2 +-
 crypto/bio/b_dump.c                     |  1 -
 crypto/bn/asm/ia64.S                    |  2 +-
 crypto/bn/bn_gf2m.c                     |  2 +-
 crypto/bn/bn_recp.c                     |  4 +-
 crypto/bn/bn_x931p.c                    |  7 +++-
 crypto/conf/conf_def.c                  |  3 +-
 crypto/dsa/dsa_gen.c                    | 18 +++------
 crypto/evp/e_aes_cbc_hmac_sha256.c      |  2 -
 crypto/evp/e_dsa.c                      | 69 ---------------------------------
 crypto/evp/evp_key.c                    |  4 +-
 crypto/evp/evp_pbe.c                    | 15 +++++--
 crypto/hmac/hm_ameth.c                  |  9 ++++-
 crypto/ocsp/ocsp_lib.c                  |  6 ---
 crypto/ocsp/ocsp_prn.c                  |  1 -
 crypto/pem/pvkfmt.c                     | 10 ++---
 crypto/pkcs12/p12_add.c                 | 27 +++++++++----
 crypto/pkcs12/p12_mutl.c                |  2 +-
 crypto/pkcs7/pk7_doit.c                 |  1 -
 crypto/sha/asm/sha1-s390x.pl            |  2 +-
 crypto/sha/asm/sha512-parisc.pl         |  2 +-
 crypto/x509/t_crl.c                     |  1 -
 crypto/x509/x509_lu.c                   |  2 -
 demos/engines/zencod/hw_zencod.c        |  2 +-
 doc/crypto/BIO_read.pod                 |  6 +--
 doc/crypto/BN_rand.pod                  |  2 +-
 doc/crypto/EC_GROUP_copy.pod            |  2 +-
 doc/crypto/EC_KEY_new.pod               |  2 +-
 doc/crypto/X509_get_extension_flags.pod |  2 +-
 doc/crypto/d2i_X509_NAME.pod            |  2 +-
 include/openssl/tls1.h                  | 37 ++++++------------
 ssl/s3_clnt.c                           |  2 +-
 ssl/s3_srvr.c                           |  1 -
 ssl/t1_lib.c                            |  1 -
 test/evp_test.c                         |  2 +-
 41 files changed, 91 insertions(+), 188 deletions(-)
 delete mode 100644 crypto/evp/e_dsa.c

diff --git a/apps/apps.c b/apps/apps.c
index 39ca963..c519ae6 100644
--- a/apps/apps.c
+++ b/apps/apps.c
@@ -118,9 +118,6 @@
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
-#if !defined(OPENSSL_SYS_WIN32) &amp;&amp; !defined(OPENSSL_SYS_WINCE) &amp;&amp; !defined(NETWARE_CLIB)
-# include &lt;strings.h&gt;
-#endif
 #ifndef NO_SYS_TYPES_H
 # include &lt;sys/types.h&gt;
 #endif
diff --git a/apps/ca.c b/apps/ca.c
index 586fbe4..691f4e7 100644
--- a/apps/ca.c
+++ b/apps/ca.c
@@ -98,24 +98,18 @@
 #undef BSIZE
 #define BSIZE 256
 
-#define BASE_SECTION    &quot;ca&quot;
+#define BASE_SECTION            &quot;ca&quot;
 
 #define ENV_DEFAULT_CA          &quot;default_ca&quot;
 
-#define STRING_MASK     &quot;string_mask&quot;
+#define STRING_MASK             &quot;string_mask&quot;
 #define UTF8_IN                 &quot;utf8&quot;
 
-#define ENV_DIR                 &quot;dir&quot;
-#define ENV_CERTS               &quot;certs&quot;
-#define ENV_CRL_DIR             &quot;crl_dir&quot;
-#define ENV_CA_DB               &quot;CA_DB&quot;
 #define ENV_NEW_CERTS_DIR       &quot;new_certs_dir&quot;
-#define ENV_CERTIFICATE &quot;certificate&quot;
+#define ENV_CERTIFICATE         &quot;certificate&quot;
 #define ENV_SERIAL              &quot;serial&quot;
 #define ENV_CRLNUMBER           &quot;crlnumber&quot;
-#define ENV_CRL                 &quot;crl&quot;
 #define ENV_PRIVATE_KEY         &quot;private_key&quot;
-#define ENV_RANDFILE            &quot;RANDFILE&quot;
 #define ENV_DEFAULT_DAYS        &quot;default_days&quot;
 #define ENV_DEFAULT_STARTDATE   &quot;default_startdate&quot;
 #define ENV_DEFAULT_ENDDATE     &quot;default_enddate&quot;
diff --git a/apps/ecparam.c b/apps/ecparam.c
index 9d13447..122125e 100644
--- a/apps/ecparam.c
+++ b/apps/ecparam.c
@@ -317,8 +317,6 @@ int ecparam_main(int argc, char **argv)
     }
 
     if (check) {
-        if (group == NULL)
-            BIO_printf(bio_err, &quot;no elliptic curve parameters\n&quot;);
         BIO_printf(bio_err, &quot;checking elliptic curve parameters: &quot;);
         if (!EC_GROUP_check(group, NULL)) {
             BIO_printf(bio_err, &quot;failed\n&quot;);
diff --git a/apps/engine.c b/apps/engine.c
index b4da23e..17e6f78 100644
--- a/apps/engine.c
+++ b/apps/engine.c
@@ -94,17 +94,12 @@ static void identity(char *ptr)
 
 static int append_buf(char **buf, const char *s, int *size, int step)
 {
-    int l = strlen(s);
-
     if (*buf == NULL) {
         *size = step;
         *buf = app_malloc(*size, &quot;engine buffer&quot;);
         **buf = '\0';
     }
 
-    if (**buf != '\0')
-        l += 2;                 /* &quot;, &quot; */
-
     if (strlen(*buf) + strlen(s) &gt;= (unsigned int)*size) {
         *size += step;
         *buf = OPENSSL_realloc(*buf, *size);
diff --git a/apps/gendsa.c b/apps/gendsa.c
index 5d5cb5e..9259c6c 100644
--- a/apps/gendsa.c
+++ b/apps/gendsa.c
@@ -69,8 +69,6 @@
 # include &lt;openssl/x509.h&gt;
 # include &lt;openssl/pem.h&gt;
 
-# define DEFBITS 512
-
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_OUT, OPT_PASSOUT, OPT_ENGINE, OPT_RAND, OPT_CIPHER
diff --git a/apps/ocsp.c b/apps/ocsp.c
index 2ef4278..c599ffb 100644
--- a/apps/ocsp.c
+++ b/apps/ocsp.c
@@ -1202,7 +1202,7 @@ static OCSP_RESPONSE *query_responder(BIO *cbio, const char *host,
         return NULL;
     }
 
-    if (BIO_get_fd(cbio, &amp;fd) &lt;= 0) {
+    if (BIO_get_fd(cbio, &amp;fd) &lt; 0) {
         BIO_puts(bio_err, &quot;Can't get connection fd\n&quot;);
         goto err;
     }
diff --git a/crypto/aes/asm/aesni-x86.pl b/crypto/aes/asm/aesni-x86.pl
index f67df8c..9b2e37a 100644
--- a/crypto/aes/asm/aesni-x86.pl
+++ b/crypto/aes/asm/aesni-x86.pl
@@ -88,7 +88,7 @@ $inout3=&quot;xmm5&quot;;	$in1=&quot;xmm5&quot;;
 $inout4=&quot;xmm6&quot;;	$in0=&quot;xmm6&quot;;
 $inout5=&quot;xmm7&quot;;	$ivec=&quot;xmm7&quot;;
 
-# AESNI extenstion
+# AESNI extension
 sub aeskeygenassist
 { my($dst,$src,$imm)=@_;
     if (&quot;$dst:$src&quot; =~ /xmm([0-7]):xmm([0-7])/)
diff --git a/crypto/bio/b_dump.c b/crypto/bio/b_dump.c
index 33191c1..55792b9 100644
--- a/crypto/bio/b_dump.c
+++ b/crypto/bio/b_dump.c
@@ -104,7 +104,6 @@ int BIO_dump_indent_cb(int (*cb) (const void *data, size_t len, void *u),
     if ((rows * dump_width) &lt; len)
         rows++;
     for (i = 0; i &lt; rows; i++) {
-        buf[0] = '\0';          /* start with empty string */
         BUF_strlcpy(buf, str, sizeof buf);
         BIO_snprintf(tmp, sizeof tmp, &quot;%04x - &quot;, i * dump_width);
         BUF_strlcat(buf, tmp, sizeof buf);
diff --git a/crypto/bn/asm/ia64.S b/crypto/bn/asm/ia64.S
index c0cee82..a9a42ab 100644
--- a/crypto/bn/asm/ia64.S
+++ b/crypto/bn/asm/ia64.S
@@ -422,7 +422,7 @@ bn_mul_add_words:
 
 // This loop spins in 3*(n+10) ticks on Itanium and in 2*(n+10) on
 // Itanium 2. Yes, unlike previous versions it scales:-) Previous
-// version was peforming *all* additions in IALU and was starving
+// version was performing *all* additions in IALU and was starving
 // for those even on Itanium 2. In this version one addition is
 // moved to FPU and is folded with multiplication. This is at cost
 // of propogating the result from previous call to this subroutine
diff --git a/crypto/bn/bn_gf2m.c b/crypto/bn/bn_gf2m.c
index cd137c3..3b6c883 100644
--- a/crypto/bn/bn_gf2m.c
+++ b/crypto/bn/bn_gf2m.c
@@ -574,7 +574,7 @@ int BN_GF2m_mod_sqr_arr(BIGNUM *r, const BIGNUM *a, const int p[],
     bn_check_top(a);
     BN_CTX_start(ctx);
     if ((s = BN_CTX_get(ctx)) == NULL)
-        return 0;
+        goto err;
     if (!bn_wexpand(s, 2 * a-&gt;top))
         goto err;
 
diff --git a/crypto/bn/bn_recp.c b/crypto/bn/bn_recp.c
index 3dc2166..39eed8b 100644
--- a/crypto/bn/bn_recp.c
+++ b/crypto/bn/bn_recp.c
@@ -151,8 +151,10 @@ int BN_div_recp(BIGNUM *dv, BIGNUM *rem, const BIGNUM *m,
 
     if (BN_ucmp(m, &amp;(recp-&gt;N)) &lt; 0) {
         BN_zero(d);
-        if (!BN_copy(r, m))
+        if (!BN_copy(r, m)) {
+            BN_CTX_end(ctx);
             return 0;
+        }
         BN_CTX_end(ctx);
         return (1);
     }
diff --git a/crypto/bn/bn_x931p.c b/crypto/bn/bn_x931p.c
index 15ba41d..76ce6f6 100644
--- a/crypto/bn/bn_x931p.c
+++ b/crypto/bn/bn_x931p.c
@@ -214,14 +214,14 @@ int BN_X931_generate_Xpq(BIGNUM *Xp, BIGNUM *Xq, int nbits, BN_CTX *ctx)
      * exceeded.
      */
     if (!BN_rand(Xp, nbits, 1, 0))
-        return 0;
+        goto err;
 
     BN_CTX_start(ctx);
     t = BN_CTX_get(ctx);
 
     for (i = 0; i &lt; 1000; i++) {
         if (!BN_rand(Xq, nbits, 1, 0))
-            return 0;
+            goto err;
         /* Check that |Xp - Xq| &gt; 2^(nbits - 100) */
         BN_sub(t, Xp, Xq);
         if (BN_num_bits(t) &gt; (nbits - 100))
@@ -235,6 +235,9 @@ int BN_X931_generate_Xpq(BIGNUM *Xp, BIGNUM *Xq, int nbits, BN_CTX *ctx)
 
     return 0;
 
+ err:
+    BN_CTX_end(ctx);
+    return 0;
 }
 
 /*
diff --git a/crypto/conf/conf_def.c b/crypto/conf/conf_def.c
index b490377..1da68f9 100644
--- a/crypto/conf/conf_def.c
+++ b/crypto/conf/conf_def.c
@@ -223,12 +223,11 @@ static int def_load_bio(CONF *conf, BIO *in, long *line)
         goto err;
     }
 
-    section = OPENSSL_malloc(10);
+    section = BUF_strdup(&quot;default&quot;);
     if (section == NULL) {
         CONFerr(CONF_F_DEF_LOAD_BIO, ERR_R_MALLOC_FAILURE);
         goto err;
     }
-    BUF_strlcpy(section, &quot;default&quot;, 10);
 
     if (_CONF_new_data(conf) == 0) {
         CONFerr(CONF_F_DEF_LOAD_BIO, ERR_R_MALLOC_FAILURE);
diff --git a/crypto/dsa/dsa_gen.c b/crypto/dsa/dsa_gen.c
index 056e500..480c29d 100644
--- a/crypto/dsa/dsa_gen.c
+++ b/crypto/dsa/dsa_gen.c
@@ -83,16 +83,8 @@ int DSA_generate_parameters_ex(DSA *ret, int bits,
         return ret-&gt;meth-&gt;dsa_paramgen(ret, bits, seed_in, seed_len,
                                        counter_ret, h_ret, cb);
     else {
-        const EVP_MD *evpmd;
-        size_t qbits = bits &gt;= 2048 ? 256 : 160;
-
-        if (bits &gt;= 2048) {
-            qbits = 256;
-            evpmd = EVP_sha256();
-        } else {
-            qbits = 160;
-            evpmd = EVP_sha1();
-        }
+        const EVP_MD *evpmd = bits &gt;= 2048 ? EVP_sha256() : EVP_sha1();
+        size_t qbits = EVP_MD_size(evpmd) * 8;
 
         return dsa_builtin_paramgen(ret, bits, qbits, evpmd,
                                     seed_in, seed_len, NULL, counter_ret,
@@ -142,14 +134,14 @@ int dsa_builtin_paramgen(DSA *ret, size_t bits, size_t qbits,
         memcpy(seed, seed_in, seed_len);
     }
 
+    if ((mont = BN_MONT_CTX_new()) == NULL)
+        goto err;
+
     if ((ctx = BN_CTX_new()) == NULL)
         goto err;
 
     BN_CTX_start(ctx);
 
-    if ((mont = BN_MONT_CTX_new()) == NULL)
-        goto err;
-
     r0 = BN_CTX_get(ctx);
     g = BN_CTX_get(ctx);
     W = BN_CTX_get(ctx);
diff --git a/crypto/evp/e_aes_cbc_hmac_sha256.c b/crypto/evp/e_aes_cbc_hmac_sha256.c
index e83969d..411c770 100644
--- a/crypto/evp/e_aes_cbc_hmac_sha256.c
+++ b/crypto/evp/e_aes_cbc_hmac_sha256.c
@@ -820,8 +820,6 @@ static int aesni_cbc_hmac_sha256_ctrl(EVP_CIPHER_CTX *ctx, int type, int arg,
             if (arg != EVP_AEAD_TLS1_AAD_LEN)
                 return -1;
 
-            len = p[arg - 2] &lt;&lt; 8 | p[arg - 1];
-
             if (ctx-&gt;encrypt) {
                 key-&gt;payload_length = len;
                 if ((key-&gt;aux.tls_ver =
diff --git a/crypto/evp/e_dsa.c b/crypto/evp/e_dsa.c
deleted file mode 100644
index 2217e37..0000000
--- a/crypto/evp/e_dsa.c
+++ /dev/null
@@ -1,69 +0,0 @@
-/* crypto/evp/e_dsa.c */
-/* Copyright (C) 1995-1998 Eric Young (<A HREF="../../../mailman/listinfo/openssl-commits.html">eay at cryptsoft.com</A>)
- * All rights reserved.
- *
- * This package is an SSL implementation written
- * by Eric Young (<A HREF="../../../mailman/listinfo/openssl-commits.html">eay at cryptsoft.com</A>).
- * The implementation was written so as to conform with Netscapes SSL.
- *
- * This library is free for commercial and non-commercial use as long as
- * the following conditions are aheared to.  The following conditions
- * apply to all code found in this distribution, be it the RC4, RSA,
- * lhash, DES, etc., code; not just the SSL code.  The SSL documentation
- * included with this distribution is covered by the same copyright terms
- * except that the holder is Tim Hudson (<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at cryptsoft.com</A>).
- *
- * Copyright remains Eric Young's, and as such any Copyright notices in
- * the code are not to be removed.
- * If this package is used in a product, Eric Young should be given attribution
- * as the author of the parts of the library used.
- * This can be in the form of a textual message at program startup or
- * in documentation (online or textual) provided with the package.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- * 3. All advertising materials mentioning features or use of this software
- *    must display the following acknowledgement:
- *    &quot;This product includes cryptographic software written by
- *     Eric Young (<A HREF="../../../mailman/listinfo/openssl-commits.html">eay at cryptsoft.com</A>)&quot;
- *    The word 'cryptographic' can be left out if the rouines from the library
- *    being used are not cryptographic related :-).
- * 4. If you include any Windows specific code (or a derivative thereof) from
- *    the apps directory (application code) you must include an acknowledgement:
- *    &quot;This product includes software written by Tim Hudson (<A HREF="../../../mailman/listinfo/openssl-commits.html">tjh at cryptsoft.com</A>)&quot;
- *
- * THIS SOFTWARE IS PROVIDED BY ERIC YOUNG ``AS IS'' AND
- * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
- * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
- * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
- * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
- * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
- * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
- * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- *
- * The licence and distribution terms for any publically available version or
- * derivative of this code cannot be changed.  i.e. this code cannot simply be
- * copied and put under another distribution licence
- * [including the GNU Public Licence.]
- */
-
-#include &lt;stdio.h&gt;
-#include &quot;internal/cryptlib.h&quot;
-#include &lt;openssl/evp.h&gt;
-#include &lt;openssl/objects.h&gt;
-#include &lt;openssl/x509.h&gt;
-
-static EVP_PKEY_METHOD dss_method = {
-    DSA_sign,
-    DSA_verify,
-    {EVP_PKEY_DSA, EVP_PKEY_DSA2, EVP_PKEY_DSA3, NULL},
-};
diff --git a/crypto/evp/evp_key.c b/crypto/evp/evp_key.c
index 9c34a03..5c03a91 100644
--- a/crypto/evp/evp_key.c
+++ b/crypto/evp/evp_key.c
@@ -137,7 +137,7 @@ int EVP_BytesToKey(const EVP_CIPHER *type, const EVP_MD *md,
     EVP_MD_CTX_init(&amp;c);
     for (;;) {
         if (!EVP_DigestInit_ex(&amp;c, md, NULL))
-            return 0;
+            goto err;
         if (addmd++)
             if (!EVP_DigestUpdate(&amp;c, &amp;(md_buf[0]), mds))
                 goto err;
@@ -188,6 +188,6 @@ int EVP_BytesToKey(const EVP_CIPHER *type, const EVP_MD *md,
     rv = type-&gt;key_len;
  err:
     EVP_MD_CTX_cleanup(&amp;c);
-    OPENSSL_cleanse(&amp;(md_buf[0]), EVP_MAX_MD_SIZE);
+    OPENSSL_cleanse(md_buf, sizeof(md_buf));
     return rv;
 }
diff --git a/crypto/evp/evp_pbe.c b/crypto/evp/evp_pbe.c
index fb7947e..e5b1739 100644
--- a/crypto/evp/evp_pbe.c
+++ b/crypto/evp/evp_pbe.c
@@ -209,12 +209,15 @@ int EVP_PBE_alg_add_type(int pbe_type, int pbe_nid, int cipher_nid,
 {
     EVP_PBE_CTL *pbe_tmp;
 
-    if (pbe_algs == NULL)
+    if (pbe_algs == NULL) {
         pbe_algs = sk_EVP_PBE_CTL_new(pbe_cmp);
-    if ((pbe_tmp = OPENSSL_malloc(sizeof(*pbe_tmp))) == NULL) {
-        EVPerr(EVP_F_EVP_PBE_ALG_ADD_TYPE, ERR_R_MALLOC_FAILURE);
-        return 0;
+        if (pbe_algs == NULL)
+            goto err;
     }
+
+    if ((pbe_tmp = OPENSSL_malloc(sizeof(*pbe_tmp))) == NULL)
+        goto err;
+
     pbe_tmp-&gt;pbe_type = pbe_type;
     pbe_tmp-&gt;pbe_nid = pbe_nid;
     pbe_tmp-&gt;cipher_nid = cipher_nid;
@@ -223,6 +226,10 @@ int EVP_PBE_alg_add_type(int pbe_type, int pbe_nid, int cipher_nid,
 
     sk_EVP_PBE_CTL_push(pbe_algs, pbe_tmp);
     return 1;
+
+ err:
+    EVPerr(EVP_F_EVP_PBE_ALG_ADD_TYPE, ERR_R_MALLOC_FAILURE);
+    return 0;
 }
 
 int EVP_PBE_alg_add(int nid, const EVP_CIPHER *cipher, const EVP_MD *md,
diff --git a/crypto/hmac/hm_ameth.c b/crypto/hmac/hm_ameth.c
index cd29c0c..20abe4f 100644
--- a/crypto/hmac/hm_ameth.c
+++ b/crypto/hmac/hm_ameth.c
@@ -108,9 +108,14 @@ static int old_hmac_decode(EVP_PKEY *pkey,
     ASN1_OCTET_STRING *os;
     os = ASN1_OCTET_STRING_new();
     if (!os || !ASN1_OCTET_STRING_set(os, *pder, derlen))
-        return 0;
-    EVP_PKEY_assign(pkey, EVP_PKEY_HMAC, os);
+        goto err;
+    if (!EVP_PKEY_assign(pkey, EVP_PKEY_HMAC, os))
+        goto err;
     return 1;
+
+ err:
+    ASN1_OCTET_STRING_free(os);
+    return 0;
 }
 
 static int old_hmac_encode(const EVP_PKEY *pkey, unsigned char **pder)
diff --git a/crypto/ocsp/ocsp_lib.c b/crypto/ocsp/ocsp_lib.c
index 0120194..9784294 100644
--- a/crypto/ocsp/ocsp_lib.c
+++ b/crypto/ocsp/ocsp_lib.c
@@ -242,12 +242,6 @@ int OCSP_parse_url(const char *url, char **phost, char **pport, char **ppath,
     if ((p = strchr(p, ':'))) {
         *p = 0;
         port = p + 1;
-    } else {
-        /* Not found: set default port */
-        if (*pssl)
-            port = &quot;443&quot;;
-        else
-            port = &quot;80&quot;;
     }
 
     *pport = BUF_strdup(port);
diff --git a/crypto/ocsp/ocsp_prn.c b/crypto/ocsp/ocsp_prn.c
index 70b6904..1137d61 100644
--- a/crypto/ocsp/ocsp_prn.c
+++ b/crypto/ocsp/ocsp_prn.c
@@ -213,7 +213,6 @@ int OCSP_RESPONSE_print(BIO *bp, OCSP_RESPONSE *o, unsigned long flags)
         return 1;
     }
 
-    i = ASN1_STRING_length(rb-&gt;response);
     if ((br = OCSP_response_get1_basic(o)) == NULL)
         goto err;
     rd = &amp;br-&gt;tbsResponseData;
diff --git a/crypto/pem/pvkfmt.c b/crypto/pem/pvkfmt.c
index c682fc7..47fb9ac 100644
--- a/crypto/pem/pvkfmt.c
+++ b/crypto/pem/pvkfmt.c
@@ -617,13 +617,11 @@ static int do_PVK_header(const unsigned char **in, unsigned int length,
             PEMerr(PEM_F_DO_PVK_HEADER, PEM_R_PVK_TOO_SHORT);
             return 0;
         }
-        length -= 20;
     } else {
         if (length &lt; 24) {
             PEMerr(PEM_F_DO_PVK_HEADER, PEM_R_PVK_TOO_SHORT);
             return 0;
         }
-        length -= 24;
         pvk_magic = read_ledword(&amp;p);
         if (pvk_magic != MS_PVKMAGIC) {
             PEMerr(PEM_F_DO_PVK_HEADER, PEM_R_BAD_MAGIC_NUMBER);
@@ -686,23 +684,23 @@ static EVP_PKEY *do_PVK_body(const unsigned char **in,
             inlen = PEM_def_callback(psbuf, PEM_BUFSIZE, 0, u);
         if (inlen &lt;= 0) {
             PEMerr(PEM_F_DO_PVK_BODY, PEM_R_BAD_PASSWORD_READ);
-            return NULL;
+            goto err;
         }
         enctmp = OPENSSL_malloc(keylen + 8);
         if (!enctmp) {
             PEMerr(PEM_F_DO_PVK_BODY, ERR_R_MALLOC_FAILURE);
-            return NULL;
+            goto err;
         }
         if (!derive_pvk_key(keybuf, p, saltlen,
                             (unsigned char *)psbuf, inlen))
-            return NULL;
+            goto err;
         p += saltlen;
         /* Copy BLOBHEADER across, decrypt rest */
         memcpy(enctmp, p, 8);
         p += 8;
         if (keylen &lt; 8) {
             PEMerr(PEM_F_DO_PVK_BODY, PEM_R_PVK_TOO_SHORT);
-            return NULL;
+            goto err;
         }
         inlen = keylen - 8;
         q = enctmp + 8;
diff --git a/crypto/pkcs12/p12_add.c b/crypto/pkcs12/p12_add.c
index 29abe2e..648b16b 100644
--- a/crypto/pkcs12/p12_add.c
+++ b/crypto/pkcs12/p12_add.c
@@ -76,15 +76,19 @@ PKCS12_SAFEBAG *PKCS12_item_pack_safebag(void *obj, const ASN1_ITEM *it,
     bag-&gt;type = OBJ_nid2obj(nid1);
     if (!ASN1_item_pack(obj, it, &amp;bag-&gt;value.octet)) {
         PKCS12err(PKCS12_F_PKCS12_ITEM_PACK_SAFEBAG, ERR_R_MALLOC_FAILURE);
-        return NULL;
+        goto err;
     }
     if ((safebag = PKCS12_SAFEBAG_new()) == NULL) {
         PKCS12err(PKCS12_F_PKCS12_ITEM_PACK_SAFEBAG, ERR_R_MALLOC_FAILURE);
-        return NULL;
+        goto err;
     }
     safebag-&gt;value.bag = bag;
     safebag-&gt;type = OBJ_nid2obj(nid2);
     return safebag;
+
+ err:
+    PKCS12_BAGS_free(bag);
+    return NULL;
 }
 
 /* Turn PKCS8 object into a keybag */
@@ -129,6 +133,7 @@ PKCS12_SAFEBAG *PKCS12_MAKE_SHKEYBAG(int pbe_nid, const char *pass,
           PKCS8_encrypt(pbe_nid, pbe_ciph, pass, passlen, salt, saltlen, iter,
                         p8))) {
         PKCS12err(PKCS12_F_PKCS12_MAKE_SHKEYBAG, ERR_R_MALLOC_FAILURE);
+        PKCS12_SAFEBAG_free(bag);
         return NULL;
     }
 
@@ -147,14 +152,18 @@ PKCS7 *PKCS12_pack_p7data(STACK_OF(PKCS12_SAFEBAG) *sk)
     p7-&gt;type = OBJ_nid2obj(NID_pkcs7_data);
     if ((p7-&gt;d.data = ASN1_OCTET_STRING_new()) == NULL) {
         PKCS12err(PKCS12_F_PKCS12_PACK_P7DATA, ERR_R_MALLOC_FAILURE);
-        return NULL;
+        goto err;
     }
 
     if (!ASN1_item_pack(sk, ASN1_ITEM_rptr(PKCS12_SAFEBAGS), &amp;p7-&gt;d.data)) {
         PKCS12err(PKCS12_F_PKCS12_PACK_P7DATA, PKCS12_R_CANT_PACK_STRUCTURE);
-        return NULL;
+        goto err;
     }
     return p7;
+
+ err:
+    PKCS7_free(p7);
+    return NULL;
 }
 
 /* Unpack SAFEBAGS from PKCS#7 data ContentInfo */
@@ -185,7 +194,7 @@ PKCS7 *PKCS12_pack_p7encdata(int pbe_nid, const char *pass, int passlen,
     if (!PKCS7_set_type(p7, NID_pkcs7_encrypted)) {
         PKCS12err(PKCS12_F_PKCS12_PACK_P7ENCDATA,
                   PKCS12_R_ERROR_SETTING_ENCRYPTED_DATA_TYPE);
-        return NULL;
+        goto err;
     }
 
     pbe_ciph = EVP_get_cipherbynid(pbe_nid);
@@ -197,7 +206,7 @@ PKCS7 *PKCS12_pack_p7encdata(int pbe_nid, const char *pass, int passlen,
 
     if (!pbe) {
         PKCS12err(PKCS12_F_PKCS12_PACK_P7ENCDATA, ERR_R_MALLOC_FAILURE);
-        return NULL;
+        goto err;
     }
     X509_ALGOR_free(p7-&gt;d.encrypted-&gt;enc_data-&gt;algorithm);
     p7-&gt;d.encrypted-&gt;enc_data-&gt;algorithm = pbe;
@@ -206,10 +215,14 @@ PKCS7 *PKCS12_pack_p7encdata(int pbe_nid, const char *pass, int passlen,
           PKCS12_item_i2d_encrypt(pbe, ASN1_ITEM_rptr(PKCS12_SAFEBAGS), pass,
                                   passlen, bags, 1))) {
         PKCS12err(PKCS12_F_PKCS12_PACK_P7ENCDATA, PKCS12_R_ENCRYPT_ERROR);
-        return NULL;
+        goto err;
     }
 
     return p7;
+
+ err:
+    PKCS7_free(p7);
+    return NULL;
 }
 
 STACK_OF(PKCS12_SAFEBAG) *PKCS12_unpack_p7encdata(PKCS7 *p7, const char *pass,
diff --git a/crypto/pkcs12/p12_mutl.c b/crypto/pkcs12/p12_mutl.c
index 9da65fe..4cf68e1 100644
--- a/crypto/pkcs12/p12_mutl.c
+++ b/crypto/pkcs12/p12_mutl.c
@@ -208,11 +208,11 @@ int PKCS12_setup_mac(PKCS12 *p12, int iter, unsigned char *salt, int saltlen,
     }
     if (!saltlen)
         saltlen = PKCS12_SALT_LEN;
-    p12-&gt;mac-&gt;salt-&gt;length = saltlen;
     if ((p12-&gt;mac-&gt;salt-&gt;data = OPENSSL_malloc(saltlen)) == NULL) {
         PKCS12err(PKCS12_F_PKCS12_SETUP_MAC, ERR_R_MALLOC_FAILURE);
         return 0;
     }
+    p12-&gt;mac-&gt;salt-&gt;length = saltlen;
     if (!salt) {
         if (RAND_bytes(p12-&gt;mac-&gt;salt-&gt;data, saltlen) &lt;= 0)
             return 0;
diff --git a/crypto/pkcs7/pk7_doit.c b/crypto/pkcs7/pk7_doit.c
index 1ac6893..b3b4ae3 100644
--- a/crypto/pkcs7/pk7_doit.c
+++ b/crypto/pkcs7/pk7_doit.c
@@ -1089,7 +1089,6 @@ PKCS7_ISSUER_AND_SERIAL *PKCS7_get_issuer_and_serial(PKCS7 *p7, int idx)
     rsk = p7-&gt;d.signed_and_enveloped-&gt;recipientinfo;
     if (rsk == NULL)
         return NULL;
-    ri = sk_PKCS7_RECIP_INFO_value(rsk, 0);
     if (sk_PKCS7_RECIP_INFO_num(rsk) &lt;= idx)
         return (NULL);
     ri = sk_PKCS7_RECIP_INFO_value(rsk, idx);
diff --git a/crypto/sha/asm/sha1-s390x.pl b/crypto/sha/asm/sha1-s390x.pl
index 18d127d..9ce8a4c 100644
--- a/crypto/sha/asm/sha1-s390x.pl
+++ b/crypto/sha/asm/sha1-s390x.pl
@@ -28,7 +28,7 @@
 # instructions and achieve &quot;64-bit&quot; performance even in 31-bit legacy
 # application context. The feature is not specific to any particular
 # processor, as long as it's &quot;z-CPU&quot;. Latter implies that the code
-# remains z/Architecture specific. On z990 it was measured to peform
+# remains z/Architecture specific. On z990 it was measured to perform
 # 23% better than code generated by gcc 4.3.
 
 $kimdfunc=1;	# magic function code for kimd instruction
diff --git a/crypto/sha/asm/sha512-parisc.pl b/crypto/sha/asm/sha512-parisc.pl
index fc0e15b..6cad72e 100755
--- a/crypto/sha/asm/sha512-parisc.pl
+++ b/crypto/sha/asm/sha512-parisc.pl
@@ -19,7 +19,7 @@
 # SHA512 performance is &gt;2.9x better than gcc 3.2 generated code on
 # PA-7100LC, PA-RISC 1.1 processor. Then implementation detects if the
 # code is executed on PA-RISC 2.0 processor and switches to 64-bit
-# code path delivering adequate peformance even in &quot;blended&quot; 32-bit
+# code path delivering adequate performance even in &quot;blended&quot; 32-bit
 # build. Though 64-bit code is not any faster than code generated by
 # vendor compiler on PA-8600...
 #
diff --git a/crypto/x509/t_crl.c b/crypto/x509/t_crl.c
index 8400e85..f1440eb 100644
--- a/crypto/x509/t_crl.c
+++ b/crypto/x509/t_crl.c
@@ -96,7 +96,6 @@ int X509_CRL_print(BIO *out, X509_CRL *x)
     l = X509_CRL_get_version(x);
     BIO_printf(out, &quot;%8sVersion %lu (0x%lx)\n&quot;, &quot;&quot;, l + 1, l);
     X509_CRL_get0_signature(&amp;sig, &amp;sig_alg, x);
-    i = X509_CRL_get_signature_nid(x);
     X509_signature_print(out, sig_alg, NULL);
     p = X509_NAME_oneline(X509_CRL_get_issuer(x), NULL, 0);
     BIO_printf(out, &quot;%8sIssuer: %s\n&quot;, &quot;&quot;, p);
diff --git a/crypto/x509/x509_lu.c b/crypto/x509/x509_lu.c
index 71a22d0..2bcac35 100644
--- a/crypto/x509/x509_lu.c
+++ b/crypto/x509/x509_lu.c
@@ -523,8 +523,6 @@ STACK_OF(X509_CRL) *X509_STORE_get1_crls(X509_STORE_CTX *ctx, X509_NAME *nm)
     X509_OBJECT *obj, xobj;
     sk = sk_X509_CRL_new_null();
     CRYPTO_w_lock(CRYPTO_LOCK_X509_STORE);
-    /* Check cache first */
-    idx = x509_object_idx_cnt(ctx-&gt;ctx-&gt;objs, X509_LU_CRL, nm, &amp;cnt);
 
     /*
      * Always do lookup to possibly add new CRLs to cache
diff --git a/demos/engines/zencod/hw_zencod.c b/demos/engines/zencod/hw_zencod.c
index f13cf37..5f50980 100644
--- a/demos/engines/zencod/hw_zencod.c
+++ b/demos/engines/zencod/hw_zencod.c
@@ -592,7 +592,7 @@ static int zencod_init(ENGINE *e)
     ptr_zencod_rc4_cipher = ptr_rc4_1;
 
     /*
-     * We should peform a test to see if there is actually any unit runnig on
+     * We should perform a test to see if there is actually any unit runnig on
      * the system ... Even if the cryptozen library is loaded the module coul
      * not be loaded on the system ... For now we may just open and close the
      * device !!
diff --git a/doc/crypto/BIO_read.pod b/doc/crypto/BIO_read.pod
index 960ea45..09ee39f 100644
--- a/doc/crypto/BIO_read.pod
+++ b/doc/crypto/BIO_read.pod
@@ -9,9 +9,9 @@ BIO_read, BIO_write, BIO_gets, BIO_puts - BIO I/O functions
  #include &lt;openssl/bio.h&gt;
 
  int	BIO_read(BIO *b, void *buf, int len);
- int	BIO_gets(BIO *b,char *buf, int size);
+ int	BIO_gets(BIO *b, char *buf, int size);
  int	BIO_write(BIO *b, const void *buf, int len);
- int	BIO_puts(BIO *b,const char *buf);
+ int	BIO_puts(BIO *b, const char *buf);
 
 =head1 DESCRIPTION
 
@@ -26,7 +26,7 @@ return the digest and other BIOs may not support BIO_gets() at all.
 
 BIO_write() attempts to write B&lt;len&gt; bytes from B&lt;buf&gt; to BIO B&lt;b&gt;.
 
-BIO_puts() attempts to write a null terminated string B&lt;buf&gt; to BIO B&lt;b&gt;
+BIO_puts() attempts to write a null terminated string B&lt;buf&gt; to BIO B&lt;b&gt;.
 
 =head1 RETURN VALUES
 
diff --git a/doc/crypto/BN_rand.pod b/doc/crypto/BN_rand.pod
index 0676063..1abcdd4 100644
--- a/doc/crypto/BN_rand.pod
+++ b/doc/crypto/BN_rand.pod
@@ -19,7 +19,7 @@ BN_rand, BN_pseudo_rand, BN_rand_range, BN_pseudo_rand_range - generate pseudo-r
 =head1 DESCRIPTION
 
 BN_rand() generates a cryptographically strong pseudo-random number of
-B&lt;bits&gt; bits in length and stores it in B&lt;rnd&gt;. If B&lt;top&gt; is -1, the
+B&lt;bits&gt; in length and stores it in B&lt;rnd&gt;. If B&lt;top&gt; is -1, the
 most significant bit of the random number can be zero. If B&lt;top&gt; is 0,
 it is set to 1, and if B&lt;top&gt; is 1, the two most significant bits of
 the number will be set to 1, so that the product of two such random
diff --git a/doc/crypto/EC_GROUP_copy.pod b/doc/crypto/EC_GROUP_copy.pod
index 591ba90..837995b 100644
--- a/doc/crypto/EC_GROUP_copy.pod
+++ b/doc/crypto/EC_GROUP_copy.pod
@@ -166,7 +166,7 @@ EC_GROUP_get0_seed returns a pointer to the seed that was used to generate the p
 specified. EC_GROUP_get_seed_len returns the length of the seed or 0 if the seed is not specified.
 
 EC_GROUP_set_seed returns the length of the seed that has been set. If the supplied seed is NULL, or the supplied seed length is
-0, the the return value will be 1. On error 0 is returned.
+0, the return value will be 1. On error 0 is returned.
 
 EC_GROUP_cmp returns 0 if the curves are equal, 1 if they are not equal, or -1 on error.
 
diff --git a/doc/crypto/EC_KEY_new.pod b/doc/crypto/EC_KEY_new.pod
index 71095e5..a317a1e 100644
--- a/doc/crypto/EC_KEY_new.pod
+++ b/doc/crypto/EC_KEY_new.pod
@@ -72,7 +72,7 @@ The functions EC_KEY_get_conv_form and EC_KEY_set_conv_form get and set the poin
 of point_conversion_forms please refer to L&lt;EC_POINT_new(3)&gt;.
 
 EC_KEY_insert_key_method_data and EC_KEY_get_key_method_data enable the caller to associate arbitrary additional data specific to the
-elliptic curve scheme being used with the EC_KEY object. This data is treated as a &quot;black box&quot; by the ec library. The data to be stored by EC_KEY_insert_key_method_data is provided in the B&lt;data&gt; parameter, which must have have associated functions for duplicating, freeing and &quot;clear_freeing&quot; the data item. If a subsequent EC_KEY_get_key_method_data call is issued, the functions for duplicating, freeing and &quot;clear_freeing&quot; the data item must be provided again, and they must be the same as they were when the data item was inserted.
+elliptic curve scheme being used with the EC_KEY object. This data is treated as a &quot;black box&quot; by the ec library. The data to be stored by EC_KEY_insert_key_method_data is provided in the B&lt;data&gt; parameter, which must have associated functions for duplicating, freeing and &quot;clear_freeing&quot; the data item. If a subsequent EC_KEY_get_key_method_data call is issued, the functions for duplicating, freeing and &quot;clear_freeing&quot; the data item must be provided again, and they must be the same as they were when the data item was inserted.
 
 EC_KEY_set_flags sets the flags in the B&lt;flags&gt; parameter on the EC_KEY object. Any flags that are already set are left set. The currently defined standard flags are EC_FLAG_NON_FIPS_ALLOW and EC_FLAG_FIPS_CHECKED. In addition there is the flag EC_FLAG_COFACTOR_ECDH which is specific to ECDH and is defined in ecdh.h. EC_KEY_get_flags returns the current flags that are set for this EC_KEY. EC_KEY_clear_flags clears the flags indicated by the B&lt;flags&gt; parameter. All other flags are left in their existing state.
 
diff --git a/doc/crypto/X509_get_extension_flags.pod b/doc/crypto/X509_get_extension_flags.pod
index d19eb89..c6e2486 100644
--- a/doc/crypto/X509_get_extension_flags.pod
+++ b/doc/crypto/X509_get_extension_flags.pod
@@ -121,7 +121,7 @@ certificate extension values.
 
 X509_get0_subject_key_id() returns the subject key identifier as a
 pointer to an B&lt;ASN1_OCTET_STRING&gt; structure or B&lt;NULL&gt; if the extension
-is absent or an error occured during parsing.
+is absent or an error occurred during parsing.
 
 =head1 SEE ALSO
 
diff --git a/doc/crypto/d2i_X509_NAME.pod b/doc/crypto/d2i_X509_NAME.pod
index 69f3762..ca52f53 100644
--- a/doc/crypto/d2i_X509_NAME.pod
+++ b/doc/crypto/d2i_X509_NAME.pod
@@ -14,7 +14,7 @@ d2i_X509_NAME, i2d_X509_NAME - X509_NAME encoding functions
 =head1 DESCRIPTION
 
 These functions decode and encode an B&lt;X509_NAME&gt; structure which is the
-the same as the B&lt;Name&gt; type defined in RFC2459 (and elsewhere) and used
+same as the B&lt;Name&gt; type defined in RFC2459 (and elsewhere) and used
 for example in certificate subject and issuer names.
 
 Otherwise the functions behave in a similar way to d2i_X509() and i2d_X509()
diff --git a/include/openssl/tls1.h b/include/openssl/tls1.h
index 6adfcf3..5d7b64f 100644
--- a/include/openssl/tls1.h
+++ b/include/openssl/tls1.h
@@ -237,25 +237,19 @@ extern &quot;C&quot; {
 /* ExtensionType value from RFC5620 */
 # define TLSEXT_TYPE_heartbeat   15
 
-/* ExtensionType value from draft-ietf-tls-applayerprotoneg-00 */
+/* ExtensionType value from RFC7301 */
 # define TLSEXT_TYPE_application_layer_protocol_negotiation 16
 
 /*
  * ExtensionType value for TLS padding extension.
- * <A HREF="http://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml">http://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml</A>
- * <A HREF="http://tools.ietf.org/html/draft-agl-tls-padding-03">http://tools.ietf.org/html/draft-agl-tls-padding-03</A>
+ * <A HREF="http://tools.ietf.org/html/draft-agl-tls-padding">http://tools.ietf.org/html/draft-agl-tls-padding</A>
  */
 # define TLSEXT_TYPE_padding     21
-/*
- * Extension type for Encrypt-then-MAC
- * <A HREF="http://www.ietf.org/id/draft-ietf-tls-encrypt-then-mac-02.txt">http://www.ietf.org/id/draft-ietf-tls-encrypt-then-mac-02.txt</A>
- */
+
+/* ExtensionType value from RFC7366 */
 # define TLSEXT_TYPE_encrypt_then_mac    22
-/*
- * Extended master secret extension.
- * <A HREF="http://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml">http://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml</A>
- * <A HREF="https://tools.ietf.org/id/draft-ietf-tls-session-hash-03.txt">https://tools.ietf.org/id/draft-ietf-tls-session-hash-03.txt</A>
- */
+
+/* ExtensionType value from RFC7627 */
 # define TLSEXT_TYPE_extended_master_secret      23
 
 /* ExtensionType value from RFC4507 */
@@ -269,20 +263,19 @@ extern &quot;C&quot; {
 #  define TLSEXT_TYPE_next_proto_neg              13172
 # endif
 
-/* NameType value from RFC 3546 */
+/* NameType value from RFC3546 */
 # define TLSEXT_NAMETYPE_host_name 0
-/* status request value from RFC 3546 */
+/* status request value from RFC3546 */
 # define TLSEXT_STATUSTYPE_ocsp 1
 
-/* ECPointFormat values from draft-ietf-tls-ecc-12 */
+/* ECPointFormat values from RFC4492 */
 # define TLSEXT_ECPOINTFORMAT_first                      0
 # define TLSEXT_ECPOINTFORMAT_uncompressed               0
 # define TLSEXT_ECPOINTFORMAT_ansiX962_compressed_prime  1
 # define TLSEXT_ECPOINTFORMAT_ansiX962_compressed_char2  2
 # define TLSEXT_ECPOINTFORMAT_last                       2
 
-/* Signature and hash algorithms from RFC 5246 */
-
+/* Signature and hash algorithms from RFC5246 */
 # define TLSEXT_signature_anonymous                      0
 # define TLSEXT_signature_rsa                            1
 # define TLSEXT_signature_dsa                            2
@@ -443,13 +436,11 @@ SSL_CTX_callback_ctrl(ssl,SSL_CTRL_SET_TLSEXT_TICKET_KEY_CB,(void (*)(void))cb)
 # define TLS1_CK_RSA_PSK_WITH_NULL_SHA384                0x030000B9
 
 /* NULL PSK ciphersuites from RFC4785 */
-
 # define TLS1_CK_PSK_WITH_NULL_SHA                       0x0300002C
 # define TLS1_CK_DHE_PSK_WITH_NULL_SHA                   0x0300002D
 # define TLS1_CK_RSA_PSK_WITH_NULL_SHA                   0x0300002E
 
 /* AES ciphersuites from RFC3268 */
-
 # define TLS1_CK_RSA_WITH_AES_128_SHA                    0x0300002F
 # define TLS1_CK_DH_DSS_WITH_AES_128_SHA                 0x03000030
 # define TLS1_CK_DH_RSA_WITH_AES_128_SHA                 0x03000031
@@ -538,7 +529,6 @@ SSL_CTX_callback_ctrl(ssl,SSL_CTRL_SET_TLSEXT_TICKET_KEY_CB,(void (*)(void))cb)
 # define TLS1_CK_DHE_PSK_WITH_AES_256_CCM_8              0x0300C0AB
 
 /* CCM ciphersuites from RFC7251 */
-
 # define TLS1_CK_ECDHE_ECDSA_WITH_AES_128_CCM            0x0300C0AC
 # define TLS1_CK_ECDHE_ECDSA_WITH_AES_256_CCM            0x0300C0AD
 # define TLS1_CK_ECDHE_ECDSA_WITH_AES_128_CCM_8          0x0300C0AE
@@ -559,10 +549,7 @@ SSL_CTX_callback_ctrl(ssl,SSL_CTRL_SET_TLSEXT_TICKET_KEY_CB,(void (*)(void))cb)
 # define TLS1_CK_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA256            0x030000C4
 # define TLS1_CK_ADH_WITH_CAMELLIA_256_CBC_SHA256                0x030000C5
 
-/*
- * ECC ciphersuites from draft-ietf-tls-ecc-12.txt with changes soon to be in
- * draft 13
- */
+/* ECC ciphersuites from RFC4492 */
 # define TLS1_CK_ECDH_ECDSA_WITH_NULL_SHA                0x0300C001
 # define TLS1_CK_ECDH_ECDSA_WITH_RC4_128_SHA             0x0300C002
 # define TLS1_CK_ECDH_ECDSA_WITH_DES_192_CBC3_SHA        0x0300C003
@@ -692,7 +679,7 @@ SSL_CTX_callback_ctrl(ssl,SSL_CTRL_SET_TLSEXT_TICKET_KEY_CB,(void (*)(void))cb)
 # define TLS1_TXT_DHE_RSA_WITH_AES_256_SHA               &quot;DHE-RSA-AES256-SHA&quot;
 # define TLS1_TXT_ADH_WITH_AES_256_SHA                   &quot;ADH-AES256-SHA&quot;
 
-/* ECC ciphersuites from draft-ietf-tls-ecc-01.txt (Mar 15, 2001) */
+/* ECC ciphersuites from RFC4492 */
 # define TLS1_TXT_ECDH_ECDSA_WITH_NULL_SHA               &quot;ECDH-ECDSA-NULL-SHA&quot;
 # define TLS1_TXT_ECDH_ECDSA_WITH_RC4_128_SHA            &quot;ECDH-ECDSA-RC4-SHA&quot;
 # define TLS1_TXT_ECDH_ECDSA_WITH_DES_192_CBC3_SHA       &quot;ECDH-ECDSA-DES-CBC3-SHA&quot;
diff --git a/ssl/s3_clnt.c b/ssl/s3_clnt.c
index 2df5afe..8a89b42 100644
--- a/ssl/s3_clnt.c
+++ b/ssl/s3_clnt.c
@@ -2411,6 +2411,7 @@ int ssl3_send_client_key_exchange(SSL *s)
                     || (pkey-&gt;pkey.rsa == NULL)) {
                     SSLerr(SSL_F_SSL3_SEND_CLIENT_KEY_EXCHANGE,
                            ERR_R_INTERNAL_ERROR);
+                    EVP_PKEY_free(pkey);
                     goto err;
                 }
                 rsa = pkey-&gt;pkey.rsa;
@@ -3101,7 +3102,6 @@ int ssl3_send_client_certificate(SSL *s)
          * If we get an error, we need to ssl-&gt;rwstate=SSL_X509_LOOKUP;
          * return(-1); We then get retied later
          */
-        i = 0;
         i = ssl_do_client_cert_cb(s, &amp;x509, &amp;pkey);
         if (i &lt; 0) {
             s-&gt;rwstate = SSL_X509_LOOKUP;
diff --git a/ssl/s3_srvr.c b/ssl/s3_srvr.c
index 7bf5828..376ab71 100644
--- a/ssl/s3_srvr.c
+++ b/ssl/s3_srvr.c
@@ -370,7 +370,6 @@ int ssl3_accept(SSL *s)
                      */
                     if (al != TLS1_AD_UNKNOWN_PSK_IDENTITY)
                         SSLerr(SSL_F_SSL3_ACCEPT, SSL_R_CLIENTHELLO_TLSEXT);
-                    ret = SSL_TLSEXT_ERR_ALERT_FATAL;
                     ret = -1;
                     s-&gt;state = SSL_ST_ERR;
                     goto end;
diff --git a/ssl/t1_lib.c b/ssl/t1_lib.c
index f18f502..6446623 100644
--- a/ssl/t1_lib.c
+++ b/ssl/t1_lib.c
@@ -3938,7 +3938,6 @@ int tls1_check_chain(SSL *s, X509 *x, EVP_PKEY *pk, STACK_OF(X509) *chain,
         idx = ssl_cert_type(x, pk);
         if (idx == -1)
             return 0;
-        cpk = c-&gt;pkeys + idx;
         pvalid = s-&gt;s3-&gt;tmp.valid_flags + idx;
 
         if (c-&gt;cert_flags &amp; SSL_CERT_FLAGS_CHECK_TLS_STRICT)
diff --git a/test/evp_test.c b/test/evp_test.c
index eb7ef50..83d1749 100644
--- a/test/evp_test.c
+++ b/test/evp_test.c
@@ -639,7 +639,7 @@ struct digest_data {
 static int digest_test_init(struct evp_test *t, const char *alg)
 {
     const EVP_MD *digest;
-    struct digest_data *mdat = t-&gt;data;
+    struct digest_data *mdat;
     digest = EVP_get_digestbyname(alg);
     if (!digest) {
         /* If alg has an OID assume disabled algorithm */
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002040.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="002044.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2041">[ date ]</a>
              <a href="thread.html#2041">[ thread ]</a>
              <a href="subject.html#2041">[ subject ]</a>
              <a href="author.html#2041">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
