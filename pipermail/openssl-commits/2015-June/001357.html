<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  OpenSSL_1_0_2-stable update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2015-June/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20OpenSSL_1_0_2-stable%20update&In-Reply-To=%3C1434917533.370978.22285.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001354.html">
   <LINK REL="Next"  HREF="001360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  OpenSSL_1_0_2-stable update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20OpenSSL_1_0_2-stable%20update&In-Reply-To=%3C1434917533.370978.22285.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  OpenSSL_1_0_2-stable update">levitte at openssl.org
       </A><BR>
    <I>Sun Jun 21 20:12:13 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001354.html">[openssl-commits] [openssl]  OpenSSL_1_0_2-stable update
</A></li>
        <LI>Next message: <A HREF="001360.html">[openssl-commits] [openssl]  OpenSSL_1_0_2-stable update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1357">[ date ]</a>
              <a href="thread.html#1357">[ thread ]</a>
              <a href="subject.html#1357">[ subject ]</a>
              <a href="author.html#1357">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch OpenSSL_1_0_2-stable has been updated
       via  220b9519eb48c5e3f969123508976f777f897330 (commit)
       via  710e28ef936794d045836e4c0cd9f83acfdf6166 (commit)
       via  05d20833e34cc63b928b45a5fb4bdedfd10d841e (commit)
       via  90ee3c1646a5efc1a24aa4d89ab15b3cbd3dbd75 (commit)
       via  7ef465050edfd8e8d95e01affc02f6e26cf6fa7d (commit)
       via  8ca211707afe1b946020e9c9a83cc5c047dfc7a0 (commit)
       via  9007dfa2030c58a10e6b16c5920d5a4ff0578933 (commit)
       via  603bebc0e753a70587972af5600cbb57b14f218b (commit)
       via  56f0733145aaecc09f1692bac965e3d2782b7ef6 (commit)
      from  8e6bb99979b95ee8b878e22e043ceb78d79c32a1 (commit)


- Log -----------------------------------------------------------------
commit 220b9519eb48c5e3f969123508976f777f897330
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 21:35:59 2015 +0200

    Cleanup mttest.c : because we no longer use stdio here, don't include it
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit 8ca96efd24b73f917837fdd45b1c22d7b8ff8cbd)

commit 710e28ef936794d045836e4c0cd9f83acfdf6166
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:19:59 2015 +0200

    Add -ldl to the build of mttest.c
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit d62c98c81c7b47b7b1878fd7e91e5fd33818faf0)

commit 05d20833e34cc63b928b45a5fb4bdedfd10d841e
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:16:50 2015 +0200

    Cleanup mttest.c : do not try to output reference counts when threads are done
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit 964626957f79e07ed97756527cdc7e84007c60c9)

commit 90ee3c1646a5efc1a24aa4d89ab15b3cbd3dbd75
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:13:57 2015 +0200

    Cleanup mttest.c : better error reporting when certs are missing
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit 7a1789d254c561bd3024c971b5cfeeedd12d63f3)

commit 7ef465050edfd8e8d95e01affc02f6e26cf6fa7d
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:12:33 2015 +0200

    Cleanup mttest.c : make ssl_method a pointer to const
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit f4c73bfe0ab7a0e8f82fe2947c0f77fe3d98acab)
    
    Conflicts:
    	crypto/threads/mttest.c

commit 8ca211707afe1b946020e9c9a83cc5c047dfc7a0
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:19:17 2015 +0200

    Cleanup mttest.c : more output changes
    
    More fprintf()s and printf()s to turn into BIO calls.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 9007dfa2030c58a10e6b16c5920d5a4ff0578933
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:11:43 2015 +0200

    Cleanup mttest.c : modernise output
    
    Construct bio_err and bio_stdout from file handles instead of FILE
    pointers, since the latter might not be implemented (when OPENSSL_NO_STDIO
    is defined).
    Convert all output to use BIO_printf.
    Change lh_foo to lh_SSL_SESSION_foo.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit bb8abd6735e198de36c1eb9098a7f1516d156220)
    
    Conflicts:
    	crypto/threads/mttest.c

commit 603bebc0e753a70587972af5600cbb57b14f218b
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 19:03:44 2015 +0200

    Cleanup mttest.c : modernise the threads setup
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit 5c78e1835285ce4acdc7cc4f4c06aa7d6661c9b4)
    
    Conflicts:
    	crypto/threads/mttest.c

commit 56f0733145aaecc09f1692bac965e3d2782b7ef6
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jun 21 18:51:18 2015 +0200

    Cleanup mttest.c : remove MS_CALLBACK
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (cherry picked from commit a3f9286556d6d78c1800caae97a9328afb2557e6)

-----------------------------------------------------------------------

Summary of changes:
 crypto/threads/mttest.c    | 365 +++++++++++++++++++++++----------------------
 crypto/threads/pthread2.sh |   3 +-
 2 files changed, 185 insertions(+), 183 deletions(-)

diff --git a/crypto/threads/mttest.c b/crypto/threads/mttest.c
index 8f67db6..dbff4a6 100644
--- a/crypto/threads/mttest.c
+++ b/crypto/threads/mttest.c
@@ -56,7 +56,6 @@
  * [including the GNU Public Licence.]
  */
 
-#include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 #include &lt;errno.h&gt;
@@ -86,17 +85,11 @@
 #include &lt;openssl/lhash.h&gt;
 #include &lt;openssl/crypto.h&gt;
 #include &lt;openssl/buffer.h&gt;
-#include &quot;../../e_os.h&quot;
 #include &lt;openssl/x509.h&gt;
 #include &lt;openssl/ssl.h&gt;
 #include &lt;openssl/err.h&gt;
 #include &lt;openssl/rand.h&gt;
 
-#ifdef OPENSSL_NO_FP_API
-# define APPS_WIN16
-# include &quot;../buffer/bss_file.c&quot;
-#endif
-
 #ifdef OPENSSL_SYS_NETWARE
 # define TEST_SERVER_CERT &quot;/openssl/apps/server.pem&quot;
 # define TEST_CLIENT_CERT &quot;/openssl/apps/client.pem&quot;
@@ -107,23 +100,23 @@
 
 #define MAX_THREAD_NUMBER       100
 
-int MS_CALLBACK verify_callback(int ok, X509_STORE_CTX *xs);
+int verify_callback(int ok, X509_STORE_CTX *xs);
 void thread_setup(void);
 void thread_cleanup(void);
 void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx);
 
-void irix_locking_callback(int mode, int type, char *file, int line);
-void solaris_locking_callback(int mode, int type, char *file, int line);
-void win32_locking_callback(int mode, int type, char *file, int line);
-void pthreads_locking_callback(int mode, int type, char *file, int line);
-void netware_locking_callback(int mode, int type, char *file, int line);
+void irix_locking_callback(int mode, int type, const char *file, int line);
+void solaris_locking_callback(int mode, int type, const char *file, int line);
+void win32_locking_callback(int mode, int type, const char *file, int line);
+void pthreads_locking_callback(int mode, int type, const char *file, int line);
+void netware_locking_callback(int mode, int type, const char *file, int line);
 void beos_locking_callback(int mode, int type, const char *file, int line);
 
-unsigned long irix_thread_id(void);
-unsigned long solaris_thread_id(void);
-unsigned long pthreads_thread_id(void);
-unsigned long netware_thread_id(void);
-unsigned long beos_thread_id(void);
+void irix_thread_id(CRYPTO_THREADID *tid);
+void solaris_thread_id(CRYPTO_THREADID *tid);
+void pthreads_thread_id(CRYPTO_THREADID *tid);
+void netware_thread_id(CRYPTO_THREADID *tid);
+void beos_thread_id(CRYPTO_THREADID *tid);
 
 #if defined(OPENSSL_SYS_NETWARE)
 static MPKMutex *lock_cs;
@@ -149,39 +142,39 @@ static const char rnd_seed[] =
     &quot;string to make the random number generator think it has entropy&quot;;
 
 int doit(char *ctx[4]);
-static void print_stats(FILE *fp, SSL_CTX *ctx)
+static void print_stats(BIO *bio, SSL_CTX *ctx)
 {
-    fprintf(fp, &quot;%4ld items in the session cache\n&quot;,
-            SSL_CTX_sess_number(ctx));
-    fprintf(fp, &quot;%4d client connects (SSL_connect())\n&quot;,
-            SSL_CTX_sess_connect(ctx));
-    fprintf(fp, &quot;%4d client connects that finished\n&quot;,
-            SSL_CTX_sess_connect_good(ctx));
-    fprintf(fp, &quot;%4d server connects (SSL_accept())\n&quot;,
-            SSL_CTX_sess_accept(ctx));
-    fprintf(fp, &quot;%4d server connects that finished\n&quot;,
-            SSL_CTX_sess_accept_good(ctx));
-    fprintf(fp, &quot;%4d session cache hits\n&quot;, SSL_CTX_sess_hits(ctx));
-    fprintf(fp, &quot;%4d session cache misses\n&quot;, SSL_CTX_sess_misses(ctx));
-    fprintf(fp, &quot;%4d session cache timeouts\n&quot;, SSL_CTX_sess_timeouts(ctx));
+    BIO_printf(bio, &quot;%4ld items in the session cache\n&quot;,
+	       SSL_CTX_sess_number(ctx));
+    BIO_printf(bio, &quot;%4d client connects (SSL_connect())\n&quot;,
+	       SSL_CTX_sess_connect(ctx));
+    BIO_printf(bio, &quot;%4d client connects that finished\n&quot;,
+	       SSL_CTX_sess_connect_good(ctx));
+    BIO_printf(bio, &quot;%4d server connects (SSL_accept())\n&quot;,
+	       SSL_CTX_sess_accept(ctx));
+    BIO_printf(bio, &quot;%4d server connects that finished\n&quot;,
+	       SSL_CTX_sess_accept_good(ctx));
+    BIO_printf(bio, &quot;%4d session cache hits\n&quot;, SSL_CTX_sess_hits(ctx));
+    BIO_printf(bio, &quot;%4d session cache misses\n&quot;, SSL_CTX_sess_misses(ctx));
+    BIO_printf(bio, &quot;%4d session cache timeouts\n&quot;, SSL_CTX_sess_timeouts(ctx));
 }
 
 static void sv_usage(void)
 {
-    fprintf(stderr, &quot;usage: ssltest [args ...]\n&quot;);
-    fprintf(stderr, &quot;\n&quot;);
-    fprintf(stderr, &quot; -server_auth  - check server certificate\n&quot;);
-    fprintf(stderr, &quot; -client_auth  - do client authentication\n&quot;);
-    fprintf(stderr, &quot; -v            - more output\n&quot;);
-    fprintf(stderr, &quot; -CApath arg   - PEM format directory of CA's\n&quot;);
-    fprintf(stderr, &quot; -CAfile arg   - PEM format file of CA's\n&quot;);
-    fprintf(stderr, &quot; -threads arg  - number of threads\n&quot;);
-    fprintf(stderr, &quot; -loops arg    - number of 'connections', per thread\n&quot;);
-    fprintf(stderr, &quot; -reconnect    - reuse session-id's\n&quot;);
-    fprintf(stderr, &quot; -stats        - server session-id cache stats\n&quot;);
-    fprintf(stderr, &quot; -cert arg     - server certificate/key\n&quot;);
-    fprintf(stderr, &quot; -ccert arg    - client certificate/key\n&quot;);
-    fprintf(stderr, &quot; -ssl3         - just SSLv3n\n&quot;);
+    BIO_printf(bio_err, &quot;usage: ssltest [args ...]\n&quot;);
+    BIO_printf(bio_err, &quot;\n&quot;);
+    BIO_printf(bio_err, &quot; -server_auth  - check server certificate\n&quot;);
+    BIO_printf(bio_err, &quot; -client_auth  - do client authentication\n&quot;);
+    BIO_printf(bio_err, &quot; -v            - more output\n&quot;);
+    BIO_printf(bio_err, &quot; -CApath arg   - PEM format directory of CA's\n&quot;);
+    BIO_printf(bio_err, &quot; -CAfile arg   - PEM format file of CA's\n&quot;);
+    BIO_printf(bio_err, &quot; -threads arg  - number of threads\n&quot;);
+    BIO_printf(bio_err, &quot; -loops arg    - number of 'connections', per thread\n&quot;);
+    BIO_printf(bio_err, &quot; -reconnect    - reuse session-id's\n&quot;);
+    BIO_printf(bio_err, &quot; -stats        - server session-id cache stats\n&quot;);
+    BIO_printf(bio_err, &quot; -cert arg     - server certificate/key\n&quot;);
+    BIO_printf(bio_err, &quot; -ccert arg    - client certificate/key\n&quot;);
+    BIO_printf(bio_err, &quot; -ssl3         - just SSLv3n\n&quot;);
 }
 
 int main(int argc, char *argv[])
@@ -195,14 +188,14 @@ int main(int argc, char *argv[])
     SSL_CTX *c_ctx = NULL;
     char *scert = TEST_SERVER_CERT;
     char *ccert = TEST_CLIENT_CERT;
-    SSL_METHOD *ssl_method = SSLv23_method();
+    const SSL_METHOD *ssl_method = SSLv23_method();
 
     RAND_seed(rnd_seed, sizeof rnd_seed);
 
     if (bio_err == NULL)
-        bio_err = BIO_new_fp(stderr, BIO_NOCLOSE);
+        bio_err = BIO_new_fd(2, BIO_NOCLOSE);
     if (bio_stdout == NULL)
-        bio_stdout = BIO_new_fp(stdout, BIO_NOCLOSE);
+        bio_stdout = BIO_new_fd(1, BIO_NOCLOSE);
     argc--;
     argv++;
 
@@ -250,7 +243,7 @@ int main(int argc, char *argv[])
             if (number_of_loops == 0)
                 number_of_loops = 1;
         } else {
-            fprintf(stderr, &quot;unknown option %s\n&quot;, *argv);
+            BIO_printf(bio_err, &quot;unknown option %s\n&quot;, *argv);
             badop = 1;
             break;
         }
@@ -284,9 +277,12 @@ int main(int argc, char *argv[])
                                    SSL_SESS_CACHE_SERVER);
 
     if (!SSL_CTX_use_certificate_file(s_ctx, scert, SSL_FILETYPE_PEM)) {
+        BIO_printf(bio_err, &quot;SSL_CTX_use_certificate_file (%s)\n&quot;, scert);
         ERR_print_errors(bio_err);
+        goto end;
     } else
         if (!SSL_CTX_use_RSAPrivateKey_file(s_ctx, scert, SSL_FILETYPE_PEM)) {
+        BIO_printf(bio_err, &quot;SSL_CTX_use_RSAPrivateKey_file (%s)\n&quot;, scert);
         ERR_print_errors(bio_err);
         goto end;
     }
@@ -300,19 +296,19 @@ int main(int argc, char *argv[])
         (!SSL_CTX_set_default_verify_paths(s_ctx)) ||
         (!SSL_CTX_load_verify_locations(c_ctx, CAfile, CApath)) ||
         (!SSL_CTX_set_default_verify_paths(c_ctx))) {
-        fprintf(stderr, &quot;SSL_load_verify_locations\n&quot;);
+        BIO_printf(bio_err, &quot;SSL_load_verify_locations\n&quot;);
         ERR_print_errors(bio_err);
         goto end;
     }
 
     if (client_auth) {
-        fprintf(stderr, &quot;client authentication\n&quot;);
+        BIO_printf(bio_err, &quot;client authentication\n&quot;);
         SSL_CTX_set_verify(s_ctx,
                            SSL_VERIFY_PEER | SSL_VERIFY_FAIL_IF_NO_PEER_CERT,
                            verify_callback);
     }
     if (server_auth) {
-        fprintf(stderr, &quot;server authentication\n&quot;);
+        BIO_printf(bio_err, &quot;server authentication\n&quot;);
         SSL_CTX_set_verify(c_ctx, SSL_VERIFY_PEER, verify_callback);
     }
 
@@ -322,24 +318,24 @@ int main(int argc, char *argv[])
  end:
 
     if (c_ctx != NULL) {
-        fprintf(stderr, &quot;Client SSL_CTX stats then free it\n&quot;);
-        print_stats(stderr, c_ctx);
+        BIO_printf(bio_err, &quot;Client SSL_CTX stats then free it\n&quot;);
+        print_stats(bio_err, c_ctx);
         SSL_CTX_free(c_ctx);
     }
     if (s_ctx != NULL) {
-        fprintf(stderr, &quot;Server SSL_CTX stats then free it\n&quot;);
-        print_stats(stderr, s_ctx);
+        BIO_printf(bio_err, &quot;Server SSL_CTX stats then free it\n&quot;);
+        print_stats(bio_err, s_ctx);
         if (cache_stats) {
-            fprintf(stderr, &quot;-----\n&quot;);
-            lh_stats(SSL_CTX_sessions(s_ctx), stderr);
-            fprintf(stderr, &quot;-----\n&quot;);
-    /*-     lh_node_stats(SSL_CTX_sessions(s_ctx),stderr);
-            fprintf(stderr,&quot;-----\n&quot;); */
-            lh_node_usage_stats(SSL_CTX_sessions(s_ctx), stderr);
-            fprintf(stderr, &quot;-----\n&quot;);
+            BIO_printf(bio_err, &quot;-----\n&quot;);
+            lh_SSL_SESSION_stats_bio(SSL_CTX_sessions(s_ctx), bio_err);
+            BIO_printf(bio_err, &quot;-----\n&quot;);
+    /*-     lh_SSL_SESSION_node_stats_bio(SSL_CTX_sessions(s_ctx),bio_err);
+            BIO_printf(bio_err,&quot;-----\n&quot;); */
+            lh_SSL_SESSION_node_usage_stats_bio(SSL_CTX_sessions(s_ctx), bio_err);
+            BIO_printf(bio_err, &quot;-----\n&quot;);
         }
         SSL_CTX_free(s_ctx);
-        fprintf(stderr, &quot;done free\n&quot;);
+        BIO_printf(bio_err, &quot;done free\n&quot;);
     }
     exit(ret);
     return (0);
@@ -355,6 +351,7 @@ int ndoit(SSL_CTX *ssl_ctx[2])
     int i;
     int ret;
     char *ctx[4];
+    CRYPTO_THREADID thread_id;
 
     ctx[0] = (char *)ssl_ctx[0];
     ctx[1] = (char *)ssl_ctx[1];
@@ -367,22 +364,24 @@ int ndoit(SSL_CTX *ssl_ctx[2])
         ctx[3] = NULL;
     }
 
-    fprintf(stdout, &quot;started thread %lu\n&quot;, CRYPTO_thread_id());
+    CRYPTO_THREADID_current(&amp;thread_id);
+    BIO_printf(bio_stdout, &quot;started thread %lu\n&quot;,
+	       CRYPTO_THREADID_hash(&amp;thread_id));
     for (i = 0; i &lt; number_of_loops; i++) {
-/*-     fprintf(stderr,&quot;%4d %2d ctx-&gt;ref (%3d,%3d)\n&quot;,
-            CRYPTO_thread_id(),i,
-            ssl_ctx[0]-&gt;references,
-            ssl_ctx[1]-&gt;references); */
+/*-     BIO_printf(bio_err,&quot;%4d %2d ctx-&gt;ref (%3d,%3d)\n&quot;,
+                   CRYPTO_THREADID_hash(&amp;thread_id),i,
+                   ssl_ctx[0]-&gt;references,
+                   ssl_ctx[1]-&gt;references); */
 /*      pthread_delay_np(&amp;tm); */
 
         ret = doit(ctx);
         if (ret != 0) {
-            fprintf(stdout, &quot;error[%d] %lu - %d\n&quot;,
-                    i, CRYPTO_thread_id(), ret);
+            BIO_printf(bio_stdout, &quot;error[%d] %lu - %d\n&quot;,
+                       i, CRYPTO_THREADID_hash(&amp;thread_id), ret);
             return (ret);
         }
     }
-    fprintf(stdout, &quot;DONE %lu\n&quot;, CRYPTO_thread_id());
+    BIO_printf(bio_stdout, &quot;DONE %lu\n&quot;, CRYPTO_THREADID_hash(&amp;thread_id));
     if (reconnect) {
         SSL_free((SSL *)ctx[2]);
         SSL_free((SSL *)ctx[3]);
@@ -467,26 +466,26 @@ int doit(char *ctx[4])
 
         if (do_server &amp;&amp; verbose) {
             if (SSL_in_init(s_ssl))
-                printf(&quot;server waiting in SSL_accept - %s\n&quot;,
-                       SSL_state_string_long(s_ssl));
+                BIO_printf(bio_stdout, &quot;server waiting in SSL_accept - %s\n&quot;,
+                           SSL_state_string_long(s_ssl));
             else if (s_write)
-                printf(&quot;server:SSL_write()\n&quot;);
+                BIO_printf(bio_stdout, &quot;server:SSL_write()\n&quot;);
             else
-                printf(&quot;server:SSL_read()\n&quot;);
+                BIO_printf(bio_stdout, &quot;server:SSL_read()\n&quot;);
         }
 
         if (do_client &amp;&amp; verbose) {
             if (SSL_in_init(c_ssl))
-                printf(&quot;client waiting in SSL_connect - %s\n&quot;,
-                       SSL_state_string_long(c_ssl));
+                BIO_printf(bio_stdout, &quot;client waiting in SSL_connect - %s\n&quot;,
+                           SSL_state_string_long(c_ssl));
             else if (c_write)
-                printf(&quot;client:SSL_write()\n&quot;);
+                BIO_printf(bio_stdout, &quot;client:SSL_write()\n&quot;);
             else
-                printf(&quot;client:SSL_read()\n&quot;);
+                BIO_printf(bio_stdout, &quot;client:SSL_read()\n&quot;);
         }
 
         if (!do_client &amp;&amp; !do_server) {
-            fprintf(stdout, &quot;ERROR IN STARTUP\n&quot;);
+            BIO_printf(bio_stdout, &quot;ERROR IN STARTUP\n&quot;);
             break;
         }
         if (do_client &amp;&amp; !(done &amp; C_DONE)) {
@@ -501,12 +500,12 @@ int doit(char *ctx[4])
                         if (BIO_should_write(c_bio))
                             c_w = 1;
                     } else {
-                        fprintf(stderr, &quot;ERROR in CLIENT\n&quot;);
+                        BIO_printf(bio_err, &quot;ERROR in CLIENT\n&quot;);
                         ERR_print_errors_fp(stderr);
                         return (1);
                     }
                 } else if (i == 0) {
-                    fprintf(stderr, &quot;SSL CLIENT STARTUP FAILED\n&quot;);
+                    BIO_printf(bio_err, &quot;SSL CLIENT STARTUP FAILED\n&quot;);
                     return (1);
                 } else {
                     /* ok */
@@ -523,19 +522,19 @@ int doit(char *ctx[4])
                         if (BIO_should_write(c_bio))
                             c_w = 1;
                     } else {
-                        fprintf(stderr, &quot;ERROR in CLIENT\n&quot;);
+                        BIO_printf(bio_err, &quot;ERROR in CLIENT\n&quot;);
                         ERR_print_errors_fp(stderr);
                         return (1);
                     }
                 } else if (i == 0) {
-                    fprintf(stderr, &quot;SSL CLIENT STARTUP FAILED\n&quot;);
+                    BIO_printf(bio_err, &quot;SSL CLIENT STARTUP FAILED\n&quot;);
                     return (1);
                 } else {
                     done |= C_DONE;
 #ifdef undef
-                    fprintf(stdout, &quot;CLIENT:from server:&quot;);
-                    fwrite(cbuf, 1, i, stdout);
-                    fflush(stdout);
+                    BIO_printf(bio_stdout, &quot;CLIENT:from server:&quot;);
+                    BIO_write(bio_stdout, cbuf, i);
+                    BIO_flush(bio_stdout);
 #endif
                 }
             }
@@ -553,20 +552,20 @@ int doit(char *ctx[4])
                         if (BIO_should_write(s_bio))
                             s_w = 1;
                     } else {
-                        fprintf(stderr, &quot;ERROR in SERVER\n&quot;);
+                        BIO_printf(bio_err, &quot;ERROR in SERVER\n&quot;);
                         ERR_print_errors_fp(stderr);
                         return (1);
                     }
                 } else if (i == 0) {
-                    fprintf(stderr, &quot;SSL SERVER STARTUP FAILED\n&quot;);
+                    BIO_printf(bio_err, &quot;SSL SERVER STARTUP FAILED\n&quot;);
                     return (1);
                 } else {
                     s_write = 1;
                     s_w = 1;
 #ifdef undef
-                    fprintf(stdout, &quot;SERVER:from client:&quot;);
-                    fwrite(sbuf, 1, i, stdout);
-                    fflush(stdout);
+                    BIO_printf(bio_stdout, &quot;SERVER:from client:&quot;);
+                    BIO_write(bio_stdout, sbuf, i);
+                    BIO_flush(bio_stdout);
 #endif
                 }
             } else {
@@ -580,12 +579,12 @@ int doit(char *ctx[4])
                         if (BIO_should_write(s_bio))
                             s_w = 1;
                     } else {
-                        fprintf(stderr, &quot;ERROR in SERVER\n&quot;);
+                        BIO_printf(bio_err, &quot;ERROR in SERVER\n&quot;);
                         ERR_print_errors_fp(stderr);
                         return (1);
                     }
                 } else if (i == 0) {
-                    fprintf(stderr, &quot;SSL SERVER STARTUP FAILED\n&quot;);
+                    BIO_printf(bio_err, &quot;SSL SERVER STARTUP FAILED\n&quot;);
                     return (1);
                 } else {
                     s_write = 0;
@@ -606,7 +605,7 @@ int doit(char *ctx[4])
     SSL_set_shutdown(s_ssl, SSL_SENT_SHUTDOWN | SSL_RECEIVED_SHUTDOWN);
 
 #ifdef undef
-    fprintf(stdout, &quot;DONE\n&quot;);
+    BIO_printf(bio_stdout, &quot;DONE\n&quot;);
 #endif
  err:
     /*
@@ -640,7 +639,7 @@ int doit(char *ctx[4])
     return (0);
 }
 
-int MS_CALLBACK verify_callback(int ok, X509_STORE_CTX *ctx)
+int verify_callback(int ok, X509_STORE_CTX *ctx)
 {
     char *s, buf[256];
 
@@ -649,9 +648,9 @@ int MS_CALLBACK verify_callback(int ok, X509_STORE_CTX *ctx)
                               buf, 256);
         if (s != NULL) {
             if (ok)
-                fprintf(stderr, &quot;depth=%d %s\n&quot;, ctx-&gt;error_depth, buf);
+                BIO_printf(bio_err, &quot;depth=%d %s\n&quot;, ctx-&gt;error_depth, buf);
             else
-                fprintf(stderr, &quot;depth=%d error=%d %s\n&quot;,
+                BIO_printf(bio_err, &quot;depth=%d error=%d %s\n&quot;,
                         ctx-&gt;error_depth, ctx-&gt;error, buf);
         }
     }
@@ -688,7 +687,7 @@ void thread_cleanup(void)
     OPENSSL_free(lock_cs);
 }
 
-void win32_locking_callback(int mode, int type, char *file, int line)
+void win32_locking_callback(int mode, int type, const char *file, int line)
 {
     if (mode &amp; CRYPTO_LOCK) {
         WaitForSingleObject(lock_cs[type], INFINITE);
@@ -717,7 +716,7 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
                                         (void *)ssl_ctx, 0L, &amp;(thread_id[i]));
     }
 
-    printf(&quot;reaping\n&quot;);
+    BIO_printf(bio_stdout, &quot;reaping\n&quot;);
     for (i = 0; i &lt; thread_number; i += 50) {
         int j;
 
@@ -727,7 +726,7 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
                                    (CONST HANDLE *) &amp; (thread_handle[i]),
                                    TRUE, INFINITE)
             == WAIT_FAILED) {
-            fprintf(stderr, &quot;WaitForMultipleObjects failed:%d\n&quot;,
+            BIO_printf(bio_err, &quot;WaitForMultipleObjects failed:%d\n&quot;,
                     GetLastError());
             exit(1);
         }
@@ -743,7 +742,7 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
     ret = (ret + end.wSecond - start.wSecond);
     ret += (end.wMilliseconds - start.wMilliseconds) / 1000.0;
 
-    printf(&quot;win32 threads done - %.3f seconds\n&quot;, ret);
+    BIO_printf(bio_stdout, &quot;win32 threads done - %.3f seconds\n&quot;, ret);
 }
 
 #endif                          /* OPENSSL_SYS_WIN32 */
@@ -768,8 +767,8 @@ void thread_setup(void)
         mutex_init(&amp;(lock_cs[i]), USYNC_THREAD, NULL);
     }
 
-    CRYPTO_set_id_callback((unsigned long (*)())solaris_thread_id);
-    CRYPTO_set_locking_callback((void (*)())solaris_locking_callback);
+    CRYPTO_set_id_callback(solaris_thread_id);
+    CRYPTO_set_locking_callback(solaris_locking_callback);
 }
 
 void thread_cleanup(void)
@@ -778,34 +777,34 @@ void thread_cleanup(void)
 
     CRYPTO_set_locking_callback(NULL);
 
-    fprintf(stderr, &quot;cleanup\n&quot;);
+    BIO_printf(bio_err, &quot;cleanup\n&quot;);
 
     for (i = 0; i &lt; CRYPTO_num_locks(); i++) {
         /* rwlock_destroy(&amp;(lock_cs[i])); */
         mutex_destroy(&amp;(lock_cs[i]));
-        fprintf(stderr, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
+        BIO_printf(bio_err, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
     }
     OPENSSL_free(lock_cs);
     OPENSSL_free(lock_count);
 
-    fprintf(stderr, &quot;done cleanup\n&quot;);
+    BIO_printf(bio_err, &quot;done cleanup\n&quot;);
 
 }
 
-void solaris_locking_callback(int mode, int type, char *file, int line)
+void solaris_locking_callback(int mode, int type, const char *file, int line)
 {
 # ifdef undef
-    fprintf(stderr, &quot;thread=%4d mode=%s lock=%s %s:%d\n&quot;,
-            CRYPTO_thread_id(),
-            (mode &amp; CRYPTO_LOCK) ? &quot;l&quot; : &quot;u&quot;,
-            (type &amp; CRYPTO_READ) ? &quot;r&quot; : &quot;w&quot;, file, line);
+    BIO_printf(bio_err, &quot;thread=%4d mode=%s lock=%s %s:%d\n&quot;,
+               CRYPTO_thread_id(),
+               (mode &amp; CRYPTO_LOCK) ? &quot;l&quot; : &quot;u&quot;,
+               (type &amp; CRYPTO_READ) ? &quot;r&quot; : &quot;w&quot;, file, line);
 # endif
 
     /*-
     if (CRYPTO_LOCK_SSL_CERT == type)
-    fprintf(stderr,&quot;(t,m,f,l) %ld %d %s %d\n&quot;,
-            CRYPTO_thread_id(),
-            mode,file,line);
+    BIO_printf(bio_err,&quot;(t,m,f,l) %ld %d %s %d\n&quot;,
+               CRYPTO_thread_id(),
+               mode,file,line);
     */
     if (mode &amp; CRYPTO_LOCK) {
         /*-
@@ -837,21 +836,22 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
                    (void *(*)())ndoit, (void *)ssl_ctx, 0L, &amp;(thread_ctx[i]));
     }
 
-    printf(&quot;reaping\n&quot;);
+    BIO_printf(bio_stdout, &quot;reaping\n&quot;);
     for (i = 0; i &lt; thread_number; i++) {
         thr_join(thread_ctx[i], NULL, NULL);
     }
 
-    printf(&quot;solaris threads done (%d,%d)\n&quot;,
-           s_ctx-&gt;references, c_ctx-&gt;references);
+#if 0 /* We can't currently find out the reference amount */
+    BIO_printf(bio_stdout, &quot;solaris threads done (%d,%d)\n&quot;,
+               s_ctx-&gt;references, c_ctx-&gt;references);
+#else
+    BIO_printf(bio_stdout, &quot;solaris threads done\n&quot;);
+#endif
 }
 
-unsigned long solaris_thread_id(void)
+void solaris_thread_id(CRYPTO_THREADID *tid)
 {
-    unsigned long ret;
-
-    ret = (unsigned long)thr_self();
-    return (ret);
+    CRYPTO_THREADID_set_numeric((unsigned long)thr_self());
 }
 #endif                          /* SOLARIS */
 
@@ -880,8 +880,8 @@ void thread_setup(void)
         lock_cs[i] = usnewsema(arena, 1);
     }
 
-    CRYPTO_set_id_callback((unsigned long (*)())irix_thread_id);
-    CRYPTO_set_locking_callback((void (*)())irix_locking_callback);
+    CRYPTO_set_id_callback(irix_thread_id);
+    CRYPTO_set_locking_callback(irix_locking_callback);
 }
 
 void thread_cleanup(void)
@@ -899,13 +899,13 @@ void thread_cleanup(void)
     OPENSSL_free(lock_cs);
 }
 
-void irix_locking_callback(int mode, int type, char *file, int line)
+void irix_locking_callback(int mode, int type, const char *file, int line)
 {
     if (mode &amp; CRYPTO_LOCK) {
-        printf(&quot;lock %d\n&quot;, type);
+        BIO_printf(bio_stdout, &quot;lock %d\n&quot;, type);
         uspsema(lock_cs[type]);
     } else {
-        printf(&quot;unlock %d\n&quot;, type);
+        BIO_printf(bio_stdout, &quot;unlock %d\n&quot;, type);
         usvsema(lock_cs[type]);
     }
 }
@@ -924,21 +924,22 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
                               PR_SADDR | PR_SFDS, (void *)ssl_ctx);
     }
 
-    printf(&quot;reaping\n&quot;);
+    BIO_printf(bio_stdout, &quot;reaping\n&quot;);
     for (i = 0; i &lt; thread_number; i++) {
         wait(NULL);
     }
 
-    printf(&quot;irix threads done (%d,%d)\n&quot;,
-           s_ctx-&gt;references, c_ctx-&gt;references);
+#if 0 /* We can't currently find out the reference amount */
+    BIO_printf(bio_stdout, &quot;irix threads done (%d,%d)\n&quot;,
+               s_ctx-&gt;references, c_ctx-&gt;references);
+#else
+    BIO_printf(bio_stdout, &quot;irix threads done\n&quot;);
+#endif
 }
 
 unsigned long irix_thread_id(void)
 {
-    unsigned long ret;
-
-    ret = (unsigned long)getpid();
-    return (ret);
+    CRYPTO_THREADID_set_numeric((unsigned long)getpid());
 }
 #endif                          /* IRIX */
 
@@ -958,8 +959,8 @@ void thread_setup(void)
         pthread_mutex_init(&amp;(lock_cs[i]), NULL);
     }
 
-    CRYPTO_set_id_callback((unsigned long (*)())pthreads_thread_id);
-    CRYPTO_set_locking_callback((void (*)())pthreads_locking_callback);
+    CRYPTO_THREADID_set_callback(pthreads_thread_id);
+    CRYPTO_set_locking_callback(pthreads_locking_callback);
 }
 
 void thread_cleanup(void)
@@ -967,30 +968,30 @@ void thread_cleanup(void)
     int i;
 
     CRYPTO_set_locking_callback(NULL);
-    fprintf(stderr, &quot;cleanup\n&quot;);
+    BIO_printf(bio_err, &quot;cleanup\n&quot;);
     for (i = 0; i &lt; CRYPTO_num_locks(); i++) {
         pthread_mutex_destroy(&amp;(lock_cs[i]));
-        fprintf(stderr, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
+        BIO_printf(bio_err, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
     }
     OPENSSL_free(lock_cs);
     OPENSSL_free(lock_count);
 
-    fprintf(stderr, &quot;done cleanup\n&quot;);
+    BIO_printf(bio_err, &quot;done cleanup\n&quot;);
 }
 
-void pthreads_locking_callback(int mode, int type, char *file, int line)
+void pthreads_locking_callback(int mode, int type, const char *file, int line)
 {
 # ifdef undef
-    fprintf(stderr, &quot;thread=%4d mode=%s lock=%s %s:%d\n&quot;,
-            CRYPTO_thread_id(),
-            (mode &amp; CRYPTO_LOCK) ? &quot;l&quot; : &quot;u&quot;,
-            (type &amp; CRYPTO_READ) ? &quot;r&quot; : &quot;w&quot;, file, line);
+    BIO_printf(bio_err, &quot;thread=%4d mode=%s lock=%s %s:%d\n&quot;,
+               CRYPTO_thread_id(),
+               (mode &amp; CRYPTO_LOCK) ? &quot;l&quot; : &quot;u&quot;,
+               (type &amp; CRYPTO_READ) ? &quot;r&quot; : &quot;w&quot;, file, line);
 # endif
 /*-
     if (CRYPTO_LOCK_SSL_CERT == type)
-            fprintf(stderr,&quot;(t,m,f,l) %ld %d %s %d\n&quot;,
-            CRYPTO_thread_id(),
-            mode,file,line);
+            BIO_printf(bio_err,&quot;(t,m,f,l) %ld %d %s %d\n&quot;,
+                       CRYPTO_thread_id(),
+                       mode,file,line);
 */
     if (mode &amp; CRYPTO_LOCK) {
         pthread_mutex_lock(&amp;(lock_cs[type]));
@@ -1017,21 +1018,22 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
                        (void *(*)())ndoit, (void *)ssl_ctx);
     }
 
-    printf(&quot;reaping\n&quot;);
+    BIO_printf(bio_stdout, &quot;reaping\n&quot;);
     for (i = 0; i &lt; thread_number; i++) {
         pthread_join(thread_ctx[i], NULL);
     }
 
-    printf(&quot;pthreads threads done (%d,%d)\n&quot;,
-           s_ctx-&gt;references, c_ctx-&gt;references);
+#if 0 /* We can't currently find out the reference amount */
+    BIO_printf(bio_stdout, &quot;pthreads threads done (%d,%d)\n&quot;,
+               s_ctx-&gt;references, c_ctx-&gt;references);
+#else
+    BIO_printf(bio_stdout, &quot;pthreads threads done\n&quot;);
+#endif
 }
 
-unsigned long pthreads_thread_id(void)
+void pthreads_thread_id(CRYPTO_THREADID *tid)
 {
-    unsigned long ret;
-
-    ret = (unsigned long)pthread_self();
-    return (ret);
+    CRYPTO_THREADID_set_numeric(tid, (unsigned long)pthread_self());
 }
 
 #endif                          /* PTHREADS */
@@ -1051,8 +1053,8 @@ void thread_setup(void)
 
     ThreadSem = MPKSemaphoreAlloc(&quot;OpenSSL mttest semaphore&quot;, 0);
 
-    CRYPTO_set_id_callback((unsigned long (*)())netware_thread_id);
-    CRYPTO_set_locking_callback((void (*)())netware_locking_callback);
+    CRYPTO_set_id_callback(netware_thread_id);
+    CRYPTO_set_locking_callback(netware_locking_callback);
 }
 
 void thread_cleanup(void)
@@ -1061,21 +1063,21 @@ void thread_cleanup(void)
 
     CRYPTO_set_locking_callback(NULL);
 
-    fprintf(stdout, &quot;thread_cleanup\n&quot;);
+    BIO_printf(bio_stdout, &quot;thread_cleanup\n&quot;);
 
     for (i = 0; i &lt; CRYPTO_num_locks(); i++) {
         MPKMutexFree(lock_cs[i]);
-        fprintf(stdout, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
+        BIO_printf(bio_stdout, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
     }
     OPENSSL_free(lock_cs);
     OPENSSL_free(lock_count);
 
     MPKSemaphoreFree(ThreadSem);
 
-    fprintf(stdout, &quot;done cleanup\n&quot;);
+    BIO_printf(bio_stdout, &quot;done cleanup\n&quot;);
 }
 
-void netware_locking_callback(int mode, int type, char *file, int line)
+void netware_locking_callback(int mode, int type, const char *file, int line)
 {
     if (mode &amp; CRYPTO_LOCK) {
         MPKMutexLock(lock_cs[type]);
@@ -1097,22 +1099,23 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
         ThreadSwitchWithDelay();
     }
 
-    printf(&quot;reaping\n&quot;);
+    BIO_printf(bio_stdout, &quot;reaping\n&quot;);
 
     /* loop until all threads have signaled the semaphore */
     for (i = 0; i &lt; thread_number; i++) {
         MPKSemaphoreWait(ThreadSem);
     }
-    printf(&quot;netware threads done (%d,%d)\n&quot;,
-           s_ctx-&gt;references, c_ctx-&gt;references);
+#if 0 /* We can't currently find out the reference amount */
+    BIO_printf(bio_stdout, &quot;netware threads done (%d,%d)\n&quot;,
+               s_ctx-&gt;references, c_ctx-&gt;references);
+#else
+    BIO_printf(bio_stdout, &quot;netware threads done\n&quot;);
+#endif
 }
 
 unsigned long netware_thread_id(void)
 {
-    unsigned long ret;
-
-    ret = (unsigned long)GetThreadID();
-    return (ret);
+    CRYPTO_THREADID_set_numeric((unsigned long)GetThreadID());
 }
 #endif                          /* NETWARE */
 
@@ -1144,24 +1147,24 @@ void thread_cleanup(void)
     int i;
 
     CRYPTO_set_locking_callback(NULL);
-    fprintf(stderr, &quot;cleanup\n&quot;);
+    BIO_printf(bio_err, &quot;cleanup\n&quot;);
     for (i = 0; i &lt; CRYPTO_num_locks(); i++) {
         delete lock_cs[i];
-        fprintf(stderr, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
+        BIO_printf(bio_err, &quot;%8ld:%s\n&quot;, lock_count[i], CRYPTO_get_lock_name(i));
     }
     OPENSSL_free(lock_cs);
     OPENSSL_free(lock_count);
 
-    fprintf(stderr, &quot;done cleanup\n&quot;);
+    BIO_printf(bio_err, &quot;done cleanup\n&quot;);
 }
 
 void beos_locking_callback(int mode, int type, const char *file, int line)
 {
 # if 0
-    fprintf(stderr, &quot;thread=%4d mode=%s lock=%s %s:%d\n&quot;,
-            CRYPTO_thread_id(),
-            (mode &amp; CRYPTO_LOCK) ? &quot;l&quot; : &quot;u&quot;,
-            (type &amp; CRYPTO_READ) ? &quot;r&quot; : &quot;w&quot;, file, line);
+    BIO_printf(bio_err, &quot;thread=%4d mode=%s lock=%s %s:%d\n&quot;,
+               CRYPTO_thread_id(),
+               (mode &amp; CRYPTO_LOCK) ? &quot;l&quot; : &quot;u&quot;,
+               (type &amp; CRYPTO_READ) ? &quot;r&quot; : &quot;w&quot;, file, line);
 # endif
     if (mode &amp; CRYPTO_LOCK) {
         lock_cs[type]-&gt;Lock();
@@ -1187,14 +1190,14 @@ void do_threads(SSL_CTX *s_ctx, SSL_CTX *c_ctx)
         resume_thread(thread_ctx[i]);
     }
 
-    printf(&quot;waiting...\n&quot;);
+    BIO_printf(bio_stdout, &quot;waiting...\n&quot;);
     for (i = 0; i &lt; thread_number; i++) {
         status_t result;
         wait_for_thread(thread_ctx[i], &amp;result);
     }
 
-    printf(&quot;beos threads done (%d,%d)\n&quot;,
-           s_ctx-&gt;references, c_ctx-&gt;references);
+    BIO_printf(bio_stdout, &quot;beos threads done (%d,%d)\n&quot;,
+               s_ctx-&gt;references, c_ctx-&gt;references);
 }
 
 unsigned long beos_thread_id(void)
diff --git a/crypto/threads/pthread2.sh b/crypto/threads/pthread2.sh
index 41264c6..ec945c4 100755
--- a/crypto/threads/pthread2.sh
+++ b/crypto/threads/pthread2.sh
@@ -3,5 +3,4 @@
 # build using pthreads where it's already built into the system
 #
 /bin/rm -f mttest
-gcc -DPTHREADS -I../../include -g mttest.c -o mttest -L../.. -lssl -lcrypto -lpthread
-
+gcc -DPTHREADS -I../../include -g mttest.c -o mttest -L../.. -lssl -lcrypto -lpthread -ldl
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001354.html">[openssl-commits] [openssl]  OpenSSL_1_0_2-stable update
</A></li>
	<LI>Next message: <A HREF="001360.html">[openssl-commits] [openssl]  OpenSSL_1_0_2-stable update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1357">[ date ]</a>
              <a href="thread.html#1357">[ thread ]</a>
              <a href="subject.html#1357">[ subject ]</a>
              <a href="author.html#1357">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
