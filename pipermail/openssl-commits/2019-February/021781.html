<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2019-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1549377847.168240.12006.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021779.html">
   <LINK REL="Next"  HREF="021782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1549377847.168240.12006.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Tue Feb  5 14:44:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="021779.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="021782.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21781">[ date ]</a>
              <a href="thread.html#21781">[ thread ]</a>
              <a href="subject.html#21781">[ subject ]</a>
              <a href="author.html#21781">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  d6f4b0a8bfbe901c72294d8923eb5b6f54ca7732 (commit)
      from  3499327bad401eb510d76266428923d06c9c7bb7 (commit)


- Log -----------------------------------------------------------------
commit d6f4b0a8bfbe901c72294d8923eb5b6f54ca7732
Author: Patrick Steuer &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">patrick.steuer at de.ibm.com</A>&gt;
Date:   Mon Feb 6 10:54:54 2017 +0100

    crypto/poly1305/asm/poly1305-s390x.pl: add vx code path.
    
    Signed-off-by: Patrick Steuer &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">patrick.steuer at de.ibm.com</A>&gt;
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/7991">https://github.com/openssl/openssl/pull/7991</A>)

-----------------------------------------------------------------------

Summary of changes:
 crypto/poly1305/asm/poly1305-s390x.pl | 944 ++++++++++++++++++++++++++++------
 1 file changed, 780 insertions(+), 164 deletions(-)

diff --git a/crypto/poly1305/asm/poly1305-s390x.pl b/crypto/poly1305/asm/poly1305-s390x.pl
index 21ca860..390f9ee 100755
--- a/crypto/poly1305/asm/poly1305-s390x.pl
+++ b/crypto/poly1305/asm/poly1305-s390x.pl
@@ -24,204 +24,820 @@
 #
 # On side note, z13 enables vector base 2^26 implementation...
 
-$flavour = shift;
+#
+# January 2019
+#
+# Add vx code path (base 2^26).
+#
+# Copyright IBM Corp. 2019
+# Author: Patrick Steuer &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">patrick.steuer at de.ibm.com</A>&gt;
 
+use strict;
+use FindBin qw($Bin);
+use lib &quot;$Bin/../..&quot;;
+use perlasm::s390x qw(:DEFAULT :VX AUTOLOAD LABEL);
+
+my $flavour = shift;
+
+my ($z,$SIZE_T);
 if ($flavour =~ /3[12]/) {
+	$z=0;	# S/390 ABI
 	$SIZE_T=4;
-	$g=&quot;&quot;;
 } else {
+	$z=1;	# zSeries ABI
 	$SIZE_T=8;
-	$g=&quot;g&quot;;
 }
 
+my $output;
 while (($output=shift) &amp;&amp; ($output!~/\w[\w\-]*\.\w+$/)) {}
-open STDOUT,&quot;&gt;$output&quot;;
 
-$sp=&quot;%r15&quot;;
+my $sp=&quot;%r15&quot;;
+
+# novx code path ctx layout
+# ---------------------------------
+# var		value	base	off
+# ---------------------------------
+# u64 h[3]	hash	2^64	  0
+# u32 pad[2]
+# u64 r[2]	key	2^64	 32
+
+# vx code path ctx layout
+# ---------------------------------
+# var		value	base	off
+# ---------------------------------
+# u32 acc1[5]	r^2-acc	2^26	  0
+# u32 pad
+# u32 acc2[5]	r-acc	2^26	 24
+# u32 pad
+# u32 r1[5]	r	2^26	 48
+# u32 r15[5]	5*r	2^26	 68
+# u32 r2[5]	r^2	2^26	 88
+# u32 r25[5]	5*r^2	2^26	108
+# u32 r4[5]	r^4	2^26	128
+# u32 r45[5]	5*r^4	2^26	148
+
+PERLASM_BEGIN($output);
+
+TEXT	();
+
+################
+# static void poly1305_init(void *ctx, const unsigned char key[16])
+{
+my ($ctx,$key)=map(&quot;%r$_&quot;,(2..3));
+my ($r0,$r1,$r2)=map(&quot;%r$_&quot;,(9,11,13));
 
-my ($ctx,$inp,$len,$padbit) = map(&quot;%r$_&quot;,(2..5));
+sub MUL_RKEY {	# r*=key
+my ($d0hi,$d0lo,$d1hi,$d1lo)=map(&quot;%r$_&quot;,(4..7));
+my ($t0,$t1,$s1)=map(&quot;%r$_&quot;,(8,10,12));
+
+	lg	(&quot;%r0&quot;,&quot;32($ctx)&quot;);
+	lg	(&quot;%r1&quot;,&quot;40($ctx)&quot;);
+
+	srlg	($s1,&quot;%r1&quot;,2);
+	algr	($s1,&quot;%r1&quot;);
+
+	lgr	($d0lo,$r0);
+	lgr	($d1lo,$r1);
+
+	mlgr	($d0hi,&quot;%r0&quot;);
+	lgr	($r1,$d1lo);
+	mlgr	($d1hi,$s1);
+
+	mlgr	($t0,&quot;%r1&quot;);
+	mlgr	($t1,&quot;%r0&quot;);
+
+	algr	($d0lo,$d1lo);
+	lgr	($d1lo,$r2);
+	alcgr	($d0hi,$d1hi);
+	lghi	($d1hi,0);
+
+	algr	($r1,$r0);
+	alcgr	($t1,$t0);
+
+	msgr	($d1lo,$s1);
+	msgr	($r2,&quot;%r0&quot;);
+
+	algr	($r1,$d1lo);
+	alcgr	($t1,$d1hi);
+
+	algr	($r1,$d0hi);
+	alcgr	($r2,$t1);
+
+	lghi	($r0,-4);
+	ngr	($r0,$r2);
+	srlg	($t0,$r2,2);
+	algr	($r0,$t0);
+	lghi	($t1,3);
+	ngr	($r2,$t1);
+
+	algr	($r0,$d0lo);
+	alcgr	($r1,$d1hi);
+	alcgr	($r2,$d1hi);
+}
+
+sub ST_R5R {	# store r,5*r -&gt; base 2^26
+my @d=map(&quot;%r$_&quot;,(4..8));
+my @off=@_;
+
+	lgr	(@d[2],$r0);
+	lr	(&quot;%r1&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[2]);
+	nilh	(&quot;%r1&quot;,1023);
+	lgr	(@d[3],$r1);
+	lr	(@d[0],&quot;%r1&quot;);
+	srlg	(&quot;%r1&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[2],52);
+	lgr	(@d[4],$r2);
+	srlg	(&quot;%r0&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[2],26);
+	sll	(@d[4],24);
+	lr	(@d[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[3]);
+	nilh	(&quot;%r0&quot;,1023);
+	sll	(@d[2],12);
+	lr	(@d[1],&quot;%r0&quot;);
+	&amp;or	(@d[2],&quot;%r1&quot;);
+	srlg	(&quot;%r1&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[3],40);
+	nilh	(@d[2],1023);
+	&amp;or	(@d[4],&quot;%r1&quot;);
+	srlg	(@d[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[3],14);
+	nilh	(@d[4],1023);
+	nilh	(@d[3],1023);
+
+	stm	(@d[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[4],&quot;@off[0]($ctx)&quot;);
+	mhi	(@d[$_],5) for (0..4);
+	stm	(@d[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at d</A>[4],&quot;@off[1]($ctx)&quot;);
+}
 
-$code.=&lt;&lt;___;
-.text
-
-.globl	poly1305_init
-.type	poly1305_init,\@function
-.align	16
-poly1305_init:
-	lghi	%r0,0
-	lghi	%r1,-1
-	stg	%r0,0($ctx)		# zero hash value
-	stg	%r0,8($ctx)
-	stg	%r0,16($ctx)
-
-	cl${g}r	$inp,%r0
-	je	.Lno_key
-
-	lrvg	%r4,0($inp)		# load little-endian key
-	lrvg	%r5,8($inp)
-
-	nihl	%r1,0xffc0		# 0xffffffc0ffffffff
-	srlg	%r0,%r1,4		# 0x0ffffffc0fffffff
-	srlg	%r1,%r1,4
-	nill	%r1,0xfffc		# 0x0ffffffc0ffffffc
-
-	ngr	%r4,%r0
-	ngr	%r5,%r1
-
-	stg	%r4,32($ctx)
-	stg	%r5,40($ctx)
-
-.Lno_key:
-	lghi	%r2,0
-	br	%r14
-.size	poly1305_init,.-poly1305_init
-___
+GLOBL	(&quot;poly1305_init&quot;);
+TYPE	(&quot;poly1305_init&quot;,&quot;\@function&quot;);
+ALIGN	(16);
+LABEL	(&quot;poly1305_init&quot;);
+	lghi	(&quot;%r0&quot;,0);
+	lghi	(&quot;%r1&quot;,-1);
+	stg	(&quot;%r0&quot;,&quot;0($ctx)&quot;);	# zero hash value / acc1
+	stg	(&quot;%r0&quot;,&quot;8($ctx)&quot;);
+	stg	(&quot;%r0&quot;,&quot;16($ctx)&quot;);
+
+&amp;{$z?	\&amp;clgr:\&amp;clr}	($key,&quot;%r0&quot;);
+	je	(&quot;.Ldone&quot;);
+
+	lrvg	(&quot;%r4&quot;,&quot;0($key)&quot;);	# load little-endian key
+	lrvg	(&quot;%r5&quot;,&quot;8($key)&quot;);
+
+	nihl	(&quot;%r1&quot;,0xffc0);		# 0xffffffc0ffffffff
+	srlg	(&quot;%r0&quot;,&quot;%r1&quot;,4);	# 0x0ffffffc0fffffff
+	srlg	(&quot;%r1&quot;,&quot;%r1&quot;,4);
+	nill	(&quot;%r1&quot;,0xfffc);		# 0x0ffffffc0ffffffc
+
+	ngr	(&quot;%r4&quot;,&quot;%r0&quot;);
+	ngr	(&quot;%r5&quot;,&quot;%r1&quot;);
+
+	stg	(&quot;%r4&quot;,&quot;32($ctx)&quot;);
+	stg	(&quot;%r5&quot;,&quot;40($ctx)&quot;);
+
+	larl	(&quot;%r1&quot;,&quot;OPENSSL_s390xcap_P&quot;);
+	lg	(&quot;%r0&quot;,&quot;16(%r1)&quot;);
+	tmhh	(&quot;%r0&quot;,0x4000);		# check for vector facility
+	jz	(&quot;.Ldone&quot;);
+
+	larl	(&quot;%r4&quot;,&quot;poly1305_blocks_vx&quot;);
+	larl	(&quot;%r5&quot;,&quot;poly1305_emit_vx&quot;);
+
+&amp;{$z?	\&amp;stmg:\&amp;stm}	(&quot;%r6&quot;,&quot;%r13&quot;,&quot;6*$SIZE_T($sp)&quot;);
+&amp;{$z?	\&amp;stmg:\&amp;stm}	(&quot;%r4&quot;,&quot;%r5&quot;,&quot;4*$z+228($ctx)&quot;);
+
+	lg	($r0,&quot;32($ctx)&quot;);
+	lg	($r1,&quot;40($ctx)&quot;);
+	lghi	($r2,0);
+
+	ST_R5R	(48,68);	# store r,5*r
+
+	MUL_RKEY();
+	ST_R5R	(88,108);	# store r^2,5*r^2
+
+	MUL_RKEY();
+	MUL_RKEY();
+	ST_R5R	(128,148);	# store r^4,5*r^4
+
+	lghi	(&quot;%r0&quot;,0);
+	stg	(&quot;%r0&quot;,&quot;24($ctx)&quot;);	# zero acc2
+	stg	(&quot;%r0&quot;,&quot;32($ctx)&quot;);
+	stg	(&quot;%r0&quot;,&quot;40($ctx)&quot;);
+
+&amp;{$z?	\&amp;lmg:\&amp;lm}	(&quot;%r6&quot;,&quot;%r13&quot;,&quot;6*$SIZE_T($sp)&quot;);
+	lghi	(&quot;%r2&quot;,1);
+	br	(&quot;%r14&quot;);
+
+LABEL	(&quot;.Ldone&quot;);
+	lghi	(&quot;%r2&quot;,0);
+	br	(&quot;%r14&quot;);
+SIZE	(&quot;poly1305_init&quot;,&quot;.-poly1305_init&quot;);
+}
+
+# VX CODE PATH
 {
-my ($d0hi,$d0lo,$d1hi,$d1lo,$t0,$h0,$t1,$h1,$h2) = map(&quot;%r$_&quot;,(6..14));
-my ($r0,$r1,$s1) = map(&quot;%r$_&quot;,(0..2));
+my $frame=8*16;
+my @m01=map(&quot;%v$_&quot;,(0..4));
+my @m23=map(&quot;%v$_&quot;,(5..9));
+my @tmp=@m23;
+my @acc=map(&quot;%v$_&quot;,(10..14));
+my @r=map(&quot;%v$_&quot;,(15..19));
+my @r5=map(&quot;%v$_&quot;,(20..24));
+my $padvec=&quot;%v26&quot;;
+my $mask4=&quot;%v27&quot;;
+my @vperm=map(&quot;%v$_&quot;,(28..30));
+my $mask=&quot;%v31&quot;;
+
+sub REDUCE {
+	vesrlg	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0],26);
+	vesrlg	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],26);
+	vn	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0],$mask);
+	vn	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],$mask);
+	vag	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);	# carry 0-&gt;1
+	vag	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);	# carry 3-&gt;4
+
+	vesrlg	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1],26);
+	vesrlg	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4],26);
+	vn	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1],$mask);
+	vn	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4],$mask);
+	veslg	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4],2);
+	vag	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);	# h[4]*=5
+	vag	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);	# carry 1-&gt;2
+	vag	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);	# carry 4-&gt;0
+
+	vesrlg	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2],26);
+	vesrlg	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0],26);
+	vn	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2],$mask);
+	vn	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0],$mask);
+	vag	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);	# carry 2-&gt;3
+	vag	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);	# carry 0-&gt;1
+
+	vesrlg	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],26);
+	vn	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],$mask);
+	vag	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);	# carry 3-&gt;4
+}
 
-$code.=&lt;&lt;___;
-.globl	poly1305_blocks
-.type	poly1305_blocks,\@function
-.align	16
-poly1305_blocks:
-	srl${g}	$len,4			# fixed-up in 64-bit build
-	lghi	%r0,0
-	cl${g}r	$len,%r0
-	je	.Lno_data
+################
+# static void poly1305_blocks_vx(void *ctx, const unsigned char *inp,
+#                                size_t len, u32 padbit)
+{
+my ($ctx,$inp,$len) = map(&quot;%r$_&quot;,(2..4));
+my $padbit=&quot;%r0&quot;;
+
+GLOBL	(&quot;poly1305_blocks_vx&quot;);
+TYPE	(&quot;poly1305_blocks_vx&quot;,&quot;\@function&quot;);
+ALIGN	(16);
+LABEL	(&quot;poly1305_blocks_vx&quot;);
+if ($z) {
+	aghi	($sp,-$frame);
+	vstm	(&quot;%v8&quot;,&quot;%v15&quot;,&quot;0($sp)&quot;);
+} else {
+	std	(&quot;%f4&quot;,&quot;16*$SIZE_T+2*8($sp)&quot;);
+	std	(&quot;%f6&quot;,&quot;16*$SIZE_T+3*8($sp)&quot;);
+	llgfr	($len,$len);
+}
+	llgfr	($padbit,&quot;%r5&quot;);
+	vlef	(@acc[$_],&quot;4*$_($ctx)&quot;,1) for (0..4);	# load acc1
+	larl	(&quot;%r5&quot;,&quot;.Lconst&quot;);
+	vlef	(@acc[$_],&quot;24+4*$_($ctx)&quot;,3) for (0..4);	# load acc2
+	sllg	($padbit,$padbit,24);
+	vlm	(@vperm[0],$mask,&quot;0(%r5)&quot;);	# load vperm ops, mask
+	vgbm	($mask4,0x0707);
+	vlvgp	($padvec,$padbit,$padbit);
+
+	srlg	(&quot;%r1&quot;,$len,6);
+	ltgr	(&quot;%r1&quot;,&quot;%r1&quot;);
+	jz	(&quot;.Lvx_4x_done&quot;);
+
+ALIGN	(16);
+LABEL	(&quot;.Lvx_4x&quot;);
+	vlm	(&quot;%v20&quot;,&quot;%v23&quot;,&quot;0($inp)&quot;);	# load m0,m1,m2,m3
+
+	# m01,m23 -&gt; base 2^26
+
+	vperm	(@m01[0],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[0]);
+	vperm	(@m23[0],&quot;%v22&quot;,&quot;%v23&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[0]);
+	vperm	(@m01[2],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[1]);
+	vperm	(@m23[2],&quot;%v22&quot;,&quot;%v23&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[1]);
+	vperm	(@m01[4],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[2]);
+	vperm	(@m23[4],&quot;%v22&quot;,&quot;%v23&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[2]);
+
+	vesrlg	(@m01[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0],26);
+	vesrlg	(@m23[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[0],26);
+	vesrlg	(@m01[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2],30);
+	vesrlg	(@m23[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[2],30);
+	vesrlg	(@m01[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2],4);
+	vesrlg	(@m23[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[2],4);
+
+	vn	(@m01[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4],$mask4);
+	vn	(@m23[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[4],$mask4);
+for (0..3) {
+	vn	(@m01[$_]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[$_],$mask);
+	vn	(@m23[$_]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[$_],$mask);
+}
+	vaf	(@m01[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4],$padvec);	# pad m01
+	vaf	(@m23[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[4],$padvec);	# pad m23
+
+	# acc = acc * r^4 + m01 * r^2 + m23
+
+	vlrepf	(@r5[$_],&quot;4*$_+108($ctx)&quot;) for (0..4);	# load 5*r^2
+	vlrepf	(@r[$_],&quot;4*$_+88($ctx)&quot;) for (0..4);	# load r^2
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m23</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vlrepf	(@r5[$_],&quot;4*$_+148($ctx)&quot;) for (0..4);	# load 5*r^4
+	vlrepf	(@r[$_],&quot;4*$_+128($ctx)&quot;) for (0..4);	# load r^4
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+	vmalof	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+
+	REDUCE	();
+
+	la	($inp,&quot;64($inp)&quot;);
+	brctg	(&quot;%r1&quot;,&quot;.Lvx_4x&quot;);
+
+ALIGN	(16);
+LABEL	(&quot;.Lvx_4x_done&quot;);
+	tml	($len,32);
+	jz	(&quot;.Lvx_2x_done&quot;);
+
+	vlm	(&quot;%v20&quot;,&quot;%v21&quot;,&quot;0($inp)&quot;);	# load m0,m1
+
+	# m01 -&gt; base 2^26
+
+	vperm	(@m01[0],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[0]);
+	vperm	(@m01[2],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[1]);
+	vperm	(@m01[4],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[2]);
+
+	vesrlg	(@m01[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0],26);
+	vesrlg	(@m01[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2],30);
+	vesrlg	(@m01[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2],4);
+
+	vn	(@m01[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4],$mask4);
+	vn	(@m01[$_]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[$_],$mask) for (0..3);
+
+	vaf	(@m01[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4],$padvec);	# pad m01
+
+	# acc = acc * r^2+ m01
+
+	vlrepf	(@r5[$_],&quot;4*$_+108($ctx)&quot;) for (0..4);	# load 5*r^2
+	vlrepf	(@r[$_],&quot;4*$_+88($ctx)&quot;) for (0..4);	# load r^2
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+	vmalof	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+
+	REDUCE	();
+
+	la	($inp,&quot;32($inp)&quot;);
+
+ALIGN	(16);
+LABEL	(&quot;.Lvx_2x_done&quot;);
+	tml	($len,16);
+	jz	(&quot;.Lvx_done&quot;);
+
+	vleig	($padvec,0,0);
+
+	vzero	(&quot;%v20&quot;);
+	vl	(&quot;%v21&quot;,&quot;0($inp)&quot;);	# load m0
+
+	# m0 -&gt; base 2^26
+
+	vperm	(@m01[0],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[0]);
+	vperm	(@m01[2],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[1]);
+	vperm	(@m01[4],&quot;%v20&quot;,&quot;%v21&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[2]);
+
+	vesrlg	(@m01[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0],26);
+	vesrlg	(@m01[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2],30);
+	vesrlg	(@m01[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2],4);
+
+	vn	(@m01[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4],$mask4);
+	vn	(@m01[$_]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[$_],$mask) for (0..3);
+
+	vaf	(@m01[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4],$padvec);	# pad m0
+
+	# acc = acc * r + m01
+
+	vlrepf	(@r5[$_],&quot;4*$_+68($ctx)&quot;) for (0..4);	# load 5*r
+	vlrepf	(@r[$_],&quot;4*$_+48($ctx)&quot;) for (0..4);	# load r
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at m01</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+	vmalof	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+
+	REDUCE	();
+
+ALIGN	(16);
+LABEL	(&quot;.Lvx_done&quot;);
+	vstef	(@acc[$_],&quot;4*$_($ctx)&quot;,1) for (0..4);	# store acc
+	vstef	(@acc[$_],&quot;24+4*$_($ctx)&quot;,3) for (0..4);
+
+if ($z) {
+	vlm	(&quot;%v8&quot;,&quot;%v15&quot;,&quot;0($sp)&quot;);
+	la	($sp,&quot;$frame($sp)&quot;);
+} else {
+	ld	(&quot;%f4&quot;,&quot;16*$SIZE_T+2*8($sp)&quot;);
+	ld	(&quot;%f6&quot;,&quot;16*$SIZE_T+3*8($sp)&quot;);
+}
+	br	(&quot;%r14&quot;);
+SIZE	(&quot;poly1305_blocks_vx&quot;,&quot;.-poly1305_blocks_vx&quot;);
+}
 
-	stm${g}	%r6,%r14,`6*$SIZE_T`($sp)
+################
+# static void poly1305_emit_vx(void *ctx, unsigned char mac[16],
+#                              const u32 nonce[4])
+{
+my ($ctx,$mac,$nonce) = map(&quot;%r$_&quot;,(2..4));
+
+GLOBL	(&quot;poly1305_emit_vx&quot;);
+TYPE	(&quot;poly1305_emit_vx&quot;,&quot;\@function&quot;);
+ALIGN	(16);
+LABEL	(&quot;poly1305_emit_vx&quot;);
+if ($z) {
+	aghi	($sp,-$frame);
+	vstm	(&quot;%v8&quot;,&quot;%v15&quot;,&quot;0($sp)&quot;);
+} else {
+	std	(&quot;%f4&quot;,&quot;16*$SIZE_T+2*8($sp)&quot;);
+	std	(&quot;%f6&quot;,&quot;16*$SIZE_T+3*8($sp)&quot;);
+}
+	larl	(&quot;%r5&quot;,&quot;.Lconst&quot;);
 
-	llgfr   $padbit,$padbit		# clear upper half, much needed with
+	vlef	(@acc[$_],&quot;4*$_($ctx)&quot;,1) for (0..4);	# load acc1
+	vlef	(@acc[$_],&quot;24+4*$_($ctx)&quot;,3) for (0..4);	# load acc2
+	vlef	(@r5[$_],&quot;108+4*$_($ctx)&quot;,1) for (0..4);	# load 5*r^2
+	vlef	(@r[$_],&quot;88+4*$_($ctx)&quot;,1) for (0..4);	# load r^2
+	vlef	(@r5[$_],&quot;68+4*$_($ctx)&quot;,3) for (0..4);	# load 5*r
+	vlef	(@r[$_],&quot;48+4*$_($ctx)&quot;,3) for (0..4);	# load r
+	vl	($mask,&quot;48(%r5)&quot;);	# load mask
+
+	# acc = acc1 * r^2 + acc2 * r
+
+	vmlof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[1]);
+	vmlof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]);
+	vmlof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]);
+	vmlof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]);
+	vmlof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r5</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+	vmalof	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vmalof	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vmalof	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);
+	vmalof	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+	vmalof	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+	vmalof	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at r</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+
+	vzero	(&quot;%v27&quot;);
+	vsumqg	(@acc[$_]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[$_],&quot;%v27&quot;) for (0..4);
+
+	REDUCE	();
+
+	vesrlg	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1],26);
+	vn	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1],$mask);
+	vag	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);	# carry 1-&gt;2
+
+	vesrlg	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2],26);
+	vn	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2],$mask);
+	vag	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]);	# carry 2-&gt;3
+
+	vesrlg	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],26);
+	vn	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],$mask);
+	vag	(@acc[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);	# carry 3-&gt;4
+
+	# acc -&gt; base 2^64
+	vleib	(&quot;%v30&quot;,6*8,7);
+	vleib	(&quot;%v29&quot;,13*8,7);
+	vleib	(&quot;%v28&quot;,3*8,7);
+
+	veslg	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1],26);
+	veslg	(@acc[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3],26);
+	vo	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]);
+	vo	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[3]);
+
+	veslg	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2],4);
+	vslb	(@acc[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2],&quot;%v30&quot;);	# &lt;&lt;52
+	vo	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[2]);
+
+	vslb	(@tmp[4]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4],&quot;%v29&quot;);	# &lt;&lt;104
+	vo	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[4]);
+
+	vsrlb	(@acc[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[4],&quot;%v28&quot;);	# &gt;&gt;24
+
+	# acc %= 2^130-5
+	vone	(&quot;%v26&quot;);
+	vleig	(&quot;%v27&quot;,5,1);
+	vone	(&quot;%v29&quot;);
+	vleig	(&quot;%v26&quot;,-4,1);
+
+	vaq	(@tmp[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0],&quot;%v27&quot;);
+	vaccq	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0],&quot;%v27&quot;);
+
+	vaq	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1],&quot;%v26&quot;);
+	vaccq	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[1]);
+
+	vaq	(@tmp[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1],&quot;%v29&quot;);
+
+	vn	(@tmp[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]);
+	vnc	(@tmp[3]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[1]);
+	vo	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[2]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[3]);
+
+	# acc += nonce
+	vl	(@vperm[0],&quot;64(%r5)&quot;);
+	vlef	(@tmp[0],&quot;4*$_($nonce)&quot;,3-$_) for (0..3);
+
+	vaq	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at tmp</A>[0]);
+
+	vperm	(@acc[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at acc</A>[0]<A HREF="../../../mailman/listinfo/openssl-commits.html">, at vperm</A>[0]);
+	vst	(@acc[0],&quot;0($mac)&quot;);	# store mac
+
+if ($z) {
+	vlm	(&quot;%v8&quot;,&quot;%v15&quot;,&quot;0($sp)&quot;);
+	la	($sp,&quot;$frame($sp)&quot;);
+} else {
+	ld	(&quot;%f4&quot;,&quot;16*$SIZE_T+2*8($sp)&quot;);
+	ld	(&quot;%f6&quot;,&quot;16*$SIZE_T+3*8($sp)&quot;);
+}
+	br	(&quot;%r14&quot;);
+SIZE	(&quot;poly1305_emit_vx&quot;,&quot;.-poly1305_emit_vx&quot;);
+}
+}
+
+# NOVX CODE PATH
+{
+################
+# static void poly1305_blocks(void *ctx, const unsigned char *inp, size_t len,
+#                             u32 padbit)
+{
+my ($ctx,$inp,$len,$padbit) = map(&quot;%r$_&quot;,(2..5));
+
+my ($d0hi,$d0lo,$d1hi,$d1lo,$t0,$h0,$t1,$h1,$h2) = map(&quot;%r$_&quot;,(6..14));
+my ($r0,$r1,$s1) = map(&quot;%r$_&quot;,(0..2));
+GLOBL	(&quot;poly1305_blocks&quot;);
+TYPE	(&quot;poly1305_blocks&quot;,&quot;\@function&quot;);
+ALIGN	(16);
+LABEL	(&quot;poly1305_blocks&quot;);
+$z?	srlg	($len,$len,4)	:srl	($len,4);
+	lghi	(&quot;%r0&quot;,0);
+&amp;{$z?	\&amp;clgr:\&amp;clr}	($len,&quot;%r0&quot;);
+	je	(&quot;.Lno_data&quot;);
+
+&amp;{$z?	\&amp;stmg:\&amp;stm}	(&quot;%r6&quot;,&quot;%r14&quot;,&quot;6*$SIZE_T($sp)&quot;);
+
+	llgfr	($padbit,$padbit);	# clear upper half, much needed with
 					# non-64-bit ABI
-	lg	$r0,32($ctx)		# load key
-	lg	$r1,40($ctx)
+	lg	($r0,&quot;32($ctx)&quot;);	# load key
+	lg	($r1,&quot;40($ctx)&quot;);
 
-	lg	$h0,0($ctx)		# load hash value
-	lg	$h1,8($ctx)
-	lg	$h2,16($ctx)
+	lg	($h0,&quot;0($ctx)&quot;);	# load hash value
+	lg	($h1,&quot;8($ctx)&quot;);
+	lg	($h2,&quot;16($ctx)&quot;);
 
-	st$g	$ctx,`2*$SIZE_T`($sp)	# off-load $ctx
-	srlg	$s1,$r1,2
-	algr	$s1,$r1			# s1 = r1 + r1&gt;&gt;2
-	j	.Loop
+&amp;{$z?	\&amp;stg:\&amp;st}	($ctx,&quot;2*$SIZE_T($sp)&quot;);	# off-load $ctx
+	srlg	($s1,$r1,2);
+	algr	($s1,$r1);			# s1 = r1 + r1&gt;&gt;2
+	j	(&quot;.Loop&quot;);
 
-.align	16
-.Loop:
-	lrvg	$d0lo,0($inp)		# load little-endian input
-	lrvg	$d1lo,8($inp)
-	la	$inp,16($inp)
+ALIGN	(16);
+LABEL	(&quot;.Loop&quot;);
+	lrvg	($d0lo,&quot;0($inp)&quot;);	# load little-endian input
+	lrvg	($d1lo,&quot;8($inp)&quot;);
+	la	($inp,&quot;16($inp)&quot;);
 
-	algr	$d0lo,$h0		# accumulate input
-	alcgr	$d1lo,$h1
+	algr	($d0lo,$h0);		# accumulate input
+	alcgr	($d1lo,$h1);
 
-	lgr	$h0,$d0lo
-	mlgr	$d0hi,$r0		# h0*r0	  -&gt; $d0hi:$d0lo
-	lgr	$h1,$d1lo
-	mlgr	$d1hi,$s1		# h1*5*r1 -&gt; $d1hi:$d1lo
+	lgr	($h0,$d0lo);
+	mlgr	($d0hi,$r0);		# h0*r0	  -&gt; $d0hi:$d0lo
+	lgr	($h1,$d1lo);
+	mlgr	($d1hi,$s1);		# h1*5*r1 -&gt; $d1hi:$d1lo
 
-	mlgr	$t0,$r1			# h0*r1   -&gt; $t0:$h0
-	mlgr	$t1,$r0			# h1*r0   -&gt; $t1:$h1
-	alcgr	$h2,$padbit
+	mlgr	($t0,$r1);		# h0*r1   -&gt; $t0:$h0
+	mlgr	($t1,$r0);		# h1*r0   -&gt; $t1:$h1
+	alcgr	($h2,$padbit);
 
-	algr	$d0lo,$d1lo
-	lgr	$d1lo,$h2
-	alcgr	$d0hi,$d1hi
-	lghi	$d1hi,0
+	algr	($d0lo,$d1lo);
+	lgr	($d1lo,$h2);
+	alcgr	($d0hi,$d1hi);
+	lghi	($d1hi,0);
 
-	algr	$h1,$h0
-	alcgr	$t1,$t0
+	algr	($h1,$h0);
+	alcgr	($t1,$t0);
 
-	msgr	$d1lo,$s1		# h2*s1
-	msgr	$h2,$r0			# h2*r0
+	msgr	($d1lo,$s1);		# h2*s1
+	msgr	($h2,$r0);		# h2*r0
 
-	algr	$h1,$d1lo
-	alcgr	$t1,$d1hi		# $d1hi is zero
+	algr	($h1,$d1lo);
+	alcgr	($t1,$d1hi);		# $d1hi is zero
 
-	algr	$h1,$d0hi
-	alcgr	$h2,$t1
+	algr	($h1,$d0hi);
+	alcgr	($h2,$t1);
 
-	lghi	$h0,-4			# final reduction step
-	ngr	$h0,$h2
-	srlg	$t0,$h2,2
-	algr	$h0,$t0
-	lghi	$t1,3
-	ngr	$h2,$t1
+	lghi	($h0,-4);		# final reduction step
+	ngr	($h0,$h2);
+	srlg	($t0,$h2,2);
+	algr	($h0,$t0);
+	lghi	($t1,3);
+	ngr	($h2,$t1);
 
-	algr	$h0,$d0lo
-	alcgr	$h1,$d1hi		# $d1hi is still zero
-	alcgr	$h2,$d1hi		# $d1hi is still zero
+	algr	($h0,$d0lo);
+	alcgr	($h1,$d1hi);		# $d1hi is still zero
+	alcgr	($h2,$d1hi);		# $d1hi is still zero
 
-	brct$g	$len,.Loop
+&amp;{$z?	\&amp;brctg:\&amp;brct}	($len,&quot;.Loop&quot;);
 
-	l$g	$ctx,`2*$SIZE_T`($sp)	# restore $ctx
+&amp;{$z?	\&amp;lg:\&amp;l}	($ctx,&quot;2*$SIZE_T($sp)&quot;);# restore $ctx
 
-	stg	$h0,0($ctx)		# store hash value
-	stg	$h1,8($ctx)
-	stg	$h2,16($ctx)
+	stg	($h0,&quot;0($ctx)&quot;);	# store hash value
+	stg	($h1,&quot;8($ctx)&quot;);
+	stg	($h2,&quot;16($ctx)&quot;);
 
-	lm${g}	%r6,%r14,`6*$SIZE_T`($sp)
-.Lno_data:
-	br	%r14
-.size	poly1305_blocks,.-poly1305_blocks
-___
+&amp;{$z?	\&amp;lmg:\&amp;lm}	(&quot;%r6&quot;,&quot;%r14&quot;,&quot;6*$SIZE_T($sp)&quot;);
+LABEL	(&quot;.Lno_data&quot;);
+	br	(&quot;%r14&quot;);
+SIZE	(&quot;poly1305_blocks&quot;,&quot;.-poly1305_blocks&quot;);
 }
+
+################
+# static void poly1305_emit(void *ctx, unsigned char mac[16],
+#                           const u32 nonce[4])
 {
-my ($mac,$nonce)=($inp,$len);
+my ($ctx,$mac,$nonce) = map(&quot;%r$_&quot;,(2..4));
 my ($h0,$h1,$h2,$d0,$d1)=map(&quot;%r$_&quot;,(5..9));
 
-$code.=&lt;&lt;___;
-.globl	poly1305_emit
-.type	poly1305_emit,\@function
-.align	16
-poly1305_emit:
-	stm${g}	%r6,%r9,`6*$SIZE_T`($sp)
-
-	lg	$h0,0($ctx)
-	lg	$h1,8($ctx)
-	lg	$h2,16($ctx)
-
-	lghi	%r0,5
-	lghi	%r1,0
-	lgr	$d0,$h0
-	lgr	$d1,$h1
-
-	algr	$h0,%r0			# compare to modulus
-	alcgr	$h1,%r1
-	alcgr	$h2,%r1
-
-	srlg	$h2,$h2,2		# did it borrow/carry?
-	slgr	%r1,$h2			# 0-$h2&gt;&gt;2
-	lg	$h2,0($nonce)		# load nonce
-	lghi	%r0,-1
-	lg	$ctx,8($nonce)
-	xgr	%r0,%r1			# ~%r1
-
-	ngr	$h0,%r1
-	ngr	$d0,%r0
-	ngr	$h1,%r1
-	ngr	$d1,%r0
-	ogr	$h0,$d0
-	rllg	$d0,$h2,32		# flip nonce words
-	ogr	$h1,$d1
-	rllg	$d1,$ctx,32
-
-	algr	$h0,$d0			# accumulate nonce
-	alcgr	$h1,$d1
-
-	strvg	$h0,0($mac)		# write little-endian result
-	strvg	$h1,8($mac)
-
-	lm${g}	%r6,%r9,`6*$SIZE_T`($sp)
-	br	%r14
-.size	poly1305_emit,.-poly1305_emit
-
-.string	&quot;Poly1305 for s390x, CRYPTOGAMS by &lt;appro\@openssl.org&gt;&quot;
-___
-}
-
-$code =~ s/\`([^\`]*)\`/eval $1/gem;
-$code =~ s/\b(srlg\s+)(%r[0-9]+\s*,)\s*([0-9]+)/$1$2$2$3/gm;
-
-print $code;
-close STDOUT;
+GLOBL	(&quot;poly1305_emit&quot;);
+TYPE	(&quot;poly1305_emit&quot;,&quot;\@function&quot;);
+ALIGN	(16);
+LABEL	(&quot;poly1305_emit&quot;);
+&amp;{$z?	\&amp;stmg:\&amp;stm}	(&quot;%r6&quot;,&quot;%r9&quot;,&quot;6*$SIZE_T($sp)&quot;);
+
+	lg	($h0,&quot;0($ctx)&quot;);
+	lg	($h1,&quot;8($ctx)&quot;);
+	lg	($h2,&quot;16($ctx)&quot;);
+
+	lghi	(&quot;%r0&quot;,5);
+	lghi	(&quot;%r1&quot;,0);
+	lgr	($d0,$h0);
+	lgr	($d1,$h1);
+
+	algr	($h0,&quot;%r0&quot;);		# compare to modulus
+	alcgr	($h1,&quot;%r1&quot;);
+	alcgr	($h2,&quot;%r1&quot;);
+
+	srlg	($h2,$h2,2);		# did it borrow/carry?
+	slgr	(&quot;%r1&quot;,$h2);		# 0-$h2&gt;&gt;2
+	lg	($h2,&quot;0($nonce)&quot;);	# load nonce
+	lghi	(&quot;%r0&quot;,-1);
+	lg	($ctx,&quot;8($nonce)&quot;);
+	xgr	(&quot;%r0&quot;,&quot;%r1&quot;);		# ~%r1
+
+	ngr	($h0,&quot;%r1&quot;);
+	ngr	($d0,&quot;%r0&quot;);
+	ngr	($h1,&quot;%r1&quot;);
+	ngr	($d1,&quot;%r0&quot;);
+	ogr	($h0,$d0);
+	rllg	($d0,$h2,32);		# flip nonce words
+	ogr	($h1,$d1);
+	rllg	($d1,$ctx,32);
+
+	algr	($h0,$d0);		# accumulate nonce
+	alcgr	($h1,$d1);
+
+	strvg	($h0,&quot;0($mac)&quot;);	# write little-endian result
+	strvg	($h1,&quot;8($mac)&quot;);
+
+&amp;{$z?	\&amp;lmg:\&amp;lm}	(&quot;%r6&quot;,&quot;%r9&quot;,&quot;6*$SIZE_T($sp)&quot;);
+	br	(&quot;%r14&quot;);
+SIZE	(&quot;poly1305_emit&quot;,&quot;.-poly1305_emit&quot;);
+}
+}
+################
+
+ALIGN	(128);
+LABEL	(&quot;.Lconst&quot;);
+LONG	(0x00060504,0x03020100,0x00161514,0x13121110);	# vperm op[m[1],m[0]]
+LONG	(0x000c0b0a,0x09080706,0x001c1b1a,0x19181716);	# vperm op[m[3],m[2]]
+LONG	(0x00000000,0x000f0e0d,0x00000000,0x001f1e1d);	# vperm op[  - ,m[4]]
+LONG	(0x00000000,0x03ffffff,0x00000000,0x03ffffff);	# [0,2^26-1,0,2^26-1]
+LONG	(0x0f0e0d0c,0x0b0a0908,0x07060504,0x03020100);	# vperm op endian
+STRING	(&quot;\&quot;Poly1305 for s390x, CRYPTOGAMS by &lt;appro\@openssl.org&gt;\&quot;&quot;);
+
+PERLASM_END();
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021779.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="021782.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21781">[ date ]</a>
              <a href="thread.html#21781">[ thread ]</a>
              <a href="subject.html#21781">[ subject ]</a>
              <a href="author.html#21781">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
