<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1606996590.033916.19150.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032493.html">
   <LINK REL="Next"  HREF="032506.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>dev at ddvo.net</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1606996590.033916.19150.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">dev at ddvo.net
       </A><BR>
    <I>Thu Dec  3 11:56:30 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="032493.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="032506.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32504">[ date ]</a>
              <a href="thread.html#32504">[ thread ]</a>
              <a href="subject.html#32504">[ subject ]</a>
              <a href="author.html#32504">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  902161e8ec7b81849f6dc4d449e17fcaee2d49b1 (commit)
      from  a7e6a3d8ef4eea0e211441392b80a7acfd4a16b2 (commit)


- Log -----------------------------------------------------------------
commit 902161e8ec7b81849f6dc4d449e17fcaee2d49b1
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Nov 26 15:39:22 2020 +0100

    apps/pkcs12.c: Improve user guidance, re-ordering no-export vs. export options
    
    Make the option order consistent in the help output and in the POD file.
    Give warnings when an option is ignored because -export is given or missing.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/13588">https://github.com/openssl/openssl/pull/13588</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/pkcs12.c                  | 183 +++++++++++++----------
 doc/man1/openssl-pkcs12.pod.in | 328 ++++++++++++++++++++++-------------------
 2 files changed, 280 insertions(+), 231 deletions(-)

diff --git a/apps/pkcs12.c b/apps/pkcs12.c
index e12b359de8..5c05fddf99 100644
--- a/apps/pkcs12.c
+++ b/apps/pkcs12.c
@@ -27,6 +27,12 @@
 #define CACERTS         0x10
 
 #define PASSWD_BUF_SIZE 2048
+#define PKCS12_DEFAULT_PBE NID_aes_256_cbc
+
+#define WARN_EXPORT(opt) \
+    BIO_printf(bio_err, &quot;Warning: -%s option ignored with -export\n&quot;, opt);
+#define WARN_NO_EXPORT(opt) \
+    BIO_printf(bio_err, &quot;Warning: -%s option ignored without -export\n&quot;, opt);
 
 static int get_cert_chain(X509 *cert, X509_STORE *store,
                           STACK_OF(X509) *untrusted_certs,
@@ -64,6 +70,15 @@ typedef enum OPTION_choice {
 const OPTIONS pkcs12_options[] = {
     OPT_SECTION(&quot;General&quot;),
     {&quot;help&quot;, OPT_HELP, '-', &quot;Display this summary&quot;},
+    {&quot;in&quot;, OPT_IN, '&lt;', &quot;Input file&quot;},
+    {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output file&quot;},
+    {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
+    {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
+    {&quot;password&quot;, OPT_PASSWORD, 's', &quot;Set PKCS#12 import/export password source&quot;},
+    {&quot;twopass&quot;, OPT_TWOPASS, '-', &quot;Separate MAC, encryption passwords&quot;},
+    {&quot;nokeys&quot;, OPT_NOKEYS, '-', &quot;Don't output private keys&quot;},
+    {&quot;nocerts&quot;, OPT_NOCERTS, '-', &quot;Don't output certificates&quot;},
+    {&quot;noout&quot;, OPT_NOOUT, '-', &quot;Don't output anything, just verify PKCS#12 input&quot;},
     {&quot;legacy&quot;, OPT_LEGACY_ALG, '-',
 #ifdef OPENSSL_NO_RC2
      &quot;Use legacy encryption algorithm 3DES_CBC for keys and certs&quot;
@@ -74,21 +89,29 @@ const OPTIONS pkcs12_options[] = {
 #ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 #endif
-    {&quot;password&quot;, OPT_PASSWORD, 's', &quot;Set import/export password source&quot;},
-    {&quot;twopass&quot;, OPT_TWOPASS, '-', &quot;Separate MAC, encryption passwords&quot;},
+    OPT_PROV_OPTIONS,
+    OPT_R_OPTIONS,
 
-    OPT_SECTION(&quot;Input&quot;),
-    {&quot;in&quot;, OPT_IN, '&lt;', &quot;Input file for PKCS12 parsing or certs and possibly key&quot;},
-    {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
+    OPT_SECTION(&quot;PKCS#12 import (parsing PKCS#12)&quot;),
+    {&quot;info&quot;, OPT_INFO, '-', &quot;Print info about PKCS#12 structure&quot;},
+    {&quot;nomacver&quot;, OPT_NOMACVER, '-', &quot;Don't verify integrity MAC&quot;},
+    {&quot;clcerts&quot;, OPT_CLCERTS, '-', &quot;Only output client certificates&quot;},
+    {&quot;cacerts&quot;, OPT_CACERTS, '-', &quot;Only output CA certificates&quot;},
+    {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher for output encryption&quot;},
+    {&quot;noenc&quot;, OPT_NOENC, '-', &quot;Don't encrypt private keys&quot;},
+    {&quot;nodes&quot;, OPT_NODES, '-', &quot;Don't encrypt private keys; deprecated&quot;},
+
+    OPT_SECTION(&quot;PKCS#12 output (export)&quot;),
+    {&quot;export&quot;, OPT_EXPORT, '-', &quot;Create PKCS12 file&quot;},
     {&quot;inkey&quot;, OPT_INKEY, 's', &quot;Private key, else read from -in input file&quot;},
     {&quot;certfile&quot;, OPT_CERTFILE, '&lt;', &quot;Extra certificates for PKCS12 output&quot;},
-    {&quot;untrusted&quot;, OPT_UNTRUSTED, '&lt;', &quot;Untrusted certificates for chain building&quot;},
     {&quot;passcerts&quot;, OPT_PASSCERTS, 's', &quot;Certificate file pass phrase source&quot;},
-    {&quot;nomacver&quot;, OPT_NOMACVER, '-', &quot;Don't verify MAC&quot;},
-
-    OPT_SECTION(&quot;CA input for export with the -chain option&quot;),
-    {&quot;CApath&quot;, OPT_CAPATH, '/', &quot;PEM-format directory of CA's&quot;},
+    {&quot;chain&quot;, OPT_CHAIN, '-', &quot;Build and add certificate chain for EE cert,&quot;},
+    {OPT_MORE_STR, 0, 0,
+     &quot;which is the 1st cert from -in matching the privte key (if given)&quot;},
+    {&quot;untrusted&quot;, OPT_UNTRUSTED, '&lt;', &quot;Untrusted certificates for chain building&quot;},
     {&quot;CAfile&quot;, OPT_CAFILE, '&lt;', &quot;PEM-format file of CA's&quot;},
+    {&quot;CApath&quot;, OPT_CAPATH, '/', &quot;PEM-format directory of CA's&quot;},
     {&quot;CAstore&quot;, OPT_CASTORE, ':', &quot;URI to store of CA's&quot;},
     {&quot;no-CAfile&quot;, OPT_NOCAFILE, '-',
      &quot;Do not load the default certificates file&quot;},
@@ -96,55 +119,29 @@ const OPTIONS pkcs12_options[] = {
      &quot;Do not load certificates from the default certificates directory&quot;},
     {&quot;no-CAstore&quot;, OPT_NOCASTORE, '-',
      &quot;Do not load certificates from the default certificates store&quot;},
-
-    OPT_SECTION(&quot;Output&quot;),
-    {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output filename&quot;},
-    {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output pass phrase source&quot;},
-    {&quot;info&quot;, OPT_INFO, '-', &quot;Print info about PKCS#12 structure&quot;},
-    {&quot;nokeys&quot;, OPT_NOKEYS, '-', &quot;Don't output private keys&quot;},
-    {&quot;nocerts&quot;, OPT_NOCERTS, '-', &quot;Don't output certificates&quot;},
-    {&quot;clcerts&quot;, OPT_CLCERTS, '-', &quot;Only output client certificates&quot;},
-    {&quot;cacerts&quot;, OPT_CACERTS, '-', &quot;Only output CA certificates&quot;},
-    {&quot;noout&quot;, OPT_NOOUT, '-', &quot;Don't output anything, just verify PKCS#12 input&quot;},
-
-    OPT_SECTION(&quot;PKCS12 output&quot;),
-    {&quot;export&quot;, OPT_EXPORT, '-', &quot;Output PKCS12 file&quot;},
-    {&quot;chain&quot;, OPT_CHAIN, '-', &quot;Build and add certificate chain for EE cert,&quot;},
-    {OPT_MORE_STR, 0, 0,
-     &quot;which is the 1st cert from -in matching the privte key (if given)&quot;},
     {&quot;name&quot;, OPT_NAME, 's', &quot;Use name as friendly name&quot;},
-    {&quot;CSP&quot;, OPT_CSP, 's', &quot;Microsoft CSP name&quot;},
     {&quot;caname&quot;, OPT_CANAME, 's',
      &quot;Use name as CA friendly name (can be repeated)&quot;},
+    {&quot;CSP&quot;, OPT_CSP, 's', &quot;Microsoft CSP name&quot;},
     {&quot;LMK&quot;, OPT_LMK, '-',
      &quot;Add local machine keyset attribute to private key&quot;},
     {&quot;keyex&quot;, OPT_KEYEX, '-', &quot;Set key type to MS key exchange&quot;},
     {&quot;keysig&quot;, OPT_KEYSIG, '-', &quot;Set key type to MS key signature&quot;},
-
-    OPT_SECTION(&quot;PKCS12 output encryption and MAC&quot;),
-    {&quot;descert&quot;, OPT_DESCERT, '-',
-     &quot;Encrypt output with 3DES (default PBES2 with PBKDF2 and AES-256 CBC)&quot;},
+    {&quot;keypbe&quot;, OPT_KEYPBE, 's', &quot;Private key PBE algorithm (default AES-256 CBC)&quot;},
     {&quot;certpbe&quot;, OPT_CERTPBE, 's',
      &quot;Certificate PBE algorithm (default PBES2 with PBKDF2 and AES-256 CBC)&quot;},
-    {&quot;keypbe&quot;, OPT_KEYPBE, 's', &quot;Private key PBE algorithm (default AES-256 CBC)&quot;},
+    {&quot;descert&quot;, OPT_DESCERT, '-',
+     &quot;Encrypt output with 3DES (default PBES2 with PBKDF2 and AES-256 CBC)&quot;},
+    {&quot;macalg&quot;, OPT_MACALG, 's',
+     &quot;Digest algorithm to use in MAC (default SHA1)&quot;},
     {&quot;iter&quot;, OPT_ITER, 'p', &quot;Specify the iteration count for encryption and MAC&quot;},
     {&quot;noiter&quot;, OPT_NOITER, '-', &quot;Don't use encryption iteration&quot;},
+    {&quot;nomaciter&quot;, OPT_NOMACITER, '-', &quot;Don't use MAC iteration)&quot;},
     {&quot;maciter&quot;, OPT_MACITER, '-', &quot;Unused, kept for backwards compatibility&quot;},
-    {&quot;nomaciter&quot;, OPT_NOMACITER, '-', &quot;Don't use MAC iteration&quot;},
-    {&quot;macalg&quot;, OPT_MACALG, 's',
-     &quot;Digest algorithm to use in MAC (default SHA1)&quot;},
     {&quot;nomac&quot;, OPT_NOMAC, '-', &quot;Don't generate MAC&quot;},
-    {&quot;noenc&quot;, OPT_NOENC, '-', &quot;Don't encrypt private keys&quot;},
-    {&quot;nodes&quot;, OPT_NODES, '-', &quot;Don't encrypt private keys; deprecated&quot;},
-    {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
-
-    OPT_R_OPTIONS,
-    OPT_PROV_OPTIONS,
     {NULL}
 };
 
-#define PKCS12_DEFAULT_PBE NID_aes_256_cbc
-
 int pkcs12_main(int argc, char **argv)
 {
     char *infile = NULL, *outfile = NULL, *keyname = NULL, *certfile = NULL;
@@ -152,7 +149,7 @@ int pkcs12_main(int argc, char **argv)
     char *passcertsarg = NULL, *passcerts = NULL;
     char *name = NULL, *csp_name = NULL;
     char pass[PASSWD_BUF_SIZE] = &quot;&quot;, macpass[PASSWD_BUF_SIZE] = &quot;&quot;;
-    int export_cert = 0, options = 0, chain = 0, twopass = 0, keytype = 0, use_legacy = 0;
+    int export_pkcs12 = 0, options = 0, chain = 0, twopass = 0, keytype = 0, use_legacy = 0;
     int iter = PKCS12_DEFAULT_ITER, maciter = PKCS12_DEFAULT_ITER;
     int cert_pbe = PKCS12_DEFAULT_PBE;
     int key_pbe = PKCS12_DEFAULT_PBE;
@@ -167,6 +164,7 @@ int pkcs12_main(int argc, char **argv)
     BIO *in = NULL, *out = NULL;
     PKCS12 *p12 = NULL;
     STACK_OF(OPENSSL_STRING) *canames = NULL;
+    const char *enc_flag = NULL;
     const EVP_CIPHER *const default_enc = EVP_aes_256_cbc();
     const EVP_CIPHER *enc = default_enc;
     OPTION_CHOICE o;
@@ -220,10 +218,11 @@ int pkcs12_main(int argc, char **argv)
             cert_pbe = NID_pbe_WithSHA1And3_Key_TripleDES_CBC;
             break;
         case OPT_EXPORT:
-            export_cert = 1;
+            export_pkcs12 = 1;
             break;
         case OPT_CIPHER:
-            if (!opt_cipher(opt_unknown(), &amp;enc))
+            enc_flag = opt_unknown();
+            if (!opt_cipher(enc_flag, &amp;enc))
                 goto opthelp;
             break;
         case OPT_ITER:
@@ -249,6 +248,7 @@ int pkcs12_main(int argc, char **argv)
             break;
         case OPT_NODES:
         case OPT_NOENC:
+            enc_flag = opt_flag() + 1;
             enc = NULL;
             break;
         case OPT_CERTPBE:
@@ -337,36 +337,65 @@ int pkcs12_main(int argc, char **argv)
     }
     argc = opt_num_rest();
 
-    if (!export_cert) {
-        if (chain)
-            BIO_printf(bio_err, &quot;Warning: -chain option ignored without -export\n&quot;);
+    if (export_pkcs12) {
+        if ((options &amp; INFO) != 0)
+            WARN_EXPORT(&quot;info&quot;);
+        if (macver == 0)
+            WARN_EXPORT(&quot;nomacver&quot;);
+        if ((options &amp; CLCERTS) != 0)
+            WARN_EXPORT(&quot;clcerts&quot;);
+        if ((options &amp; CACERTS) != 0)
+            WARN_EXPORT(&quot;cacerts&quot;);
+        if (enc != default_enc)
+            BIO_printf(bio_err,
+                       &quot;Warning: output encryption option -%s ignored with -export\n&quot;, enc_flag);
+    } else {
+        if (keyname != NULL)
+            WARN_NO_EXPORT(&quot;inkey&quot;);
         if (certfile != NULL)
-            BIO_printf(bio_err, &quot;Warning: -certfile option ignored without -export\n&quot;);
-        if (untrusted != NULL)
-            BIO_printf(bio_err, &quot;Warning: -untrusted option ignored without -export\n&quot;);
+            WARN_NO_EXPORT(&quot;certfile&quot;);
         if (passcertsarg != NULL)
-            BIO_printf(bio_err,
-                       &quot;Warning: -passcerts option ignored without -export\n&quot;);
-        if (CApath != NULL || noCApath)
-            BIO_printf(bio_err, &quot;Warning: -[no-]CApath option ignored without -export\n&quot;);
-        if (CAfile != NULL || noCAfile)
-            BIO_printf(bio_err, &quot;Warning: -[no-]CAfile option ignored without -export\n&quot;);
-        if (CAstore != NULL || noCAstore)
-            BIO_printf(bio_err, &quot;Warning: -[no-]CAstore option ignored without -export\n&quot;);
-        if (add_lmk)
-            BIO_printf(bio_err, &quot;Warning: -LMK option ignored without -export\n&quot;);
+            WARN_NO_EXPORT(&quot;passcerts&quot;);
+        if (chain)
+            WARN_NO_EXPORT(&quot;chain&quot;);
+        if (untrusted != NULL)
+            WARN_NO_EXPORT(&quot;untrusted&quot;);
+        if (CAfile != NULL)
+            WARN_NO_EXPORT(&quot;CAfile&quot;);
+        if (CApath != NULL)
+            WARN_NO_EXPORT(&quot;CApath&quot;);
+        if (CAstore != NULL)
+            WARN_NO_EXPORT(&quot;CAstore&quot;);
+        if (noCAfile)
+            WARN_NO_EXPORT(&quot;no-CAfile&quot;);
+        if (noCApath)
+            WARN_NO_EXPORT(&quot;no-CApath&quot;);
+        if (noCAstore)
+            WARN_NO_EXPORT(&quot;no-CAstore&quot;);
         if (name != NULL)
-            BIO_printf(bio_err, &quot;Warning: -name option ignored without -export\n&quot;);
-        if (csp_name != NULL)
-            BIO_printf(bio_err, &quot;Warning: -CSP option ignored without -export\n&quot;);
+            WARN_NO_EXPORT(&quot;name&quot;);
         if (canames != NULL)
-            BIO_printf(bio_err, &quot;Warning: -caname option ignored without -export\n&quot;);
-        if (keyname != NULL)
-            BIO_printf(bio_err, &quot;Warning: -inkey option ignored without -export\n&quot;);
-        if (keytype != 0)
-            BIO_printf(bio_err, &quot;Warning: -keyex and -keysig options ignored without -export\n&quot;);
+            WARN_NO_EXPORT(&quot;caname&quot;);
+        if (csp_name != NULL)
+            WARN_NO_EXPORT(&quot;CSP&quot;);
+        if (add_lmk)
+            WARN_NO_EXPORT(&quot;LMK&quot;);
+        if (keytype == KEY_EX)
+            WARN_NO_EXPORT(&quot;keyex&quot;);
+        if (keytype == KEY_SIG)
+            WARN_NO_EXPORT(&quot;keysig&quot;);
+        if (key_pbe != PKCS12_DEFAULT_PBE)
+            WARN_NO_EXPORT(&quot;keypbe&quot;);
+        if (cert_pbe != PKCS12_DEFAULT_PBE &amp;&amp; cert_pbe != -1)
+            WARN_NO_EXPORT(&quot;certpbe and -descert&quot;);
         if (macalg != NULL)
-            BIO_printf(bio_err, &quot;Warning: -macalg option ignored without -export\n&quot;);
+            WARN_NO_EXPORT(&quot;macalg&quot;);
+        if (iter != PKCS12_DEFAULT_ITER)
+            WARN_NO_EXPORT(&quot;iter and -noiter&quot;);
+        if (maciter == 1)
+            WARN_NO_EXPORT(&quot;nomaciter&quot;);
+        if (cert_pbe == -1 &amp;&amp; maciter == -1)
+            WARN_NO_EXPORT(&quot;nomac&quot;);
     }
     if (use_legacy) {
         /* load the legacy provider if not loaded already*/
@@ -403,7 +432,7 @@ int pkcs12_main(int argc, char **argv)
     }
 
     if (passarg != NULL) {
-        if (export_cert)
+        if (export_pkcs12)
             passoutarg = passarg;
         else
             passinarg = passarg;
@@ -415,7 +444,7 @@ int pkcs12_main(int argc, char **argv)
     }
 
     if (cpass == NULL) {
-        if (export_cert)
+        if (export_pkcs12)
             cpass = passout;
         else
             cpass = passin;
@@ -425,7 +454,7 @@ int pkcs12_main(int argc, char **argv)
         mpass = cpass;
         noprompt = 1;
         if (twopass) {
-            if (export_cert)
+            if (export_pkcs12)
                 BIO_printf(bio_err, &quot;Option -twopass cannot be used with -passout or -password\n&quot;);
             else
                 BIO_printf(bio_err, &quot;Option -twopass cannot be used with -passin or -password\n&quot;);
@@ -441,7 +470,7 @@ int pkcs12_main(int argc, char **argv)
         if (1) {
 #ifndef OPENSSL_NO_UI_CONSOLE
             if (EVP_read_pw_string(
-                macpass, sizeof(macpass), &quot;Enter MAC Password:&quot;, export_cert)) {
+                macpass, sizeof(macpass), &quot;Enter MAC Password:&quot;, export_pkcs12)) {
                 BIO_printf(bio_err, &quot;Can't read Password\n&quot;);
                 goto end;
             }
@@ -452,7 +481,7 @@ int pkcs12_main(int argc, char **argv)
         }
     }
 
-    if (export_cert) {
+    if (export_pkcs12) {
         EVP_PKEY *key = NULL;
         X509 *ee_cert = NULL, *x = NULL;
         STACK_OF(X509) *certs = NULL;
@@ -462,7 +491,7 @@ int pkcs12_main(int argc, char **argv)
         int i;
 
         if ((options &amp; (NOCERTS | NOKEYS)) == (NOCERTS | NOKEYS)) {
-            BIO_printf(bio_err, &quot;Nothing to export due to -nocerts and -nokeys or -noout!\n&quot;);
+            BIO_printf(bio_err, &quot;Nothing to export due to -noout or -nocerts and -nokeys\n&quot;);
             goto export_end;
         }
 
diff --git a/doc/man1/openssl-pkcs12.pod.in b/doc/man1/openssl-pkcs12.pod.in
index db9f65a984..3b573be6d1 100644
--- a/doc/man1/openssl-pkcs12.pod.in
+++ b/doc/man1/openssl-pkcs12.pod.in
@@ -9,26 +9,25 @@ openssl-pkcs12 - PKCS#12 file command
 
 B&lt;openssl&gt; B&lt;pkcs12&gt;
 [B&lt;-help&gt;]
-[B&lt;-export&gt;]
-[B&lt;-chain&gt;]
-[B&lt;-untrusted&gt; I&lt;filename&gt;]
-[B&lt;-inkey&gt; I&lt;filename&gt;|I&lt;uri&gt;]
-[B&lt;-certfile&gt; I&lt;filename&gt;]
-[B&lt;-passcerts&gt; I&lt;arg&gt;]
-[B&lt;-name&gt; I&lt;name&gt;]
-[B&lt;-caname&gt; I&lt;name&gt;]
+[B&lt;-passin&gt; I&lt;arg&gt;]
+[B&lt;-passout&gt; I&lt;arg&gt;]
+[B&lt;-password&gt; I&lt;arg&gt;]
+[B&lt;-twopass&gt;]
 [B&lt;-in&gt; I&lt;filename&gt;|I&lt;uri&gt;]
 [B&lt;-out&gt; I&lt;filename&gt;]
+[B&lt;-nokeys&gt;]
+[B&lt;-nocerts&gt;]
 [B&lt;-noout&gt;]
+[B&lt;-legacy&gt;]
+{- $OpenSSL::safe::opt_engine_synopsis -}{- $OpenSSL::safe::opt_provider_synopsis -}
+{- $OpenSSL::safe::opt_r_synopsis -}
+
+PKCS#12 input (parsing) options:
+[B&lt;-info&gt;]
 [B&lt;-nomacver&gt;]
-[B&lt;-nocerts&gt;]
 [B&lt;-clcerts&gt;]
 [B&lt;-cacerts&gt;]
-[B&lt;-nokeys&gt;]
-[B&lt;-info&gt;]
-[B&lt;-des&gt;]
-[B&lt;-des3&gt;]
-[B&lt;-idea&gt;]
+
 [B&lt;-aes128&gt;]
 [B&lt;-aes192&gt;]
 [B&lt;-aes256&gt;]
@@ -38,29 +37,36 @@ B&lt;openssl&gt; B&lt;pkcs12&gt;
 [B&lt;-camellia128&gt;]
 [B&lt;-camellia192&gt;]
 [B&lt;-camellia256&gt;]
+[B&lt;-des&gt;]
+[B&lt;-des3&gt;]
+[B&lt;-idea&gt;]
 [B&lt;-noenc&gt;]
 [B&lt;-nodes&gt;]
+
+PKCS#12 output (export) options:
+
+[B&lt;-export&gt;]
+[B&lt;-inkey&gt; I&lt;filename&gt;|I&lt;uri&gt;]
+[B&lt;-certfile&gt; I&lt;filename&gt;]
+[B&lt;-passcerts&gt; I&lt;arg&gt;]
+[B&lt;-chain&gt;]
+[B&lt;-untrusted&gt; I&lt;filename&gt;]
+{- $OpenSSL::safe::opt_trust_synopsis -}
+[B&lt;-name&gt; I&lt;name&gt;]
+[B&lt;-caname&gt; I&lt;name&gt;]
+[B&lt;-CSP&gt; I&lt;name&gt;]
+[B&lt;-LMK&gt;]
+[B&lt;-keyex&gt;]
+[B&lt;-keysig&gt;]
+[B&lt;-keypbe&gt; I&lt;cipher&gt;]
+[B&lt;-certpbe&gt; I&lt;cipher&gt;]
+[B&lt;-descert&gt;]
+[B&lt;-macalg&gt; I&lt;digest&gt;]
 [B&lt;-iter&gt; I&lt;count&gt;]
 [B&lt;-noiter&gt;]
 [B&lt;-nomaciter&gt;]
 [B&lt;-maciter&gt;]
 [B&lt;-nomac&gt;]
-[B&lt;-twopass&gt;]
-[B&lt;-legacy&gt;]
-[B&lt;-descert&gt;]
-[B&lt;-certpbe&gt; I&lt;cipher&gt;]
-[B&lt;-keypbe&gt; I&lt;cipher&gt;]
-[B&lt;-macalg&gt; I&lt;digest&gt;]
-[B&lt;-keyex&gt;]
-[B&lt;-keysig&gt;]
-[B&lt;-password&gt; I&lt;arg&gt;]
-[B&lt;-passin&gt; I&lt;arg&gt;]
-[B&lt;-passout&gt; I&lt;arg&gt;]
-[B&lt;-LMK&gt;]
-[B&lt;-CSP&gt; I&lt;name&gt;]
-{- $OpenSSL::safe::opt_trust_synopsis -}
-{- $OpenSSL::safe::opt_r_synopsis -}
-{- $OpenSSL::safe::opt_engine_synopsis -}{- $OpenSSL::safe::opt_provider_synopsis -}
 
 =for openssl ifdef engine
 
@@ -75,72 +81,104 @@ programs including Netscape, MSIE and MS Outlook.
 There are a lot of options the meaning of some depends of whether a PKCS#12 file
 is being created or parsed. By default a PKCS#12 file is parsed.
 A PKCS#12 file can be created by using the B&lt;-export&gt; option (see below).
-Many further options such as B&lt;-chain&gt; make sense only with B&lt;-export&gt;.
+The PKCS#12 export encryption and MAC options such as B&lt;-certpbe&gt; and B&lt;-iter&gt;
+and many further options such as B&lt;-chain&gt; are relevant only with B&lt;-export&gt;.
+Conversely, the options regarding encryption of private keys when outputting
+PKCS#12 input are relevant only when the B&lt;-export&gt; option is not given.
 The default encryption algorithm is AES-256-CBC with PBKDF2 for key derivation.
 
-=head1 PARSING OPTIONS
-
 =over 4
 
 =item B&lt;-help&gt;
 
 Print out a usage message.
 
-=item B&lt;-in&gt; I&lt;filename&gt;|I&lt;uri&gt;
+=item B&lt;-passin&gt; I&lt;arg&gt;
 
-This specifies the input filename or URI.
-Standard input is used by default.
-Without the B&lt;-export&gt; option this is a PKCS#12 file to be parsed.
-With the B&lt;-export&gt; option this is a file with certificates and possibly a key,
-or a URI that refers to a key accessed via an engine.
+The password source for input files.
+For more information about the format of B&lt;arg&gt;
+see L&lt;openssl(1)/Pass Phrase Options&gt;.
 
-=item B&lt;-out&gt; I&lt;filename&gt;
+=item B&lt;-passout&gt; I&lt;arg&gt;
 
-The filename to write certificates and private keys to, standard output by
-default.  They are all written in PEM format.
+The password source for output files.
 
 =item B&lt;-password&gt; I&lt;arg&gt;
 
 With B&lt;-export&gt;, B&lt;-password&gt; is equivalent to B&lt;-passout&gt;,
 otherwise it is equivalent to B&lt;-passin&gt;.
 
+=item B&lt;-twopass&gt;
+
+Prompt for separate integrity and encryption passwords: most software
+always assumes these are the same so this option will render such
+PKCS#12 files unreadable. Cannot be used in combination with the options
+B&lt;-password&gt;, B&lt;-passin&gt; if importing from PKCS#12, or B&lt;-passout&gt; if exporting.
+
+=item B&lt;-nokeys&gt;
+
+No private keys will be output.
+
+=item B&lt;-nocerts&gt;
+
+No certificates will be output.
+
 =item B&lt;-noout&gt;
 
-This option inhibits credentials output,
-and so the PKCS#12 input is just verified.
+This option inhibits all credentials output,
+and so the input is just verified.
 
-=item B&lt;-clcerts&gt;
+=item B&lt;-legacy&gt;
 
-Only output client certificates (not CA certificates).
+Use legacy mode of operation and automatically load the legacy provider.
+In the legacy mode, the default algorithm for certificate encryption
+is RC2_CBC or 3DES_CBC depending on whether the RC2 cipher is enabled
+in the build. The default algorithm for private key encryption is 3DES_CBC.
+If the legacy option is not specified, then the legacy provider is not loaded
+and the default encryption algorithm for both certificates and private keys is
+AES_256_CBC with PBKDF2 for key derivation.
 
-=item B&lt;-cacerts&gt;
+{- $OpenSSL::safe::opt_engine_item -}
 
-Only output CA certificates (not client certificates).
+{- $OpenSSL::safe::opt_provider_item -}
 
-=item B&lt;-nocerts&gt;
+{- $OpenSSL::safe::opt_r_item -}
 
-No certificates at all will be output.
+=back
 
-=item B&lt;-nokeys&gt;
+=head2 PKCS#12 input (parsing) options
 
-No private keys will be output.
+=over 4
+
+=item B&lt;-in&gt; I&lt;filename&gt;|I&lt;uri&gt;
+
+This specifies the input filename or URI.
+Standard input is used by default.
+Without the B&lt;-export&gt; option this must be PKCS#12 file to be parsed.
+For use with the B&lt;-export&gt; option
+see the L&lt;/PKCS#12 output (export) options&gt; section.
+
+=item B&lt;-out&gt; I&lt;filename&gt;
+
+The filename to write certificates and private keys to, standard output by
+default.  They are all written in PEM format.
 
 =item B&lt;-info&gt;
 
 Output additional information about the PKCS#12 file structure, algorithms
 used and iteration counts.
 
-=item B&lt;-des&gt;
+=item B&lt;-nomacver&gt;
 
-Use DES to encrypt private keys before outputting.
+Don't attempt to verify the integrity MAC.
 
-=item B&lt;-des3&gt;
+=item B&lt;-clcerts&gt;
 
-Use triple DES to encrypt private keys before outputting.
+Only output client certificates (not CA certificates).
 
-=item B&lt;-idea&gt;
+=item B&lt;-cacerts&gt;
 
-Use IDEA to encrypt private keys before outputting.
+Only output CA certificates (not client certificates).
 
 =item B&lt;-aes128&gt;, B&lt;-aes192&gt;, B&lt;-aes256&gt;
 
@@ -154,38 +192,29 @@ Use ARIA to encrypt private keys before outputting.
 
 Use Camellia to encrypt private keys before outputting.
 
-=item B&lt;-noenc&gt;
+=item B&lt;-des&gt;
 
-Don't encrypt the private keys at all.
+Use DES to encrypt private keys before outputting.
 
-=item B&lt;-nodes&gt;
+=item B&lt;-des3&gt;
 
-This option is deprecated since OpenSSL 3.0; use B&lt;-noenc&gt; instead.
+Use triple DES to encrypt private keys before outputting.
 
-=item B&lt;-nomacver&gt;
+=item B&lt;-idea&gt;
 
-Don't attempt to verify the integrity MAC before reading the file.
+Use IDEA to encrypt private keys before outputting.
 
-=item B&lt;-twopass&gt;
+=item B&lt;-noenc&gt;
 
-Prompt for separate integrity and encryption passwords: most software
-always assumes these are the same so this option will render such
-PKCS#12 files unreadable. Cannot be used in combination with the options
-B&lt;-password&gt;, B&lt;-passin&gt; if importing, or B&lt;-passout&gt; if exporting.
+Don't encrypt private keys at all.
 
-=item B&lt;-legacy&gt;
+=item B&lt;-nodes&gt;
 
-Use legacy mode of operation and automatically load the legacy provider.
-In the legacy mode, the default algorithm for certificate encryption
-is RC2_CBC or 3DES_CBC depending on whether the RC2 cipher is enabled
-in the build. The default algorithm for private key encryption is 3DES_CBC.
-If the legacy option is not specified, then the legacy provider is not loaded
-and the default encryption algorithm for both certificates and private keys is
-AES_256_CBC with PBKDF2 for key derivation by default.
+This option is deprecated since OpenSSL 3.0; use B&lt;-noenc&gt; instead.
 
 =back
 
-=head1 FILE CREATION OPTIONS
+=head2 PKCS#12 output (export) options
 
 =over 4
 
@@ -199,32 +228,46 @@ parsed.
 This specifies filename to write the PKCS#12 file to. Standard output is used
 by default.
 
-=item B&lt;-in&gt; I&lt;filename&gt;
+=item B&lt;-in&gt; I&lt;filename&gt;|I&lt;uri&gt;
 
-The filename or URI to read certificates and private keys from, standard input
-by default. They can be in PEM, DER, or PKCS#12 format.
-The order doesn't matter but one private key and
+This specifies the input filename or URI.
+Standard input is used by default.
+With the B&lt;-export&gt; option this is a file with certificates and a key,
+or a URI that refers to a key accessed via an engine.
+The order of credentials in a file doesn't matter but one private key and
 its corresponding certificate should be present. If additional
-certificates are present they will also be included in the PKCS#12 file.
+certificates are present they will also be included in the PKCS#12 output file.
 
 =item B&lt;-inkey&gt; I&lt;filename&gt;|I&lt;uri&gt;
 
-The private key input for PKCS12 output. If this option is not specified then
-the input file (B&lt;-in&gt; argument) must contain a private key.
-If no engine is used, the argument is taken as a file;
-if the B&lt;-engine&gt; option is used or the URI has prefix C&lt;org.openssl.engine:&gt;
+The private key input for PKCS12 output.
+If this option is not specified then the input file (B&lt;-in&gt; argument) must
+contain a private key.
+If no engine is used, the argument is taken as a file.
+If the B&lt;-engine&gt; option is used or the URI has prefix C&lt;org.openssl.engine:&gt;
 then the rest of the URI is taken as key identifier for the given engine.
 
-=item B&lt;-name&gt; I&lt;friendlyname&gt;
-
-This specifies the &quot;friendly name&quot; for the certificate and private key. This
-name is typically displayed in list boxes by software importing the file.
-
 =item B&lt;-certfile&gt; I&lt;filename&gt;
 
-An input file with extra certificates to be added to the PKCS12 output
+An input file with extra certificates to be added to the PKCS#12 output
 if the B&lt;-export&gt; option is given.
 
+=item B&lt;-passcerts&gt; I&lt;arg&gt;
+
+The password source for certificate input such as B&lt;-certfile&gt;
+and B&lt;-untrusted&gt;.
+For more information about the format of B&lt;arg&gt;
+see the B&lt;PASS PHRASE ARGUMENTS&gt; section in L&lt;openssl(1)&gt;.
+
+=item B&lt;-chain&gt;
+
+If this option is present then the certificate chain of the end entity
+certificate is built and included in the PKCS#12 output file.
+The end entity certificate is the first one read from the B&lt;-in&gt; file
+if no key is given, else the first certificate matching the given key.
+The standard CA trust store is used for chain building,
+as well as any untrusted CA certificates given with the B&lt;-untrusted&gt; option.
+
 =item B&lt;-untrusted&gt; I&lt;filename&gt;
 
 An input file of untrusted certificates that may be used
@@ -232,12 +275,12 @@ for chain building, which is relevant only when a PKCS#12 file is created
 with the B&lt;-export&gt; option and the B&lt;-chain&gt; option is given as well.
 Any certificates that are actually part of the chain are added to the output.
 
-=item B&lt;-passcerts&gt; I&lt;arg&gt;
+{- $OpenSSL::safe::opt_trust_item -}
 
-The password source for certificate input such as B&lt;-certfile&gt;
-and B&lt;-untrusted&gt;.
-For more information about the format of B&lt;arg&gt;
-see the B&lt;PASS PHRASE ARGUMENTS&gt; section in L&lt;openssl(1)&gt;.
+=item B&lt;-name&gt; I&lt;friendlyname&gt;
+
+This specifies the &quot;friendly name&quot; for the certificates and private key. This
+name is typically displayed in list boxes by software importing the file.
 
 =item B&lt;-caname&gt; I&lt;friendlyname&gt;
 
@@ -246,29 +289,24 @@ used multiple times to specify names for all certificates in the order they
 appear. Netscape ignores friendly names on other certificates whereas MSIE
 displays them.
 
-=item B&lt;-passin&gt; I&lt;arg&gt;, B&lt;-passout&gt; I&lt;arg&gt;
+=item B&lt;-CSP&gt; I&lt;name&gt;
 
-The password source for the input, and for encrypting any private keys that
-are output.
-For more information about the format of B&lt;arg&gt;
-see L&lt;openssl(1)/Pass Phrase Options&gt;.
+Write I&lt;name&gt; as a Microsoft CSP name.
 
-=item B&lt;-chain&gt;
+=item B&lt;-LMK&gt;
 
-If this option is present then the certificate chain of the end entity
-certificate is built and included in the PKCS#12 output file.
-The end entity certificate is the first one read from the B&lt;-in&gt; file
-if no key is given, else the first certificate matching the given key.
-The standard CA trust store is used for chain building,
-as well as any untrusted CA certificates given with the B&lt;-untrusted&gt; option.
+Add the &quot;Local Key Set&quot; identifier to the attributes.
 
-=item B&lt;-descert&gt;
+=item B&lt;-keyex&gt;|B&lt;-keysig&gt;
 
-Encrypt the certificate using triple DES, this may render the PKCS#12
-file unreadable by some &quot;export grade&quot; software. By default the private
-key and the certificates are encrypted using AES-256-CBC unless
-the '-legacy' option is used. If '-descert' is used with the '-legacy'
-then both, the private key and the certificate are encrypted using triple DES.
+Specifies that the private key is to be used for key exchange or just signing.
+This option is only interpreted by MSIE and similar MS software. Normally
+&quot;export grade&quot; software will only allow 512 bit RSA keys to be used for
+encryption purposes but arbitrary length keys for signing. The B&lt;-keysig&gt;
+option marks the key for signing only. Signing only keys can be used for
+S/MIME signing, authenticode (ActiveX control signing)  and SSL client
+authentication, however, due to a bug only MSIE 5.0 and later support
+the use of signing only keys for SSL client authentication.
 
 =item B&lt;-keypbe&gt; I&lt;alg&gt;, B&lt;-certpbe&gt; I&lt;alg&gt;
 
@@ -279,18 +317,14 @@ can be used (see L&lt;/NOTES&gt; section for more information). If a cipher name
 is used with PKCS#5 v2.0. For interoperability reasons it is advisable to only
 use PKCS#12 algorithms.
 
-Special value C&lt;NONE&gt; disables encryption of the private key and certificate.
+Special value C&lt;NONE&gt; disables encryption of the private key and certificates.
 
-=item B&lt;-keyex&gt;|B&lt;-keysig&gt;
+=item B&lt;-descert&gt;
 
-Specifies that the private key is to be used for key exchange or just signing.
-This option is only interpreted by MSIE and similar MS software. Normally
-&quot;export grade&quot; software will only allow 512 bit RSA keys to be used for
-encryption purposes but arbitrary length keys for signing. The B&lt;-keysig&gt;
-option marks the key for signing only. Signing only keys can be used for
-S/MIME signing, authenticode (ActiveX control signing)  and SSL client
-authentication, however, due to a bug only MSIE 5.0 and later support
-the use of signing only keys for SSL client authentication.
+Encrypt the certificates using triple DES. By default the private
+key and the certificates are encrypted using AES-256-CBC unless
+the '-legacy' option is used. If '-descert' is used with the '-legacy'
+then both, the private key and the certificates are encrypted using triple DES.
 
 =item B&lt;-macalg&gt; I&lt;digest&gt;
 
@@ -307,12 +341,12 @@ to it: this causes a certain part of the algorithm to be repeated and slows it
 down. The MAC is used to check the file integrity but since it will normally
 have the same password as the keys and certificates it could also be attacked.
 
-=item B&lt;-nomaciter&gt;, B&lt;-noiter&gt;
+=item B&lt;-noiter&gt;, B&lt;-nomaciter&gt;
 
-By default both MAC and encryption iteration counts are set to 2048, using
+By default both encryption and MAC iteration counts are set to 2048, using
 these options the MAC and encryption iteration counts can be set to 1, since
 this reduces the file security you should not use these options unless you
-really have to. Most software supports both MAC and key iteration counts.
+really have to. Most software supports both MAC and encryption iteration counts.
 MSIE 4.0 doesn't support MAC iteration counts so it needs the B&lt;-nomaciter&gt;
 option.
 
@@ -325,22 +359,6 @@ to be needed to use MAC iterations counts but they are now used by default.
 
 Don't attempt to provide the MAC integrity.
 
-=item B&lt;-LMK&gt;
-
-Add the &quot;Local Key Set&quot; identifier to the attributes.
-
-=item B&lt;-CSP&gt; I&lt;name&gt;
-
-Write I&lt;name&gt; as a Microsoft CSP name.
-
-{- $OpenSSL::safe::opt_trust_item -}
-
-{- $OpenSSL::safe::opt_r_item -}
-
-{- $OpenSSL::safe::opt_engine_item -}
-
-{- $OpenSSL::safe::opt_provider_item -}
-
 =back
 
 =head1 NOTES
@@ -352,10 +370,11 @@ for PKCS#12 file creation B&lt;-export&gt; and B&lt;-name&gt; are also used.
 If none of the B&lt;-clcerts&gt;, B&lt;-cacerts&gt; or B&lt;-nocerts&gt; options are present
 then all certificates will be output in the order they appear in the input
 PKCS#12 files. There is no guarantee that the first certificate present is
-the one corresponding to the private key. Certain software which requires
-a private key and certificate and assumes the first certificate in the
-file is the one corresponding to the private key: this may not always
-be the case. Using the B&lt;-clcerts&gt; option will solve this problem by only
+the one corresponding to the private key.
+Certain software which tries to get a private key and the corresponding
+certificate might assume that the first certificate in the file is the one
+corresponding to the private key, but that may not always be the case.
+Using the B&lt;-clcerts&gt; option will solve this problem by only
 outputting the certificate corresponding to the private key. If the CA
 certificates are required then they can be output to a separate file using
 the B&lt;-nokeys&gt; B&lt;-cacerts&gt; options to just output CA certificates.
@@ -379,7 +398,7 @@ command.
 
 =head1 EXAMPLES
 
-Parse a PKCS#12 file and output it to a file:
+Parse a PKCS#12 file and output it to a PEM file:
 
  openssl pkcs12 -in file.p12 -out file.pem
 
@@ -399,16 +418,17 @@ Print some info about a PKCS#12 file in legacy mode:
 
  openssl pkcs12 -in file.p12 -info -noout -legacy
 
-Create a PKCS#12 file:
+Create a PKCS#12 file from a PEM file that may contain a key and certificates:
 
- openssl pkcs12 -export -in file.pem -out file.p12 -name &quot;My Certificate&quot;
+ openssl pkcs12 -export -in file.pem -out file.p12 -name &quot;My PSE&quot;
 
 Include some extra certificates:
 
- openssl pkcs12 -export -in file.pem -out file.p12 -name &quot;My Certificate&quot; \
+ openssl pkcs12 -export -in file.pem -out file.p12 -name &quot;My PSE&quot; \
   -certfile othercerts.pem
 
-Export a PKCS#12 file with default algorithms as in the legacy provider:
+Export a PKCS#12 file with data from a certificate PEM file and from a further
+PEM file containing a key, with default algorithms as in the legacy provider:
 
  openssl pkcs12 -export -in cert.pem -inkey key.pem -out file.p12 -legacy
 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032493.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="032506.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32504">[ date ]</a>
              <a href="thread.html#32504">[ thread ]</a>
              <a href="subject.html#32504">[ subject ]</a>
              <a href="author.html#32504">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
