<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2017-July/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1500248393.707578.18841.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015451.html">
   <LINK REL="Next"  HREF="015454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1500248393.707578.18841.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Sun Jul 16 23:39:53 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="015451.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="015454.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15452">[ date ]</a>
              <a href="thread.html#15452">[ thread ]</a>
              <a href="subject.html#15452">[ subject ]</a>
              <a href="author.html#15452">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  3ee1eac27a2e3120fbdc60e12db091c082b8de21 (commit)
      from  e90fc053c33a2241004451cfdeecfbf3cbdeb728 (commit)


- Log -----------------------------------------------------------------
commit 3ee1eac27a2e3120fbdc60e12db091c082b8de21
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
Date:   Wed Jul 5 10:58:48 2017 -0400

    Standardize apps use of -rand, etc.
    
    Standardized the -rand flag and added a new one:
        -rand file...
                Always reads the specified files
        -writerand file
                Always writes to the file on exit
    
    For apps that use a config file, the RANDFILE config parameter reads
    the file at startup (to seed the RNG) and write to it on exit if
    the -writerand flag isn't used.
    
    Ensured that every app that took -rand also took -writerand, and
    made sure all of that agreed with all the documentation.
    
    Fix error reporting in write_file and -rand
    
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/3862">https://github.com/openssl/openssl/pull/3862</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/app_rand.c        | 130 ++++++++++++++++++++-----------------------------
 apps/apps.h            |  29 ++++++-----
 apps/ca.c              |  14 +++---
 apps/cms.c             |  36 +++++---------
 apps/dgst.c            |  18 +++----
 apps/dhparam.c         |  21 +++-----
 apps/dsaparam.c        |  28 +++--------
 apps/ecparam.c         |  29 ++++-------
 apps/enc.c             |   8 ++-
 apps/gendsa.c          |  23 +++------
 apps/genrsa.c          |  24 +++------
 apps/openssl.c         |   1 +
 apps/passwd.c          |   8 ++-
 apps/pkcs12.c          |  24 +++------
 apps/pkcs8.c           |  10 ++--
 apps/pkeyutl.c         |  11 +++--
 apps/rand.c            |  20 +++-----
 apps/req.c             |  29 ++++-------
 apps/rsautl.c          |  11 +++--
 apps/s_client.c        |  25 +++-------
 apps/s_server.c        |  22 +++------
 apps/smime.c           |  34 ++++---------
 apps/speed.c           |   7 ++-
 apps/srp.c             |  19 +++-----
 apps/ts.c              |  25 +++-------
 apps/x509.c            |  21 ++++----
 crypto/rand/randfile.c |   5 +-
 doc/man1/ca.pod        |  19 +++++++-
 doc/man1/cms.pod       |  12 +++--
 doc/man1/dgst.pod      |  10 +++-
 doc/man1/dhparam.pod   |  12 +++--
 doc/man1/dsaparam.pod  |  12 +++--
 doc/man1/ecparam.pod   |  12 +++--
 doc/man1/enc.pod       |  15 ++++++
 doc/man1/gendsa.pod    |  12 +++--
 doc/man1/genrsa.pod    |  12 +++--
 doc/man1/passwd.pod    |  15 ++++++
 doc/man1/pkcs12.pod    |  12 +++--
 doc/man1/pkcs8.pod     |  15 ++++++
 doc/man1/pkeyutl.pod   |  15 ++++++
 doc/man1/rand.pod      |  16 ++++--
 doc/man1/req.pod       |  16 ++++--
 doc/man1/rsautl.pod    |  15 ++++++
 doc/man1/s_client.pod  |  12 +++--
 doc/man1/s_server.pod  |  12 +++--
 doc/man1/smime.pod     |  12 +++--
 doc/man1/speed.pod     |  15 ++++++
 doc/man1/ts.pod        |  18 +++++--
 doc/man1/x509.pod      |  15 ++++++
 49 files changed, 510 insertions(+), 426 deletions(-)

diff --git a/apps/app_rand.c b/apps/app_rand.c
index 21445ac..960d2fe 100644
--- a/apps/app_rand.c
+++ b/apps/app_rand.c
@@ -10,108 +10,82 @@
 #include &quot;apps.h&quot;
 #include &lt;openssl/bio.h&gt;
 #include &lt;openssl/rand.h&gt;
+#include &lt;openssl/conf.h&gt;
 
-static int seeded = 0;
-static int egdsocket = 0;
+static const char *save_rand_file;
 
-int app_RAND_load_file(const char *file, int dont_warn)
+void app_RAND_load_conf(CONF *c, const char *section)
 {
-    int consider_randfile = (file == NULL);
-    char buffer[200];
+    const char *randfile = NCONF_get_string(c, section, &quot;RANDFILE&quot;);
 
-    if (file == NULL) {
-        file = RAND_file_name(buffer, sizeof buffer);
-#ifndef OPENSSL_NO_EGD
-    } else if (RAND_egd(file) &gt; 0) {
-        /*
-         * we try if the given filename is an EGD socket. if it is, we don't
-         * write anything back to the file.
-         */
-        egdsocket = 1;
-        return 1;
-#endif
+    if (randfile == NULL) {
+        ERR_clear_error();
+        return;
     }
-
-    if (file == NULL || !RAND_load_file(file, -1)) {
-        if (RAND_status() == 0) {
-            if (!dont_warn) {
-                BIO_printf(bio_err, &quot;unable to load 'random state'\n&quot;);
-                BIO_printf(bio_err,
-                           &quot;This means that the random number generator has not been seeded\n&quot;);
-                BIO_printf(bio_err, &quot;with much random data.\n&quot;);
-                if (consider_randfile) { /* explanation does not apply when a
-                                          * file is explicitly named */
-                    BIO_printf(bio_err,
-                               &quot;Consider setting the RANDFILE environment variable to point at a file that\n&quot;);
-                    BIO_printf(bio_err,
-                               &quot;'random' data can be kept in (the file will be overwritten).\n&quot;);
-                }
-            }
-            return 0;
-        }
+    if (RAND_load_file(randfile, -1) &lt; 0) {
+        BIO_printf(bio_err, &quot;Can't load %s into RNG\n&quot;, randfile);
+        ERR_print_errors(bio_err);
+        return;
     }
-    seeded = 1;
-    return 1;
+    if (save_rand_file == NULL)
+        save_rand_file = randfile;
 }
 
-long app_RAND_load_files(char *name)
+static int loadfiles(char *name)
 {
     char *p, *n;
-    int last;
-    long tot = 0;
-#ifndef OPENSSL_NO_EGD
-    int egd;
-#endif
+    int last, ret = 1;
 
-    for (;;) {
+    for ( ; ; ) {
         last = 0;
-        for (p = name; ((*p != '\0') &amp;&amp; (*p != LIST_SEPARATOR_CHAR)); p++) ;
+        for (p = name; *p != '\0' &amp;&amp; *p != LIST_SEPARATOR_CHAR; p++)
+            continue;
         if (*p == '\0')
             last = 1;
         *p = '\0';
+        if (RAND_load_file(name, -1) &lt; 0) {
+            BIO_printf(bio_err, &quot;Can't load %s into RNG\n&quot;, name);
+            ERR_print_errors(bio_err);
+            ret = 0;
+        }
         n = name;
-        name = p + 1;
-        if (*n == '\0')
-            break;
-
-#ifndef OPENSSL_NO_EGD
-        egd = RAND_egd(n);
-        if (egd &gt; 0)
-            tot += egd;
-        else
-#endif
-            tot += RAND_load_file(n, -1);
         if (last)
             break;
+        name = p + 1;
+        if (*name == '\0')
+            break;
     }
-    if (tot &gt; 512)
-        app_RAND_allow_write_file();
-    return (tot);
+    return ret;
 }
 
-int app_RAND_write_file(const char *file)
+void app_RAND_write(void)
 {
-    char buffer[200];
-
-    if (egdsocket || !seeded) {
-        /*
-         * If we didn't manage to read the seed file, don't write a
-         * file out -- it would suppress a crucial warning the next
-         * time we want to use it.
-         */
-        return 0;
+    if (save_rand_file == NULL)
+        return;
+    if (RAND_write_file(save_rand_file) == -1) {
+        BIO_printf(bio_err, &quot;Cannot write random bytes:\n&quot;);
+        ERR_print_errors(bio_err);
     }
-
-    if (file == NULL)
-        file = RAND_file_name(buffer, sizeof buffer);
-    if (file == NULL || !RAND_write_file(file)) {
-        BIO_printf(bio_err, &quot;unable to write 'random state'\n&quot;);
-        return 0;
-    }
-    return 1;
 }
 
-void app_RAND_allow_write_file(void)
+
+/*
+ * See comments in opt_verify for explanation of this.
+ */
+enum r_range { OPT_R_ENUM };
+
+int opt_rand(int opt)
 {
-    seeded = 1;
+    switch ((enum r_range)opt) {
+    case OPT_R__FIRST:
+    case OPT_R__LAST:
+        break;
+    case OPT_R_RAND:
+        return loadfiles(opt_arg());
+        break;
+    case OPT_R_WRITERAND:
+        save_rand_file = opt_arg();
+        break;
+    }
+    return 1;
 }
diff --git a/apps/apps.h b/apps/apps.h
index 09c601b..aa3cd3f 100644
--- a/apps/apps.h
+++ b/apps/apps.h
@@ -40,16 +40,8 @@
  */
 #define _UC(c) ((unsigned char)(c))
 
-int app_RAND_load_file(const char *file, int dont_warn);
-int app_RAND_write_file(const char *file);
-/*
- * When `file' is NULL, use defaults. `bio_e' is for error messages.
- */
-void app_RAND_allow_write_file(void);
-long app_RAND_load_files(char *file); /* `file' is a list of files to read,
-                                       * separated by LIST_SEPARATOR_CHAR
-                                       * (see e_os.h).  The string is
-                                       * destroyed! */
+void app_RAND_load_conf(CONF *c, const char *section);
+void app_RAND_write(void);
 
 extern char *default_config_file;
 extern BIO *bio_in;
@@ -177,7 +169,7 @@ int set_cert_times(X509 *x, const char *startdate, const char *enddate,
         case OPT_V_ALLOW_PROXY_CERTS
 
 /*
- * Common &quot;extended&quot;? options.
+ * Common &quot;extended validation&quot; options.
  */
 # define OPT_X_ENUM \
         OPT_X__FIRST=1000, \
@@ -300,6 +292,20 @@ int set_cert_times(X509 *x, const char *startdate, const char *enddate,
   || o == OPT_S_NOTLS1_2 || o == OPT_S_NOTLS1_3)
 
 /*
+ * Random state options.
+ */
+# define OPT_R_ENUM \
+        OPT_R__FIRST=1500, OPT_R_RAND, OPT_R_WRITERAND, OPT_R__LAST
+
+# define OPT_R_OPTIONS \
+    {&quot;rand&quot;, OPT_R_RAND, 's', &quot;Load the file(s) into the random number generator&quot;}, \
+    {&quot;writerand&quot;, OPT_R_WRITERAND, '&gt;', &quot;Write random data to the specified file&quot;}
+
+# define OPT_R_CASES \
+        OPT_R__FIRST: case OPT_R__LAST: break; \
+        case OPT_R_RAND: case OPT_R_WRITERAND
+
+/*
  * Option parsing.
  */
 extern const char OPT_HELP_STR[];
@@ -373,6 +379,7 @@ char *opt_reset(void);
 char **opt_rest(void);
 int opt_num_rest(void);
 int opt_verify(int i, X509_VERIFY_PARAM *vpm);
+int opt_rand(int i);
 void opt_help(const OPTIONS * list);
 int opt_format_error(const char *s, unsigned long flags);
 
diff --git a/apps/ca.c b/apps/ca.c
index 91d962f..c1c2c49 100644
--- a/apps/ca.c
+++ b/apps/ca.c
@@ -153,6 +153,7 @@ typedef enum OPTION_choice {
     OPT_GENCRL, OPT_MSIE_HACK, OPT_CRLDAYS, OPT_CRLHOURS, OPT_CRLSEC,
     OPT_INFILES, OPT_SS_CERT, OPT_SPKAC, OPT_REVOKE, OPT_VALID,
     OPT_EXTENSIONS, OPT_EXTFILE, OPT_STATUS, OPT_UPDATEDB, OPT_CRLEXTS,
+    OPT_R_ENUM,
     /* Do not change the order here; see related case statements below */
     OPT_CRL_REASON, OPT_CRL_HOLD, OPT_CRL_COMPROMISE, OPT_CRL_CA_COMPROMISE
 } OPTION_CHOICE;
@@ -217,6 +218,7 @@ const OPTIONS ca_options[] = {
      &quot;sets compromise time to val and the revocation reason to keyCompromise&quot;},
     {&quot;crl_CA_compromise&quot;, OPT_CRL_CA_COMPROMISE, 's',
      &quot;sets compromise time to val and the revocation reason to CACompromise&quot;},
+    OPT_R_OPTIONS,
 #ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 #endif
@@ -247,7 +249,7 @@ int ca_main(int argc, char **argv)
     char *outdir = NULL, *outfile = NULL, *rev_arg = NULL, *ser_status = NULL;
     const char *serialfile = NULL, *subj = NULL;
     char *prog, *startdate = NULL, *enddate = NULL;
-    char *dbfile = NULL, *f, *randfile = NULL;
+    char *dbfile = NULL, *f;
     char new_cert[CERT_MAX + 1];
     char tmp[10 + 1] = &quot;\0&quot;;
     char *const *pp;
@@ -332,6 +334,10 @@ opthelp:
         case OPT_PASSIN:
             passinarg = opt_arg();
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         case OPT_KEY:
             key = opt_arg();
             break;
@@ -465,10 +471,7 @@ end_of_options:
         }
     }
 
-    randfile = NCONF_get_string(conf, BASE_SECTION, &quot;RANDFILE&quot;);
-    if (randfile == NULL)
-        ERR_clear_error();
-    app_RAND_load_file(randfile, 0);
+    app_RAND_load_conf(conf, BASE_SECTION);
 
     f = NCONF_get_string(conf, section, STRING_MASK);
     if (f == NULL)
@@ -1220,7 +1223,6 @@ end_of_options:
 
     if (ret)
         ERR_print_errors(bio_err);
-    app_RAND_write_file(randfile);
     if (free_key)
         OPENSSL_free(key);
     BN_free(serial);
diff --git a/apps/cms.c b/apps/cms.c
index 25ee7e8..543d013 100644
--- a/apps/cms.c
+++ b/apps/cms.c
@@ -76,10 +76,11 @@ typedef enum OPTION_choice {
     OPT_RR_ALL, OPT_RR_FIRST, OPT_RCTFORM, OPT_CERTFILE, OPT_CAFILE,
     OPT_CAPATH, OPT_NOCAPATH, OPT_NOCAFILE,OPT_CONTENT, OPT_PRINT,
     OPT_SECRETKEY, OPT_SECRETKEYID, OPT_PWRI_PASSWORD, OPT_ECONTENT_TYPE,
-    OPT_RAND, OPT_PASSIN, OPT_TO, OPT_FROM, OPT_SUBJECT, OPT_SIGNER, OPT_RECIP,
+    OPT_PASSIN, OPT_TO, OPT_FROM, OPT_SUBJECT, OPT_SIGNER, OPT_RECIP,
     OPT_CERTSOUT, OPT_MD, OPT_INKEY, OPT_KEYFORM, OPT_KEYOPT, OPT_RR_FROM,
     OPT_RR_TO, OPT_AES128_WRAP, OPT_AES192_WRAP, OPT_AES256_WRAP,
     OPT_3DES_WRAP, OPT_ENGINE,
+    OPT_R_ENUM,
     OPT_V_ENUM,
     OPT_CIPHER
 } OPTION_CHOICE;
@@ -152,8 +153,6 @@ const OPTIONS cms_options[] = {
     {&quot;secretkeyid&quot;, OPT_SECRETKEYID, 's'},
     {&quot;pwri_password&quot;, OPT_PWRI_PASSWORD, 's'},
     {&quot;econtent_type&quot;, OPT_ECONTENT_TYPE, 's'},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;to&quot;, OPT_TO, 's', &quot;To address&quot;},
     {&quot;from&quot;, OPT_FROM, 's', &quot;From address&quot;},
@@ -169,6 +168,7 @@ const OPTIONS cms_options[] = {
     {&quot;receipt_request_from&quot;, OPT_RR_FROM, 's'},
     {&quot;receipt_request_to&quot;, OPT_RR_TO, 's'},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
+    OPT_R_OPTIONS,
     OPT_V_OPTIONS,
     {&quot;aes128-wrap&quot;, OPT_AES128_WRAP, '-', &quot;Use AES128 to wrap key&quot;},
     {&quot;aes192-wrap&quot;, OPT_AES192_WRAP, '-', &quot;Use AES192 to wrap key&quot;},
@@ -202,16 +202,13 @@ int cms_main(int argc, char **argv)
     const char *CAfile = NULL, *CApath = NULL;
     char *certsoutfile = NULL;
     int noCAfile = 0, noCApath = 0;
-    char *infile = NULL, *outfile = NULL, *rctfile = NULL, *inrand = NULL;
-    char *passinarg = NULL, *passin = NULL, *signerfile = NULL, *recipfile =
-        NULL;
+    char *infile = NULL, *outfile = NULL, *rctfile = NULL;
+    char *passinarg = NULL, *passin = NULL, *signerfile = NULL, *recipfile = NULL;
     char *to = NULL, *from = NULL, *subject = NULL, *prog;
     cms_key_param *key_first = NULL, *key_param = NULL;
-    int flags = CMS_DETACHED, noout = 0, print = 0, keyidx = -1, vpmtouched =
-        0;
+    int flags = CMS_DETACHED, noout = 0, print = 0, keyidx = -1, vpmtouched = 0;
     int informat = FORMAT_SMIME, outformat = FORMAT_SMIME;
-    int need_rand = 0, operation = 0, ret = 1, rr_print = 0, rr_allorfirst =
-        -1;
+    int operation = 0, ret = 1, rr_print = 0, rr_allorfirst = -1;
     int verify_retcode = 0, rctformat = FORMAT_SMIME, keyform = FORMAT_PEM;
     size_t secret_keylen = 0, secret_keyidlen = 0;
     unsigned char *pwri_pass = NULL, *pwri_tmp = NULL;
@@ -449,10 +446,6 @@ int cms_main(int argc, char **argv)
                 goto opthelp;
             }
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
-            need_rand = 1;
-            break;
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
             break;
@@ -568,6 +561,10 @@ int cms_main(int argc, char **argv)
                 goto end;
             vpmtouched++;
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         case OPT_3DES_WRAP:
 # ifndef OPENSSL_NO_DES
             wrap_cipher = EVP_des_ede3_wrap();
@@ -624,7 +621,6 @@ int cms_main(int argc, char **argv)
         }
         signerfile = NULL;
         keyfile = NULL;
-        need_rand = 1;
     } else if (operation == SMIME_DECRYPT) {
         if (recipfile == NULL &amp;&amp; keyfile == NULL
             &amp;&amp; secret_key == NULL &amp;&amp; pwri_pass == NULL) {
@@ -638,7 +634,6 @@ int cms_main(int argc, char **argv)
             BIO_printf(bio_err, &quot;No recipient(s) certificate(s) specified\n&quot;);
             goto opthelp;
         }
-        need_rand = 1;
     } else if (!operation) {
         goto opthelp;
     }
@@ -648,13 +643,6 @@ int cms_main(int argc, char **argv)
         goto end;
     }
 
-    if (need_rand) {
-        app_RAND_load_file(NULL, (inrand != NULL));
-        if (inrand != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(inrand));
-    }
-
     ret = 2;
 
     if (!(operation &amp; SMIME_SIGNERS))
@@ -1083,8 +1071,6 @@ int cms_main(int argc, char **argv)
  end:
     if (ret)
         ERR_print_errors(bio_err);
-    if (need_rand)
-        app_RAND_write_file(NULL);
     sk_X509_pop_free(encerts, X509_free);
     sk_X509_pop_free(other, X509_free);
     X509_VERIFY_PARAM_free(vpm);
diff --git a/apps/dgst.c b/apps/dgst.c
index 545c032..df50947 100644
--- a/apps/dgst.c
+++ b/apps/dgst.c
@@ -29,11 +29,12 @@ int do_fp(BIO *out, unsigned char *buf, BIO *bp, int sep, int binout,
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
-    OPT_C, OPT_R, OPT_RAND, OPT_OUT, OPT_SIGN, OPT_PASSIN, OPT_VERIFY,
+    OPT_C, OPT_R, OPT_OUT, OPT_SIGN, OPT_PASSIN, OPT_VERIFY,
     OPT_PRVERIFY, OPT_SIGNATURE, OPT_KEYFORM, OPT_ENGINE, OPT_ENGINE_IMPL,
     OPT_HEX, OPT_BINARY, OPT_DEBUG, OPT_FIPS_FINGERPRINT,
     OPT_HMAC, OPT_MAC, OPT_SIGOPT, OPT_MACOPT,
-    OPT_DIGEST
+    OPT_DIGEST,
+    OPT_R_ENUM,
 } OPTION_CHOICE;
 
 const OPTIONS dgst_options[] = {
@@ -43,8 +44,6 @@ const OPTIONS dgst_options[] = {
     {&quot;help&quot;, OPT_HELP, '-', &quot;Display this summary&quot;},
     {&quot;c&quot;, OPT_C, '-', &quot;Print the digest with separating colons&quot;},
     {&quot;r&quot;, OPT_R, '-', &quot;Print the digest in coreutils format&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Use file(s) containing random data to seed RNG or an EGD sock&quot;},
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output to filename rather than stdout&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;sign&quot;, OPT_SIGN, 's', &quot;Sign digest using private key&quot;},
@@ -65,6 +64,7 @@ const OPTIONS dgst_options[] = {
     {&quot;sigopt&quot;, OPT_SIGOPT, 's', &quot;Signature parameter in n:v form&quot;},
     {&quot;macopt&quot;, OPT_MACOPT, 's', &quot;MAC algorithm parameters in n:v form or key&quot;},
     {&quot;&quot;, OPT_DIGEST, '-', &quot;Any supported digest&quot;},
+    OPT_R_OPTIONS,
 #ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine e, possibly a hardware device&quot;},
     {&quot;engine_impl&quot;, OPT_ENGINE_IMPL, '-',
@@ -84,7 +84,7 @@ int dgst_main(int argc, char **argv)
     char *passinarg = NULL, *passin = NULL;
     const EVP_MD *md = NULL, *m;
     const char *outfile = NULL, *keyfile = NULL, *prog = NULL;
-    const char *sigfile = NULL, *randfile = NULL;
+    const char *sigfile = NULL;
     OPTION_CHOICE o;
     int separator = 0, debug = 0, keyform = FORMAT_PEM, siglen = 0;
     int i, ret = 1, out_bin = -1, want_pub = 0, do_verify = 0;
@@ -113,8 +113,9 @@ int dgst_main(int argc, char **argv)
         case OPT_R:
             separator = 2;
             break;
-        case OPT_RAND:
-            randfile = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_OUT:
             outfile = opt_arg();
@@ -223,9 +224,6 @@ int dgst_main(int argc, char **argv)
             out_bin = 0;
     }
 
-    if (randfile != NULL)
-        app_RAND_load_file(randfile, 0);
-
     out = bio_open_default(outfile, 'w', out_bin ? FORMAT_BINARY : FORMAT_TEXT);
     if (out == NULL)
         goto end;
diff --git a/apps/dhparam.c b/apps/dhparam.c
index fc3a51e..28ae6c3 100644
--- a/apps/dhparam.c
+++ b/apps/dhparam.c
@@ -36,7 +36,8 @@ typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_INFORM, OPT_OUTFORM, OPT_IN, OPT_OUT,
     OPT_ENGINE, OPT_CHECK, OPT_TEXT, OPT_NOOUT,
-    OPT_RAND, OPT_DSAPARAM, OPT_C, OPT_2, OPT_5
+    OPT_DSAPARAM, OPT_C, OPT_2, OPT_5,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS dhparam_options[] = {
@@ -50,8 +51,7 @@ const OPTIONS dhparam_options[] = {
     {&quot;check&quot;, OPT_CHECK, '-', &quot;Check the DH parameters&quot;},
     {&quot;text&quot;, OPT_TEXT, '-', &quot;Print a text form of the DH parameters&quot;},
     {&quot;noout&quot;, OPT_NOOUT, '-', &quot;Don't output any DH parameters&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;C&quot;, OPT_C, '-', &quot;Print C code&quot;},
     {&quot;2&quot;, OPT_2, '-', &quot;Generate parameters using 2 as the generator value&quot;},
     {&quot;5&quot;, OPT_5, '-', &quot;Generate parameters using 5 as the generator value&quot;},
@@ -69,7 +69,7 @@ int dhparam_main(int argc, char **argv)
 {
     BIO *in = NULL, *out = NULL;
     DH *dh = NULL;
-    char *infile = NULL, *outfile = NULL, *prog, *inrand = NULL;
+    char *infile = NULL, *outfile = NULL, *prog;
     ENGINE *e = NULL;
 #ifndef OPENSSL_NO_DSA
     int dsaparam = 0;
@@ -130,8 +130,9 @@ int dhparam_main(int argc, char **argv)
         case OPT_NOOUT:
             noout = 1;
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         }
     }
@@ -165,13 +166,6 @@ int dhparam_main(int argc, char **argv)
         }
 
         BN_GENCB_set(cb, dh_cb, bio_err);
-        if (!app_RAND_load_file(NULL, 1) &amp;&amp; inrand == NULL) {
-            BIO_printf(bio_err,
-                       &quot;warning, not much extra random data, consider using the -rand option\n&quot;);
-        }
-        if (inrand != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(inrand));
 
 # ifndef OPENSSL_NO_DSA
         if (dsaparam) {
@@ -211,7 +205,6 @@ int dhparam_main(int argc, char **argv)
         }
 
         BN_GENCB_free(cb);
-        app_RAND_write_file(NULL);
     } else {
 
         in = bio_open_default(infile, 'r', informat);
diff --git a/apps/dsaparam.c b/apps/dsaparam.c
index cf0a10b..39185e3 100644
--- a/apps/dsaparam.c
+++ b/apps/dsaparam.c
@@ -29,7 +29,7 @@ static int dsa_cb(int p, int n, BN_GENCB *cb);
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_INFORM, OPT_OUTFORM, OPT_IN, OPT_OUT, OPT_TEXT, OPT_C,
-    OPT_NOOUT, OPT_GENKEY, OPT_RAND, OPT_ENGINE
+    OPT_NOOUT, OPT_GENKEY, OPT_ENGINE, OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS dsaparam_options[] = {
@@ -42,7 +42,7 @@ const OPTIONS dsaparam_options[] = {
     {&quot;C&quot;, OPT_C, '-', &quot;Output C code&quot;},
     {&quot;noout&quot;, OPT_NOOUT, '-', &quot;No output&quot;},
     {&quot;genkey&quot;, OPT_GENKEY, '-', &quot;Generate a DSA key&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's', &quot;Files to use for random number input&quot;},
+    OPT_R_OPTIONS,
 # ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine e, possibly a hardware device&quot;},
 # endif
@@ -55,10 +55,10 @@ int dsaparam_main(int argc, char **argv)
     DSA *dsa = NULL;
     BIO *in = NULL, *out = NULL;
     BN_GENCB *cb = NULL;
-    int numbits = -1, num = 0, genkey = 0, need_rand = 0;
+    int numbits = -1, num = 0, genkey = 0;
     int informat = FORMAT_PEM, outformat = FORMAT_PEM, noout = 0, C = 0;
     int ret = 1, i, text = 0, private = 0;
-    char *infile = NULL, *outfile = NULL, *prog, *inrand = NULL;
+    char *infile = NULL, *outfile = NULL, *prog;
     OPTION_CHOICE o;
 
     prog = opt_init(argc, argv, dsaparam_options);
@@ -97,11 +97,11 @@ int dsaparam_main(int argc, char **argv)
             C = 1;
             break;
         case OPT_GENKEY:
-            genkey = need_rand = 1;
+            genkey = 1;
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
-            need_rand = 1;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_NOOUT:
             noout = 1;
@@ -116,7 +116,6 @@ int dsaparam_main(int argc, char **argv)
             goto end;
         /* generate a key */
         numbits = num;
-        need_rand = 1;
     }
     private = genkey ? 1 : 0;
 
@@ -127,13 +126,6 @@ int dsaparam_main(int argc, char **argv)
     if (out == NULL)
         goto end;
 
-    if (need_rand) {
-        app_RAND_load_file(NULL, (inrand != NULL));
-        if (inrand != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(inrand));
-    }
-
     if (numbits &gt; 0) {
         cb = BN_GENCB_new();
         if (cb == NULL) {
@@ -141,7 +133,6 @@ int dsaparam_main(int argc, char **argv)
             goto end;
         }
         BN_GENCB_set(cb, dsa_cb, bio_err);
-        assert(need_rand);
         dsa = DSA_new();
         if (dsa == NULL) {
             BIO_printf(bio_err, &quot;Error allocating DSA object\n&quot;);
@@ -217,7 +208,6 @@ int dsaparam_main(int argc, char **argv)
     if (genkey) {
         DSA *dsakey;
 
-        assert(need_rand);
         if ((dsakey = DSAparams_dup(dsa)) == NULL)
             goto end;
         if (!DSA_generate_key(dsakey)) {
@@ -233,8 +223,6 @@ int dsaparam_main(int argc, char **argv)
                                             NULL);
         DSA_free(dsakey);
     }
-    if (need_rand)
-        app_RAND_write_file(NULL);
     ret = 0;
  end:
     BN_GENCB_free(cb);
diff --git a/apps/ecparam.c b/apps/ecparam.c
index 3661a88..6521ccb 100644
--- a/apps/ecparam.c
+++ b/apps/ecparam.c
@@ -29,7 +29,8 @@ typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_INFORM, OPT_OUTFORM, OPT_IN, OPT_OUT, OPT_TEXT, OPT_C,
     OPT_CHECK, OPT_LIST_CURVES, OPT_NO_SEED, OPT_NOOUT, OPT_NAME,
-    OPT_CONV_FORM, OPT_PARAM_ENC, OPT_GENKEY, OPT_RAND, OPT_ENGINE
+    OPT_CONV_FORM, OPT_PARAM_ENC, OPT_GENKEY, OPT_ENGINE,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS ecparam_options[] = {
@@ -52,7 +53,7 @@ const OPTIONS ecparam_options[] = {
     {&quot;param_enc&quot;, OPT_PARAM_ENC, 's',
      &quot;Specifies the way the ec parameters are encoded&quot;},
     {&quot;genkey&quot;, OPT_GENKEY, '-', &quot;Generate ec key&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's', &quot;Files to use for random number input&quot;},
+    OPT_R_OPTIONS,
 # ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 # endif
@@ -80,7 +81,7 @@ int ecparam_main(int argc, char **argv)
     BIO *in = NULL, *out = NULL;
     EC_GROUP *group = NULL;
     point_conversion_form_t form = POINT_CONVERSION_UNCOMPRESSED;
-    char *curve_name = NULL, *inrand = NULL;
+    char *curve_name = NULL;
     char *infile = NULL, *outfile = NULL, *prog;
     unsigned char *buffer = NULL;
     OPTION_CHOICE o;
@@ -88,7 +89,7 @@ int ecparam_main(int argc, char **argv)
     int informat = FORMAT_PEM, outformat = FORMAT_PEM, noout = 0, C = 0;
     int ret = 1, private = 0;
     int list_curves = 0, no_seed = 0, check = 0, new_form = 0;
-    int text = 0, i, need_rand = 0, genkey = 0;
+    int text = 0, i, genkey = 0;
 
     prog = opt_init(argc, argv, ecparam_options);
     while ((o = opt_next()) != OPT_EOF) {
@@ -149,11 +150,11 @@ int ecparam_main(int argc, char **argv)
             new_asn1_flag = 1;
             break;
         case OPT_GENKEY:
-            genkey = need_rand = 1;
+            genkey = 1;
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
-            need_rand = 1;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
@@ -395,21 +396,12 @@ int ecparam_main(int argc, char **argv)
         }
     }
 
-    if (need_rand) {
-        app_RAND_load_file(NULL, (inrand != NULL));
-        if (inrand != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(inrand));
-    }
-
     if (genkey) {
         EC_KEY *eckey = EC_KEY_new();
 
         if (eckey == NULL)
             goto end;
 
-        assert(need_rand);
-
         if (EC_KEY_set_group(eckey, group) == 0) {
             BIO_printf(bio_err, &quot;unable to set group when generating key\n&quot;);
             EC_KEY_free(eckey);
@@ -432,9 +424,6 @@ int ecparam_main(int argc, char **argv)
         EC_KEY_free(eckey);
     }
 
-    if (need_rand)
-        app_RAND_write_file(NULL);
-
     ret = 0;
  end:
     BN_free(ec_p);
diff --git a/apps/enc.c b/apps/enc.c
index cc6fa0a..db5d3a2 100644
--- a/apps/enc.c
+++ b/apps/enc.c
@@ -43,7 +43,8 @@ typedef enum OPTION_choice {
     OPT_E, OPT_IN, OPT_OUT, OPT_PASS, OPT_ENGINE, OPT_D, OPT_P, OPT_V,
     OPT_NOPAD, OPT_SALT, OPT_NOSALT, OPT_DEBUG, OPT_UPPER_P, OPT_UPPER_A,
     OPT_A, OPT_Z, OPT_BUFSIZE, OPT_K, OPT_KFILE, OPT_UPPER_K, OPT_NONE,
-    OPT_UPPER_S, OPT_IV, OPT_MD, OPT_CIPHER
+    OPT_UPPER_S, OPT_IV, OPT_MD, OPT_CIPHER,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS enc_options[] = {
@@ -74,6 +75,7 @@ const OPTIONS enc_options[] = {
     {&quot;md&quot;, OPT_MD, 's', &quot;Use specified digest to create a key from the passphrase&quot;},
     {&quot;none&quot;, OPT_NONE, '-', &quot;Don't encrypt&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
+    OPT_R_OPTIONS,
 #ifdef ZLIB
     {&quot;z&quot;, OPT_Z, '-', &quot;Use zlib as the 'encryption'&quot;},
 #endif
@@ -255,6 +257,10 @@ int enc_main(int argc, char **argv)
         case OPT_NONE:
             cipher = NULL;
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         }
     }
 
diff --git a/apps/gendsa.c b/apps/gendsa.c
index c9563a7..fa68323 100644
--- a/apps/gendsa.c
+++ b/apps/gendsa.c
@@ -26,7 +26,8 @@ NON_EMPTY_TRANSLATION_UNIT
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
-    OPT_OUT, OPT_PASSOUT, OPT_ENGINE, OPT_RAND, OPT_CIPHER
+    OPT_OUT, OPT_PASSOUT, OPT_ENGINE, OPT_CIPHER,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS gendsa_options[] = {
@@ -35,8 +36,7 @@ const OPTIONS gendsa_options[] = {
     {&quot;help&quot;, OPT_HELP, '-', &quot;Display this summary&quot;},
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output the key to the specified file&quot;},
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Encrypt the output with any supported cipher&quot;},
 # ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
@@ -50,7 +50,7 @@ int gendsa_main(int argc, char **argv)
     BIO *out = NULL, *in = NULL;
     DSA *dsa = NULL;
     const EVP_CIPHER *enc = NULL;
-    char *inrand = NULL, *dsaparams = NULL;
+    char *dsaparams = NULL;
     char *outfile = NULL, *passoutarg = NULL, *passout = NULL, *prog;
     OPTION_CHOICE o;
     int ret = 1, private = 0;
@@ -77,8 +77,9 @@ int gendsa_main(int argc, char **argv)
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_CIPHER:
             if (!opt_cipher(opt_unknown(), &amp;enc))
@@ -114,21 +115,11 @@ int gendsa_main(int argc, char **argv)
     if (out == NULL)
         goto end2;
 
-    if (!app_RAND_load_file(NULL, 1) &amp;&amp; inrand == NULL) {
-        BIO_printf(bio_err,
-                   &quot;warning, not much extra random data, consider using the -rand option\n&quot;);
-    }
-    if (inrand != NULL)
-        BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                   app_RAND_load_files(inrand));
-
     DSA_get0_pqg(dsa, &amp;p, NULL, NULL);
     BIO_printf(bio_err, &quot;Generating DSA key, %d bits\n&quot;, BN_num_bits(p));
     if (!DSA_generate_key(dsa))
         goto end;
 
-    app_RAND_write_file(NULL);
-
     assert(private);
     if (!PEM_write_bio_DSAPrivateKey(out, dsa, enc, NULL, 0, NULL, passout))
         goto end;
diff --git a/apps/genrsa.c b/apps/genrsa.c
index 033e692..2bc70a9 100644
--- a/apps/genrsa.c
+++ b/apps/genrsa.c
@@ -33,7 +33,8 @@ static int genrsa_cb(int p, int n, BN_GENCB *cb);
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_3, OPT_F4, OPT_ENGINE,
-    OPT_OUT, OPT_RAND, OPT_PASSOUT, OPT_CIPHER
+    OPT_OUT, OPT_PASSOUT, OPT_CIPHER,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS genrsa_options[] = {
@@ -42,8 +43,7 @@ const OPTIONS genrsa_options[] = {
     {&quot;F4&quot;, OPT_F4, '-', &quot;Use F4 (0x10001) for the E value&quot;},
     {&quot;f4&quot;, OPT_F4, '-', &quot;Use F4 (0x10001) for the E value&quot;},
     {&quot;out&quot;, OPT_OUT, 's', &quot;Output the key to specified file&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Encrypt the output with any supported cipher&quot;},
 # ifndef OPENSSL_NO_ENGINE
@@ -65,7 +65,7 @@ int genrsa_main(int argc, char **argv)
     int ret = 1, num = DEFBITS, private = 0;
     unsigned long f4 = RSA_F4;
     char *outfile = NULL, *passoutarg = NULL, *passout = NULL;
-    char *inrand = NULL, *prog, *hexe, *dece;
+    char *prog, *hexe, *dece;
     OPTION_CHOICE o;
 
     if (bn == NULL || cb == NULL)
@@ -96,8 +96,9 @@ int genrsa_main(int argc, char **argv)
         case OPT_ENGINE:
             eng = setup_engine(opt_arg(), 0);
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_PASSOUT:
             passoutarg = opt_arg();
@@ -124,15 +125,6 @@ int genrsa_main(int argc, char **argv)
     if (out == NULL)
         goto end;
 
-    if (!app_RAND_load_file(NULL, 1) &amp;&amp; inrand == NULL
-        &amp;&amp; !RAND_status()) {
-        BIO_printf(bio_err,
-                   &quot;warning, not much extra random data, consider using the -rand option\n&quot;);
-    }
-    if (inrand != NULL)
-        BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                   app_RAND_load_files(inrand));
-
     BIO_printf(bio_err, &quot;Generating RSA private key, %d bit long modulus\n&quot;,
                num);
     rsa = eng ? RSA_new_method(eng) : RSA_new();
@@ -142,8 +134,6 @@ int genrsa_main(int argc, char **argv)
     if (!BN_set_word(bn, f4) || !RSA_generate_key_ex(rsa, num, bn, cb))
         goto end;
 
-    app_RAND_write_file(NULL);
-
     RSA_get0_key(rsa, NULL, &amp;e, NULL);
     hexe = BN_bn2hex(e);
     dece = BN_bn2dec(e);
diff --git a/apps/openssl.c b/apps/openssl.c
index e23c390..866c00e 100644
--- a/apps/openssl.c
+++ b/apps/openssl.c
@@ -240,6 +240,7 @@ int main(int argc, char *argv[])
     OPENSSL_free(default_config_file);
     lh_FUNCTION_free(prog);
     OPENSSL_free(arg.argv);
+    app_RAND_write();
 
     BIO_free(bio_in);
     BIO_free_all(bio_out);
diff --git a/apps/passwd.c b/apps/passwd.c
index 7ce40e0..eb5a622 100644
--- a/apps/passwd.c
+++ b/apps/passwd.c
@@ -65,7 +65,8 @@ typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_IN,
     OPT_NOVERIFY, OPT_QUIET, OPT_TABLE, OPT_REVERSE, OPT_APR1,
-    OPT_1, OPT_5, OPT_6, OPT_CRYPT, OPT_AIXMD5, OPT_SALT, OPT_STDIN
+    OPT_1, OPT_5, OPT_6, OPT_CRYPT, OPT_AIXMD5, OPT_SALT, OPT_STDIN,
+    OPT_R_ENUM,
 } OPTION_CHOICE;
 
 const OPTIONS passwd_options[] = {
@@ -90,6 +91,7 @@ const OPTIONS passwd_options[] = {
 # ifndef OPENSSL_NO_DES
     {&quot;crypt&quot;, OPT_CRYPT, '-', &quot;Standard Unix password algorithm (default)&quot;},
 # endif
+    OPT_R_OPTIONS,
     {NULL}
 };
 
@@ -182,6 +184,10 @@ int passwd_main(int argc, char **argv)
             in_stdin = 1;
             pw_source_defined = 1;
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         }
     }
     argc = opt_num_rest();
diff --git a/apps/pkcs12.c b/apps/pkcs12.c
index 2ec8fdc..28ae2d5 100644
--- a/apps/pkcs12.c
+++ b/apps/pkcs12.c
@@ -53,9 +53,10 @@ typedef enum OPTION_choice {
     OPT_CACERTS, OPT_NOOUT, OPT_INFO, OPT_CHAIN, OPT_TWOPASS, OPT_NOMACVER,
     OPT_DESCERT, OPT_EXPORT, OPT_NOITER, OPT_MACITER, OPT_NOMACITER,
     OPT_NOMAC, OPT_LMK, OPT_NODES, OPT_MACALG, OPT_CERTPBE, OPT_KEYPBE,
-    OPT_RAND, OPT_INKEY, OPT_CERTFILE, OPT_NAME, OPT_CSP, OPT_CANAME,
+    OPT_INKEY, OPT_CERTFILE, OPT_NAME, OPT_CSP, OPT_CANAME,
     OPT_IN, OPT_OUT, OPT_PASSIN, OPT_PASSOUT, OPT_PASSWORD, OPT_CAPATH,
-    OPT_CAFILE, OPT_NOCAPATH, OPT_NOCAFILE, OPT_ENGINE
+    OPT_CAFILE, OPT_NOCAPATH, OPT_NOCAFILE, OPT_ENGINE,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS pkcs12_options[] = {
@@ -91,8 +92,7 @@ const OPTIONS pkcs12_options[] = {
     {&quot;macalg&quot;, OPT_MACALG, 's',
      &quot;Digest algorithm used in MAC (default SHA1)&quot;},
     {&quot;keypbe&quot;, OPT_KEYPBE, 's', &quot;Private key PBE algorithm (default 3DES)&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;inkey&quot;, OPT_INKEY, 's', &quot;Private key if not infile&quot;},
     {&quot;certfile&quot;, OPT_CERTFILE, '&lt;', &quot;Load certs from file&quot;},
     {&quot;name&quot;, OPT_NAME, 's', &quot;Use name as friendly name&quot;},
@@ -133,7 +133,7 @@ int pkcs12_main(int argc, char **argv)
     int ret = 1, macver = 1, add_lmk = 0, private = 0;
     int noprompt = 0;
     char *passinarg = NULL, *passoutarg = NULL, *passarg = NULL;
-    char *passin = NULL, *passout = NULL, *inrand = NULL, *macalg = NULL;
+    char *passin = NULL, *passout = NULL, *macalg = NULL;
     char *cpass = NULL, *mpass = NULL, *badpass = NULL;
     const char *CApath = NULL, *CAfile = NULL, *prog;
     int noCApath = 0, noCAfile = 0;
@@ -225,8 +225,9 @@ int pkcs12_main(int argc, char **argv)
             if (!set_pbe(&amp;key_pbe, opt_arg()))
                 goto opthelp;
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_INKEY:
             keyname = opt_arg();
@@ -314,13 +315,6 @@ int pkcs12_main(int argc, char **argv)
         mpass = macpass;
     }
 
-    if (export_cert || inrand != NULL) {
-        app_RAND_load_file(NULL, (inrand != NULL));
-        if (inrand != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(inrand));
-    }
-
     if (twopass) {
         /* To avoid bit rot */
         if (1) {
@@ -576,8 +570,6 @@ int pkcs12_main(int argc, char **argv)
     ret = 0;
  end:
     PKCS12_free(p12);
-    if (export_cert || inrand)
-        app_RAND_write_file(NULL);
     release_engine(e);
     BIO_free(in);
     BIO_free_all(out);
diff --git a/apps/pkcs8.c b/apps/pkcs8.c
index ad41f7b..ea0e856 100644
--- a/apps/pkcs8.c
+++ b/apps/pkcs8.c
@@ -24,7 +24,8 @@ typedef enum OPTION_choice {
     OPT_SCRYPT, OPT_SCRYPT_N, OPT_SCRYPT_R, OPT_SCRYPT_P,
 #endif
     OPT_V2, OPT_V1, OPT_V2PRF, OPT_ITER, OPT_PASSIN, OPT_PASSOUT,
-    OPT_TRADITIONAL
+    OPT_TRADITIONAL,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS pkcs8_options[] = {
@@ -36,6 +37,7 @@ const OPTIONS pkcs8_options[] = {
     {&quot;topk8&quot;, OPT_TOPK8, '-', &quot;Output PKCS8 file&quot;},
     {&quot;noiter&quot;, OPT_NOITER, '-', &quot;Use 1 as iteration count&quot;},
     {&quot;nocrypt&quot;, OPT_NOCRYPT, '-', &quot;Use or expect unencrypted private key&quot;},
+    OPT_R_OPTIONS,
     {&quot;v2&quot;, OPT_V2, 's', &quot;Use PKCS#5 v2.0 and cipher&quot;},
     {&quot;v1&quot;, OPT_V1, 's', &quot;Use PKCS#5 v1.5 and cipher&quot;},
     {&quot;v2prf&quot;, OPT_V2PRF, 's', &quot;Set the PRF algorithm to use with PKCS#5 v2.0&quot;},
@@ -112,6 +114,10 @@ int pkcs8_main(int argc, char **argv)
         case OPT_NOCRYPT:
             nocrypt = 1;
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         case OPT_TRADITIONAL:
             traditional = 1;
             break;
@@ -248,7 +254,6 @@ int pkcs8_main(int argc, char **argv)
                 BIO_printf(bio_err, &quot;Password required\n&quot;);
                 goto end;
             }
-            app_RAND_load_file(NULL, 0);
             p8 = PKCS8_set0_pbe(p8pass, strlen(p8pass), p8inf, pbe);
             if (p8 == NULL) {
                 X509_ALGOR_free(pbe);
@@ -256,7 +261,6 @@ int pkcs8_main(int argc, char **argv)
                 ERR_print_errors(bio_err);
                 goto end;
             }
-            app_RAND_write_file(NULL);
             assert(private);
             if (outformat == FORMAT_PEM)
                 PEM_write_bio_PKCS8(out, p8);
diff --git a/apps/pkeyutl.c b/apps/pkeyutl.c
index 90e9ae3..990375b 100644
--- a/apps/pkeyutl.c
+++ b/apps/pkeyutl.c
@@ -36,7 +36,8 @@ typedef enum OPTION_choice {
     OPT_PUBIN, OPT_CERTIN, OPT_ASN1PARSE, OPT_HEXDUMP, OPT_SIGN,
     OPT_VERIFY, OPT_VERIFYRECOVER, OPT_REV, OPT_ENCRYPT, OPT_DECRYPT,
     OPT_DERIVE, OPT_SIGFILE, OPT_INKEY, OPT_PEERKEY, OPT_PASSIN,
-    OPT_PEERFORM, OPT_KEYFORM, OPT_PKEYOPT, OPT_KDF, OPT_KDFLEN
+    OPT_PEERFORM, OPT_KEYFORM, OPT_PKEYOPT, OPT_KDF, OPT_KDFLEN,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS pkeyutl_options[] = {
@@ -64,6 +65,7 @@ const OPTIONS pkeyutl_options[] = {
     {&quot;peerform&quot;, OPT_PEERFORM, 'E', &quot;Peer key format - default PEM&quot;},
     {&quot;keyform&quot;, OPT_KEYFORM, 'E', &quot;Private key format - default PEM&quot;},
     {&quot;pkeyopt&quot;, OPT_PKEYOPT, 's', &quot;Public key options as opt:value&quot;},
+    OPT_R_OPTIONS,
 #ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
     {&quot;engine_impl&quot;, OPT_ENGINE_IMPL, '-',
@@ -134,6 +136,10 @@ int pkeyutl_main(int argc, char **argv)
             if (!opt_format(opt_arg(), OPT_FMT_PDE, &amp;keyform))
                 goto opthelp;
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
             break;
@@ -238,9 +244,6 @@ int pkeyutl_main(int argc, char **argv)
         goto end;
     }
 
-/* FIXME: seed PRNG only if needed */
-    app_RAND_load_file(NULL, 0);
-
     if (pkey_op != EVP_PKEY_OP_DERIVE) {
         in = bio_open_default(infile, 'r', FORMAT_BINARY);
         if (in == NULL)
diff --git a/apps/rand.c b/apps/rand.c
index 33dbf57..3455006 100644
--- a/apps/rand.c
+++ b/apps/rand.c
@@ -19,7 +19,8 @@
 
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
-    OPT_OUT, OPT_ENGINE, OPT_RAND, OPT_BASE64, OPT_HEX
+    OPT_OUT, OPT_ENGINE, OPT_BASE64, OPT_HEX,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS rand_options[] = {
@@ -27,8 +28,7 @@ const OPTIONS rand_options[] = {
     {OPT_HELP_STR, 1, '-', &quot;Valid options are:\n&quot;},
     {&quot;help&quot;, OPT_HELP, '-', &quot;Display this summary&quot;},
     {&quot;out&quot;, OPT_OUT, '&gt;', &quot;Output file&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;base64&quot;, OPT_BASE64, '-', &quot;Base64 encode output&quot;},
     {&quot;hex&quot;, OPT_HEX, '-', &quot;Hex encode output&quot;},
 #ifndef OPENSSL_NO_ENGINE
@@ -41,7 +41,7 @@ int rand_main(int argc, char **argv)
 {
     ENGINE *e = NULL;
     BIO *out = NULL;
-    char *inrand = NULL, *outfile = NULL, *prog;
+    char *outfile = NULL, *prog;
     OPTION_CHOICE o;
     int format = FORMAT_BINARY, i, num = -1, r, ret = 1;
 
@@ -63,8 +63,9 @@ int rand_main(int argc, char **argv)
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_BASE64:
             format = FORMAT_BASE64;
@@ -80,11 +81,6 @@ int rand_main(int argc, char **argv)
     if (argc != 1 || !opt_int(argv[0], &amp;num) || num &lt; 0)
         goto opthelp;
 
-    app_RAND_load_file(NULL, (inrand != NULL));
-    if (inrand != NULL)
-        BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                   app_RAND_load_files(inrand));
-
     out = bio_open_default(outfile, 'w', format);
     if (out == NULL)
         goto end;
@@ -118,7 +114,7 @@ int rand_main(int argc, char **argv)
     }
     if (format == FORMAT_TEXT)
         BIO_puts(out, &quot;\n&quot;);
-    if (BIO_flush(out) &lt;= 0 || !app_RAND_write_file(NULL))
+    if (BIO_flush(out) &lt;= 0)
         goto end;
 
     ret = 0;
diff --git a/apps/req.c b/apps/req.c
index d72a172..f43dae5 100644
--- a/apps/req.c
+++ b/apps/req.c
@@ -76,12 +76,13 @@ typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_INFORM, OPT_OUTFORM, OPT_ENGINE, OPT_KEYGEN_ENGINE, OPT_KEY,
     OPT_PUBKEY, OPT_NEW, OPT_CONFIG, OPT_KEYFORM, OPT_IN, OPT_OUT,
-    OPT_KEYOUT, OPT_PASSIN, OPT_PASSOUT, OPT_RAND, OPT_NEWKEY,
+    OPT_KEYOUT, OPT_PASSIN, OPT_PASSOUT, OPT_NEWKEY,
     OPT_PKEYOPT, OPT_SIGOPT, OPT_BATCH, OPT_NEWHDR, OPT_MODULUS,
     OPT_VERIFY, OPT_NODES, OPT_NOOUT, OPT_VERBOSE, OPT_UTF8,
     OPT_NAMEOPT, OPT_REQOPT, OPT_SUBJ, OPT_SUBJECT, OPT_TEXT, OPT_X509,
     OPT_MULTIVALUE_RDN, OPT_DAYS, OPT_SET_SERIAL, OPT_EXTENSIONS,
-    OPT_REQEXTS, OPT_PRECERT, OPT_MD
+    OPT_REQEXTS, OPT_PRECERT, OPT_MD,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS req_options[] = {
@@ -98,8 +99,7 @@ const OPTIONS req_options[] = {
     {&quot;keyout&quot;, OPT_KEYOUT, '&gt;', &quot;File to send the key to&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Private key password source&quot;},
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;newkey&quot;, OPT_NEWKEY, 's', &quot;Specify as type:bits&quot;},
     {&quot;pkeyopt&quot;, OPT_PKEYOPT, 's', &quot;Public key options as opt:value&quot;},
     {&quot;sigopt&quot;, OPT_SIGOPT, 's', &quot;Signature parameter in n:v form&quot;},
@@ -151,7 +151,7 @@ int req_main(int argc, char **argv)
     const EVP_CIPHER *cipher = NULL;
     const EVP_MD *md_alg = NULL, *digest = NULL;
     char *extensions = NULL, *infile = NULL;
-    char *outfile = NULL, *keyfile = NULL, *inrand = NULL;
+    char *outfile = NULL, *keyfile = NULL;
     char *keyalgstr = NULL, *p, *prog, *passargin = NULL, *passargout = NULL;
     char *passin = NULL, *passout = NULL;
     char *nofree_passin = NULL, *nofree_passout = NULL;
@@ -234,8 +234,9 @@ int req_main(int argc, char **argv)
         case OPT_PASSOUT:
             passargout = opt_arg();
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_NEWKEY:
             keyalg = opt_arg();
@@ -454,20 +455,12 @@ int req_main(int argc, char **argv)
             /* load_key() has already printed an appropriate message */
             goto end;
         } else {
-            char *randfile = NCONF_get_string(req_conf, SECTION, &quot;RANDFILE&quot;);
-            if (randfile == NULL)
-                ERR_clear_error();
-            app_RAND_load_file(randfile, 0);
+            app_RAND_load_conf(req_conf, SECTION);
         }
     }
 
     if (newreq &amp;&amp; (pkey == NULL)) {
-        char *randfile = NCONF_get_string(req_conf, SECTION, &quot;RANDFILE&quot;);
-        if (randfile == NULL)
-            ERR_clear_error();
-        app_RAND_load_file(randfile, 0);
-        if (inrand != NULL)
-            app_RAND_load_files(inrand);
+        app_RAND_load_conf(req_conf, SECTION);
 
         if (!NCONF_get_number(req_conf, SECTION, BITS, &amp;newkey)) {
             newkey = DEFAULT_KEY_LENGTH;
@@ -525,8 +518,6 @@ int req_main(int argc, char **argv)
         EVP_PKEY_CTX_free(genctx);
         genctx = NULL;
 
-        app_RAND_write_file(randfile);
-
         if (keyout == NULL) {
             keyout = NCONF_get_string(req_conf, SECTION, KEYFILE);
             if (keyout == NULL)
diff --git a/apps/rsautl.c b/apps/rsautl.c
index c8a2650..ca9cb79 100644
--- a/apps/rsautl.c
+++ b/apps/rsautl.c
@@ -32,7 +32,8 @@ typedef enum OPTION_choice {
     OPT_ENGINE, OPT_IN, OPT_OUT, OPT_ASN1PARSE, OPT_HEXDUMP,
     OPT_RAW, OPT_OAEP, OPT_SSL, OPT_PKCS, OPT_X931,
     OPT_SIGN, OPT_VERIFY, OPT_REV, OPT_ENCRYPT, OPT_DECRYPT,
-    OPT_PUBIN, OPT_CERTIN, OPT_INKEY, OPT_PASSIN, OPT_KEYFORM
+    OPT_PUBIN, OPT_CERTIN, OPT_INKEY, OPT_PASSIN, OPT_KEYFORM,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS rsautl_options[] = {
@@ -57,6 +58,7 @@ const OPTIONS rsautl_options[] = {
     {&quot;encrypt&quot;, OPT_ENCRYPT, '-', &quot;Encrypt with public key&quot;},
     {&quot;decrypt&quot;, OPT_DECRYPT, '-', &quot;Decrypt with private key&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
+    OPT_R_OPTIONS,
 # ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 # endif
@@ -153,6 +155,10 @@ int rsautl_main(int argc, char **argv)
         case OPT_PASSIN:
             passinarg = opt_arg();
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         }
     }
     argc = opt_num_rest();
@@ -169,9 +175,6 @@ int rsautl_main(int argc, char **argv)
         goto end;
     }
 
-/* FIXME: seed PRNG only if needed */
-    app_RAND_load_file(NULL, 0);
-
     switch (key_type) {
     case KEY_PRIVKEY:
         pkey = load_key(keyfile, keyformat, 0, passin, e, &quot;Private Key&quot;);
diff --git a/apps/s_client.c b/apps/s_client.c
index 114071c..45464a4 100644
--- a/apps/s_client.c
+++ b/apps/s_client.c
@@ -572,7 +572,7 @@ typedef enum OPTION_choice {
     OPT_CERT, OPT_CRL, OPT_CRL_DOWNLOAD, OPT_SESS_OUT, OPT_SESS_IN,
     OPT_CERTFORM, OPT_CRLFORM, OPT_VERIFY_RET_ERROR, OPT_VERIFY_QUIET,
     OPT_BRIEF, OPT_PREXIT, OPT_CRLF, OPT_QUIET, OPT_NBIO,
-    OPT_SSL_CLIENT_ENGINE, OPT_RAND, OPT_IGN_EOF, OPT_NO_IGN_EOF,
+    OPT_SSL_CLIENT_ENGINE, OPT_IGN_EOF, OPT_NO_IGN_EOF,
     OPT_DEBUG, OPT_TLSEXTDEBUG, OPT_STATUS, OPT_WDEBUG,
     OPT_MSG, OPT_MSGFILE, OPT_ENGINE, OPT_TRACE, OPT_SECURITY_DEBUG,
     OPT_SECURITY_DEBUG_VERBOSE, OPT_SHOWCERTS, OPT_NBIO_TEST, OPT_STATE,
@@ -598,7 +598,8 @@ typedef enum OPTION_choice {
 #ifndef OPENSSL_NO_CT
     OPT_CT, OPT_NOCT, OPT_CTLOG_FILE,
 #endif
-    OPT_DANE_TLSA_RRDATA, OPT_DANE_EE_NO_NAME
+    OPT_DANE_TLSA_RRDATA, OPT_DANE_EE_NO_NAME,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS s_client_options[] = {
@@ -654,8 +655,7 @@ const OPTIONS s_client_options[] = {
      &quot;Use the appropriate STARTTLS command before starting TLS&quot;},
     {&quot;xmpphost&quot;, OPT_XMPPHOST, 's',
      &quot;Host to use with \&quot;-starttls xmpp[-server]\&quot;&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;sess_out&quot;, OPT_SESS_OUT, '&gt;', &quot;File to write SSL session to&quot;},
     {&quot;sess_in&quot;, OPT_SESS_IN, '&lt;', &quot;File to read SSL session from&quot;},
     {&quot;use_srtp&quot;, OPT_USE_SRTP, 's',
@@ -881,7 +881,6 @@ int s_client_main(int argc, char **argv)
     char *cert_file = NULL, *key_file = NULL, *chain_file = NULL;
     char *chCApath = NULL, *chCAfile = NULL, *host = NULL;
     char *port = OPENSSL_strdup(PORT);
-    char *inrand = NULL;
     char *passarg = NULL, *pass = NULL, *vfyCApath = NULL, *vfyCAfile = NULL;
     char *ReqCAfile = NULL;
     char *sess_in = NULL, *crl_file = NULL, *p;
@@ -905,7 +904,6 @@ int s_client_main(int argc, char **argv)
 #endif
     int read_buf_len = 0;
     int fallback_scsv = 0;
-    long randamt = 0;
     OPTION_CHOICE o;
 #ifndef OPENSSL_NO_DTLS
     int enable_timeouts = 0;
@@ -1152,8 +1150,9 @@ int s_client_main(int argc, char **argv)
             }
 #endif
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_IGN_EOF:
             c_ign_eof = 1;
@@ -1604,16 +1603,6 @@ int s_client_main(int argc, char **argv)
     if (!load_excert(&amp;exc))
         goto end;
 
-    if (!app_RAND_load_file(NULL, 1) &amp;&amp; inrand == NULL
-        &amp;&amp; !RAND_status()) {
-        BIO_printf(bio_err,
-                   &quot;warning, not much extra random data, consider using the -rand option\n&quot;);
-    }
-    if (inrand != NULL) {
-        randamt = app_RAND_load_files(inrand);
-        BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;, randamt);
-    }
-
     if (bio_c_out == NULL) {
         if (c_quiet &amp;&amp; !c_debug) {
             bio_c_out = BIO_new(BIO_s_null());
diff --git a/apps/s_server.c b/apps/s_server.c
index 8df767c..961c738 100644
--- a/apps/s_server.c
+++ b/apps/s_server.c
@@ -745,10 +745,11 @@ typedef enum OPTION_choice {
     OPT_MAX_SEND_FRAG, OPT_SPLIT_SEND_FRAG, OPT_MAX_PIPELINES, OPT_READ_BUF,
     OPT_SSL3, OPT_TLS1_3, OPT_TLS1_2, OPT_TLS1_1, OPT_TLS1, OPT_DTLS, OPT_DTLS1,
     OPT_DTLS1_2, OPT_SCTP, OPT_TIMEOUT, OPT_MTU, OPT_LISTEN,
-    OPT_ID_PREFIX, OPT_RAND, OPT_SERVERNAME, OPT_SERVERNAME_FATAL,
+    OPT_ID_PREFIX, OPT_SERVERNAME, OPT_SERVERNAME_FATAL,
     OPT_CERT2, OPT_KEY2, OPT_NEXTPROTONEG, OPT_ALPN,
     OPT_SRTP_PROFILES, OPT_KEYMATEXPORT, OPT_KEYMATEXPORTLEN,
     OPT_KEYLOG_FILE, OPT_MAX_EARLY, OPT_EARLY_DATA,
+    OPT_R_ENUM,
     OPT_S_ENUM,
     OPT_V_ENUM,
     OPT_X_ENUM
@@ -825,8 +826,7 @@ const OPTIONS s_server_options[] = {
     {&quot;HTTP&quot;, OPT_HTTP, '-', &quot;Like -WWW but ./path includes HTTP headers&quot;},
     {&quot;id_prefix&quot;, OPT_ID_PREFIX, 's',
      &quot;Generate SSL/TLS session IDs prefixed by arg&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;keymatexport&quot;, OPT_KEYMATEXPORT, 's',
      &quot;Export keying material using label&quot;},
     {&quot;keymatexportlen&quot;, OPT_KEYMATEXPORTLEN, 'p',
@@ -974,7 +974,7 @@ int s_server_main(int argc, char *argv[])
     X509 *s_cert = NULL, *s_dcert = NULL;
     X509_VERIFY_PARAM *vpm = NULL;
     const char *CApath = NULL, *CAfile = NULL, *chCApath = NULL, *chCAfile = NULL;
-    char *dpassarg = NULL, *dpass = NULL, *inrand = NULL;
+    char *dpassarg = NULL, *dpass = NULL;
     char *passarg = NULL, *pass = NULL, *vfyCApath = NULL, *vfyCAfile = NULL;
     char *crl_file = NULL, *prog;
 #ifdef AF_UNIX
@@ -1494,8 +1494,9 @@ int s_server_main(int argc, char *argv[])
         case OPT_ENGINE:
             engine = setup_engine(opt_arg(), 1);
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_SERVERNAME:
             tlsextcbp.servername = opt_arg();
@@ -1708,15 +1709,6 @@ int s_server_main(int argc, char *argv[])
 
     }
 
-    if (!app_RAND_load_file(NULL, 1) &amp;&amp; inrand == NULL
-        &amp;&amp; !RAND_status()) {
-        BIO_printf(bio_err,
-                   &quot;warning, not much extra random data, consider using the -rand option\n&quot;);
-    }
-    if (inrand != NULL)
-        BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                   app_RAND_load_files(inrand));
-
     if (bio_s_out == NULL) {
         if (s_quiet &amp;&amp; !s_debug) {
             bio_s_out = BIO_new(BIO_s_null());
diff --git a/apps/smime.c b/apps/smime.c
index babe4ef..8617ba4 100644
--- a/apps/smime.c
+++ b/apps/smime.c
@@ -37,9 +37,10 @@ typedef enum OPTION_choice {
     OPT_PK7OUT, OPT_TEXT, OPT_NOINTERN, OPT_NOVERIFY, OPT_NOCHAIN,
     OPT_NOCERTS, OPT_NOATTR, OPT_NODETACH, OPT_NOSMIMECAP,
     OPT_BINARY, OPT_NOSIGS, OPT_STREAM, OPT_INDEF, OPT_NOINDEF,
-    OPT_CRLFEOL, OPT_RAND, OPT_ENGINE, OPT_PASSIN,
+    OPT_CRLFEOL, OPT_ENGINE, OPT_PASSIN,
     OPT_TO, OPT_FROM, OPT_SUBJECT, OPT_SIGNER, OPT_RECIP, OPT_MD,
     OPT_CIPHER, OPT_INKEY, OPT_KEYFORM, OPT_CERTFILE, OPT_CAFILE,
+    OPT_R_ENUM,
     OPT_V_ENUM,
     OPT_CAPATH, OPT_NOCAFILE, OPT_NOCAPATH, OPT_IN, OPT_INFORM, OPT_OUT,
     OPT_OUTFORM, OPT_CONTENT
@@ -96,8 +97,7 @@ const OPTIONS smime_options[] = {
     {&quot;indef&quot;, OPT_INDEF, '-', &quot;Same as -stream&quot; },
     {&quot;noindef&quot;, OPT_NOINDEF, '-', &quot;Disable CMS streaming&quot;},
     {&quot;crlfeol&quot;, OPT_CRLFEOL, '-', &quot;Use CRLF as EOL termination instead of CR only&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;md&quot;, OPT_MD, 's', &quot;Digest algorithm to use when signing or resigning&quot;},
     {&quot;&quot;, OPT_CIPHER, '-', &quot;Any supported cipher&quot;},
@@ -121,15 +121,12 @@ int smime_main(int argc, char **argv)
     const EVP_CIPHER *cipher = NULL;
     const EVP_MD *sign_md = NULL;
     const char *CAfile = NULL, *CApath = NULL, *prog = NULL;
-    char *certfile = NULL, *keyfile = NULL, *contfile = NULL, *inrand = NULL;
-    char *infile = NULL, *outfile = NULL, *signerfile = NULL, *recipfile =
-        NULL;
-    char *passinarg = NULL, *passin = NULL, *to = NULL, *from =
-        NULL, *subject = NULL;
+    char *certfile = NULL, *keyfile = NULL, *contfile = NULL;
+    char *infile = NULL, *outfile = NULL, *signerfile = NULL, *recipfile = NULL;
+    char *passinarg = NULL, *passin = NULL, *to = NULL, *from = NULL, *subject = NULL;
     OPTION_CHOICE o;
     int noCApath = 0, noCAfile = 0;
-    int flags = PKCS7_DETACHED, operation = 0, ret = 0, need_rand = 0, indef =
-        0;
+    int flags = PKCS7_DETACHED, operation = 0, ret = 0, indef = 0;
     int informat = FORMAT_SMIME, outformat = FORMAT_SMIME, keyform =
         FORMAT_PEM;
     int vpmtouched = 0, rv = 0;
@@ -224,9 +221,9 @@ int smime_main(int argc, char **argv)
             flags |= PKCS7_CRLFEOL;
             mime_eol = &quot;\r\n&quot;;
             break;
-        case OPT_RAND:
-            inrand = opt_arg();
-            need_rand = 1;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
@@ -351,7 +348,6 @@ int smime_main(int argc, char **argv)
         }
         signerfile = NULL;
         keyfile = NULL;
-        need_rand = 1;
     } else if (operation == SMIME_DECRYPT) {
         if (recipfile == NULL &amp;&amp; keyfile == NULL) {
             BIO_printf(bio_err,
@@ -363,7 +359,6 @@ int smime_main(int argc, char **argv)
             BIO_printf(bio_err, &quot;No recipient(s) certificate(s) specified\n&quot;);
             goto opthelp;
         }
-        need_rand = 1;
     } else if (!operation) {
         goto opthelp;
     }
@@ -373,13 +368,6 @@ int smime_main(int argc, char **argv)
         goto end;
     }
 
-    if (need_rand) {
-        app_RAND_load_file(NULL, (inrand != NULL));
-        if (inrand != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(inrand));
-    }
-
     ret = 2;
 
     if (!(operation &amp; SMIME_SIGNERS))
@@ -603,8 +591,6 @@ int smime_main(int argc, char **argv)
     }
     ret = 0;
  end:
-    if (need_rand)
-        app_RAND_write_file(NULL);
     if (ret)
         ERR_print_errors(bio_err);
     sk_X509_pop_free(encerts, X509_free);
diff --git a/apps/speed.c b/apps/speed.c
index bd32786..a086060 100644
--- a/apps/speed.c
+++ b/apps/speed.c
@@ -342,7 +342,7 @@ static int found(const char *name, const OPT_PAIR *pairs, int *result)
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_ELAPSED, OPT_EVP, OPT_DECRYPT, OPT_ENGINE, OPT_MULTI,
-    OPT_MR, OPT_MB, OPT_MISALIGN, OPT_ASYNCJOBS
+    OPT_MR, OPT_MB, OPT_MISALIGN, OPT_ASYNCJOBS, OPT_R_ENUM,
 } OPTION_CHOICE;
 
 const OPTIONS speed_options[] = {
@@ -365,6 +365,7 @@ const OPTIONS speed_options[] = {
     {&quot;async_jobs&quot;, OPT_ASYNCJOBS, 'p',
      &quot;Enable async mode and start pnum jobs&quot;},
 #endif
+    OPT_R_OPTIONS,
 #ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 #endif
@@ -1410,6 +1411,10 @@ int speed_main(int argc, char **argv)
             goto end;
 #endif
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         }
     }
     argc = opt_num_rest();
diff --git a/apps/srp.c b/apps/srp.c
index c31830e..f67c7ff 100644
--- a/apps/srp.c
+++ b/apps/srp.c
@@ -26,7 +26,6 @@ NON_EMPTY_TRANSLATION_UNIT
 # define BASE_SECTION    &quot;srp&quot;
 # define CONFIG_FILE &quot;openssl.cnf&quot;
 
-# define ENV_RANDFILE            &quot;RANDFILE&quot;
 
 # define ENV_DATABASE            &quot;srpvfile&quot;
 # define ENV_DEFAULT_SRP         &quot;default_srp&quot;
@@ -189,7 +188,7 @@ typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_VERBOSE, OPT_CONFIG, OPT_NAME, OPT_SRPVFILE, OPT_ADD,
     OPT_DELETE, OPT_MODIFY, OPT_LIST, OPT_GN, OPT_USERINFO,
-    OPT_PASSIN, OPT_PASSOUT, OPT_ENGINE
+    OPT_PASSIN, OPT_PASSOUT, OPT_ENGINE, OPT_R_ENUM,
 } OPTION_CHOICE;
 
 const OPTIONS srp_options[] = {
@@ -207,6 +206,7 @@ const OPTIONS srp_options[] = {
     {&quot;userinfo&quot;, OPT_USERINFO, 's', &quot;Additional info to be set for user&quot;},
     {&quot;passin&quot;, OPT_PASSIN, 's', &quot;Input file pass phrase source&quot;},
     {&quot;passout&quot;, OPT_PASSOUT, 's', &quot;Output file pass phrase source&quot;},
+    OPT_R_OPTIONS,
 # ifndef OPENSSL_NO_ENGINE
     {&quot;engine&quot;, OPT_ENGINE, 's', &quot;Use engine, possibly a hardware device&quot;},
 # endif
@@ -222,7 +222,7 @@ int srp_main(int argc, char **argv)
     int doupdatedb = 0, mode = OPT_ERR;
     char *user = NULL, *passinarg = NULL, *passoutarg = NULL;
     char *passin = NULL, *passout = NULL, *gN = NULL, *userinfo = NULL;
-    char *randfile = NULL, *section = NULL;
+    char *section = NULL;
     char **gNrow = NULL, *configfile = NULL;
     char *srpvfile = NULL, **pp, *prog;
     OPTION_CHOICE o;
@@ -278,6 +278,10 @@ int srp_main(int argc, char **argv)
         case OPT_ENGINE:
             e = setup_engine(opt_arg(), 0);
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         }
     }
     argc = opt_num_rest();
@@ -335,8 +339,7 @@ int srp_main(int argc, char **argv)
                 goto end;
         }
 
-        if (randfile == NULL)
-            randfile = NCONF_get_string(conf, BASE_SECTION, &quot;RANDFILE&quot;);
+        app_RAND_load_conf(conf, BASE_SECTION);
 
         if (verbose)
             BIO_printf(bio_err,
@@ -347,10 +350,6 @@ int srp_main(int argc, char **argv)
         if (srpvfile == NULL)
             goto end;
     }
-    if (randfile == NULL)
-        ERR_clear_error();
-    else
-        app_RAND_load_file(randfile, 0);
 
     if (verbose)
         BIO_printf(bio_err, &quot;Trying to read SRP verifier file \&quot;%s\&quot;\n&quot;,
@@ -604,8 +603,6 @@ int srp_main(int argc, char **argv)
     OPENSSL_free(passout);
     if (ret)
         ERR_print_errors(bio_err);
-    if (randfile != NULL)
-        app_RAND_write_file(randfile);
     NCONF_free(conf);
     free_index(db);
     release_engine(e);
diff --git a/apps/ts.c b/apps/ts.c
index 636c777..5e7729e 100644
--- a/apps/ts.c
+++ b/apps/ts.c
@@ -79,11 +79,11 @@ static int verify_cb(int ok, X509_STORE_CTX *ctx);
 typedef enum OPTION_choice {
     OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
     OPT_ENGINE, OPT_CONFIG, OPT_SECTION, OPT_QUERY, OPT_DATA,
-    OPT_DIGEST, OPT_RAND, OPT_TSPOLICY, OPT_NO_NONCE, OPT_CERT,
+    OPT_DIGEST, OPT_TSPOLICY, OPT_NO_NONCE, OPT_CERT,
     OPT_IN, OPT_TOKEN_IN, OPT_OUT, OPT_TOKEN_OUT, OPT_TEXT,
     OPT_REPLY, OPT_QUERYFILE, OPT_PASSIN, OPT_INKEY, OPT_SIGNER,
     OPT_CHAIN, OPT_VERIFY, OPT_CAPATH, OPT_CAFILE, OPT_UNTRUSTED,
-    OPT_MD, OPT_V_ENUM
+    OPT_MD, OPT_V_ENUM, OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS ts_options[] = {
@@ -93,8 +93,7 @@ const OPTIONS ts_options[] = {
     {&quot;query&quot;, OPT_QUERY, '-', &quot;Generate a TS query&quot;},
     {&quot;data&quot;, OPT_DATA, '&lt;', &quot;File to hash&quot;},
     {&quot;digest&quot;, OPT_DIGEST, 's', &quot;Digest (as a hex string)&quot;},
-    {&quot;rand&quot;, OPT_RAND, 's',
-     &quot;Load the file(s) into the random number generator&quot;},
+    OPT_R_OPTIONS,
     {&quot;tspolicy&quot;, OPT_TSPOLICY, 's', &quot;Policy OID to use&quot;},
     {&quot;no_nonce&quot;, OPT_NO_NONCE, '-', &quot;Do not include a nonce&quot;},
     {&quot;cert&quot;, OPT_CERT, '-', &quot;Put cert request into query&quot;},
@@ -158,7 +157,7 @@ int ts_main(int argc, char **argv)
     const char *section = NULL;
     char **helpp;
     char *password = NULL;
-    char *data = NULL, *digest = NULL, *rnd = NULL, *policy = NULL;
+    char *data = NULL, *digest = NULL, *policy = NULL;
     char *in = NULL, *out = NULL, *queryfile = NULL, *passin = NULL;
     char *inkey = NULL, *signer = NULL, *chain = NULL, *CApath = NULL;
     const EVP_MD *md = NULL;
@@ -207,8 +206,9 @@ int ts_main(int argc, char **argv)
         case OPT_DIGEST:
             digest = opt_arg();
             break;
-        case OPT_RAND:
-            rnd = opt_arg();
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
             break;
         case OPT_TSPOLICY:
             policy = opt_arg();
@@ -275,16 +275,6 @@ int ts_main(int argc, char **argv)
     if (mode == OPT_ERR || opt_num_rest() != 0)
         goto opthelp;
 
-    /* Seed the random number generator if it is going to be used. */
-    if (mode == OPT_QUERY &amp;&amp; !no_nonce) {
-        if (!app_RAND_load_file(NULL, 1) &amp;&amp; rnd == NULL)
-            BIO_printf(bio_err, &quot;warning, not much extra random &quot;
-                       &quot;data, consider using the -rand option\n&quot;);
-        if (rnd != NULL)
-            BIO_printf(bio_err, &quot;%ld semi-random bytes loaded\n&quot;,
-                       app_RAND_load_files(rnd));
-    }
-
     if (mode == OPT_REPLY &amp;&amp; passin &amp;&amp;
         !app_passwd(passin, NULL, &amp;password, NULL)) {
         BIO_printf(bio_err, &quot;Error getting password.\n&quot;);
@@ -328,7 +318,6 @@ int ts_main(int argc, char **argv)
 
  end:
     X509_VERIFY_PARAM_free(vpm);
-    app_RAND_write_file(NULL);
     NCONF_free(conf);
     OPENSSL_free(password);
     return (ret);
diff --git a/apps/x509.c b/apps/x509.c
index 6a24da2..7928ccb 100644
--- a/apps/x509.c
+++ b/apps/x509.c
@@ -58,7 +58,8 @@ typedef enum OPTION_choice {
     OPT_CLRREJECT, OPT_ALIAS, OPT_CACREATESERIAL, OPT_CLREXT, OPT_OCSPID,
     OPT_SUBJECT_HASH_OLD,
     OPT_ISSUER_HASH_OLD,
-    OPT_BADSIG, OPT_MD, OPT_ENGINE, OPT_NOCERT, OPT_PRESERVE_DATES
+    OPT_BADSIG, OPT_MD, OPT_ENGINE, OPT_NOCERT, OPT_PRESERVE_DATES,
+    OPT_R_ENUM
 } OPTION_CHOICE;
 
 const OPTIONS x509_options[] = {
@@ -118,6 +119,7 @@ const OPTIONS x509_options[] = {
     {&quot;text&quot;, OPT_TEXT, '-', &quot;Print the certificate in text form&quot;},
     {&quot;C&quot;, OPT_C, '-', &quot;Print out C code forms&quot;},
     {&quot;extfile&quot;, OPT_EXTFILE, '&lt;', &quot;File with X509V3 extensions to add&quot;},
+    OPT_R_OPTIONS,
     {&quot;extensions&quot;, OPT_EXTENSIONS, 's', &quot;Section from config file to use&quot;},
     {&quot;nameopt&quot;, OPT_NAMEOPT, 's', &quot;Various certificate name options&quot;},
     {&quot;certopt&quot;, OPT_CERTOPT, 's', &quot;Various certificate text options&quot;},
@@ -166,7 +168,7 @@ int x509_main(int argc, char **argv)
     char *prog;
     int x509req = 0, days = DEF_DAYS, modulus = 0, pubkey = 0, pprint = 0;
     int C = 0, CAformat = FORMAT_PEM, CAkeyformat = FORMAT_PEM;
-    int fingerprint = 0, reqfile = 0, need_rand = 0, checkend = 0;
+    int fingerprint = 0, reqfile = 0, checkend = 0;
     int informat = FORMAT_PEM, outformat = FORMAT_PEM, keyformat = FORMAT_PEM;
     int next_serial = 0, subject_hash = 0, issuer_hash = 0, ocspid = 0;
     int noout = 0, sign_flag = 0, CA_flag = 0, CA_createserial = 0, email = 0;
@@ -227,7 +229,7 @@ int x509_main(int argc, char **argv)
             outfile = opt_arg();
             break;
         case OPT_REQ:
-            reqfile = need_rand = 1;
+            reqfile = 1;
             break;
 
         case OPT_SIGOPT:
@@ -247,18 +249,20 @@ int x509_main(int argc, char **argv)
         case OPT_EXTFILE:
             extfile = opt_arg();
             break;
+        case OPT_R_CASES:
+            if (!opt_rand(o))
+                goto end;
+            break;
         case OPT_EXTENSIONS:
             extsect = opt_arg();
             break;
         case OPT_SIGNKEY:
             keyfile = opt_arg();
             sign_flag = ++num;
-            need_rand = 1;
             break;
         case OPT_CA:
             CAfile = opt_arg();
             CA_flag = ++num;
-            need_rand = 1;
             break;
         case OPT_CAKEY:
             CAkeyfile = opt_arg();
@@ -460,9 +464,6 @@ int x509_main(int argc, char **argv)
     if (out == NULL)
         goto end;
 
-    if (need_rand)
-        app_RAND_load_file(NULL, 0);
-
     if (!app_passwd(passinarg, NULL, &amp;passin, NULL)) {
         BIO_printf(bio_err, &quot;Error getting password\n&quot;);
         goto end;
@@ -793,7 +794,6 @@ int x509_main(int argc, char **argv)
                         goto end;
                 }
 
-                assert(need_rand);
                 if (!sign(x, Upkey, days, clrext, digest, extconf, extsect, preserve_dates))
                     goto end;
             } else if (CA_flag == i) {
@@ -805,7 +805,6 @@ int x509_main(int argc, char **argv)
                         goto end;
                 }
 
-                assert(need_rand);
                 if (!x509_certify(ctx, CAfile, digest, x, xca,
                                   CApkey, sigopts,
                                   CAserial, CA_createserial, days, clrext,
@@ -882,8 +881,6 @@ int x509_main(int argc, char **argv)
     }
     ret = 0;
  end:
-    if (need_rand)
-        app_RAND_write_file(NULL);
     NCONF_free(extconf);
     BIO_free_all(out);
     X509_STORE_free(ctx);
diff --git a/crypto/rand/randfile.c b/crypto/rand/randfile.c
index 4005f78..904653f 100644
--- a/crypto/rand/randfile.c
+++ b/crypto/rand/randfile.c
@@ -175,8 +175,11 @@ int RAND_write_file(const char *file)
 
     if (out == NULL)
         out = openssl_fopen(file, &quot;wb&quot;);
-    if (out == NULL)
+    if (out == NULL) {
+        RANDerr(RAND_F_RAND_LOAD_FILE, RAND_R_CANNOT_OPEN_FILE);
+        ERR_add_error_data(2, &quot;Filename=&quot;, file);
         return -1;
+    }
 
 #if !defined(NO_CHMOD) &amp;&amp; !defined(OPENSSL_NO_POSIX_IO)
     /*
diff --git a/doc/man1/ca.pod b/doc/man1/ca.pod
index 26d648e..4a59708 100644
--- a/doc/man1/ca.pod
+++ b/doc/man1/ca.pod
@@ -52,6 +52,8 @@ B&lt;openssl&gt; B&lt;ca&gt;
 [B&lt;-utf8&gt;]
 [B&lt;-create_serial&gt;]
 [B&lt;-multivalue-rdn&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 
 =head1 DESCRIPTION
 
@@ -266,6 +268,19 @@ I&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
 
 If -multi-rdn is not used then the UID value is I&lt;123456+CN=John Doe&gt;.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =back
 
 =head1 CRL OPTIONS
@@ -397,8 +412,8 @@ CA private key. Mandatory.
 
 =item B&lt;RANDFILE&gt;
 
-A file used to read and write random number seed information, or
-an EGD socket (see L&lt;RAND_egd(3)&gt;).
+At startup the specified file is loaded into the random number generator,
+and at exit 256 bytes will be written to it.
 
 =item B&lt;default_days&gt;
 
diff --git a/doc/man1/cms.pod b/doc/man1/cms.pod
index c63ac45..33549d4 100644
--- a/doc/man1/cms.pod
+++ b/doc/man1/cms.pod
@@ -92,7 +92,8 @@ B&lt;openssl&gt; B&lt;cms&gt;
 [B&lt;-inkey file&gt;]
 [B&lt;-keyopt name:parameter&gt;]
 [B&lt;-passin arg&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;cert.pem...&gt;]
 [B&lt;-to addr&gt;]
 [B&lt;-from addr&gt;]
@@ -461,14 +462,19 @@ or to modify default parameters for ECDH.
 The private key password source. For more information about the format of B&lt;arg&gt;
 see the B&lt;PASS PHRASE ARGUMENTS&gt; section in L&lt;openssl(1)&gt;.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;cert.pem...&gt;
 
 One or more certificates of message recipients: used when encrypting
diff --git a/doc/man1/dgst.pod b/doc/man1/dgst.pod
index 677f2b2..0cbcf85 100644
--- a/doc/man1/dgst.pod
+++ b/doc/man1/dgst.pod
@@ -23,6 +23,7 @@ B&lt;openssl&gt; B&lt;dgst&gt;
 [B&lt;-signature filename&gt;]
 [B&lt;-hmac key&gt;]
 [B&lt;-fips-fingerprint&gt;]
+[B&lt;-rand file...&gt;]
 [B&lt;-engine id&gt;]
 [B&lt;-engine_impl&gt;]
 [B&lt;file...&gt;]
@@ -149,14 +150,19 @@ for example exactly 32 chars for gost-mac.
 
 =back
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-fips-fingerprint&gt;
 
 Compute HMAC using a specific key for certain OpenSSL-FIPS operations.
diff --git a/doc/man1/dhparam.pod b/doc/man1/dhparam.pod
index a6317a9..852469d 100644
--- a/doc/man1/dhparam.pod
+++ b/doc/man1/dhparam.pod
@@ -19,7 +19,8 @@ B&lt;openssl dhparam&gt;
 [B&lt;-C&gt;]
 [B&lt;-2&gt;]
 [B&lt;-5&gt;]
-[B&lt;-rand&gt; I&lt;file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-engine id&gt;]
 [I&lt;numbits&gt;]
 
@@ -82,14 +83,19 @@ input file is ignored and parameters are generated instead. If not
 present but B&lt;numbits&gt; is present, parameters are generated with the
 default generator 2.
 
-=item B&lt;-rand&gt; I&lt;file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item I&lt;numbits&gt;
 
 This option specifies that a parameter set should be generated of size
diff --git a/doc/man1/dsaparam.pod b/doc/man1/dsaparam.pod
index 0a34c29..4c07463 100644
--- a/doc/man1/dsaparam.pod
+++ b/doc/man1/dsaparam.pod
@@ -15,7 +15,8 @@ B&lt;openssl dsaparam&gt;
 [B&lt;-noout&gt;]
 [B&lt;-text&gt;]
 [B&lt;-C&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-genkey&gt;]
 [B&lt;-engine id&gt;]
 [B&lt;numbits&gt;]
@@ -74,14 +75,19 @@ be loaded by calling the get_dsaXXX() function.
 This option will generate a DSA either using the specified or generated
 parameters.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;numbits&gt;
 
 This option specifies that a parameter set should be generated of size
diff --git a/doc/man1/ecparam.pod b/doc/man1/ecparam.pod
index 7e0d074..3f76dc0 100644
--- a/doc/man1/ecparam.pod
+++ b/doc/man1/ecparam.pod
@@ -21,7 +21,8 @@ B&lt;openssl ecparam&gt;
 [B&lt;-conv_form arg&gt;]
 [B&lt;-param_enc arg&gt;]
 [B&lt;-no_seed&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-genkey&gt;]
 [B&lt;-engine id&gt;]
 
@@ -116,14 +117,19 @@ is included in the ECParameters structure (see RFC 3279).
 
 This option will generate an EC private key using the specified parameters.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-engine id&gt;
 
 Specifying an engine (by its unique B&lt;id&gt; string) will cause B&lt;ecparam&gt;
diff --git a/doc/man1/enc.pod b/doc/man1/enc.pod
index 13f1272..ad76be0 100644
--- a/doc/man1/enc.pod
+++ b/doc/man1/enc.pod
@@ -31,6 +31,8 @@ B&lt;openssl enc -ciphername&gt;
 [B&lt;-nopad&gt;]
 [B&lt;-debug&gt;]
 [B&lt;-none&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-engine id&gt;]
 
 =head1 DESCRIPTION
@@ -165,6 +167,19 @@ or zlib-dynamic option.
 
 Use NULL cipher (no encryption or decryption of input).
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =back
 
 =head1 NOTES
diff --git a/doc/man1/gendsa.pod b/doc/man1/gendsa.pod
index 1068ffd..9cb84df 100644
--- a/doc/man1/gendsa.pod
+++ b/doc/man1/gendsa.pod
@@ -21,7 +21,8 @@ B&lt;openssl&gt; B&lt;gendsa&gt;
 [B&lt;-des&gt;]
 [B&lt;-des3&gt;]
 [B&lt;-idea&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-engine id&gt;]
 [B&lt;paramfile&gt;]
 
@@ -49,14 +50,19 @@ These options encrypt the private key with specified
 cipher before outputting it. A pass phrase is prompted for.
 If none of these options is specified no encryption is used.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-engine id&gt;
 
 Specifying an engine (by its unique B&lt;id&gt; string) will cause B&lt;gendsa&gt;
diff --git a/doc/man1/genrsa.pod b/doc/man1/genrsa.pod
index 4e44fe5..57b4cf8 100644
--- a/doc/man1/genrsa.pod
+++ b/doc/man1/genrsa.pod
@@ -24,7 +24,8 @@ B&lt;openssl&gt; B&lt;genrsa&gt;
 [B&lt;-idea&gt;]
 [B&lt;-f4&gt;]
 [B&lt;-3&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-engine id&gt;]
 [B&lt;numbits&gt;]
 
@@ -61,14 +62,19 @@ for if it is not supplied via the B&lt;-passout&gt; argument.
 
 The public exponent to use, either 65537 or 3. The default is 65537.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-engine id&gt;
 
 Specifying an engine (by its unique B&lt;id&gt; string) will cause B&lt;genrsa&gt;
diff --git a/doc/man1/passwd.pod b/doc/man1/passwd.pod
index 02f6339..3c16946 100644
--- a/doc/man1/passwd.pod
+++ b/doc/man1/passwd.pod
@@ -20,6 +20,8 @@ B&lt;openssl passwd&gt;
 [B&lt;-noverify&gt;]
 [B&lt;-quiet&gt;]
 [B&lt;-table&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 {I&lt;password&gt;}
 
 =head1 DESCRIPTION
@@ -88,6 +90,19 @@ Don't output warnings when passwords given at the command line are truncated.
 In the output list, prepend the cleartext password and a TAB character
 to each password hash.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =back
 
 =head1 EXAMPLES
diff --git a/doc/man1/pkcs12.pod b/doc/man1/pkcs12.pod
index a40ae7f..2eb6b07 100644
--- a/doc/man1/pkcs12.pod
+++ b/doc/man1/pkcs12.pod
@@ -36,7 +36,8 @@ B&lt;openssl&gt; B&lt;pkcs12&gt;
 [B&lt;-password arg&gt;]
 [B&lt;-passin arg&gt;]
 [B&lt;-passout arg&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-CAfile file&gt;]
 [B&lt;-CApath dir&gt;]
 [B&lt;-no-CAfile&gt;]
@@ -275,14 +276,19 @@ to be needed to use MAC iterations counts but they are now used by default.
 
 Don't attempt to provide the MAC integrity.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-CAfile file&gt;
 
 CA storage as a file.
diff --git a/doc/man1/pkcs8.pod b/doc/man1/pkcs8.pod
index ebdcea9..42e2468 100644
--- a/doc/man1/pkcs8.pod
+++ b/doc/man1/pkcs8.pod
@@ -17,6 +17,8 @@ B&lt;openssl&gt; B&lt;pkcs8&gt;
 [B&lt;-passout arg&gt;]
 [B&lt;-iter count&gt;]
 [B&lt;-noiter&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-nocrypt&gt;]
 [B&lt;-traditional&gt;]
 [B&lt;-v2 alg&gt;]
@@ -99,6 +101,19 @@ This option does not encrypt private keys at all and should only be used
 when absolutely necessary. Certain software such as some versions of Java
 code signing software used unencrypted private keys.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-v2 alg&gt;
 
 This option sets the PKCS#5 v2.0 algorithm.
diff --git a/doc/man1/pkeyutl.pod b/doc/man1/pkeyutl.pod
index ee8a588..5e16bc6 100644
--- a/doc/man1/pkeyutl.pod
+++ b/doc/man1/pkeyutl.pod
@@ -30,6 +30,8 @@ B&lt;openssl&gt; B&lt;pkeyutl&gt;
 [B&lt;-pkeyopt opt:value&gt;]
 [B&lt;-hexdump&gt;]
 [B&lt;-asn1parse&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-engine id&gt;]
 [B&lt;-engine_impl&gt;]
 
@@ -146,6 +148,19 @@ hex dump the output data.
 Parse the ASN.1 output data, this is useful when combined with the
 B&lt;-verifyrecover&gt; option when an ASN1 structure is signed.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-engine id&gt;
 
 Specifying an engine (by its unique B&lt;id&gt; string) will cause B&lt;pkeyutl&gt;
diff --git a/doc/man1/rand.pod b/doc/man1/rand.pod
index 0faf687..2248203 100644
--- a/doc/man1/rand.pod
+++ b/doc/man1/rand.pod
@@ -9,7 +9,8 @@ rand - generate pseudo-random bytes
 B&lt;openssl rand&gt;
 [B&lt;-help&gt;]
 [B&lt;-out&gt; I&lt;file&gt;]
-[B&lt;-rand&gt; I&lt;file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-base64&gt;]
 [B&lt;-hex&gt;]
 I&lt;num&gt;
@@ -31,18 +32,23 @@ seeding was obtained from these sources.
 
 Print out a usage message.
 
-=item B&lt;-out&gt; I&lt;file&gt;
+=item B&lt;-out file&gt;
 
 Write to I&lt;file&gt; instead of standard output.
 
-=item B&lt;-rand&gt; I&lt;file(s)&gt;
+=item B&lt;-rand file...&gt;
 
-Use specified file or files or EGD socket (see L&lt;RAND_egd(3)&gt;)
-for seeding the random number generator.
+A file or files containing random data used to seed the random number
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-base64&gt;
 
 Perform base64 encoding on the output.
diff --git a/doc/man1/req.pod b/doc/man1/req.pod
index 4dbd489..e15434a 100644
--- a/doc/man1/req.pod
+++ b/doc/man1/req.pod
@@ -20,7 +20,8 @@ B&lt;openssl&gt; B&lt;req&gt;
 [B&lt;-verify&gt;]
 [B&lt;-modulus&gt;]
 [B&lt;-new&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-newkey rsa:bits&gt;]
 [B&lt;-newkey alg:file&gt;]
 [B&lt;-nodes&gt;]
@@ -130,14 +131,19 @@ in the configuration file and any requested extensions.
 If the B&lt;-key&gt; option is not used it will generate a new RSA private
 key using information specified in the configuration file.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-newkey arg&gt;
 
 This option creates a new certificate request and a new private
@@ -365,8 +371,8 @@ and long names are the same when this option is used.
 
 =item B&lt;RANDFILE&gt;
 
-This specifies a filename in which random number seed information is
-placed and read from, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+At startup the specified file is loaded into the random number generator,
+and at exit 256 bytes will be written to it.
 It is used for private key generation.
 
 =item B&lt;encrypt_key&gt;
diff --git a/doc/man1/rsautl.pod b/doc/man1/rsautl.pod
index 8883c7b..f80bf42 100644
--- a/doc/man1/rsautl.pod
+++ b/doc/man1/rsautl.pod
@@ -18,6 +18,8 @@ B&lt;openssl&gt; B&lt;rsautl&gt;
 [B&lt;-verify&gt;]
 [B&lt;-encrypt&gt;]
 [B&lt;-decrypt&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-pkcs&gt;]
 [B&lt;-ssl&gt;]
 [B&lt;-raw&gt;]
@@ -80,6 +82,19 @@ Encrypt the input data using an RSA public key.
 
 Decrypt the input data using an RSA private key.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-pkcs, -oaep, -ssl, -raw&gt;
 
 The padding to use: PKCS#1 v1.5 (the default), PKCS#1 OAEP,
diff --git a/doc/man1/s_client.pod b/doc/man1/s_client.pod
index c262d4a..7f2fd7b 100644
--- a/doc/man1/s_client.pod
+++ b/doc/man1/s_client.pod
@@ -105,7 +105,8 @@ B&lt;openssl&gt; B&lt;s_client&gt;
 [B&lt;-no_ticket&gt;]
 [B&lt;-sess_out filename&gt;]
 [B&lt;-sess_in filename&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-serverinfo types&gt;]
 [B&lt;-status&gt;]
 [B&lt;-alpn protocols&gt;]
@@ -536,14 +537,19 @@ to attempt to obtain a functional reference to the specified engine,
 thus initialising it if needed. The engine will then be set as the default
 for all available algorithms.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-serverinfo types&gt;
 
 A list of comma-separated TLS Extension Types (numbers between 0 and
diff --git a/doc/man1/s_server.pod b/doc/man1/s_server.pod
index b1195fd..9865789 100644
--- a/doc/man1/s_server.pod
+++ b/doc/man1/s_server.pod
@@ -52,7 +52,8 @@ B&lt;openssl&gt; B&lt;s_server&gt;
 [B&lt;-tlsextdebug&gt;]
 [B&lt;-HTTP&gt;]
 [B&lt;-id_prefix val&gt;]
-[B&lt;-rand val&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-keymatexport val&gt;]
 [B&lt;-keymatexportlen +int&gt;]
 [B&lt;-CRL infile&gt;]
@@ -381,14 +382,19 @@ for testing any SSL/TLS code (eg. proxies) that wish to deal with multiple
 servers, when each of which might be generating a unique range of session
 IDs (eg. with a certain prefix).
 
-=item B&lt;-rand val&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-verify_return_error&gt;
 
 Verification errors normally just print a message but allow the
diff --git a/doc/man1/smime.pod b/doc/man1/smime.pod
index 7df780f..5b13fda 100644
--- a/doc/man1/smime.pod
+++ b/doc/man1/smime.pod
@@ -65,7 +65,8 @@ B&lt;openssl&gt; B&lt;smime&gt;
 [B&lt;-indef&gt;]
 [B&lt;-noindef&gt;]
 [B&lt;-stream&gt;]
-[B&lt;-rand file(s)&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-md digest&gt;]
 [cert.pem]...
 
@@ -295,14 +296,19 @@ specified, the argument is given to the engine as a key identifier.
 The private key password source. For more information about the format of B&lt;arg&gt;
 see the B&lt;PASS PHRASE ARGUMENTS&gt; section in L&lt;openssl(1)&gt;.
 
-=item B&lt;-rand file(s)&gt;
+=item B&lt;-rand file...&gt;
 
 A file or files containing random data used to seed the random number
-generator, or an EGD socket (see L&lt;RAND_egd(3)&gt;).
+generator.
 Multiple files can be specified separated by an OS-dependent character.
 The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
 all others.
 
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;cert.pem...&gt;
 
 One or more certificates of message recipients: used when encrypting
diff --git a/doc/man1/speed.pod b/doc/man1/speed.pod
index b0d4daa..0e5bb57 100644
--- a/doc/man1/speed.pod
+++ b/doc/man1/speed.pod
@@ -12,6 +12,8 @@ B&lt;openssl speed&gt;
 [B&lt;-elapsed&gt;]
 [B&lt;-evp algo&gt;]
 [B&lt;-decrypt&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;algorithm...&gt;]
 
 =head1 DESCRIPTION
@@ -48,6 +50,19 @@ Use the specified cipher or message digest algorithm via the EVP interface.
 
 Time the decryption instead of encryption. Affects only the EVP testing.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;[zero or more test algorithms]&gt;
 
 If any options are given, B&lt;speed&gt; tests those algorithms, otherwise all of
diff --git a/doc/man1/ts.pod b/doc/man1/ts.pod
index c04a623..56ace24 100644
--- a/doc/man1/ts.pod
+++ b/doc/man1/ts.pod
@@ -8,7 +8,8 @@ ts - Time Stamping Authority tool (client/server)
 
 B&lt;openssl&gt; B&lt;ts&gt;
 B&lt;-query&gt;
-[B&lt;-rand&gt; file:file...]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-config&gt; configfile]
 [B&lt;-data&gt; file_to_hash]
 [B&lt;-digest&gt; digest_bytes]
@@ -131,11 +132,18 @@ request with the following options:
 
 =over 4
 
-=item B&lt;-rand&gt; file:file...
+=item B&lt;-rand file...&gt;
 
-The files containing random data for seeding the random number
-generator. Multiple files can be specified, the separator is B&lt;;&gt; for
-MS-Windows, B&lt;,&gt; for VMS and B&lt;:&gt; for all other platforms. (Optional)
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
 
 =item B&lt;-config&gt; configfile
 
diff --git a/doc/man1/x509.pod b/doc/man1/x509.pod
index 587c630..68fbf81 100644
--- a/doc/man1/x509.pod
+++ b/doc/man1/x509.pod
@@ -59,6 +59,8 @@ B&lt;openssl&gt; B&lt;x509&gt;
 [B&lt;-clrext&gt;]
 [B&lt;-extfile filename&gt;]
 [B&lt;-extensions section&gt;]
+[B&lt;-rand file...&gt;]
+[B&lt;-writerand file&gt;]
 [B&lt;-engine id&gt;]
 [B&lt;-preserve_dates&gt;]
 
@@ -115,6 +117,19 @@ Any digest supported by the OpenSSL B&lt;dgst&gt; command can be used.
 If not specified then SHA1 is used with B&lt;-fingerprint&gt; or
 the default digest for the signing algorithm is used, typically SHA256.
 
+=item B&lt;-rand file...&gt;
+
+A file or files containing random data used to seed the random number
+generator.
+Multiple files can be specified separated by an OS-dependent character.
+The separator is B&lt;;&gt; for MS-Windows, B&lt;,&gt; for OpenVMS, and B&lt;:&gt; for
+all others.
+
+=item [B&lt;-writerand file&gt;]
+
+Writes random data to the specified I&lt;file&gt; upon exit.
+This can be used with a subsequent B&lt;-rand&gt; flag.
+
 =item B&lt;-engine id&gt;
 
 Specifying an engine (by its unique B&lt;id&gt; string) will cause B&lt;x509&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015451.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="015454.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15452">[ date ]</a>
              <a href="thread.html#15452">[ thread ]</a>
              <a href="subject.html#15452">[ subject ]</a>
              <a href="author.html#15452">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
