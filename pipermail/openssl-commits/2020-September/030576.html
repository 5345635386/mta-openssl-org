<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1599732524.991303.21937.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030575.html">
   <LINK REL="Next"  HREF="030580.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>dev at ddvo.net</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1599732524.991303.21937.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">dev at ddvo.net
       </A><BR>
    <I>Thu Sep 10 10:08:44 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="030575.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="030580.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30576">[ date ]</a>
              <a href="thread.html#30576">[ thread ]</a>
              <a href="subject.html#30576">[ subject ]</a>
              <a href="author.html#30576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  5a0991d0d94b966e0621b8123873b132877dc9d3 (commit)
       via  5fdcde816f6ee9ef048977c14427e2b0b63f47b6 (commit)
       via  a8e2a9f569c60dbbc180672b0fce16ab7dd6ca72 (commit)
       via  bc64c5a69b95d45c314ec6ac40a865228cf230cd (commit)
       via  2aa91df406a8c907b53d01773b1b860117542c48 (commit)
       via  115786793c2521af9dcf20a6114e9904e0c206aa (commit)
      from  388f2d9f6c3faebc72722ba6bb76df12146ad988 (commit)


- Log -----------------------------------------------------------------
commit 5a0991d0d94b966e0621b8123873b132877dc9d3
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Wed Sep 2 13:52:23 2020 +0200

    Add/harmonize multi-valued RDN support and doc of ca, cmp, req, storeutl, and x509 apps
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12769">https://github.com/openssl/openssl/pull/12769</A>)

commit 5fdcde816f6ee9ef048977c14427e2b0b63f47b6
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Wed Sep 2 13:50:04 2020 +0200

    X509_NAME_cmp(): Clearly document its semantics, referencing relevant RFCs
    
    Fixes #12765
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12769">https://github.com/openssl/openssl/pull/12769</A>)

commit a8e2a9f569c60dbbc180672b0fce16ab7dd6ca72
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Fri Sep 4 18:31:46 2020 +0200

    X509_NAME_add_entry_by_txt.pod: Improve documentation w.r.t. multi-valued RDNs (containing sets of AVAs)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12769">https://github.com/openssl/openssl/pull/12769</A>)

commit bc64c5a69b95d45c314ec6ac40a865228cf230cd
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Wed Sep 2 13:12:22 2020 +0200

    X509_NAME_cmp: restrict normal return values to {-1,0,1} to avoid confusion with -2 for error
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12769">https://github.com/openssl/openssl/pull/12769</A>)

commit 2aa91df406a8c907b53d01773b1b860117542c48
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Wed Sep 2 14:18:34 2020 +0200

    X509_NAME_oneline(): Fix output of multi-valued RDNs, escaping '/' and '+' in values
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12769">https://github.com/openssl/openssl/pull/12769</A>)

commit 115786793c2521af9dcf20a6114e9904e0c206aa
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Wed Sep 2 12:56:49 2020 +0200

    X509_NAME_print_ex.pod: re-format lines to fit within 80 chars limit
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12769">https://github.com/openssl/openssl/pull/12769</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/ca.c                               |  6 +--
 apps/cmp.c                              |  2 +-
 apps/lib/apps.c                         |  7 ++-
 apps/req.c                              |  6 +--
 apps/x509.c                             |  2 +-
 crypto/x509/x509_cmp.c                  | 38 ++++++++---------
 crypto/x509/x509_obj.c                  | 26 +++++++-----
 doc/man1/openssl-ca.pod.in              | 20 +++++----
 doc/man1/openssl-cmp.pod.in             | 23 +++++-----
 doc/man1/openssl-req.pod.in             | 22 +++++-----
 doc/man1/openssl-storeutl.pod.in        | 10 ++++-
 doc/man1/openssl-x509.pod.in            | 12 ++++--
 doc/man3/X509_NAME_add_entry_by_txt.pod | 12 +++---
 doc/man3/X509_NAME_print_ex.pod         | 75 ++++++++++++++++++---------------
 doc/man3/X509_cmp.pod                   | 19 +++++----
 15 files changed, 159 insertions(+), 121 deletions(-)

diff --git a/apps/ca.c b/apps/ca.c
index 8a5104f488..ff40a13d31 100644
--- a/apps/ca.c
+++ b/apps/ca.c
@@ -200,7 +200,7 @@ const OPTIONS ca_options[] = {
     {&quot;rand_serial&quot;, OPT_RAND_SERIAL, '-',
      &quot;Always create a random serial; do not store it&quot;},
     {&quot;multivalue-rdn&quot;, OPT_MULTIVALUE_RDN, '-',
-     &quot;Enable support for multivalued RDNs&quot;},
+     &quot;Deprecated; multi-valued RDNs support is always on.&quot;},
     {&quot;startdate&quot;, OPT_STARTDATE, 's', &quot;Cert notBefore, YYMMDDHHMMSSZ&quot;},
     {&quot;enddate&quot;, OPT_ENDDATE, 's',
      &quot;YYMMDDHHMMSSZ cert notAfter (overrides -days)&quot;},
@@ -288,7 +288,7 @@ int ca_main(int argc, char **argv)
     size_t outdirlen = 0;
     int create_ser = 0, free_passin = 0, total = 0, total_done = 0;
     int batch = 0, default_op = 1, doupdatedb = 0, ext_copy = EXT_COPY_NONE;
-    int keyformat = FORMAT_PEM, multirdn = 0, notext = 0, output_der = 0;
+    int keyformat = FORMAT_PEM, multirdn = 1, notext = 0, output_der = 0;
     int ret = 1, email_dn = 1, req = 0, verbose = 0, gencrl = 0, dorevoke = 0;
     int rand_ser = 0, i, j, selfsign = 0, def_nid, def_ret;
     long crldays = 0, crlhours = 0, crlsec = 0, days = 0;
@@ -344,7 +344,7 @@ opthelp:
             create_ser = 1;
             break;
         case OPT_MULTIVALUE_RDN:
-            multirdn = 1;
+            /* obsolete */
             break;
         case OPT_STARTDATE:
             startdate = opt_arg();
diff --git a/apps/cmp.c b/apps/cmp.c
index 1c3b592f7f..ce2513bd0d 100644
--- a/apps/cmp.c
+++ b/apps/cmp.c
@@ -893,7 +893,7 @@ static int set_name(const char *str,
                     OSSL_CMP_CTX *ctx, const char *desc)
 {
     if (str != NULL) {
-        X509_NAME *n = parse_name(str, MBSTRING_ASC, 0, desc);
+        X509_NAME *n = parse_name(str, MBSTRING_ASC, 1, desc);
 
         if (n == NULL)
             return 0;
diff --git a/apps/lib/apps.c b/apps/lib/apps.c
index 878ec18f0b..d3f3f6d2b6 100644
--- a/apps/lib/apps.c
+++ b/apps/lib/apps.c
@@ -1647,7 +1647,8 @@ int parse_yesno(const char *str, int def)
 
 /*
  * name is expected to be in the format /type0=value0/type1=value1/type2=...
- * where characters may be escaped by \
+ * where + can be used instead of / to form multi-valued RDNs if canmulti
+ * and characters may be escaped by \
  */
 X509_NAME *parse_name(const char *cp, int chtype, int canmulti,
                       const char *desc)
@@ -1700,6 +1701,7 @@ X509_NAME *parse_name(const char *cp, int chtype, int canmulti,
         /* Collect the value. */
         valstr = (unsigned char *)bp;
         for (; *cp != '\0' &amp;&amp; *cp != '/'; *bp++ = *cp++) {
+            /* unescaped '+' symbol string signals further member of multiRDN */
             if (canmulti &amp;&amp; *cp == '+') {
                 nextismulti = 1;
                 break;
@@ -1723,6 +1725,9 @@ X509_NAME *parse_name(const char *cp, int chtype, int canmulti,
             BIO_printf(bio_err,
                        &quot;%s: Skipping unknown %s name attribute \&quot;%s\&quot;\n&quot;,
                        opt_getprog(), desc, typestr);
+            if (ismulti)
+                BIO_printf(bio_err,
+                           &quot;Hint: a '+' in a value string needs be escaped using '\\' else a new member of a multi-valued RDN is expected\n&quot;);
             continue;
         }
         if (*valstr == '\0') {
diff --git a/apps/req.c b/apps/req.c
index 46739554bd..2cc9ebf43d 100644
--- a/apps/req.c
+++ b/apps/req.c
@@ -127,7 +127,7 @@ const OPTIONS req_options[] = {
     {&quot;subj&quot;, OPT_SUBJ, 's', &quot;Set or modify request subject&quot;},
     {&quot;subject&quot;, OPT_SUBJECT, '-', &quot;Output the request's subject&quot;},
     {&quot;multivalue-rdn&quot;, OPT_MULTIVALUE_RDN, '-',
-     &quot;Enable support for multivalued RDNs&quot;},
+     &quot;Deprecated; multi-valued RDNs support is always on.&quot;},
     {&quot;days&quot;, OPT_DAYS, 'p', &quot;Number of days cert is valid for&quot;},
     {&quot;set_serial&quot;, OPT_SET_SERIAL, 's', &quot;Serial number to use&quot;},
     {&quot;addext&quot;, OPT_ADDEXT, 's',
@@ -257,7 +257,7 @@ int req_main(int argc, char **argv)
     int ret = 1, x509 = 0, days = 0, i = 0, newreq = 0, verbose = 0;
     int pkey_type = -1, private = 0;
     int informat = FORMAT_PEM, outformat = FORMAT_PEM, keyform = FORMAT_PEM;
-    int modulus = 0, multirdn = 0, verify = 0, noout = 0, text = 0;
+    int modulus = 0, multirdn = 1, verify = 0, noout = 0, text = 0;
     int noenc = 0, newhdr = 0, subject = 0, pubkey = 0, precert = 0;
     long newkey = -1;
     unsigned long chtype = MBSTRING_ASC, reqflag = 0;
@@ -421,7 +421,7 @@ int req_main(int argc, char **argv)
             subj = opt_arg();
             break;
         case OPT_MULTIVALUE_RDN:
-            multirdn = 1;
+            /* obsolete */
             break;
         case OPT_ADDEXT:
             p = opt_arg();
diff --git a/apps/x509.c b/apps/x509.c
index 64a1cadc97..169530f6d6 100644
--- a/apps/x509.c
+++ b/apps/x509.c
@@ -179,7 +179,7 @@ int x509_main(int argc, char **argv)
     char *subj = NULL;
     X509_NAME *fsubj = NULL;
     const unsigned long chtype = MBSTRING_ASC;
-    const int multirdn = 0;
+    const int multirdn = 1;
     STACK_OF(ASN1_OBJECT) *trust = NULL, *reject = NULL;
     STACK_OF(OPENSSL_STRING) *sigopts = NULL, *vfyopts = NULL;
     X509 *x = NULL, *xca = NULL;
diff --git a/crypto/x509/x509_cmp.c b/crypto/x509/x509_cmp.c
index 0e770de11d..32e15682b1 100644
--- a/crypto/x509/x509_cmp.c
+++ b/crypto/x509/x509_cmp.c
@@ -30,8 +30,8 @@ int X509_issuer_and_serial_cmp(const X509 *a, const X509 *b)
     ai = &amp;a-&gt;cert_info;
     bi = &amp;b-&gt;cert_info;
     i = ASN1_INTEGER_cmp(&amp;ai-&gt;serialNumber, &amp;bi-&gt;serialNumber);
-    if (i)
-        return i;
+    if (i != 0)
+        return i &lt; 0 ? -1 : 1;
     return X509_NAME_cmp(ai-&gt;issuer, bi-&gt;issuer);
 }
 
@@ -83,7 +83,9 @@ int X509_CRL_cmp(const X509_CRL *a, const X509_CRL *b)
 
 int X509_CRL_match(const X509_CRL *a, const X509_CRL *b)
 {
-    return memcmp(a-&gt;sha1_hash, b-&gt;sha1_hash, 20);
+    int rv = memcmp(a-&gt;sha1_hash, b-&gt;sha1_hash, 20);
+
+    return rv &lt; 0 ? -1 : rv &gt; 0;
 }
 
 X509_NAME *X509_get_issuer_name(const X509 *a)
@@ -149,18 +151,18 @@ int X509_cmp(const X509 *a, const X509 *b)
         return -2;
 
     rv = memcmp(a-&gt;sha1_hash, b-&gt;sha1_hash, SHA_DIGEST_LENGTH);
-    if (rv)
-        return rv;
+    if (rv != 0)
+        return rv &lt; 0 ? -1 : 1;
     /* Check for match against stored encoding too */
     if (!a-&gt;cert_info.enc.modified &amp;&amp; !b-&gt;cert_info.enc.modified) {
         if (a-&gt;cert_info.enc.len &lt; b-&gt;cert_info.enc.len)
             return -1;
         if (a-&gt;cert_info.enc.len &gt; b-&gt;cert_info.enc.len)
             return 1;
-        return memcmp(a-&gt;cert_info.enc.enc, b-&gt;cert_info.enc.enc,
-                      a-&gt;cert_info.enc.len);
+        rv = memcmp(a-&gt;cert_info.enc.enc,
+                    b-&gt;cert_info.enc.enc, a-&gt;cert_info.enc.len);
     }
-    return rv;
+    return rv &lt; 0 ? -1 : rv &gt; 0;
 }
 
 int X509_add_cert_new(STACK_OF(X509) **sk, X509 *cert, int flags)
@@ -208,7 +210,7 @@ int X509_add_certs(STACK_OF(X509) *sk, STACK_OF(X509) *certs, int flags)
 {
     int n = sk_X509_num(certs); /* certs may be NULL */
     int i;
- 
+
     for (i = 0; i &lt; n; i++) {
         int j = (flags &amp; X509_ADD_FLAG_PREPEND) == 0 ? i : n - 1 - i;
         /* if prepend, add certs in reverse order to keep original order */
@@ -242,12 +244,10 @@ int X509_NAME_cmp(const X509_NAME *a, const X509_NAME *b)
     }
 
     ret = a-&gt;canon_enclen - b-&gt;canon_enclen;
+    if (ret == 0 &amp;&amp; a-&gt;canon_enclen != 0)
+        ret = memcmp(a-&gt;canon_enc, b-&gt;canon_enc, a-&gt;canon_enclen);
 
-    if (ret != 0 || a-&gt;canon_enclen == 0)
-        return ret;
-
-    return memcmp(a-&gt;canon_enc, b-&gt;canon_enc, a-&gt;canon_enclen);
-
+    return ret &lt; 0 ? -1 : ret &gt; 0;
 }
 
 unsigned long X509_NAME_hash(const X509_NAME *x)
@@ -410,9 +410,9 @@ static int check_suite_b(EVP_PKEY *pkey, int sign_nid, unsigned long *pflags)
             return X509_V_ERR_SUITE_B_INVALID_SIGNATURE_ALGORITHM;
         if (!(*pflags &amp; X509_V_FLAG_SUITEB_128_LOS_ONLY))
             return X509_V_ERR_SUITE_B_LOS_NOT_ALLOWED;
-    } else
+    } else {
         return X509_V_ERR_SUITE_B_INVALID_CURVE;
-
+    }
     return X509_V_OK;
 }
 
@@ -430,9 +430,9 @@ int X509_chain_check_suiteb(int *perror_depth, X509 *x, STACK_OF(X509) *chain,
     if (x == NULL) {
         x = sk_X509_value(chain, 0);
         i = 1;
-    } else
+    } else {
         i = 0;
-
+    }
     pk = X509_get0_pubkey(x);
 
     /*
@@ -533,7 +533,7 @@ STACK_OF(X509) *X509_chain_up_ref(STACK_OF(X509) *chain)
     return ret;
  err:
     while (i-- &gt; 0)
-        X509_free (sk_X509_value(ret, i));
+        X509_free(sk_X509_value(ret, i));
     sk_X509_free(ret);
     return NULL;
 }
diff --git a/crypto/x509/x509_obj.c b/crypto/x509/x509_obj.c
index c1e893bf13..7bed79a2d5 100644
--- a/crypto/x509/x509_obj.c
+++ b/crypto/x509/x509_obj.c
@@ -13,6 +13,7 @@
 #include &lt;openssl/x509.h&gt;
 #include &lt;openssl/buffer.h&gt;
 #include &quot;crypto/x509.h&quot;
+#include &quot;crypto/ctype.h&quot;
 
 DEFINE_STACK_OF(X509_NAME_ENTRY)
 
@@ -28,6 +29,7 @@ char *X509_NAME_oneline(const X509_NAME *a, char *buf, int len)
     const X509_NAME_ENTRY *ne;
     int i;
     int n, lold, l, l1, l2, num, j, type;
+    int prev_set = -1;
     const char *s;
     char *p;
     unsigned char *q;
@@ -109,14 +111,11 @@ char *X509_NAME_oneline(const X509_NAME *a, char *buf, int len)
             if (!gs_doit[j &amp; 3])
                 continue;
             l2++;
-#ifndef CHARSET_EBCDIC
-            if ((q[j] &lt; ' ') || (q[j] &gt; '~'))
-                l2 += 3;
-#else
-            if ((os_toascii[q[j]] &lt; os_toascii[' ']) ||
-                (os_toascii[q[j]] &gt; os_toascii['~']))
+            if (q[j] == '/' || q[j] == '+')
+                l2++; /* char needs to be escaped */
+            else if ((ossl_toascii(q[j]) &lt; ossl_toascii(' ')) ||
+                     (ossl_toascii(q[j]) &gt; ossl_toascii('~')))
                 l2 += 3;
-#endif
         }
 
         lold = l;
@@ -133,7 +132,7 @@ char *X509_NAME_oneline(const X509_NAME *a, char *buf, int len)
             break;
         } else
             p = &amp;(buf[lold]);
-        *(p++) = '/';
+        *(p++) = prev_set == ne-&gt;set ? '+' : '/';
         memcpy(p, s, (unsigned int)l1);
         p += l1;
         *(p++) = '=';
@@ -152,8 +151,11 @@ char *X509_NAME_oneline(const X509_NAME *a, char *buf, int len)
                 *(p++) = 'x';
                 *(p++) = hex[(n &gt;&gt; 4) &amp; 0x0f];
                 *(p++) = hex[n &amp; 0x0f];
-            } else
+            } else {
+                if (n == '/' || n == '+')
+                    *(p++) = '\\';
                 *(p++) = n;
+            }
 #else
             n = os_toascii[q[j]];
             if ((n &lt; os_toascii[' ']) || (n &gt; os_toascii['~'])) {
@@ -161,11 +163,15 @@ char *X509_NAME_oneline(const X509_NAME *a, char *buf, int len)
                 *(p++) = 'x';
                 *(p++) = hex[(n &gt;&gt; 4) &amp; 0x0f];
                 *(p++) = hex[n &amp; 0x0f];
-            } else
+            } else {
+                if (n == os_toascii['/'] || n == os_toascii['+'])
+                    *(p++) = '\\';
                 *(p++) = q[j];
+            }
 #endif
         }
         *p = '\0';
+        prev_set = ne-&gt;set;
     }
     if (b != NULL) {
         p = b-&gt;data;
diff --git a/doc/man1/openssl-ca.pod.in b/doc/man1/openssl-ca.pod.in
index 7d7f0752f3..d196565422 100644
--- a/doc/man1/openssl-ca.pod.in
+++ b/doc/man1/openssl-ca.pod.in
@@ -285,11 +285,17 @@ used).
 =item B&lt;-subj&gt; I&lt;arg&gt;
 
 Supersedes subject name given in the request.
+
 The arg must be formatted as C&lt;/type0=value0/type1=value1/type2=...&gt;.
-Keyword characters may be escaped by C&lt;\&gt; (backslash), and whitespace is
-retained.
+Special characters may be escaped by C&lt;\&gt; (backslash), whitespace is retained.
 Empty values are permitted, but the corresponding type will not be included
 in the resulting certificate.
+Giving a single C&lt;/&gt; will lead to an empty sequence of RDNs (a NULL-DN).
+Multi-valued RDNs can be formed by placing a C&lt;+&gt; character instead of a C&lt;/&gt;
+between the AttributeValueAssertions (AVAs) that specify the members of the set.
+Example:
+
+C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
 
 =item B&lt;-utf8&gt;
 
@@ -313,12 +319,7 @@ This overrides any option or configuration to use a serial number file.
 
 =item B&lt;-multivalue-rdn&gt;
 
-This option causes the -subj argument to be interpreted with full
-support for multivalued RDNs. Example:
-
-C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
-
-If B&lt;-multi-rdn&gt; is not used then the UID value is C&lt;123456+CN=John Doe&gt;.
+This option has been deprecated and has no effect.
 
 {- $OpenSSL::safe::opt_r_item -}
 
@@ -791,7 +792,8 @@ retained mainly for compatibility reasons.
 
 The B&lt;-section&gt; option was added in OpenSSL 3.0.0.
 
-The B&lt;-certform&gt; option has become obsolete in OpenSSL 3.0.0 and has no effect.
+The B&lt;-certform&gt; and B&lt;-multivalue-rdn&gt; options
+have become obsolete in OpenSSL 3.0.0 and have no effect.
 
 All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
 and have no effect.
diff --git a/doc/man1/openssl-cmp.pod.in b/doc/man1/openssl-cmp.pod.in
index 9389701893..44f71b8358 100644
--- a/doc/man1/openssl-cmp.pod.in
+++ b/doc/man1/openssl-cmp.pod.in
@@ -268,20 +268,24 @@ For KUR, it defaults to the subject DN of the reference certificate
 (see B&lt;-oldcert&gt;).
 This default is used for IR and CR only if no SANs are set.
 
-The argument must be formatted as I&lt;/type0=value0/type1=value1/type2=...&gt;,
-characters may be escaped by C&lt;\&gt;E&lt;nbsp&gt;(backslash), no spaces are skipped.
-
 The subject DN is also used as fallback sender of outgoing CMP messages
 if no B&lt;-cert&gt; and no B&lt;-oldcert&gt; are given.
 
+The argument must be formatted as I&lt;/type0=value0/type1=value1/type2=...&gt;.
+Special characters may be escaped by C&lt;\&gt; (backslash), whitespace is retained.
+Empty values are permitted, but the corresponding type will not be included.
+Giving a single C&lt;/&gt; will lead to an empty sequence of RDNs (a NULL-DN).
+Multi-valued RDNs can be formed by placing a C&lt;+&gt; character instead of a C&lt;/&gt;
+between the AttributeValueAssertions (AVAs) that specify the members of the set.
+Example:
+
+C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
+
 =item B&lt;-issuer&gt; I&lt;name&gt;
 
 X509 issuer Distinguished Name (DN) of the CA server
 to place in the requested certificate template in IR/CR/KUR.
 
-The argument must be formatted as I&lt;/type0=value0/type1=value1/type2=...&gt;,
-characters may be escaped by C&lt;\&gt;E&lt;nbsp&gt;(backslash), no spaces are skipped.
-
 If neither B&lt;-srvcert&gt; nor B&lt;-recipient&gt; is available,
 the name given in this option is also set as the recipient of the CMP message.
 
@@ -519,10 +523,6 @@ and as default value for the expected sender of incoming CMP messages.
 Distinguished Name (DN) to use in the recipient field of CMP request messages,
 i.e., the CMP server (usually the addressed CA).
 
-The argument must be formatted as I&lt;/type0=value0/type1=value1/type2=...&gt;,
-characters may be escaped by C&lt;\&gt;E&lt;nbsp&gt;(backslash), no spaces are skipped.
-The empty name (NULL-DN) can be given explicitly as a single slash: 'I&lt;/&gt;'.
-
 The recipient field in the header of a CMP message is mandatory.
 If not given explicitly the recipient is determined in the following order:
 the subject of the CMP server certificate given with the B&lt;-srvcert&gt; option,
@@ -536,9 +536,6 @@ as far as any of those is present, else the NULL-DN as last resort.
 Distinguished Name (DN) expected in the sender field of incoming CMP messages.
 Defaults to the subject DN of the pinned B&lt;-srvcert&gt;, if any.
 
-The argument must be formatted as I&lt;/type0=value0/type1=value1/type2=...&gt;,
-characters may be escaped by C&lt;\&gt;E&lt;nbsp&gt;(backslash), no spaces are skipped.
-
 This can be used to make sure that only a particular entity is accepted as
 CMP message signer, and attackers are not able to use arbitrary certificates
 of a trusted PKI hierarchy to fraudulently pose as a CMP server.
diff --git a/doc/man1/openssl-req.pod.in b/doc/man1/openssl-req.pod.in
index 1af355b5b3..52b2326d78 100644
--- a/doc/man1/openssl-req.pod.in
+++ b/doc/man1/openssl-req.pod.in
@@ -32,7 +32,6 @@ B&lt;openssl&gt; B&lt;req&gt;
 [B&lt;-I&lt;digest&gt;&gt;]
 [B&lt;-config&gt; I&lt;filename&gt;]
 [B&lt;-section&gt; I&lt;name&gt;]
-[B&lt;-multivalue-rdn&gt;]
 [B&lt;-x509&gt;]
 [B&lt;-days&gt; I&lt;n&gt;]
 [B&lt;-set_serial&gt; I&lt;n&gt;]
@@ -45,6 +44,7 @@ B&lt;openssl&gt; B&lt;req&gt;
 [B&lt;-reqopt&gt;]
 [B&lt;-subject&gt;]
 [B&lt;-subj&gt; I&lt;arg&gt;]
+[B&lt;-multivalue-rdn&gt;]
 [B&lt;-sigopt&gt; I&lt;nm&gt;:I&lt;v&gt;]
 [B&lt;-vfyopt&gt; I&lt;nm&gt;:I&lt;v&gt;]
 [B&lt;-batch&gt;]
@@ -233,19 +233,21 @@ Specifies the name of the section to use; the default is B&lt;req&gt;.
 
 Sets subject name for new request or supersedes the subject name
 when processing a request.
+
 The arg must be formatted as C&lt;/type0=value0/type1=value1/type2=...&gt;.
-Keyword characters may be escaped by \ (backslash), and whitespace is retained.
+Special characters may be escaped by C&lt;\&gt; (backslash), whitespace is retained.
 Empty values are permitted, but the corresponding type will not be included
 in the request.
-
-=item B&lt;-multivalue-rdn&gt;
-
-This option causes the -subj argument to be interpreted with full
-support for multivalued RDNs. Example:
+Giving a single C&lt;/&gt; will lead to an empty sequence of RDNs (a NULL-DN).
+Multi-valued RDNs can be formed by placing a C&lt;+&gt; character instead of a C&lt;/&gt;
+between the AttributeValueAssertions (AVAs) that specify the members of the set.
+Example:
 
 C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
 
-If -multi-rdn is not used then the UID value is C&lt;123456+CN=John Doe&gt;.
+=item B&lt;-multivalue-rdn&gt;
+
+This option has been deprecated and has no effect.
 
 =item B&lt;-x509&gt;
 
@@ -697,8 +699,8 @@ L&lt;x509v3_config(5)&gt;
 
 The B&lt;-section&gt; option was added in OpenSSL 3.0.0.
 
-All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; have become obsolete in OpenSSL 3.0.0
-and have no effect.
+All B&lt;-keyform&gt; values except B&lt;ENGINE&gt; and the B&lt;-multivalue-rdn&gt; option
+have become obsolete in OpenSSL 3.0.0 and have no effect.
 
 The B&lt;-engine&gt; option was deprecated in OpenSSL 3.0.
 The &lt;-nodes&gt; option was deprecated in OpenSSL 3.0, too; use B&lt;-noenc&gt; instead.
diff --git a/doc/man1/openssl-storeutl.pod.in b/doc/man1/openssl-storeutl.pod.in
index 2c92f825a0..bc2eec17f7 100644
--- a/doc/man1/openssl-storeutl.pod.in
+++ b/doc/man1/openssl-storeutl.pod.in
@@ -80,11 +80,19 @@ returned.
 =item B&lt;-subject&gt; I&lt;arg&gt;
 
 Search for an object having the subject name I&lt;arg&gt;.
+
 The arg must be formatted as C&lt;/type0=value0/type1=value1/type2=...&gt;.
-Keyword characters may be escaped by \ (backslash), and whitespace is retained.
+Special characters may be escaped by C&lt;\&gt; (backslash), whitespace is retained.
 Empty values are permitted but are ignored for the search.  That is,
 a search with an empty value will have the same effect as not specifying
 the type at all.
+Giving a single C&lt;/&gt; will lead to an empty sequence of RDNs (a NULL-DN).
+Multi-valued RDNs can be formed by placing a C&lt;+&gt; character instead of a C&lt;/&gt;
+between the AttributeValueAssertions (AVAs) that specify the members of the set.
+
+Example:
+
+C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
 
 =item B&lt;-issuer&gt; I&lt;arg&gt;
 
diff --git a/doc/man1/openssl-x509.pod.in b/doc/man1/openssl-x509.pod.in
index 8eb35e537e..fb4be2c264 100644
--- a/doc/man1/openssl-x509.pod.in
+++ b/doc/man1/openssl-x509.pod.in
@@ -517,11 +517,17 @@ generate a certificate containing any desired public key.
 =item B&lt;-subj&gt; I&lt;arg&gt;
 
 When a certificate is created set its subject name to the given value.
+
 The arg must be formatted as C&lt;/type0=value0/type1=value1/type2=...&gt;.
-Keyword characters may be escaped by \ (backslash), and whitespace is retained.
+Special characters may be escaped by C&lt;\&gt; (backslash), whitespace is retained.
 Empty values are permitted, but the corresponding type will not be included
-in the certificate. Giving a single C&lt;/&gt; will lead to an empty sequence of RDNs
-(a NULL subject DN).
+in the certificate.
+Giving a single C&lt;/&gt; will lead to an empty sequence of RDNs (a NULL-DN).
+Multi-valued RDNs can be formed by placing a C&lt;+&gt; character instead of a C&lt;/&gt;
+between the AttributeValueAssertions (AVAs) that specify the members of the set.
+Example:
+
+C&lt;/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe&gt;
 
 Unless the B&lt;-CA&gt; option is given the issuer is set to the same value.
 
diff --git a/doc/man3/X509_NAME_add_entry_by_txt.pod b/doc/man3/X509_NAME_add_entry_by_txt.pod
index ce8bf3ef29..8b17a016de 100644
--- a/doc/man3/X509_NAME_add_entry_by_txt.pod
+++ b/doc/man3/X509_NAME_add_entry_by_txt.pod
@@ -66,13 +66,13 @@ RelativeDistinguishedName (RDN).
 B&lt;loc&gt; actually determines the index where the new entry is inserted:
 if it is -1 it is appended.
 
-B&lt;set&gt; determines how the new type is added. If it is zero a
-new RDN is created.
+B&lt;set&gt; determines how the new type is added.
+If it is zero a new RDN is created.
 
-If B&lt;set&gt; is -1 or 1 it is added to the previous or next RDN
-structure respectively. This will then be a multivalued RDN:
-since multivalues RDNs are very seldom used B&lt;set&gt; is almost
-always set to zero.
+If B&lt;set&gt; is -1 or 1 it is added as a new set member
+to the previous or next RDN structure, respectively.
+This will then become part of a multi-valued RDN (containing a set of AVAs).
+Since multi-valued RDNs are very rarely used B&lt;set&gt; typically will be zero.
 
 =head1 RETURN VALUES
 
diff --git a/doc/man3/X509_NAME_print_ex.pod b/doc/man3/X509_NAME_print_ex.pod
index a9532b1853..ccb4b5629a 100644
--- a/doc/man3/X509_NAME_print_ex.pod
+++ b/doc/man3/X509_NAME_print_ex.pod
@@ -9,34 +9,37 @@ X509_NAME_oneline - X509_NAME printing routines
 
  #include &lt;openssl/x509.h&gt;
 
- int X509_NAME_print_ex(BIO *out, const X509_NAME *nm, int indent, unsigned long flags);
- int X509_NAME_print_ex_fp(FILE *fp, const X509_NAME *nm, int indent, unsigned long flags);
+ int X509_NAME_print_ex(BIO *out, const X509_NAME *nm,
+                        int indent, unsigned long flags);
+ int X509_NAME_print_ex_fp(FILE *fp, const X509_NAME *nm,
+                           int indent, unsigned long flags);
  char *X509_NAME_oneline(const X509_NAME *a, char *buf, int size);
  int X509_NAME_print(BIO *bp, const X509_NAME *name, int obase);
 
 =head1 DESCRIPTION
 
-X509_NAME_print_ex() prints a human readable version of B&lt;nm&gt; to BIO B&lt;out&gt;. Each
-line (for multiline formats) is indented by B&lt;indent&gt; spaces. The output format
-can be extensively customised by use of the B&lt;flags&gt; parameter.
+X509_NAME_print_ex() prints a human readable version of I&lt;nm&gt; to BIO I&lt;out&gt;.
+Each line (for multiline formats) is indented by I&lt;indent&gt; spaces. The
+output format can be extensively customised by use of the I&lt;flags&gt; parameter.
 
-X509_NAME_print_ex_fp() is identical to X509_NAME_print_ex() except the output is
-written to FILE pointer B&lt;fp&gt;.
+X509_NAME_print_ex_fp() is identical to X509_NAME_print_ex()
+except the output is written to FILE pointer I&lt;fp&gt;.
 
-X509_NAME_oneline() prints an ASCII version of B&lt;a&gt; to B&lt;buf&gt;.
-If B&lt;buf&gt; is B&lt;NULL&gt; then a buffer is dynamically allocated and returned, and
-B&lt;size&gt; is ignored.
-Otherwise, at most B&lt;size&gt; bytes will be written, including the ending '\0',
-and B&lt;buf&gt; is returned.
+X509_NAME_oneline() prints an ASCII version of I&lt;a&gt; to I&lt;buf&gt;.
+This supports multi-valued RDNs and escapes B&lt;/&gt; and B&lt;+&gt; characters in values.
+If I&lt;buf&gt; is B&lt;NULL&gt; then a buffer is dynamically allocated and returned, and
+I&lt;size&gt; is ignored.
+Otherwise, at most I&lt;size&gt; bytes will be written, including the ending '\0',
+and I&lt;buf&gt; is returned.
 
-X509_NAME_print() prints out B&lt;name&gt; to B&lt;bp&gt; indenting each line by B&lt;obase&gt;
+X509_NAME_print() prints out I&lt;name&gt; to I&lt;bp&gt; indenting each line by I&lt;obase&gt;
 characters. Multiple lines are used if the output (including indent) exceeds
 80 characters.
 
 =head1 NOTES
 
 The functions X509_NAME_oneline() and X509_NAME_print()
-produce a non standard output form, they don't handle multi character fields and
+produce a non standard output form, they don't handle multi-character fields and
 have various quirks and inconsistencies.
 Their use is strongly discouraged in new applications and they could
 be deprecated in a future release.
@@ -52,15 +55,18 @@ The complete set of the flags supported by X509_NAME_print_ex() is listed below.
 Several options can be ored together.
 
 The options B&lt;XN_FLAG_SEP_COMMA_PLUS&gt;, B&lt;XN_FLAG_SEP_CPLUS_SPC&gt;,
-B&lt;XN_FLAG_SEP_SPLUS_SPC&gt; and B&lt;XN_FLAG_SEP_MULTILINE&gt; determine the field separators
-to use. Two distinct separators are used between distinct RelativeDistinguishedName
-components and separate values in the same RDN for a multi-valued RDN. Multi-valued
-RDNs are currently very rare so the second separator will hardly ever be used.
-
-B&lt;XN_FLAG_SEP_COMMA_PLUS&gt; uses comma and plus as separators. B&lt;XN_FLAG_SEP_CPLUS_SPC&gt;
-uses comma and plus with spaces: this is more readable that plain comma and plus.
-B&lt;XN_FLAG_SEP_SPLUS_SPC&gt; uses spaced semicolon and plus. B&lt;XN_FLAG_SEP_MULTILINE&gt; uses
-spaced newline and plus respectively.
+B&lt;XN_FLAG_SEP_SPLUS_SPC&gt; and B&lt;XN_FLAG_SEP_MULTILINE&gt;
+determine the field separators to use.
+Two distinct separators are used between distinct RelativeDistinguishedName
+components and separate values in the same RDN for a multi-valued RDN.
+Multi-valued RDNs are currently very rare
+so the second separator will hardly ever be used.
+
+B&lt;XN_FLAG_SEP_COMMA_PLUS&gt; uses comma and plus as separators.
+B&lt;XN_FLAG_SEP_CPLUS_SPC&gt; uses comma and plus with spaces:
+this is more readable that plain comma and plus.
+B&lt;XN_FLAG_SEP_SPLUS_SPC&gt; uses spaced semicolon and plus.
+B&lt;XN_FLAG_SEP_MULTILINE&gt; uses spaced newline and plus respectively.
 
 If B&lt;XN_FLAG_DN_REV&gt; is set the whole DN is printed in reversed order.
 
@@ -84,18 +90,21 @@ control how each field value is displayed.
 
 In addition a number options can be set for commonly used formats.
 
-B&lt;XN_FLAG_RFC2253&gt; sets options which produce an output compatible with RFC2253 it
-is equivalent to:
- C&lt;ASN1_STRFLGS_RFC2253 | XN_FLAG_SEP_COMMA_PLUS | XN_FLAG_DN_REV | XN_FLAG_FN_SN | XN_FLAG_DUMP_UNKNOWN_FIELDS&gt;
-
+B&lt;XN_FLAG_RFC2253&gt; sets options which produce an output compatible with RFC2253.
+It is equivalent to:
+ C&lt;ASN1_STRFLGS_RFC2253 | XN_FLAG_SEP_COMMA_PLUS | XN_FLAG_DN_REV
+   | XN_FLAG_FN_SN | XN_FLAG_DUMP_UNKNOWN_FIELDS&gt;
 
 B&lt;XN_FLAG_ONELINE&gt; is a more readable one line format which is the same as:
- C&lt;ASN1_STRFLGS_RFC2253 | ASN1_STRFLGS_ESC_QUOTE | XN_FLAG_SEP_CPLUS_SPC | XN_FLAG_SPC_EQ | XN_FLAG_FN_SN&gt;
+ C&lt;ASN1_STRFLGS_RFC2253 | ASN1_STRFLGS_ESC_QUOTE | XN_FLAG_SEP_CPLUS_SPC
+   | XN_FLAG_SPC_EQ | XN_FLAG_FN_SN&gt;
 
 B&lt;XN_FLAG_MULTILINE&gt; is a multiline format which is the same as:
- C&lt;ASN1_STRFLGS_ESC_CTRL | ASN1_STRFLGS_ESC_MSB | XN_FLAG_SEP_MULTILINE | XN_FLAG_SPC_EQ | XN_FLAG_FN_LN | XN_FLAG_FN_ALIGN&gt;
+ C&lt;ASN1_STRFLGS_ESC_CTRL | ASN1_STRFLGS_ESC_MSB | XN_FLAG_SEP_MULTILINE
+   | XN_FLAG_SPC_EQ | XN_FLAG_FN_LN | XN_FLAG_FN_ALIGN&gt;
 
-B&lt;XN_FLAG_COMPAT&gt; uses a format identical to X509_NAME_print(): in fact it calls X509_NAME_print() internally.
+B&lt;XN_FLAG_COMPAT&gt; uses a format identical to X509_NAME_print():
+in fact it calls X509_NAME_print() internally.
 
 =head1 RETURN VALUES
 
@@ -103,9 +112,9 @@ X509_NAME_oneline() returns a valid string on success or NULL on error.
 
 X509_NAME_print() returns 1 on success or 0 on error.
 
-X509_NAME_print_ex() and X509_NAME_print_ex_fp() return 1 on success or 0 on error
-if the B&lt;XN_FLAG_COMPAT&gt; is set, which is the same as X509_NAME_print(). Otherwise,
-it returns -1 on error or other values on success.
+X509_NAME_print_ex() and X509_NAME_print_ex_fp() return 1 on success or 0 on
+error if the B&lt;XN_FLAG_COMPAT&gt; is set, which is the same as X509_NAME_print().
+Otherwise, it returns -1 on error or other values on success.
 
 =head1 SEE ALSO
 
diff --git a/doc/man3/X509_cmp.pod b/doc/man3/X509_cmp.pod
index 3cb16b2a81..7460d901db 100644
--- a/doc/man3/X509_cmp.pod
+++ b/doc/man3/X509_cmp.pod
@@ -25,16 +25,20 @@ This set of functions are used to compare X509 objects, including X509
 certificates, X509 CRL objects and various values in an X509 certificate.
 
 The X509_cmp() function compares two B&lt;X509&gt; objects indicated by parameters
-B&lt;a&gt; and B&lt;b&gt;. The comparison is based on the B&lt;memcmp&gt; result of the hash
+I&lt;a&gt; and I&lt;b&gt;. The comparison is based on the B&lt;memcmp&gt; result of the hash
 values of two B&lt;X509&gt; objects and the canonical (DER) encoding values.
 
 The X509_NAME_cmp() function compares two B&lt;X509_NAME&gt; objects indicated by
-parameters B&lt;a&gt; and B&lt;b&gt;. The comparison is based on the B&lt;memcmp&gt; result of
-the canonical (DER) encoding values of the two objects. L&lt;i2d_X509_NAME(3)&gt;
-has a more detailed description of the DER encoding of the B&lt;X509_NAME&gt; structure.
+parameters I&lt;a&gt; and I&lt;b&gt;. The comparison is based on the B&lt;memcmp&gt; result of the
+canonical (DER) encoding values of the two objects using L&lt;i2d_X509_NAME(3)&gt;.
+This procedure adheres to the matching rules for Distinguished Names (DN)
+given in RFC 4517 section 4.2.15 and RFC 5280 section 7.1.
+In particular, the order of Relative Distinguished Names (RDNs) is relevant.
+On the other hand, if an RDN is multi-valued, i.e., it contains a set of
+AttributeValueAssertions (AVAs), its members are effectively not ordered.
 
 The X509_issuer_and_serial_cmp() function compares the serial number and issuer
-values in the given B&lt;X509&gt; objects B&lt;a&gt; and B&lt;b&gt;.
+values in the given B&lt;X509&gt; objects I&lt;a&gt; and I&lt;b&gt;.
 
 The X509_issuer_name_cmp(), X509_subject_name_cmp() and X509_CRL_cmp() functions
 are effectively wrappers of the X509_NAME_cmp() function. These functions compare
@@ -47,9 +51,8 @@ of just the issuer name.
 
 =head1 RETURN VALUES
 
-Like common memory comparison functions, the B&lt;X509&gt; comparison functions return
-an integer less than, equal to, or greater than zero if object B&lt;a&gt; is found to
-be less than, to match, or be greater than object B&lt;b&gt;, respectively.
+The B&lt;X509&gt; comparison functions return B&lt;-1&gt;, B&lt;0&gt;, or B&lt;1&gt; if object I&lt;a&gt; is
+found to be less than, to match, or be greater than object I&lt;b&gt;, respectively.
 
 X509_NAME_cmp(), X509_issuer_and_serial_cmp(), X509_issuer_name_cmp(),
 X509_subject_name_cmp() and X509_CRL_cmp() may return B&lt;-2&gt; to indicate an error.
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030575.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="030580.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30576">[ date ]</a>
              <a href="thread.html#30576">[ thread ]</a>
              <a href="subject.html#30576">[ subject ]</a>
              <a href="author.html#30576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
