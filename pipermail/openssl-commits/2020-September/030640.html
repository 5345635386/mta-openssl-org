<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1599935581.795193.7786.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030639.html">
   <LINK REL="Next"  HREF="030647.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1599935581.795193.7786.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Sat Sep 12 18:33:01 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="030639.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="030647.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30640">[ date ]</a>
              <a href="thread.html#30640">[ thread ]</a>
              <a href="subject.html#30640">[ subject ]</a>
              <a href="author.html#30640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  08073700cc50bcd0df5c0ee68c100e300a320d03 (commit)
      from  f0c62c53286b3a79cc059354a6d3425b35bb1d50 (commit)


- Log -----------------------------------------------------------------
commit 08073700cc50bcd0df5c0ee68c100e300a320d03
Author: Randall S. Becker &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsbecker at nexbridge.com</A>&gt;
Date:   Sun Sep 6 16:37:47 2020 -0500

    NonStop port updates for 3.0.0.
    
    HPE NonStop Port Changes for 3.0.0  Includes unthreaded, PUT, and SPT for OSS.
    
    The port changes include wrapping where necessary for FLOSS and
    appropriate configuration changes to support that. Two tests
    are excluded as being inappropriate for the platform.
    
    The changes are:
    * Added /usr/local/include to nonstop-nsx_spt_floss to load floss.h
    * Added SPT Floss variant for NonStop
    * Wrapped FLOSS definitions in OPENSSL_TANDEM_FLOSS to allow selective enablement.
    * SPT build configuration for NonStop
    * Skip tests not relevant for NonStop
    * PUT configuration changes required for NonStop platforms
    * Configurations/50-nonstop.conf: updates for TNS/X platform.
    * FLOSS instrumentation for HPE NonStop TNS/X and TNS/E platforms.
    * Configurations/50-nonstop.conf: modifications for non-PUT TNS/E platform b
    * Fix use of DELAY in ssltestlib.c for HPNS.
    * Fixed commit merge issues and added floss to http_server.c
    
    CLA: Permission is granted by the author to the OpenSSL team to use these modifications.
    Fixes #5087.
    
    Signed-off-by: Randall S. Becker &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsbecker at nexbridge.com</A>&gt;
    
    Reviewed-by: Shane Lontis &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">shane.lontis at oracle.com</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12800">https://github.com/openssl/openssl/pull/12800</A>)

-----------------------------------------------------------------------

Summary of changes:
 Configurations/50-nonstop.conf         | 176 +++++++++++++++++++++++++++++++++
 NOTES.HPNS                             |  42 ++++++++
 apps/ca.c                              |   2 +-
 apps/lib/apps.c                        |  20 ++++
 apps/lib/http_server.c                 |   6 ++
 apps/lib/s_socket.c                    |   6 ++
 apps/ocsp.c                            |   6 ++
 apps/provider.c                        |   4 +
 apps/speed.c                           |   6 ++
 apps/version.c                         |  13 +++
 crypto/bio/b_sock.c                    |   8 +-
 crypto/conf/conf_def.c                 |   3 +
 crypto/cryptlib.c                      |  12 +++
 crypto/dso/dso_dlfcn.c                 |   2 +-
 crypto/rand/rand_egd.c                 |  70 +++++++++++++
 crypto/threads_pthread.c               |   6 +-
 e_os.h                                 |  58 +++++++++++
 include/internal/cryptlib.h            |   4 +
 include/internal/sockets.h             |  11 +++
 include/openssl/crypto.h               |   8 +-
 include/openssl/e_os2.h                |  15 +++
 ssl/ssl_lib.c                          |  13 +++
 test/bntest.c                          |   3 +
 test/drbgtest.c                        |   5 +
 test/recipes/01-test_symbol_presence.t |   2 +
 test/recipes/90-test_shlibload.t       |   1 +
 26 files changed, 497 insertions(+), 5 deletions(-)
 create mode 100644 Configurations/50-nonstop.conf
 create mode 100644 NOTES.HPNS

diff --git a/Configurations/50-nonstop.conf b/Configurations/50-nonstop.conf
new file mode 100644
index 0000000000..51034c70aa
--- /dev/null
+++ b/Configurations/50-nonstop.conf
@@ -0,0 +1,176 @@
+#### Nonstop configurations
+    &quot;nonstop-common&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;BASE_unix&quot; ],
+        template         =&gt; 1,
+        cc               =&gt; &quot;c99&quot;,
+        cflags           =&gt; add_before(picker(debug   =&gt; &quot;-g -O0&quot;,
+                                              release =&gt; &quot;-g -O2&quot;) ,&quot;-Wextensions -Wnowarn=203,220,272,734,770,1506 -Wbuild_neutral_library&quot;),
+        perl             =&gt; &quot;/usr/bin/perl&quot;,
+        lflags           =&gt; &quot;-lrld&quot;,
+        shared_target    =&gt; &quot;self&quot;,
+        shared_cflag     =&gt; &quot;&quot;,
+        shared_ldflag    =&gt; &quot;-Wshared&quot;,
+        shared_extension =&gt; &quot;.so&quot;,
+        enable           =&gt; [&quot;egd&quot;],
+        dso_scheme       =&gt; &quot;DLFCN&quot;,
+    },
+    &quot;nonstop-nsx&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -I/usr/local/include&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -I/usr/local/include&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Wxld='-set floattype neutral_float' -Wsystype=oss&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Wxld='-export_all -set floattype neutral_float -set systype oss' -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;OPENSSL_TANDEM_FLOSS&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nsx_put&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lput&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wxld='-export_all -set floattype neutral_float -set systype oss' -lput -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_PUT_MODEL_&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_ENABLE_FLOSS_THREADS&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nsx_64&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Wlp64&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Wxld='-export_all -set data_model lp64 -set floattype neutral_float -set systype oss' -Wlp64 -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;OPENSSL_TANDEM_FLOSS&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
+    },
+    &quot;nonstop-nsx_64_put&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose -Wtarget=tns/x&quot;) },
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose -Wtarget=tns/x&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wxld='-set floattype neutral_float -set systype oss' -Wlp64 -lput -Wsystype=oss&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wxld='-export_all -set data_model lp64'&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_PUT_MODEL_&quot;,&quot;_TANDEM_ARCH=3&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_ENABLE_FLOSS_THREADS&quot;,&quot;__TANDEM&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;],
+        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT&quot;,
+    },
+    &quot;nonstop-nsx_spt&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/x&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/x&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lspt -Wextensions&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wxld='-export_all -set floattype neutral_float -set systype oss' -lspt -Wextensions -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_SPT_MODEL_&quot;,&quot;_THREAD_SUPPORT_FUNCTIONS&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nsx_spt_floss&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-I/usr/local/include -Wverbose -Wtarget=tns/x&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-I/usr/local/include -Wverbose -Wtarget=tns/x&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -lspt -Wextensions&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Wxld='-export_all -set floattype neutral_float -set systype oss' -lspt -Wextensions -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_SPT_MODEL_&quot;,&quot;_THREAD_SUPPORT_FUNCTIONS&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;,&quot;OPENSSL_TANDEM_FLOSS&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nsx_g&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/x&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/x&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wsystype=guardian -Wxld='-set systype guardian -set floattype neutral_float'&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wxld='-export_all -set floattype neutral_float -soname \$\(\@:lib%.so=%\)  -set systype guardian' -Wsystype=guardian&quot;) },
+        #shared_extension =&gt; &quot; &quot;,
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;NO_GETPID&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nsx_g_tandem&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/x&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/x&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wsystype=guardian -Wxld='-set systype guardian -set floattype tandem_float'&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wxld='-export_all -set floattype tandem_float -soname \$\(\@:lib%.so=%\)  -set systype guardian' -Wsystype=guardian&quot;) },
+        #shared_extension =&gt; &quot; &quot;,
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;NO_GETPID&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nsv&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-nsx&quot; ],
+    },
+    &quot;nonstop-nse&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e -I/usr/local/include&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e -I/usr/local/include&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Weld='-export_all -set floattype neutral_float -set systype oss' -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_TANDEM_ARCH=2&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;__TANDEM&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;OPENSSL_TANDEM_FLOSS&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nse_put&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lput&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Weld='-export_all -set floattype neutral_float -set systype oss' -lput -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_PUT_MODEL_&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_ENABLE_FLOSS_THREADS&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nse_64&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Wlp64&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Weld='-export_all -set data_model lp64  -set floattype neutral_float -set systype oss' -Wlp64 -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;OPENSSL_TANDEM_FLOSS&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR RC4_CHUNK DES_INT DES_UNROLL BF_PTR&quot;,
+    },
+    &quot;nonstop-nse_64_put&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wlp64 -Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lput -Wlp64&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Weld='-export_all -set data_model lp64 -set floattype neutral_float -set systype oss' -Wlp64 -lput -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_PUT_MODEL_&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;,&quot;_ENABLE_FLOSS_THREADS&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;],
+        bn_ops           =&gt; &quot;SIXTY_FOUR_BIT_LONG RC4_CHAR RC4_CHUNK DES_INT DES_UNROLL BF_PTR&quot;,
+    },
+    &quot;nonstop-nse_spt&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lspt -Wextensions&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Weld='-export_all -set floattype neutral_float -set systype oss' -lspt -Wextensions -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_SPT_MODEL_&quot;,&quot;_THREAD_SUPPORT_FUNCTIONS&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nse_spt_floss&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -lspt -Wextensions&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-lfloss -Weld='-export_all -set floattype neutral_float -set systype oss' -lspt -Wextensions -Wsystype=oss&quot;) },
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_REENTRANT&quot;, &quot;_SPT_MODEL_&quot;,&quot;_THREAD_SUPPORT_FUNCTIONS&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;OPENSSL_TANDEM_FLOSS&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+    &quot;nonstop-nse_g&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wsystype=guardian -Weld='-set systype guardian'&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Weld='-set systype guardian -export_all -set floattype neutral_float -soname \$\(\@:lib%.so=%\)' -Wsystype=guardian&quot;) },
+        #shared_extension =&gt; &quot; &quot;,
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;NO_GETPID&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
+
+    &quot;nonstop-nse_g_tandem&quot; =&gt; {
+        inherit_from     =&gt; [ &quot;nonstop-common&quot; ],
+        cflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        shared_cflag     =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wverbose -Wtarget=tns/e&quot;) },
+        lflags           =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wsystype=guardian -Weld='-set systype guardian -set floattype tandem_float'&quot;) },
+        shared_ldflag    =&gt; sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>,&quot;-Wsystype=guardian -Weld='-set systype guardian -export_all -set floattype tandem_float -soname \$\(\@:lib%.so=%\)'&quot;) },
+        #shared_extension =&gt; &quot; &quot;,
+        defines          =&gt; [&quot;OPENSSL_VPROC=\$(OPENSSL_VPROC)&quot;,&quot;_XOPEN_SOURCE&quot;,&quot;_XOPEN_SOURCE_EXTENDED=1&quot;, &quot;_TANDEM_SOURCE&quot;, &quot;B_ENDIAN&quot;, &quot;OPENSSL_SYSNAME_TANDEM&quot;, &quot;NO_GETPID&quot;],
+        disable          =&gt; [&quot;threads&quot;],
+        bn_ops           =&gt; &quot;THIRTY_TWO_BIT&quot;,
+    },
diff --git a/NOTES.HPNS b/NOTES.HPNS
new file mode 100644
index 0000000000..359f18b3a8
--- /dev/null
+++ b/NOTES.HPNS
@@ -0,0 +1,42 @@
+## Probably have to be set:
+# COMP_ROOT=$(cygpath -w /path/to/comp_rooot)   # must be path format for system (ie windows)
+# CC=/path/to/c99                               # must be executable by shell
+
+## Optionally
+# DBGFLAG=&quot;--debug&quot;
+# CIPHENABLES=&quot;enable-ssl3 enable-ssl3-method enable-weak-ssl-ciphers enable-rc4&quot;
+# onplatform cross compile (nsx-&gt;nsi): SYSTEMLIBS=&quot;-L/E/cs3/usr/local/lib&quot;
+## VPROC
+## For Itanium:
+# OPENSSL_VPROC_PREFIX=T0085H06
+## For X86:
+# OPENSSL_VPROC_PREFIX=T0085L01
+# export OPENSSL_VPROC=${OPENSSL_VPROC_PREFIX}_$(cat include/openssl/opensslv.h |\
+#  sed -n -e 's/^ *# *define  *OPENSSL_VERSION_TEXT[^&quot;]*&quot;\([^&quot;]*\)&quot;/\1/p' |\
+#  sed -e 's/[. ]/_/g' -e 's/[.-]/_/g' |\
+#  grep -v fips \
+#  )
+
+## Current Configure targets
+#  Guardian targets' libraries will have so-names 'ssl' and 'crypto'
+./Configure nonstop-nsx          --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nsx_g        --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nsx_put      --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  threads &quot;-D_REENTRANT&quot; --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nsx_spt      --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  threads &quot;-D_REENTRANT&quot; --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nsx_64       --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nsx_64_put   --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  threads &quot;-D_REENTRANT&quot; --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nsx_g_tandem --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+
+./Configure nonstop-nse          --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nse_g        --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nse_put      --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  threads &quot;-D_REENTRANT&quot; --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nse_spt      --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  threads &quot;-D_REENTRANT&quot; --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nse_64       --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nse_64_put   --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  threads &quot;-D_REENTRANT&quot; --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+./Configure nonstop-nse_g_tandem --prefix=${PWD}/install --openssldir=${PWD}/install no-dynamic-engine  no-threads             --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
+
+## Build loop:
+#  Configure &lt;...&gt;
+#  Make
+#  ...
+#  Make install
diff --git a/apps/ca.c b/apps/ca.c
index f6a928a0e8..3c2bee8f2f 100644
--- a/apps/ca.c
+++ b/apps/ca.c
@@ -26,7 +26,7 @@
 #ifndef W_OK
 # ifdef OPENSSL_SYS_VMS
 #  include &lt;unistd.h&gt;
-# elif !defined(OPENSSL_SYS_VXWORKS) &amp;&amp; !defined(OPENSSL_SYS_WINDOWS)
+# elif !defined(OPENSSL_SYS_VXWORKS) &amp;&amp; !defined(OPENSSL_SYS_WINDOWS) &amp;&amp; !defined(OPENSSL_SYSNAME_TANDEM)
 #  include &lt;sys/file.h&gt;
 # endif
 #endif
diff --git a/apps/lib/apps.c b/apps/lib/apps.c
index f2c384494f..5d95ce0c65 100644
--- a/apps/lib/apps.c
+++ b/apps/lib/apps.c
@@ -2399,6 +2399,11 @@ int raw_read_stdin(void *buf, int siz)
     return recv(fileno_stdin(), buf, siz, 0);
 }
 #else
+# if defined(__TANDEM)
+#  if defined(OPENSSL_TANDEM_FLOSS)
+#   include &lt;floss.h(floss_read)&gt;
+#  endif
+# endif
 int raw_read_stdin(void *buf, int siz)
 {
     return read(fileno_stdin(), buf, siz);
@@ -2414,7 +2419,22 @@ int raw_write_stdout(const void *buf, int siz)
     else
         return -1;
 }
+#elif defined(OPENSSL_SYSNAME_TANDEM) &amp;&amp; defined(OPENSSL_THREADS) &amp;&amp; defined(_SPT_MODEL_)
+# if defined(__TANDEM)
+#  if defined(OPENSSL_TANDEM_FLOSS)
+#   include &lt;floss.h(floss_write)&gt;
+#  endif
+# endif
+int raw_write_stdout(const void *buf,int siz)
+{
+	return write(fileno(stdout),(void*)buf,siz);
+}
 #else
+# if defined(__TANDEM)
+#  if defined(OPENSSL_TANDEM_FLOSS)
+#   include &lt;floss.h(floss_write)&gt;
+#  endif
+# endif
 int raw_write_stdout(const void *buf, int siz)
 {
     return write(fileno_stdout(), buf, siz);
diff --git a/apps/lib/http_server.c b/apps/lib/http_server.c
index 5c009b9990..b7d9842013 100644
--- a/apps/lib/http_server.c
+++ b/apps/lib/http_server.c
@@ -24,6 +24,12 @@
 #include &lt;openssl/err.h&gt;
 #include &lt;openssl/rand.h&gt;
 
+#if defined(__TANDEM)
+# if defined(OPENSSL_TANDEM_FLOSS)
+#  include &lt;floss.h(floss_fork)&gt;
+# endif
+#endif
+
 int multi = 0; /* run multiple responder processes */
 
 #ifdef HTTP_DAEMON
diff --git a/apps/lib/s_socket.c b/apps/lib/s_socket.c
index b9baef913d..890bd39414 100644
--- a/apps/lib/s_socket.c
+++ b/apps/lib/s_socket.c
@@ -32,6 +32,12 @@ typedef unsigned int u_int;
 # include &quot;s_apps.h&quot;
 # include &quot;internal/sockets.h&quot;
 
+# if defined(__TANDEM)
+#  if defined(OPENSSL_TANDEM_FLOSS)
+#   include &lt;floss.h(floss_read)&gt;
+#  endif
+# endif
+
 # include &lt;openssl/bio.h&gt;
 # include &lt;openssl/err.h&gt;
 
diff --git a/apps/ocsp.c b/apps/ocsp.c
index 0aca4b7622..4f42d66c0e 100644
--- a/apps/ocsp.c
+++ b/apps/ocsp.c
@@ -38,6 +38,12 @@ DEFINE_STACK_OF(CONF_VALUE)
 DEFINE_STACK_OF(X509)
 DEFINE_STACK_OF_STRING()
 
+#if defined(__TANDEM)
+# if defined(OPENSSL_TANDEM_FLOSS)
+#  include &lt;floss.h(floss_fork)&gt;
+# endif
+#endif
+
 #if defined(OPENSSL_SYS_VXWORKS)
 /* not supported */
 int setpgid(pid_t pid, pid_t pgid)
diff --git a/apps/provider.c b/apps/provider.c
index 7d3581153b..748b95023e 100644
--- a/apps/provider.c
+++ b/apps/provider.c
@@ -20,6 +20,10 @@
 #include &lt;openssl/core.h&gt;
 #include &lt;openssl/core_dispatch.h&gt;
 
+#ifdef __TANDEM
+# include &lt;string.h&gt; /* memset */
+#endif
+
 DEFINE_STACK_OF_CSTRING()
 
 typedef enum OPTION_choice {
diff --git a/apps/speed.c b/apps/speed.c
index 4bd42d4e42..017c5a280a 100644
--- a/apps/speed.c
+++ b/apps/speed.c
@@ -37,6 +37,12 @@
 # include &lt;unistd.h&gt;
 #endif
 
+#if defined(__TANDEM)
+# if defined(OPENSSL_TANDEM_FLOSS)
+#  include &lt;floss.h(floss_fork)&gt;
+# endif
+#endif
+
 #if defined(_WIN32)
 # include &lt;windows.h&gt;
 #endif
diff --git a/apps/version.c b/apps/version.c
index ebdd03e0fe..4a289faca0 100644
--- a/apps/version.c
+++ b/apps/version.c
@@ -134,3 +134,16 @@ opthelp:
  end:
     return ret;
 }
+
+
+#if defined(__TANDEM) &amp;&amp; defined(OPENSSL_VPROC)
+/*
+ * Define a VPROC function for the openssl program.
+ * This is used by platform version identification tools.
+ * Do not inline this procedure or make it static.
+ */
+# define OPENSSL_VPROC_STRING_(x)    x##_OPENSSL
+# define OPENSSL_VPROC_STRING(x)     OPENSSL_VPROC_STRING_(x)
+# define OPENSSL_VPROC_FUNC          OPENSSL_VPROC_STRING(OPENSSL_VPROC)
+void OPENSSL_VPROC_FUNC(void) {}
+#endif
diff --git a/crypto/bio/b_sock.c b/crypto/bio/b_sock.c
index 79f7743b2f..61dbf474f9 100644
--- a/crypto/bio/b_sock.c
+++ b/crypto/bio/b_sock.c
@@ -23,7 +23,13 @@
 static int wsa_init_done = 0;
 # endif
 
-# ifndef _WIN32
+# if defined __TANDEM
+#  include &lt;unistd.h&gt;
+#  include &lt;sys/time.h&gt; /* select */
+#  if defined(OPENSSL_TANDEM_FLOSS)
+#   include &lt;floss.h(floss_select)&gt;
+#  endif
+# elif !defined _WIN32
 #  include &lt;unistd.h&gt;
 #  include &lt;sys/select.h&gt;
 # else
diff --git a/crypto/conf/conf_def.c b/crypto/conf/conf_def.c
index 5475429abd..6f7c06afd7 100644
--- a/crypto/conf/conf_def.c
+++ b/crypto/conf/conf_def.c
@@ -11,6 +11,9 @@
 
 #include &lt;stdio.h&gt;
 #include &lt;string.h&gt;
+#ifdef __TANDEM
+# include &lt;strings.h&gt; /* strcasecmp */
+#endif
 #include &quot;internal/cryptlib.h&quot;
 #include &quot;internal/o_dir.h&quot;
 #include &lt;openssl/lhash.h&gt;
diff --git a/crypto/cryptlib.c b/crypto/cryptlib.c
index bc29a3b583..0f6d38e67b 100644
--- a/crypto/cryptlib.c
+++ b/crypto/cryptlib.c
@@ -471,3 +471,15 @@ size_t OPENSSL_instrument_bus2(unsigned int *out, size_t cnt, size_t max)
     return 0;
 }
 #endif
+
+#if defined(__TANDEM) &amp;&amp; defined(OPENSSL_VPROC)
+/*
+ * Define a VPROC function for HP NonStop build crypto library.
+ * This is used by platform version identification tools.
+ * Do not inline this procedure or make it static.
+ */
+# define OPENSSL_VPROC_STRING_(x)    x##_CRYPTO
+# define OPENSSL_VPROC_STRING(x)     OPENSSL_VPROC_STRING_(x)
+# define OPENSSL_VPROC_FUNC          OPENSSL_VPROC_STRING(OPENSSL_VPROC)
+void OPENSSL_VPROC_FUNC(void) {}
+#endif /* __TANDEM */
diff --git a/crypto/dso/dso_dlfcn.c b/crypto/dso/dso_dlfcn.c
index b8bbed87e8..bb34c6ed42 100644
--- a/crypto/dso/dso_dlfcn.c
+++ b/crypto/dso/dso_dlfcn.c
@@ -32,7 +32,7 @@ DEFINE_STACK_OF(void)
 #  if defined(__SCO_VERSION__) || defined(_SCO_ELF) || \
      (defined(__osf__) &amp;&amp; !defined(RTLD_NEXT))     || \
      (defined(__OpenBSD__) &amp;&amp; !defined(RTLD_SELF)) || \
-        defined(__ANDROID__)
+     defined(__ANDROID__) || defined(__TANDEM)
 #   undef HAVE_DLINFO
 #  endif
 # endif
diff --git a/crypto/rand/rand_egd.c b/crypto/rand/rand_egd.c
index cd87531943..c6dcd87f04 100644
--- a/crypto/rand/rand_egd.c
+++ b/crypto/rand/rand_egd.c
@@ -54,6 +54,60 @@ struct sockaddr_un {
 # include &lt;string.h&gt;
 # include &lt;errno.h&gt;
 
+# if defined(OPENSSL_SYSNAME_TANDEM)
+/*
+ * HPNS:
+ *
+ *  Our current MQ 5.3 EGD requies compatability-mode sockets
+ *  This code forces the mode to compatibility if required
+ *  and then restores the mode.
+ *
+ *  Needs review:
+ *
+ *  The better long-term solution is to either run two EGD's each in one of
+ *  the two modes or revise the EGD code to listen on two different sockets
+ *  (each in one of the two modes).
+ */
+_variable
+int hpns_socket(int family,
+                int type,
+                int protocol,
+                char* transport)
+{
+    int  socket_rc;
+    char current_transport[20];
+
+#  define AF_UNIX_PORTABILITY    &quot;$ZAFN2&quot;
+#  define AF_UNIX_COMPATIBILITY  &quot;$ZPLS&quot;
+
+    if (!_arg_present(transport) || transport != NULL || transport[0] == '\0')
+        return socket(family, type, protocol);
+
+    socket_transport_name_get(AF_UNIX, current_transport, 20);
+
+    if (strcmp(current_transport,transport) == 0)
+        return socket(family, type, protocol);
+
+    /* set the requested socket transport */
+    if (socket_transport_name_set(AF_UNIX, transport))
+        return -1;
+
+    socket_rc = socket(family,type,protocol);
+
+    /* set mode back to what it was */
+    if (socket_transport_name_set(AF_UNIX, current_transport))
+        return -1;
+
+    return socket_rc;
+}
+
+/*#define socket(a,b,c,...) hpns_socket(a,b,c,__VA_ARGS__) */
+
+static int hpns_connect_attempt = 0;
+
+# endif /* defined(OPENSSL_SYS_HPNS) */
+
+
 int RAND_query_egd_bytes(const char *path, unsigned char *buf, int bytes)
 {
     FILE *fp = NULL;
@@ -71,7 +125,11 @@ int RAND_query_egd_bytes(const char *path, unsigned char *buf, int bytes)
         return -1;
     strcpy(addr.sun_path, path);
     i = offsetof(struct sockaddr_un, sun_path) + strlen(path);
+#if defined(OPENSSL_SYSNAME_TANDEM)
+    fd = hpns_socket(AF_UNIX, SOCK_STREAM, 0, AF_UNIX_COMPATIBILITY);
+#else
     fd = socket(AF_UNIX, SOCK_STREAM, 0);
+#endif
     if (fd == -1 || (fp = fdopen(fd, &quot;r+&quot;)) == NULL)
         return -1;
     setbuf(fp, NULL);
@@ -100,6 +158,18 @@ int RAND_query_egd_bytes(const char *path, unsigned char *buf, int bytes)
             /* No error, try again */
             break;
         default:
+# if defined(OPENSSL_SYSNAME_TANDEM)
+            if (hpns_connect_attempt == 0) {
+                /* try the other kind of AF_UNIX socket */
+                close(fd);
+                fd = hpns_socket(AF_UNIX, SOCK_STREAM, 0, AF_UNIX_PORTABILITY);
+                if (fd == -1)
+                    return -1;
+                ++hpns_connect_attempt;
+                break;  /* try the connect again */
+            }
+# endif
+
             ret = -1;
             goto err;
         }
diff --git a/crypto/threads_pthread.c b/crypto/threads_pthread.c
index 8b60251e77..936aa7f0c7 100644
--- a/crypto/threads_pthread.c
+++ b/crypto/threads_pthread.c
@@ -49,7 +49,11 @@ CRYPTO_RWLOCK *CRYPTO_THREAD_lock_new(void)
     }
 
     pthread_mutexattr_init(&amp;attr);
-    pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE);
+    #if defined(__TANDEM) &amp;&amp; defined(_SPT_MODEL_)
+      pthread_mutexattr_setkind_np(&amp;attr,MUTEX_RECURSIVE_NP);
+    #else
+      pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE);
+    #endif
 
     if (pthread_mutex_init(lock, &amp;attr) != 0) {
         pthread_mutexattr_destroy(&amp;attr);
diff --git a/e_os.h b/e_os.h
index c035568464..979be9b2b1 100644
--- a/e_os.h
+++ b/e_os.h
@@ -295,6 +295,64 @@ struct servent *getservbyname(const char *name, const char *proto);
 # endif
 /* end vxworks */
 
+/* ----------------------------- HP NonStop -------------------------------- */
+/* Required to support platform variant without getpid() and pid_t. */
+# ifdef __TANDEM
+#  include &lt;strings.h&gt;
+#  include &lt;netdb.h&gt;
+#  define getservbyname(name,proto)          getservbyname((char*)name,proto)
+#  define gethostbyname(name)                gethostbyname((char*)name)
+#  define ioctlsocket(a,b,c)	ioctl(a,b,c)
+#  ifdef NO_GETPID
+inline int nssgetpid();
+#   ifndef NSSGETPID_MACRO
+#    define NSSGETPID_MACRO
+#    include &lt;cextdecs.h(PROCESSHANDLE_GETMINE_)&gt;
+#    include &lt;cextdecs.h(PROCESSHANDLE_DECOMPOSE_)&gt;
+       inline int nssgetpid()
+       {
+         short phandle[10]={0};
+         union pseudo_pid {
+          struct {
+           short cpu;
+           short pin;
+         } cpu_pin ;
+         int ppid;
+        } ppid = { 0 };
+        PROCESSHANDLE_GETMINE_(phandle);
+        PROCESSHANDLE_DECOMPOSE_(phandle, &amp;ppid.cpu_pin.cpu, &amp;ppid.cpu_pin.pin);
+        return ppid.ppid;
+       }
+#    define getpid(a) nssgetpid(a)
+#   endif /* NSSGETPID_MACRO */
+#  endif /* NO_GETPID */
+/*#  define setsockopt(a,b,c,d,f) setsockopt(a,b,c,(char*)d,f)*/
+/*#  define getsockopt(a,b,c,d,f) getsockopt(a,b,c,(char*)d,f)*/
+/*#  define connect(a,b,c) connect(a,(struct sockaddr *)b,c)*/
+/*#  define bind(a,b,c) bind(a,(struct sockaddr *)b,c)*/
+/*#  define sendto(a,b,c,d,e,f) sendto(a,(char*)b,c,d,(struct sockaddr *)e,f)*/
+#  if defined(OPENSSL_THREADS) &amp;&amp; !defined(_PUT_MODEL_)
+  /*
+   * HPNS SPT threads
+   */
+#   define  SPT_THREAD_SIGNAL 1
+#   define  SPT_THREAD_AWARE 1
+#   include &lt;spthread.h&gt;
+#   undef close
+#   define close spt_close
+/*
+#   define get_last_socket_error()	errno
+#   define clear_socket_error()	errno=0
+#   define ioctlsocket(a,b,c)	ioctl(a,b,c)
+#   define closesocket(s)		close(s)
+#   define readsocket(s,b,n)	read((s),(char*)(b),(n))
+#   define writesocket(s,b,n)	write((s),(char*)(b),(n)
+*/
+#   define accept(a,b,c)        accept(a,(struct sockaddr *)b,c)
+#   define recvfrom(a,b,c,d,e,f) recvfrom(a,b,(socklen_t)c,d,e,f)
+#  endif
+# endif
+
 # ifdef FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION
 #  define CRYPTO_memcmp memcmp
 # endif
diff --git a/include/internal/cryptlib.h b/include/internal/cryptlib.h
index 1df0c5df34..a01b1f15d5 100644
--- a/include/internal/cryptlib.h
+++ b/include/internal/cryptlib.h
@@ -215,6 +215,10 @@ static ossl_inline void ossl_sleep(unsigned long millis)
     ts.tv_sec = (long int) (millis / 1000);
     ts.tv_nsec = (long int) (millis % 1000) * 1000000ul;
     nanosleep(&amp;ts, NULL);
+# elif defined(__TANDEM) &amp;&amp; !defined(_REENTRANT)
+#  include &lt;cextdecs.h(PROCESS_DELAY_)&gt;
+    /* HPNS does not support usleep for non threaded apps */
+    PROCESS_DELAY_(millis * 1000);
 # else
     usleep(millis * 1000);
 # endif
diff --git a/include/internal/sockets.h b/include/internal/sockets.h
index 6d17363d9b..e3a6bd459b 100644
--- a/include/internal/sockets.h
+++ b/include/internal/sockets.h
@@ -145,6 +145,17 @@ struct servent *PASCAL getservbyname(const char *, const char *);
 #  define closesocket(s)              close(s)
 #  define readsocket(s,b,n)           read((s),(b),(n))
 #  define writesocket(s,b,n)          write((s),(char *)(b),(n))
+# elif defined(OPENSSL_SYSNAME_TANDEM)
+#  if defined(OPENSSL_TANDEM_FLOSS)
+#   include &lt;floss.h(floss_read, floss_write)&gt;
+#   define readsocket(s,b,n)       floss_read((s),(b),(n))
+#   define writesocket(s,b,n)      floss_write((s),(b),(n))
+#  else
+#   define readsocket(s,b,n)       read((s),(b),(n))
+#   define writesocket(s,b,n)      write((s),(b),(n))
+#  endif
+#  define ioctlsocket(a,b,c)      ioctl(a,b,c)
+#  define closesocket(s)          close(s)
 # else
 #  define ioctlsocket(a,b,c)      ioctl(a,b,c)
 #  define closesocket(s)          close(s)
diff --git a/include/openssl/crypto.h b/include/openssl/crypto.h
index abd3a68cd4..a7c2863b54 100644
--- a/include/openssl/crypto.h
+++ b/include/openssl/crypto.h
@@ -464,7 +464,13 @@ typedef LONG CRYPTO_ONCE;
 #    define CRYPTO_ONCE_STATIC_INIT 0
 #   endif
 #  else
-#   include &lt;pthread.h&gt;
+#   if defined(__TANDEM) &amp;&amp; defined(_SPT_MODEL_)
+#    define  SPT_THREAD_SIGNAL 1
+#    define  SPT_THREAD_AWARE 1
+#    include &lt;spthread.h&gt;
+#   else
+#    include &lt;pthread.h&gt;
+#   endif
 typedef pthread_once_t CRYPTO_ONCE;
 typedef pthread_key_t CRYPTO_THREAD_LOCAL;
 typedef pthread_t CRYPTO_THREAD_ID;
diff --git a/include/openssl/e_os2.h b/include/openssl/e_os2.h
index 7b51939e3d..13420d9928 100644
--- a/include/openssl/e_os2.h
+++ b/include/openssl/e_os2.h
@@ -138,6 +138,21 @@ extern &quot;C&quot; {
 #  endif
 # endif
 
+/* ---------------------------- HP NonStop -------------------------------- */
+# ifdef __TANDEM
+#  ifdef _STRING
+#   include &lt;strings.h&gt;
+#  endif
+# define OPENSSL_USE_BUILD_DATE
+# if defined(OPENSSL_THREADS) &amp;&amp; defined(_SPT_MODEL_)
+#  define  SPT_THREAD_SIGNAL 1
+#  define  SPT_THREAD_AWARE 1
+#  include &lt;spthread.h&gt;
+# elif defined(OPENSSL_THREADS) &amp;&amp; defined(_PUT_MODEL_)
+#  include &lt;pthread.h&gt;
+# endif
+# endif
+
 /**
  * That's it for OS-specific stuff
  *****************************************************************************/
diff --git a/ssl/ssl_lib.c b/ssl/ssl_lib.c
index ad1cfb4f40..a036ac29e9 100644
--- a/ssl/ssl_lib.c
+++ b/ssl/ssl_lib.c
@@ -556,6 +556,19 @@ static int ssl_check_allowed_versions(int min_version, int max_version)
     return 1;
 }
 
+#if defined(__TANDEM) &amp;&amp; defined(OPENSSL_VPROC)
+/*
+ * Define a VPROC function for HP NonStop build ssl library.
+ * This is used by platform version identification tools.
+ * Do not inline this procedure or make it static.
+ */
+# define OPENSSL_VPROC_STRING_(x)    x##_SSL
+# define OPENSSL_VPROC_STRING(x)     OPENSSL_VPROC_STRING_(x)
+# define OPENSSL_VPROC_FUNC          OPENSSL_VPROC_STRING(OPENSSL_VPROC)
+void OPENSSL_VPROC_FUNC(void) {}
+#endif
+
+
 static void clear_ciphers(SSL *s)
 {
     /* clear the current cipher */
diff --git a/test/bntest.c b/test/bntest.c
index 252bac4d8e..5ec35181f1 100644
--- a/test/bntest.c
+++ b/test/bntest.c
@@ -10,6 +10,9 @@
 #include &lt;errno.h&gt;
 #include &lt;stdio.h&gt;
 #include &lt;string.h&gt;
+#ifdef __TANDEM
+# include &lt;strings.h&gt; /* strcasecmp */
+#endif
 #include &lt;ctype.h&gt;
 
 #include &lt;openssl/bn.h&gt;
diff --git a/test/drbgtest.c b/test/drbgtest.c
index d069460cd5..2ded33aa7f 100644
--- a/test/drbgtest.c
+++ b/test/drbgtest.c
@@ -31,6 +31,11 @@
 # include &lt;windows.h&gt;
 #endif
 
+#if defined(__TANDEM)
+# if defined(OPENSSL_TANDEM_FLOSS)
+#  include &lt;floss.h(floss_fork)&gt;
+# endif
+#endif
 
 #if defined(OPENSSL_SYS_UNIX)
 # include &lt;sys/types.h&gt;
diff --git a/test/recipes/01-test_symbol_presence.t b/test/recipes/01-test_symbol_presence.t
index d339770b0f..f22133d9d2 100644
--- a/test/recipes/01-test_symbol_presence.t
+++ b/test/recipes/01-test_symbol_presence.t
@@ -17,6 +17,8 @@ setup(&quot;test_symbol_presence&quot;);
 plan skip_all =&gt; &quot;Only useful when building shared libraries&quot;
     if disabled(&quot;shared&quot;);
 
+plan skip_all =&gt; &quot;Test is disabled on NonStop&quot; if config('target') =~ m|^nonstop|;
+
 my @libnames = (&quot;crypto&quot;, &quot;ssl&quot;);
 my $testcount = scalar @libnames;
 
diff --git a/test/recipes/90-test_shlibload.t b/test/recipes/90-test_shlibload.t
index fee56cd254..96e3e6e12e 100644
--- a/test/recipes/90-test_shlibload.t
+++ b/test/recipes/90-test_shlibload.t
@@ -21,6 +21,7 @@ use platform;
 
 plan skip_all =&gt; &quot;Test only supported in a shared build&quot; if disabled(&quot;shared&quot;);
 plan skip_all =&gt; &quot;Test is disabled on AIX&quot; if config('target') =~ m|^aix|;
+plan skip_all =&gt; &quot;Test is disabled on NonStop&quot; if config('target') =~ m|^nonstop|;
 plan skip_all =&gt; &quot;Test only supported in a dso build&quot; if disabled(&quot;dso&quot;);
 
 plan tests =&gt; 10;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030639.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="030647.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30640">[ date ]</a>
              <a href="thread.html#30640">[ thread ]</a>
              <a href="subject.html#30640">[ subject ]</a>
              <a href="author.html#30640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
