<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1600839184.535053.9021.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030852.html">
   <LINK REL="Next"  HREF="030860.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl]  master update</H1>
    <B>Dr. Paul Dale</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1600839184.535053.9021.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl]  master update">pauli at openssl.org
       </A><BR>
    <I>Wed Sep 23 05:33:04 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="030852.html">[openssl]  master update
</A></li>
        <LI>Next message: <A HREF="030860.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30858">[ date ]</a>
              <a href="thread.html#30858">[ thread ]</a>
              <a href="subject.html#30858">[ subject ]</a>
              <a href="author.html#30858">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  2e9ab56edc6961aad779e1d41cb6e7414ae5a71d (commit)
       via  2ff4e15dc2a981a447859558c8de2c96ba804c5b (commit)
       via  0ed26fb63c814458e9906a916fe3ce5ca961842f (commit)
       via  c9452d74a4bad8853ca60889788e51d46328877d (commit)
       via  d8e52fd05e350ee308715c46ac13dbea2899a6ce (commit)
       via  44d2482ba62bf7fc2fd4cfc250ad09e0feaa42da (commit)
      from  11b93a1c82f2cb2be67b2d08cac4168a16555364 (commit)


- Log -----------------------------------------------------------------
commit 2e9ab56edc6961aad779e1d41cb6e7414ae5a71d
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
Date:   Tue Sep 22 15:09:25 2020 +1000

    rand: add a test case for configuration based random
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12931">https://github.com/openssl/openssl/pull/12931</A>)

commit 2ff4e15dc2a981a447859558c8de2c96ba804c5b
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
Date:   Tue Sep 22 09:36:53 2020 +1000

    list: add capability to print details about the current DRBGs
    
    This allows a user to confirm that the DRBG their configuration specified is
    being used.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12931">https://github.com/openssl/openssl/pull/12931</A>)

commit 0ed26fb63c814458e9906a916fe3ce5ca961842f
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
Date:   Tue Sep 22 09:26:23 2020 +1000

    drbg: gettable parameters for cipher/digest/mac type.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12931">https://github.com/openssl/openssl/pull/12931</A>)

commit c9452d74a4bad8853ca60889788e51d46328877d
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
Date:   Tue Sep 22 09:25:35 2020 +1000

    kdf/mac: add name query calls for KDFs and MACs
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12931">https://github.com/openssl/openssl/pull/12931</A>)

commit d8e52fd05e350ee308715c46ac13dbea2899a6ce
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
Date:   Tue Sep 22 08:29:58 2020 +1000

    evp_rand: fix bug in gettable_ctx/settable_ctx calls
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12931">https://github.com/openssl/openssl/pull/12931</A>)

commit 44d2482ba62bf7fc2fd4cfc250ad09e0feaa42da
Author: Pauli &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
Date:   Mon Sep 21 16:07:34 2020 +1000

    Add a &quot;random&quot; configuration section.
    
    This permits the default trio of DRBGs to have their type and parameters set
    using configuration.
    
    Reviewed-by: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">matt at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/12931">https://github.com/openssl/openssl/pull/12931</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/include/app_params.h                         |   1 +
 apps/lib/app_params.c                             |  36 ++++++++
 apps/list.c                                       |  81 +++++++++++++++-
 crypto/conf/conf_mall.c                           |   2 +
 crypto/cpt_err.c                                  |   6 +-
 crypto/err/openssl.txt                            |   2 +
 crypto/evp/evp_rand.c                             |   4 +-
 crypto/evp/kdf_lib.c                              |   7 ++
 crypto/evp/mac_lib.c                              |   7 ++
 crypto/rand/rand_lib.c                            | 108 +++++++++++++++++++++-
 doc/internal/man3/ossl_random_add_conf_module.pod |  42 +++++++++
 doc/man3/EVP_KDF.pod                              |   9 +-
 doc/man3/EVP_MAC.pod                              |   9 +-
 doc/man5/config.pod                               |  51 ++++++++++
 include/crypto/rand.h                             |   5 +
 include/openssl/cryptoerr.h                       |   2 +
 include/openssl/evp.h                             |   1 +
 include/openssl/kdf.h                             |   1 +
 providers/implementations/rands/drbg_ctr.c        |  15 +++
 providers/implementations/rands/drbg_hash.c       |  11 +++
 providers/implementations/rands/drbg_hmac.c       |  22 +++++
 test/recipes/20-test_rand_config.t                | 103 +++++++++++++++++++++
 util/libcrypto.num                                |   4 +-
 23 files changed, 517 insertions(+), 12 deletions(-)
 create mode 100644 doc/internal/man3/ossl_random_add_conf_module.pod
 create mode 100644 test/recipes/20-test_rand_config.t

diff --git a/apps/include/app_params.h b/apps/include/app_params.h
index 2060b5200e..d282fd657f 100644
--- a/apps/include/app_params.h
+++ b/apps/include/app_params.h
@@ -10,4 +10,5 @@
 #include &lt;openssl/core.h&gt;
 
 int print_param_types(const char *thing, const OSSL_PARAM *pdefs, int indent);
+void print_param_value(const OSSL_PARAM *p, int indent);
 
diff --git a/apps/lib/app_params.c b/apps/lib/app_params.c
index 3305b1e922..04337cbc83 100644
--- a/apps/lib/app_params.c
+++ b/apps/lib/app_params.c
@@ -94,3 +94,39 @@ int print_param_types(const char *thing, const OSSL_PARAM *pdefs, int indent)
     return 1;
 }
 
+void print_param_value(const OSSL_PARAM *p, int indent)
+{
+    int64_t i;
+    uint64_t u;
+
+    printf(&quot;%*s%s: &quot;, indent, &quot;&quot;, p-&gt;key);
+    switch (p-&gt;data_type) {
+    case OSSL_PARAM_UNSIGNED_INTEGER:
+        if (OSSL_PARAM_get_uint64(p, &amp;u))
+            BIO_printf(bio_out, &quot;%llu\n&quot;, (unsigned long long int)u);
+        else
+            BIO_printf(bio_out, &quot;error getting value\n&quot;);
+        break;
+    case OSSL_PARAM_INTEGER:
+        if (OSSL_PARAM_get_int64(p, &amp;i))
+            BIO_printf(bio_out, &quot;%lld\n&quot;, (long long int)i);
+        else
+            BIO_printf(bio_out, &quot;error getting value\n&quot;);
+        break;
+    case OSSL_PARAM_UTF8_PTR:
+        BIO_printf(bio_out, &quot;'%s'\n&quot;, *(char **)(p-&gt;data));
+        break;
+    case OSSL_PARAM_UTF8_STRING:
+        BIO_printf(bio_out, &quot;'%s'\n&quot;, (char *)p-&gt;data);
+        break;
+    case OSSL_PARAM_OCTET_PTR:
+    case OSSL_PARAM_OCTET_STRING:
+        BIO_printf(bio_out, &quot;&lt;%zu bytes&gt;\n&quot;, p-&gt;data_size);
+        break;
+    default:
+        BIO_printf(bio_out, &quot;unknown type (%u) of %zu bytes\n&quot;,
+                   p-&gt;data_type, p-&gt;data_size);
+        break;
+    }
+}
+
diff --git a/apps/list.c b/apps/list.c
index fd018991e1..b2ddef9201 100644
--- a/apps/list.c
+++ b/apps/list.c
@@ -19,6 +19,7 @@
 #include &lt;openssl/encoder.h&gt;
 #include &lt;openssl/decoder.h&gt;
 #include &lt;openssl/core_names.h&gt;
+#include &lt;openssl/rand.h&gt;
 #include &quot;apps.h&quot;
 #include &quot;app_params.h&quot;
 #include &quot;progs.h&quot;
@@ -352,6 +353,74 @@ static void list_random_generators(void)
     sk_EVP_RAND_pop_free(rands, EVP_RAND_free);
 }
 
+static void display_random(const char *name, EVP_RAND_CTX *drbg)
+{
+    EVP_RAND *rand;
+    uint64_t u;
+    const char *p;
+    const OSSL_PARAM *gettables;
+    OSSL_PARAM params[2] = { OSSL_PARAM_END, OSSL_PARAM_END };
+    unsigned char buf[1000];
+
+    BIO_printf(bio_out, &quot;%s:\n&quot;, name);
+    if (drbg != NULL) {
+        rand = EVP_RAND_CTX_rand(drbg);
+
+        BIO_printf(bio_out, &quot;  %s&quot;, EVP_RAND_name(rand));
+        BIO_printf(bio_out, &quot; @ %s\n&quot;,
+                   OSSL_PROVIDER_name(EVP_RAND_provider(rand)));
+
+        switch (EVP_RAND_state(drbg)) {
+        case EVP_RAND_STATE_UNINITIALISED:
+            p = &quot;uninitialised&quot;;
+            break;
+        case EVP_RAND_STATE_READY:
+            p = &quot;ready&quot;;
+            break;
+        case EVP_RAND_STATE_ERROR:
+            p = &quot;error&quot;;
+            break;
+        default:
+            p = &quot;unknown&quot;;
+            break;
+        }
+        BIO_printf(bio_out, &quot;  state = %s\n&quot;, p);
+
+        gettables = EVP_RAND_gettable_ctx_params(rand);
+        if (gettables != NULL)
+            for (; gettables-&gt;key != NULL; gettables++) {
+                /* State has been dealt with already, so ignore */
+                if (strcasecmp(gettables-&gt;key, OSSL_RAND_PARAM_STATE) == 0)
+                    continue;
+                /* Outside of verbose mode, we skip non-string values */
+                if (gettables-&gt;data_type != OSSL_PARAM_UTF8_STRING
+                        &amp;&amp; gettables-&gt;data_type != OSSL_PARAM_UTF8_PTR
+                        &amp;&amp; !verbose)
+                    continue;
+                params-&gt;key = gettables-&gt;key;
+                params-&gt;data_type = gettables-&gt;data_type;
+                if (gettables-&gt;data_type == OSSL_PARAM_UNSIGNED_INTEGER
+                        || gettables-&gt;data_type == OSSL_PARAM_INTEGER) {
+                    params-&gt;data = &u;
+                    params-&gt;data_size = sizeof(u);
+                } else {
+                    params-&gt;data = buf;
+                    params-&gt;data_size = sizeof(buf);
+                }
+                params-&gt;return_size = 0;
+                if (EVP_RAND_get_ctx_params(drbg, params))
+                    print_param_value(params, 2);
+            }
+    }
+}
+
+static void list_random_instances(void)
+{
+    display_random(&quot;primary&quot;, RAND_get0_primary(NULL));
+    display_random(&quot;public&quot;, RAND_get0_public(NULL));
+    display_random(&quot;private&quot;, RAND_get0_private(NULL));
+}
+
 /*
  * Encoders
  */
@@ -819,8 +888,8 @@ typedef enum HELPLIST_CHOICE {
     OPT_COMMANDS, OPT_DIGEST_COMMANDS, OPT_MAC_ALGORITHMS, OPT_OPTIONS,
     OPT_DIGEST_ALGORITHMS, OPT_CIPHER_COMMANDS, OPT_CIPHER_ALGORITHMS,
     OPT_PK_ALGORITHMS, OPT_PK_METHOD, OPT_DISABLED,
-    OPT_KDF_ALGORITHMS, OPT_RANDOM_GENERATORS, OPT_ENCODERS,
-    OPT_DECODERS,
+    OPT_KDF_ALGORITHMS, OPT_RANDOM_INSTANCES, OPT_RANDOM_GENERATORS,
+    OPT_ENCODERS, OPT_DECODERS,
     OPT_MISSING_HELP, OPT_OBJECTS,
 #ifndef OPENSSL_NO_DEPRECATED_3_0
     OPT_ENGINES, 
@@ -844,6 +913,8 @@ const OPTIONS list_options[] = {
      &quot;List of message digest algorithms&quot;},
     {&quot;kdf-algorithms&quot;, OPT_KDF_ALGORITHMS, '-',
      &quot;List of key derivation and pseudo random function algorithms&quot;},
+    {&quot;random-instances&quot;, OPT_RANDOM_INSTANCES, '-',
+     &quot;List the primary, pubic and private random number generator details&quot;},
     {&quot;random-generators&quot;, OPT_RANDOM_GENERATORS, '-',
      &quot;List of random number generators&quot;},
     {&quot;mac-algorithms&quot;, OPT_MAC_ALGORITHMS, '-',
@@ -880,6 +951,7 @@ int list_main(int argc, char **argv)
     int one = 0, done = 0;
     struct {
         unsigned int commands:1;
+        unsigned int random_instances:1;
         unsigned int random_generators:1;
         unsigned int digest_commands:1;
         unsigned int digest_algorithms:1;
@@ -928,6 +1000,9 @@ opthelp:
         case OPT_KDF_ALGORITHMS:
             todo.kdf_algorithms = 1;
             break;
+        case OPT_RANDOM_INSTANCES:
+            todo.random_instances = 1;
+            break;
         case OPT_RANDOM_GENERATORS:
             todo.random_generators = 1;
             break;
@@ -986,6 +1061,8 @@ opthelp:
 
     if (todo.commands)
         list_type(FT_general, one);
+    if (todo.random_instances)
+        list_random_instances();
     if (todo.random_generators)
         list_random_generators();
     if (todo.digest_commands)
diff --git a/crypto/conf/conf_mall.c b/crypto/conf/conf_mall.c
index 123e2abaad..5d24a36cd9 100644
--- a/crypto/conf/conf_mall.c
+++ b/crypto/conf/conf_mall.c
@@ -18,6 +18,7 @@
 #include &lt;openssl/asn1.h&gt;
 #include &lt;openssl/engine.h&gt;
 #include &quot;internal/provider.h&quot;
+#include &quot;crypto/rand.h&quot;
 #include &quot;conf_local.h&quot;
 
 /* Load all OpenSSL builtin modules */
@@ -33,4 +34,5 @@ void OPENSSL_load_builtin_modules(void)
     EVP_add_alg_module();
     conf_add_ssl_module();
     ossl_provider_add_conf_module();
+    ossl_random_add_conf_module();
 }
diff --git a/crypto/cpt_err.c b/crypto/cpt_err.c
index 0201f31e61..04b6cdb27f 100644
--- a/crypto/cpt_err.c
+++ b/crypto/cpt_err.c
@@ -1,6 +1,6 @@
 /*
  * Generated by util/mkerr.pl DO NOT EDIT
- * Copyright 1995-2019 The OpenSSL Project Authors. All Rights Reserved.
+ * Copyright 1995-2020 The OpenSSL Project Authors. All Rights Reserved.
  *
  * Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
  * this file except in compliance with the License.  You can obtain a copy
@@ -38,6 +38,8 @@ static const ERR_STRING_DATA CRYPTO_str_reasons[] = {
     &quot;provider already exists&quot;},
     {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_PROVIDER_SECTION_ERROR),
     &quot;provider section error&quot;},
+    {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_RANDOM_SECTION_ERROR),
+    &quot;random section error&quot;},
     {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_SECURE_MALLOC_FAILURE),
     &quot;secure malloc failure&quot;},
     {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_STRING_TOO_LONG), &quot;string too long&quot;},
@@ -46,6 +48,8 @@ static const ERR_STRING_DATA CRYPTO_str_reasons[] = {
     &quot;too many records&quot;},
     {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_TOO_SMALL_BUFFER),
     &quot;too small buffer&quot;},
+    {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_UNKNOWN_NAME_IN_RANDOM_SECTION),
+    &quot;unknown name in random section&quot;},
     {ERR_PACK(ERR_LIB_CRYPTO, 0, CRYPTO_R_ZERO_LENGTH_NUMBER),
     &quot;zero length number&quot;},
     {0, NULL}
diff --git a/crypto/err/openssl.txt b/crypto/err/openssl.txt
index 775bf6f3c4..1d9dd9366f 100644
--- a/crypto/err/openssl.txt
+++ b/crypto/err/openssl.txt
@@ -2320,11 +2320,13 @@ CRYPTO_R_INVALID_OSSL_PARAM_TYPE:110:invalid ossl param type
 CRYPTO_R_ODD_NUMBER_OF_DIGITS:103:odd number of digits
 CRYPTO_R_PROVIDER_ALREADY_EXISTS:104:provider already exists
 CRYPTO_R_PROVIDER_SECTION_ERROR:105:provider section error
+CRYPTO_R_RANDOM_SECTION_ERROR:119:random section error
 CRYPTO_R_SECURE_MALLOC_FAILURE:111:secure malloc failure
 CRYPTO_R_STRING_TOO_LONG:112:string too long
 CRYPTO_R_TOO_MANY_BYTES:113:too many bytes
 CRYPTO_R_TOO_MANY_RECORDS:114:too many records
 CRYPTO_R_TOO_SMALL_BUFFER:116:too small buffer
+CRYPTO_R_UNKNOWN_NAME_IN_RANDOM_SECTION:120:unknown name in random section
 CRYPTO_R_ZERO_LENGTH_NUMBER:115:zero length number
 CT_R_BASE64_DECODE_ERROR:108:base64 decode error
 CT_R_INVALID_LOG_ID_LENGTH:100:invalid log id length
diff --git a/crypto/evp/evp_rand.c b/crypto/evp/evp_rand.c
index 2e4edfff34..c0729656cb 100644
--- a/crypto/evp/evp_rand.c
+++ b/crypto/evp/evp_rand.c
@@ -433,7 +433,7 @@ const OSSL_PARAM *EVP_RAND_gettable_params(const EVP_RAND *rand)
 
 const OSSL_PARAM *EVP_RAND_gettable_ctx_params(const EVP_RAND *rand)
 {
-    if (rand-&gt;gettable_params == NULL)
+    if (rand-&gt;gettable_ctx_params == NULL)
         return NULL;
     return rand-&gt;gettable_ctx_params(
                ossl_provider_ctx(EVP_RAND_provider(rand)));
@@ -441,7 +441,7 @@ const OSSL_PARAM *EVP_RAND_gettable_ctx_params(const EVP_RAND *rand)
 
 const OSSL_PARAM *EVP_RAND_settable_ctx_params(const EVP_RAND *rand)
 {
-    if (rand-&gt;gettable_params == NULL)
+    if (rand-&gt;settable_ctx_params == NULL)
         return NULL;
     return rand-&gt;settable_ctx_params(
                ossl_provider_ctx(EVP_RAND_provider(rand)));
diff --git a/crypto/evp/kdf_lib.c b/crypto/evp/kdf_lib.c
index d22bb39c82..9ccaec8cc1 100644
--- a/crypto/evp/kdf_lib.c
+++ b/crypto/evp/kdf_lib.c
@@ -88,6 +88,13 @@ int EVP_KDF_number(const EVP_KDF *kdf)
     return kdf-&gt;name_id;
 }
 
+const char *EVP_KDF_name(const EVP_KDF *kdf)
+{
+    if (kdf-&gt;prov != NULL)
+        return evp_first_name(kdf-&gt;prov, kdf-&gt;name_id);
+    return NULL;
+}
+
 int EVP_KDF_is_a(const EVP_KDF *kdf, const char *name)
 {
     return evp_is_a(kdf-&gt;prov, kdf-&gt;name_id, NULL, name);
diff --git a/crypto/evp/mac_lib.c b/crypto/evp/mac_lib.c
index 79dd49ae20..d76ffedcb8 100644
--- a/crypto/evp/mac_lib.c
+++ b/crypto/evp/mac_lib.c
@@ -162,6 +162,13 @@ int EVP_MAC_number(const EVP_MAC *mac)
     return mac-&gt;name_id;
 }
 
+const char *EVP_MAC_name(const EVP_MAC *mac)
+{
+    if (mac-&gt;prov != NULL)
+        return evp_first_name(mac-&gt;prov, mac-&gt;name_id);
+    return NULL;
+}
+
 int EVP_MAC_is_a(const EVP_MAC *mac, const char *name)
 {
     return evp_is_a(mac-&gt;prov, mac-&gt;name_id, NULL, name);
diff --git a/crypto/rand/rand_lib.c b/crypto/rand/rand_lib.c
index a37a575e5b..6b2eaab68d 100644
--- a/crypto/rand/rand_lib.c
+++ b/crypto/rand/rand_lib.c
@@ -12,6 +12,10 @@
 
 #include &lt;stdio.h&gt;
 #include &lt;time.h&gt;
+#include &lt;limits.h&gt;
+#include &lt;openssl/trace.h&gt;
+#include &lt;openssl/err.h&gt;
+#include &lt;openssl/conf.h&gt;
 #include &quot;internal/cryptlib.h&quot;
 #include &lt;openssl/opensslconf.h&gt;
 #include &quot;crypto/rand.h&quot;
@@ -353,6 +357,12 @@ typedef struct rand_global_st {
      * instance per thread.
      */
     CRYPTO_THREAD_LOCAL private;
+
+    /* Which RNG is being used by default and it's configuration settings */
+    char *rng_name;
+    char *rng_cipher;
+    char *rng_digest;
+    char *rng_propq;
 } RAND_GLOBAL;
 
 /*
@@ -405,6 +415,10 @@ static void rand_ossl_ctx_free(void *vdgbl)
     EVP_RAND_CTX_free(dgbl-&gt;primary);
     CRYPTO_THREAD_cleanup_local(&amp;dgbl-&gt;private);
     CRYPTO_THREAD_cleanup_local(&amp;dgbl-&gt;public);
+    OPENSSL_free(dgbl-&gt;rng_name);
+    OPENSSL_free(dgbl-&gt;rng_cipher);
+    OPENSSL_free(dgbl-&gt;rng_digest);
+    OPENSSL_free(dgbl-&gt;rng_propq);
 
     OPENSSL_free(dgbl);
 }
@@ -442,10 +456,14 @@ static EVP_RAND_CTX *rand_new_drbg(OPENSSL_CTX *libctx, EVP_RAND_CTX *parent,
                                    unsigned int reseed_interval,
                                    time_t reseed_time_interval)
 {
-    EVP_RAND *rand = EVP_RAND_fetch(libctx, &quot;CTR-DRBG&quot;, NULL);
+    EVP_RAND *rand;
+    RAND_GLOBAL *dgbl = rand_get_global(libctx);
     EVP_RAND_CTX *ctx;
-    OSSL_PARAM params[4], *p = params;
-    
+    OSSL_PARAM params[7], *p = params;
+    char *name, *cipher;
+
+    name = dgbl-&gt;rng_name != NULL ? dgbl-&gt;rng_name : &quot;CTR-DRBG&quot;;
+    rand = EVP_RAND_fetch(libctx, name, dgbl-&gt;rng_propq);
     if (rand == NULL) {
         RANDerr(0, RAND_R_UNABLE_TO_FETCH_DRBG);
         return NULL;
@@ -457,8 +475,20 @@ static EVP_RAND_CTX *rand_new_drbg(OPENSSL_CTX *libctx, EVP_RAND_CTX *parent,
         return NULL;
     }
 
+    /*
+     * Rather than trying to decode the DRBG settings, just pass them through
+     * and rely on the other end to ignore those it doesn't care about.
+     */
+    cipher = dgbl-&gt;rng_cipher != NULL ? dgbl-&gt;rng_cipher : &quot;AES-256-CTR&quot;;
     *p++ = OSSL_PARAM_construct_utf8_string(OSSL_DRBG_PARAM_CIPHER,
-                                            &quot;AES-256-CTR&quot;, 0);
+                                            cipher, 0);
+    if (dgbl-&gt;rng_digest != NULL)
+        *p++ = OSSL_PARAM_construct_utf8_string(OSSL_DRBG_PARAM_DIGEST,
+                                                dgbl-&gt;rng_digest, 0);
+    if (dgbl-&gt;rng_propq != NULL)
+        *p++ = OSSL_PARAM_construct_utf8_string(OSSL_DRBG_PARAM_PROPERTIES,
+                                                dgbl-&gt;rng_propq, 0);
+    *p++ = OSSL_PARAM_construct_utf8_string(OSSL_ALG_PARAM_MAC, &quot;HMAC&quot;, 0);
     *p++ = OSSL_PARAM_construct_uint(OSSL_DRBG_PARAM_RESEED_REQUESTS,
                                      &amp;reseed_interval);
     *p++ = OSSL_PARAM_construct_time_t(OSSL_DRBG_PARAM_RESEED_TIME_INTERVAL,
@@ -565,3 +595,73 @@ EVP_RAND_CTX *RAND_get0_private(OPENSSL_CTX *ctx)
     }
     return rand;
 }
+
+#ifndef FIPS_MODULE
+static int random_set_string(char **p, const char *s)
+{
+    char *d = OPENSSL_strdup(s);
+
+    if (d == NULL) {
+        CRYPTOerr(0, ERR_R_MALLOC_FAILURE);
+        return 0;
+    }
+    OPENSSL_free(*p);
+    *p = d;
+    return 1;
+}
+
+/*
+ * Load the DRBG definitions from a configuration file.
+ */
+static int random_conf_init(CONF_IMODULE *md, const CONF *cnf)
+{
+    STACK_OF(CONF_VALUE) *elist;
+    CONF_VALUE *cval;
+    RAND_GLOBAL *dgbl = rand_get_global(cnf-&gt;libctx);
+    int i, r = 1;
+
+    OSSL_TRACE1(CONF, &quot;Loading random module: section %s\n&quot;,
+                CONF_imodule_get_value(md));
+
+    /* Value is a section containing RANDOM configuration */
+    elist = NCONF_get_section(cnf, CONF_imodule_get_value(md));
+    if (elist == NULL) {
+        CRYPTOerr(0, CRYPTO_R_RANDOM_SECTION_ERROR);
+        return 0;
+    }
+
+    for (i = 0; i &lt; sk_CONF_VALUE_num(elist); i++) {
+        cval = sk_CONF_VALUE_value(elist, i);
+        if (strcasecmp(cval-&gt;name, &quot;random&quot;) == 0) {
+            if (!random_set_string(&amp;dgbl-&gt;rng_name, cval-&gt;value))
+                return 0;
+        } else if (strcasecmp(cval-&gt;name, &quot;cipher&quot;) == 0) {
+            if (!random_set_string(&amp;dgbl-&gt;rng_cipher, cval-&gt;value))
+                return 0;
+        } else if (strcasecmp(cval-&gt;name, &quot;digest&quot;) == 0) {
+            if (!random_set_string(&amp;dgbl-&gt;rng_digest, cval-&gt;value))
+                return 0;
+        } else if (strcasecmp(cval-&gt;name, &quot;properties&quot;) == 0) {
+            if (!random_set_string(&amp;dgbl-&gt;rng_propq, cval-&gt;value))
+                return 0;
+        } else {
+            CRYPTOerr(0, CRYPTO_R_UNKNOWN_NAME_IN_RANDOM_SECTION);
+            ERR_add_error_data(4, &quot;name=&quot;, cval-&gt;name, &quot;, value=&quot;, cval-&gt;value);
+            r = 0;
+        }
+    }
+    return r;
+}
+
+
+static void random_conf_deinit(CONF_IMODULE *md)
+{
+    OSSL_TRACE(CONF, &quot;Cleaned up random\n&quot;);
+}
+
+void ossl_random_add_conf_module(void)
+{
+    OSSL_TRACE(CONF, &quot;Adding config module 'random'\n&quot;);
+    CONF_module_add(&quot;random&quot;, random_conf_init, random_conf_deinit);
+}
+#endif
diff --git a/doc/internal/man3/ossl_random_add_conf_module.pod b/doc/internal/man3/ossl_random_add_conf_module.pod
new file mode 100644
index 0000000000..6d4f5810dc
--- /dev/null
+++ b/doc/internal/man3/ossl_random_add_conf_module.pod
@@ -0,0 +1,42 @@
+=pod
+
+=head1 NAME
+
+ossl_random_add_conf_module - internal random configuration module
+
+=head1 SYNOPSIS
+
+ #include &quot;crypto/rand.h&quot;
+
+ /* Configuration */
+ void ossl_random_add_conf_module(void);
+
+=head1 DESCRIPTION
+
+ossl_random_add_conf_module() adds the random configuration module
+for providers.
+This allows the type and parameters of the stardard setup of random number
+generators to be configured with an OpenSSL L&lt;config(5)&gt; file.
+
+=head1 RETURN VALUES
+
+ossl_random_add_conf_module() doesn't return any value.
+
+=head1 SEE ALSO
+
+L&lt;OSSL_PROVIDER(3)&gt;, L&lt;ossl_provider_new(3)&gt;, L&lt;provider-rand(7)&gt;
+
+=head1 HISTORY
+
+The functions described here were all added in OpenSSL 3.0.
+
+=head1 COPYRIGHT
+
+Copyright 2020 The OpenSSL Project Authors. All Rights Reserved.
+
+Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+this file except in compliance with the License.  You can obtain a copy
+in the file LICENSE in the source distribution or at
+L&lt;<A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>&gt;.
+
+=cut
diff --git a/doc/man3/EVP_KDF.pod b/doc/man3/EVP_KDF.pod
index d97d33936d..b041ccd4d9 100644
--- a/doc/man3/EVP_KDF.pod
+++ b/doc/man3/EVP_KDF.pod
@@ -6,7 +6,7 @@ EVP_KDF, EVP_KDF_fetch, EVP_KDF_free, EVP_KDF_up_ref,
 EVP_KDF_CTX, EVP_KDF_CTX_new, EVP_KDF_CTX_free, EVP_KDF_CTX_dup,
 EVP_KDF_reset, EVP_KDF_derive,
 EVP_KDF_size, EVP_KDF_provider, EVP_KDF_CTX_kdf, EVP_KDF_is_a,
-EVP_KDF_number, EVP_KDF_names_do_all,
+EVP_KDF_number, EVP_KDF_name, EVP_KDF_names_do_all,
 EVP_KDF_CTX_get_params, EVP_KDF_CTX_set_params, EVP_KDF_do_all_provided,
 EVP_KDF_get_params, EVP_KDF_gettable_ctx_params, EVP_KDF_settable_ctx_params,
 EVP_KDF_gettable_params - EVP KDF routines
@@ -31,6 +31,7 @@ EVP_KDF_gettable_params - EVP KDF routines
                         const char *properties);
  int EVP_KDF_number(const EVP_KDF *kdf);
  int EVP_KDF_is_a(const EVP_KDF *kdf, const char *name);
+ const char *EVP_KDF_name(const EVP_KDF *kdf);
  const OSSL_PROVIDER *EVP_KDF_provider(const EVP_KDF *kdf);
  void EVP_KDF_do_all_provided(OPENSSL_CTX *libctx,
                               void (*fn)(EVP_KDF *kdf, void *arg),
@@ -151,6 +152,10 @@ and the given I&lt;arg&gt; as argument.
 EVP_KDF_number() returns the internal dynamic number assigned to
 I&lt;kdf&gt;.
 
+EVP_KDF_name() return the name of the given KDF.  For fetched KDFs
+with multiple names, only one of them is returned; it's
+recommended to use EVP_KDF_names_do_all() instead.
+
 EVP_KDF_names_do_all() traverses all names for I&lt;kdf&gt;, and calls
 I&lt;fn&gt; with each name and I&lt;data&gt;.
 
@@ -245,6 +250,8 @@ EVP_KDF_CTX_free() and EVP_KDF_reset() do not return a value.
 EVP_KDF_size() returns the output size.  B&lt;SIZE_MAX&gt; is returned to indicate
 that the algorithm produces a variable amount of output; 0 to indicate failure.
 
+EVP_KDF_name() returns the name of the KDF, or NULL on error.
+
 The remaining functions return 1 for success and 0 or a negative value for
 failure.  In particular, a return value of -2 indicates the operation is not
 supported by the KDF algorithm.
diff --git a/doc/man3/EVP_MAC.pod b/doc/man3/EVP_MAC.pod
index b33af5a670..8ce9f67d45 100644
--- a/doc/man3/EVP_MAC.pod
+++ b/doc/man3/EVP_MAC.pod
@@ -3,7 +3,7 @@
 =head1 NAME
 
 EVP_MAC, EVP_MAC_fetch, EVP_MAC_up_ref, EVP_MAC_free,
-EVP_MAC_is_a, EVP_MAC_number, EVP_MAC_names_do_all,
+EVP_MAC_is_a, EVP_MAC_number, EVP_MAC_name, EVP_MAC_names_do_all,
 EVP_MAC_provider, EVP_MAC_get_params, EVP_MAC_gettable_params,
 EVP_MAC_CTX, EVP_MAC_CTX_new, EVP_MAC_CTX_free, EVP_MAC_CTX_dup,
 EVP_MAC_CTX_mac, EVP_MAC_CTX_get_params, EVP_MAC_CTX_set_params,
@@ -24,6 +24,7 @@ EVP_MAC_do_all_provided - EVP MAC routines
  void EVP_MAC_free(EVP_MAC *mac);
  int EVP_MAC_is_a(const EVP_MAC *mac, const char *name);
  int EVP_MAC_number(const EVP_MAC *mac);
+ const char *EVP_MAC_name(const EVP_MAC *mac);
  void EVP_MAC_names_do_all(const EVP_MAC *mac,
                            void (*fn)(const char *name, void *data),
                            void *data);
@@ -177,6 +178,10 @@ and the given I&lt;arg&gt; as argument.
 EVP_MAC_number() returns the internal dynamic number assigned to
 I&lt;mac&gt;.
 
+EVP_MAC_name() return the name of the given MAC.  For fetched MACs
+with multiple names, only one of them is returned; it's
+recommended to use EVP_MAC_names_do_all() instead.
+
 EVP_MAC_names_do_all() traverses all names for I&lt;mac&gt;, and calls
 I&lt;fn&gt; with each name and I&lt;data&gt;.
 
@@ -282,6 +287,8 @@ EVP_MAC_free() returns nothing at all.
 EVP_MAC_is_a() returns 1 if the given method can be identified with
 the given name, otherwise 0.
 
+EVP_MAC_name() returns a name of the MAC, or NULL on error.
+
 EVP_MAC_provider() returns a pointer to the provider for the MAC, or
 NULL on error.
 
diff --git a/doc/man5/config.pod b/doc/man5/config.pod
index 46d60f6ced..0a28f4ea4b 100644
--- a/doc/man5/config.pod
+++ b/doc/man5/config.pod
@@ -175,6 +175,7 @@ production.
  alg_section = evp_properties
  ssl_conf = ssl_configuration
  engines = engines
+ random = random
 
  [oids]
  ... new oids here ...
@@ -191,6 +192,9 @@ production.
  [engines]
  ... engine properties here ...
 
+ [random]
+ ... random properties here ...
+
 The semantics of each module are described below. The phrase &quot;in the
 initialization section&quot; refers to the section identified by the
 B&lt;openssl_conf&gt; or other name (given as B&lt;openssl_init&gt; in the
@@ -389,6 +393,53 @@ For example:
  default_algorithms = ALL
  other_ctrl = EMPTY
 
+=head2 Random Configuration
+
+The name B&lt;random&gt; in the initialization section names the section
+containing the random number generater settings.
+
+Within the random section, the following names have meaning:
+
+=over 4
+
+=item B&lt;random&gt;
+
+This is used to specify the random bit generator.
+For example:
+
+ [random]
+ random = CTR-DRBG
+
+The available random bit generators are:
+
+=over 4
+
+=item B&lt;CTR-DRBG&gt;
+
+=item B&lt;HASH-DRBG&gt;
+
+=item B&lt;HMAC-DRBG&gt;
+
+=back
+
+=item B&lt;cipher&gt;
+
+This specifies what cipher a B&lt;CTR-DRBG&gt; random bit generator will use.
+Other random bit generators ignore this name.
+The default value is B&lt;AES-256-CTR&gt;.
+
+=item B&lt;digest&gt;
+
+This specifies what digest the B&lt;HASH-DRBG&gt; or B&lt;HMAC-DRBG&gt; random bit
+generators will use.  Other random bit generators ignore this name.
+
+=item B&lt;properties&gt;
+
+This sets the property query used when fetching the random bit generator and
+any underlying algorithms.
+
+=back
+
 =head1 EXAMPLES
 
 This example shows how to use quoting and escaping.
diff --git a/include/crypto/rand.h b/include/crypto/rand.h
index c5eef81462..a437565fe8 100644
--- a/include/crypto/rand.h
+++ b/include/crypto/rand.h
@@ -88,4 +88,9 @@ void rand_pool_cleanup(void);
  */
 void rand_pool_keep_random_devices_open(int keep);
 
+/*
+ * Configuration
+ */
+void ossl_random_add_conf_module(void);
+
 #endif
diff --git a/include/openssl/cryptoerr.h b/include/openssl/cryptoerr.h
index 5ccddd0214..6add92a9ca 100644
--- a/include/openssl/cryptoerr.h
+++ b/include/openssl/cryptoerr.h
@@ -90,11 +90,13 @@ int ERR_load_CRYPTO_strings(void);
 # define CRYPTO_R_ODD_NUMBER_OF_DIGITS                    103
 # define CRYPTO_R_PROVIDER_ALREADY_EXISTS                 104
 # define CRYPTO_R_PROVIDER_SECTION_ERROR                  105
+# define CRYPTO_R_RANDOM_SECTION_ERROR                    119
 # define CRYPTO_R_SECURE_MALLOC_FAILURE                   111
 # define CRYPTO_R_STRING_TOO_LONG                         112
 # define CRYPTO_R_TOO_MANY_BYTES                          113
 # define CRYPTO_R_TOO_MANY_RECORDS                        114
 # define CRYPTO_R_TOO_SMALL_BUFFER                        116
+# define CRYPTO_R_UNKNOWN_NAME_IN_RANDOM_SECTION          120
 # define CRYPTO_R_ZERO_LENGTH_NUMBER                      115
 
 #endif
diff --git a/include/openssl/evp.h b/include/openssl/evp.h
index ff3234a914..e843a48b22 100644
--- a/include/openssl/evp.h
+++ b/include/openssl/evp.h
@@ -1104,6 +1104,7 @@ EVP_MAC *EVP_MAC_fetch(OPENSSL_CTX *libctx, const char *algorithm,
 int EVP_MAC_up_ref(EVP_MAC *mac);
 void EVP_MAC_free(EVP_MAC *mac);
 int EVP_MAC_number(const EVP_MAC *mac);
+const char *EVP_MAC_name(const EVP_MAC *mac);
 int EVP_MAC_is_a(const EVP_MAC *mac, const char *name);
 const OSSL_PROVIDER *EVP_MAC_provider(const EVP_MAC *mac);
 int EVP_MAC_get_params(EVP_MAC *mac, OSSL_PARAM params[]);
diff --git a/include/openssl/kdf.h b/include/openssl/kdf.h
index b761113956..5bef72da52 100644
--- a/include/openssl/kdf.h
+++ b/include/openssl/kdf.h
@@ -35,6 +35,7 @@ void EVP_KDF_CTX_free(EVP_KDF_CTX *ctx);
 EVP_KDF_CTX *EVP_KDF_CTX_dup(const EVP_KDF_CTX *src);
 int EVP_KDF_number(const EVP_KDF *kdf);
 int EVP_KDF_is_a(const EVP_KDF *kdf, const char *name);
+const char *EVP_KDF_name(const EVP_KDF *kdf);
 const OSSL_PROVIDER *EVP_KDF_provider(const EVP_KDF *kdf);
 const EVP_KDF *EVP_KDF_CTX_kdf(EVP_KDF_CTX *ctx);
 
diff --git a/providers/implementations/rands/drbg_ctr.c b/providers/implementations/rands/drbg_ctr.c
index 609981b9e8..fdb3d46f1f 100644
--- a/providers/implementations/rands/drbg_ctr.c
+++ b/providers/implementations/rands/drbg_ctr.c
@@ -631,6 +631,19 @@ static void drbg_ctr_free(void *vdrbg)
 static int drbg_ctr_get_ctx_params(void *vdrbg, OSSL_PARAM params[])
 {
     PROV_DRBG *drbg = (PROV_DRBG *)vdrbg;
+    PROV_DRBG_CTR *ctr = (PROV_DRBG_CTR *)drbg-&gt;data;
+    OSSL_PARAM *p;
+
+    p = OSSL_PARAM_locate(params, OSSL_DRBG_PARAM_USE_DF);
+    if (p != NULL &amp;&amp; !OSSL_PARAM_set_int(p, ctr-&gt;use_df))
+        return 0;
+
+    p = OSSL_PARAM_locate(params, OSSL_DRBG_PARAM_CIPHER);
+    if (p != NULL) {
+        if (ctr-&gt;cipher_ctr == NULL
+            || !OSSL_PARAM_set_utf8_string(p, EVP_CIPHER_name(ctr-&gt;cipher_ctr)))
+            return 0;
+    }
 
     return drbg_get_ctx_params(drbg, params);
 }
@@ -638,6 +651,8 @@ static int drbg_ctr_get_ctx_params(void *vdrbg, OSSL_PARAM params[])
 static const OSSL_PARAM *drbg_ctr_gettable_ctx_params(ossl_unused void *provctx)
 {
     static const OSSL_PARAM known_gettable_ctx_params[] = {
+        OSSL_PARAM_utf8_string(OSSL_DRBG_PARAM_CIPHER, NULL, 0),
+        OSSL_PARAM_int(OSSL_DRBG_PARAM_USE_DF, NULL),
         OSSL_PARAM_DRBG_GETTABLE_CTX_COMMON,
         OSSL_PARAM_END
     };
diff --git a/providers/implementations/rands/drbg_hash.c b/providers/implementations/rands/drbg_hash.c
index ca2f8bb0c6..e5266dbb29 100644
--- a/providers/implementations/rands/drbg_hash.c
+++ b/providers/implementations/rands/drbg_hash.c
@@ -428,6 +428,16 @@ static void drbg_hash_free(void *vdrbg)
 static int drbg_hash_get_ctx_params(void *vdrbg, OSSL_PARAM params[])
 {
     PROV_DRBG *drbg = (PROV_DRBG *)vdrbg;
+    PROV_DRBG_HASH *hash = (PROV_DRBG_HASH *)drbg-&gt;data;
+    const EVP_MD *md;
+    OSSL_PARAM *p;
+
+    p = OSSL_PARAM_locate(params, OSSL_DRBG_PARAM_DIGEST);
+    if (p != NULL) {
+        md = ossl_prov_digest_md(&amp;hash-&gt;digest);
+        if (md == NULL || !OSSL_PARAM_set_utf8_string(p, EVP_MD_name(md)))
+            return 0;
+    }
 
     return drbg_get_ctx_params(drbg, params);
 }
@@ -435,6 +445,7 @@ static int drbg_hash_get_ctx_params(void *vdrbg, OSSL_PARAM params[])
 static const OSSL_PARAM *drbg_hash_gettable_ctx_params(ossl_unused void *p_ctx)
 {
     static const OSSL_PARAM known_gettable_ctx_params[] = {
+        OSSL_PARAM_utf8_string(OSSL_DRBG_PARAM_DIGEST, NULL, 0),
         OSSL_PARAM_DRBG_GETTABLE_CTX_COMMON,
         OSSL_PARAM_END
     };
diff --git a/providers/implementations/rands/drbg_hmac.c b/providers/implementations/rands/drbg_hmac.c
index fb232de519..f7ac2926ac 100644
--- a/providers/implementations/rands/drbg_hmac.c
+++ b/providers/implementations/rands/drbg_hmac.c
@@ -325,6 +325,26 @@ static void drbg_hmac_free(void *vdrbg)
 static int drbg_hmac_get_ctx_params(void *vdrbg, OSSL_PARAM params[])
 {
     PROV_DRBG *drbg = (PROV_DRBG *)vdrbg;
+    PROV_DRBG_HMAC *hmac = (PROV_DRBG_HMAC *)drbg-&gt;data;
+    const char *name;
+    const EVP_MD *md;
+    OSSL_PARAM *p;
+
+    p = OSSL_PARAM_locate(params, OSSL_DRBG_PARAM_MAC);
+    if (p != NULL) {
+        if (hmac-&gt;ctx == NULL)
+            return 0;
+        name = EVP_MAC_name(EVP_MAC_CTX_mac(hmac-&gt;ctx));
+        if (!OSSL_PARAM_set_utf8_string(p, name))
+            return 0;
+    }
+
+    p = OSSL_PARAM_locate(params, OSSL_DRBG_PARAM_DIGEST);
+    if (p != NULL) {
+        md = ossl_prov_digest_md(&amp;hmac-&gt;digest);
+        if (md == NULL || !OSSL_PARAM_set_utf8_string(p, EVP_MD_name(md)))
+            return 0;
+    }
 
     return drbg_get_ctx_params(drbg, params);
 }
@@ -332,6 +352,8 @@ static int drbg_hmac_get_ctx_params(void *vdrbg, OSSL_PARAM params[])
 static const OSSL_PARAM *drbg_hmac_gettable_ctx_params(ossl_unused void *p_ctx)
 {
     static const OSSL_PARAM known_gettable_ctx_params[] = {
+        OSSL_PARAM_utf8_string(OSSL_DRBG_PARAM_MAC, NULL, 0),
+        OSSL_PARAM_utf8_string(OSSL_DRBG_PARAM_DIGEST, NULL, 0),
         OSSL_PARAM_DRBG_GETTABLE_CTX_COMMON,
         OSSL_PARAM_END
     };
diff --git a/test/recipes/20-test_rand_config.t b/test/recipes/20-test_rand_config.t
new file mode 100644
index 0000000000..5919eef56d
--- /dev/null
+++ b/test/recipes/20-test_rand_config.t
@@ -0,0 +1,103 @@
+#! /usr/bin/env perl
+# Copyright 2019-2020 The OpenSSL Project Authors. All Rights Reserved.
+#
+# Licensed under the Apache License 2.0 (the &quot;License&quot;).  You may not use
+# this file except in compliance with the License.  You can obtain a copy
+# in the file LICENSE in the source distribution or at
+# <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
+
+
+use strict;
+use warnings;
+
+use OpenSSL::Test;
+use OpenSSL::Test::Utils;
+
+setup(&quot;test_rand_config&quot;);
+
+my @rand_tests = (
+    { drbg =&gt; 'HASH-DRBG',
+      digest =&gt; 'SHA2-512/256',
+      properties =&gt; '',
+      expected =&gt; [&quot;HASH-DRBG&quot;, &quot;digest: 'SHA2-512/256'&quot;],
+      desc =&gt; 'HASH-DRBG SHA2-512/256' },
+
+    { drbg =&gt; 'HASH-DRBG',
+      digest =&gt; 'SHA3-256',
+      properties =&gt; '',
+      expected =&gt; [&quot;HASH-DRBG&quot;, &quot;digest: 'SHA3-512'&quot;],
+      desc =&gt; 'HASH-DRBG SHA3/512' },
+
+    { drbg =&gt; 'HMAC-DRBG',
+      digest =&gt; 'SHA3-256',
+      properties =&gt; '',
+      expected =&gt; [&quot;HMAC-DRBG&quot;, &quot;mac: HMAC&quot;, &quot;digest: 'SHA3-256'&quot;],
+      desc =&gt; 'HMAC-DRBG SHA3/256' },
+
+    { cipher =&gt; 'AES-128-CTR',
+      expected =&gt; [&quot;CTR-DRBG&quot;, &quot;cipher: 'AES-128-CTR'&quot;],
+      desc =&gt; 'CTR-DRBG AES-128 no DRBG' },
+    { expected =&gt; [&quot;CTR-DRBG&quot;, &quot;cipher: 'AES-256-CTR'&quot;],
+      desc =&gt; 'CTR-DRBG AES-256 defaults' },
+);
+
+my @aria_tests = (
+    { drbg =&gt; 'CTR-DRBG',
+      cipher =&gt; 'ARIA-128-CTR',
+      properties =&gt; '',
+      expected =&gt; [&quot;CTR-DRBG&quot;, &quot;cipher: 'ARIA-128-CTR'&quot;],
+      desc =&gt; 'CTR-DRBG ARIA-128' },
+
+    { drbg =&gt; 'CTR-DRBG',
+      cipher =&gt; 'ARIA-128-CTR',
+      properties =&gt; '',
+      expected =&gt; [&quot;CTR-DRBG&quot;, &quot;cipher: 'ARIA-128-CTR'&quot;],
+      desc =&gt; 'CTR-DRBG ARIA-256' },
+);
+
+push @rand_tests, @aria_tests unless disabled(&quot;aria&quot;);
+
+plan tests =&gt; scalar @rand_tests;
+
+my $contents =&lt;&lt;'CONFIGEND';
+openssl_conf = openssl_init
+
+[openssl_init]
+random = random_section
+
+[random_section]
+CONFIGEND
+
+foreach (@rand_tests) {
+    my $tmpfile = 'rand_config.cfg';
+    open(my $cfg, '&gt;', $tmpfile) or die &quot;Could not open file&quot;;
+    print $cfg $contents;
+    if ($_-&gt;{drbg}) {
+        print $cfg &quot;random = $_-&gt;{drbg}\n&quot;;
+    }
+    if ($_-&gt;{cipher}) {
+        print $cfg &quot;cipher = $_-&gt;{cipher}\n&quot;;
+    }
+    if ($_-&gt;{digest}) {
+        print $cfg &quot;digest = $_-&gt;{digest}\n&quot;
+    }
+    close $cfg;
+
+    $ENV{OPENSSL_CONF} = $tmpfile;
+
+    ok(comparelines($_-&gt;{expected}), $_-&gt;{desc});
+}
+
+# Check that the stdout output contains the expected values.
+sub comparelines {
+    my @lines = run(app([&quot;openssl&quot;, &quot;list&quot;, &quot;--random-instances&quot;]),
+                    capture =&gt; 1);
+
+    foreach (@_) {
+        if ( !grep( /$_/, @lines ) ) {
+            print &quot;Cannot find: $_\n&quot;;
+            return 0;
+        }
+    }
+    return 1;
+}
diff --git a/util/libcrypto.num b/util/libcrypto.num
index 3658d14c29..ceab5d3fd9 100644
--- a/util/libcrypto.num
+++ b/util/libcrypto.num
@@ -4452,6 +4452,7 @@ EVP_KDF_CTX_free                        ?	3_0_0	EXIST::FUNCTION:
 EVP_KDF_reset                           ?	3_0_0	EXIST::FUNCTION:
 EVP_KDF_size                            ?	3_0_0	EXIST::FUNCTION:
 EVP_KDF_derive                          ?	3_0_0	EXIST::FUNCTION:
+EVP_KDF_name                            ?	3_0_0	EXIST::FUNCTION:
 EC_GROUP_get0_field                     ?	3_0_0	EXIST::FUNCTION:EC
 CRYPTO_alloc_ex_data                    ?	3_0_0	EXIST::FUNCTION:
 OPENSSL_CTX_new                         ?	3_0_0	EXIST::FUNCTION:
@@ -4692,6 +4693,7 @@ EVP_MAC_get_params                      ?	3_0_0	EXIST::FUNCTION:
 EVP_MAC_gettable_params                 ?	3_0_0	EXIST::FUNCTION:
 EVP_MAC_provider                        ?	3_0_0	EXIST::FUNCTION:
 EVP_MAC_do_all_provided                 ?	3_0_0	EXIST::FUNCTION:
+EVP_MAC_name                            ?	3_0_0	EXIST::FUNCTION:
 EVP_MD_free                             ?	3_0_0	EXIST::FUNCTION:
 EVP_CIPHER_free                         ?	3_0_0	EXIST::FUNCTION:
 EVP_KDF_up_ref                          ?	3_0_0	EXIST::FUNCTION:
@@ -5309,6 +5311,6 @@ OSSL_ENCODER_INSTANCE_get_output_type   ?	3_0_0	EXIST::FUNCTION:
 OSSL_ENCODER_CTX_set_construct          ?	3_0_0	EXIST::FUNCTION:
 OSSL_ENCODER_CTX_set_construct_data     ?	3_0_0	EXIST::FUNCTION:
 OSSL_ENCODER_CTX_set_cleanup            ?	3_0_0	EXIST::FUNCTION:
-OSSL_DECODER_INSTANCE_get_input_type    ?	3_0_0	EXIST::FUNCTION:
 OSSL_ENCODER_CTX_set_passphrase_cb      ?	3_0_0	EXIST::FUNCTION:
 EVP_PKEY_typenames_do_all               ?	3_0_0	EXIST::FUNCTION:
+OSSL_DECODER_INSTANCE_get_input_type    ?	3_0_0	EXIST::FUNCTION:
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030852.html">[openssl]  master update
</A></li>
	<LI>Next message: <A HREF="030860.html">[openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30858">[ date ]</a>
              <a href="thread.html#30858">[ thread ]</a>
              <a href="subject.html#30858">[ subject ]</a>
              <a href="author.html#30858">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
