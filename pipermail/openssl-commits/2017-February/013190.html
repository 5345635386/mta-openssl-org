<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2017-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1488133630.000787.1130.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013171.html">
   <LINK REL="Next"  HREF="013192.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Dr. Stephen Henson</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1488133630.000787.1130.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">steve at openssl.org
       </A><BR>
    <I>Sun Feb 26 18:27:09 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="013171.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="013192.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13190">[ date ]</a>
              <a href="thread.html#13190">[ thread ]</a>
              <a href="subject.html#13190">[ subject ]</a>
              <a href="author.html#13190">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  26a556e778f167070037fee243d7e6b9800fdb7f (commit)
       via  5032abdfa817f86a722f9342cf57eee346c4f313 (commit)
       via  26212351b624376bebac447fc3b8434d335c579f (commit)
       via  52434847b10858548f32be086d2855b4beb94a78 (commit)
       via  b9d71999b06cff481c40f87a6e512dbf6e5daa01 (commit)
       via  f1dae5f08ad5e62c871cf5d8152f2c180c042227 (commit)
       via  6e7c55399ccd81de3b1215ba8b1cf0694fd36c9b (commit)
       via  395f7c4217be456ae10e414466bf277fc09b944c (commit)
      from  57d0d048a85d641181ac5aec2792109e15630f96 (commit)


- Log -----------------------------------------------------------------
commit 26a556e778f167070037fee243d7e6b9800fdb7f
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Sun Feb 26 16:04:31 2017 +0000

    Add missing blank lines and cosmetic improvements
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit 5032abdfa817f86a722f9342cf57eee346c4f313
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Sun Feb 26 13:40:03 2017 +0000

    TLS 1.3 support for ssl_print_ticket()
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit 26212351b624376bebac447fc3b8434d335c579f
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Sun Feb 26 03:14:53 2017 +0000

    print out alpn extension
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit 52434847b10858548f32be086d2855b4beb94a78
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Sun Feb 26 01:16:30 2017 +0000

    Add ffdhe groups to trace output
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit b9d71999b06cff481c40f87a6e512dbf6e5daa01
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Wed Feb 22 17:25:17 2017 +0000

    Print numerical value of named roups
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit f1dae5f08ad5e62c871cf5d8152f2c180c042227
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Wed Feb 22 17:24:42 2017 +0000

    Add entry for PSK extension
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit 6e7c55399ccd81de3b1215ba8b1cf0694fd36c9b
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Wed Feb 22 17:24:18 2017 +0000

    Add trace entries for remaining TLS 1.3 ciphersuites
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

commit 395f7c4217be456ae10e414466bf277fc09b944c
Author: Dr. Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
Date:   Tue Feb 21 18:43:46 2017 +0000

    Print signature type to out, not bio_err
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/2747">https://github.com/openssl/openssl/pull/2747</A>)

-----------------------------------------------------------------------

Summary of changes:
 apps/s_cb.c   |  2 +-
 ssl/t1_trce.c | 77 +++++++++++++++++++++++++++++++++++++++++++++++++++--------
 2 files changed, 68 insertions(+), 11 deletions(-)

diff --git a/apps/s_cb.c b/apps/s_cb.c
index 89033d5..080fc59 100644
--- a/apps/s_cb.c
+++ b/apps/s_cb.c
@@ -292,7 +292,7 @@ int ssl_print_sigalgs(BIO *out, SSL *s)
     if (SSL_get_peer_signature_nid(s, &amp;nid))
         BIO_printf(out, &quot;Peer signing digest: %s\n&quot;, OBJ_nid2sn(nid));
     if (SSL_get_peer_signature_type_nid(s, &amp;nid))
-        BIO_printf(bio_err, &quot;Peer signature type: %s\n&quot;, get_sigtype(nid));
+        BIO_printf(out, &quot;Peer signature type: %s\n&quot;, get_sigtype(nid));
     return 1;
 }
 
diff --git a/ssl/t1_trce.c b/ssl/t1_trce.c
index 6f340c9..7340fd1 100644
--- a/ssl/t1_trce.c
+++ b/ssl/t1_trce.c
@@ -28,6 +28,7 @@ typedef struct {
 static const char *do_ssl_trace_str(int val, ssl_trace_tbl *tbl, size_t ntbl)
 {
     size_t i;
+
     for (i = 0; i &lt; ntbl; i++, tbl++) {
         if (tbl-&gt;num == val)
             return tbl-&gt;name;
@@ -40,6 +41,7 @@ static int do_ssl_trace_list(BIO *bio, int indent,
                              size_t vlen, ssl_trace_tbl *tbl, size_t ntbl)
 {
     int val;
+
     if (msglen % vlen)
         return 0;
     while (msglen) {
@@ -428,6 +430,10 @@ static ssl_trace_tbl ssl_ciphers_tbl[] = {
     {0xCCAD, &quot;TLS_DHE_PSK_WITH_CHACHA20_POLY1305&quot;},
     {0xCCAE, &quot;TLS_RSA_PSK_WITH_CHACHA20_POLY1305&quot;},
     {0x1301, &quot;TLS_AES_128_GCM_SHA256&quot;},
+    {0x1302, &quot;TLS_AES_256_GCM_SHA384&quot;},
+    {0x1303, &quot;TLS_CHACHA20_POLY1305_SHA256&quot;},
+    {0x1304, &quot;TLS_AES_128_CCM_SHA256&quot;},
+    {0x1305, &quot;TLS_AES_128_CCM_8_SHA256&quot;},
     {0xFEFE, &quot;SSL_RSA_FIPS_WITH_DES_CBC_SHA&quot;},
     {0xFEFF, &quot;SSL_RSA_FIPS_WITH_3DES_EDE_CBC_SHA&quot;},
 };
@@ -451,6 +457,7 @@ static ssl_trace_tbl ssl_exts_tbl[] = {
     {TLSEXT_TYPE_server_authz, &quot;server_authz&quot;},
     {TLSEXT_TYPE_cert_type, &quot;cert_type&quot;},
     {TLSEXT_TYPE_key_share, &quot;key_share&quot;},
+    {TLSEXT_TYPE_psk, &quot;psk&quot;},
     {TLSEXT_TYPE_psk_kex_modes, &quot;psk_key_exchange_modes&quot;},
     {TLSEXT_TYPE_supported_groups, &quot;supported_groups&quot;},
     {TLSEXT_TYPE_ec_point_formats, &quot;ec_point_formats&quot;},
@@ -463,6 +470,8 @@ static ssl_trace_tbl ssl_exts_tbl[] = {
 # ifndef OPENSSL_NO_NEXTPROTONEG
     {TLSEXT_TYPE_next_proto_neg, &quot;next_proto_neg&quot;},
 # endif
+    {TLSEXT_TYPE_application_layer_protocol_negotiation,
+     &quot;application_layer_protocol_negotiation&quot;},
     {TLSEXT_TYPE_signed_certificate_timestamp, &quot;signed_certificate_timestamps&quot;},
     {TLSEXT_TYPE_padding, &quot;padding&quot;},
     {TLSEXT_TYPE_encrypt_then_mac, &quot;encrypt_then_mac&quot;},
@@ -499,6 +508,11 @@ static ssl_trace_tbl ssl_groups_tbl[] = {
     {27, &quot;brainpoolP384r1&quot;},
     {28, &quot;brainpoolP512r1&quot;},
     {29, &quot;ecdh_x25519&quot;},
+    {256, &quot;ffdhe2048&quot;},
+    {257, &quot;ffdhe3072&quot;},
+    {258, &quot;ffdhe4096&quot;},
+    {259, &quot;ffdhe6144&quot;},
+    {260, &quot;ffdhe8192&quot;},
     {0xFF01, &quot;arbitrary_explicit_prime_curves&quot;},
     {0xFF02, &quot;arbitrary_explicit_char2_curves&quot;}
 };
@@ -572,6 +586,7 @@ static void ssl_print_hex(BIO *bio, int indent, const char *name,
                           const unsigned char *msg, size_t msglen)
 {
     size_t i;
+
     BIO_indent(bio, indent, 80);
     BIO_printf(bio, &quot;%s (len=%d): &quot;, name, (int)msglen);
     for (i = 0; i &lt; msglen; i++)
@@ -585,6 +600,7 @@ static int ssl_print_hexbuf(BIO *bio, int indent,
 {
     size_t blen;
     const unsigned char *p = *pmsg;
+
     if (*pmsglen &lt; nlen)
         return 0;
     blen = p[0];
@@ -625,6 +641,7 @@ static int ssl_print_random(BIO *bio, int indent,
 {
     unsigned int tm;
     const unsigned char *p = *pmsg;
+
     if (*pmsglen &lt; 32)
         return 0;
     tm = (p[0] &lt;&lt; 24) | (p[1] &lt;&lt; 16) | (p[2] &lt;&lt; 8) | p[3];
@@ -683,6 +700,25 @@ static int ssl_print_extension(BIO *bio, int indent, int server,
         if (extlen != xlen + 2)
             return 0;
         return ssl_trace_list(bio, indent + 2, ext + 2, xlen, 2, ssl_groups_tbl);
+    case TLSEXT_TYPE_application_layer_protocol_negotiation:
+        if (extlen &lt; 2)
+            return 0;
+        xlen = (ext[0] &lt;&lt; 8) | ext[1];
+        if (extlen != xlen + 2)
+            return 0;
+        ext += 2;
+        while (xlen &gt; 0) {
+            size_t plen = *ext++;
+
+            if (plen &gt; xlen + 1)
+                return 0;
+            BIO_indent(bio, indent + 2, 80);
+            BIO_write(bio, ext, plen);
+            BIO_puts(bio, &quot;\n&quot;);
+            ext += plen;
+            xlen -= plen + 1;
+        }
+        return 1;
 
     case TLSEXT_TYPE_signature_algorithms:
 
@@ -744,8 +780,8 @@ static int ssl_print_extension(BIO *bio, int indent, int server,
                 return 0;
             group_id = (ext[0] &lt;&lt; 8) | ext[1];
             BIO_indent(bio, indent + 4, 80);
-            BIO_printf(bio, &quot;NamedGroup: %s\n&quot;,
-                       ssl_trace_str(group_id, ssl_groups_tbl));
+            BIO_printf(bio, &quot;NamedGroup: %s (%d)\n&quot;,
+                       ssl_trace_str(group_id, ssl_groups_tbl), group_id);
             break;
         }
         if (extlen &lt; 2)
@@ -770,8 +806,8 @@ static int ssl_print_extension(BIO *bio, int indent, int server,
             if (xlen &lt; share_len)
                 return 0;
             BIO_indent(bio, indent + 4, 80);
-            BIO_printf(bio, &quot;NamedGroup: %s\n&quot;,
-                       ssl_trace_str(group_id, ssl_groups_tbl));
+            BIO_printf(bio, &quot;NamedGroup: %s (%d)\n&quot;,
+                       ssl_trace_str(group_id, ssl_groups_tbl), group_id);
             ssl_print_hex(bio, indent + 4, &quot;key_exchange: &quot;, ext, share_len);
         }
         break;
@@ -845,6 +881,7 @@ static int ssl_print_client_hello(BIO *bio, SSL *ssl, int indent,
 {
     size_t len;
     unsigned int cs;
+
     if (!ssl_print_version(bio, indent, &quot;client_version&quot;, &amp;msg, &amp;msglen, NULL))
         return 0;
     if (!ssl_print_random(bio, indent, &amp;msg, &amp;msglen))
@@ -945,6 +982,7 @@ static int ssl_print_server_hello(BIO *bio, int indent,
 static int ssl_get_keyex(const char **pname, SSL *ssl)
 {
     unsigned long alg_k = ssl-&gt;s3-&gt;tmp.new_cipher-&gt;algorithm_mkey;
+
     if (alg_k &amp; SSL_kRSA) {
         *pname = &quot;rsa&quot;;
         return SSL_kRSA;
@@ -989,8 +1027,8 @@ static int ssl_print_client_keyex(BIO *bio, int indent, SSL *ssl,
                                   const unsigned char *msg, size_t msglen)
 {
     const char *algname;
-    int id;
-    id = ssl_get_keyex(&amp;algname, ssl);
+    int id = ssl_get_keyex(&amp;algname, ssl);
+
     BIO_indent(bio, indent, 80);
     BIO_printf(bio, &quot;KeyExchangeAlgorithm=%s\n&quot;, algname);
     if (id &amp; SSL_PSK) {
@@ -1033,8 +1071,8 @@ static int ssl_print_server_keyex(BIO *bio, int indent, SSL *ssl,
                                   const unsigned char *msg, size_t msglen)
 {
     const char *algname;
-    int id;
-    id = ssl_get_keyex(&amp;algname, ssl);
+    int id = ssl_get_keyex(&amp;algname, ssl);
+
     BIO_indent(bio, indent, 80);
     BIO_printf(bio, &quot;KeyExchangeAlgorithm=%s\n&quot;, algname);
     if (id &amp; SSL_PSK) {
@@ -1106,6 +1144,7 @@ static int ssl_print_certificate(BIO *bio, int indent,
     size_t clen;
     X509 *x;
     const unsigned char *p = *pmsg, *q;
+
     if (msglen &lt; 3)
         return 0;
     clen = (p[0] &lt;&lt; 16) | (p[1] &lt;&lt; 8) | p[2];
@@ -1235,10 +1274,11 @@ static int ssl_print_cert_request(BIO *bio, int indent, SSL *s,
     return 1;
 }
 
-static int ssl_print_ticket(BIO *bio, int indent,
+static int ssl_print_ticket(BIO *bio, int indent, SSL *s,
                             const unsigned char *msg, size_t msglen)
 {
     unsigned int tick_life;
+
     if (msglen == 0) {
         BIO_indent(bio, indent + 2, 80);
         BIO_puts(bio, &quot;No Ticket\n&quot;);
@@ -1251,8 +1291,24 @@ static int ssl_print_ticket(BIO *bio, int indent,
     msg += 4;
     BIO_indent(bio, indent + 2, 80);
     BIO_printf(bio, &quot;ticket_lifetime_hint=%u\n&quot;, tick_life);
+    if (SSL_IS_TLS13(s)) {
+        unsigned int ticket_age_add;
+
+        if (msglen &lt; 4)
+            return 0;
+        ticket_age_add = (msg[0] &lt;&lt; 24) | (msg[1] &lt;&lt; 16) | (msg[2] &lt;&lt; 8)
+                          | msg[3];
+        msglen -= 4;
+        msg += 4;
+        BIO_indent(bio, indent + 2, 80);
+        BIO_printf(bio, &quot;ticket_age_add=%u\n&quot;, ticket_age_add);
+    }
     if (!ssl_print_hexbuf(bio, indent + 2, &quot;ticket&quot;, 2, &amp;msg, &amp;msglen))
         return 0;
+    if (SSL_IS_TLS13(s) &amp;&amp; !ssl_print_extensions(bio, indent + 2, 0,
+                                                 SSL3_MT_NEWSESSION_TICKET,
+                                                 &amp;msg, &amp;msglen))
+        return 0;
     if (msglen)
         return 0;
     return 1;
@@ -1264,6 +1320,7 @@ static int ssl_print_handshake(BIO *bio, SSL *ssl, int server,
 {
     size_t hlen;
     unsigned char htype;
+
     if (msglen &lt; 4)
         return 0;
     htype = msg[0];
@@ -1338,7 +1395,7 @@ static int ssl_print_handshake(BIO *bio, SSL *ssl, int server,
         break;
 
     case SSL3_MT_NEWSESSION_TICKET:
-        if (!ssl_print_ticket(bio, indent + 2, msg, msglen))
+        if (!ssl_print_ticket(bio, indent + 2, ssl, msg, msglen))
             return 0;
         break;
 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013171.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="013192.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13190">[ date ]</a>
              <a href="thread.html#13190">[ thread ]</a>
              <a href="subject.html#13190">[ subject ]</a>
              <a href="author.html#13190">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
