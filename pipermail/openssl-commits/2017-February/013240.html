<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2017-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1488292090.254761.5423.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013239.html">
   <LINK REL="Next"  HREF="013241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Emilia Kasper</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1488292090.254761.5423.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">emilia at openssl.org
       </A><BR>
    <I>Tue Feb 28 14:28:10 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="013239.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="013241.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13240">[ date ]</a>
              <a href="thread.html#13240">[ thread ]</a>
              <a href="subject.html#13240">[ subject ]</a>
              <a href="author.html#13240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  8a05d6bb264eefe224966a4c6415a173ad58861d (commit)
       via  b53338cbf8822dd774f9e4057307f347d2b63ff0 (commit)
       via  223a90cc9a94d1f6abf04ef28dc30b03c3e5e0c1 (commit)
       via  e546e2cc8ca6f984cc1fb618b136bb28304927c9 (commit)
      from  533b178db6aea206f07810ea20ecd43a90c51855 (commit)


- Log -----------------------------------------------------------------
commit 8a05d6bb264eefe224966a4c6415a173ad58861d
Author: Emilia Kasper &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">emilia at openssl.org</A>&gt;
Date:   Tue Feb 28 14:54:07 2017 +0100

    More Configure cleanup. Remove
    - util/incore
    - util/fipslink.pl
    - the unused &quot;baseaddr&quot; configure switch
    
    Reviewed-by: Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;

commit b53338cbf8822dd774f9e4057307f347d2b63ff0
Author: Emilia Kasper &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">emilia at openssl.org</A>&gt;
Date:   Tue Feb 28 12:30:28 2017 +0100

    Clean up references to FIPS
    
    This removes the fips configure option. This option is broken as the
    required FIPS code is not available.
    
    FIPS_mode() and FIPS_mode_set() are retained for compatibility, but
    FIPS_mode() always returns 0, and FIPS_mode_set() can only be used to
    turn FIPS mode off.
    
    Reviewed-by: Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;

commit 223a90cc9a94d1f6abf04ef28dc30b03c3e5e0c1
Author: Emilia Kasper &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">emilia at openssl.org</A>&gt;
Date:   Tue Feb 28 13:25:06 2017 +0100

    Remove BN_DEBUG_TRIX
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit e546e2cc8ca6f984cc1fb618b136bb28304927c9
Author: Emilia Kasper &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">emilia at openssl.org</A>&gt;
Date:   Tue Feb 28 11:47:10 2017 +0100

    Remove debugging leftovers in apps/opt.c
    
    Reviewed-by: Stephen Henson &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">steve at openssl.org</A>&gt;
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configure                     |  42 +---
 apps/openssl.c                |  10 -
 apps/opt.c                    |  89 ---------
 crypto/aes/asm/aes-mips.pl    |   4 -
 crypto/bn/asm/sparcv8plus.S   |   4 -
 crypto/bn/bn_lcl.h            |   8 -
 crypto/des/asm/des_enc.m4     |   4 -
 crypto/err/err_all.c          |   9 -
 crypto/evp/evp_cnf.c          |   8 -
 crypto/o_fips.c               |  12 +-
 crypto/o_init.c               |  19 +-
 crypto/rand/md_rand.c         |   4 -
 crypto/rand/rand_lib.c        |   5 -
 crypto/sha/asm/sha1-mips.pl   |   4 -
 crypto/sha/asm/sha512-mips.pl |   4 -
 crypto/sparccpuid.S           |   4 -
 doc/man5/config.pod           |  13 +-
 include/openssl/opensslv.h    |   6 +-
 ssl/record/ssl3_record.c      |   7 -
 ssl/s3_cbc.c                  |  48 -----
 ssl/ssl_ciph.c                |   8 +-
 ssl/ssl_lib.c                 |   5 -
 ssl/ssl_locl.h                |   4 -
 ssl/statem/statem_lib.c       |   4 +-
 test/ssltest_old.c            |  19 --
 util/fipslink.pl              | 115 -----------
 util/incore                   | 454 ------------------------------------------
 27 files changed, 12 insertions(+), 901 deletions(-)
 delete mode 100644 util/fipslink.pl
 delete mode 100755 util/incore

diff --git a/Configure b/Configure
index 4404963..86f68c7 100755
--- a/Configure
+++ b/Configure
@@ -302,12 +302,8 @@ $config{openssldir}=&quot;&quot;;
 $config{processor}=&quot;&quot;;
 $config{libdir}=&quot;&quot;;
 $config{cross_compile_prefix}=&quot;&quot;;
-$config{fipslibdir}=&quot;/usr/local/ssl/fips-2.0/lib/&quot;;
-my $nofipscanistercheck=0;
-$config{baseaddr}=&quot;0xFB00000&quot;;
 my $auto_threads=1;    # enable threads automatically? true by default
 my $default_ranlib;
-$config{fips}=0;
 
 # Top level directories to build
 $config{dirs} = [ &quot;crypto&quot;, &quot;ssl&quot;, &quot;engines&quot;, &quot;apps&quot;, &quot;test&quot;, &quot;util&quot;, &quot;tools&quot;, &quot;fuzz&quot; ];
@@ -685,7 +681,7 @@ while (@argvcopy)
 		{ $config{processor}=386; }
 	elsif (/^fips$/)
 		{
-		$config{fips}=1;
+		die &quot;FIPS mode not supported\n&quot;;
 		}
 	elsif (/^rsaref$/)
 		{
@@ -695,8 +691,7 @@ while (@argvcopy)
 		}
 	elsif (/^nofipscanistercheck$/)
 		{
-		$config{fips} = 1;
-		$nofipscanistercheck = 1;
+		die &quot;FIPS mode not supported\n&quot;;
 		}
 	elsif (/^[-+]/)
 		{
@@ -734,14 +729,6 @@ while (@argvcopy)
 			{
 			$withargs{fuzzer_include}=$1;
 			}
-		elsif (/^--with-fipslibdir=(.*)$/)
-			{
-			$config{fipslibdir}=&quot;$1/&quot;;
-			}
-		elsif (/^--with-baseaddr=(.*)$/)
-			{
-			$config{baseaddr}=&quot;$1&quot;;
-			}
 		elsif (/^--cross-compile-prefix=(.*)$/)
 			{
 			$config{cross_compile_prefix}=$1;
@@ -821,15 +808,6 @@ if ($libs =~ /(^|\s)-Wl,-rpath,/
 	&quot;***** any of asan, msan or ubsan\n&quot;;
 }
 
-if ($config{fips})
-	{
-	delete $disabled{&quot;shared&quot;} if ($disabled{&quot;shared&quot;} =~ /^default/);
-	}
-else
-	{
-	@{$config{dirs}} = grep !/^fips$/, @{$config{dirs}};
-	}
-
 my @tocheckfor = (keys %disabled);
 while (@tocheckfor) {
     my %new_tocheckfor = ();
@@ -1058,15 +1036,6 @@ if (!$disabled{dso} &amp;&amp; $target{dso_scheme} ne &quot;&quot;)
 
 $config{ex_libs}=&quot;$libs$config{ex_libs}&quot; if ($libs ne &quot;&quot;);
 
-if ($disabled{asm})
-	{
-	if ($config{fips})
-		{
-		@{$config{defines}} = grep !/^[BL]_ENDIAN$/, @{$config{defines}};
-		@{$target{defines}} = grep !/^[BL]_ENDIAN$/, @{$target{defines}};
-		}
-	}
-
 # If threads aren't disabled, check how possible they are
 unless ($disabled{threads}) {
     if ($auto_threads) {
@@ -1107,8 +1076,7 @@ if (defined($disabled{&quot;deprecated&quot;})) {
 if ($target{shared_target} eq &quot;&quot;)
 	{
 	$no_shared_warn = 1
-	    if ((!$disabled{shared} || !$disabled{&quot;dynamic-engine&quot;})
-		&amp;&amp; !$config{fips});
+	    if (!$disabled{shared} || !$disabled{&quot;dynamic-engine&quot;});
 	$disabled{shared} = &quot;no-shared-target&quot;;
 	$disabled{pic} = $disabled{shared} = $disabled{&quot;dynamic-engine&quot;} =
 	    &quot;no-shared-target&quot;;
@@ -1172,10 +1140,6 @@ unless ($disabled{asm}) {
     push @{$config{defines}}, &quot;OPENSSL_BN_ASM_MONT5&quot; if ($target{bn_asm_src} =~ /-mont5/);
     push @{$config{defines}}, &quot;OPENSSL_BN_ASM_GF2m&quot; if ($target{bn_asm_src} =~ /-gf2m/);
 
-    if ($config{fips}) {
-	push @{$config{openssl_other_defines}}, &quot;OPENSSL_FIPS&quot;;
-    }
-
     if ($target{sha1_asm_src}) {
 	push @{$config{defines}}, &quot;SHA1_ASM&quot;   if ($target{sha1_asm_src} =~ /sx86/ || $target{sha1_asm_src} =~ /sha1/);
 	push @{$config{defines}}, &quot;SHA256_ASM&quot; if ($target{sha1_asm_src} =~ /sha256/);
diff --git a/apps/openssl.c b/apps/openssl.c
index bb776eb..e42ee1e 100644
--- a/apps/openssl.c
+++ b/apps/openssl.c
@@ -21,9 +21,6 @@
 # include &lt;openssl/engine.h&gt;
 #endif
 #include &lt;openssl/err.h&gt;
-#ifdef OPENSSL_FIPS
-# include &lt;openssl/fips.h&gt;
-#endif
 #define USE_SOCKETS /* needed for the _O_BINARY defs in the MS world */
 #include &quot;s_apps.h&quot;
 /* Needed to get the other O_xxx flags. */
@@ -143,15 +140,8 @@ int main(int argc, char *argv[])
     CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_ON);
 
     if (getenv(&quot;OPENSSL_FIPS&quot;)) {
-#ifdef OPENSSL_FIPS
-        if (!FIPS_mode_set(1)) {
-            ERR_print_errors(bio_err);
-            return 1;
-        }
-#else
         BIO_printf(bio_err, &quot;FIPS mode not supported.\n&quot;);
         return 1;
-#endif
     }
 
     if (!apps_startup())
diff --git a/apps/opt.c b/apps/opt.c
index f72ac64..499a0b5 100644
--- a/apps/opt.c
+++ b/apps/opt.c
@@ -6,8 +6,6 @@
  * in the file LICENSE in the source distribution or at
  * <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
  */
-
-/* #define COMPILE_STANDALONE_TEST_DRIVER  */
 #include &quot;apps.h&quot;
 #include &lt;string.h&gt;
 #if !defined(OPENSSL_SYS_MSDOS)
@@ -888,90 +886,3 @@ void opt_help(const OPTIONS *list)
         BIO_printf(bio_err, &quot;%s  %s\n&quot;, start, help);
     }
 }
-
-#ifdef COMPILE_STANDALONE_TEST_DRIVER
-# include &lt;sys/stat.h&gt;
-
-typedef enum OPTION_choice {
-    OPT_ERR = -1, OPT_EOF = 0, OPT_HELP,
-    OPT_IN, OPT_INFORM, OPT_OUT, OPT_COUNT, OPT_U, OPT_FLAG,
-    OPT_STR, OPT_NOTUSED
-} OPTION_CHOICE;
-
-static OPTIONS options[] = {
-    {OPT_HELP_STR, 1, '-', &quot;Usage: %s flags\n&quot;},
-    {OPT_HELP_STR, 1, '-', &quot;Valid options are:\n&quot;},
-    {&quot;help&quot;, OPT_HELP, '-', &quot;Display this summary&quot;},
-    {&quot;in&quot;, OPT_IN, '&lt;', &quot;input file&quot;},
-    {OPT_MORE_STR, 1, '-', &quot;more detail about input&quot;},
-    {&quot;inform&quot;, OPT_INFORM, 'f', &quot;input file format; defaults to pem&quot;},
-    {&quot;out&quot;, OPT_OUT, '&gt;', &quot;output file&quot;},
-    {&quot;count&quot;, OPT_COUNT, 'p', &quot;a counter greater than zero&quot;},
-    {&quot;u&quot;, OPT_U, 'u', &quot;an unsigned number&quot;},
-    {&quot;flag&quot;, OPT_FLAG, 0, &quot;just some flag&quot;},
-    {&quot;str&quot;, OPT_STR, 's', &quot;the magic word&quot;},
-    {&quot;areallyverylongoption&quot;, OPT_HELP, '-', &quot;long way for help&quot;},
-    {NULL}
-};
-
-BIO *bio_err;
-
-int app_isdir(const char *name)
-{
-    struct stat sb;
-
-    return name != NULL &amp;&amp; stat(name, &amp;sb) &gt;= 0 &amp;&amp; S_ISDIR(sb.st_mode);
-}
-
-int main(int ac, char **av)
-{
-    OPTION_CHOICE o;
-    char **rest;
-    char *prog;
-
-    bio_err = BIO_new_fp(stderr, BIO_NOCLOSE | BIO_FP_TEXT);
-
-    prog = opt_init(ac, av, options);
-    while ((o = opt_next()) != OPT_EOF) {
-        switch (c) {
-        case OPT_NOTUSED:
-        case OPT_EOF:
-        case OPT_ERR:
-            printf(&quot;%s: Usage error; try -help.\n&quot;, prog);
-            return 1;
-        case OPT_HELP:
-            opt_help(options);
-            return 0;
-        case OPT_IN:
-            printf(&quot;in %s\n&quot;, opt_arg());
-            break;
-        case OPT_INFORM:
-            printf(&quot;inform %s\n&quot;, opt_arg());
-            break;
-        case OPT_OUT:
-            printf(&quot;out %s\n&quot;, opt_arg());
-            break;
-        case OPT_COUNT:
-            printf(&quot;count %s\n&quot;, opt_arg());
-            break;
-        case OPT_U:
-            printf(&quot;u %s\n&quot;, opt_arg());
-            break;
-        case OPT_FLAG:
-            printf(&quot;flag\n&quot;);
-            break;
-        case OPT_STR:
-            printf(&quot;str %s\n&quot;, opt_arg());
-            break;
-        }
-    }
-    argc = opt_num_rest();
-    argv = opt_rest();
-
-    printf(&quot;args = %d\n&quot;, argc);
-    if (argc)
-        while (*argv)
-            printf(&quot;  %s\n&quot;, *argv++);
-    return 0;
-}
-#endif
diff --git a/crypto/aes/asm/aes-mips.pl b/crypto/aes/asm/aes-mips.pl
index 0eb1474..ba3e454 100644
--- a/crypto/aes/asm/aes-mips.pl
+++ b/crypto/aes/asm/aes-mips.pl
@@ -105,10 +105,6 @@ $code.=&lt;&lt;___;
 #include &quot;mips_arch.h&quot;
 
 .text
-#ifdef OPENSSL_FIPSCANISTER
-# include &lt;openssl/fipssyms.h&gt;
-#endif
-
 #if !defined(__mips_eabi) &amp;&amp; (!defined(__vxworks) || defined(__pic__))
 .option	pic2
 #endif
diff --git a/crypto/bn/asm/sparcv8plus.S b/crypto/bn/asm/sparcv8plus.S
index 714a136..f3c611a 100644
--- a/crypto/bn/asm/sparcv8plus.S
+++ b/crypto/bn/asm/sparcv8plus.S
@@ -144,10 +144,6 @@
  *	    }
  */
 
-#ifdef OPENSSL_FIPSCANISTER
-#include &lt;openssl/fipssyms.h&gt;
-#endif
-
 #if defined(__SUNPRO_C) &amp;&amp; defined(__sparcv9)
   /* They've said -xarch=v9 at command line */
   .register	%g2,#scratch
diff --git a/crypto/bn/bn_lcl.h b/crypto/bn/bn_lcl.h
index 5fb3814..eba8dd9 100644
--- a/crypto/bn/bn_lcl.h
+++ b/crypto/bn/bn_lcl.h
@@ -147,11 +147,6 @@ extern &quot;C&quot; {
 # ifdef BN_DEBUG
 
 #  ifdef BN_DEBUG_RAND
-/* To avoid &quot;make update&quot; cvs wars due to BN_DEBUG, use some tricks */
-#   ifndef RAND_bytes
-int RAND_bytes(unsigned char *buf, int num);
-#    define BN_DEBUG_TRIX
-#   endif
 #   define bn_pollute(a) \
         do { \
             const BIGNUM *_bnum1 = (a); \
@@ -167,9 +162,6 @@ int RAND_bytes(unsigned char *buf, int num);
                        sizeof(*_not_const) * (_bnum1-&gt;dmax - _bnum1-&gt;top)); \
             } \
         } while(0)
-#   ifdef BN_DEBUG_TRIX
-#    undef RAND_bytes
-#   endif
 #  else
 #   define bn_pollute(a)
 #  endif
diff --git a/crypto/des/asm/des_enc.m4 b/crypto/des/asm/des_enc.m4
index 2d794d3..c1f6391 100644
--- a/crypto/des/asm/des_enc.m4
+++ b/crypto/des/asm/des_enc.m4
@@ -31,10 +31,6 @@
 
 #include &lt;openssl/opensslconf.h&gt;
 
-#ifdef OPENSSL_FIPSCANISTER
-#include &lt;openssl/fipssyms.h&gt;
-#endif
-
 #if defined(__SUNPRO_C) &amp;&amp; defined(__sparcv9)
 # define ABI64  /* They've said -xarch=v9 at command line */
 #elif defined(__GNUC__) &amp;&amp; defined(__arch64__)
diff --git a/crypto/err/err_all.c b/crypto/err/err_all.c
index 3b1304f..6cc8c8f 100644
--- a/crypto/err/err_all.c
+++ b/crypto/err/err_all.c
@@ -31,9 +31,6 @@
 #include &lt;openssl/ui.h&gt;
 #include &lt;openssl/ocsp.h&gt;
 #include &lt;openssl/err.h&gt;
-#ifdef OPENSSL_FIPS
-# include &lt;openssl/fips.h&gt;
-#endif
 #include &lt;openssl/ts.h&gt;
 #include &lt;openssl/cms.h&gt;
 #include &lt;openssl/ct.h&gt;
@@ -43,9 +40,6 @@
 int err_load_crypto_strings_int(void)
 {
     if (
-#ifdef OPENSSL_FIPS
-        FIPS_set_error_callbacks(ERR_put_error, ERR_add_error_vdata) == 0 ||
-#endif
 #ifndef OPENSSL_NO_ERR
         ERR_load_ERR_strings() == 0 ||    /* include error strings for SYSerr */
         ERR_load_BN_strings() == 0 ||
@@ -91,9 +85,6 @@ int err_load_crypto_strings_int(void)
 #ifndef OPENSSL_NO_UI
         ERR_load_UI_strings() == 0 ||
 #endif
-# ifdef OPENSSL_FIPS
-        ERR_load_FIPS_strings() == 0 ||
-# endif
 # ifndef OPENSSL_NO_CMS
         ERR_load_CMS_strings() == 0 ||
 # endif
diff --git a/crypto/evp/evp_cnf.c b/crypto/evp/evp_cnf.c
index 71d13b8..d0d61b2 100644
--- a/crypto/evp/evp_cnf.c
+++ b/crypto/evp/evp_cnf.c
@@ -38,16 +38,8 @@ static int alg_module_init(CONF_IMODULE *md, const CONF *cnf)
                 return 0;
             }
             if (m &gt; 0) {
-#ifdef OPENSSL_FIPS
-                if (!FIPS_mode() &amp;&amp; !FIPS_mode_set(1)) {
-                    EVPerr(EVP_F_ALG_MODULE_INIT,
-                           EVP_R_ERROR_SETTING_FIPS_MODE);
-                    return 0;
-                }
-#else
                 EVPerr(EVP_F_ALG_MODULE_INIT, EVP_R_FIPS_MODE_NOT_SUPPORTED);
                 return 0;
-#endif
             }
         } else {
             EVPerr(EVP_F_ALG_MODULE_INIT, EVP_R_UNKNOWN_OPTION);
diff --git a/crypto/o_fips.c b/crypto/o_fips.c
index bf6db65..050ea9c 100644
--- a/crypto/o_fips.c
+++ b/crypto/o_fips.c
@@ -8,27 +8,17 @@
  */
 
 #include &quot;internal/cryptlib.h&quot;
-#ifdef OPENSSL_FIPS
-# include &lt;openssl/fips.h&gt;
-#endif
 
 int FIPS_mode(void)
 {
-#ifdef OPENSSL_FIPS
-    return FIPS_module_mode();
-#else
+    /* This version of the library does not support FIPS mode. */
     return 0;
-#endif
 }
 
 int FIPS_mode_set(int r)
 {
-#ifdef OPENSSL_FIPS
-    return FIPS_module_mode_set(r);
-#else
     if (r == 0)
         return 1;
     CRYPTOerr(CRYPTO_F_FIPS_MODE_SET, CRYPTO_R_FIPS_MODE_NOT_SUPPORTED);
     return 0;
-#endif
 }
diff --git a/crypto/o_init.c b/crypto/o_init.c
index 2e0c126..5eb7654 100644
--- a/crypto/o_init.c
+++ b/crypto/o_init.c
@@ -9,26 +9,13 @@
 
 #include &lt;e_os.h&gt;
 #include &lt;openssl/err.h&gt;
-#ifdef OPENSSL_FIPS
-# include &lt;openssl/fips.h&gt;
-# include &lt;openssl/rand.h&gt;
-#endif
 
 /*
- * Perform any essential OpenSSL initialization operations. Currently only
- * sets FIPS callbacks
+ * Perform any essential OpenSSL initialization operations. Currently does
+ * nothing.
  */
 
 void OPENSSL_init(void)
 {
-    static int done = 0;
-    if (done)
-        return;
-    done = 1;
-#ifdef OPENSSL_FIPS
-    FIPS_set_locking_callbacks(CRYPTO_lock, CRYPTO_add_lock);
-    FIPS_set_error_callbacks(ERR_put_error, ERR_add_error_vdata);
-    FIPS_set_malloc_callbacks(CRYPTO_malloc, CRYPTO_free);
-    RAND_init_fips();
-#endif
+    return;
 }
diff --git a/crypto/rand/md_rand.c b/crypto/rand/md_rand.c
index 78da14a..8cbfae1 100644
--- a/crypto/rand/md_rand.c
+++ b/crypto/rand/md_rand.c
@@ -29,10 +29,6 @@
 
 #include &lt;internal/thread_once.h&gt;
 
-#ifdef OPENSSL_FIPS
-# include &lt;openssl/fips.h&gt;
-#endif
-
 #if defined(BN_DEBUG) || defined(FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION)
 # define PREDICT
 #endif
diff --git a/crypto/rand/rand_lib.c b/crypto/rand/rand_lib.c
index 2387126..fc47dc9 100644
--- a/crypto/rand/rand_lib.c
+++ b/crypto/rand/rand_lib.c
@@ -15,11 +15,6 @@
 
 #include &lt;openssl/engine.h&gt;
 
-#ifdef OPENSSL_FIPS
-# include &lt;openssl/fips.h&gt;
-# include &lt;openssl/fips_rand.h&gt;
-#endif
-
 #ifndef OPENSSL_NO_ENGINE
 /* non-NULL if default_RAND_meth is ENGINE-provided */
 static ENGINE *funct_ref = NULL;
diff --git a/crypto/sha/asm/sha1-mips.pl b/crypto/sha/asm/sha1-mips.pl
index d9911c8..ab29240 100644
--- a/crypto/sha/asm/sha1-mips.pl
+++ b/crypto/sha/asm/sha1-mips.pl
@@ -342,10 +342,6 @@ $SAVED_REGS_MASK = ($flavour =~ /nubi/i) ? &quot;0xc0fff008&quot; : &quot;0xc0ff0000&quot;;
 $code=&lt;&lt;___;
 #include &quot;mips_arch.h&quot;
 
-#ifdef OPENSSL_FIPSCANISTER
-# include &lt;openssl/fipssyms.h&gt;
-#endif
-
 .text
 
 .set	noat
diff --git a/crypto/sha/asm/sha512-mips.pl b/crypto/sha/asm/sha512-mips.pl
index 5464543..e6fd268 100644
--- a/crypto/sha/asm/sha512-mips.pl
+++ b/crypto/sha/asm/sha512-mips.pl
@@ -304,10 +304,6 @@ $SAVED_REGS_MASK = ($flavour =~ /nubi/i) ? &quot;0xc0fff008&quot; : &quot;0xc0ff0000&quot;;
 $code.=&lt;&lt;___;
 #include &quot;mips_arch.h&quot;
 
-#ifdef OPENSSL_FIPSCANISTER
-# include &lt;openssl/fipssyms.h&gt;
-#endif
-
 .text
 .set	noat
 #if !defined(__mips_eabi) &amp;&amp; (!defined(__vxworks) || defined(__pic__))
diff --git a/crypto/sparccpuid.S b/crypto/sparccpuid.S
index c6ca224..95acd2f 100644
--- a/crypto/sparccpuid.S
+++ b/crypto/sparccpuid.S
@@ -5,10 +5,6 @@
 ! in the file LICENSE in the source distribution or at
 ! <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
 
-#ifdef OPENSSL_FIPSCANISTER
-#include &lt;openssl/fipssyms.h&gt;
-#endif
-
 #if defined(__SUNPRO_C) &amp;&amp; defined(__sparcv9)
 # define ABI64  /* They've said -xarch=v9 at command line */
 #elif defined(__GNUC__) &amp;&amp; defined(__arch64__)
diff --git a/doc/man5/config.pod b/doc/man5/config.pod
index 9df0ecb..24ebafb 100644
--- a/doc/man5/config.pod
+++ b/doc/man5/config.pod
@@ -193,17 +193,8 @@ This modules has the name B&lt;alg_section&gt; which points to a section containing
 algorithm commands.
 
 Currently the only algorithm command supported is B&lt;fips_mode&gt; whose
-value should be a boolean string such as B&lt;on&gt; or B&lt;off&gt;. If the value is
-B&lt;on&gt; this attempt to enter FIPS mode. If the call fails or the library is
-not FIPS capable then an error occurs.
-
-For example:
-
- alg_section = evp_settings
-
- [evp_settings]
-
- fips_mode = on
+value can only be the boolean string B&lt;off&gt;. If B&lt;fips_mode&gt; is set to B&lt;on&gt;,
+an error occurs as this library version is not FIPS capable.
 
 =head2 SSL Configuration Module
 
diff --git a/include/openssl/opensslv.h b/include/openssl/opensslv.h
index df6e045..c6e15a5 100644
--- a/include/openssl/opensslv.h
+++ b/include/openssl/opensslv.h
@@ -40,11 +40,7 @@ extern &quot;C&quot; {
  *  major minor fix final patch/beta)
  */
 # define OPENSSL_VERSION_NUMBER  0x10101000L
-# ifdef OPENSSL_FIPS
-#  define OPENSSL_VERSION_TEXT    &quot;OpenSSL 1.1.1-fips-dev  xx XXX xxxx&quot;
-# else
-#  define OPENSSL_VERSION_TEXT    &quot;OpenSSL 1.1.1-dev  xx XXX xxxx&quot;
-# endif
+# define OPENSSL_VERSION_TEXT    &quot;OpenSSL 1.1.1-dev  xx XXX xxxx&quot;
 
 /*-
  * The macros below are to be used for shared library (.so, .dll, ...)
diff --git a/ssl/record/ssl3_record.c b/ssl/record/ssl3_record.c
index df7d012..84f54cb 100644
--- a/ssl/record/ssl3_record.c
+++ b/ssl/record/ssl3_record.c
@@ -1119,13 +1119,6 @@ int tls1_mac(SSL *ssl, SSL3_RECORD *rec, unsigned char *md, int send)
             EVP_MD_CTX_free(hmac);
             return 0;
         }
-        if (!send &amp;&amp; !SSL_READ_ETM(ssl) &amp;&amp; FIPS_mode())
-            if (!tls_fips_digest_extra(ssl-&gt;enc_read_ctx,
-                                       mac_ctx, rec-&gt;input,
-                                       rec-&gt;length, rec-&gt;orig_len)) {
-                EVP_MD_CTX_free(hmac);
-                return 0;
-            }
     }
 
     EVP_MD_CTX_free(hmac);
diff --git a/ssl/s3_cbc.c b/ssl/s3_cbc.c
index 3a75745..186ab17 100644
--- a/ssl/s3_cbc.c
+++ b/ssl/s3_cbc.c
@@ -89,8 +89,6 @@ static void tls1_sha512_final_raw(void *ctx, unsigned char *md_out)
  */
 char ssl3_cbc_record_digest_supported(const EVP_MD_CTX *ctx)
 {
-    if (FIPS_mode())
-        return 0;
     switch (EVP_MD_CTX_type(ctx)) {
     case NID_md5:
     case NID_sha1:
@@ -483,49 +481,3 @@ int ssl3_cbc_digest_record(const EVP_MD_CTX *ctx,
     EVP_MD_CTX_free(md_ctx);
     return 0;
 }
-
-/*
- * Due to the need to use EVP in FIPS mode we can't reimplement digests but
- * we can ensure the number of blocks processed is equal for all cases by
- * digesting additional data.
- */
-
-int tls_fips_digest_extra(const EVP_CIPHER_CTX *cipher_ctx,
-                          EVP_MD_CTX *mac_ctx, const unsigned char *data,
-                          size_t data_len, size_t orig_len)
-{
-    size_t block_size, digest_pad, blocks_data, blocks_orig;
-    if (EVP_CIPHER_CTX_mode(cipher_ctx) != EVP_CIPH_CBC_MODE)
-        return 1;
-    block_size = EVP_MD_CTX_block_size(mac_ctx);
-    /*-
-     * We are in FIPS mode if we get this far so we know we have only SHA*
-     * digests and TLS to deal with.
-     * Minimum digest padding length is 17 for SHA384/SHA512 and 9
-     * otherwise.
-     * Additional header is 13 bytes. To get the number of digest blocks
-     * processed round up the amount of data plus padding to the nearest
-     * block length. Block length is 128 for SHA384/SHA512 and 64 otherwise.
-     * So we have:
-     * blocks = (payload_len + digest_pad + 13 + block_size - 1)/block_size
-     * equivalently:
-     * blocks = (payload_len + digest_pad + 12)/block_size + 1
-     * HMAC adds a constant overhead.
-     * We're ultimately only interested in differences so this becomes
-     * blocks = (payload_len + 29)/128
-     * for SHA384/SHA512 and
-     * blocks = (payload_len + 21)/64
-     * otherwise.
-     */
-    digest_pad = block_size == 64 ? 21 : 29;
-    blocks_orig = (orig_len + digest_pad) / block_size;
-    blocks_data = (data_len + digest_pad) / block_size;
-    /*
-     * MAC enough blocks to make up the difference between the original and
-     * actual lengths plus one extra block to ensure this is never a no op.
-     * The &quot;data&quot; pointer should always have enough space to perform this
-     * operation as it is large enough for a maximum length TLS buffer.
-     */
-    return EVP_DigestSignUpdate(mac_ctx, data,
-                                (blocks_orig - blocks_data + 1) * block_size);
-}
diff --git a/ssl/ssl_ciph.c b/ssl/ssl_ciph.c
index e64e3da..0b60deb 100644
--- a/ssl/ssl_ciph.c
+++ b/ssl/ssl_ciph.c
@@ -577,9 +577,6 @@ int ssl_cipher_get_evp(const SSL_SESSION *s, const EVP_CIPHER **enc,
             s-&gt;ssl_version &lt; TLS1_VERSION)
             return 1;
 
-        if (FIPS_mode())
-            return 1;
-
         if (c-&gt;algorithm_enc == SSL_RC4 &amp;&amp;
             c-&gt;algorithm_mac == SSL_MD5 &amp;&amp;
             (evp = EVP_get_cipherbyname(&quot;RC4-HMAC-MD5&quot;)))
@@ -687,8 +684,6 @@ static void ssl_cipher_collect_ciphers(const SSL_METHOD *ssl_method,
         /* drop those that use any of that is not available */
         if (c == NULL || !c-&gt;valid)
             continue;
-        if (FIPS_mode() &amp;&amp; (c-&gt;algo_strength &amp; SSL_FIPS))
-            continue;
         if ((c-&gt;algorithm_mkey &amp; disabled_mkey) ||
             (c-&gt;algorithm_auth &amp; disabled_auth) ||
             (c-&gt;algorithm_enc &amp; disabled_enc) ||
@@ -1495,8 +1490,7 @@ STACK_OF(SSL_CIPHER) *ssl_create_cipher_list(const SSL_METHOD *ssl_method, STACK
      * to the resulting precedence to the STACK_OF(SSL_CIPHER).
      */
     for (curr = head; curr != NULL; curr = curr-&gt;next) {
-        if (curr-&gt;active
-            &amp;&amp; (!FIPS_mode() || curr-&gt;cipher-&gt;algo_strength &amp; SSL_FIPS)) {
+        if (curr-&gt;active) {
             if (!sk_SSL_CIPHER_push(cipherstack, curr-&gt;cipher)) {
                 OPENSSL_free(co_list);
                 sk_SSL_CIPHER_free(cipherstack);
diff --git a/ssl/ssl_lib.c b/ssl/ssl_lib.c
index 9382c2e..39254f1 100644
--- a/ssl/ssl_lib.c
+++ b/ssl/ssl_lib.c
@@ -2504,11 +2504,6 @@ SSL_CTX *SSL_CTX_new(const SSL_METHOD *meth)
     if (!OPENSSL_init_ssl(OPENSSL_INIT_LOAD_SSL_STRINGS, NULL))
         return NULL;
 
-    if (FIPS_mode() &amp;&amp; (meth-&gt;version &lt; TLS1_VERSION)) {
-        SSLerr(SSL_F_SSL_CTX_NEW, SSL_R_AT_LEAST_TLS_1_0_NEEDED_IN_FIPS_MODE);
-        return NULL;
-    }
-
     if (SSL_get_ex_data_X509_STORE_CTX_idx() &lt; 0) {
         SSLerr(SSL_F_SSL_CTX_NEW, SSL_R_X509_VERIFICATION_SETUP_PROBLEMS);
         goto err;
diff --git a/ssl/ssl_locl.h b/ssl/ssl_locl.h
index ac8c826..565fa36 100644
--- a/ssl/ssl_locl.h
+++ b/ssl/ssl_locl.h
@@ -2358,10 +2358,6 @@ __owur int ssl3_cbc_digest_record(const EVP_MD_CTX *ctx,
                                   const unsigned char *mac_secret,
                                   size_t mac_secret_length, char is_sslv3);
 
-__owur int tls_fips_digest_extra(const EVP_CIPHER_CTX *cipher_ctx,
-                                 EVP_MD_CTX *mac_ctx, const unsigned char *data,
-                                 size_t data_len, size_t orig_len);
-
 __owur int srp_generate_server_master_secret(SSL *s);
 __owur int srp_generate_client_master_secret(SSL *s);
 __owur int srp_verify_server_param(SSL *s, int *al);
diff --git a/ssl/statem/statem_lib.c b/ssl/statem/statem_lib.c
index c871c00..ed1ecce 100644
--- a/ssl/statem/statem_lib.c
+++ b/ssl/statem/statem_lib.c
@@ -1321,8 +1321,6 @@ static int ssl_method_error(const SSL *s, const SSL_METHOD *method)
         return SSL_R_UNSUPPORTED_PROTOCOL;
     if ((method-&gt;flags &amp; SSL_METHOD_NO_SUITEB) != 0 &amp;&amp; tls1_suiteb(s))
         return SSL_R_AT_LEAST_TLS_1_2_NEEDED_IN_SUITEB_MODE;
-    else if ((method-&gt;flags &amp; SSL_METHOD_NO_FIPS) != 0 &amp;&amp; FIPS_mode())
-        return SSL_R_AT_LEAST_TLS_1_0_NEEDED_IN_FIPS_MODE;
 
     return 0;
 }
@@ -1680,7 +1678,7 @@ int ssl_choose_client_version(SSL *s, int version)
  * Work out what version we should be using for the initial ClientHello if the
  * version is initially (D)TLS_ANY_VERSION.  We apply any explicit SSL_OP_NO_xxx
  * options, the MinProtocol and MaxProtocol configuration commands, any Suite B
- * or FIPS_mode() constraints and any floor imposed by the security level here,
+ * constraints and any floor imposed by the security level here,
  * so we don't advertise the wrong protocol version to only reject the outcome later.
  *
  * Computing the right floor matters.  If, e.g., TLS 1.0 and 1.2 are enabled,
diff --git a/test/ssltest_old.c b/test/ssltest_old.c
index 1bfa983..649215d 100644
--- a/test/ssltest_old.c
+++ b/test/ssltest_old.c
@@ -699,9 +699,6 @@ static void sv_usage(void)
 {
     fprintf(stderr, &quot;usage: ssltest [args ...]\n&quot;);
     fprintf(stderr, &quot;\n&quot;);
-#ifdef OPENSSL_FIPS
-    fprintf(stderr, &quot;-F             - run test in FIPS mode\n&quot;);
-#endif
     fprintf(stderr, &quot; -server_auth  - check server certificate\n&quot;);
     fprintf(stderr, &quot; -client_auth  - do client authentication\n&quot;);
     fprintf(stderr, &quot; -v            - more output\n&quot;);
@@ -989,9 +986,6 @@ int main(int argc, char *argv[])
     COMP_METHOD *cm = NULL;
     STACK_OF(SSL_COMP) *ssl_comp_methods = NULL;
 #endif
-#ifdef OPENSSL_FIPS
-    int fips_mode = 0;
-#endif
     int no_protocol;
     int min_version = 0, max_version = 0;
 #ifndef OPENSSL_NO_CT
@@ -1060,13 +1054,9 @@ int main(int argc, char *argv[])
 
     while (argc &gt;= 1) {
         if (strcmp(*argv, &quot;-F&quot;) == 0) {
-#ifdef OPENSSL_FIPS
-            fips_mode = 1;
-#else
             fprintf(stderr,
                     &quot;not compiled with FIPS support, so exiting without running.\n&quot;);
             EXIT(0);
-#endif
         } else if (strcmp(*argv, &quot;-server_auth&quot;) == 0)
             server_auth = 1;
         else if (strcmp(*argv, &quot;-client_auth&quot;) == 0)
@@ -1383,15 +1373,6 @@ int main(int argc, char *argv[])
                 &quot;to avoid protocol mismatch.\n&quot;);
         EXIT(1);
     }
-#ifdef OPENSSL_FIPS
-    if (fips_mode) {
-        if (!FIPS_mode_set(1)) {
-            ERR_print_errors(bio_err);
-            EXIT(1);
-        } else
-            fprintf(stderr, &quot;*** IN FIPS MODE ***\n&quot;);
-    }
-#endif
 
     if (print_time) {
         if (bio_type != BIO_PAIR) {
diff --git a/util/fipslink.pl b/util/fipslink.pl
deleted file mode 100644
index bb685bf..0000000
--- a/util/fipslink.pl
+++ /dev/null
@@ -1,115 +0,0 @@
-#! /usr/bin/env perl
-# Copyright 2011-2016 The OpenSSL Project Authors. All Rights Reserved.
-#
-# Licensed under the OpenSSL license (the &quot;License&quot;).  You may not use
-# this file except in compliance with the License.  You can obtain a copy
-# in the file LICENSE in the source distribution or at
-# <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
-
-sub check_env
-	{
-	my @ret;
-	foreach (@_)
-		{
-		die &quot;Environment variable $_ not defined!\n&quot; unless exists $ENV{$_};
-		push @ret, $ENV{$_};
-		}
-	return @ret;
-	}
-
-
-my ($fips_cc,$fips_cc_args, $fips_link,$fips_target, $fips_libdir, $sha1_exe)
-	 = check_env(&quot;FIPS_CC&quot;, &quot;FIPS_CC_ARGS&quot;, &quot;FIPS_LINK&quot;, &quot;FIPS_TARGET&quot;,
-	 	&quot;FIPSLIB_D&quot;, &quot;FIPS_SHA1_EXE&quot;);
-
-
-
-if (exists $ENV{&quot;PREMAIN_DSO_EXE&quot;})
-	{
-	$fips_premain_dso = $ENV{&quot;PREMAIN_DSO_EXE&quot;};
-	}
-	else
-	{
-	$fips_premain_dso = &quot;&quot;;
-	}
-
-check_hash($sha1_exe, &quot;fips_premain.c&quot;);
-check_hash($sha1_exe, &quot;fipscanister.lib&quot;);
-
-
-print &quot;Integrity check OK\n&quot;;
-
-if (is_premain_linked(@ARGV)) {
-	print &quot;$fips_cc $fips_cc_args $fips_libdir/fips_premain.c\n&quot;;
-	system &quot;$fips_cc $fips_cc_args $fips_libdir/fips_premain.c&quot;;
-	die &quot;First stage Compile failure&quot; if $? != 0;
-} elsif (!defined($ENV{FIPS_SIG})) {
-	die &quot;no fips_premain.obj linked&quot;;
-}
-
-print &quot;$fips_link @ARGV\n&quot;;
-system &quot;$fips_link @ARGV&quot;;
-die &quot;First stage Link failure&quot; if $? != 0;
-
-if (defined($ENV{FIPS_SIG})) {
-	print &quot;$ENV{FIPS_SIG} $fips_target\n&quot;;
-	system &quot;$ENV{FIPS_SIG} $fips_target&quot;;
-	die &quot;$ENV{FIPS_SIG} $fips_target failed&quot; if $? != 0;
-	exit;
-}
-
-print &quot;$fips_premain_dso $fips_target\n&quot;;
-system(&quot;$fips_premain_dso $fips_target &gt;$fips_target.sha1&quot;);
-die &quot;Get hash failure&quot; if $? != 0;
-open my $sha1_res, '&lt;', $fips_target.&quot;.sha1&quot; or die &quot;Get hash failure&quot;;
-$fips_hash=&lt;$sha1_res&gt;;
-close $sha1_res;
-unlink $fips_target.&quot;.sha1&quot;;
-$fips_hash =~ s|\R$||;          # Better chomp
-die &quot;Get hash failure&quot; if $? != 0;
-
-
-print &quot;$fips_cc -DHMAC_SHA1_SIG=\\\&quot;$fips_hash\\\&quot; $fips_cc_args $fips_libdir/fips_premain.c\n&quot;;
-system &quot;$fips_cc -DHMAC_SHA1_SIG=\\\&quot;$fips_hash\\\&quot; $fips_cc_args $fips_libdir/fips_premain.c&quot;;
-die &quot;Second stage Compile failure&quot; if $? != 0;
-
-
-print &quot;$fips_link @ARGV\n&quot;;
-system &quot;$fips_link @ARGV&quot;;
-die &quot;Second stage Link failure&quot; if $? != 0;
-
-sub is_premain_linked
-	{
-	return 1 if (grep /fips_premain\.obj/<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>);
-	foreach (@_)
-		{
-		if (/^@(.*)/ &amp;&amp; -f $1)
-			{
-			open FD,$1 or die &quot;can't open $1&quot;;
-			my $ret = (grep /fips_premain\.obj/,&lt;FD&gt;)?1:0;
-			close FD;
-			return $ret;
-			}
-		}
-	return 0;
-	}
-
-sub check_hash
-	{
-	my ($sha1_exe, $filename) = @_;
-	my ($hashfile, $hashval);
-
-	open(IN, &quot;${fips_libdir}/${filename}.sha1&quot;) || die &quot;Cannot open file hash file ${fips_libdir}/${filename}.sha1&quot;;
-	$hashfile = &lt;IN&gt;;
-	close IN;
-	$hashval = `$sha1_exe ${fips_libdir}/$filename`;
-	$hashfile =~ s|\R$||;    # Better chomp
-	$hashval =~ s|\R$||;     # Better chomp
-	$hashfile =~ s/^.*=\s+//;
-	$hashval =~ s/^.*=\s+//;
-	die &quot;Invalid hash syntax in file&quot; if (length($hashfile) != 40);
-	die &quot;Invalid hash received for file&quot; if (length($hashval) != 40);
-	die &quot;***HASH VALUE MISMATCH FOR FILE $filename ***&quot; if ($hashval ne $hashfile);
-	}
-
-
diff --git a/util/incore b/util/incore
deleted file mode 100755
index 26fcf95..0000000
--- a/util/incore
+++ /dev/null
@@ -1,454 +0,0 @@
-#! /usr/bin/env perl
-# Copyright 2011-2016 The OpenSSL Project Authors. All Rights Reserved.
-#
-# Licensed under the OpenSSL license (the &quot;License&quot;).  You may not use
-# this file except in compliance with the License.  You can obtain a copy
-# in the file LICENSE in the source distribution or at
-# <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
-
-# The script embeds fingerprint into ELF executable object, either
-# application binary or shared library.
-
-######################################################################
-#
-# ELF symbol table parser by &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;. The table entries
-# are extended with offset within executable file...
-#
-{ package ELF;
-  use FileHandle;
-
-    sub dup  { my %copy=map {$_} @_; return \%copy; }
-
-    sub Load {
-	my $class = shift;
-	my $self  = {};
-	my $FD    = FileHandle-&gt;new();	# autoclose
-
-	bless $self,$class;
-
-	sysopen($FD,shift,0) or die &quot;$!&quot;;
-	binmode($FD);
-
-	#################################################
-	# read and parse elf_ehdr.e_ident...
-	#
-	read($FD,my $elf,16) or die &quot;$!&quot;;
-
-	my %e_ident;
-	@e_ident{magic,class,data,version,osabi,abiver,pad}=
-		unpack(&quot;a4C*&quot;,$elf);
-
-	$!=42;		# signal fipsld to revert to two-step link
-	die &quot;not ELF file&quot; if ($e_ident{magic} ne chr(0177).&quot;ELF&quot;);
-
-	my $elf_bits   = $e_ident{class}*32;	# 32 or 64
-	my $big_endian = $e_ident{data}-1;	# 0 or 1
-
-	if ($elf_bits==64) {
-	    if (!(((1&lt;&lt;31)&lt;&lt;1) &amp;&amp; $big_endian==(unpack(&quot;L&quot;,pack(&quot;N&quot;,1))==1))) {
-		die &quot;ELF64 is supported only natively&quot;;
-	    }
-	}
-
-	#################################################
-	# read and parse remainder of elf_ehdr...
-	#
-	read($FD,my $elfhdr,64) or die &quot;$!&quot;;
-
-	my %elf_ehdr;
-	@elf_ehdr{e_type,e_machine,e_version,
-		e_entry,e_phoff,e_shoff,e_flags,e_ehsize,
-		e_phentsize,e_phnum,e_shentsize,e_shnum,e_shstrndx} =
-	$elf_bits==32 ?
-		unpack($big_endian?&quot;nnN5n6&quot;:&quot;vvV5v6&quot;,$elfhdr)
-	:	unpack(&quot;SSLQ3LS6&quot;,$elfhdr);
-
-	# put aside e_machine in case one has to treat specific
-	# platforms differently, see EM_ constants in elf.h for
-	# assortment... 
-	$self-&gt;{e_machine} = $elf_ehdr{e_machine};
-
-	#################################################
-	# read and parse elf_shdr table...
-	#
-	my ($i,$sz,$symtab_idx,$blob,$strings);
-
-	seek($FD,$elf_ehdr{e_shoff},0) or die &quot;$!&quot;;
-	read($FD,$blob,$elf_ehdr{e_shentsize}*$elf_ehdr{e_shnum}) or die &quot;$!&quot;;
-
-	my @sections;
-	my $elf_shdr_struct=($elf_bits==32?($big_endian?&quot;N10&quot;:&quot;V10&quot;):&quot;L2Q4L2Q2&quot;);
-	for ($sz=$elf_ehdr{e_shentsize},$i=0;$i&lt;length($blob);$i+=$sz) {
-	    my %elf_shdr;
-
-	    @elf_shdr{sh_name,sh_type,sh_flags,
-			sh_addr,sh_offset,sh_size,
-			sh_link,sh_info,sh_addalign,sh_entsize} =
-		unpack($elf_shdr_struct,substr($blob,$i,$sz));
-
-	    push(@sections,dup(%elf_shdr));
-
-	    # note SHT_SYMTAB or SHT_DYNSYM for future reference
-	    if ($elf_shdr{sh_type}==2 || $elf_shdr{sh_type}==11) {
-		$symtab_idx = $#sections;
-	    }
-	}
-
-	# read strings table and map section names...
-	seek($<A HREF="../../../mailman/listinfo/openssl-commits.html">FD, at sections</A>[$elf_ehdr{e_shstrndx}]-&gt;{sh_offset},0)	or die &quot;$!&quot;;
-	read($FD,$<A HREF="../../../mailman/listinfo/openssl-commits.html">strings, at sections</A>[$elf_ehdr{e_shstrndx}]-&gt;{sh_size})	or die &quot;$!&quot;;
-	for (@sections) {
-	    $_-&gt;{sh_name}=(split(chr(0),substr($strings,$_-&gt;{sh_name},64)))[0];
-	}
-
-	#################################################
-	# read symbol strings table...
-	#
-	$i=@sections[$symtab_idx]-&gt;{sh_link};
-	seek($<A HREF="../../../mailman/listinfo/openssl-commits.html">FD, at sections</A>[$i]-&gt;{sh_offset},0)		or die &quot;$!&quot;;
-	read($FD,$<A HREF="../../../mailman/listinfo/openssl-commits.html">strings, at sections</A>[$i]-&gt;{sh_size})	or die &quot;$!&quot;;
-
-	#################################################
-	# read and parse elf_sym table...
-	#
-	seek($<A HREF="../../../mailman/listinfo/openssl-commits.html">FD, at sections</A>[$symtab_idx]-&gt;{sh_offset},0)		or die &quot;$!&quot;;
-	read($FD,my $<A HREF="../../../mailman/listinfo/openssl-commits.html">blob, at sections</A>[$symtab_idx]-&gt;{sh_size})	or die &quot;$!&quot;;
-
-	for ($sz=@sections[$symtab_idx]-&gt;{sh_entsize},$i=0;$i&lt;length($blob);$i+=$sz) {
-	    my %elf_sym;
-
-	    if ($elf_bits==32) {
-		@elf_sym{st_name,st_value,st_size,st_info,st_other,st_shndx} =
-			unpack($big_endian?&quot;N3CCn&quot;:&quot;V3CCv&quot;,substr($blob,$i,$sz));
-	    } else {
-		@elf_sym{st_name,st_info,st_other,st_shndx,st_value,st_size} =
-			unpack(&quot;LCCSQQ&quot;,substr($blob,$i,$sz));
-	    }
-
-	    my $st_type = $elf_sym{st_info}&amp;0xf;
-	    my $st_bind = $elf_sym{st_info}&gt;&gt;4;
-	    my $st_secn = $elf_sym{st_shndx};
-	    my $name;
-	    #                 (STT_OBJECT  || STT_FUNC)
-	    if ($st_bind&lt;3 &amp;&amp; ($st_type==1 || $st_type==2)
-	    	&amp;&amp; $st_secn &lt;= $#sections 		# sane st_shndx
-		&amp;&amp; @sections[$st_secn]-&gt;{sh_type}	# not SHN_UNDEF
-		&amp;&amp; ($name=(split(chr(0),substr($strings,$elf_sym{st_name},128)))[0])
-		) {
-		# synthesize st_offset, ...
-	    	$elf_sym{st_offset}  = $elf_sym{st_value}
-				- @sections[$st_secn]-&gt;{sh_addr}
-				+ @sections[$st_secn]-&gt;{sh_offset};
-		$elf_sym{st_name}    = $name;
-		$elf_sym{st_section} = @sections[$st_secn]-&gt;{sh_name};
-		# ... and add to lookup table
-		$self-&gt;{symbols}{$name} = dup(%elf_sym);
-	    }
-	}
-
-	return $self;
-    }
-
-    sub Lookup {
-	my $self = shift;
-	my $name = shift;
-	return $self-&gt;{symbols}{$name};
-    }
-
-    sub Traverse {
-	my $self = shift;
-	my $code = shift;
-
-	if (ref($code) eq 'CODE') {
-	    for (keys(%{$self-&gt;{symbols}})) { &amp;$code($self-&gt;{symbols}{$_}); }
-	}
-    }
-}
-
-######################################################################
-#
-# SHA1 and HMAC in Perl by &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">appro at openssl.org</A>&gt;.
-#
-{ package SHA1;
-  use integer;
-
-    {
-    ################################### SHA1 block code generator
-    my @V = ('$A','$B','$C','$D','$E');
-    my $i;
-
-    sub XUpdate {
-      my $ret;
-	$ret=&quot;(\$T=\$W[($i-16)%16]^\$W[($i-14)%16]^\$W[($i-8)%16]^\$W[($i-3)%16],\n\t&quot;;
-	if ((1&lt;&lt;31)&lt;&lt;1) {
-	    $ret.=&quot;    \$W[$i%16]=((\$T&lt;&lt;1)|(\$T&gt;&gt;31))&amp;0xffffffff)\n\t  &quot;;
-	} else {
-	    $ret.=&quot;    \$W[$i%16]=(\$T&lt;&lt;1)|((\$T&gt;&gt;31)&amp;1))\n\t  &quot;;
-	}
-    }
-    sub tail {
-      my ($a,$b,$c,$d,$e)=@V;
-      my $ret;
-	if ((1&lt;&lt;31)&lt;&lt;1) {
-	    $ret.=&quot;(($a&lt;&lt;5)|($a&gt;&gt;27));\n\t&quot;;
-	    $ret.=&quot;$b=($b&lt;&lt;30)|($b&gt;&gt;2);	$e&amp;=0xffffffff;	#$b&amp;=0xffffffff;\n\t&quot;;
-	} else {
-	    $ret.=&quot;(($a&lt;&lt;5)|($a&gt;&gt;27)&amp;0x1f);\n\t&quot;;
-	    $ret.=&quot;$b=($b&lt;&lt;30)|($b&gt;&gt;2)&amp;0x3fffffff;\n\t&quot;;
-	}
-      $ret;
-    }
-    sub BODY_00_15 {
-	my ($a,$b,$c,$d,$e)=@V;
-	&quot;$e+=\$W[$i]+0x5a827999+((($c^$d)&amp;$b)^$d)+&quot;.tail();
-    }
-    sub BODY_16_19 {
-	my ($a,$b,$c,$d,$e)=@V;
-	&quot;$e+=&quot;.XUpdate().&quot;+0x5a827999+((($c^$d)&amp;$b)^$d)+&quot;.tail();
-    }
-    sub BODY_20_39 {
-	my ($a,$b,$c,$d,$e)=@V;
-	&quot;$e+=&quot;.XUpdate().&quot;+0x6ed9eba1+($b^$c^$d)+&quot;.tail();
-    }
-    sub BODY_40_59 {
-	my ($a,$b,$c,$d,$e)=@V;
-	&quot;$e+=&quot;.XUpdate().&quot;+0x8f1bbcdc+(($b&amp;$c)|(($b|$c)&amp;$d))+&quot;.tail();
-    }
-    sub BODY_60_79 {
-	my ($a,$b,$c,$d,$e)=@V;
-	&quot;$e+=&quot;.XUpdate().&quot;+0xca62c1d6+($b^$c^$d)+&quot;.tail();
-    }
-
-    my $sha1_impl =
-    'sub block {
-	my $self = @_[0];
-	my @W    = unpack(&quot;N16&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>[1]);
-	my ($A,$B,$C,$D,$E,$T) = @{$self-&gt;{H}};
-	';
-
-	$sha1_impl.='
-	$A &amp;= 0xffffffff;
-	$B &amp;= 0xffffffff;
-	' if ((1&lt;&lt;31)&lt;&lt;1);
-
-	for($i=0;$i&lt;16;$i++){ $sha1_impl.=BODY_00_15(); unshift(@V,pop(@V)); }
-	for(;$i&lt;20;$i++)    { $sha1_impl.=BODY_16_19(); unshift(@V,pop(@V)); }
-	for(;$i&lt;40;$i++)    { $sha1_impl.=BODY_20_39(); unshift(@V,pop(@V)); }
-	for(;$i&lt;60;$i++)    { $sha1_impl.=BODY_40_59(); unshift(@V,pop(@V)); }
-	for(;$i&lt;80;$i++)    { $sha1_impl.=BODY_60_79(); unshift(@V,pop(@V)); }
-
-	$sha1_impl.='
-	$self-&gt;{H}[0]+=$A;	$self-&gt;{H}[1]+=$B;	$self-&gt;{H}[2]+=$C;
-	$self-&gt;{H}[3]+=$D;	$self-&gt;{H}[4]+=$E;	}';
-
-    #print $sha1_impl,&quot;\n&quot;;
-    eval($sha1_impl);		# generate code
-    }
-
-    sub Init {
-	my $class = shift;	# multiple instances...
-	my $self  = {};
-
-	bless $self,$class;
-	$self-&gt;{H} = [0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0];
-	$self-&gt;{N} = 0;
-	return $self;
-    }
-
-    sub Update {
-	my $self = shift;
-	my $msg;
-
-	foreach $msg (@_) {
-	    my $len  = length($msg);
-	    my $num  = length($self-&gt;{buf});
-	    my $off  = 0;
-
-	    $self-&gt;{N} += $len;
-
-	    if (($num+$len)&lt;64)
-	    {	$self-&gt;{buf} .= $msg; next;	}
-	    elsif ($num)
-	    {	$self-&gt;{buf} .= substr($msg,0,($off=64-$num));
-		$self-&gt;block($self-&gt;{buf});
-	    }
-
-	    while(($off+64) &lt;= $len)
-	    {	$self-&gt;block(substr($msg,$off,64));
-		$off += 64;
-	    }
-
-	    $self-&gt;{buf} = substr($msg,$off);
-	}
-	return $self;
-    }
-
-    sub Final {
-	my $self = shift;
-	my $num  = length($self-&gt;{buf});
-
-	$self-&gt;{buf} .= chr(0x80); $num++;
-	if ($num&gt;56)
-	{   $self-&gt;{buf} .= chr(0)x(64-$num);
-	    $self-&gt;block($self-&gt;{buf});
-	    $self-&gt;{buf}=undef;
-	    $num=0;
-	}
-	$self-&gt;{buf} .= chr(0)x(56-$num);
-	$self-&gt;{buf} .= pack(&quot;N2&quot;,($self-&gt;{N}&gt;&gt;29)&amp;0x7,$self-&gt;{N}&lt;&lt;3);
-	$self-&gt;block($self-&gt;{buf});
-
-	return pack(&quot;N*&quot;,@{$self-&gt;{H}});
-    }
-
-    sub Selftest {
-	my $hash;
-
-	$hash=SHA1-&gt;Init()-&gt;Update('abc')-&gt;Final();
-	die &quot;SHA1 test#1&quot; if (unpack(&quot;H*&quot;,$hash) ne 'a9993e364706816aba3e25717850c26c9cd0d89d');
-
-	$hash=SHA1-&gt;Init()-&gt;Update('abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq')-&gt;Final();
-	die &quot;SHA1 test#2&quot; if (unpack(&quot;H*&quot;,$hash) ne '84983e441c3bd26ebaae4aa1f95129e5e54670f1');
-
-	#$hash=SHA1-&gt;Init()-&gt;Update('a'x1000000)-&gt;Final();
-	#die &quot;SHA1 test#3&quot; if (unpack(&quot;H*&quot;,$hash) ne '34aa973cd4c4daa4f61eeb2bdbad27316534016f');
-    }
-}
-
-{ package HMAC;
-
-    sub Init {
-	my $class = shift;
-	my $key   = shift;
-	my $self  = {};
-
-	bless $self,$class;
-
-	if (length($key)&gt;64) {
-	    $key = SHA1-&gt;Init()-&gt;Update($key)-&gt;Final();
-	}
-	$key .= chr(0x00)x(64-length($key));
-
-	my @ikey = map($_^=0x36,unpack(&quot;C*&quot;,$key));
-	($self-&gt;{hash} = SHA1-&gt;Init())-&gt;Update(pack(&quot;C*&quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at ikey</A>));
-	 $self-&gt;{okey} = pack(&quot;C*&quot;,map($_^=0x36^<A HREF="../../../mailman/listinfo/openssl-commits.html">0x5c, at ikey</A>));
-
-	return $self;
-    }
-
-    sub Update {
-	my $self = shift;
-	$self-&gt;{hash}-&gt;Update(@_);
-	return $self;
-    }
-
-    sub Final {
-	my $self  = shift;
-	my $ihash = $self-&gt;{hash}-&gt;Final();
-	return SHA1-&gt;Init()-&gt;Update($self-&gt;{okey},$ihash)-&gt;Final();
-    }
-
-    sub Selftest {
-	my $hmac;
-
-	$hmac = HMAC-&gt;Init('0123456789:;&lt;=&gt;?@ABC')-&gt;Update('Sample #2')-&gt;Final();
-	die &quot;HMAC test&quot; if (unpack(&quot;H*&quot;,$hmac) ne '0922d3405faa3d194f82a45830737d5cc6c75d24');
-    }
-}
-
-######################################################################
-#
-# main()
-#
-my $legacy_mode;
-
-if ($ARGV&lt;0 || ($#ARGV&gt;0 &amp;&amp; !($legacy_mode=(@ARGV[0] =~ /^\-(dso|exe)$/)))) {
-	print STDERR &quot;usage: $0 [-dso|-exe] elfbinary\n&quot;;
-	exit(1);
-}
-
-$exe = ELF-&gt;Load(@ARGV[$#ARGV]);
-
-$FIPS_text_start	= $exe-&gt;Lookup(&quot;FIPS_text_start&quot;)		or die;
-$FIPS_text_end		= $exe-&gt;Lookup(&quot;FIPS_text_end&quot;)			or die;
-$FIPS_rodata_start	= $exe-&gt;Lookup(&quot;FIPS_rodata_start&quot;)		or die;
-$FIPS_rodata_end	= $exe-&gt;Lookup(&quot;FIPS_rodata_end&quot;)		or die;
-$FIPS_signature		= $exe-&gt;Lookup(&quot;FIPS_signature&quot;)		or die;
-
-# new cross-compile support
-$FIPS_text_startX	= $exe-&gt;Lookup(&quot;FIPS_text_startX&quot;);
-$FIPS_text_endX		= $exe-&gt;Lookup(&quot;FIPS_text_endX&quot;);
-
-if (!$legacy_mode) {
-    if (!$FIPS_text_startX || !$FIPS_text_endX) {
-	print STDERR &quot;@ARGV[$#ARGV] is not cross-compiler aware.\n&quot;;
-	exit(42);	# signal fipsld to revert to two-step link
-    }
-
-    $FINGERPRINT_ascii_value
-			= $exe-&gt;Lookup(&quot;FINGERPRINT_ascii_value&quot;);
-
-}
-if ($FIPS_text_startX &amp;&amp; $FIPS_text_endX) {
-    $FIPS_text_start = $FIPS_text_startX;
-    $FIPS_text_end   = $FIPS_text_endX;
-}
-
-sysopen(<A HREF="../../../mailman/listinfo/openssl-commits.html">FD, at ARGV</A>[$#ARGV],$legacy_mode?0:2) or die &quot;$!&quot;;	# 2 is read/write
-binmode(FD);
-
-sub HMAC_Update {
-  my ($hmac,$off,$len) = @_;
-  my $blob;
-
-    seek(FD,$off,0)	or die &quot;$!&quot;;
-    read(FD,$blob,$len)	or die &quot;$!&quot;;
-    $$hmac-&gt;Update($blob);
-}
-
-# fips/fips.c:FIPS_incore_fingerprint's Perl twin
-#
-sub FIPS_incore_fingerprint {
-  my $p1  = $FIPS_text_start-&gt;{st_offset};
-  my $p2  = $FIPS_text_end-&gt;{st_offset};
-  my $p3  = $FIPS_rodata_start-&gt;{st_offset};
-  my $p4  = $FIPS_rodata_end-&gt;{st_offset};
-  my $sig = $FIPS_signature-&gt;{st_offset};
-  my $ctx = HMAC-&gt;Init(&quot;etaonrishdlcupfm&quot;);
-
-    # detect overlapping regions
-    if ($p1&lt;=$p3 &amp;&amp; $p2&gt;=$p3) {
-	$p3 = $p1; $p4 = $p2&gt;$p4?$p2:$p4; $p1 = 0; $p2 = 0;
-    } elsif ($p3&lt;=$p1 &amp;&amp; $p4&gt;=$p1) {
-	$p3 = $p3; $p4 = $p2&gt;$p4?$p2:$p4; $p1 = 0; $p2 = 0;
-    }
-
-    if ($p1) {
-	HMAC_Update (\$ctx,$p1,$p2-$p1);
-    }
-
-    if ($sig&gt;=$p3 &amp;&amp; $sig&lt;$p4) {
-	# &quot;punch&quot; hole
-	HMAC_Update(\$ctx,$p3,$sig-$p3);
-	$p3 = $sig+20;
-	HMAC_Update(\$ctx,$p3,$p4-$p3);
-    } else {
-	HMAC_Update(\$ctx,$p3,$p4-$p3);
-    }
-
-    return $ctx-&gt;Final();
-}
-
-$fingerprint = FIPS_incore_fingerprint();
-
-if ($legacy_mode) {
-    print unpack(&quot;H*&quot;,$fingerprint);
-} elsif (defined($FINGERPRINT_ascii_value)) {
-    seek(FD,$FINGERPRINT_ascii_value-&gt;{st_offset},0)	or die &quot;$!&quot;;
-    print FD unpack(&quot;H*&quot;,$fingerprint)			or die &quot;$!&quot;;
-} else {
-    seek(FD,$FIPS_signature-&gt;{st_offset},0)		or die &quot;$!&quot;;
-    print FD $fingerprint				or die &quot;$!&quot;;
-}
-
-close (FD);
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013239.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="013241.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13240">[ date ]</a>
              <a href="thread.html#13240">[ thread ]</a>
              <a href="subject.html#13240">[ subject ]</a>
              <a href="author.html#13240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
