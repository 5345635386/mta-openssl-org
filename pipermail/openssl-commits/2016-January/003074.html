<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1453420602.584866.15294.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003073.html">
   <LINK REL="Next"  HREF="003076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1453420602.584866.15294.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Thu Jan 21 23:56:42 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="003073.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="003076.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3074">[ date ]</a>
              <a href="thread.html#3074">[ thread ]</a>
              <a href="subject.html#3074">[ subject ]</a>
              <a href="author.html#3074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  9e0724a1805fba20a897f6c7f95336f0da017ccf (commit)
      from  d74dfafd8bfb98e77ba07c4827362836e4160e94 (commit)


- Log -----------------------------------------------------------------
commit 9e0724a1805fba20a897f6c7f95336f0da017ccf
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Mon May 18 02:54:28 2015 +0200

    Refactor config - move templates and template docs to Configurations
    
    Move the documentation of the target configuration form to
    Configurations/README.
    
    Move initial assembler object templates to
    Configurations/00-BASE-templates.conf.
    
    Furthermore, remove all variables containing the names of the
    non-assembler object files and make a BASE template of them instead.
    The  values from this templates are used as defaults as is.  The
    remaining manipulation of data when assembler modules are used is done
    only when $no_asm is false.
    
    While doing this, clean out some other related variables that aren't
    used anywhere.
    
    Also, we had to move the resolution of the chosen target a bit, or the
    function 'asm' would never catch a true $no_asm...  this hasn't
    mattered before we've moved it all to the BASE template, but now it
    does.
    
    At the same time, add the default for the 'unistd' key to the BASE
    template.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/00-base-templates.conf | 168 +++++++++++++
 Configurations/README                 | 288 ++++++++++++++++++++++
 Configure                             | 447 +++++-----------------------------
 3 files changed, 513 insertions(+), 390 deletions(-)
 create mode 100644 Configurations/00-base-templates.conf
 create mode 100644 Configurations/README

diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
new file mode 100644
index 0000000..064648f
--- /dev/null
+++ b/Configurations/00-base-templates.conf
@@ -0,0 +1,168 @@
+%targets=(
+    BASE =&gt; {
+	template	=&gt; 1,
+	cpuid_obj	=&gt; &quot;mem_clr.o&quot;,
+	bn_obj		=&gt; &quot;bn_asm.o&quot;,
+	ec_obj		=&gt; &quot;&quot;,
+	des_obj		=&gt; &quot;des_enc.o fcrypt_b.o&quot;,
+	aes_obj		=&gt; &quot;aes_core.o aes_cbc.o&quot;,
+	bf_obj		=&gt; &quot;bf_enc.o&quot;,
+	md5_obj		=&gt; &quot;&quot;,
+	cast_obj	=&gt; &quot;c_enc.o&quot;,
+	rc4_obj		=&gt; &quot;rc4_enc.o rc4_skey.o&quot;,
+	rmd160_obj	=&gt; &quot;&quot;,
+	rc5_obj		=&gt; &quot;rc5_enc.o&quot;,
+	wp_obj		=&gt; &quot;wp_block.o&quot;,
+	cmll_obj	=&gt; &quot;camellia.o cmll_misc.o cmll_cbc.o&quot;,
+	modes_obj	=&gt; &quot;&quot;,
+	engines_obj	=&gt; &quot;&quot;,
+	chacha_obj	=&gt; &quot;chacha_enc.o&quot;,
+	poly1305_obj	=&gt; &quot;&quot;,
+
+	unistd		=&gt; &quot;&lt;unistd.h&gt;&quot;,
+    },
+
+    x86_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj	=&gt; &quot;x86cpuid.o&quot;,
+	bn_obj		=&gt; &quot;bn-586.o co-586.o x86-mont.o x86-gf2m.o&quot;,
+	ec_obj		=&gt; &quot;ecp_nistz256.o ecp_nistz256-x86.o&quot;,
+	des_obj		=&gt; &quot;des-586.o crypt586.o&quot;,
+	aes_obj		=&gt; &quot;aes-586.o vpaes-x86.o aesni-x86.o&quot;,
+	bf_obj		=&gt; &quot;bf-586.o&quot;,
+	md5_obj		=&gt; &quot;md5-586.o&quot;,
+	sha1_obj	=&gt; &quot;sha1-586.o sha256-586.o sha512-586.o&quot;,
+	rc4_obj		=&gt; &quot;rc4-586.o&quot;,
+	rmd160_obj	=&gt; &quot;rmd-586.o&quot;,
+	rc5_obj		=&gt; &quot;rc5-586.o&quot;,
+	wp_obj		=&gt; &quot;wp_block.o wp-mmx.o&quot;,
+	cmll_obj	=&gt; &quot;cmll-x86.o&quot;,
+	modes_obj	=&gt; &quot;ghash-x86.o&quot;,
+	engines_obj	=&gt; &quot;e_padlock-x86.o&quot;
+    },
+    x86_elf_asm =&gt; {
+	template	=&gt; 1,
+	inherit_from	=&gt; [ &quot;x86_asm&quot; ],
+	perlasm_scheme	=&gt; &quot;elf&quot;
+    },
+    x86_64_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;x86_64cpuid.o&quot;,
+	bn_obj          =&gt; &quot;x86_64-gcc.o x86_64-mont.o x86_64-mont5.o x86_64-gf2m.o rsaz_exp.o rsaz-x86_64.o rsaz-avx2.o&quot;,
+	ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-x86_64.o&quot;,
+	aes_obj         =&gt; &quot;aes-x86_64.o vpaes-x86_64.o bsaes-x86_64.o aesni-x86_64.o aesni-sha1-x86_64.o aesni-sha256-x86_64.o aesni-mb-x86_64.o&quot;,
+	md5_obj         =&gt; &quot;md5-x86_64.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-x86_64.o sha256-x86_64.o sha512-x86_64.o sha1-mb-x86_64.o sha256-mb-x86_64.o&quot;,
+	rc4_obj         =&gt; &quot;rc4-x86_64.o rc4-md5-x86_64.o&quot;,
+	wp_obj          =&gt; &quot;wp-x86_64.o&quot;,
+	cmll_obj        =&gt; &quot;cmll-x86_64.o cmll_misc.o&quot;,
+	modes_obj       =&gt; &quot;ghash-x86_64.o aesni-gcm-x86_64.o&quot;,
+	engines_obj     =&gt; &quot;e_padlock-x86_64.o&quot;
+    },
+    ia64_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;ia64cpuid.o&quot;,
+	bn_obj          =&gt; &quot;bn-ia64.o ia64-mont.o&quot;,
+	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-ia64.o&quot;,
+	md5_obj         =&gt; &quot;md5-ia64.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-ia64.o sha256-ia64.o sha512-ia64.o&quot;,
+	rc4_obj         =&gt; &quot;rc4-ia64.o rc4_skey.o&quot;,
+	modes_obj       =&gt; &quot;ghash-ia64.o&quot;,
+	perlasm_scheme	=&gt; &quot;void&quot;
+    },
+    sparcv9_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;sparcv9cap.o sparccpuid.o&quot;,
+	bn_obj          =&gt; &quot;bn-sparcv9.o sparcv9-mont.o sparcv9a-mont.o vis3-mont.o sparct4-mont.o sparcv9-gf2m.o&quot;,
+        ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-sparcv9.o&quot;,
+	des_obj         =&gt; &quot;des_enc-sparc.o fcrypt_b.o dest4-sparcv9.o&quot;,
+	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-sparcv9.o aest4-sparcv9.o&quot;,
+	md5_obj         =&gt; &quot;md5-sparcv9.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-sparcv9.o sha256-sparcv9.o sha512-sparcv9.o&quot;,
+	cmll_obj        =&gt; &quot;camellia.o cmll_misc.o cmll_cbc.o cmllt4-sparcv9.o&quot;,
+	modes_obj       =&gt; &quot;ghash-sparcv9.o&quot;,
+	perlasm_scheme	=&gt; &quot;void&quot;
+    },
+    sparcv8_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;&quot;,
+	bn_obj          =&gt; &quot;sparcv8.o&quot;,
+	des_obj         =&gt; &quot;des_enc-sparc.o fcrypt_b.o&quot;,
+	perlasm_scheme	=&gt; &quot;void&quot;
+    },
+    alpha_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;alphacpuid.o&quot;,
+	bn_obj          =&gt; &quot;bn_asm.o alpha-mont.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-alpha.o&quot;,
+	modes_obj       =&gt; &quot;ghash-alpha.o&quot;,
+	perlasm_scheme	=&gt; &quot;void&quot;
+    },
+    mips32_asm =&gt; {
+	template	=&gt; 1,
+	bn_obj          =&gt; &quot;bn-mips.o mips-mont.o&quot;,
+	aes_obj         =&gt; &quot;aes_cbc.o aes-mips.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-mips.o sha256-mips.o&quot;,
+    },
+    mips64_asm =&gt; {
+	inherit_from	=&gt; [ &quot;mips32_asm&quot; ],
+	template	=&gt; 1,
+	sha1_obj        =&gt; sub { join(&quot; &quot;, @_, &quot;sha512-mips.o&quot;) }
+    },
+    s390x_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;s390xcap.o s390xcpuid.o&quot;,
+	bn_obj          =&gt; &quot;bn-s390x.o s390x-mont.o s390x-gf2m.o&quot;,
+	aes_obj         =&gt; &quot;aes-s390x.o aes-ctr.o aes-xts.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-s390x.o sha256-s390x.o sha512-s390x.o&quot;,
+	rc4_obj         =&gt; &quot;rc4-s390x.o&quot;,
+	modes_obj       =&gt; &quot;ghash-s390x.o&quot;,
+    },
+    armv4_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;armcap.o armv4cpuid.o&quot;,
+	bn_obj          =&gt; &quot;bn_asm.o armv4-mont.o armv4-gf2m.o&quot;,
+	ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-armv4.o&quot;,
+	aes_obj         =&gt; &quot;aes_cbc.o aes-armv4.o bsaes-armv7.o aesv8-armx.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-armv4-large.o sha256-armv4.o sha512-armv4.o&quot;,
+	modes_obj       =&gt; &quot;ghash-armv4.o ghashv8-armx.o&quot;,
+	perlasm_scheme	=&gt; &quot;void&quot;
+    },
+    aarch64_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;armcap.o arm64cpuid.o mem_clr.o&quot;,
+	ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-armv8.o&quot;,
+	bn_obj          =&gt; &quot;bn_asm.o armv8-mont.o&quot;,
+	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aesv8-armx.o vpaes-armv8.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-armv8.o sha256-armv8.o sha512-armv8.o&quot;,
+	modes_obj       =&gt; &quot;ghashv8-armx.o&quot;,
+    },
+    parisc11_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;pariscid.o&quot;,
+	bn_obj          =&gt; &quot;bn_asm.o parisc-mont.o&quot;,
+	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-parisc.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-parisc.o sha256-parisc.o sha512-parisc.o&quot;,
+	rc4_obj         =&gt; &quot;rc4-parisc.o&quot;,
+	modes_obj       =&gt; &quot;ghash-parisc.o&quot;,
+	perlasm_scheme	=&gt; &quot;32&quot;
+    },
+    parisc20_64_asm =&gt; {
+	template	=&gt; 1,
+	inherit_from	=&gt; [ &quot;parisc11_asm&quot; ],
+	bn_obj          =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s/bn_asm/pa-risc2W/; $r; },
+	perlasm_scheme	=&gt; &quot;64&quot;,
+    },
+    ppc64_asm =&gt; {
+	template	=&gt; 1,
+	cpuid_obj       =&gt; &quot;ppccpuid.o ppccap.o&quot;,
+	bn_obj          =&gt; &quot;bn-ppc.o ppc-mont.o ppc64-mont.o&quot;,
+	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-ppc.o vpaes-ppc.o aesp8-ppc.o&quot;,
+	sha1_obj        =&gt; &quot;sha1-ppc.o sha256-ppc.o sha512-ppc.o sha256p8-ppc.o sha512p8-ppc.o&quot;,
+	modes_obj       =&gt; &quot;ghashp8-ppc.o&quot;,
+    },
+    ppc32_asm =&gt; {
+	inherit_from	=&gt; [ &quot;ppc64_asm&quot; ],
+	template	=&gt; 1
+    },
+);
diff --git a/Configurations/README b/Configurations/README
new file mode 100644
index 0000000..e1327e5
--- /dev/null
+++ b/Configurations/README
@@ -0,0 +1,288 @@
+Configurations of OpenSSL target platforms
+------------------------------------------
+
+Target configurations are a collection of facts that we know about
+different platforms and their capabilities.  We organise them in a
+hash table, where each entry represent a specific target.
+
+In each table entry, the following keys are significant:
+
+        inherit_from    =&gt; Other targets to inherit values from.
+                           Explained further below. [1]
+        template        =&gt; Set to 1 if this isn't really a platform
+                           target.  Instead, this target is a template
+                           upon which other targets can be built.
+                           Explained further below.  [1]
+
+        sys_id          =&gt; System identity for systems where that
+                           is difficult to determine automatically.
+
+        cc              =&gt; The compiler command, usually one of &quot;cc&quot;,
+                           &quot;gcc&quot; or &quot;clang&quot;.  This command is normally
+                           also used to link object files and
+                           libraries into the final program.
+        cflags          =&gt; Flags that are used at all times when
+                           compiling.
+        debug_cflags    =&gt; Extra compilation flags used when making a
+                           debug build (when Configure receives the
+                           --debug option).  Typically something like
+                           &quot;-g -O0&quot;.
+        release_cflags  =&gt; Extra compilation flags used when making a
+                           release build (when Configure receives the
+                           --release option, or doesn't receive the
+                           --debug option).  Typically something like
+                           &quot;-O&quot; or &quot;-O3&quot;.
+        thread_cflags   =&gt; Extra compilation flags used when
+                           compiling with threading enabled.
+                           Explained further below.  [2]
+        shared_cflag    =&gt; Extra compilation flags used when
+                           compiling for shared libraries, typically
+                           something like &quot;-fPIC&quot;.
+
+        ld              =&gt; the linker command, usually not defined
+                           (meaning the compiler command is used
+                           instead).
+                           (NOTE: this is here for future use, it's
+                           not implemented yet)
+        lflags          =&gt; the flags that are used at all times when
+                           linking.  These can have a % sign in them
+                           showing where the OpenSSL libraries should
+                           appear, otherwise these flags will come
+                           last.  So in a typical links situation,
+                           this is a quick table of results:
+
+                           &quot;-foo%-bar&quot;  &gt; -foo -lssl -lcrypto -bar
+                           &quot;-foo%&quot;      &gt; -foo -lssl -lcrypto
+                           &quot;-foo&quot;       &gt; -lssl -lcrypto -foo
+
+        debug_lflags    =&gt; Like debug_cflags, but used when linking.
+        release_lflags  =&gt; Like release_cflags, but used when linking.
+        shared_lflags   =&gt; Like shared_cflags, but used when linking.
+
+        ar              =&gt; The library archive command, the default is
+                           &quot;ar&quot;.
+                           (NOTE: this is here for future use, it's
+                           not implemented yet)
+        arflags         =&gt; Flags to be used with the library archive
+                           command.
+
+        ranlib          =&gt; The library archive indexing command, the
+                           default is 'ranlib' it it exists.
+
+        unistd          =&gt; An alternative header to the typical
+                           '&lt;unistd.h&gt;'.  This is very rarely needed.
+
+        shared_extension =&gt; File name extension used for shared
+                            libraries. 
+        obj_extension   =&gt; File name extension used for object files.
+                           On unix, this defaults to &quot;.o&quot; (NOTE: this
+                           is here for future use, it's not
+                           implemented yet)
+        exe_extension   =&gt; File name extension used for executable
+                           files.  On unix, this defaults to &quot;&quot; (NOTE:
+                           this is here for future use, it's not
+                           implemented yet)
+
+        dso_scheme      =&gt; The type of dynamic shared objects to build
+                           for.  This mostly comes into play with
+                           engines, but can be used for other purposes
+                           as well.  Valid values are &quot;DLFCN&quot;
+                           (dlopen() et al), &quot;DLFCN_NO_H&quot; (for systems
+                           that use dlopen() et al but do not have
+                           fcntl.h), &quot;DL&quot; (shl_load() et al), &quot;WIN32&quot;
+                           and &quot;VMS&quot;.
+        perlasm_scheme  =&gt; The perlasm method used to created the
+                           assembler files used when compiling with
+                           assembler implementations.
+        shared_target   =&gt; The shared library building method used.
+                           This is a target found in Makefile.shared.
+        build_scheme    =&gt; The scheme used to build up a Makefile.
+                           (NOTE: this is here for future use, it's
+                           not implemented yet)
+
+        multilib        =&gt; On systems that support having multiple
+                           implementations of a library (typically a
+                           32-bit and a 64-bit variant), this is used
+                           to have the different variants in different
+                           directories.
+
+        bn_ops          =&gt; Building options (was just bignum options
+                           in the earlier history of this option,
+                           hence the name).  This a string of words
+                           that describe properties on the designated
+                           target platform, such as the type of
+                           integers used to build up the bitnum,
+                           different ways to implement certain ciphers
+                           and so on.  To fully comprehend the
+                           meaning, the best is to read the affected
+                           source.
+                           The valid words are:
+
+                           DES_PTR      use a pointer to DES_SPtrans
+                                        rather that DES_SPtrans
+                                        directly in D_ENCRYPT.
+                           DES_RISC1    Alternate implementations of
+                           DES_RISC2    D_ENCRYPT for certain RISC
+                                        processors.
+                           DES_UNROLL   do not loop around calls to
+                                        D_ENCRYPT.
+                           DES_INT      have unsigned int as the
+                                        integer type for DES rather
+                                        than unsigned long.
+                           BN_LLONG     use 'unsigned long long' in
+                                        some bignum calculations.
+                                        This has no value when
+                                        SIXTY_FOUR_BIT or
+                                        SIXTY_FOUR_BIT_LONG is given.
+                           RC4_CHAR     makes the basic RC4 unif of
+                                        calculation an unsigned char.
+                           RC4_LONG     makes the basic RC4 unif of
+                                        calculation an unsigned long.
+                           RC4_INDEX    go through input and output
+                                        data by indexing into them
+                                        rather than incrementing the
+                                        pointer.
+                           RC4_CHUNK    sets the chunk type to
+                                        unsigned long.
+                           RC4_CHUNK_LL sets the chunk type to
+                                        unsigned long long.
+                                        both these chunk sizes are for
+                                        handling data in chunks on
+                                        processors that do not have
+                                        byte load/store instructions.
+                           MD2_CHAR     makes the basic MD2 unit of
+                                        calculation an unsigned char.
+                           MD2_LONG     makes the basic MD2 unit of
+                                        calculation an unsigned long.
+                           IDEA_SHORT   makes the basic IDEA unit of
+                                        calculation an unsigned short.
+                           IDEA_LONG    makes the basic IDEA unit of
+                                        calculation an unsigned long.
+                           RC2_SHORT    makes the basic RC2 unit of
+                                        calculation an unsigned short.
+                           RC2_LONG     makes the basic RC2 unit of
+                                        calculation an unsigned long.
+                           BF_PTR       use different pointer based
+                           BF_PTR2      versions of BF_ENC.
+                           SIXTY_FOUR_BIT       processor registers
+                                                are 64 bits, long is
+                                                32 bits, long long is
+                                                64 bits.
+                           SIXTY_FOUR_BIT_LONG  processor registers
+                                                are 64 bits, long is
+                                                64 bits.
+                           THIRTY_TWO_BIT       processor registers
+                                                are 32 bits.
+                           EXPORT_VAR_AS_FN     for shared libraries,
+                                                export vars as
+                                                accessor functions.
+
+        cpuid_obj       =&gt; assembler implementation of cpuid code as
+                           well as OPENSSL_cleanse().
+                           Default to mem_clr.o
+        bn_obj          =&gt; assembler implementation of core bignum
+                           functions.
+                           Defaults to bn_asm.o
+        ec_obj          =&gt; assembler implementation of core EC
+                           functions.
+        des_obj         =&gt; assembler implementation of core DES
+                           encryption functions.
+                           Defaults to 'des_enc.o fcrypt_b.o'
+        aes_obj         =&gt; assembler implementation of core AES
+                           functions.
+                           Defaults to 'aes_core.o aes_cbc.o'
+        bf_obj          =&gt; assembler implementation of core BF
+                           functions.
+                           Defaults to 'bf_enc.o'
+        md5_obj         =&gt; assembler implementation of core MD5
+                           functions.
+        sha1_obj        =&gt; assembler implementation of core SHA1,
+                           functions, and also possibly SHA256 and
+                           SHA512 ones.
+        cast_obj        =&gt; assembler implementation of core BF
+                           functions.
+                           Defaults to 'c_enc.o'
+        rc4_obj         =&gt; assembler implementation of core BF
+                           functions.
+                           Defaults to 'rc4_enc.o rc4_skey.o'
+        rmd160_obj      =&gt; assembler implementation of core RMD160
+                           functions.
+        rc5_obj         =&gt; assembler implementation of core RC4
+                           functions.
+                           Defaults to 'rc5_enc.o'
+        wp_obj          =&gt; assembler implementation of core WHIRLPOOL
+                           functions.
+        cmll_obj        =&gt; assembler implementation of core CAMELLIA
+                           functions.
+                           Defaults to 'camellia.o cmll_misc.o cmll_cbc.o'
+        modes_obj       =&gt; assembler implementation of the
+                           functions gcm_gmult_4bit and gcm_ghash_4bit.
+        engines_obj     =&gt; assembler implementation of core parts of
+                           the padlock engine.  This is mandatory on
+                           any platform where the padlock engine might
+                           actually be built.
+
+
+[1] as part of the target configuration, one can have a key called
+    'inherit_from' that indicate what other configurations to inherit
+    data from.  These are resolved recursively.
+
+    Inheritance works as a set of default values that can be overriden
+    by corresponding key values in the inheriting configuration.
+
+    Note 1: any configuration table can be used as a template.
+    Note 2: pure templates have the attribute 'template =&gt; 1' and
+            cannot be used as build targets.
+
+    If several configurations are given in the 'inherit_from' array,
+    the values of same attribute are concatenated with space
+    separation.  With this, it's possible to have several smaller
+    templates for different configuration aspects that can be combined
+    into a complete configuration.
+
+    instead of a scalar value or an array, a value can be a code block
+    of the form 'sub { /* your code here */ }'.  This code block will
+    be called with the list of inherited values for that key as
+    arguments.  In fact, the concatenation of strings is really done
+    by using 'sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>) }' on the list of inherited values.
+
+    An example:
+
+        &quot;foo&quot; =&gt; {
+                template =&gt; 1,
+                haha =&gt; &quot;ha ha&quot;,
+                hoho =&gt; &quot;ho&quot;,
+                ignored =&gt; &quot;This should not appear in the end result&quot;,
+        },
+        &quot;bar&quot; =&gt; {
+                template =&gt; 1,
+                haha =&gt; &quot;ah&quot;,
+                hoho =&gt; &quot;haho&quot;,
+                hehe =&gt; &quot;hehe&quot;
+        },
+        &quot;laughter&quot; =&gt; {
+                inherit_from =&gt; [ &quot;foo&quot;, &quot;bar&quot; ],
+                hehe =&gt; sub { join(&quot; &quot;,(@_,&quot;!!!&quot;)) },
+                ignored =&gt; &quot;&quot;,
+        }
+
+        The entry for &quot;laughter&quot; will become as follows after processing:
+
+        &quot;laughter&quot; =&gt; {
+                haha =&gt; &quot;ha ha ah&quot;,
+                hoho =&gt; &quot;ho haho&quot;,
+                hehe =&gt; &quot;hehe !!!&quot;,
+                ignored =&gt; &quot;&quot;
+        }
+
+[2] OpenSSL is built with threading capabilities unless the user
+    specifies 'no-threads'.  The value of the key 'thread_cflags' may
+    be &quot;(unknown)&quot;, in which case the user MUST give some compilation
+    flags to Configure.
+
+
+Historically, the target configurations came in form of a string with
+values separated by colons.  This use is deprecated, although
+currently somewhat supported.  The string form looks like this:
+
+   &quot;target&quot; =&gt; &quot;{cc}:{cflags}:{unistd}:{thread_cflag}:{sys_id}:{lflags}:{bn_ops}:{cpuid_obj}:{bn_obj}:{ec_obj}:{des_obj}:{aes_obj}:{bf_obj}:{md5_obj}:{sha1_obj}:{cast_obj}:{rc4_obj}:{rmd160_obj}:{rc5_obj}:{wp_obj}:{cmll_obj}:{modes_obj}:{engines_obj}:{perlasm_scheme}:{dso_scheme}:{shared_target}:{shared_cflag}:{shared_ldflag}:{shared_extension}:{ranlib}:{arflags}:{multilib}&quot;
diff --git a/Configure b/Configure
index 4c2f01f..be55d8c 100755
--- a/Configure
+++ b/Configure
@@ -148,283 +148,8 @@ my $apitable = {
     &quot;0.9.8&quot; =&gt; &quot;0x00908000L&quot;,
 };
 
-# table of known configurations, read in from files
-#
-# The content of each entry comes in the form of config hash table,
-# which has additional attributes for debug and non-debug flags to be
-# added to the common flags, for cflags and lflags:
-#
-#	{
-#	  cc =&gt; $cc,
-#	  cflags =&gt; $cflags,
-#	  debug_cflags =&gt; $debug_cflags,
-#	  release_cflags =&gt; $release_cflags,
-#	  unistd =&gt; $unistd,
-#	  thread_cflag =&gt; $thread_cflag,
-#	  sys_id =&gt; $sys_id,
-#	  lflags =&gt; $lflags,
-#	  debug_lflags =&gt; $debug_lflags,
-#	  release_lflags =&gt; $release_lflags,
-#	  bn_ops =&gt; $bn_ops,
-#	  cpuid_obj =&gt; $cpuid_obj,
-#	  bn_obj =&gt; $bn_obj,
-#	  ec_obj =&gt; $ec_obj,
-#	  des_obj =&gt; $des_obj,
-#	  aes_obj =&gt; $aes_obj,
-#	  bf_obj =&gt; $bf_obj,
-#	  md5_obj =&gt; $md5_obj,
-#	  sha1_obj =&gt; $sha1_obj,
-#	  cast_obj =&gt; $cast_obj,
-#	  rc4_obj =&gt; $rc4_obj,
-#	  rmd160_obj =&gt; $rmd160_obj,
-#	  rc5_obj =&gt; $rc5_obj,
-#	  wp_obj =&gt; $wp_obj,
-#	  cmll_obj =&gt; $cmll_obj,
-#	  modes_obj =&gt; $modes_obj,
-#	  engines_obj =&gt; $engines_obj,
-#	  chacha_obj =&gt; $wp_obj,
-#	  poly1305_obj =&gt; $cmll_obj,
-#	  dso_scheme =&gt; $dso_scheme,
-#	  shared_target =&gt; $shared_target,
-#	  shared_cflag =&gt; $shared_cflag,
-#	  shared_ldflag =&gt; $shared_ldflag,
-#	  shared_extension =&gt; $shared_extension,
-#	  ranlib =&gt; $ranlib,
-#	  arflags =&gt; $arflags,
-#	  multilib =&gt; $multilib
-#	}
-#
-# The configuration hashes can refer to templates in two different manners:
-#
-# - as part of the hash, one can have a key called 'inherit_from' that
-#   indicate what other configuration hashes to inherit data from.
-#   These are resolved recursively.
-#
-#   Inheritance works as a set of default values that can be overriden
-#   by corresponding attribute values in the inheriting configuration.
-#
-#   If several configurations are given in the 'inherit_from' array, the
-#   values of same attribute are concatenated with space separation.
-#   With this, it's possible to have several smaller templates for
-#   different configuration aspects that can be combined into a complete
-#   configuration.
-#
-#   Example:
-#
-#	&quot;foo&quot; =&gt; {
-#		template =&gt; 1,
-#		haha =&gt; &quot;haha&quot;,
-#		hoho =&gt; &quot;ho&quot;
-#	},
-#	&quot;bar&quot; =&gt; {
-#		template =&gt; 1,
-#		hoho =&gt; &quot;ho&quot;,
-#		hehe =&gt; &quot;hehe&quot;
-#	},
-#	&quot;laughter&quot; =&gt; {
-#		inherit_from =&gt; [ &quot;foo&quot;, &quot;bar&quot; ],
-#	}
-#
-#	The entry for &quot;foo&quot; will become as follows after processing:
-#
-#	&quot;laughter&quot; =&gt; {
-#		haha =&gt; &quot;haha&quot;,
-#		hoho =&gt; &quot;ho ho&quot;,
-#		hehe =&gt; &quot;hehe&quot;
-#	}
-#
-#   Note 1: any entry from the table can be used as a template.
-#   Note 2: pure templates have the attribute 'template =&gt; 1' and cannot
-#           be used as targets.
-#
-# - instead of a string, one can have a code block of the form
-#   'sub { /* your code here */ }', where the arguments are the list of
-#   inherited values for that key.  In fact, the concatenation of strings
-#   is really done by using 'sub { join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>) }' on the list of inherited
-#   values.
-#
-#   Example:
-#
-#	&quot;foo&quot; =&gt; {
-#		template =&gt; 1,
-#		haha =&gt; &quot;ha ha&quot;,
-#		hoho =&gt; &quot;ho&quot;,
-#		ignored =&gt; &quot;This should not appear in the end result&quot;,
-#	},
-#	&quot;bar&quot; =&gt; {
-#		template =&gt; 1,
-#		haha =&gt; &quot;ah&quot;,
-#		hoho =&gt; &quot;haho&quot;,
-#		hehe =&gt; &quot;hehe&quot;
-#	},
-#	&quot;laughter&quot; =&gt; {
-#		inherit_from =&gt; [ &quot;foo&quot;, &quot;bar&quot; ],
-#		hehe =&gt; sub { join(&quot; &quot;,(@_,&quot;!!!&quot;)) },
-#		ignored =&gt; &quot;&quot;,
-#	}
-#
-#	The entry for &quot;foo&quot; will become as follows after processing:
-#
-#	&quot;laughter&quot; =&gt; {
-#		haha =&gt; &quot;ha ha ah&quot;,
-#		hoho =&gt; &quot;ho haho&quot;,
-#		hehe =&gt; &quot;hehe !!!&quot;,
-#		ignored =&gt; &quot;&quot;
-#	}
-#
-
-our %table=(
-
-    # All these templates are merely a translation of the corresponding
-    # variables further up.
-    #
-    # Note: as long as someone might use old style configuration strings,
-    # or we bother supporting that, those variables need to stay
-
-    x86_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj	=&gt; &quot;x86cpuid.o&quot;,
-	bn_obj		=&gt; &quot;bn-586.o co-586.o x86-mont.o x86-gf2m.o&quot;,
-	ec_obj		=&gt; &quot;ecp_nistz256.o ecp_nistz256-x86.o&quot;,
-	des_obj		=&gt; &quot;des-586.o crypt586.o&quot;,
-	aes_obj		=&gt; &quot;aes-586.o vpaes-x86.o aesni-x86.o&quot;,
-	bf_obj		=&gt; &quot;bf-586.o&quot;,
-	md5_obj		=&gt; &quot;md5-586.o&quot;,
-	sha1_obj	=&gt; &quot;sha1-586.o sha256-586.o sha512-586.o&quot;,
-	rc4_obj		=&gt; &quot;rc4-586.o&quot;,
-	rmd160_obj	=&gt; &quot;rmd-586.o&quot;,
-	rc5_obj		=&gt; &quot;rc5-586.o&quot;,
-	wp_obj		=&gt; &quot;wp_block.o wp-mmx.o&quot;,
-	cmll_obj	=&gt; &quot;cmll-x86.o&quot;,
-	modes_obj	=&gt; &quot;ghash-x86.o&quot;,
-	engines_obj	=&gt; &quot;e_padlock-x86.o&quot;
-    },
-    x86_elf_asm =&gt; {
-	template	=&gt; 1,
-	inherit_from	=&gt; [ &quot;x86_asm&quot; ],
-	perlasm_scheme	=&gt; &quot;elf&quot;
-    },
-    x86_64_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;x86_64cpuid.o&quot;,
-	bn_obj          =&gt; &quot;x86_64-gcc.o x86_64-mont.o x86_64-mont5.o x86_64-gf2m.o rsaz_exp.o rsaz-x86_64.o rsaz-avx2.o&quot;,
-	ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-x86_64.o&quot;,
-	aes_obj         =&gt; &quot;aes-x86_64.o vpaes-x86_64.o bsaes-x86_64.o aesni-x86_64.o aesni-sha1-x86_64.o aesni-sha256-x86_64.o aesni-mb-x86_64.o&quot;,
-	md5_obj         =&gt; &quot;md5-x86_64.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-x86_64.o sha256-x86_64.o sha512-x86_64.o sha1-mb-x86_64.o sha256-mb-x86_64.o&quot;,
-	rc4_obj         =&gt; &quot;rc4-x86_64.o rc4-md5-x86_64.o&quot;,
-	wp_obj          =&gt; &quot;wp-x86_64.o&quot;,
-	cmll_obj        =&gt; &quot;cmll-x86_64.o cmll_misc.o&quot;,
-	modes_obj       =&gt; &quot;ghash-x86_64.o aesni-gcm-x86_64.o&quot;,
-	engines_obj     =&gt; &quot;e_padlock-x86_64.o&quot;
-    },
-    ia64_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;ia64cpuid.o&quot;,
-	bn_obj          =&gt; &quot;bn-ia64.o ia64-mont.o&quot;,
-	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-ia64.o&quot;,
-	md5_obj         =&gt; &quot;md5-ia64.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-ia64.o sha256-ia64.o sha512-ia64.o&quot;,
-	rc4_obj         =&gt; &quot;rc4-ia64.o rc4_skey.o&quot;,
-	modes_obj       =&gt; &quot;ghash-ia64.o&quot;,
-	perlasm_scheme	=&gt; &quot;void&quot;
-    },
-    sparcv9_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;sparcv9cap.o sparccpuid.o&quot;,
-	bn_obj          =&gt; &quot;bn-sparcv9.o sparcv9-mont.o sparcv9a-mont.o vis3-mont.o sparct4-mont.o sparcv9-gf2m.o&quot;,
-        ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-sparcv9.o&quot;,
-	des_obj         =&gt; &quot;des_enc-sparc.o fcrypt_b.o dest4-sparcv9.o&quot;,
-	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-sparcv9.o aest4-sparcv9.o&quot;,
-	md5_obj         =&gt; &quot;md5-sparcv9.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-sparcv9.o sha256-sparcv9.o sha512-sparcv9.o&quot;,
-	cmll_obj        =&gt; &quot;camellia.o cmll_misc.o cmll_cbc.o cmllt4-sparcv9.o&quot;,
-	modes_obj       =&gt; &quot;ghash-sparcv9.o&quot;,
-	perlasm_scheme	=&gt; &quot;void&quot;
-    },
-    sparcv8_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;&quot;,
-	bn_obj          =&gt; &quot;sparcv8.o&quot;,
-	des_obj         =&gt; &quot;des_enc-sparc.o fcrypt_b.o&quot;,
-	perlasm_scheme	=&gt; &quot;void&quot;
-    },
-    alpha_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;alphacpuid.o&quot;,
-	bn_obj          =&gt; &quot;bn_asm.o alpha-mont.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-alpha.o&quot;,
-	modes_obj       =&gt; &quot;ghash-alpha.o&quot;,
-	perlasm_scheme	=&gt; &quot;void&quot;
-    },
-    mips32_asm =&gt; {
-	template	=&gt; 1,
-	bn_obj          =&gt; &quot;bn-mips.o mips-mont.o&quot;,
-	aes_obj         =&gt; &quot;aes_cbc.o aes-mips.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-mips.o sha256-mips.o&quot;,
-    },
-    mips64_asm =&gt; {
-	inherit_from	=&gt; [ &quot;mips32_asm&quot; ],
-	template	=&gt; 1,
-	sha1_obj        =&gt; sub { join(&quot; &quot;, @_, &quot;sha512-mips.o&quot;) }
-    },
-    s390x_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;s390xcap.o s390xcpuid.o&quot;,
-	bn_obj          =&gt; &quot;bn-s390x.o s390x-mont.o s390x-gf2m.o&quot;,
-	aes_obj         =&gt; &quot;aes-s390x.o aes-ctr.o aes-xts.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-s390x.o sha256-s390x.o sha512-s390x.o&quot;,
-	rc4_obj         =&gt; &quot;rc4-s390x.o&quot;,
-	modes_obj       =&gt; &quot;ghash-s390x.o&quot;,
-    },
-    armv4_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;armcap.o armv4cpuid.o&quot;,
-	bn_obj          =&gt; &quot;bn_asm.o armv4-mont.o armv4-gf2m.o&quot;,
-	ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-armv4.o&quot;,
-	aes_obj         =&gt; &quot;aes_cbc.o aes-armv4.o bsaes-armv7.o aesv8-armx.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-armv4-large.o sha256-armv4.o sha512-armv4.o&quot;,
-	modes_obj       =&gt; &quot;ghash-armv4.o ghashv8-armx.o&quot;,
-	perlasm_scheme	=&gt; &quot;void&quot;
-    },
-    aarch64_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;armcap.o arm64cpuid.o mem_clr.o&quot;,
-	ec_obj          =&gt; &quot;ecp_nistz256.o ecp_nistz256-armv8.o&quot;,
-	bn_obj          =&gt; &quot;bn_asm.o armv8-mont.o&quot;,
-	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aesv8-armx.o vpaes-armv8.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-armv8.o sha256-armv8.o sha512-armv8.o&quot;,
-	modes_obj       =&gt; &quot;ghashv8-armx.o&quot;,
-    },
-    parisc11_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;pariscid.o&quot;,
-	bn_obj          =&gt; &quot;bn_asm.o parisc-mont.o&quot;,
-	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-parisc.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-parisc.o sha256-parisc.o sha512-parisc.o&quot;,
-	rc4_obj         =&gt; &quot;rc4-parisc.o&quot;,
-	modes_obj       =&gt; &quot;ghash-parisc.o&quot;,
-	perlasm_scheme	=&gt; &quot;32&quot;
-    },
-    parisc20_64_asm =&gt; {
-	template	=&gt; 1,
-	inherit_from	=&gt; [ &quot;parisc11_asm&quot; ],
-	bn_obj          =&gt; sub { my $r=join(&quot; &quot;<A HREF="../../../mailman/listinfo/openssl-commits.html">, at _</A>); $r=~s/bn_asm/pa-risc2W/; $r; },
-	perlasm_scheme	=&gt; &quot;64&quot;,
-    },
-    ppc64_asm =&gt; {
-	template	=&gt; 1,
-	cpuid_obj       =&gt; &quot;ppccpuid.o ppccap.o&quot;,
-	bn_obj          =&gt; &quot;bn-ppc.o ppc-mont.o ppc64-mont.o&quot;,
-	aes_obj         =&gt; &quot;aes_core.o aes_cbc.o aes-ppc.o vpaes-ppc.o aesp8-ppc.o&quot;,
-	sha1_obj        =&gt; &quot;sha1-ppc.o sha256-ppc.o sha512-ppc.o sha256p8-ppc.o sha512p8-ppc.o&quot;,
-	modes_obj       =&gt; &quot;ghashp8-ppc.o&quot;,
-    },
-    ppc32_asm =&gt; {
-	inherit_from	=&gt; [ &quot;ppc64_asm&quot; ],
-	template	=&gt; 1
-    },
-);
+my $base_target = &quot;BASE&quot;;   # The template that all other inherit from
+our %table = ();
 
 # Forward declarations ###############################################
 
@@ -472,24 +197,6 @@ my $no_asm=0;
 my $no_dso=0;
 my @skip=();
 my $Makefile=&quot;Makefile&quot;;
-my $des_locl=&quot;crypto/des/des_locl.h&quot;;
-my $des	=&quot;include/openssl/des.h&quot;;
-my $bn	=&quot;include/openssl/bn.h&quot;;
-my $md2	=&quot;include/openssl/md2.h&quot;;
-my $rc4	=&quot;include/openssl/rc4.h&quot;;
-my $rc4_locl=&quot;crypto/rc4/rc4_locl.h&quot;;
-my $idea	=&quot;include/openssl/idea.h&quot;;
-my $rc2	=&quot;include/openssl/rc2.h&quot;;
-my $bf	=&quot;crypto/bf/bf_locl.h&quot;;
-my $bn_asm	=&quot;bn_asm.o&quot;;
-my $des_enc=&quot;des_enc.o fcrypt_b.o&quot;;
-my $aes_enc=&quot;aes_core.o aes_cbc.o&quot;;
-my $bf_enc	=&quot;bf_enc.o&quot;;
-my $cast_enc=&quot;c_enc.o&quot;;
-my $rc4_enc=&quot;rc4_enc.o rc4_skey.o&quot;;
-my $rc5_enc=&quot;rc5_enc.o&quot;;
-my $cmll_enc=&quot;camellia.o cmll_misc.o cmll_cbc.o&quot;;
-my $chacha_enc=&quot;chacha_enc.o&quot;;
 my $processor=&quot;&quot;;
 my $default_ranlib;
 my $perl;
@@ -972,24 +679,6 @@ if ($target =~ m/^CygWin32(-.*)$/) {
 	$target = &quot;Cygwin&quot;.$1;
 }
 
-print &quot;Configuring for $target\n&quot;;
-
-# Support for legacy targets having a name starting with 'debug-'
-my ($d, $t) = $target =~ m/^(debug-)?(.*)$/;
-if ($d) {
-    $build_prefix = &quot;debug_&quot;;
-
-    # If we do not find debug-foo in the table, the target is set to foo,
-    # but only if the foo target has a noon-empty debug_cflags or debug_lflags
-    # attribute.
-    if (!$table{$target}) {
-	$target = $t;
-    }
-}
-my %target = resolve_config($target);
-
-&amp;usage if (!%target || $target{template});
-
 foreach (sort (keys %disabled))
 	{
 	$options .= &quot; no-$_&quot;;
@@ -1056,6 +745,24 @@ foreach (sort @experimental)
 	$exp_cflags .= &quot; -DOPENSSL_EXPERIMENTAL_$ALGO&quot;;
 	}
 
+print &quot;Configuring for $target\n&quot;;
+
+# Support for legacy targets having a name starting with 'debug-'
+my ($d, $t) = $target =~ m/^(debug-)?(.*)$/;
+if ($d) {
+    $build_prefix = &quot;debug_&quot;;
+
+    # If we do not find debug-foo in the table, the target is set to foo.
+    if (!$table{$target}) {
+	$target = $t;
+    }
+}
+
+delete $table{$base_target}-&gt;{template}; # or the next test will fail.
+my %target = ( %{$table{$base_target}}, resolve_config($target) );
+
+&amp;usage if (!%target || $target{template});
+
 my $IsMK1MF=scalar grep /^$target$/<A HREF="../../../mailman/listinfo/openssl-commits.html">, at MK1MF_Builds</A>;
 
 $exe_ext=&quot;.exe&quot; if ($target eq &quot;Cygwin&quot; || $target eq &quot;DJGPP&quot; || $target =~ /^mingw/);
@@ -1219,22 +926,9 @@ $lflags=&quot;$libs$lflags&quot; if ($libs ne &quot;&quot;);
 
 if ($no_asm)
 	{
-	$cpuid_obj=$bn_obj=$ec_obj=
-	$des_obj=$aes_obj=$bf_obj=$cast_obj=$rc4_obj=$rc5_obj=$cmll_obj=
-	$modes_obj=$sha1_obj=$md5_obj=$rmd160_obj=$wp_obj=$engines_obj=
-	$chacha_obj=$poly1305_obj=&quot;&quot;;
 	$cflags=~s/\-D[BL]_ENDIAN//		if ($fips);
 	$thread_cflags=~s/\-D[BL]_ENDIAN//	if ($fips);
 	}
-elsif (defined($disabled{ec2m}))
-	{
-	$bn_obj =~ s/\w+-gf2m.o//;
-	}
-
-if (!$no_shared)
-	{
-	$cast_obj=&quot;&quot;;	# CAST assembler is not PIC
-	}
 
 if ($threads)
 	{
@@ -1297,8 +991,6 @@ if (!$IsMK1MF)
 		}
 	}
 
-$cpuid_obj.=&quot; uplink.o uplink-x86.o&quot; if ($cflags =~ /\-DOPENSSL_USE_APPLINK/);
-
 #
 # Platform fix-ups
 #
@@ -1358,58 +1050,44 @@ if ($ranlib eq &quot;&quot;)
 	$ranlib = $default_ranlib;
 	}
 
-#my ($bn1)=split(/\s+/,$bn_obj);
-#$bn1 = &quot;&quot; unless defined $bn1;
-#$bn1=$bn_asm unless ($bn1 =~ /\.o$/);
-#$bn_obj=&quot;$bn1&quot;;
+if (!$no_asm) {
+    $cpuid_obj=$table{BASE}-&gt;{cpuid_obj} if ($processor eq &quot;386&quot;);
+    $cpuid_obj.=&quot; uplink.o uplink-x86.o&quot; if ($cflags =~ /\-DOPENSSL_USE_APPLINK/);
 
-$cpuid_obj=&quot;&quot; if ($processor eq &quot;386&quot;);
+    $bn_obj =~ s/\w+-gf2m.o// if (defined($disabled{ec2m}));
 
-$bn_obj = $bn_asm unless $bn_obj ne &quot;&quot;;
-# bn-586 is the only one implementing bn_*_part_words
-$cflags.=&quot; -DOPENSSL_BN_ASM_PART_WORDS&quot; if ($bn_obj =~ /bn-586/);
-$cflags.=&quot; -DOPENSSL_IA32_SSE2&quot; if (!$no_sse2 &amp;&amp; $bn_obj =~ /86/);
+    # bn-586 is the only one implementing bn_*_part_words
+    $cflags.=&quot; -DOPENSSL_BN_ASM_PART_WORDS&quot; if ($bn_obj =~ /bn-586/);
+    $cflags.=&quot; -DOPENSSL_IA32_SSE2&quot; if (!$no_sse2 &amp;&amp; $bn_obj =~ /86/);
 
-$cflags.=&quot; -DOPENSSL_BN_ASM_MONT&quot; if ($bn_obj =~ /-mont/);
-$cflags.=&quot; -DOPENSSL_BN_ASM_MONT5&quot; if ($bn_obj =~ /-mont5/);
-$cflags.=&quot; -DOPENSSL_BN_ASM_GF2m&quot; if ($bn_obj =~ /-gf2m/);
+    $cflags.=&quot; -DOPENSSL_BN_ASM_MONT&quot; if ($bn_obj =~ /-mont/);
+    $cflags.=&quot; -DOPENSSL_BN_ASM_MONT5&quot; if ($bn_obj =~ /-mont5/);
+    $cflags.=&quot; -DOPENSSL_BN_ASM_GF2m&quot; if ($bn_obj =~ /-gf2m/);
 
-if ($fips)
-	{
+    if ($fips) {
 	$openssl_other_defines.=&quot;#define OPENSSL_FIPS\n&quot;;
-	}
+    }
 
-$cpuid_obj=&quot;mem_clr.o&quot;	unless ($cpuid_obj =~ /\.o$/);
-$des_obj=$des_enc	unless ($des_obj =~ /\.o$/);
-$bf_obj=$bf_enc		unless ($bf_obj =~ /\.o$/);
-$cast_obj=$cast_enc	unless ($cast_obj =~ /\.o$/);
-$rc4_obj=$rc4_enc	unless ($rc4_obj =~ /\.o$/);
-$rc5_obj=$rc5_enc	unless ($rc5_obj =~ /\.o$/);
-if ($sha1_obj =~ /\.o$/)
-	{
-#	$sha1_obj=$sha1_enc;
+    if ($sha1_obj =~ /\.o$/) {
 	$cflags.=&quot; -DSHA1_ASM&quot;   if ($sha1_obj =~ /sx86/ || $sha1_obj =~ /sha1/);
 	$cflags.=&quot; -DSHA256_ASM&quot; if ($sha1_obj =~ /sha256/);
 	$cflags.=&quot; -DSHA512_ASM&quot; if ($sha1_obj =~ /sha512/);
-	if ($sha1_obj =~ /sse2/)
-	    {	if ($no_sse2)
-		{   $sha1_obj =~ s/\S*sse2\S+//;        }
-		elsif ($cflags !~ /OPENSSL_IA32_SSE2/)
-		{   $cflags.=&quot; -DOPENSSL_IA32_SSE2&quot;;    }
+	if ($sha1_obj =~ /sse2/) {
+	    if ($no_sse2) {
+		$sha1_obj =~ s/\S*sse2\S+//;
+	    } elsif ($cflags !~ /OPENSSL_IA32_SSE2/) {
+		$cflags.=&quot; -DOPENSSL_IA32_SSE2&quot;;
 	    }
 	}
-if ($md5_obj =~ /\.o$/)
-	{
-#	$md5_obj=$md5_enc;
+    }
+    if ($md5_obj =~ /\.o$/) {
 	$cflags.=&quot; -DMD5_ASM&quot;;
-	}
-if ($rmd160_obj =~ /\.o$/)
-	{
-#	$rmd160_obj=$rmd160_enc;
+    }
+    $cast_obj=$table{BASE}-&gt;{cast_obj} if (!$no_shared); # CAST assembler is not PIC
+    if ($rmd160_obj =~ /\.o$/) {
 	$cflags.=&quot; -DRMD160_ASM&quot;;
-	}
-if ($aes_obj =~ /\.o$/)
-	{
+    }
+    if ($aes_obj =~ /\.o$/) {
 	$cflags.=&quot; -DAES_ASM&quot; if ($aes_obj =~ m/\baes\-/);;
 	# aes-ctr.o is not a real file, only indication that assembler
 	# module implements AES_ctr32_encrypt...
@@ -1419,32 +1097,22 @@ if ($aes_obj =~ /\.o$/)
 	$aes_obj =~ s/\s*(vpaes|aesni)\-x86\.o//g if ($no_sse2);
 	$cflags.=&quot; -DVPAES_ASM&quot; if ($aes_obj =~ m/vpaes/);
 	$cflags.=&quot; -DBSAES_ASM&quot; if ($aes_obj =~ m/bsaes/);
-	}
-else	{
-	$aes_obj=$aes_enc;
-	}
-$wp_obj=&quot;&quot; if ($wp_obj =~ /mmx/ &amp;&amp; $processor eq &quot;386&quot;);
-if ($wp_obj =~ /\.o$/ &amp;&amp; !$disabled{&quot;whirlpool&quot;})
-	{
+    }
+    if ($wp_obj =~ /mmx/ &amp;&amp; $processor eq &quot;386&quot;) {
+	$wp_obj=$table{BASE}-&gt;{wp_obj};
+    } elsif (!$disabled{&quot;whirlpool&quot;}) {
 	$cflags.=&quot; -DWHIRLPOOL_ASM&quot;;
-	}
-else	{
-	$wp_obj=&quot;wp_block.o&quot;;
-	}
-$cmll_obj=$cmll_enc	unless ($cmll_obj =~ /.o$/);
-if ($modes_obj =~ /ghash\-/)
-	{
+    }
+    if ($modes_obj =~ /ghash\-/) {
 	$cflags.=&quot; -DGHASH_ASM&quot;;
-	}
-if ($ec_obj =~ /ecp_nistz256/)
-	{
+    }
+    if ($ec_obj =~ /ecp_nistz256/) {
 	$cflags.=&quot; -DECP_NISTZ256_ASM&quot;;
-	}
-$chacha_obj=$chacha_enc	unless ($chacha_obj =~ /\.o$/);
-if ($poly1305_obj =~ /\.o$/)
-	{
+    }
+    if ($poly1305_obj =~ /\.o$/) {
 	$cflags.=&quot; -DPOLY1305_ASM&quot;;
-	}
+    }
+}
 
 # &quot;Stringify&quot; the C flags string.  This permits it to be made part of a string
 # and works as well on command lines.
@@ -1771,7 +1439,6 @@ while (&lt;IN&gt;)
 			($export_var_as_fn)?&quot;define&quot;:&quot;undef&quot;; }
 	elsif	(/^#define\s+OPENSSL_UNISTD/)
 		{
-		$unistd = &quot;&lt;unistd.h&gt;&quot; if $unistd eq &quot;&quot;;
 		print OUT &quot;#define OPENSSL_UNISTD $unistd\n&quot;;
 		}
 	elsif	(/^#((define)|(undef))\s+SIXTY_FOUR_BIT_LONG/)
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003073.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="003076.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3074">[ date ]</a>
              <a href="thread.html#3074">[ thread ]</a>
              <a href="subject.html#3074">[ subject ]</a>
              <a href="author.html#3074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
