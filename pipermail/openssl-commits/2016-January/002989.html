<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1453130167.437291.21056.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002982.html">
   <LINK REL="Next"  HREF="002990.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Richard Levitte</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1453130167.437291.21056.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">levitte at openssl.org
       </A><BR>
    <I>Mon Jan 18 15:16:07 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002982.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="002990.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2989">[ date ]</a>
              <a href="thread.html#2989">[ thread ]</a>
              <a href="subject.html#2989">[ subject ]</a>
              <a href="author.html#2989">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  b9ee2dacbc9309275c972bc4b863f72dcc67dec1 (commit)
       via  3f54296955abe1c997e6a9ecdfebc74fe2b1ffed (commit)
       via  a717c110d25e3e3e197f6b8a9228f2601ca9c9af (commit)
       via  42b8f1427a8cdf320e51374a5fbfefc74bec0519 (commit)
       via  8d35ceb98f3dbd55cf55edc3d2a814d0dd6d520d (commit)
      from  23d526eca9251618b3f0d81c4a2ad6d4f25d7563 (commit)


- Log -----------------------------------------------------------------
commit b9ee2dacbc9309275c972bc4b863f72dcc67dec1
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jan 17 18:03:04 2016 +0100

    Add some extra Cygwin targets as aliases for Cygwin-x86
    
    Cygwin was used for x86 before, so let's keep it around for those who
    still use it (it make Configure reconf possible).
    Cygwin-i[3456]86 for those that might generate and pass a target name
    directly to Configure.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit 3f54296955abe1c997e6a9ecdfebc74fe2b1ffed
Author: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;
Date:   Sun Jan 17 17:48:53 2016 +0100

    Adjust the configuration target name from Cygwin-i686 to Cygwin-x86
    
    This is to reflect that it's not limited to just i686.
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;

commit a717c110d25e3e3e197f6b8a9228f2601ca9c9af
Author: Corinna Vinschen &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">vinschen at redhat.com</A>&gt;
Date:   Sun Jan 17 16:42:38 2016 +0100

    Fix configuration system to support different architectures on Cygwin.
    
    This patch allows to recognize the architectures supported by Cygwin
    and to choose the right configuration from there.  Drop -march to
    use default architecture on 32 bit x86.
    
    Drop pre-Cygwin-1.3 recognition since it's long gone and there's no
    valid configuration for this anymore.
    
    Signed-off-by: Corinna Vinschen &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">vinschen at redhat.com</A>&gt;
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 42b8f1427a8cdf320e51374a5fbfefc74bec0519
Author: Corinna Vinschen &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">vinschen at redhat.com</A>&gt;
Date:   Sat Jan 16 19:36:15 2016 +0100

    Don't strip object files on Cygwin
    
      Building for the Cygwin distro requires to be able to build debuginfo
      files.  This in turn requires to build object files without stripping.
      The stripping is performed by the next step after building which creates
      the debuginfo files.
    
    Signed-off-by: Corinna Vinschen &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">vinschen at redhat.com</A>&gt;
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

commit 8d35ceb98f3dbd55cf55edc3d2a814d0dd6d520d
Author: Corinna Vinschen &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">vinschen at redhat.com</A>&gt;
Date:   Sat Jan 16 19:30:48 2016 +0100

    Use POSIX functions on Cygwin, not Win32 function
    
    Signed-off-by: Corinna Vinschen &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">vinschen at redhat.com</A>&gt;
    
    Reviewed-by: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at openssl.org</A>&gt;
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 Configurations/10-main.conf     | 21 +++++++++++++++++++--
 Makefile.shared                 |  4 ++--
 apps/speed.c                    | 10 +---------
 config                          | 14 +++-----------
 crypto/async/arch/async_posix.h |  2 +-
 crypto/async/arch/async_win.h   |  2 +-
 include/openssl/async.h         |  2 +-
 test/asynctest.c                |  4 ++--
 8 files changed, 30 insertions(+), 29 deletions(-)

diff --git a/Configurations/10-main.conf b/Configurations/10-main.conf
index 2f5313e..06911ac 100644
--- a/Configurations/10-main.conf
+++ b/Configurations/10-main.conf
@@ -1221,10 +1221,10 @@
     },
 
 #### Cygwin
-    &quot;Cygwin&quot; =&gt; {
+    &quot;Cygwin-x86&quot; =&gt; {
         inherit_from     =&gt; [ asm(&quot;x86_asm&quot;) ],
         cc               =&gt; &quot;gcc&quot;,
-        cflags           =&gt; &quot;-DTERMIOS -DL_ENDIAN -march=i486 -Wall&quot;,
+        cflags           =&gt; &quot;-DTERMIOS -DL_ENDIAN -Wall&quot;,
         debug_cflags     =&gt; &quot;-g -O0&quot;,
         release_cflags   =&gt; &quot;-O3 -fomit-frame-pointer&quot;,
         sys_id           =&gt; &quot;CYGWIN&quot;,
@@ -1251,6 +1251,23 @@
         shared_ldflag    =&gt; &quot;-shared&quot;,
         shared_extension =&gt; &quot;.dll.a&quot;,
     },
+    # Backward compatibility for those using this target
+    &quot;Cygwin&quot; =&gt; {
+	inherit_from     =&gt; [ &quot;Cygwin-x86&quot; ]
+    },
+    # In case someone constructs the Cygwin target name themself
+    &quot;Cygwin-i386&quot; =&gt; {
+	inherit_from     =&gt; [ &quot;Cygwin-x86&quot; ]
+    },
+    &quot;Cygwin-i486&quot; =&gt; {
+	inherit_from     =&gt; [ &quot;Cygwin-x86&quot; ]
+    },
+    &quot;Cygwin-i586&quot; =&gt; {
+	inherit_from     =&gt; [ &quot;Cygwin-x86&quot; ]
+    },
+    &quot;Cygwin-i686&quot; =&gt; {
+	inherit_from     =&gt; [ &quot;Cygwin-x86&quot; ]
+    },
 
 #### NetWare from David Ward (<A HREF="../../../mailman/listinfo/openssl-commits.html">dsward at novell.com</A>)
 # requires either MetroWerks NLM development tools, or gcc / nlmconv
diff --git a/Makefile.shared b/Makefile.shared
index 208382e..0ff1a76 100644
--- a/Makefile.shared
+++ b/Makefile.shared
@@ -272,7 +272,7 @@ link_o.cygwin:
 	SHLIB_SOVER=${LIBVERSION:+&quot;-$(LIBVERSION)&quot;}; \
 	ALLSYMSFLAGS='-Wl,--whole-archive'; \
 	NOALLSYMSFLAGS='-Wl,--no-whole-archive'; \
-	SHAREDFLAGS=&quot;$(CFLAGS) $(SHARED_LDFLAGS) -shared $$base $$deffile -Wl,-s,-Bsymbolic&quot;; \
+	SHAREDFLAGS=&quot;$(CFLAGS) $(SHARED_LDFLAGS) -shared $$base $$deffile -Wl,-Bsymbolic&quot;; \
 	$(LINK_SO_O)
 #for mingw target if def-file is in use dll-name should match library-name
 link_a.cygwin:
@@ -297,7 +297,7 @@ link_a.cygwin:
 	extras=&quot;$$extras rc.o&quot;; \
 	ALLSYMSFLAGS='-Wl,--whole-archive'; \
 	NOALLSYMSFLAGS='-Wl,--no-whole-archive'; \
-	SHAREDFLAGS=&quot;$(CFLAGS) $(SHARED_LDFLAGS) -shared $$base -Wl,-s,-Bsymbolic -Wl,--out-implib,lib$(LIBNAME).dll.a $$extras&quot;; \
+	SHAREDFLAGS=&quot;$(CFLAGS) $(SHARED_LDFLAGS) -shared $$base -Wl,-Bsymbolic -Wl,--out-implib,lib$(LIBNAME).dll.a $$extras&quot;; \
 	[ -f apps/$$dll_name ] &amp;&amp; rm apps/$$dll_name; \
 	[ -f test/$$dll_name ] &amp;&amp; rm test/$$dll_name; \
 	$(LINK_SO_A) || exit 1; \
diff --git a/apps/speed.c b/apps/speed.c
index d45a6f9..5bf1685 100644
--- a/apps/speed.c
+++ b/apps/speed.c
@@ -94,16 +94,8 @@
 # include &lt;signal.h&gt;
 #endif
 
-#if defined(_WIN32) || defined(__CYGWIN__)
+#if defined(_WIN32)
 # include &lt;windows.h&gt;
-# if defined(__CYGWIN__) &amp;&amp; !defined(_WIN32)
-  /*
-   * &lt;windows.h&gt; should define _WIN32, which normally is mutually exclusive
-   * with __CYGWIN__, but if it didn't...
-   */
-#  define _WIN32
-  /* this is done because Cygwin alarm() fails sometimes. */
-# endif
 #endif
 
 #include &lt;openssl/bn.h&gt;
diff --git a/config b/config
index 1683f07..2b3b6d8 100755
--- a/config
+++ b/config
@@ -323,15 +323,7 @@ case &quot;${SYSTEM}:${RELEASE}:${VERSION}:${MACHINE}&quot; in
 	echo &quot;${MACHINE}-whatever-mingw&quot;; exit 0;
 	;;
     CYGWIN*)
-	case &quot;$RELEASE&quot; in
-	    [bB]*|1.0|1.[12].*)
-		echo &quot;${MACHINE}-whatever-cygwin_pre1.3&quot;
-		;;
-	    *)
-		echo &quot;${MACHINE}-whatever-cygwin&quot;
-		;;
-	esac
-	exit 0
+	echo &quot;${MACHINE}-pc-cygwin&quot;; exit 0
 	;;
 
     vxworks*)
@@ -814,8 +806,8 @@ case &quot;$GUESSOS&quot; in
 	fi
 	;;
   # these are all covered by the catchall below
-  *-*-cygwin_pre1.3) OUT=&quot;Cygwin-pre1.3&quot; ;;
-  *-*-cygwin) OUT=&quot;Cygwin&quot; ;;
+  i[3456]86-*-cygwin) OUT=&quot;Cygwin-x86&quot; ;;
+  *-*-cygwin) OUT=&quot;Cygwin-${MACHINE}&quot; ;;
   x86pc-*-qnx6) OUT=&quot;QNX6-i386&quot; ;;
   *-*-qnx6) OUT=&quot;QNX6&quot; ;;
   x86-*-android|i?86-*-android) OUT=&quot;android-x86&quot; ;;
diff --git a/crypto/async/arch/async_posix.h b/crypto/async/arch/async_posix.h
index c247888..475b56f 100644
--- a/crypto/async/arch/async_posix.h
+++ b/crypto/async/arch/async_posix.h
@@ -54,7 +54,7 @@
 #define OPENSSL_ASYNC_ARCH_ASYNC_POSIX_H
 #include &lt;openssl/e_os2.h&gt;
 
-#if defined(OPENSSL_SYS_UNIX) &amp;&amp; defined(OPENSSL_THREADS)
+#if (defined(OPENSSL_SYS_UNIX) || defined(OPENSSL_SYS_CYGWIN)) &amp;&amp; defined(OPENSSL_THREADS)
 
 # include &lt;unistd.h&gt;
 
diff --git a/crypto/async/arch/async_win.h b/crypto/async/arch/async_win.h
index b247f59..31f2482 100644
--- a/crypto/async/arch/async_win.h
+++ b/crypto/async/arch/async_win.h
@@ -55,7 +55,7 @@
  * This is the same detection used in cryptlib to set up the thread local
  * storage that we depend on, so just copy that
  */
-#if defined(_WIN32) || defined(__CYGWIN__)
+#if defined(_WIN32)
 #include &lt;openssl/async.h&gt;
 # define ASYNC_WIN
 # define ASYNC_ARCH
diff --git a/include/openssl/async.h b/include/openssl/async.h
index de5ef89..d130a36 100644
--- a/include/openssl/async.h
+++ b/include/openssl/async.h
@@ -56,7 +56,7 @@
 
 #include &lt;stdlib.h&gt;
 
-#if defined(_WIN32) || defined(__CYGWIN__)
+#if defined(_WIN32)
 #include &lt;windows.h&gt;
 #define OSSL_ASYNC_FD   HANDLE
 #else
diff --git a/test/asynctest.c b/test/asynctest.c
index 3e68b1d..ace52b9 100644
--- a/test/asynctest.c
+++ b/test/asynctest.c
@@ -62,12 +62,12 @@
 #include &lt;openssl/crypto.h&gt;
 #include &lt;../apps/apps.h&gt;
 
-#if defined(OPENSSL_SYS_UNIX) &amp;&amp; defined(OPENSSL_THREADS)
+#if (defined(OPENSSL_SYS_UNIX) || defined(OPENSSL_SYS_CYGWIN)) &amp;&amp; defined(OPENSSL_THREADS)
 # include &lt;unistd.h&gt;
 # if _POSIX_VERSION &gt;= 200112L
 #  define ASYNC_POSIX
 # endif
-#elif defined(_WIN32) || defined(__CYGWIN__)
+#elif defined(_WIN32)
 # define ASYNC_WIN
 #endif
 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002982.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="002990.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2989">[ date ]</a>
              <a href="thread.html#2989">[ thread ]</a>
              <a href="subject.html#2989">[ subject ]</a>
              <a href="author.html#2989">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
