<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2016-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1454104585.112951.16326.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003339.html">
   <LINK REL="Next"  HREF="003345.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl]  master update</H1>
    <B>Rich Salz</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20%20master%20update&In-Reply-To=%3C1454104585.112951.16326.nullmailer%40dev.openssl.org%3E"
       TITLE="[openssl-commits] [openssl]  master update">rsalz at openssl.org
       </A><BR>
    <I>Fri Jan 29 21:56:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="003339.html">[openssl-commits] [openssl]  master update
</A></li>
        <LI>Next message: <A HREF="003345.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3344">[ date ]</a>
              <a href="thread.html#3344">[ thread ]</a>
              <a href="subject.html#3344">[ subject ]</a>
              <a href="author.html#3344">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  ced2c2c598e195175950a67756d426052d38c228 (commit)
      from  56087077d81e2b888f4cbe7f70b2077dc5add90d (commit)


- Log -----------------------------------------------------------------
commit ced2c2c598e195175950a67756d426052d38c228
Author: Rich Salz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">rsalz at akamai.com</A>&gt;
Date:   Fri Jan 29 13:29:45 2016 -0500

    Templatize util/domd
    
    Reviewed-by: Richard Levitte &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">levitte at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 .gitignore                  |  1 +
 Configure                   |  6 +++++-
 Makefile.in                 |  3 ---
 apps/Makefile.in            |  2 +-
 crypto/Makefile.in          |  4 +---
 crypto/aes/Makefile.in      |  3 +--
 crypto/asn1/Makefile.in     |  3 +--
 crypto/async/Makefile.in    |  3 +--
 crypto/bf/Makefile.in       |  3 +--
 crypto/bio/Makefile.in      |  3 +--
 crypto/bn/Makefile.in       |  3 +--
 crypto/buffer/Makefile.in   |  3 +--
 crypto/camellia/Makefile.in |  3 +--
 crypto/cast/Makefile.in     |  3 +--
 crypto/chacha/Makefile.in   |  3 +--
 crypto/cmac/Makefile.in     |  3 +--
 crypto/cms/Makefile.in      |  3 +--
 crypto/comp/Makefile.in     |  3 +--
 crypto/conf/Makefile.in     |  3 +--
 crypto/ct/Makefile.in       |  3 +--
 crypto/des/Makefile.in      |  3 +--
 crypto/dh/Makefile.in       |  3 +--
 crypto/dsa/Makefile.in      |  3 +--
 crypto/dso/Makefile.in      |  3 +--
 crypto/ec/Makefile.in       |  3 +--
 crypto/engine/Makefile.in   |  3 +--
 crypto/err/Makefile.in      |  3 +--
 crypto/evp/Makefile.in      |  3 +--
 crypto/hmac/Makefile.in     |  3 +--
 crypto/idea/Makefile.in     |  3 +--
 crypto/jpake/Makefile.in    |  3 +--
 crypto/kdf/Makefile.in      |  3 +--
 crypto/lhash/Makefile.in    |  3 +--
 crypto/md2/Makefile.in      |  3 +--
 crypto/md4/Makefile.in      |  3 +--
 crypto/md5/Makefile.in      |  3 +--
 crypto/mdc2/Makefile.in     |  3 +--
 crypto/modes/Makefile.in    |  3 +--
 crypto/objects/Makefile.in  |  3 +--
 crypto/objects/obj_dat.h    |  1 +
 crypto/ocsp/Makefile.in     |  3 +--
 crypto/pem/Makefile.in      |  3 +--
 crypto/pkcs12/Makefile.in   |  3 +--
 crypto/pkcs7/Makefile.in    |  3 +--
 crypto/poly1305/Makefile.in |  3 +--
 crypto/rand/Makefile.in     |  3 +--
 crypto/rc2/Makefile.in      |  3 +--
 crypto/rc4/Makefile.in      |  3 +--
 crypto/rc5/Makefile.in      |  3 +--
 crypto/ripemd/Makefile.in   |  3 +--
 crypto/rsa/Makefile.in      |  3 +--
 crypto/seed/Makefile.in     |  3 +--
 crypto/sha/Makefile.in      |  3 +--
 crypto/srp/Makefile.in      |  5 +----
 crypto/stack/Makefile.in    |  3 +--
 crypto/store/Makefile.in    |  3 +--
 crypto/ts/Makefile.in       |  6 +-----
 crypto/txt_db/Makefile.in   |  3 +--
 crypto/ui/Makefile.in       |  3 +--
 crypto/whrlpool/Makefile.in |  3 +--
 crypto/x509/Makefile.in     |  3 +--
 crypto/x509v3/Makefile.in   |  3 +--
 engines/Makefile.in         |  2 +-
 ssl/Makefile.in             |  2 +-
 test/Makefile.in            |  2 +-
 util/domd                   | 34 ----------------------------------
 util/domd.in                | 25 +++++++++++++++++++++++++
 util/mk1mf.pl               |  2 +-
 68 files changed, 94 insertions(+), 163 deletions(-)
 delete mode 100755 util/domd
 create mode 100755 util/domd.in

diff --git a/.gitignore b/.gitignore
index e8d5105..4bbd89b 100644
--- a/.gitignore
+++ b/.gitignore
@@ -44,6 +44,7 @@
 /crypto/buildinf.h
 /openssl/include/opensslconf.h
 /crypto/include/internal/*_conf.h
+util/domd
 
 # Auto generated assembly language source files
 *.s
diff --git a/Configure b/Configure
index dd3d886..d91ed57 100755
--- a/Configure
+++ b/Configure
@@ -1292,6 +1292,9 @@ print &quot;RC2 uses $config{rc2_int}\n&quot; if $config{rc2_int} != $def_int;
 
 run_dofile(&quot;$Makefile.in&quot;,&quot;$Makefile&quot;);
 
+run_dofile(&quot;util/domd.in&quot;, &quot;util/domd&quot;);
+chmod 0755, &quot;util/domd&quot;;
+
 run_dofile(&quot;include/openssl/opensslconf.h.in&quot;, &quot;include/openssl/opensslconf.h&quot;);
 
 foreach my $alg ( 'bn' ) {
@@ -1664,8 +1667,9 @@ sub run_dofile()
     my $in = shift;
     my $out = shift;
 
+    unlink $out || warn &quot;Can't remove $out, $!&quot;
+        if -f $out;
     die &quot;Can't open $in, $!&quot; unless -f $in;
-    # should we remove $out ?
     system(&quot;$config{perl} -I. -Mconfigdata util/dofile.pl -o\&quot;Configure\&quot; $in &gt; $out.new&quot;);
     exit 1 if $? != 0;
     rename(&quot;$out.new&quot;, $out) || die &quot;Can't rename $out.new, $!&quot;;
diff --git a/Makefile.in b/Makefile.in
index 4abda22..09f5db3 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -74,7 +74,6 @@ PERL= {- $config{perl} -}
 RM= rm -f
 TAR= tar
 TARFLAGS= --no-recursion
-MAKEDEPPROG=$(CROSS_COMPILE){- $config{makedepprog} -}
 LIBDIR={- $config{libdir} -}
 
 # We let the C compiler driver to take care of .s files. This is done in
@@ -209,9 +208,7 @@ BUILDENV=	LC_ALL=C PLATFORM='$(PLATFORM)' PROCESSOR='$(PROCESSOR)'\
 		INSTALL_PREFIX='$(INSTALL_PREFIX)'		\
 		INSTALLTOP='$(INSTALLTOP)' OPENSSLDIR='$(OPENSSLDIR)'	\
 		LIBDIR='$(LIBDIR)'				\
-		MAKEDEPEND='$$$${TOP}/util/domd $$$${TOP} -MD $(MAKEDEPPROG)' \
 		DEPFLAG='$(DEPFLAG)'                    	\
-		MAKEDEPPROG='$(MAKEDEPPROG)'			\
 		SHARED_LDFLAGS='$(SHARED_LDFLAGS)'		\
 		ZLIB_INCLUDE='$(ZLIB_INCLUDE)' LIBZLIB='$(LIBZLIB)'	\
 		EXE_EXT='$(EXE_EXT)' SHARED_LIBS='$(SHARED_LIBS)'	\
diff --git a/apps/Makefile.in b/apps/Makefile.in
index 6be42c1..02585a7 100644
--- a/apps/Makefile.in
+++ b/apps/Makefile.in
@@ -111,7 +111,7 @@ uninstall:
 generate: openssl-vms.cnf
 
 depend:
-	@[ -z &quot;$(THIS)&quot; ] || $(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(EXE_SRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(EXE_SRC)
 
 clean:
 	rm -f *.o *.obj *.dll lib tags core .pure .nfs* *.old *.bak fluff $(EXE)
diff --git a/crypto/Makefile.in b/crypto/Makefile.in
index 56a83e1..331bbd8 100644
--- a/crypto/Makefile.in
+++ b/crypto/Makefile.in
@@ -9,8 +9,6 @@ INCLUDE=	-I. -I$(TOP) -I../include -Iinclude $(ZLIB_INCLUDE)
 # INCLUDES targets sudbirs!
 INCLUDES=	-I.. -I../.. -I../modes -I../include -I../../include $(ZLIB_INCLUDE)
 CFLAG=		-g
-MAKEDEPPROG=	makedepend
-MAKEDEPEND=	$(TOP)/util/domd $(TOP) -MD $(MAKEDEPPROG)
 MAKEFILE=       Makefile
 RM=             rm -f
 AR=		ar r
@@ -109,7 +107,7 @@ libs:
 
 depend:
 	@[ -z &quot;$(THIS)&quot; -o -f buildinf.h ] || touch buildinf.h # fake buildinf.h if it does not exist
-	@[ -z &quot;$(THIS)&quot; ] || $(MAKEDEPEND) -- $(CFLAG) $(INCLUDE) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	@[ -z &quot;$(THIS)&quot; ] || $(TOP)/util/domd $(CFLAG) $(INCLUDE) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 	@[ -z &quot;$(THIS)&quot; -o -s buildinf.h ] || rm buildinf.h
 	@[ -z &quot;$(THIS)&quot; ] || (set -e; target=depend; $(RECURSIVE_MAKE) )
 	@if [ -z &quot;$(THIS)&quot; ]; then $(MAKE) -f $(TOP)/Makefile reflect THIS=$@; fi
diff --git a/crypto/aes/Makefile.in b/crypto/aes/Makefile.in
index ba397bb..e87e80b 100644
--- a/crypto/aes/Makefile.in
+++ b/crypto/aes/Makefile.in
@@ -101,8 +101,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl &quot;AES_ENC=$(AES_ENC)&quot; Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/asn1/Makefile.in b/crypto/asn1/Makefile.in
index b00f308..c96e1fb 100644
--- a/crypto/asn1/Makefile.in
+++ b/crypto/asn1/Makefile.in
@@ -72,8 +72,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by top Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/async/Makefile.in b/crypto/async/Makefile.in
index 34a9136..c50b04d 100644
--- a/crypto/async/Makefile.in
+++ b/crypto/async/Makefile.in
@@ -53,8 +53,7 @@ install:
 	done;
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/bf/Makefile.in b/crypto/bf/Makefile.in
index dd7609d..408be9f 100644
--- a/crypto/bf/Makefile.in
+++ b/crypto/bf/Makefile.in
@@ -46,8 +46,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/bio/Makefile.in b/crypto/bio/Makefile.in
index 263af7c..e4ba255 100644
--- a/crypto/bio/Makefile.in
+++ b/crypto/bio/Makefile.in
@@ -50,8 +50,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/bn/Makefile.in b/crypto/bn/Makefile.in
index 964f8ec..ebae393 100644
--- a/crypto/bn/Makefile.in
+++ b/crypto/bn/Makefile.in
@@ -153,8 +153,7 @@ div:
 generate: bn_prime.h
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/buffer/Makefile.in b/crypto/buffer/Makefile.in
index 53493b7..595e1d8 100644
--- a/crypto/buffer/Makefile.in
+++ b/crypto/buffer/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/camellia/Makefile.in b/crypto/camellia/Makefile.in
index f26b541..787b1c6 100644
--- a/crypto/camellia/Makefile.in
+++ b/crypto/camellia/Makefile.in
@@ -52,8 +52,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/cast/Makefile.in b/crypto/cast/Makefile.in
index 6d6b6aa..6cf4c5c 100644
--- a/crypto/cast/Makefile.in
+++ b/crypto/cast/Makefile.in
@@ -46,8 +46,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/chacha/Makefile.in b/crypto/chacha/Makefile.in
index 6ea517d..0590708 100644
--- a/crypto/chacha/Makefile.in
+++ b/crypto/chacha/Makefile.in
@@ -40,8 +40,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/cmac/Makefile.in b/crypto/cmac/Makefile.in
index 92e145e..45c4b97 100644
--- a/crypto/cmac/Makefile.in
+++ b/crypto/cmac/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/cms/Makefile.in b/crypto/cms/Makefile.in
index 4726b01..e68438c 100644
--- a/crypto/cms/Makefile.in
+++ b/crypto/cms/Makefile.in
@@ -44,8 +44,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/comp/Makefile.in b/crypto/comp/Makefile.in
index a724b08..0fdf773 100644
--- a/crypto/comp/Makefile.in
+++ b/crypto/comp/Makefile.in
@@ -41,8 +41,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/conf/Makefile.in b/crypto/conf/Makefile.in
index 87f39d9..501d9e9 100644
--- a/crypto/conf/Makefile.in
+++ b/crypto/conf/Makefile.in
@@ -41,8 +41,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/ct/Makefile.in b/crypto/ct/Makefile.in
index 71ea255..f5e51e2 100644
--- a/crypto/ct/Makefile.in
+++ b/crypto/ct/Makefile.in
@@ -43,8 +43,7 @@ errors:
 	$(PERL) $(TOP)/util/mkerr.pl -conf ct.ec -hprefix internal/ -write *.c
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/des/Makefile.in b/crypto/des/Makefile.in
index b06a264..c2403f5 100644
--- a/crypto/des/Makefile.in
+++ b/crypto/des/Makefile.in
@@ -67,8 +67,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj des lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/dh/Makefile.in b/crypto/dh/Makefile.in
index 48df452..308b2a8 100644
--- a/crypto/dh/Makefile.in
+++ b/crypto/dh/Makefile.in
@@ -40,8 +40,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/dsa/Makefile.in b/crypto/dsa/Makefile.in
index ad25459..de2468d 100644
--- a/crypto/dsa/Makefile.in
+++ b/crypto/dsa/Makefile.in
@@ -40,8 +40,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/dso/Makefile.in b/crypto/dso/Makefile.in
index caa9621..e6e4de7 100644
--- a/crypto/dso/Makefile.in
+++ b/crypto/dso/Makefile.in
@@ -40,8 +40,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/ec/Makefile.in b/crypto/ec/Makefile.in
index 7efaf74..c241b13 100644
--- a/crypto/ec/Makefile.in
+++ b/crypto/ec/Makefile.in
@@ -67,8 +67,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/engine/Makefile.in b/crypto/engine/Makefile.in
index 18cda34..c93021f 100644
--- a/crypto/engine/Makefile.in
+++ b/crypto/engine/Makefile.in
@@ -48,8 +48,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/err/Makefile.in b/crypto/err/Makefile.in
index 8a60c66..93ce3ea 100644
--- a/crypto/err/Makefile.in
+++ b/crypto/err/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/evp/Makefile.in b/crypto/evp/Makefile.in
index 3282754..8771a20 100644
--- a/crypto/evp/Makefile.in
+++ b/crypto/evp/Makefile.in
@@ -63,8 +63,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/hmac/Makefile.in b/crypto/hmac/Makefile.in
index 22d0634..fbff69e 100644
--- a/crypto/hmac/Makefile.in
+++ b/crypto/hmac/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/idea/Makefile.in b/crypto/idea/Makefile.in
index 695119c..9a3169b 100644
--- a/crypto/idea/Makefile.in
+++ b/crypto/idea/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/jpake/Makefile.in b/crypto/jpake/Makefile.in
index 2780a12..9a75fae 100644
--- a/crypto/jpake/Makefile.in
+++ b/crypto/jpake/Makefile.in
@@ -28,8 +28,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj des lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/kdf/Makefile.in b/crypto/kdf/Makefile.in
index 25798af..337f3a7 100644
--- a/crypto/kdf/Makefile.in
+++ b/crypto/kdf/Makefile.in
@@ -48,8 +48,7 @@ lint:
 update: depend
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/lhash/Makefile.in b/crypto/lhash/Makefile.in
index c8a7fba..d01faaa 100644
--- a/crypto/lhash/Makefile.in
+++ b/crypto/lhash/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/md2/Makefile.in b/crypto/md2/Makefile.in
index 2d38fdd..3a16c01 100644
--- a/crypto/md2/Makefile.in
+++ b/crypto/md2/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/md4/Makefile.in b/crypto/md4/Makefile.in
index 450b149..aa4b647 100644
--- a/crypto/md4/Makefile.in
+++ b/crypto/md4/Makefile.in
@@ -39,8 +39,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f asm/mx86unix.cpp *.o asm/*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/md5/Makefile.in b/crypto/md5/Makefile.in
index 8d334ce..c597188 100644
--- a/crypto/md5/Makefile.in
+++ b/crypto/md5/Makefile.in
@@ -56,8 +56,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/mdc2/Makefile.in b/crypto/mdc2/Makefile.in
index 2795760..de42139 100644
--- a/crypto/mdc2/Makefile.in
+++ b/crypto/mdc2/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/modes/Makefile.in b/crypto/modes/Makefile.in
index 4f6a945..1391d72 100644
--- a/crypto/modes/Makefile.in
+++ b/crypto/modes/Makefile.in
@@ -71,8 +71,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/objects/Makefile.in b/crypto/objects/Makefile.in
index 826d571..a733836 100644
--- a/crypto/objects/Makefile.in
+++ b/crypto/objects/Makefile.in
@@ -53,8 +53,7 @@ files:
 generate: obj_dat.h ../../include/openssl/obj_mac.h obj_xref.h
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/objects/obj_dat.h b/crypto/objects/obj_dat.h
index a3d94a5..6907bc3 100644
--- a/crypto/objects/obj_dat.h
+++ b/crypto/objects/obj_dat.h
@@ -5647,3 +5647,4 @@ static const unsigned int obj_objs[NUM_OBJ]={
 956,	/* OBJ_jurisdictionStateOrProvinceName 1 3 6 1 4 1 311 60 2 1 2 */
 957,	/* OBJ_jurisdictionCountryName      1 3 6 1 4 1 311 60 2 1 3 */
 };
+
diff --git a/crypto/ocsp/Makefile.in b/crypto/ocsp/Makefile.in
index 4b301ab..ae5f605 100644
--- a/crypto/ocsp/Makefile.in
+++ b/crypto/ocsp/Makefile.in
@@ -41,8 +41,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/pem/Makefile.in b/crypto/pem/Makefile.in
index 117ff18..d30c0dd 100644
--- a/crypto/pem/Makefile.in
+++ b/crypto/pem/Makefile.in
@@ -41,8 +41,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/pkcs12/Makefile.in b/crypto/pkcs12/Makefile.in
index e116cc1..66ef8ca 100644
--- a/crypto/pkcs12/Makefile.in
+++ b/crypto/pkcs12/Makefile.in
@@ -44,8 +44,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/pkcs7/Makefile.in b/crypto/pkcs7/Makefile.in
index 7c89578..c2ee429 100644
--- a/crypto/pkcs7/Makefile.in
+++ b/crypto/pkcs7/Makefile.in
@@ -45,8 +45,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff enc dec sign verify
diff --git a/crypto/poly1305/Makefile.in b/crypto/poly1305/Makefile.in
index 17e14ec..6498ffc 100644
--- a/crypto/poly1305/Makefile.in
+++ b/crypto/poly1305/Makefile.in
@@ -40,8 +40,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/rand/Makefile.in b/crypto/rand/Makefile.in
index 038632b..e408b6b 100644
--- a/crypto/rand/Makefile.in
+++ b/crypto/rand/Makefile.in
@@ -40,8 +40,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/rc2/Makefile.in b/crypto/rc2/Makefile.in
index 348f714..88f20a5 100644
--- a/crypto/rc2/Makefile.in
+++ b/crypto/rc2/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/rc4/Makefile.in b/crypto/rc4/Makefile.in
index fc820a1..df53b27 100644
--- a/crypto/rc4/Makefile.in
+++ b/crypto/rc4/Makefile.in
@@ -66,8 +66,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/rc5/Makefile.in b/crypto/rc5/Makefile.in
index d215b25..bd8e8b2 100644
--- a/crypto/rc5/Makefile.in
+++ b/crypto/rc5/Makefile.in
@@ -46,8 +46,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/ripemd/Makefile.in b/crypto/ripemd/Makefile.in
index 158c724..8679016 100644
--- a/crypto/ripemd/Makefile.in
+++ b/crypto/ripemd/Makefile.in
@@ -46,8 +46,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/rsa/Makefile.in b/crypto/rsa/Makefile.in
index 6858a0a..21d5790 100644
--- a/crypto/rsa/Makefile.in
+++ b/crypto/rsa/Makefile.in
@@ -44,8 +44,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/seed/Makefile.in b/crypto/seed/Makefile.in
index e572d4b..2495639 100644
--- a/crypto/seed/Makefile.in
+++ b/crypto/seed/Makefile.in
@@ -39,8 +39,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/sha/Makefile.in b/crypto/sha/Makefile.in
index 964be2b..41b2c8b 100644
--- a/crypto/sha/Makefile.in
+++ b/crypto/sha/Makefile.in
@@ -101,8 +101,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/srp/Makefile.in b/crypto/srp/Makefile.in
index a347a10..3b654da 100644
--- a/crypto/srp/Makefile.in
+++ b/crypto/srp/Makefile.in
@@ -6,9 +6,6 @@ CFLAG=-g
 INSTALL_PREFIX=
 OPENSSLDIR=     /usr/local/ssl
 INSTALLTOP=/usr/local/ssl
-MAKEDEPPROG=	makedepend
-MAKEDEPEND=	$(TOP)/util/domd $(TOP) -MD $(MAKEDEPPROG)
-MAKEFILE=	Makefile.ssl
 AR=		ar r
 
 CFLAGS= $(INCLUDES) $(CFLAG)
@@ -37,7 +34,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/stack/Makefile.in b/crypto/stack/Makefile.in
index 1e83061..dc9fec4 100644
--- a/crypto/stack/Makefile.in
+++ b/crypto/stack/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/store/Makefile.in b/crypto/store/Makefile.in
index 47f08f8..0347783 100644
--- a/crypto/store/Makefile.in
+++ b/crypto/store/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/ts/Makefile.in b/crypto/ts/Makefile.in
index 8fe12fc..4001e8f 100644
--- a/crypto/ts/Makefile.in
+++ b/crypto/ts/Makefile.in
@@ -1,5 +1,4 @@
 #
-# SSLeay/crypto/ts/Makefile
 #
 
 DIR=	ts
@@ -10,9 +9,6 @@ CFLAG = -g
 INSTALL_PREFIX=
 OPENSSLDIR=     /usr/local/ssl
 INSTALLTOP=/usr/local/ssl
-MAKEDEPPROG=	makedepend
-MAKEDEPEND=	$(TOP)/util/domd $(TOP) -MD $(MAKEDEPPROG)
-MAKEFILE=	Makefile
 AR=		ar r
 
 LDFLAGS=
@@ -52,7 +48,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff enc dec sign verify
diff --git a/crypto/txt_db/Makefile.in b/crypto/txt_db/Makefile.in
index 9241f9b..036333c 100644
--- a/crypto/txt_db/Makefile.in
+++ b/crypto/txt_db/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by top Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/ui/Makefile.in b/crypto/ui/Makefile.in
index 71da5a9..ecca10d 100644
--- a/crypto/ui/Makefile.in
+++ b/crypto/ui/Makefile.in
@@ -38,8 +38,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o */*.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/whrlpool/Makefile.in b/crypto/whrlpool/Makefile.in
index e44e153..abeae3b 100644
--- a/crypto/whrlpool/Makefile.in
+++ b/crypto/whrlpool/Makefile.in
@@ -51,8 +51,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.s *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/x509/Makefile.in b/crypto/x509/Makefile.in
index e9cd1ca..c3691f2 100644
--- a/crypto/x509/Makefile.in
+++ b/crypto/x509/Makefile.in
@@ -52,8 +52,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/crypto/x509v3/Makefile.in b/crypto/x509v3/Makefile.in
index c35f87c..c5edce9 100644
--- a/crypto/x509v3/Makefile.in
+++ b/crypto/x509v3/Makefile.in
@@ -48,8 +48,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -n &quot;$(MAKEDEPEND)&quot; ] # should be set by upper Makefile...
-	$(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f *.o *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/engines/Makefile.in b/engines/Makefile.in
index d91bd54..a515dc1 100644
--- a/engines/Makefile.in
+++ b/engines/Makefile.in
@@ -116,7 +116,7 @@ errors:
 	done
 
 depend:
-	@[ -z &quot;$(THIS)&quot; ] || $(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC) $(TESTLIBSRC)
+	@[ -z &quot;$(THIS)&quot; ] || $(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC) $(TESTLIBSRC)
 	@[ -z &quot;$(THIS)&quot; ] || (set -e; target=depend; $(RECURSIVE_MAKE) )
 
 clean:
diff --git a/ssl/Makefile.in b/ssl/Makefile.in
index b3860d3..586d287 100644
--- a/ssl/Makefile.in
+++ b/ssl/Makefile.in
@@ -72,7 +72,7 @@ files:
 	$(PERL) $(TOP)/util/files.pl Makefile &gt;&gt; $(TOP)/MINFO
 
 depend:
-	@[ -z &quot;$(THIS)&quot; ] || $(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(LIBSRC)
 
 clean:
 	rm -f $(LIBOBJ) *.obj lib tags core .pure .nfs* *.old *.bak fluff
diff --git a/test/Makefile.in b/test/Makefile.in
index 9dbf549..cf6e816 100644
--- a/test/Makefile.in
+++ b/test/Makefile.in
@@ -163,7 +163,7 @@ apps:
 	@(cd ..; $(MAKE) DIRS=apps all)
 
 depend:
-	@[ -z &quot;$(THIS)&quot; ] || $(MAKEDEPEND) -- $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(SRC)
+	$(TOP)/util/domd $(CFLAG) $(INCLUDES) $(DEPFLAG) -- $(PROGS) $(SRC)
 
 clean:
 	rm -f .rnd tmp.bntest tmp.bctest *.o *.obj *.dll lib tags core .pure .nfs* *.old *.bak fluff $(EXE) *.ss *.srl log *.log dummytest
diff --git a/util/domd b/util/domd
deleted file mode 100755
index 9dd7ce5..0000000
--- a/util/domd
+++ /dev/null
@@ -1,34 +0,0 @@
-#!/bin/sh
-# Wrapper to portably run makedepend or equivalent compiler built-in.
-# Runs on Makefile.in, generates Makefile
-
-TOP=$1
-shift
-if [ &quot;$1&quot; = &quot;-MD&quot; ]; then
-    shift
-    MAKEDEPEND=$1
-    shift
-    if [ &quot;$MAKEDEPEND&quot; = &quot;ccache&quot; ]; then
-        MAKEDEPEND=&quot;$MAKEDEPEND $1&quot;
-        shift
-    fi
-fi
-if [ -z &quot;$MAKEDEPEND&quot; ] ; then
-    MAKEDEPEND=makedepend
-fi
-
-if ${MAKEDEPEND} --version 2&gt;&amp;1 | egrep &quot;clang|gcc&quot; &gt;/dev/null ; then
-    args=&quot;&quot;
-    while [ $# -gt 0 ]; do
-        if [ &quot;$1&quot; != '--' ] ; then
-            args=&quot;$args $1&quot;
-        fi
-	shift
-    done
-    ${MAKEDEPEND} -Werror -DOPENSSL_DOING_MAKEDEPEND -M $args &gt;Makefile.tmp || exit 1
-    cat Makefile.in Makefile.tmp &gt;Makefile
-    rm Makefile.tmp
-else
-    cp Makefile.in Makefile
-    ${MAKEDEPEND} -DOPENSSL_DOING_MAKEDEPEND $@ || exit 1
-fi
diff --git a/util/domd.in b/util/domd.in
new file mode 100755
index 0000000..ede2733
--- /dev/null
+++ b/util/domd.in
@@ -0,0 +1,25 @@
+#!/bin/sh
+## Wrapper to portably run makedepend or equivalent compiler built-in.
+## Runs on Makefile.in, generates Makefile
+## {- join(&quot;\n## &quot;, @autowarntext) -}
+
+{- &quot;MAKEDEPEND=&quot; . quotify1($config{makedepprog}) -}
+
+case &quot;${MAKEDEPEND}&quot; in
+makedepend)
+    cp Makefile.in Makefile
+    ${MAKEDEPEND} -DOPENSSL_DOING_MAKEDEPEND $@ || exit 1
+    ;;
+*)
+    args=&quot;-Werror -M&quot;
+    while [ $# -gt 0 ]; do
+        if [ &quot;$1&quot; != '--' ] ; then
+            args=&quot;$args $1&quot;
+        fi
+        shift
+    done
+    ${MAKEDEPEND} -DOPENSSL_DOING_MAKEDEPEND $args &gt;Makefile.tmp || exit 1
+    cat Makefile.in Makefile.tmp &gt;Makefile
+    rm Makefile.tmp
+    ;;
+esac
diff --git a/util/mk1mf.pl b/util/mk1mf.pl
index 98e44b0..f9eeea8 100755
--- a/util/mk1mf.pl
+++ b/util/mk1mf.pl
@@ -50,7 +50,7 @@ my %mf_import = (
 	PLATFORM       =&gt; \$mf_platform,
 	CC             =&gt; \$mf_cc,
 	CFLAG	       =&gt; \$mf_cflag,
-	DEPFLAG	       =&gt; \$mf_depflag,
+        DEPFLAG        =&gt; \$mf_depflag,
 	CPUID_OBJ      =&gt; \$mf_cpuid_asm,
 	BN_ASM	       =&gt; \$mf_bn_asm,
 	DES_ENC	       =&gt; \$mf_des_asm,
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003339.html">[openssl-commits] [openssl]  master update
</A></li>
	<LI>Next message: <A HREF="003345.html">[openssl-commits] [openssl]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3344">[ date ]</a>
              <a href="thread.html#3344">[ thread ]</a>
              <a href="subject.html#3344">[ subject ]</a>
              <a href="author.html#3344">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
