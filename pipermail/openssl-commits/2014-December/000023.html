<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl] OpenSSL source code branch master	updated. 5b17b79a895bb9eace11d4596acadaa2ed69cf2d
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2014-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20OpenSSL%20source%20code%20branch%20master%0A%09updated.%205b17b79a895bb9eace11d4596acadaa2ed69cf2d&In-Reply-To=%3C20141210173544.5C7F31DF120%40openssl.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000022.html">
   <LINK REL="Next"  HREF="000024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl] OpenSSL source code branch master	updated. 5b17b79a895bb9eace11d4596acadaa2ed69cf2d</H1>
    <B>Kurt Roeckx</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20OpenSSL%20source%20code%20branch%20master%0A%09updated.%205b17b79a895bb9eace11d4596acadaa2ed69cf2d&In-Reply-To=%3C20141210173544.5C7F31DF120%40openssl.net%3E"
       TITLE="[openssl-commits] [openssl] OpenSSL source code branch master	updated. 5b17b79a895bb9eace11d4596acadaa2ed69cf2d">kurt at openssl.org
       </A><BR>
    <I>Wed Dec 10 12:35:44 EST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000022.html">[openssl-commits] [web] OpenSSL Web Pages branch master updated.	e5c274d21c041d789fc2be297e29130194f83095
</A></li>
        <LI>Next message: <A HREF="000024.html">[openssl-commits] [web] OpenSSL Web Pages branch master updated.	1c90fbd4f1a896ba8ff2020c4b19584ea58e7255
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23">[ date ]</a>
              <a href="thread.html#23">[ thread ]</a>
              <a href="subject.html#23">[ subject ]</a>
              <a href="author.html#23">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;OpenSSL source code&quot;.

The branch, master has been updated
       via  5b17b79a895bb9eace11d4596acadaa2ed69cf2d (commit)
       via  3a7581bf5ae3579e506b18f4b36c266c84890450 (commit)
       via  288b4e4f8f97069db63fdca6f6dddcf56282b03d (commit)
       via  c27dc3981cd676cdd6dba00b06d6146545fc63fc (commit)
       via  fed5b5525204a6892c936173d9336c479fa83941 (commit)
       via  e9e688effbd5f94e9a8614ca0181a9c8a596a6e1 (commit)
       via  bf8e7047aa888bdba4a89fd0d03862ebec2d302c (commit)
       via  9052ffda912a48bfb0f6aa1555a97e313ee54642 (commit)
       via  d00b1d62d62036dc21c78658a28da4a6279e6fe2 (commit)
      from  02a62d1a4ab711e935defb6e61c2564130ff8627 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 5b17b79a895bb9eace11d4596acadaa2ed69cf2d
Author: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
Date:   Mon Dec 9 22:03:34 2013 +0100

    capi_ctrl, capi_vtrace: check for NULL after allocating and free it
    
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit 3a7581bf5ae3579e506b18f4b36c266c84890450
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Mon Dec 9 22:02:35 2013 +0100

    tree_print: check for NULL after allocating err
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit 288b4e4f8f97069db63fdca6f6dddcf56282b03d
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Mon Dec 9 17:21:43 2013 +0100

    tls1_heartbeat: check for NULL after allocating buf
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit c27dc3981cd676cdd6dba00b06d6146545fc63fc
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Sun Dec 7 17:38:51 2014 +0100

    tls1_process_heartbeat: check for NULL after allocating buffer
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit fed5b5525204a6892c936173d9336c479fa83941
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Mon Dec 9 17:02:44 2013 +0100

    SSL_set_session: check for NULL after allocating s-&gt;kssl_ctx-&gt;client_princ
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit e9e688effbd5f94e9a8614ca0181a9c8a596a6e1
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Mon Dec 9 16:57:04 2013 +0100

    serverinfo_process_buffer: check result of realloc(ctx-&gt;cert-&gt;key-&gt;serverinfo) and don't leak memory if it fails
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit bf8e7047aa888bdba4a89fd0d03862ebec2d302c
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Mon Dec 9 16:45:44 2013 +0100

    ssl3_digest_cached_records: check for NULL after allocating s-&gt;s3-&gt;handshake_dgst
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit 9052ffda912a48bfb0f6aa1555a97e313ee54642
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Sun Dec 8 23:30:09 2013 +0100

    ssl3_get_certificate_request: check for NULL after allocating s-&gt;cert-&gt;ctypes
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

commit d00b1d62d62036dc21c78658a28da4a6279e6fe2
Author: Jonas Maebe &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">jonas.maebe at elis.ugent.be</A>&gt;
Date:   Mon Dec 2 22:07:02 2013 +0100

    SSL_COMP_add_compression_method: exit if allocating the new compression method struct fails
    
    Signed-off-by: Kurt Roeckx &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">kurt at roeckx.be</A>&gt;
    Reviewed-by: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 crypto/x509v3/pcy_tree.c |    2 ++
 engines/e_capi.c         |   11 +++++++++++
 engines/e_capi_err.c     |    4 +++-
 engines/e_capi_err.h     |    2 ++
 ssl/s3_clnt.c            |    5 +++++
 ssl/s3_enc.c             |    5 +++++
 ssl/ssl.h                |    1 +
 ssl/ssl_ciph.c           |    7 +++++++
 ssl/ssl_err.c            |    1 +
 ssl/ssl_rsa.c            |    7 +++++--
 ssl/ssl_sess.c           |    5 +++++
 ssl/t1_lib.c             |   10 ++++++++++
 12 files changed, 57 insertions(+), 3 deletions(-)

diff --git a/crypto/x509v3/pcy_tree.c b/crypto/x509v3/pcy_tree.c
index 47b1bf8..93470c3 100644
--- a/crypto/x509v3/pcy_tree.c
+++ b/crypto/x509v3/pcy_tree.c
@@ -101,6 +101,8 @@ static void tree_print(char *str, X509_POLICY_TREE *tree,
 	int i;
 	BIO *err;
 	err = BIO_new_fp(stderr, BIO_NOCLOSE);
+	if (err == NULL)
+		return;
 	if (!curr)
 		curr = tree-&gt;levels + tree-&gt;nlevel;
 	else
diff --git a/engines/e_capi.c b/engines/e_capi.c
index 87a10dd..8a19ed0 100644
--- a/engines/e_capi.c
+++ b/engines/e_capi.c
@@ -340,6 +340,11 @@ static int capi_ctrl(ENGINE *e, int cmd, long i, void *p, void (*f)(void))
 		}
 	ctx = ENGINE_get_ex_data(e, capi_idx);
 	out = BIO_new_fp(stdout, BIO_NOCLOSE);
+	if (out == NULL)
+		{
+		CAPIerr(CAPI_F_CAPI_CTRL, CAPI_R_FILE_OPEN_ERROR);
+		return 0;
+		}
 	switch (cmd)
 		{
 		case CAPI_CMD_LIST_CSPS:
@@ -406,6 +411,7 @@ static int capi_ctrl(ENGINE *e, int cmd, long i, void *p, void (*f)(void))
 		if (i &lt; 1 || i &gt; 3)
 			{
 			CAPIerr(CAPI_F_CAPI_CTRL, CAPI_R_INVALID_LOOKUP_METHOD);
+			BIO_free(out);
 			return 0;
 			}
 		ctx-&gt;lookup_method = i;
@@ -1081,6 +1087,11 @@ static void capi_vtrace(CAPI_CTX *ctx, int level, char *format, va_list argptr)
 	if (!ctx || (ctx-&gt;debug_level &lt; level) || (!ctx-&gt;debug_file))
 		return;
 	out = BIO_new_file(ctx-&gt;debug_file, &quot;a+&quot;);
+	if (out == NULL)
+		{
+		CAPIerr(CAPI_F_CAPI_VTRACE, CAPI_R_FILE_OPEN_ERROR);
+		return;
+		}
 	BIO_vprintf(out, format, argptr);
 	BIO_free(out);
 	}
diff --git a/engines/e_capi_err.c b/engines/e_capi_err.c
index eaaefb2..a36ada3 100644
--- a/engines/e_capi_err.c
+++ b/engines/e_capi_err.c
@@ -1,6 +1,6 @@
 /* e_capi_err.c */
 /* ====================================================================
- * Copyright (c) 1999-2008 The OpenSSL Project.  All rights reserved.
+ * Copyright (c) 1999-2014 The OpenSSL Project.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -86,6 +86,7 @@ static ERR_STRING_DATA CAPI_str_functs[]=
 {ERR_FUNC(CAPI_F_CAPI_RSA_PRIV_DEC),	&quot;CAPI_RSA_PRIV_DEC&quot;},
 {ERR_FUNC(CAPI_F_CAPI_RSA_PRIV_ENC),	&quot;CAPI_RSA_PRIV_ENC&quot;},
 {ERR_FUNC(CAPI_F_CAPI_RSA_SIGN),	&quot;CAPI_RSA_SIGN&quot;},
+{ERR_FUNC(CAPI_F_CAPI_VTRACE),	&quot;CAPI_VTRACE&quot;},
 {ERR_FUNC(CAPI_F_CERT_SELECT_DIALOG),	&quot;CERT_SELECT_DIALOG&quot;},
 {ERR_FUNC(CAPI_F_CLIENT_CERT_SELECT),	&quot;CLIENT_CERT_SELECT&quot;},
 {ERR_FUNC(CAPI_F_WIDE_TO_ASC),	&quot;WIDE_TO_ASC&quot;},
@@ -109,6 +110,7 @@ static ERR_STRING_DATA CAPI_str_reasons[]=
 {ERR_REASON(CAPI_R_ERROR_GETTING_KEY_PROVIDER_INFO),&quot;error getting key provider info&quot;},
 {ERR_REASON(CAPI_R_ERROR_OPENING_STORE)  ,&quot;error opening store&quot;},
 {ERR_REASON(CAPI_R_ERROR_SIGNING_HASH)   ,&quot;error signing hash&quot;},
+{ERR_REASON(CAPI_R_FILE_OPEN_ERROR)      ,&quot;file open error&quot;},
 {ERR_REASON(CAPI_R_FUNCTION_NOT_SUPPORTED),&quot;function not supported&quot;},
 {ERR_REASON(CAPI_R_GETUSERKEY_ERROR)     ,&quot;getuserkey error&quot;},
 {ERR_REASON(CAPI_R_INVALID_DIGEST_LENGTH),&quot;invalid digest length&quot;},
diff --git a/engines/e_capi_err.h b/engines/e_capi_err.h
index efa7001..1844bf0 100644
--- a/engines/e_capi_err.h
+++ b/engines/e_capi_err.h
@@ -87,6 +87,7 @@ static void ERR_CAPI_error(int function, int reason, char *file, int line);
 #define CAPI_F_CAPI_RSA_PRIV_DEC			 110
 #define CAPI_F_CAPI_RSA_PRIV_ENC			 111
 #define CAPI_F_CAPI_RSA_SIGN				 112
+#define CAPI_F_CAPI_VTRACE				 118
 #define CAPI_F_CERT_SELECT_DIALOG			 117
 #define CAPI_F_CLIENT_CERT_SELECT			 116
 #define CAPI_F_WIDE_TO_ASC				 113
@@ -107,6 +108,7 @@ static void ERR_CAPI_error(int function, int reason, char *file, int line);
 #define CAPI_R_ERROR_GETTING_KEY_PROVIDER_INFO		 109
 #define CAPI_R_ERROR_OPENING_STORE			 110
 #define CAPI_R_ERROR_SIGNING_HASH			 111
+#define CAPI_R_FILE_OPEN_ERROR				 128
 #define CAPI_R_FUNCTION_NOT_SUPPORTED			 112
 #define CAPI_R_GETUSERKEY_ERROR				 113
 #define CAPI_R_INVALID_DIGEST_LENGTH			 124
diff --git a/ssl/s3_clnt.c b/ssl/s3_clnt.c
index c5f6ceb..e178fe1 100644
--- a/ssl/s3_clnt.c
+++ b/ssl/s3_clnt.c
@@ -2145,6 +2145,11 @@ int ssl3_get_certificate_request(SSL *s)
 		{
 		/* If we exceed static buffer copy all to cert structure */
 		s-&gt;cert-&gt;ctypes = OPENSSL_malloc(ctype_num);
+		if (s-&gt;cert-&gt;ctypes == NULL)
+			{
+			SSLerr(SSL_F_SSL3_GET_CERTIFICATE_REQUEST,ERR_R_MALLOC_FAILURE);
+			goto err;
+			}
 		memcpy(s-&gt;cert-&gt;ctypes, p, ctype_num);
 		s-&gt;cert-&gt;ctype_num = (size_t)ctype_num;
 		ctype_num=SSL3_CT_NUMBER;
diff --git a/ssl/s3_enc.c b/ssl/s3_enc.c
index f7de30b..66f5280 100644
--- a/ssl/s3_enc.c
+++ b/ssl/s3_enc.c
@@ -616,6 +616,11 @@ int ssl3_digest_cached_records(SSL *s)
 	/* Allocate handshake_dgst array */
 	ssl3_free_digest_list(s);
 	s-&gt;s3-&gt;handshake_dgst = OPENSSL_malloc(SSL_MAX_DIGEST * sizeof(EVP_MD_CTX *));
+	if (s-&gt;s3-&gt;handshake_dgst == NULL)
+		{
+		SSLerr(SSL_F_SSL3_DIGEST_CACHED_RECORDS, ERR_R_MALLOC_FAILURE);
+		return 0;
+		}
 	memset(s-&gt;s3-&gt;handshake_dgst,0,SSL_MAX_DIGEST *sizeof(EVP_MD_CTX *));
 	hdatalen = BIO_get_mem_data(s-&gt;s3-&gt;handshake_buffer,&amp;hdata);
 	if (hdatalen &lt;= 0)
diff --git a/ssl/ssl.h b/ssl/ssl.h
index 61c9890..51b8df0 100644
--- a/ssl/ssl.h
+++ b/ssl/ssl.h
@@ -2732,6 +2732,7 @@ void ERR_load_SSL_strings(void);
 #define SSL_F_TLS1_PREPARE_CLIENTHELLO_TLSEXT		 275
 #define SSL_F_TLS1_PREPARE_SERVERHELLO_TLSEXT		 276
 #define SSL_F_TLS1_PRF					 284
+#define SSL_F_TLS1_PROCESS_HEARTBEAT			 341
 #define SSL_F_TLS1_SETUP_KEY_BLOCK			 211
 #define SSL_F_TLS1_SET_SERVER_SIGALGS			 335
 
diff --git a/ssl/ssl_ciph.c b/ssl/ssl_ciph.c
index 1599d79..133d9d9 100644
--- a/ssl/ssl_ciph.c
+++ b/ssl/ssl_ciph.c
@@ -1962,6 +1962,13 @@ int SSL_COMP_add_compression_method(int id, COMP_METHOD *cm)
 
 	MemCheck_off();
 	comp=(SSL_COMP *)OPENSSL_malloc(sizeof(SSL_COMP));
+	if (comp == NULL)
+		{
+		MemCheck_on();
+		SSLerr(SSL_F_SSL_COMP_ADD_COMPRESSION_METHOD,ERR_R_MALLOC_FAILURE);
+		return(1);
+		}
+
 	comp-&gt;id=id;
 	comp-&gt;method=cm;
 	load_builtin_compressions();
diff --git a/ssl/ssl_err.c b/ssl/ssl_err.c
index 00c4bc8..5f8c075 100644
--- a/ssl/ssl_err.c
+++ b/ssl/ssl_err.c
@@ -273,6 +273,7 @@ static ERR_STRING_DATA SSL_str_functs[]=
 {ERR_FUNC(SSL_F_TLS1_PREPARE_CLIENTHELLO_TLSEXT),	&quot;TLS1_PREPARE_CLIENTHELLO_TLSEXT&quot;},
 {ERR_FUNC(SSL_F_TLS1_PREPARE_SERVERHELLO_TLSEXT),	&quot;TLS1_PREPARE_SERVERHELLO_TLSEXT&quot;},
 {ERR_FUNC(SSL_F_TLS1_PRF),	&quot;tls1_prf&quot;},
+{ERR_FUNC(SSL_F_TLS1_PROCESS_HEARTBEAT),	&quot;tls1_process_heartbeat&quot;},
 {ERR_FUNC(SSL_F_TLS1_SETUP_KEY_BLOCK),	&quot;tls1_setup_key_block&quot;},
 {ERR_FUNC(SSL_F_TLS1_SET_SERVER_SIGALGS),	&quot;tls1_set_server_sigalgs&quot;},
 {0,NULL}
diff --git a/ssl/ssl_rsa.c b/ssl/ssl_rsa.c
index 6f9337e..006c02e 100644
--- a/ssl/ssl_rsa.c
+++ b/ssl/ssl_rsa.c
@@ -948,6 +948,8 @@ static int serverinfo_process_buffer(const unsigned char *serverinfo,
 int SSL_CTX_use_serverinfo(SSL_CTX *ctx, const unsigned char *serverinfo,
 			   size_t serverinfo_length)
 	{
+	unsigned char *new_serverinfo;
+
 	if (ctx == NULL || serverinfo == NULL || serverinfo_length == 0)
 		{
 		SSLerr(SSL_F_SSL_CTX_USE_SERVERINFO,ERR_R_PASSED_NULL_PARAMETER);
@@ -968,13 +970,14 @@ int SSL_CTX_use_serverinfo(SSL_CTX *ctx, const unsigned char *serverinfo,
 		SSLerr(SSL_F_SSL_CTX_USE_SERVERINFO,ERR_R_INTERNAL_ERROR);
 		return 0;
 		}
-	ctx-&gt;cert-&gt;key-&gt;serverinfo = OPENSSL_realloc(ctx-&gt;cert-&gt;key-&gt;serverinfo,
+	new_serverinfo = OPENSSL_realloc(ctx-&gt;cert-&gt;key-&gt;serverinfo,
 						     serverinfo_length);
-	if (ctx-&gt;cert-&gt;key-&gt;serverinfo == NULL)
+	if (new_serverinfo == NULL)
 		{
 		SSLerr(SSL_F_SSL_CTX_USE_SERVERINFO,ERR_R_MALLOC_FAILURE);
 		return 0;
 		}
+	ctx-&gt;cert-&gt;key-&gt;serverinfo = new_serverinfo;
 	memcpy(ctx-&gt;cert-&gt;key-&gt;serverinfo, serverinfo, serverinfo_length);
 	ctx-&gt;cert-&gt;key-&gt;serverinfo_length = serverinfo_length;
 
diff --git a/ssl/ssl_sess.c b/ssl/ssl_sess.c
index 3bac2db..a85f279 100644
--- a/ssl/ssl_sess.c
+++ b/ssl/ssl_sess.c
@@ -792,6 +792,11 @@ int SSL_set_session(SSL *s, SSL_SESSION *session)
                     session-&gt;krb5_client_princ_len &gt; 0)
                 {
                     s-&gt;kssl_ctx-&gt;client_princ = (char *)OPENSSL_malloc(session-&gt;krb5_client_princ_len + 1);
+                    if (s-&gt;kssl_ctx-&gt;client_princ == NULL)
+                    {
+                        SSLerr(SSL_F_SSL_SET_SESSION, ERR_R_MALLOC_FAILURE);
+                        return(0);
+                    }
                     memcpy(s-&gt;kssl_ctx-&gt;client_princ,session-&gt;krb5_client_princ,
                             session-&gt;krb5_client_princ_len);
                     s-&gt;kssl_ctx-&gt;client_princ[session-&gt;krb5_client_princ_len] = '\0';
diff --git a/ssl/t1_lib.c b/ssl/t1_lib.c
index 891cd1f..8d5fd12 100644
--- a/ssl/t1_lib.c
+++ b/ssl/t1_lib.c
@@ -4003,6 +4003,11 @@ tls1_process_heartbeat(SSL *s)
 		 * payload, plus padding
 		 */
 		buffer = OPENSSL_malloc(1 + 2 + payload + padding);
+		if (buffer == NULL)
+			{
+			SSLerr(SSL_F_TLS1_PROCESS_HEARTBEAT,ERR_R_MALLOC_FAILURE);
+			return -1;
+			}
 		bp = buffer;
 		
 		/* Enter response type, length and copy payload */
@@ -4089,6 +4094,11 @@ tls1_heartbeat(SSL *s)
 	 *  - Padding
 	 */
 	buf = OPENSSL_malloc(1 + 2 + payload + padding);
+	if (buf == NULL)
+		{
+		SSLerr(SSL_F_TLS1_HEARTBEAT,ERR_R_MALLOC_FAILURE);
+		return -1;
+		}
 	p = buf;
 	/* Message Type */
 	*p++ = TLS1_HB_REQUEST;


hooks/post-receive
-- 
OpenSSL source code
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000022.html">[openssl-commits] [web] OpenSSL Web Pages branch master updated.	e5c274d21c041d789fc2be297e29130194f83095
</A></li>
	<LI>Next message: <A HREF="000024.html">[openssl-commits] [web] OpenSSL Web Pages branch master updated.	1c90fbd4f1a896ba8ff2020c4b19584ea58e7255
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23">[ date ]</a>
              <a href="thread.html#23">[ thread ]</a>
              <a href="subject.html#23">[ subject ]</a>
              <a href="author.html#23">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">More information about the openssl-commits
mailing list</a><br>
</body></html>
