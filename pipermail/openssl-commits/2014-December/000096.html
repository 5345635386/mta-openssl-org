<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-commits] [openssl] OpenSSL source code branch master	updated. 488f16e31b8f5ec2513410929325d0830d76762d
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2014-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20OpenSSL%20source%20code%20branch%20master%0A%09updated.%20488f16e31b8f5ec2513410929325d0830d76762d&In-Reply-To=%3C20141219141401.831611DF10B%40openssl.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000095.html">
   <LINK REL="Next"  HREF="000097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-commits] [openssl] OpenSSL source code branch master	updated. 488f16e31b8f5ec2513410929325d0830d76762d</H1>
    <B>Matt Caswell</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Bopenssl-commits%5D%20%5Bopenssl%5D%20OpenSSL%20source%20code%20branch%20master%0A%09updated.%20488f16e31b8f5ec2513410929325d0830d76762d&In-Reply-To=%3C20141219141401.831611DF10B%40openssl.net%3E"
       TITLE="[openssl-commits] [openssl] OpenSSL source code branch master	updated. 488f16e31b8f5ec2513410929325d0830d76762d">matt at openssl.org
       </A><BR>
    <I>Fri Dec 19 14:14:00 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000095.html">[openssl-commits] [openssl] OpenSSL source code branch	OpenSSL_1_0_2-stable updated. OpenSSL_1_0_2-beta3-123-gb651407
</A></li>
        <LI>Next message: <A HREF="000097.html">[openssl-commits] [web] OpenSSL Web Pages branch master updated.	9c7240f8f615cd0962891c294a51debf09864c74
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96">[ date ]</a>
              <a href="thread.html#96">[ thread ]</a>
              <a href="subject.html#96">[ subject ]</a>
              <a href="author.html#96">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;OpenSSL source code&quot;.

The branch, master has been updated
       via  488f16e31b8f5ec2513410929325d0830d76762d (commit)
      from  c0fc27f88ea0933a3e201325fc683b52fe55d848 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 488f16e31b8f5ec2513410929325d0830d76762d
Author: Matt Caswell &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">matt at openssl.org</A>&gt;
Date:   Fri Dec 19 10:55:54 2014 +0000

    Fix a problem if CFLAGS is too long cversion.c fails to compile when config
    is run with --strict-warnings.
    
    Reviewed-by: Richard Levitte &lt;<A HREF="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">levitte at openssl.org</A>&gt;

-----------------------------------------------------------------------

Summary of changes:
 crypto/Makefile    |    7 +------
 crypto/cversion.c  |   15 +++------------
 util/mkbuildinf.pl |   35 +++++++++++++++++++++++++++++++++++
 3 files changed, 39 insertions(+), 18 deletions(-)
 create mode 100755 util/mkbuildinf.pl

diff --git a/crypto/Makefile b/crypto/Makefile
index 0029b1b..d4c7712 100644
--- a/crypto/Makefile
+++ b/crypto/Makefile
@@ -64,12 +64,7 @@ fips: cryptlib.o thr_id.o uid.o $(CPUID_OBJ)
 		done;
 
 buildinf.h: ../Makefile
-	( echo &quot;#ifndef MK1MF_BUILD&quot;; \
-	echo '  /* auto-generated by crypto/Makefile for crypto/cversion.c */'; \
-	echo '  #define CFLAGS &quot;$(CC) $(CFLAG)&quot;'; \
-	echo '  #define PLATFORM &quot;$(PLATFORM)&quot;'; \
-	echo &quot;  #define DATE \&quot;`LC_ALL=C LC_TIME=C date`\&quot;&quot;; \
-	echo '#endif' ) &gt;buildinf.h
+	$(PERL) $(TOP)/util/mkbuildinf.pl &quot;$(CFLAGS)&quot; &quot;$(PLATFORM)&quot; &gt;buildinf.h
 
 x86cpuid.s:	x86cpuid.pl perlasm/x86asm.pl
 	$(PERL) x86cpuid.pl $(PERLASM_SCHEME) $(CFLAGS) $(PROCESSOR) &gt; $@
diff --git a/crypto/cversion.c b/crypto/cversion.c
index ea9f25f..0336ada 100644
--- a/crypto/cversion.c
+++ b/crypto/cversion.c
@@ -69,10 +69,7 @@ const char *SSLeay_version(int t)
 	if (t == SSLEAY_BUILT_ON)
 		{
 #ifdef DATE
-		static char buf[sizeof(DATE)+11];
-
-		BIO_snprintf(buf,sizeof buf,&quot;built on: %s&quot;,DATE);
-		return(buf);
+		return(DATE);
 #else
 		return(&quot;built on: date not available&quot;);
 #endif
@@ -80,10 +77,7 @@ const char *SSLeay_version(int t)
 	if (t == SSLEAY_CFLAGS)
 		{
 #ifdef CFLAGS
-		static char buf[sizeof(CFLAGS)+11];
-
-		BIO_snprintf(buf,sizeof buf,&quot;compiler: %s&quot;,CFLAGS);
-		return(buf);
+		return(cflags);
 #else
 		return(&quot;compiler: information not available&quot;);
 #endif
@@ -91,10 +85,7 @@ const char *SSLeay_version(int t)
 	if (t == SSLEAY_PLATFORM)
 		{
 #ifdef PLATFORM
-		static char buf[sizeof(PLATFORM)+11];
-
-		BIO_snprintf(buf,sizeof buf,&quot;platform: %s&quot;, PLATFORM);
-		return(buf);
+		return(PLATFORM);
 #else
 		return(&quot;platform: information not available&quot;);
 #endif
diff --git a/util/mkbuildinf.pl b/util/mkbuildinf.pl
new file mode 100755
index 0000000..ca02d7b
--- /dev/null
+++ b/util/mkbuildinf.pl
@@ -0,0 +1,35 @@
+#!/usr/local/bin/perl
+
+my ($cflags, $platform) = @ARGV;
+
+$cflags = &quot;compiler: $cflags&quot;;
+$date = localtime();
+print &lt;&lt;&quot;END_OUTPUT&quot;;
+#ifndef MK1MF_BUILD
+    /* auto-generated by util/mkbuildinf.pl for crypto/cversion.c */
+    #define CFLAGS
+    /*
+     * Generate CFLAGS as an array of individual characters. This is a
+     * workaround for the situation where CFLAGS gets too long for a C90 string
+     * literal
+     */
+    static const char cflags[] = {
+END_OUTPUT
+my $ctr = 0;
+foreach my $c (split //, $cflags) {
+    # Max 18 characters per line
+    if  (($ctr++ % 18) == 0) {
+        if ($ctr != 0) {
+            print &quot;\n&quot;;
+        }
+        print &quot;        &quot;;
+    }
+    print &quot;'$c',&quot;;
+}
+print &lt;&lt;&quot;END_OUTPUT&quot;;
+'\\0'
+    };
+    #define PLATFORM &quot;platform: $platform&quot;
+    #define DATE &quot;built on: $date&quot;
+#endif
+END_OUTPUT


hooks/post-receive
-- 
OpenSSL source code
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000095.html">[openssl-commits] [openssl] OpenSSL source code branch	OpenSSL_1_0_2-stable updated. OpenSSL_1_0_2-beta3-123-gb651407
</A></li>
	<LI>Next message: <A HREF="000097.html">[openssl-commits] [web] OpenSSL Web Pages branch master updated.	9c7240f8f615cd0962891c294a51debf09864c74
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96">[ date ]</a>
              <a href="thread.html#96">[ thread ]</a>
              <a href="subject.html#96">[ subject ]</a>
              <a href="author.html#96">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://mta.opensslfoundation.net/mailman/listinfo/openssl-commits">More information about the openssl-commits
mailing list</a><br>
</body></html>
