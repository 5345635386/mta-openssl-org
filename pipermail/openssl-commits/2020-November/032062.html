<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [tools]  master update
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-commits/2020-November/index.html" >
   <LINK REL="made" HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Btools%5D%20%20master%20update&In-Reply-To=%3C1605519455.414701.14547.nullmailer%40dev.openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032047.html">
   <LINK REL="Next"  HREF="032074.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[tools]  master update</H1>
    <B>Dr. Paul Dale</B> 
    <A HREF="mailto:openssl-commits%40openssl.org?Subject=Re%3A%20%5Btools%5D%20%20master%20update&In-Reply-To=%3C1605519455.414701.14547.nullmailer%40dev.openssl.org%3E"
       TITLE="[tools]  master update">pauli at openssl.org
       </A><BR>
    <I>Mon Nov 16 09:37:35 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="032047.html">[tools]  master update
</A></li>
        <LI>Next message: <A HREF="032074.html">[tools]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32062">[ date ]</a>
              <a href="thread.html#32062">[ thread ]</a>
              <a href="subject.html#32062">[ subject ]</a>
              <a href="author.html#32062">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch master has been updated
       via  cbcbecab06afa0d3189153d0189556a494ec7397 (commit)
       via  3fc412099f1cb8715d53573927a21b0285cab431 (commit)
       via  55833dbceeca7f9a362b6c17ae8573aad3f2449e (commit)
       via  2b6037ffb38fb570c3c549380c817d7ddc02019d (commit)
       via  bba96aea70e34ede6207d385a4d2fac9bbd0484f (commit)
       via  c2ee3847c39b64c9db85ccd0ef57d480377b58a8 (commit)
       via  ff0730a5f63fad755ded50f93c0695ede14f52b5 (commit)
       via  fb12734b783b8fc960a30e9e45e1f83c0dc382f5 (commit)
       via  298a2fff2eb559f59cce2581a5bc9c01528df8bb (commit)
       via  97a10ae6e3f0067a5fc764d99f90422539499090 (commit)
       via  b853c16f7ab05ddef8868826ca79360d68c5a5be (commit)
       via  f083502396430ece48fbc16f4576f9a810834a0d (commit)
       via  0ad6ea00ee84d84a595867e667d01c392432a74b (commit)
       via  4737a26009ca5f05e0a73ee64c9eb5389de5b0b1 (commit)
       via  3c304bd9b7e5342d29b34579268523582acc8064 (commit)
       via  f4550d08e2e19c6c49814f4d31d945e317e50a5b (commit)
      from  b6beff129e2cd4c74a75cfd367056c7d8e9b1517 (commit)


- Log -----------------------------------------------------------------
commit cbcbecab06afa0d3189153d0189556a494ec7397
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Sat Nov 14 15:41:58 2020 +0100

    ghmerge: Add --help option and significantly extend usage hints (describing options)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 3fc412099f1cb8715d53573927a21b0285cab431
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 13:32:17 2020 +0200

    ghmerge: Rename variable 'REL' to more telling 'REF'
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 55833dbceeca7f9a362b6c17ae8573aad3f2449e
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 13:11:28 2020 +0200

    ghmerge: Add --cherry-pick option (as alternative to rebase)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 2b6037ffb38fb570c3c549380c817d7ddc02019d
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 13:09:35 2020 +0200

    ghmerge: Remove redundant and error-prone 2nd rebase on current ref
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit bba96aea70e34ede6207d385a4d2fac9bbd0484f
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 13:02:29 2020 +0200

    ghmerge: Unify behavior on error in CLI arguments and improve usage output
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit c2ee3847c39b64c9db85ccd0ef57d480377b58a8
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 13:29:41 2020 +0200

    ghmerge: Make sure that on build error all error output is shown and then the tool exits
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit ff0730a5f63fad755ded50f93c0695ede14f52b5
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 15:29:01 2020 +0200

    ghmerge: Move adaptation of CC variable and improve the comment about it
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit fb12734b783b8fc960a30e9e45e1f83c0dc382f5
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 15:38:58 2020 +0200

    ghmerge: Automatically detect remote only if not explicitly given as option
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 298a2fff2eb559f59cce2581a5bc9c01528df8bb
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 12:46:32 2020 +0200

    ghmerge: Improve flexibility providing reviewer names vs. commit refs (gitaddrev filter args)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 97a10ae6e3f0067a5fc764d99f90422539499090
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 15:52:16 2020 +0200

    ghmerge: Rename WORK branch that reflects the changes done by the PR
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit b853c16f7ab05ddef8868826ca79360d68c5a5be
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 09:43:00 2020 +0200

    ghmerge: Add --ref option to checkout given reference at first
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit f083502396430ece48fbc16f4576f9a810834a0d
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 09:41:26 2020 +0200

    ghmerge: Remove unused variable PREV
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 0ad6ea00ee84d84a595867e667d01c392432a74b
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 09:39:47 2020 +0200

    ghmerge: Improve diagnostics on cleanup, distinguishing failure and non-error exit
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 4737a26009ca5f05e0a73ee64c9eb5389de5b0b1
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 09:37:02 2020 +0200

    ghmerge: Various small improvements on user interaction, extending messages etc.
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit 3c304bd9b7e5342d29b34579268523582acc8064
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 16:41:35 2020 +0200

    addrev: Add warning on overriding filter args
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

commit f4550d08e2e19c6c49814f4d31d945e317e50a5b
Author: Dr. David von Oheimb &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">David.von.Oheimb at siemens.com</A>&gt;
Date:   Thu Oct 8 09:34:12 2020 +0200

    addrev: Improve flexibility providing reviewer names vs. commit refs (filter args)
    
    Reviewed-by: Tomas Mraz &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">tmraz at fedoraproject.org</A>&gt;
    Reviewed-by: Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-commits.html">paul.dale at oracle.com</A>&gt;
    (Merged from <A HREF="https://github.com/openssl/openssl/pull/72">https://github.com/openssl/openssl/pull/72</A>)

-----------------------------------------------------------------------

Summary of changes:
 review-tools/addrev  |  16 ++++-
 review-tools/ghmerge | 173 ++++++++++++++++++++++++++++++++++++---------------
 2 files changed, 137 insertions(+), 52 deletions(-)

diff --git a/review-tools/addrev b/review-tools/addrev
index 5617199..5221500 100755
--- a/review-tools/addrev
+++ b/review-tools/addrev
@@ -4,7 +4,7 @@ use strict;
 use warnings;
 
 my $args = &quot;&quot;;
-my $filterargs = &quot;HEAD^..&quot;;
+my $filterargs = &quot;&quot;;
 my $list_reviewers = 0;
 my $help = 0;
 my $haveprnum = 0;
@@ -14,8 +14,15 @@ my $useself = 1;
 my $my_email;
 
 foreach (@ARGV) {
-    if (/^[a-z]+$/ || /^\@\w(?:[-\w]*\w)?$/) {
+    if (/^\@.+$/) {
         $args .= &quot;--reviewer=$_ &quot;;
+    } elsif (/^[-\w]+$/) {
+        if (/^[0-9a-f]{7,}+/) {
+            print &quot;Warning: overriding previous filter args $filterargs\n&quot; if $filterargs ne &quot;&quot;;
+            $filterargs = $_;
+        } else {
+            $args .= &quot;--reviewer=$_ &quot;;
+        }
     } elsif (/^--reviewer=(.+)$/) {
         $args .= &quot;--reviewer=$1 &quot;;
     } elsif (/^--rmreviewers$/) {
@@ -40,6 +47,7 @@ foreach (@ARGV) {
     } elsif (/^--commit=(.+)$/) {
         $args .= &quot;--commit=$1 &quot;;
     } elsif (/^-(\d+)$/) {
+        print &quot;Warning: overriding previous filter args $filterargs\n&quot; if $filterargs ne &quot;&quot;;
         $filterargs = &quot;HEAD~$1..&quot;;
     } elsif (/^--list$/) {
 	$list_reviewers = 1;
@@ -48,9 +56,11 @@ foreach (@ARGV) {
 	$help = 1;
 	last;
     } else {
+        print &quot;Warning: overriding previous filter args $filterargs\n&quot; if $filterargs ne &quot;&quot;;
         $filterargs = $_;
     }
 }
+$filterargs = &quot;HEAD^..&quot; if $filterargs eq &quot;&quot;;
 
 if ($list_reviewers) {
     system(&quot;gitaddrev --list&quot;);
@@ -98,7 +108,7 @@ option style arguments:
 
 non-option style arguments can be:
 
-a string of lower case letters, denoting a reviewer name.
+a string of alphanumeric or '-' characters, denoting a reviewer name.
 
 a string starting with \@, denoting a reviewer's github ID.
 
diff --git a/review-tools/ghmerge b/review-tools/ghmerge
index 9c8a903..1384a89 100755
--- a/review-tools/ghmerge
+++ b/review-tools/ghmerge
@@ -1,33 +1,65 @@
 #! /bin/bash
 
+function usage_exit {
+    &gt;&amp;2 echo &quot;Usage: ghmerge &lt;options including prnum and reviewer(s)&gt;
+    or ghmerge [&lt;options&gt;] -- &lt;prnum&gt; &lt;reviewer&gt;...
+Options may include addrev options and gitaddrev filter args.
+
+Option style arguments:
+
+--help              Print this help and exit
+--tools             Merge a tools PR (rather than openssl PR)
+--web               Merge a web PR (rather than openssl PR)
+--remote &lt;remote&gt;   Merge with given repo (rather than implicit upstream)
+--ref &lt;branch&gt;      Merge with given branch (rather than impliict master)
+--cherry-pick       Use cherry-pick (rather than pull --rebase)
+--squash            Squash new commits non-interactively (allows editing msg)
+--noautosquash      Do not automatically squash fixups in interactive rebase
+--nobuild           Do not call 'openssbuild' before merging
+
+Examples:
+
+  ghmerge 12345 mattcaswell
+  ghmerge 12345 paulidale t8m --nobuild --myemail=<A HREF="../../../mailman/listinfo/openssl-commits.html">dev at ddvo.net</A>
+  ghmerge edd05b7^^^^..19692bb2c32 --squash -- 12345 levitte&quot;
+    exit 9
+}
+
 set -o errexit
 
 WHAT=openssl
-BUILD=yes
+PICK=no
 INTERACTIVE=yes
 AUTOSQUASH=&quot;--autosquash&quot;
-[ -z ${CC+x} ] &amp;&amp; CC=&quot;ccache gcc&quot; # the default otherwise is &quot;ccache clang-3.6&quot;
-REMOTE=`git remote -v | awk '/git.openssl.org.*(push)/{ print $1; }' | head -n 1`
-if [ &quot;$REMOTE&quot; = &quot;&quot; ] ; then
-    echo Cannot find remote git.openssl.org
-    exit 1
-fi
+REMOTE=&quot;&quot;
+REF=&quot;&quot;
+BUILD=yes
+[ -z ${CC+x} ] &amp;&amp; CC=&quot;ccache gcc&quot; # opensslbuild will otherwise use &quot;ccache clang-3.6&quot;
 
 if [ ! -d .git ] ; then
-    echo Not at top-level
+    echo Not at a top-level git directory
     exit 1
 fi
 
+PRNUM=
+TEAM=&quot;&quot;
 ADDREVOPTS=&quot;&quot;
 # Parse JCL.
-while true ; do
+shopt -s extglob
+while [ $# -ne 0 ]; do
     case &quot;$1&quot; in
+    --help)
+        usage_exit
+        ;;
     --tools)
         WHAT=tools ; BUILD=no ; shift
         ;;
     --web)
         WHAT=web ; BUILD=no ; shift
         ;;
+    --cherry-pick)
+        PICK=yes ; shift
+        ;;
     --noautosquash)
         AUTOSQUASH=&quot;&quot; ; shift
         ;;
@@ -40,31 +72,60 @@ while true ; do
     --remote)
         if [ $# -lt 2 ] ; then
             echo &quot;Missing argument of '$1'&quot;
-            exit 1
+            usage_exit
         fi
         shift; REMOTE=$1; shift
         ;;
+    --ref)
+        if [ $# -lt 2 ] ; then
+            echo &quot;Missing argument of '$1'&quot;
+            usage_exit
+        fi
+        shift; REF=$1; shift
+        ;;
     --)
-        shift
+        if [ $# -lt 3 ] ; then
+            echo &quot;Missing &lt;prnum&gt; &lt;reviewer&gt;... after '--'&quot;
+            usage_exit
+        fi
+        shift; PRNUM=$1 ; shift
+        TEAM=&quot;$TEAM $*&quot;
         break
         ;;
     -*) # e.g., --verbose, --trivial, --myemail=...
         ADDREVOPTS=&quot;$ADDREVOPTS $1&quot;
         shift
-        break
         ;;
-    *)
-        break
+    +([[:digit:]]) ) # e.g., 1453
+        PRNUM=$1; shift
+        ;;
+    @*) # e.g., @t8m
+        TEAM=&quot;$TEAM $1&quot;; shift
+        ;;
+    +([[:alnum:]-]) ) # e.g., levitte
+        if [[ $1 =~ ^[0-9a-f]{7,}+$ ]]; then # e.g., edd05b7
+            ADDREVOPTS=&quot;$ADDREVOPTS $1&quot;
+        else
+            TEAM=&quot;$TEAM $1&quot;
+        fi
+        shift
+        ;;
+    *) # e.g., edd05b7^^^^..19692bb2c32
+        ADDREVOPTS=&quot;$ADDREVOPTS $1&quot;; shift
         ;;
     esac
 done
+ADDREVOPTS=${ADDREVOPTS# } # chop any leading ' '
 
-if [ $# -lt 2 ] ; then
-    echo &quot;Usage: $0 [flags, including addrev flags] prnum reviewer...&quot;
+[ &quot;$REMOTE&quot; = &quot;&quot; ] &amp;&amp; REMOTE=`git remote -v | awk '/git.openssl.org.*(push)/{ print $1; }' | head -n 1`
+if [ &quot;$REMOTE&quot; = &quot;&quot; ] ; then
+    echo Cannot find git remote with URL including 'git.openssl.org'
     exit 1
 fi
-PRNUM=$1 ; shift
-TEAM=$*
+
+if [ &quot;$PRNUM&quot; = &quot;&quot; -o &quot;$TEAM&quot; = &quot;&quot; ] ; then
+    usage_exit
+fi
 
 PR_URL=<A HREF="https://api.github.com/repos/openssl/$WHAT/pulls/$PRNUM">https://api.github.com/repos/openssl/$WHAT/pulls/$PRNUM</A>
 if ! wget --quiet $PR_URL -O /tmp/gh$$; then
@@ -82,68 +143,82 @@ BRANCH=$2
 REPO=$3
 rm /tmp/gh$$
 
-if [ -z &quot;$WHO&quot; -o -z &quot;$BRANCH&quot; ]; then
-    echo &quot;Don't know from which branch to fetch&quot;
+if [ -z &quot;$WHO&quot; -o -z &quot;$BRANCH&quot; -o -z &quot;$REPO&quot; ]; then
+    echo &quot;Could not determine from $PR_URL which branch of whom to fetch from where&quot;
     exit 1
 fi
 
-REL=`git rev-parse --abbrev-ref HEAD`
-WORK=&quot;${WHO}-${BRANCH}&quot;
-PREV=
+if [ &quot;$REF&quot; = &quot;&quot; ]; then
+    REF=`git rev-parse --abbrev-ref HEAD` # usually will be 'HEAD' or e.g., OpenSSL_1_1_1-stable
+else
+    echo -n &quot;Press Enter to checkout $REF: &quot;; read foo
+    git checkout $REF
+fi
 
-echo -n &quot;Press Enter to pull the latest branch '$REL' from $REMOTE: &quot;; read foo
-git pull $REMOTE $REL
+echo -n &quot;Press Enter to pull the latest $REMOTE/$REF: &quot;; read foo
+git pull $REMOTE || (git rebase --abort; exit 1)
+
+WORK=&quot;copy-of-${WHO}-${BRANCH}&quot;
 
 function cleanup {
-    if [ &quot;$WORK&quot; != &quot;$REL&quot; ]; then
-        git checkout -q $REL
-        git branch -D $WORK
-        git reset --hard $REMOTE/$REL # prune any leftover commits added locally
+    rv=$?
+    echo # new line
+    [ $rv -ne 0 ] &amp;&amp; echo -e &quot;\nghmerge failed&quot;
+    if [ &quot;$WORK&quot; != &quot;$REF&quot; ]; then
+        echo Restoring local $REF
+        git checkout -q $REF
+        git branch -qD $WORK 2&gt;/dev/null
     fi
+    git reset --hard $REMOTE/$REF # prune any leftover commits added locally
 }
 trap 'cleanup' EXIT
 
-git checkout -b $WORK $REL
+git checkout -b $WORK $REF
 
 # append new commits from $REPO/$BRANCH
-git pull --rebase $REPO $BRANCH
-echo rebasing $BRANCH on $REL
-git rebase $REL || (git rebase --abort; exit 1)
+if [ &quot;$PICK&quot; != &quot;yes&quot; ]; then
+    echo Rebasing $REPO/$BRANCH on $REF...
+    git pull --rebase $REPO $BRANCH || (git rebase --abort; exit 1)
+else
+    echo Cherry-picking $REPO/$BRANCH to $REF...
+    git fetch $REPO $BRANCH &amp;&amp; git cherry-pick FETCH_HEAD
+fi
 
-echo Diff against $REL
-git diff $REL
+echo Diff against $REF
+git diff $REF
 
 if [ &quot;$INTERACTIVE&quot; == &quot;yes&quot; ] ; then
-    echo -n &quot;Press Enter to interactively rebase $AUTOSQUASH $BRANCH on $REL: &quot;; read foo
-    git rebase -i $AUTOSQUASH $REL || (git rebase --abort; exit 1)
-    addrev $ADDREVOPTS --prnum=$PRNUM $TEAM ${REL}..
+    echo -n &quot;Press Enter to interactively rebase $AUTOSQUASH on $REF: &quot;; read foo
+    git rebase -i $AUTOSQUASH $REF || (git rebase --abort; exit 1)
+    echo &quot;Calling addrev $ADDREVOPTS --prnum=$PRNUM $TEAM ${REF}..&quot;
+    addrev $ADDREVOPTS --prnum=$PRNUM $TEAM ${REF}..
 fi
 
-echo Log since $REL
-git log $REL..
+echo Log since $REF
+git log $REF..
 
-git checkout $REL
+git checkout $REF
 if [ &quot;$INTERACTIVE&quot; != &quot;yes&quot; ] ; then
-    echo -n &quot;Press Enter to non-interactively merge --squash $BRANCH to $REL: &quot;; read foo
+    echo -n &quot;Press Enter to non-interactively merge --squash $BRANCH to $REF: &quot;; read foo
     git merge --ff-only --no-commit --squash $WORK
     AUTHOR=`git show --no-patch --pretty=&quot;format:%an &lt;%ae&gt;&quot; $WORK`
     git commit --author=&quot;$AUTHOR&quot;
-    addrev $ADDREVOPTS --prnum=$PRNUM $TEAM $REMOTE/${REL}..
+    addrev $ADDREVOPTS --prnum=$PRNUM $TEAM $REMOTE/${REF}..
 else
-    # echo -n &quot;Press Enter to merge to $REL: &quot;; read foo
+    # echo -n &quot;Press Enter to merge to $REF: &quot;; read foo
     git merge --ff-only $WORK
 fi
 
-echo New log since $REMOTE/$REL
-git log $REMOTE/$REL..
+echo New log since $REMOTE/$REF
+git log $REMOTE/$REF..
 
 if [ &quot;$BUILD&quot; == &quot;yes&quot; ] ; then
     echo Rebuilding...
-    ( CC=&quot;$CC&quot; opensslbuild 2&gt;&amp;1 ) | tail -3
+    CC=&quot;$CC&quot; opensslbuild &gt;/dev/null # any STDERR output will be shown
 fi
 
 while true ; do
-    echo -n &quot;Enter 'yes' to push to $REMOTE/$REL or 'no' to abort: &quot;
+    echo -n &quot;Enter 'y'/'yes' to push to $REMOTE/$REF or 'n'/'no' to abort: &quot;
     read x
     x=&quot;`echo $x | tr A-Z a-z`&quot;
     if [ &quot;$x&quot; = &quot;y&quot; -o &quot;$x&quot; = &quot;yes&quot; -o &quot;$x&quot; = &quot;n&quot; -o &quot;$x&quot; = &quot;no&quot; ] ; then
@@ -152,5 +227,5 @@ while true ; do
 done
 
 if [ &quot;$x&quot; = &quot;y&quot; -o &quot;$x&quot; = &quot;yes&quot; ] ; then
-    git push -v $REMOTE $REL
+    git push -v $REMOTE $REF
 fi
</PRE>







































































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032047.html">[tools]  master update
</A></li>
	<LI>Next message: <A HREF="032074.html">[tools]  master update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32062">[ date ]</a>
              <a href="thread.html#32062">[ thread ]</a>
              <a href="subject.html#32062">[ subject ]</a>
              <a href="author.html#32062">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-commits.html">More information about the openssl-commits
mailing list</a><br>
</body></html>
