<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Reg issue in alert message
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-October/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Reg%20issue%20in%20alert%20message&In-Reply-To=%3Ceb5d58cb-e8b8-fc6b-5992-a25e83e8d2e6%40openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009102.html">
   <LINK REL="Next"  HREF="009108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Reg issue in alert message</H1>
    <B>Matt Caswell</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Reg%20issue%20in%20alert%20message&In-Reply-To=%3Ceb5d58cb-e8b8-fc6b-5992-a25e83e8d2e6%40openssl.org%3E"
       TITLE="[openssl-users] Reg issue in alert message">matt at openssl.org
       </A><BR>
    <I>Wed Oct 24 12:57:04 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009102.html">[openssl-users] Reg issue in alert message
</A></li>
        <LI>Next message: <A HREF="009108.html">[openssl-users] Reg issue in alert message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9103">[ date ]</a>
              <a href="thread.html#9103">[ thread ]</a>
              <a href="subject.html#9103">[ subject ]</a>
              <a href="author.html#9103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 24/10/2018 13:25, ramakrushna mishra wrote:
&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> Thank you for all for providing the information.
</I>&gt;<i> I suspect we are using &quot; SSL_MODE_SEND_FALLBACK_SCSV&#160;&#160;&quot; and that might
</I>&gt;<i> be causing the issue.&#160; The team is looking into this issue now with the
</I>&gt;<i> provided information.&#160;
</I>&gt;<i> 
</I>&gt;<i> &#160;One doubt that came during&#160; our investigation is :
</I>&gt;<i> &quot; If client has highest version of TLS1.3 and server has support for
</I>&gt;<i> TLS1.2 and SLV3 only.&#160; &#160;How the handshake will&#160; proceed ? &quot; 
</I>
The protocol will negotiate the highest commonly supported protocol
version. So if the server supports TLS1.3 and the client only supports
TLS1.2 then TLS1.2 will be used. Don't use SSLv3. That is disabled by
default in current OpenSSL versions.

Matt

&gt;<i> I am not sure if this question should go to a new thread ?
</I>&gt;<i> 
</I>&gt;<i> Thanks and Regards,
</I>&gt;<i> Ram Krushna
</I>&gt;<i> 
</I>&gt;<i> On Wed, Oct 24, 2018 at 11:47 AM &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     Send openssl-users mailing list submissions to
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i>     or, via email, send a message with subject or body 'help' to
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     You can reach the person managing the list at
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     When replying, please edit your Subject line so it is more specific
</I>&gt;<i>     than &quot;Re: Contents of openssl-users digest...&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Today's Topics:
</I>&gt;<i> 
</I>&gt;<i>     &#160; &#160;1. Re: CAPI-Engine doc (Selva Nair)
</I>&gt;<i>     &#160; &#160;2. Re: CAPI-Engine doc (Michael Wojcik)
</I>&gt;<i>     &#160; &#160;3. Re: Reg issue in alert message (Michael Wojcik)
</I>&gt;<i>     &#160; &#160;4. Re: CAPI-Engine doc (Jakob Bohm)
</I>&gt;<i>     &#160; &#160;5. Re: Openssl Build Error- module unsafe for SAFESEH
</I>&gt;<i>     &#160; &#160; &#160; image/Unable to generate SAFESEH image (sakdev)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ----------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 1
</I>&gt;<i>     Date: Tue, 23 Oct 2018 11:22:04 -0400
</I>&gt;<i>     From: Selva Nair &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">selva.nair at gmail.com</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">selva.nair at gmail.com</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">richard.oehlinger at adbsafegate.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">richard.oehlinger at adbsafegate.com</A>&gt;,
</I>&gt;<i>     <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] CAPI-Engine doc
</I>&gt;<i>     Message-ID:
</I>&gt;<i>     &#160; &#160; &#160; &#160;
</I>&gt;<i>     &lt;CAKuzo_iqEBP-QG19Hsg5dFVoUG+2q-5O=<A HREF="../../../mailman/listinfo/openssl-users.html">vfg_NTzAJsQj+D3Jw at mail.gmail.com</A>
</I>&gt;<i>     &lt;mailto:vfg_NTzAJsQj%<A HREF="../../../mailman/listinfo/openssl-users.html">2BD3Jw at mail.gmail.com</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=&quot;UTF-8&quot;
</I>&gt;<i> 
</I>&gt;<i>     On Tue, Oct 23, 2018 at 10:38 AM Richard Oehlinger via openssl-users
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt; wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Hi!
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; I'm trying to get a handle on the CAPI engine, because I need to
</I>&gt;<i>     have a
</I>&gt;<i>     &gt; secure Keystore on Windows. Furthermore I need it to work with Qt's
</I>&gt;<i>     &gt; QSslKey, which fortunately can be constructed by EVP_PKEY *.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; So far so good. The key is found, but when I try to use it in a SSL
</I>&gt;<i>     &gt; connection i get following error:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; error:80070063:lib(128):CAPI_RSA_SIGN:cant create hash object,
</I>&gt;<i>     &gt; error:1409B006:SSL routines:ssl3_send_server_key_exchange:EVP lib
</I>&gt;<i> 
</I>&gt;<i>     Which version of OpenSSL?
</I>&gt;<i> 
</I>&gt;<i>     &gt; Trace Output is:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Setting debug file to C:\Users\user\AppData\Local\Temp\engine.txt
</I>&gt;<i>     &gt; Opening certificate store MY
</I>&gt;<i>     &gt; capi_get_key, contname={4EBA52A8-AB4B-47DB-B777-2B26351F324C},
</I>&gt;<i>     &gt; provname=Microsoft Enhanced Cryptographic Provider v1.0, type=1
</I>&gt;<i>     &gt; Called CAPI_rsa_sign()
</I>&gt;<i> 
</I>&gt;<i>     This CSP cannot do SHA2 hashes so won't work unless you restrict
</I>&gt;<i>     signature algorithms or set TLS version to 1.1. I believe OpenSSL
</I>&gt;<i>     1.1.0 will try to load The &quot;.. Enhanced RSA AES .. Provider&quot; which
</I>&gt;<i>     can handle SHA2 and may work. I say &quot;may&quot; because, if the key store is
</I>&gt;<i>     a legacy hardware token, it also depends on signature algorithms
</I>&gt;<i>     supported
</I>&gt;<i>     by the token and may be necessary to downgrade to TLS 1.1.
</I>&gt;<i> 
</I>&gt;<i>     Selva
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 2
</I>&gt;<i>     Date: Tue, 23 Oct 2018 15:37:24 +0000
</I>&gt;<i>     From: Michael Wojcik &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>&gt;&gt;
</I>&gt;<i>     To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&quot;
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] CAPI-Engine doc
</I>&gt;<i>     Message-ID:
</I>&gt;<i>     &#160; &#160; &#160; &#160;
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB1324455050CC00BD3A2DD70FF9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB1324455050CC00BD3A2DD70FF9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>&gt;&gt;
</I>&gt;<i> 
</I>&gt;<i>     Content-Type: text/plain; charset=&quot;Windows-1252&quot;
</I>&gt;<i> 
</I>&gt;<i>     &gt; From: openssl-users [mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;] On Behalf
</I>&gt;<i>     &gt; Of Richard Oehlinger via openssl-users
</I>&gt;<i>     &gt; Sent: Tuesday, October 23, 2018 10:38
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; I'm trying to get a handle on the CAPI engine, because I need to
</I>&gt;<i>     have a
</I>&gt;<i>     &gt; secure Keystore on Windows. Furthermore I need it to work with Qt's
</I>&gt;<i>     &gt; QSslKey, which fortunately can be constructed by EVP_PKEY *.
</I>&gt;<i> 
</I>&gt;<i>     What OpenSSL version are you using? Please remember to include this
</I>&gt;<i>     informtion in every question. (And, normally, we'd ask for the
</I>&gt;<i>     platform as well, but since CAPI is Windows-specific, we know that
</I>&gt;<i>     in this case.)
</I>&gt;<i> 
</I>&gt;<i>     &gt; So far so good. The key is found, but when I try to use it in a SSL
</I>&gt;<i>     &gt; connection i get following error:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; error:80070063:lib(128):CAPI_RSA_SIGN:cant create hash object,
</I>&gt;<i>     &gt; error:1409B006:SSL routines:ssl3_send_server_key_exchange:EVP lib
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; I use a current Windows 10. Do I need to use a different Algorithm in
</I>&gt;<i>     &gt; order to work? Some googeling is indicating the provider might be
</I>&gt;<i>     wrong.
</I>&gt;<i> 
</I>&gt;<i>     I haven't looked at the CAPI engine code since 1.0.1j. At that time,
</I>&gt;<i>     I needed CAPI support and discovered there were various issues with
</I>&gt;<i>     the extant CAPI code, so I forked and rewrote it. That was some time
</I>&gt;<i>     back, obviously, and I'm afraid I never got around to pushing the
</I>&gt;<i>     changes back to openssl.org &lt;<A HREF="http://openssl.org">http://openssl.org</A>&gt;. (In fact, it was
</I>&gt;<i>     sufficiently long ago that I believe the organization was still
</I>&gt;<i>     reluctant to take contributions from people in the US at the time.)
</I>&gt;<i> 
</I>&gt;<i>     The biggest issue was with provider handling. CAPI is something of a
</I>&gt;<i>     braindead API in many ways - Microsoft's replacement, CNG, is
</I>&gt;<i>     somewhat better - and the provider stuff is one of them. When a key
</I>&gt;<i>     (including a &quot;key&quot; which is actually just a reference to a key
</I>&gt;<i>     contained in an HSM) is imported into one of the Windows key stores,
</I>&gt;<i>     it has to be associated with a provider, and that provider has to
</I>&gt;<i>     accommodate that type and size of key; otherwise the key is
</I>&gt;<i>     unusable. Then, when you try to use the key in CAPI, you have to
</I>&gt;<i>     specify the same provider - CAPI isn't smart enough to figure it out
</I>&gt;<i>     on its own.
</I>&gt;<i> 
</I>&gt;<i>     So my version of the CAPI engine has code to look up the key's
</I>&gt;<i>     provider and silently correct the provider type information in the
</I>&gt;<i>     engine's context structure if it's a mismatch.
</I>&gt;<i> 
</I>&gt;<i>     Beyond that, it appears that my changes included:
</I>&gt;<i> 
</I>&gt;<i>     - Support for building all the necessary functionality when using
</I>&gt;<i>     Microsoft Windows SDK 6.0A, which was one of my requirements at the
</I>&gt;<i>     time.
</I>&gt;<i> 
</I>&gt;<i>     - Supporting hashes other than SHA-1 for DSA. We have US Federal
</I>&gt;<i>     customers who needed fairly comprehensive DSA support. For most
</I>&gt;<i>     people this is likely a non-issue.
</I>&gt;<i> 
</I>&gt;<i>     - Forcing stack probes on for the callback functions, because my
</I>&gt;<i>     engine was being built outside the OpenSSL build process, but needed
</I>&gt;<i>     to match the calling convention of OpenSSL, which (at least in
</I>&gt;<i>     1.0.1j) included stack-probe support.
</I>&gt;<i> 
</I>&gt;<i>     - A fix suggested by Steven Henson years ago on the mailing list to
</I>&gt;<i>     capi_get_key, but never (at least by 1.0.1j) picked up in the source
</I>&gt;<i>     code: If CryptGetUserKey returns NTE_NO_KEY, xor keyspec with 3 to
</I>&gt;<i>     flip the key type and try CryptGetUesrKey again.
</I>&gt;<i> 
</I>&gt;<i>     I think that's it, though it's possible I tweaked some other things
</I>&gt;<i>     and didn't call them out in the comments.
</I>&gt;<i> 
</I>&gt;<i>     I suppose I should check what the CAPI engine source looks like in
</I>&gt;<i>     1.1.1, merge my changes in if feasible, and submit a PR. One of
</I>&gt;<i>     these days...
</I>&gt;<i> 
</I>&gt;<i>     Really, though, what we need is a new engine written to use CNG
</I>&gt;<i>     rather than CAPI. Though that would have the disadvantage of not
</I>&gt;<i>     supporting ancient Windows OS and SDK versions which, while
</I>&gt;<i>     unsupported by Microsoft, are still used in far too many places.
</I>&gt;<i> 
</I>&gt;<i>     --
</I>&gt;<i>     Michael Wojcik
</I>&gt;<i>     Distinguished Engineer, Micro Focus
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 3
</I>&gt;<i>     Date: Tue, 23 Oct 2018 15:37:25 +0000
</I>&gt;<i>     From: Michael Wojcik &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>&gt;&gt;
</I>&gt;<i>     To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&quot;
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] Reg issue in alert message
</I>&gt;<i>     Message-ID:
</I>&gt;<i>     &#160; &#160; &#160; &#160;
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB13246F528FB866508D8E9267F9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB13246F528FB866508D8E9267F9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>&gt;&gt;
</I>&gt;<i> 
</I>&gt;<i>     Content-Type: text/plain; charset=&quot;Windows-1252&quot;
</I>&gt;<i> 
</I>&gt;<i>     &gt; From: openssl-users [mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;] On Behalf
</I>&gt;<i>     &gt; Of Viktor Dukhovni
</I>&gt;<i>     &gt; Sent: Tuesday, October 23, 2018 10:02
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; On Tue, Oct 23, 2018 at 01:29:27PM +0100, Matt Caswell wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; &gt; &gt; So, I think client have set TLS_FALLBACK_SCSV in cipher suite
</I>&gt;<i>     list in
</I>&gt;<i>     &gt; &gt; &gt; client hello.
</I>&gt;<i>     &gt; &gt;
</I>&gt;<i>     &gt; &gt; This suggests there is a bug in the client application. This can
</I>&gt;<i>     only
</I>&gt;<i>     &gt; &gt; happen if the client application calls SSL_CTX_set_mode() or
</I>&gt;<i>     &gt; &gt; SSL_set_mode() to set the SSL_MODE_SEND_FALLBACK_SCSV mode.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; I have a somewhat plausible, if dicey hunch:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Perhaps some application developers got confused between
</I>&gt;<i>     &gt;&#160; &#160; &#160;the similar functions SSL_CTX_set_session_cache_mode(3)
</I>&gt;<i>     &gt;&#160; &#160; &#160;and SSL_CTX_set_mode(3) and called the wrong one?
</I>&gt;<i> 
</I>&gt;<i>     Certainly possible, but I wouldn't discount the possibility that
</I>&gt;<i>     someone simply thought setting SSL_MODE_SEND_FALLBACK_SCSV was the
</I>&gt;<i>     Right Thing. There was a fair bit of confusion around the Fallback
</I>&gt;<i>     SCSV when it first appeared (we had questions from customers that
</I>&gt;<i>     indicated they didn't understand it, and I had to read the ID to
</I>&gt;<i>     make sure I did). And, of course, TLS is mightly confusing in general.
</I>&gt;<i> 
</I>&gt;<i>     It is interesting to note that those two options happen to have the
</I>&gt;<i>     same value, though, particularly given the similarity of the two
</I>&gt;<i>     function names.
</I>&gt;<i> 
</I>&gt;<i>     This is one of those cases where C's weak type system is a problem.
</I>&gt;<i>     Though it would be nice if OpenSSL used enums rather than macros for
</I>&gt;<i>     these things.
</I>&gt;<i> 
</I>&gt;<i>     --
</I>&gt;<i>     Michael Wojcik
</I>&gt;<i>     Distinguished Engineer, Micro Focus
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 4
</I>&gt;<i>     Date: Tue, 23 Oct 2018 17:42:56 +0200
</I>&gt;<i>     From: Jakob Bohm &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">jb-openssl at wisemo.com</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">jb-openssl at wisemo.com</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] CAPI-Engine doc
</I>&gt;<i>     Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">fc161e84-bf5f-f61b-0f1d-3bfa5641edd8 at wisemo.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">fc161e84-bf5f-f61b-0f1d-3bfa5641edd8 at wisemo.com</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=utf-8; format=flowed
</I>&gt;<i> 
</I>&gt;<i>     On 23/10/2018 17:22, Selva Nair wrote:
</I>&gt;<i>     &gt; On Tue, Oct 23, 2018 at 10:38 AM Richard Oehlinger via openssl-users
</I>&gt;<i>     &gt; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt; wrote:
</I>&gt;<i>     &gt;&gt; Hi!
</I>&gt;<i>     &gt;&gt;
</I>&gt;<i>     &gt;&gt; I'm trying to get a handle on the CAPI engine, because I need to
</I>&gt;<i>     have a
</I>&gt;<i>     &gt;&gt; secure Keystore on Windows. Furthermore I need it to work with Qt's
</I>&gt;<i>     &gt;&gt; QSslKey, which fortunately can be constructed by EVP_PKEY *.
</I>&gt;<i>     &gt;&gt;
</I>&gt;<i>     &gt;&gt; So far so good. The key is found, but when I try to use it in a SSL
</I>&gt;<i>     &gt;&gt; connection i get following error:
</I>&gt;<i>     &gt;&gt;
</I>&gt;<i>     &gt;&gt; error:80070063:lib(128):CAPI_RSA_SIGN:cant create hash object,
</I>&gt;<i>     &gt;&gt; error:1409B006:SSL routines:ssl3_send_server_key_exchange:EVP lib
</I>&gt;<i>     &gt; Which version of OpenSSL?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&gt; Trace Output is:
</I>&gt;<i>     &gt;&gt;
</I>&gt;<i>     &gt;&gt; Setting debug file to C:\Users\user\AppData\Local\Temp\engine.txt
</I>&gt;<i>     &gt;&gt; Opening certificate store MY
</I>&gt;<i>     &gt;&gt; capi_get_key, contname={4EBA52A8-AB4B-47DB-B777-2B26351F324C},
</I>&gt;<i>     &gt;&gt; provname=Microsoft Enhanced Cryptographic Provider v1.0, type=1
</I>&gt;<i>     &gt;&gt; Called CAPI_rsa_sign()
</I>&gt;<i>     &gt; This CSP cannot do SHA2 hashes so won't work unless you restrict
</I>&gt;<i>     &gt; signature algorithms or set TLS version to 1.1. I believe OpenSSL
</I>&gt;<i>     &gt; 1.1.0 will try to load The &quot;.. Enhanced RSA AES .. Provider&quot; which
</I>&gt;<i>     &gt; can handle SHA2 and may work. I say &quot;may&quot; because, if the key store is
</I>&gt;<i>     &gt; a legacy hardware token, it also depends on signature algorithms
</I>&gt;<i>     supported
</I>&gt;<i>     &gt; by the token and may be necessary to downgrade to TLS 1.1.
</I>&gt;<i>     &gt;
</I>&gt;<i>     The above limitations are less severe in CNG (&quot;CryptoAPI Next
</I>&gt;<i>     Generation&quot;)
</I>&gt;<i>     on Windows 6.00 and later, where the old API and CSP names are actually
</I>&gt;<i>     emulations on top of a new structure with much smaller &quot;KSP&quot; providers.
</I>&gt;<i>     At the same time, the CNG emulation of the classic CryptoAPI functions
</I>&gt;<i>     are limited to what was available in Windows 5.01 SP2 and 5.02 SP2, thus
</I>&gt;<i>     much of the SHA-2 functionality is available only by calling the CNG
</I>&gt;<i>     APIs directly on Windows &gt;= 6.00, but the older APIs with a reference
</I>&gt;<i>     to newer enum values introduced in Windows 5.01 SP3 or 5.02 SP2+Hotfix.
</I>&gt;<i> 
</I>&gt;<i>     Put another way, Microsoft forked their crypto source tree sometime in
</I>&gt;<i>     2004 or 2005, and anything added later was implemented differently in
</I>&gt;<i>     the 5.0x and 6.0x code bases.
</I>&gt;<i> 
</I>&gt;<i>     Enjoy
</I>&gt;<i> 
</I>&gt;<i>     Jakob
</I>&gt;<i>     -- 
</I>&gt;<i>     Jakob Bohm, CIO, Partner, WiseMo A/S.&#160; <A HREF="https://www.wisemo.com">https://www.wisemo.com</A>
</I>&gt;<i>     Transformervej 29, 2860 S?borg, Denmark.&#160; Direct +45 31 13 16 10
</I>&gt;<i>     This public discussion message is non-binding and may contain errors.
</I>&gt;<i>     WiseMo - Remote Service Management for PCs, Phones and Embedded
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 5
</I>&gt;<i>     Date: Tue, 23 Oct 2018 23:16:13 -0700 (MST)
</I>&gt;<i>     From: sakdev &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">best.sakthi3 at gmail.com</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">best.sakthi3 at gmail.com</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] Openssl Build Error- module unsafe for
</I>&gt;<i>     &#160; &#160; &#160; &#160; SAFESEH image/Unable to generate SAFESEH image
</I>&gt;<i>     Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">1540361773425-0.post at n7.nabble.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">1540361773425-0.post at n7.nabble.com</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=us-ascii
</I>&gt;<i> 
</I>&gt;<i>     Added &quot;/safeseh&quot; in assembler flags and problem got solved. Thank
</I>&gt;<i>     you very
</I>&gt;<i>     much.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     --
</I>&gt;<i>     Sent from: <A HREF="http://openssl.6102.n7.nabble.com/OpenSSL-User-f3.html">http://openssl.6102.n7.nabble.com/OpenSSL-User-f3.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Subject: Digest Footer
</I>&gt;<i> 
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     openssl-users mailing list
</I>&gt;<i>     <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     End of openssl-users Digest, Vol 47, Issue 45
</I>&gt;<i>     *********************************************
</I>&gt;<i> 
</I>&gt;<i> 
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009102.html">[openssl-users] Reg issue in alert message
</A></li>
	<LI>Next message: <A HREF="009108.html">[openssl-users] Reg issue in alert message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9103">[ date ]</a>
              <a href="thread.html#9103">[ thread ]</a>
              <a href="subject.html#9103">[ subject ]</a>
              <a href="author.html#9103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
