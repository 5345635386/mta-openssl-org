<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Reg issue in alert message
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-October/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Reg%20issue%20in%20alert%20message&In-Reply-To=%3Cacf512b8-b3fe-83b9-aad2-68d03b336e35%40openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009108.html">
   <LINK REL="Next"  HREF="009080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Reg issue in alert message</H1>
    <B>Matt Caswell</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Reg%20issue%20in%20alert%20message&In-Reply-To=%3Cacf512b8-b3fe-83b9-aad2-68d03b336e35%40openssl.org%3E"
       TITLE="[openssl-users] Reg issue in alert message">matt at openssl.org
       </A><BR>
    <I>Fri Oct 26 10:55:09 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009108.html">[openssl-users] Reg issue in alert message
</A></li>
        <LI>Next message: <A HREF="009080.html">[openssl-users] How to compile 1.1.1 under Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9115">[ date ]</a>
              <a href="thread.html#9115">[ thread ]</a>
              <a href="subject.html#9115">[ subject ]</a>
              <a href="author.html#9115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 25/10/2018 10:12, ramakrushna mishra wrote:
&gt;<i> Hi Matt,
</I>&gt;<i> 
</I>&gt;<i> Thank you for the response.
</I>&gt;<i> But I wanted to know the handshake behavior when client has support for
</I>&gt;<i> &quot;TLSv1.3,TLSv1.2&quot; and server has support for (&quot;TLSv1.2,TLSv1&quot;)&#160; or
</I>&gt;<i> (&quot;TLSv1.2,SSLv3).
</I>&gt;<i> 
</I>&gt;<i> Both client and server is built with openssl 1.1.1 and the above
</I>&gt;<i> connection fails with handshake failure.&#160; The same connection works if
</I>&gt;<i> server has continious range of protocol version such as
</I>&gt;<i> (&quot;TLSv1.2,TLSv1.1,TLSv1,SSLv3).&#160;
</I>&gt;<i> 
</I>&gt;<i> So, is the handshake behavior change if the supported protocol versions
</I>&gt;<i> are not in continuous range ?
</I>
On the server side I would expect this to successfully connect with
TLSv1.2. I just tested this using s_server/s_client and it worked as
expected:

$ openssl s_server -no_tls1_3 -no_tls1_1
$ openssl s_client -min_protocol &quot;TLSv1.2&quot;

A non continuous range on the client side works slightly differently. So
this fails:

$ openssl s_server -min_protocol &quot;TLSv1.2&quot;
$ openssl s_client -no_tls1_3 -no_tls1_1

This is because of the way the supported versions are advertised by the
client in the ClientHello. In the above scenario the client will
advertise TLSv1.0 as its highest supported version.

Matt


&gt;<i> 
</I>&gt;<i> Thanks and regards,
</I>&gt;<i> Ram Krushna
</I>&gt;<i> 
</I>&gt;<i> On Wed, Oct 24, 2018 at 10:14 PM &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     Send openssl-users mailing list submissions to
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i>     or, via email, send a message with subject or body 'help' to
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     You can reach the person managing the list at
</I>&gt;<i>     &#160; &#160; &#160; &#160; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     When replying, please edit your Subject line so it is more specific
</I>&gt;<i>     than &quot;Re: Contents of openssl-users digest...&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Today's Topics:
</I>&gt;<i> 
</I>&gt;<i>     &#160; &#160;1. Re: Reg issue in alert message (Matt Caswell)
</I>&gt;<i>     &#160; &#160;2. Using SM2 ECIES in 1.1.1 (Akira Takahashi)
</I>&gt;<i>     &#160; &#160;3. Re: Using SM2 ECIES in 1.1.1 (Matt Caswell)
</I>&gt;<i>     &#160; &#160;4. openssl cms encrypt recipientInfo [questions for&#160; openssl
</I>&gt;<i>     &#160; &#160; &#160; developers]. (???? ?????????)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ----------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 1
</I>&gt;<i>     Date: Wed, 24 Oct 2018 13:57:04 +0100
</I>&gt;<i>     From: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] Reg issue in alert message
</I>&gt;<i>     Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">eb5d58cb-e8b8-fc6b-5992-a25e83e8d2e6 at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">eb5d58cb-e8b8-fc6b-5992-a25e83e8d2e6 at openssl.org</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     On 24/10/2018 13:25, ramakrushna mishra wrote:
</I>&gt;<i>     &gt; Hi All,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Thank you for all for providing the information.
</I>&gt;<i>     &gt; I suspect we are using &quot; SSL_MODE_SEND_FALLBACK_SCSV??&quot; and that might
</I>&gt;<i>     &gt; be causing the issue.? The team is looking into this issue now
</I>&gt;<i>     with the
</I>&gt;<i>     &gt; provided information.?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ?One doubt that came during? our investigation is :
</I>&gt;<i>     &gt; &quot; If client has highest version of TLS1.3 and server has support for
</I>&gt;<i>     &gt; TLS1.2 and SLV3 only.? ?How the handshake will? proceed ? &quot;
</I>&gt;<i> 
</I>&gt;<i>     The protocol will negotiate the highest commonly supported protocol
</I>&gt;<i>     version. So if the server supports TLS1.3 and the client only supports
</I>&gt;<i>     TLS1.2 then TLS1.2 will be used. Don't use SSLv3. That is disabled by
</I>&gt;<i>     default in current OpenSSL versions.
</I>&gt;<i> 
</I>&gt;<i>     Matt
</I>&gt;<i> 
</I>&gt;<i>     &gt; I am not sure if this question should go to a new thread ?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Thanks and Regards,
</I>&gt;<i>     &gt; Ram Krushna
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; On Wed, Oct 24, 2018 at 11:47 AM
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;
</I>&gt;<i>     &gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Send openssl-users mailing list submissions to
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ? <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ? <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i>     &gt;&#160; &#160; &#160;or, via email, send a message with subject or body 'help' to
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ? <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;You can reach the person managing the list at
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ? <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;When replying, please edit your Subject line so it is more
</I>&gt;<i>     specific
</I>&gt;<i>     &gt;&#160; &#160; &#160;than &quot;Re: Contents of openssl-users digest...&quot;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Today's Topics:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ?1. Re: CAPI-Engine doc (Selva Nair)
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ?2. Re: CAPI-Engine doc (Michael Wojcik)
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ?3. Re: Reg issue in alert message (Michael Wojcik)
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ?4. Re: CAPI-Engine doc (Jakob Bohm)
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ?5. Re: Openssl Build Error- module unsafe for SAFESEH
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? image/Unable to generate SAFESEH image (sakdev)
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;----------------------------------------------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message: 1
</I>&gt;<i>     &gt;&#160; &#160; &#160;Date: Tue, 23 Oct 2018 11:22:04 -0400
</I>&gt;<i>     &gt;&#160; &#160; &#160;From: Selva Nair &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">selva.nair at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">selva.nair at gmail.com</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">selva.nair at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">selva.nair at gmail.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;To: <A HREF="../../../mailman/listinfo/openssl-users.html">richard.oehlinger at adbsafegate.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">richard.oehlinger at adbsafegate.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">richard.oehlinger at adbsafegate.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">richard.oehlinger at adbsafegate.com</A>&gt;&gt;,
</I>&gt;<i>     &gt;&#160; &#160; &#160;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Subject: Re: [openssl-users] CAPI-Engine doc
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message-ID:
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ?
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;&lt;CAKuzo_iqEBP-QG19Hsg5dFVoUG+2q-5O=<A HREF="../../../mailman/listinfo/openssl-users.html">vfg_NTzAJsQj+D3Jw at mail.gmail.com</A>
</I>&gt;<i>     &lt;mailto:vfg_NTzAJsQj%<A HREF="../../../mailman/listinfo/openssl-users.html">2BD3Jw at mail.gmail.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:vfg_NTzAJsQj%<A HREF="../../../mailman/listinfo/openssl-users.html">2BD3Jw at mail.gmail.com</A>
</I>&gt;<i>     &lt;mailto:vfg_NTzAJsQj%<A HREF="../../../mailman/listinfo/openssl-users.html">252BD3Jw at mail.gmail.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Content-Type: text/plain; charset=&quot;UTF-8&quot;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;On Tue, Oct 23, 2018 at 10:38 AM Richard Oehlinger via
</I>&gt;<i>     openssl-users
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Hi!
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; I'm trying to get a handle on the CAPI engine, because I need to
</I>&gt;<i>     &gt;&#160; &#160; &#160;have a
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; secure Keystore on Windows. Furthermore I need it to work
</I>&gt;<i>     with Qt's
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; QSslKey, which fortunately can be constructed by EVP_PKEY *.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; So far so good. The key is found, but when I try to use it
</I>&gt;<i>     in a SSL
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; connection i get following error:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; error:80070063:lib(128):CAPI_RSA_SIGN:cant create hash object,
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; error:1409B006:SSL
</I>&gt;<i>     routines:ssl3_send_server_key_exchange:EVP lib
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Which version of OpenSSL?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Trace Output is:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Setting debug file to
</I>&gt;<i>     C:\Users\user\AppData\Local\Temp\engine.txt
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Opening certificate store MY
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; capi_get_key, contname={4EBA52A8-AB4B-47DB-B777-2B26351F324C},
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; provname=Microsoft Enhanced Cryptographic Provider v1.0, type=1
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Called CAPI_rsa_sign()
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;This CSP cannot do SHA2 hashes so won't work unless you restrict
</I>&gt;<i>     &gt;&#160; &#160; &#160;signature algorithms or set TLS version to 1.1. I believe OpenSSL
</I>&gt;<i>     &gt;&#160; &#160; &#160;1.1.0 will try to load The &quot;.. Enhanced RSA AES .. Provider&quot; which
</I>&gt;<i>     &gt;&#160; &#160; &#160;can handle SHA2 and may work. I say &quot;may&quot; because, if the key
</I>&gt;<i>     store is
</I>&gt;<i>     &gt;&#160; &#160; &#160;a legacy hardware token, it also depends on signature algorithms
</I>&gt;<i>     &gt;&#160; &#160; &#160;supported
</I>&gt;<i>     &gt;&#160; &#160; &#160;by the token and may be necessary to downgrade to TLS 1.1.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Selva
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message: 2
</I>&gt;<i>     &gt;&#160; &#160; &#160;Date: Tue, 23 Oct 2018 15:37:24 +0000
</I>&gt;<i>     &gt;&#160; &#160; &#160;From: Michael Wojcik &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;&quot;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Subject: Re: [openssl-users] CAPI-Engine doc
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message-ID:
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ?
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB1324455050CC00BD3A2DD70FF9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB1324455050CC00BD3A2DD70FF9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB1324455050CC00BD3A2DD70FF9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB1324455050CC00BD3A2DD70FF9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Content-Type: text/plain; charset=&quot;Windows-1252&quot;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; From: openssl-users
</I>&gt;<i>     [mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;&gt;] On Behalf
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Of Richard Oehlinger via openssl-users
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Sent: Tuesday, October 23, 2018 10:38
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; I'm trying to get a handle on the CAPI engine, because I need to
</I>&gt;<i>     &gt;&#160; &#160; &#160;have a
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; secure Keystore on Windows. Furthermore I need it to work
</I>&gt;<i>     with Qt's
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; QSslKey, which fortunately can be constructed by EVP_PKEY *.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;What OpenSSL version are you using? Please remember to include
</I>&gt;<i>     this
</I>&gt;<i>     &gt;&#160; &#160; &#160;informtion in every question. (And, normally, we'd ask for the
</I>&gt;<i>     &gt;&#160; &#160; &#160;platform as well, but since CAPI is Windows-specific, we know that
</I>&gt;<i>     &gt;&#160; &#160; &#160;in this case.)
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; So far so good. The key is found, but when I try to use it
</I>&gt;<i>     in a SSL
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; connection i get following error:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; error:80070063:lib(128):CAPI_RSA_SIGN:cant create hash object,
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; error:1409B006:SSL
</I>&gt;<i>     routines:ssl3_send_server_key_exchange:EVP lib
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; I use a current Windows 10. Do I need to use a different
</I>&gt;<i>     Algorithm in
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; order to work? Some googeling is indicating the provider
</I>&gt;<i>     might be
</I>&gt;<i>     &gt;&#160; &#160; &#160;wrong.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;I haven't looked at the CAPI engine code since 1.0.1j. At that
</I>&gt;<i>     time,
</I>&gt;<i>     &gt;&#160; &#160; &#160;I needed CAPI support and discovered there were various issues
</I>&gt;<i>     with
</I>&gt;<i>     &gt;&#160; &#160; &#160;the extant CAPI code, so I forked and rewrote it. That was
</I>&gt;<i>     some time
</I>&gt;<i>     &gt;&#160; &#160; &#160;back, obviously, and I'm afraid I never got around to pushing the
</I>&gt;<i>     &gt;&#160; &#160; &#160;changes back to openssl.org &lt;<A HREF="http://openssl.org">http://openssl.org</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://openssl.org">http://openssl.org</A>&gt;. (In fact, it was
</I>&gt;<i>     &gt;&#160; &#160; &#160;sufficiently long ago that I believe the organization was still
</I>&gt;<i>     &gt;&#160; &#160; &#160;reluctant to take contributions from people in the US at the
</I>&gt;<i>     time.)
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;The biggest issue was with provider handling. CAPI is
</I>&gt;<i>     something of a
</I>&gt;<i>     &gt;&#160; &#160; &#160;braindead API in many ways - Microsoft's replacement, CNG, is
</I>&gt;<i>     &gt;&#160; &#160; &#160;somewhat better - and the provider stuff is one of them. When
</I>&gt;<i>     a key
</I>&gt;<i>     &gt;&#160; &#160; &#160;(including a &quot;key&quot; which is actually just a reference to a key
</I>&gt;<i>     &gt;&#160; &#160; &#160;contained in an HSM) is imported into one of the Windows key
</I>&gt;<i>     stores,
</I>&gt;<i>     &gt;&#160; &#160; &#160;it has to be associated with a provider, and that provider has to
</I>&gt;<i>     &gt;&#160; &#160; &#160;accommodate that type and size of key; otherwise the key is
</I>&gt;<i>     &gt;&#160; &#160; &#160;unusable. Then, when you try to use the key in CAPI, you have to
</I>&gt;<i>     &gt;&#160; &#160; &#160;specify the same provider - CAPI isn't smart enough to figure
</I>&gt;<i>     it out
</I>&gt;<i>     &gt;&#160; &#160; &#160;on its own.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;So my version of the CAPI engine has code to look up the key's
</I>&gt;<i>     &gt;&#160; &#160; &#160;provider and silently correct the provider type information in the
</I>&gt;<i>     &gt;&#160; &#160; &#160;engine's context structure if it's a mismatch.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Beyond that, it appears that my changes included:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;- Support for building all the necessary functionality when using
</I>&gt;<i>     &gt;&#160; &#160; &#160;Microsoft Windows SDK 6.0A, which was one of my requirements
</I>&gt;<i>     at the
</I>&gt;<i>     &gt;&#160; &#160; &#160;time.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;- Supporting hashes other than SHA-1 for DSA. We have US Federal
</I>&gt;<i>     &gt;&#160; &#160; &#160;customers who needed fairly comprehensive DSA support. For most
</I>&gt;<i>     &gt;&#160; &#160; &#160;people this is likely a non-issue.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;- Forcing stack probes on for the callback functions, because my
</I>&gt;<i>     &gt;&#160; &#160; &#160;engine was being built outside the OpenSSL build process, but
</I>&gt;<i>     needed
</I>&gt;<i>     &gt;&#160; &#160; &#160;to match the calling convention of OpenSSL, which (at least in
</I>&gt;<i>     &gt;&#160; &#160; &#160;1.0.1j) included stack-probe support.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;- A fix suggested by Steven Henson years ago on the mailing
</I>&gt;<i>     list to
</I>&gt;<i>     &gt;&#160; &#160; &#160;capi_get_key, but never (at least by 1.0.1j) picked up in the
</I>&gt;<i>     source
</I>&gt;<i>     &gt;&#160; &#160; &#160;code: If CryptGetUserKey returns NTE_NO_KEY, xor keyspec with 3 to
</I>&gt;<i>     &gt;&#160; &#160; &#160;flip the key type and try CryptGetUesrKey again.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;I think that's it, though it's possible I tweaked some other
</I>&gt;<i>     things
</I>&gt;<i>     &gt;&#160; &#160; &#160;and didn't call them out in the comments.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;I suppose I should check what the CAPI engine source looks like in
</I>&gt;<i>     &gt;&#160; &#160; &#160;1.1.1, merge my changes in if feasible, and submit a PR. One of
</I>&gt;<i>     &gt;&#160; &#160; &#160;these days...
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Really, though, what we need is a new engine written to use CNG
</I>&gt;<i>     &gt;&#160; &#160; &#160;rather than CAPI. Though that would have the disadvantage of not
</I>&gt;<i>     &gt;&#160; &#160; &#160;supporting ancient Windows OS and SDK versions which, while
</I>&gt;<i>     &gt;&#160; &#160; &#160;unsupported by Microsoft, are still used in far too many places.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;--
</I>&gt;<i>     &gt;&#160; &#160; &#160;Michael Wojcik
</I>&gt;<i>     &gt;&#160; &#160; &#160;Distinguished Engineer, Micro Focus
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message: 3
</I>&gt;<i>     &gt;&#160; &#160; &#160;Date: Tue, 23 Oct 2018 15:37:25 +0000
</I>&gt;<i>     &gt;&#160; &#160; &#160;From: Michael Wojcik &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Michael.Wojcik at microfocus.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;&quot;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Subject: Re: [openssl-users] Reg issue in alert message
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message-ID:
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ?
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB13246F528FB866508D8E9267F9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB13246F528FB866508D8E9267F9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB13246F528FB866508D8E9267F9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">DM5PR18MB13246F528FB866508D8E9267F9F50 at DM5PR18MB1324.namprd18.prod.outlook.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Content-Type: text/plain; charset=&quot;Windows-1252&quot;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; From: openssl-users
</I>&gt;<i>     [mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;&gt;] On Behalf
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Of Viktor Dukhovni
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Sent: Tuesday, October 23, 2018 10:02
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; On Tue, Oct 23, 2018 at 01:29:27PM +0100, Matt Caswell wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &gt; &gt; So, I think client have set TLS_FALLBACK_SCSV in cipher
</I>&gt;<i>     suite
</I>&gt;<i>     &gt;&#160; &#160; &#160;list in
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &gt; &gt; client hello.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &gt; This suggests there is a bug in the client application.
</I>&gt;<i>     This can
</I>&gt;<i>     &gt;&#160; &#160; &#160;only
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &gt; happen if the client application calls SSL_CTX_set_mode() or
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &gt; SSL_set_mode() to set the SSL_MODE_SEND_FALLBACK_SCSV mode.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; I have a somewhat plausible, if dicey hunch:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;? ? ?Perhaps some application developers got confused between
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;? ? ?the similar functions SSL_CTX_set_session_cache_mode(3)
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;? ? ?and SSL_CTX_set_mode(3) and called the wrong one?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Certainly possible, but I wouldn't discount the possibility that
</I>&gt;<i>     &gt;&#160; &#160; &#160;someone simply thought setting SSL_MODE_SEND_FALLBACK_SCSV was the
</I>&gt;<i>     &gt;&#160; &#160; &#160;Right Thing. There was a fair bit of confusion around the Fallback
</I>&gt;<i>     &gt;&#160; &#160; &#160;SCSV when it first appeared (we had questions from customers that
</I>&gt;<i>     &gt;&#160; &#160; &#160;indicated they didn't understand it, and I had to read the ID to
</I>&gt;<i>     &gt;&#160; &#160; &#160;make sure I did). And, of course, TLS is mightly confusing in
</I>&gt;<i>     general.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;It is interesting to note that those two options happen to
</I>&gt;<i>     have the
</I>&gt;<i>     &gt;&#160; &#160; &#160;same value, though, particularly given the similarity of the two
</I>&gt;<i>     &gt;&#160; &#160; &#160;function names.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;This is one of those cases where C's weak type system is a
</I>&gt;<i>     problem.
</I>&gt;<i>     &gt;&#160; &#160; &#160;Though it would be nice if OpenSSL used enums rather than
</I>&gt;<i>     macros for
</I>&gt;<i>     &gt;&#160; &#160; &#160;these things.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;--
</I>&gt;<i>     &gt;&#160; &#160; &#160;Michael Wojcik
</I>&gt;<i>     &gt;&#160; &#160; &#160;Distinguished Engineer, Micro Focus
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message: 4
</I>&gt;<i>     &gt;&#160; &#160; &#160;Date: Tue, 23 Oct 2018 17:42:56 +0200
</I>&gt;<i>     &gt;&#160; &#160; &#160;From: Jakob Bohm &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">jb-openssl at wisemo.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">jb-openssl at wisemo.com</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">jb-openssl at wisemo.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">jb-openssl at wisemo.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Subject: Re: [openssl-users] CAPI-Engine doc
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">fc161e84-bf5f-f61b-0f1d-3bfa5641edd8 at wisemo.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">fc161e84-bf5f-f61b-0f1d-3bfa5641edd8 at wisemo.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">fc161e84-bf5f-f61b-0f1d-3bfa5641edd8 at wisemo.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">fc161e84-bf5f-f61b-0f1d-3bfa5641edd8 at wisemo.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Content-Type: text/plain; charset=utf-8; format=flowed
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;On 23/10/2018 17:22, Selva Nair wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; On Tue, Oct 23, 2018 at 10:38 AM Richard Oehlinger via
</I>&gt;<i>     openssl-users
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; Hi!
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; I'm trying to get a handle on the CAPI engine, because I
</I>&gt;<i>     need to
</I>&gt;<i>     &gt;&#160; &#160; &#160;have a
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; secure Keystore on Windows. Furthermore I need it to work
</I>&gt;<i>     with Qt's
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; QSslKey, which fortunately can be constructed by EVP_PKEY *.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; So far so good. The key is found, but when I try to use it
</I>&gt;<i>     in a SSL
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; connection i get following error:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; error:80070063:lib(128):CAPI_RSA_SIGN:cant create hash object,
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; error:1409B006:SSL
</I>&gt;<i>     routines:ssl3_send_server_key_exchange:EVP lib
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; Which version of OpenSSL?
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; Trace Output is:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; Setting debug file to
</I>&gt;<i>     C:\Users\user\AppData\Local\Temp\engine.txt
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; Opening certificate store MY
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; capi_get_key, contname={4EBA52A8-AB4B-47DB-B777-2B26351F324C},
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; provname=Microsoft Enhanced Cryptographic Provider v1.0, type=1
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&gt; Called CAPI_rsa_sign()
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; This CSP cannot do SHA2 hashes so won't work unless you restrict
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; signature algorithms or set TLS version to 1.1. I believe
</I>&gt;<i>     OpenSSL
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; 1.1.0 will try to load The &quot;.. Enhanced RSA AES .. Provider&quot;
</I>&gt;<i>     which
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; can handle SHA2 and may work. I say &quot;may&quot; because, if the
</I>&gt;<i>     key store is
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; a legacy hardware token, it also depends on signature algorithms
</I>&gt;<i>     &gt;&#160; &#160; &#160;supported
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; by the token and may be necessary to downgrade to TLS 1.1.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;The above limitations are less severe in CNG (&quot;CryptoAPI Next
</I>&gt;<i>     &gt;&#160; &#160; &#160;Generation&quot;)
</I>&gt;<i>     &gt;&#160; &#160; &#160;on Windows 6.00 and later, where the old API and CSP names are
</I>&gt;<i>     actually
</I>&gt;<i>     &gt;&#160; &#160; &#160;emulations on top of a new structure with much smaller &quot;KSP&quot;
</I>&gt;<i>     providers.
</I>&gt;<i>     &gt;&#160; &#160; &#160;At the same time, the CNG emulation of the classic CryptoAPI
</I>&gt;<i>     functions
</I>&gt;<i>     &gt;&#160; &#160; &#160;are limited to what was available in Windows 5.01 SP2 and 5.02
</I>&gt;<i>     SP2, thus
</I>&gt;<i>     &gt;&#160; &#160; &#160;much of the SHA-2 functionality is available only by calling
</I>&gt;<i>     the CNG
</I>&gt;<i>     &gt;&#160; &#160; &#160;APIs directly on Windows &gt;= 6.00, but the older APIs with a
</I>&gt;<i>     reference
</I>&gt;<i>     &gt;&#160; &#160; &#160;to newer enum values introduced in Windows 5.01 SP3 or 5.02
</I>&gt;<i>     SP2+Hotfix.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Put another way, Microsoft forked their crypto source tree
</I>&gt;<i>     sometime in
</I>&gt;<i>     &gt;&#160; &#160; &#160;2004 or 2005, and anything added later was implemented
</I>&gt;<i>     differently in
</I>&gt;<i>     &gt;&#160; &#160; &#160;the 5.0x and 6.0x code bases.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Enjoy
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Jakob
</I>&gt;<i>     &gt;&#160; &#160; &#160;--
</I>&gt;<i>     &gt;&#160; &#160; &#160;Jakob Bohm, CIO, Partner, WiseMo A/S.? <A HREF="https://www.wisemo.com">https://www.wisemo.com</A>
</I>&gt;<i>     &gt;&#160; &#160; &#160;Transformervej 29, 2860 S?borg, Denmark.? Direct +45 31 13 16 10
</I>&gt;<i>     &gt;&#160; &#160; &#160;This public discussion message is non-binding and may contain
</I>&gt;<i>     errors.
</I>&gt;<i>     &gt;&#160; &#160; &#160;WiseMo - Remote Service Management for PCs, Phones and Embedded
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message: 5
</I>&gt;<i>     &gt;&#160; &#160; &#160;Date: Tue, 23 Oct 2018 23:16:13 -0700 (MST)
</I>&gt;<i>     &gt;&#160; &#160; &#160;From: sakdev &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">best.sakthi3 at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">best.sakthi3 at gmail.com</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">best.sakthi3 at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">best.sakthi3 at gmail.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Subject: Re: [openssl-users] Openssl Build Error- module
</I>&gt;<i>     unsafe for
</I>&gt;<i>     &gt;&#160; &#160; &#160;? ? ? ? SAFESEH image/Unable to generate SAFESEH image
</I>&gt;<i>     &gt;&#160; &#160; &#160;Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">1540361773425-0.post at n7.nabble.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">1540361773425-0.post at n7.nabble.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">1540361773425-0.post at n7.nabble.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">1540361773425-0.post at n7.nabble.com</A>&gt;&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Content-Type: text/plain; charset=us-ascii
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Added &quot;/safeseh&quot; in assembler flags and problem got solved. Thank
</I>&gt;<i>     &gt;&#160; &#160; &#160;you very
</I>&gt;<i>     &gt;&#160; &#160; &#160;much.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;--
</I>&gt;<i>     &gt;&#160; &#160; &#160;Sent from: <A HREF="http://openssl.6102.n7.nabble.com/OpenSSL-User-f3.html">http://openssl.6102.n7.nabble.com/OpenSSL-User-f3.html</A>
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Subject: Digest Footer
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;_______________________________________________
</I>&gt;<i>     &gt;&#160; &#160; &#160;openssl-users mailing list
</I>&gt;<i>     &gt;&#160; &#160; &#160;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;<A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;End of openssl-users Digest, Vol 47, Issue 45
</I>&gt;<i>     &gt;&#160; &#160; &#160;*********************************************
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 2
</I>&gt;<i>     Date: Wed, 24 Oct 2018 23:55:23 +0900
</I>&gt;<i>     From: Akira Takahashi &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">takahashi.akira.58s at kyoto-u.jp</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">takahashi.akira.58s at kyoto-u.jp</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: [openssl-users] Using SM2 ECIES in 1.1.1
</I>&gt;<i>     Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">f4163a25-e9b6-f60b-b3ea-8aadf2c190fe at kyoto-u.jp</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">f4163a25-e9b6-f60b-b3ea-8aadf2c190fe at kyoto-u.jp</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=utf-8; format=flowed
</I>&gt;<i> 
</I>&gt;<i>     Hi all,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Since the version 1.1.1 supports the SM2 public key cryptography
</I>&gt;<i>     suite I am
</I>&gt;<i>     trying to test its ECIES (found in crypto/sm2/sm2_crypto.c) over
</I>&gt;<i>     different
</I>&gt;<i>     standardized prime curves i.e. not just sm2p256v1.
</I>&gt;<i> 
</I>&gt;<i>     Is there CLI or minimal code snippet to achieve it via the EVP
</I>&gt;<i>     interface?
</I>&gt;<i> 
</I>&gt;<i>     The current man page of SM2 seems to only describe SM2 as a
</I>&gt;<i>     signature algorithm,
</I>&gt;<i>     but not as a public key encryption.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Thank you in advance for your help!
</I>&gt;<i> 
</I>&gt;<i>     Akira
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 3
</I>&gt;<i>     Date: Wed, 24 Oct 2018 16:14:47 +0100
</I>&gt;<i>     From: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: Re: [openssl-users] Using SM2 ECIES in 1.1.1
</I>&gt;<i>     Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">92097423-88c0-5a7d-9395-a84195b257d6 at openssl.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">92097423-88c0-5a7d-9395-a84195b257d6 at openssl.org</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     On 24/10/2018 15:55, Akira Takahashi wrote:
</I>&gt;<i>     &gt; Hi all,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Since the version 1.1.1 supports the SM2 public key cryptography
</I>&gt;<i>     suite I
</I>&gt;<i>     &gt; am trying to test its ECIES (found in crypto/sm2/sm2_crypto.c) over
</I>&gt;<i>     &gt; different standardized prime curves i.e. not just sm2p256v1.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Is there CLI or minimal code snippet to achieve it via the EVP
</I>&gt;<i>     interface?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; The current man page of SM2 seems to only describe SM2 as a signature
</I>&gt;<i>     &gt; algorithm, but not as a public key encryption.
</I>&gt;<i> 
</I>&gt;<i>     You can use the EVP_PKEY_encrypt() function for this purpose.
</I>&gt;<i> 
</I>&gt;<i>     A generic example (not SM2 specific) is on the EVP_PKEY_encrypt()
</I>&gt;<i>     man page:
</I>&gt;<i> 
</I>&gt;<i>     <A HREF="https://www.openssl.org/docs/man1.1.1/man3/EVP_PKEY_encrypt.html">https://www.openssl.org/docs/man1.1.1/man3/EVP_PKEY_encrypt.html</A>
</I>&gt;<i> 
</I>&gt;<i>     Doing this for SM2 is essentially the same as shown in that example
</I>&gt;<i>     except of course don't call the RSA specific
</I>&gt;<i>     EVP_PKEY_CTX_set_rsa_padding() function.
</I>&gt;<i> 
</I>&gt;<i>     Setting up of the EVP_PKEY itself to contain an SM2 key is the same as
</I>&gt;<i>     for sign/verify, i.e. you need to call EVP_PKEY_set_alias_type(). There
</I>&gt;<i>     is no need to set an id though. See:
</I>&gt;<i> 
</I>&gt;<i>     <A HREF="https://www.openssl.org/docs/man1.1.1/man7/SM2.html">https://www.openssl.org/docs/man1.1.1/man7/SM2.html</A>
</I>&gt;<i> 
</I>&gt;<i>     Hope that helps,
</I>&gt;<i> 
</I>&gt;<i>     Matt
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Message: 4
</I>&gt;<i>     Date: Wed, 24 Oct 2018 21:42:49 +0500
</I>&gt;<i>     From: ???? ????????? &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">socketpair at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">socketpair at gmail.com</A>&gt;&gt;
</I>&gt;<i>     To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     Subject: [openssl-users] openssl cms encrypt recipientInfo [questions
</I>&gt;<i>     &#160; &#160; &#160; &#160; for&#160; &#160; &#160;openssl developers].
</I>&gt;<i>     Message-ID:
</I>&gt;<i>     &#160; &#160; &#160; &#160;
</I>&gt;<i>     &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">CAEmTpZF9hUxy6fQyX+ZNgs-HBJiw6nxGVanXXix-vA8D8HgLXg at mail.gmail.com</A>
</I>&gt;<i>     &lt;mailto:CAEmTpZF9hUxy6fQyX%<A HREF="../../../mailman/listinfo/openssl-users.html">2BZNgs-HBJiw6nxGVanXXix-vA8D8HgLXg at mail.gmail.com</A>&gt;&gt;
</I>&gt;<i>     Content-Type: text/plain; charset=&quot;UTF-8&quot;
</I>&gt;<i> 
</I>&gt;<i>     Here is a dump of my CMS encrypted message.
</I>&gt;<i> 
</I>&gt;<i>     ===================
</I>&gt;<i>     CMS_ContentInfo:.
</I>&gt;<i>     &#160; contentType: pkcs7-envelopedData (1.2.840.113549.1.7.3)
</I>&gt;<i>     &#160; d.envelopedData:.
</I>&gt;<i>     &#160; &#160; version: 2
</I>&gt;<i>     &#160; &#160; originatorInfo: &lt;ABSENT&gt;
</I>&gt;<i>     &#160; &#160; recipientInfos:
</I>&gt;<i>     &#160; &#160; &#160; d.kari:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; version: 3
</I>&gt;<i>     &#160; &#160; &#160; &#160; d.originatorKey:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; algorithm:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; algorithm: id-ecPublicKey (1.2.840.10045.2.1)
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; parameter: &lt;ABSENT&gt;
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; publicKey:&#160; (0 unused bits)
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; 0000 - 04 89 ee 81 d8 05 30 2d-4e 3a a3 33 dd 8b&#160;
</I>&gt;<i>     &#160;......0-N:.3..
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; 000e - c5 7d 56 79 02 2b 16 7a-f5 4c 20 3f 18 ed&#160;
</I>&gt;<i>     &#160;.}Vy.+.z.L ?..
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; 001c - 92 ba 81 98 88 f8 7a 6c-41 ba 8e bb c0 a5&#160;
</I>&gt;<i>     &#160;......zlA.....
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; 002a - 41 c4 2a fe 36 31 5c f3-92 9c b5 ad 79 a9&#160;
</I>&gt;<i>     &#160;A.*.61\.....y.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; 0038 - 9c 4c 75 69 23 9d a1 5b-ef&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .Lui#..[.
</I>&gt;<i>     &#160; &#160; &#160; &#160; ukm: &lt;ABSENT&gt;
</I>&gt;<i>     &#160; &#160; &#160; &#160; keyEncryptionAlgorithm:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; algorithm: dhSinglePass-stdDH-sha256kdf-scheme
</I>&gt;<i>     (1.3.132.1.11.1)
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; parameter: SEQUENCE:
</I>&gt;<i>     &#160; &#160; &#160; &#160; recipientEncryptedKeys:
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; d.rKeyId:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; subjectKeyIdentifier:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0000 - 82 46 4f ae b4 cb 84 7b-f4 70 68 6f d0&#160;
</I>&gt;<i>     &#160;.FO....{.pho.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 000d - 24 e7 15 8c 34 f3 c4&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;$...4..
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; date: &lt;ABSENT&gt;
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; other: &lt;ABSENT&gt;
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; encryptedKey:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0000 - f9 b1 b1 28 2a 0c ea e5-eb 3b 0f 22 a5 f4&#160;
</I>&gt;<i>     &#160;...(*....;.&quot;..
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; 000e - 51 8e 22 a3 76 4f fe 01-6f 26 37 b5 24 1c&#160;
</I>&gt;<i>     &#160;Q.&quot;.vO..o&amp;7.$.
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; &#160; &#160; 001c - 20 ba 9f 1a 11 92 25 a5-e4 4e 79 6f&#160; &#160; &#160; &#160; &#160;
</I>&gt;<i>     .....%..Nyo
</I>&gt;<i>     &#160; &#160; encryptedContentInfo:.
</I>&gt;<i>     &#160; &#160; &#160; contentType: pkcs7-data (1.2.840.113549.1.7.1)
</I>&gt;<i>     &#160; &#160; &#160; contentEncryptionAlgorithm:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; algorithm: aes-256-cbc (2.16.840.1.101.3.4.1.42)
</I>&gt;<i>     &#160; &#160; &#160; &#160; parameter: OCTET STRING:
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; 0000 - c4 12 53 6c 1f 04 ee 3a-2f 19 43 6f 87 0c af&#160;
</I>&gt;<i>     &#160;..Sl...:/.Co...
</I>&gt;<i>     &#160; &#160; &#160; &#160; &#160; 000f - 9b&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.
</I>&gt;<i>     &#160; &#160; &#160; encryptedContent:.
</I>&gt;<i>     &#160; &#160; &#160; &#160; 0000 - 9f 18 ea 29 08 26 f5 8c-7c 69 ae 23 f2 ca 95&#160;
</I>&gt;<i>     &#160;...).&amp;..|i.#...
</I>&gt;<i>     &#160; &#160; &#160; &#160; 000f - 76&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;v
</I>&gt;<i>     &#160; &#160; unprotectedAttrs:
</I>&gt;<i>     &#160; &#160; &#160; &lt;EMPTY&gt;
</I>&gt;<i>     ========
</I>&gt;<i> 
</I>&gt;<i>     As you can see it has reference to one recipient, identified by his
</I>&gt;<i>     subjectKeyIdentifier. By some reason
</I>&gt;<i>     RecipientInfos/d.kari/d.originatorKey also includes full public key
</I>&gt;<i>     from recipient's certificate. Questions:
</I>&gt;<i> 
</I>&gt;<i>     1. Why is it required?
</I>&gt;<i>     2. Is it possible to omit it since it is superfluous (IMHO) ?
</I>&gt;<i>     3.
</I>&gt;<i>     <A HREF="https://github.com/openssl/openssl/blob/master/crypto/cms/cms_kari.c#L386">https://github.com/openssl/openssl/blob/master/crypto/cms/cms_kari.c#L386</A>
</I>&gt;<i>     (and RFC) say that there could be either key, subjectandserial or
</I>&gt;<i>     subjectkeyidentifier. So, how to set it using command line openssl
</I>&gt;<i>     application ?
</I>&gt;<i> 
</I>&gt;<i>     -- 
</I>&gt;<i>     Segmentation fault
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     Subject: Digest Footer
</I>&gt;<i> 
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     openssl-users mailing list
</I>&gt;<i>     <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i>     <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     ------------------------------
</I>&gt;<i> 
</I>&gt;<i>     End of openssl-users Digest, Vol 47, Issue 47
</I>&gt;<i>     *********************************************
</I>&gt;<i> 
</I>&gt;<i> 
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009108.html">[openssl-users] Reg issue in alert message
</A></li>
	<LI>Next message: <A HREF="009080.html">[openssl-users] How to compile 1.1.1 under Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9115">[ date ]</a>
              <a href="thread.html#9115">[ thread ]</a>
              <a href="subject.html#9115">[ subject ]</a>
              <a href="author.html#9115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
