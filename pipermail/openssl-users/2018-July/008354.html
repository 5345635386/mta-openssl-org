<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] pkcs11 engine private key loading
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-July/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20pkcs11%20engine%20private%20key%20loading&In-Reply-To=%3CCA%2BtYn02%3DqqZyvzPCTq9UXvRue_MNVtbnckiqtmTNYnh-renkjw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008353.html">
   <LINK REL="Next"  HREF="008357.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] pkcs11 engine private key loading</H1>
    <B>Pavel L&#246;bl</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20pkcs11%20engine%20private%20key%20loading&In-Reply-To=%3CCA%2BtYn02%3DqqZyvzPCTq9UXvRue_MNVtbnckiqtmTNYnh-renkjw%40mail.gmail.com%3E"
       TITLE="[openssl-users] pkcs11 engine private key loading">lobl.pavel at gmail.com
       </A><BR>
    <I>Fri Jul 27 09:59:22 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="008353.html">[openssl-users] Need a check?
</A></li>
        <LI>Next message: <A HREF="008357.html">[openssl-users] genpkey for ed25519
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8354">[ date ]</a>
              <a href="thread.html#8354">[ thread ]</a>
              <a href="subject.html#8354">[ subject ]</a>
              <a href="author.html#8354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've already post this to opensc mailing list but I'm not really sure where
the problem is. So I also try my luck here.

I'm writing application which decrypts SMIME messages using smart
card. I used source code of openssl cms command as reference. I'm able
to decrypt already however I face the following problem. When smart
card is removed while my application is running
ENGINE_load_private_key still returns private key reference without
any problem but later call to CMS_decrypt fails. Similarly when smart
card is not present during first call to ENGINE_load_private_key it
will continue to fail even after card is inserted again. I've tried to
call ENGINE_init before key loading and ENGINE_finish and ENGINE_free
after that but it didn't help. Only workaround I've found is exit the
process and start it again.

I would expect ENGINE_load_private_key to unlock the card if it is
present and is not unlocked already and fail if there is no card
inserted.

I'm not sure what is going on here. Maybe I just got the concept
wrong. I'm using debian testing with opensc 0.18.0-3 and openssl
1.1.0h-4.
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008353.html">[openssl-users] Need a check?
</A></li>
	<LI>Next message: <A HREF="008357.html">[openssl-users] genpkey for ed25519
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8354">[ date ]</a>
              <a href="thread.html#8354">[ thread ]</a>
              <a href="subject.html#8354">[ subject ]</a>
              <a href="author.html#8354">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
