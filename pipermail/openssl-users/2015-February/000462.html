<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] using openssl to create PKCS#7/CMS on windows
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2015-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20using%20openssl%20to%20create%20PKCS%237/CMS%20on%20windows&In-Reply-To=%3CCAPOCt68r7CL8unT4%2B_HWUEQ2Hf7d7C7aTXpxqshhk_VV_1nRTA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000502.html">
   <LINK REL="Next"  HREF="000472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] using openssl to create PKCS#7/CMS on windows</H1>
    <B>Srinivas Rao</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20using%20openssl%20to%20create%20PKCS%237/CMS%20on%20windows&In-Reply-To=%3CCAPOCt68r7CL8unT4%2B_HWUEQ2Hf7d7C7aTXpxqshhk_VV_1nRTA%40mail.gmail.com%3E"
       TITLE="[openssl-users] using openssl to create PKCS#7/CMS on windows">srirrao at gmail.com
       </A><BR>
    <I>Thu Feb  5 13:30:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000502.html">[openssl-users] How to load local certificate folder on windows
</A></li>
        <LI>Next message: <A HREF="000472.html">[openssl-users] using openssl to create PKCS#7/CMS on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#462">[ date ]</a>
              <a href="thread.html#462">[ thread ]</a>
              <a href="subject.html#462">[ subject ]</a>
              <a href="author.html#462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

Is there a way to use openssl to sign data using a private key (on USB
token) and produce PKCS7 output on win32, if:

a) the data to be signed message is not touched yet and goes as input
to the solution to the answer to this problem, OR

b) signature is already generated, i.e message is hashed and signed
and only needs to be encoded in PKCS7,

If yes, for which of the above case and how (please give some pointers
on how to go about it).

Thanks
Srinivas


On 1/30/15, Srinivas Rao &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">srirrao at gmail.com</A>&gt; wrote:
&gt;<i> All,
</I>&gt;<i>
</I>&gt;<i> Please let me know if my below mentioned usage of PKCS7_sign()+adding
</I>&gt;<i> signer info is wrong and how.
</I>&gt;<i>
</I>&gt;<i> Really appreciate your response.
</I>&gt;<i>
</I>&gt;<i> cheers and regards
</I>&gt;<i> Srinivas
</I>&gt;<i>
</I>&gt;<i> On 1/29/15, Srinivas Rao &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">srirrao at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> OpenSSL experts,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here the intention is to get the signed data (raw signature obtained
</I>&gt;&gt;<i> by PKCS11 APIs like C_Sign) to be packed in PKCS7 format (attached -
</I>&gt;&gt;<i> with certificate, content and signer info) using openssl.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am using USB token (smart card) for signing.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's the code snippet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	PKCS7* p7 = PKCS7_new();
</I>&gt;&gt;<i> 	PKCS7_set_type(p7, NID_pkcs7_signed);
</I>&gt;&gt;<i> 	//PKCS7_SIGNER_INFO* pSI = PKCS7_SIGNER_INFO_new();
</I>&gt;&gt;<i> 	//PKCS7_SIGNER_INFO_set(pSI, pX509, pX509-&gt;cert_info-&gt;key-&gt;pkey,
</I>&gt;&gt;<i> EVP_sha256());
</I>&gt;&gt;<i> 	//PKCS7_add_signer(p7, pSI);
</I>&gt;&gt;<i> 	PKCS7_SIGNER_INFO* pSI = PKCS7_add_signature(p7, pX509,
</I>&gt;&gt;<i> pX509-&gt;cert_info-&gt;key-&gt;pkey, EVP_sha256());  // &lt;== core dumps here
</I>&gt;&gt;<i>         :
</I>&gt;&gt;<i>         :
</I>&gt;&gt;<i> where pX509 is correctly obtained X509* node using d2i_X509() from the
</I>&gt;&gt;<i> value obtained from PKCS11 funcstions like C_GetAttributeValue() etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I believe the set of the commented lines is the alternate way for this
</I>&gt;&gt;<i> add signature function - that also dumps core at
</I>&gt;&gt;<i> PKCS7_SIGNER_INFO_set() function.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have no clue as to what am I doing wrong here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Appreciate your help.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> regards
</I>&gt;&gt;<i> Srinivas
</I></PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000502.html">[openssl-users] How to load local certificate folder on windows
</A></li>
	<LI>Next message: <A HREF="000472.html">[openssl-users] using openssl to create PKCS#7/CMS on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#462">[ date ]</a>
              <a href="thread.html#462">[ thread ]</a>
              <a href="subject.html#462">[ subject ]</a>
              <a href="author.html#462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
