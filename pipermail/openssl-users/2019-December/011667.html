<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> MacOS: lost ability to use p11-kit???
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2019-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20MacOS%3A%20lost%20ability%20to%20use%20p11-kit%3F%3F%3F&In-Reply-To=%3C94499902-2CB4-4072-ADC2-7B747498F0CD%40ll.mit.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011668.html">
   <LINK REL="Next"  HREF="011669.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>MacOS: lost ability to use p11-kit???</H1>
    <B>Blumenthal, Uri - 0553 - MITLL</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20MacOS%3A%20lost%20ability%20to%20use%20p11-kit%3F%3F%3F&In-Reply-To=%3C94499902-2CB4-4072-ADC2-7B747498F0CD%40ll.mit.edu%3E"
       TITLE="MacOS: lost ability to use p11-kit???">uri at ll.mit.edu
       </A><BR>
    <I>Mon Dec 16 15:29:41 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="011668.html">Backporting KTLS to 1.1.1
</A></li>
        <LI>Next message: <A HREF="011669.html">DTLS-SRTP Support for AES GCM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11667">[ date ]</a>
              <a href="thread.html#11667">[ thread ]</a>
              <a href="subject.html#11667">[ subject ]</a>
              <a href="author.html#11667">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>macOS 10.14.6, Xcode-11.3 (with older Xcode it used to work), p11-kit 0.23.18, OpenSSL-1.1.1d, current master of OpenSC and libp11.

Somehow, p11-kit proxy that selects the correct PKCS#11 library to pass the request to, is no longer invoked.

Any help is appreciated!

$ openssl cms -engine pkcs11 -keyform engine -aes256 -decrypt -binary -inform PEM -in /tmp/derive.95470.text.cms -out /tmp/derive.95470.text.dec -inkey &quot;pkcs11:manufacturer=piv_II;object=KEY%20MAN%20key;object-type=private&quot;
engine &quot;pkcs11&quot; set.
GOST engine already loaded
Unable to load module /opt/local/lib/p11-kit-proxy.dylib
GOST engine already loaded
Unable to load module /opt/local/lib/p11-kit-proxy.dylib
PKCS11_get_private_key returned NULL
cannot load signing key file from engine
4458096064:error:260B606D:engine routines:dynamic_load:init failed:crypto/engine/eng_dyn.c:485:
4458096064:error:260BC066:engine routines:int_engine_configure:engine configuration error:crypto/engine/eng_cnf.c:141:section=gost_section, name=dynamic_path, value=/opt/local/lib/engines-1.1/gost.dylib
4458096064:error:0E07606D:configuration file routines:module_run:module initialization error:crypto/conf/conf_mod.c:177:module=engines, value=engine_section, retcode=-1      
4458096064:error:83065006:PKCS#11 module:pkcs11_check_token:Function failed:p11_load.c:92:
4458096064:error:26096080:engine routines:ENGINE_load_private_key:failed loading private key:crypto/engine/eng_pkey.c:78:
unable to load signing key file
$ ll /opt/local/lib/p11-kit-proxy.dylib 
lrwxr-xr-x  1 root  admin  18 Dec 11 13:21 /opt/local/lib/p11-kit-proxy.dylib@ -&gt; libp11-kit.0.dylib
$ ll /opt/local/lib/libp11-kit.0.dylib 
-rwxr-xr-x  1 root  admin  1442912 Dec 11 13:23 /opt/local/lib/libp11-kit.0.dylib*
$ 
&#8212;
Regards,
Uri

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3367 bytes
Desc: not available
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20191216/127192fe/attachment-0001.bin">http://mta.openssl.org/pipermail/openssl-users/attachments/20191216/127192fe/attachment-0001.bin</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011668.html">Backporting KTLS to 1.1.1
</A></li>
	<LI>Next message: <A HREF="011669.html">DTLS-SRTP Support for AES GCM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11667">[ date ]</a>
              <a href="thread.html#11667">[ thread ]</a>
              <a href="subject.html#11667">[ subject ]</a>
              <a href="author.html#11667">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
