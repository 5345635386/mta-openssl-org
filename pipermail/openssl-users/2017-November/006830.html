<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Problem with using EC private keys
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2017-November/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Problem%20with%20using%20EC%20private%20keys&In-Reply-To=%3CVI1PR0401MB2477241D73711CF5E453C8ACA15F0%40VI1PR0401MB2477.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006839.html">
   <LINK REL="Next"  HREF="006831.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Problem with using EC private keys</H1>
    <B>rmawatson rmawatson</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Problem%20with%20using%20EC%20private%20keys&In-Reply-To=%3CVI1PR0401MB2477241D73711CF5E453C8ACA15F0%40VI1PR0401MB2477.eurprd04.prod.outlook.com%3E"
       TITLE="[openssl-users] Problem with using EC private keys">rmawatson at hotmail.com
       </A><BR>
    <I>Wed Nov  1 17:16:09 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="006839.html">[openssl-users] OCSP_BASICRESP_verify() in 1.1.0
</A></li>
        <LI>Next message: <A HREF="006831.html">[openssl-users] &quot;shutdown while in init&quot; error from SSL_read
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6830">[ date ]</a>
              <a href="thread.html#6830">[ thread ]</a>
              <a href="subject.html#6830">[ subject ]</a>
              <a href="author.html#6830">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am confused about the two different ways I can generate an EC private key and why this is causing me problems with the test s_client s_server applications


So, I am using the command below to generate a private key, then using this to create
a certificate to work with openssl s_client s_server.

    openssl ecparam -name secp384r1 -genkey -out privkey.pem (1)

I then create the .csr with the following two commands,

    openssl req -key privkey.pem -out pub.csr -new (2)
    openssl x509 -req -in pub.csr -signkey privkey.pem -out pub.crt (3)

This works with s_server/s_client.

But, when I generate a key like this:

    openssl genpkey -algorithm ec -pkeyopt ec_paramgen_curve:secp384r1 -out privkey.pem (4)


If I now create a signed .crt with (2) and (3) above, then use this pair with openssl s_server
it does not negotiate a cipher suite and it doesn't work.

Client:
CONNECTED(00000154)
2546392219:error:14004410:SSL routines:CONNECT_CR_SRVR_HELLO:sslv3 alert handshake failure:ssl_pkt.c:1205:SSL alert number 40
2546392219:error:140040E5:SSL routines:CONNECT_CR_SRVR_HELLO:ssl handshake failure:ssl_pkt.c:585:
...

Server:
...
ERROR
2867046282:error:140270C1:SSL routines:ACCEPT_SR_CLNT_HELLO_C:no shared cipher:ssl_srvr.c:1024:
shutting down SSL
CONNECTION CLOSED

Using this url (<A HREF="https://wiki.openssl.org/index.php/Command_Line_Elliptic_Curve_Operations">https://wiki.openssl.org/index.php/Command_Line_Elliptic_Curve_Operations</A>) It turns out, if I take the key generated by (4) above, and convert it to pk8 with

    openssl pkcs8 -topk8 -nocrypt -in privkey_ec.pem -out privkey.pem

If I now use this key to create the .crt and use this key pair with openssl s_server it works.
My question is why does the format of the private key make any difference. Surely openssl can decode the key in any supported format, after all it created it, and all
the required information must be in it, as it is able to convert to pk8 format that works.


Note:

I am running openssl server/client like this..

openssl.exe s_server -tls1_2 -key privkey.pem -cert pub.crt -debug

and

openssl.exe s_client -tls1_2

Thanks!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20171101/747160a8/attachment-0001.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20171101/747160a8/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006839.html">[openssl-users] OCSP_BASICRESP_verify() in 1.1.0
</A></li>
	<LI>Next message: <A HREF="006831.html">[openssl-users] &quot;shutdown while in init&quot; error from SSL_read
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6830">[ date ]</a>
              <a href="thread.html#6830">[ thread ]</a>
              <a href="subject.html#6830">[ subject ]</a>
              <a href="author.html#6830">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
