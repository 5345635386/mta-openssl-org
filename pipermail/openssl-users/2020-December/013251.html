<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> How to rotate cert when only first matching cert been verified
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2020-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20How%20to%20rotate%20cert%20when%20only%20first%20matching%20cert%20been%20verified&In-Reply-To=%3CCABYODQ9j6yTDVvx_0Jf%3D5JAwp5_TD8fVUWfOfDDEooWuD3QbeQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013257.html">
   <LINK REL="Next"  HREF="013252.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>How to rotate cert when only first matching cert been verified</H1>
    <B>&#23450;&#24179;&#34945;</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20How%20to%20rotate%20cert%20when%20only%20first%20matching%20cert%20been%20verified&In-Reply-To=%3CCABYODQ9j6yTDVvx_0Jf%3D5JAwp5_TD8fVUWfOfDDEooWuD3QbeQ%40mail.gmail.com%3E"
       TITLE="How to rotate cert when only first matching cert been verified">pkudingping at gmail.com
       </A><BR>
    <I>Sun Dec 20 00:59:24 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="013257.html">Set custom bn_mod_exp functions in openssl 1.1.1
</A></li>
        <LI>Next message: <A HREF="013252.html">How to rotate cert when only first matching cert been verified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13251">[ date ]</a>
              <a href="thread.html#13251">[ thread ]</a>
              <a href="subject.html#13251">[ subject ]</a>
              <a href="author.html#13251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

Recently I am trying to rotate a cert, and the client uses python requests
lib, which leverages openssl. Here is my steps:

1. Generate a new cert, and append it to the cert file(at this point, there
are 2 certs in the file, first is old cert, second is new, they have the
same Subject), restart client side process, (no problem here, because first
cert matching server side cert, and it verifies successfully)
2. Replace server side with new cert.

As soon as I issue step #2, the client side process starts to show
error &#8220;certificate
verify failed&#8221;. This would cause downtime to my apps. I am new to this, not
sure if there is anything wrong regarding my usage or understanding. But I
found this page
<A HREF="https://www.openssl.org/docs/man1.0.2/man3/SSL_CTX_load_verify_locations.html,">https://www.openssl.org/docs/man1.0.2/man3/SSL_CTX_load_verify_locations.html,</A>
it says the exact behavior like my test:

If several CA certificates matching the name, key identifier, and serial
number condition are available, only the first one will be examined. This
may lead to unexpected results if the same CA certificate is available with
different expiration dates. If a &quot;certificate expired&quot; verification error
occurs, no other certificate will be searched. Make sure to not have
expired certificates mixed with valid ones.

So I am wondering how to rotate cert in such a case? It would be very
helpful if anyone could help on this. Thanks.

BTW, I tested the same cert file with CURL (compiled with gnutls), it works
fine.

Regards
Dingping
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20201220/c96186f2/attachment-0001.html">https://mta.openssl.org/pipermail/openssl-users/attachments/20201220/c96186f2/attachment-0001.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013257.html">Set custom bn_mod_exp functions in openssl 1.1.1
</A></li>
	<LI>Next message: <A HREF="013252.html">How to rotate cert when only first matching cert been verified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13251">[ date ]</a>
              <a href="thread.html#13251">[ thread ]</a>
              <a href="subject.html#13251">[ subject ]</a>
              <a href="author.html#13251">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
