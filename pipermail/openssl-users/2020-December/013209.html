<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> DH_generate_key (Sands, Daniel)
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2020-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20DH_generate_key%20%28Sands%2C%20Daniel%29&In-Reply-To=%3CSN6PR03MB406143EB12D0F93374EAEF43B0CC0%40SN6PR03MB4061.namprd03.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013205.html">
   <LINK REL="Next"  HREF="013211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>DH_generate_key (Sands, Daniel)</H1>
    <B>Narayana, Sunil Kumar</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20DH_generate_key%20%28Sands%2C%20Daniel%29&In-Reply-To=%3CSN6PR03MB406143EB12D0F93374EAEF43B0CC0%40SN6PR03MB4061.namprd03.prod.outlook.com%3E"
       TITLE="DH_generate_key (Sands, Daniel)">sanarayana at rbbn.com
       </A><BR>
    <I>Wed Dec  9 15:10:38 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="013205.html">An idiosyncratic port of OpenSSL 1.1.1i to OS/400 ILE
</A></li>
        <LI>Next message: <A HREF="013211.html">creating certificate by code / problems to load via openssl x509 / pem format
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13209">[ date ]</a>
              <a href="thread.html#13209">[ thread ]</a>
              <a href="subject.html#13209">[ subject ]</a>
              <a href="author.html#13209">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
we could not get the pointer reference to the examples of safe primes or using probable primes which you mentioned (i.e. The man page in section 7 (EVP_PKEY_DH) has examples)
And also we wanted to check the usage of  OSSL_PARAM_construct_xxx.  Appreciate if you can pass on the web link.

Secondly, we referred to the apps/speed.c , and we are not clear on two things.

  1.  What &#8220;ffdh_params&#8221; should we use in our application when we call to EVP_PKEY_CTX_set_dh_nid   ( I see  an array of  {&quot;ffdh2048&quot;, NID_ffdhe2048, 2048},&#8230;.  Been used in the example)
  2.  In our present DH logic, we have public/private keys ( BIGNUM *pub_key,  BIGNUM *priv_key) obtained from DH, how to get pub/priv keys using  EVP_PKEY_new() ?


Regards,
Sunil


From: openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt; On Behalf Of <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
Sent: 09 December 2020 02:01
To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
Subject: openssl-users Digest, Vol 73, Issue 6

________________________________
NOTICE: This email was received from an EXTERNAL sender
________________________________

Send openssl-users mailing list submissions to
<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;

To subscribe or unsubscribe via the World Wide Web, visit
<A HREF="https://mta.openssl.org/mailman/listinfo/openssl-users&lt;https://mta.openssl.org/mailman/listinfo/openssl-users">https://mta.openssl.org/mailman/listinfo/openssl-users&lt;https://mta.openssl.org/mailman/listinfo/openssl-users</A>&gt;
or, via email, send a message with subject or body 'help' to
<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt;

You can reach the person managing the list at
<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>&gt;

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of openssl-users digest...&quot;


Today's Topics:

1. Re: Use OpenSSL to decrypt TLS session from PCAP files
(Matt Caswell)
2. Re: Use OpenSSL to decrypt TLS session from PCAP files
(John Baldwin)
3. DH_generate_key (Narayana, Sunil Kumar)
4. RE: DH_generate_key (Sands, Daniel)


----------------------------------------------------------------------

Message: 1
Date: Tue, 8 Dec 2020 15:46:00 +0000
From: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt;&gt;
To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
Subject: Re: Use OpenSSL to decrypt TLS session from PCAP files
Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">8f9c7ad4-f3cb-38a1-0968-61833bb77462 at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">8f9c7ad4-f3cb-38a1-0968-61833bb77462 at openssl.org</A>&gt;&gt;
Content-Type: text/plain; charset=utf-8



On 08/12/2020 15:28, Oren Shpigel wrote:
&gt;<i> Hi, thanks for the answer.
</I>&gt;<i>
</I>&gt;<i> I know wireshark and ssldump have this capability, but I'm looking for a
</I>&gt;<i> way to do it in my own software in C++, (using OpenSSL, if possible, but
</I>&gt;<i> open to other suggestions as well).
</I>
Unfortunately OpenSSL does not support this capability. It obviously
supports all the required low-level crypto primitives to do it - but you
would have to put them together yourself, as well as do all the packet
parsing, etc. This would be ... difficult. :-)

Matt


&gt;<i>
</I>&gt;<i> On Tue, Dec 8, 2020 at 4:32 PM Dr. Matthias St. Pierre
</I>&gt;<i> &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">Matthias.St.Pierre at ncp-e.com</A> &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Matthias.St.Pierre at ncp-e.com</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Matthias.St.Pierre at ncp-e.com</A>%20%3cmailto:<A HREF="../../../mailman/listinfo/openssl-users.html">Matthias.St.Pierre at ncp-e.com</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Do you need to integrate the decryption into your own software, or
</I>&gt;<i> are you just looking for a possibility to monitor and view the
</I>&gt;<i> traffic?____
</I>&gt;<i>
</I>&gt;<i> If it?s the latter, try and take a look at the SSL decryption
</I>&gt;<i> support that Wireshark provides. ____
</I>&gt;<i>
</I>&gt;<i> __?__
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://wiki.wireshark.org/TLS____&lt;https://wiki.wireshark.org/TLS____">https://wiki.wireshark.org/TLS____&lt;https://wiki.wireshark.org/TLS____</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://www.comparitech.com/net-admin/decrypt-ssl-with-wireshark/____&lt;https://www.comparitech.com/net-admin/decrypt-ssl-with-wireshark/____">https://www.comparitech.com/net-admin/decrypt-ssl-with-wireshark/____&lt;https://www.comparitech.com/net-admin/decrypt-ssl-with-wireshark/____</A>&gt;
</I>&gt;<i>
</I>&gt;<i> __?__
</I>&gt;<i>
</I>&gt;<i> __?__
</I>&gt;<i>
</I>&gt;<i> hth,____
</I>&gt;<i>
</I>&gt;<i> Matthias____
</I>&gt;<i>
</I>&gt;<i> __?__
</I>&gt;<i>
</I>&gt;<i> Disclaimer: I haven?t used it for TLS myself, only for IPsec, and I
</I>&gt;<i> can?t tell how up-to-date it is, in particular whether it is TLS 1.3
</I>&gt;<i> ready.____
</I>&gt;<i>
</I>&gt;<i> __?__
</I>&gt;<i>
</I>&gt;<i> ?
</I>&gt;<i>
</I>&gt;<i> *NCP engingeering GmbH* ** *Dr. Matthias St. Pierre*
</I>&gt;<i>
</I>&gt;<i> Senior Software Engineer
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">matthias.st.pierre at ncp-e.com</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">matthias.st.pierre at ncp-e.com</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">matthias.st.pierre at ncp-e.com</A>&gt;
</I>&gt;<i> Phone: +49 911 9968-0
</I>&gt;<i> www.ncp-e.com&lt;<A HREF="http://www.ncp-e.com">http://www.ncp-e.com</A>&gt; &lt;<A HREF="http://www.ncp-e.com&lt;http://www.ncp-e.com">http://www.ncp-e.com&lt;http://www.ncp-e.com</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i> *
</I>&gt;<i> Follow us on:*?Facebook &lt;<A HREF="https://www.facebook.com/NCPengineering&lt;https://www.facebook.com/NCPengineering">https://www.facebook.com/NCPengineering&lt;https://www.facebook.com/NCPengineering</A>&gt;&gt; |
</I>&gt;<i> Twitter &lt;<A HREF="https://twitter.com/NCP_engineering&lt;https://twitter.com/NCP_engineering">https://twitter.com/NCP_engineering&lt;https://twitter.com/NCP_engineering</A>&gt;&gt;?| Xing
</I>&gt;<i> &lt;<A HREF="https://www.xing.com/companies/ncpengineeringgmbh&lt;https://www.xing.com/companies/ncpengineeringgmbh">https://www.xing.com/companies/ncpengineeringgmbh&lt;https://www.xing.com/companies/ncpengineeringgmbh</A>&gt;&gt;?| YouTube
</I>&gt;<i> &lt;<A HREF="https://www.youtube.com/user/NCPengineeringGmbH&lt;https://www.youtube.com/user/NCPengineeringGmbH">https://www.youtube.com/user/NCPengineeringGmbH&lt;https://www.youtube.com/user/NCPengineeringGmbH</A>&gt;&gt; | LinkedIn
</I>&gt;<i> &lt;<A HREF="http://www.linkedin.com/company/ncp-engineering-inc.?trk=cws-cpw-coname-0-0&lt;http://www.linkedin.com/company/ncp-engineering-inc.?trk=cws-cpw-coname-0-0">http://www.linkedin.com/company/ncp-engineering-inc.?trk=cws-cpw-coname-0-0&lt;http://www.linkedin.com/company/ncp-engineering-inc.?trk=cws-cpw-coname-0-0</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i> *Headquarters Germany: *NCP engineering GmbH ? Dombuehler Str. 2 ?
</I>&gt;<i> 90449 ? Nuremberg
</I>&gt;<i> *North American HQ:* NCP engineering Inc. ? 601 Cleveland Str.,
</I>&gt;<i> Suite 501-25 ? Clearwater, FL 33755
</I>&gt;<i>
</I>&gt;<i> Authorized representatives: Peter Soell, Patrick Oliver Graf, Beate
</I>&gt;<i> Dietrich
</I>&gt;<i> Registry Court: Lower District Court of Nuremberg
</I>&gt;<i> Commercial register No.: HRB 7786 Nuremberg, VAT identification No.:
</I>&gt;<i> DE 133557619
</I>&gt;<i>
</I>&gt;<i> This e-mail message including any attachments is for the sole use of
</I>&gt;<i> the intended recipient(s) and may contain privileged or confidential
</I>&gt;<i> information. Any unauthorized review, use, disclosure or
</I>&gt;<i> distribution is prohibited. If you are not the intended recipient,
</I>&gt;<i> please immediately contact the sender by reply e-mail and delete the
</I>&gt;<i> original message and destroy all copies thereof.
</I>&gt;<i>
</I>&gt;<i> &lt;<A HREF="https://www.ncp-e.com/de/aktuelles/events/veranstaltungen&lt;https://www.ncp-e.com/de/aktuelles/events/veranstaltungen">https://www.ncp-e.com/de/aktuelles/events/veranstaltungen&lt;https://www.ncp-e.com/de/aktuelles/events/veranstaltungen</A>&gt;&gt;&lt;<A HREF="https://www.ncp-e.com/de/aktuelles/events/veranstaltungen&lt;https://www.ncp-e.com/de/aktuelles/events/veranstaltungen">https://www.ncp-e.com/de/aktuelles/events/veranstaltungen&lt;https://www.ncp-e.com/de/aktuelles/events/veranstaltungen</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From**:*openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>
</I>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>%0b&gt;&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt;&gt; *On Behalf Of *Oren Shpigel
&gt;<i> *Sent:* Tuesday, December 8, 2020 3:15 PM
</I>&gt;<i> *To:* <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i> *Subject:* Use OpenSSL to decrypt TLS session from PCAP files____
</I>&gt;<i>
</I>&gt;<i> __?__
</I>&gt;<i>
</I>&gt;<i> Hi,?____
</I>&gt;<i>
</I>&gt;<i> I generated a PCAP file with TLS session, and I have the matching
</I>&gt;<i> private key used by my HTTPS server.
</I>&gt;<i> The TLS session is not using DH for key exchange, so it should be
</I>&gt;<i> possible to decrypt.
</I>&gt;<i> I know OpenSSL can be used to connect to a socket to &quot;actively&quot;
</I>&gt;<i> handle the TLS session, but is there a way to &quot;passively&quot; decode and
</I>&gt;<i> decrypt a session?
</I>&gt;<i> How can I &quot;feed&quot; the packets (both directions) into the OpenSSL
</I>&gt;<i> library?____
</I>&gt;<i>
</I>&gt;<i> Thanks!____
</I>&gt;<i>
</I>

------------------------------

Message: 2
Date: Tue, 8 Dec 2020 09:17:54 -0800
From: John Baldwin &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">jhb at FreeBSD.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">jhb at FreeBSD.org</A>&gt;&gt;
To: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt;&gt;, <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
Subject: Re: Use OpenSSL to decrypt TLS session from PCAP files
Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">a13039b5-4e75-543a-fbcf-bcf7caf1c3d0 at FreeBSD.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">a13039b5-4e75-543a-fbcf-bcf7caf1c3d0 at FreeBSD.org</A>&gt;&gt;
Content-Type: text/plain; charset=utf-8

On 12/8/20 7:46 AM, Matt Caswell wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 08/12/2020 15:28, Oren Shpigel wrote:
</I>&gt;&gt;<i> Hi, thanks for the answer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I know wireshark and ssldump have this capability, but I'm looking for a
</I>&gt;&gt;<i> way to do it in my own software in C++, (using OpenSSL, if possible, but
</I>&gt;&gt;<i> open to other suggestions as well).
</I>&gt;<i>
</I>&gt;<i> Unfortunately OpenSSL does not support this capability. It obviously
</I>&gt;<i> supports all the required low-level crypto primitives to do it - but you
</I>&gt;<i> would have to put them together yourself, as well as do all the packet
</I>&gt;<i> parsing, etc. This would be ... difficult. :-)
</I>
You could use a memory BIO or the like to feed the reconstructed data
stream into to handle the TLS bits though? You are still stuck with
writing your own TCP stack (effectively)? I think openvpn does something
like this when I looked (it used memory BIOs to and then manually
read/wrote their contents on its tunnel socket).

--
John Baldwin


------------------------------

Message: 3
Date: Tue, 8 Dec 2020 17:43:47 +0000
From: &quot;Narayana, Sunil Kumar&quot; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">sanarayana at rbbn.com</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">sanarayana at rbbn.com</A>&gt;&gt;
To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&quot; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
Subject: DH_generate_key
Message-ID:
&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">SN6PR03MB40618D30CCD11C458E2B2EB2B0CD0 at SN6PR03MB4061.namprd03.prod.outlook.com</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">SN6PR03MB40618D30CCD11C458E2B2EB2B0CD0 at SN6PR03MB4061.namprd03.prod.outlook.com</A>&gt;&gt;

Content-Type: text/plain; charset=&quot;utf-8&quot;

Dear openssl team,

While migrating from 1.0.2 to 3.0, we found that DH_generate_key() has be deprecated. And as per the man page, it is advised to use EVP_PKEY_derive_init&lt;<A HREF="https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html">https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html</A>&gt;&gt; &amp; EVP_PKEY_derive&lt;<A HREF="https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html">https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html</A>&gt;&gt;
our application creates a new DH and using DH_generate_key() creates pub_key/priv_key and uses it. how can we replace this exactly with EVP.
And please suggest what EVP API's should we use to generate pub/priv keys ?

Application code

dh = DH_new();
dh-&gt;p = BN_bin2bn(modSize, octet_len, NULL);
dh-&gt;g = BN_bin2bn(H235Bits_generator, H235Bits_generator_len / 8, NULL);

if ( ! DH_generate_key(dh) )
{
return FAILURE;
}
n = (unsigned) BN_num_bytes(dh-&gt;pub_key);

BN_bn2bin(dh-&gt;pub_key, p);
n = (unsigned) BN_num_bytes(dh-&gt;priv_key);


Instead above logic can we do this ? is derive generated pub/priv keys ?

//create ctx
Ctx = EVP_PKEY_CTX_new_from_name (NULL, &quot;DM&quot;, NULL);
EVP_PKEY_derive_init (ctx)


Regards,
Sunil


-----------------------------------------------------------------------------------------------------------------------
Notice: This e-mail together with any attachments may contain information of Ribbon Communications Inc. that
is confidential and/or proprietary for the sole use of the intended recipient. Any review, disclosure, reliance or
distribution by others or forwarding without express permission is strictly prohibited. If you are not the intended
recipient, please notify the sender immediately and then delete all copies, including any attachments.
-----------------------------------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/9e8c0a5b/attachment-0001.html&lt;https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/9e8c0a5b/attachment-0001.html">https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/9e8c0a5b/attachment-0001.html&lt;https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/9e8c0a5b/attachment-0001.html</A>&gt;&gt;

------------------------------

Message: 4
Date: Tue, 8 Dec 2020 20:30:22 +0000
From: &quot;Sands, Daniel&quot; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">dnsands at sandia.gov</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">dnsands at sandia.gov</A>&gt;&gt;
To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&quot; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;&gt;
Subject: RE: DH_generate_key
Message-ID:
&lt;<A HREF="../../../mailman/listinfo/openssl-users.html">0223126022f1463f903459929b4902c6 at ES08AMSNLNT.srn.sandia.gov</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">0223126022f1463f903459929b4902c6 at ES08AMSNLNT.srn.sandia.gov</A>&gt;&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

Dear openssl team,

While migrating from 1.0.2 to 3.0, we found that DH_generate_key() has be deprecated. And as per the man page, it is advised to use EVP_PKEY_derive_init&lt;<A HREF="https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html">https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive_init.html</A>&gt;&gt; &amp; EVP_PKEY_derive&lt;<A HREF="https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html">https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html&lt;https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_derive.html</A>&gt;&gt;
our application creates a new DH and using DH_generate_key() creates pub_key/priv_key and uses it. how can we replace this exactly with EVP.
And please suggest what EVP API?s should we use to generate pub/priv keys ?

Application code

dh = DH_new();
dh-&gt;p = BN_bin2bn(modSize, octet_len, NULL);
dh-&gt;g = BN_bin2bn(H235Bits_generator, H235Bits_generator_len / 8, NULL);

if ( ! DH_generate_key(dh) )
{
return FAILURE;
}
n = (unsigned) BN_num_bytes(dh-&gt;pub_key);

BN_bn2bin(dh-&gt;pub_key, p);
n = (unsigned) BN_num_bytes(dh-&gt;priv_key);


Instead above logic can we do this ? is derive generated pub/priv keys ?




The man page in section 7 (EVP_PKEY_DH) has examples for generating using safe primes or using probable primes. Seems better since you don?t have to use the BN API anymore, but a little more complicated because you have to call OSSL_PARAM_construct_xxx for parameters and assign them to an array.

From there, you can use EVP_PKEY_derive_init, EVP_PKEY_derive_set_peer, and EVP_PKEY_derive to get your shared secret. See apps/speed.c in the OSSL3 source code for an example. Look for the text EVP_PKEY_DH
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/3c2fdbaf/attachment.html&lt;https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/3c2fdbaf/attachment.html">https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/3c2fdbaf/attachment.html&lt;https://mta.openssl.org/pipermail/openssl-users/attachments/20201208/3c2fdbaf/attachment.html</A>&gt;&gt;

------------------------------

Subject: Digest Footer

_______________________________________________
openssl-users mailing list
<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
<A HREF="https://mta.openssl.org/mailman/listinfo/openssl-users&lt;https://mta.openssl.org/mailman/listinfo/openssl-users">https://mta.openssl.org/mailman/listinfo/openssl-users&lt;https://mta.openssl.org/mailman/listinfo/openssl-users</A>&gt;


------------------------------

End of openssl-users Digest, Vol 73, Issue 6
********************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20201209/c4847bc2/attachment-0001.html">https://mta.openssl.org/pipermail/openssl-users/attachments/20201209/c4847bc2/attachment-0001.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013205.html">An idiosyncratic port of OpenSSL 1.1.1i to OS/400 ILE
</A></li>
	<LI>Next message: <A HREF="013211.html">creating certificate by code / problems to load via openssl x509 / pem format
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13209">[ date ]</a>
              <a href="thread.html#13209">[ thread ]</a>
              <a href="subject.html#13209">[ subject ]</a>
              <a href="author.html#13209">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
