<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Fwd:  DTLS over UDP
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Fwd%3A%20%20DTLS%20over%20UDP&In-Reply-To=%3CCACS8YK3-1%3DhTWzVChHWukyaNjUrSctqray4F0UZ2moE3HmESOQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007483.html">
   <LINK REL="Next"  HREF="007515.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Fwd:  DTLS over UDP</H1>
    <B>Nivedita</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Fwd%3A%20%20DTLS%20over%20UDP&In-Reply-To=%3CCACS8YK3-1%3DhTWzVChHWukyaNjUrSctqray4F0UZ2moE3HmESOQ%40mail.gmail.com%3E"
       TITLE="[openssl-users] Fwd:  DTLS over UDP">maddi.nivedita at gmail.com
       </A><BR>
    <I>Wed Feb 14 06:18:27 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="007483.html">[openssl-users] DTLS over UDP
</A></li>
        <LI>Next message: <A HREF="007515.html">[openssl-users] DTLS over UDP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7492">[ date ]</a>
              <a href="thread.html#7492">[ thread ]</a>
              <a href="subject.html#7492">[ subject ]</a>
              <a href="author.html#7492">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

   Please ignore the previous mail. By mistankely it got sent.
 I have provided my comments  below.

Thanks in advance.
Regards,
Nivedita

On Wed, Feb 14, 2018 at 10:22 AM, Nivedita &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">maddi.nivedita at gmail.com</A>&gt; wrote:

&gt;<i> Hi Michael,
</I>&gt;<i>
</I>&gt;<i> Thanks for the reply.
</I>&gt;<i>
</I>&gt;<i> I have mentioned the answers below.
</I>&gt;<i>
</I>


&gt;<i>
</I>&gt;<i> On Wed, Feb 14, 2018 at 12:21 AM, Michael Richardson &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">mcr at sandelman.ca</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> From: Michael Richardson &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">mcr at sandelman.ca</A>&gt;
</I>&gt;&gt;<i> To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;&gt;<i> Subject: Re: [openssl-users] DTLS over UDP
</I>&gt;&gt;<i> In-Reply-To: &lt;CACS8YK320Z=<A HREF="../../../mailman/listinfo/openssl-users.html">E8wc7YBt6hC0jQ7i6kzLMECFyL0SO23AznnscrQ at mail.gm</A>
</I>&gt;&gt;<i> ail.com&gt;
</I>&gt;&gt;<i> References: &lt;CACS8YK320Z=<A HREF="../../../mailman/listinfo/openssl-users.html">E8wc7YBt6hC0jQ7i6kzLMECFyL0SO23AznnscrQ at mail.gm</A>
</I>&gt;&gt;<i> ail.com&gt;
</I>&gt;&gt;<i> X-Mailer: MH-E 8.6; nmh 1.7-RC3; GNU Emacs 24.5.1
</I>&gt;&gt;<i> X-Face: $\n1pF)h^`}$H&gt;Hk{L&quot;x@)JS7&lt;%Az}<A HREF="../../../mailman/listinfo/openssl-users.html">5RyS at k9X</A>%29-lHB$Ti.V&gt;2bi.~ehC0
</I>&gt;&gt;<i> ;&lt;'$9xN5Ub#
</I>&gt;&gt;<i>  z!G,p`nR&amp;p7Fz@^UXIn156S8.~^@MJ*mMsD7=QFeq%AL4m&lt;nPbLgmtKK-5dC@#:k
</I>&gt;&gt;<i> MIME-Version: 1.0
</I>&gt;&gt;<i> Content-Type: multipart/signed; boundary=&quot;=-=-=&quot;;
</I>&gt;&gt;<i>         micalg=pgp-sha256; protocol=&quot;application/pgp-signature&quot;
</I>&gt;&gt;<i> Date: Tue, 13 Feb 2018 13:51:10 -0500
</I>&gt;&gt;<i> Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">10616.1518547870 at obiwan.sandelman.ca</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --=-=-=
</I>&gt;&gt;<i> Content-Type: text/plain
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Nivedita &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">maddi.nivedita at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>     &gt; I am trying to establish DTLS over UDP connection by using
</I>&gt;&gt;<i>     &gt; DTLSv1_listen method .
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; I have followed the below steps - 1. Created a server socket and
</I>&gt;&gt;<i> using
</I>&gt;&gt;<i>     &gt; this socket created bio and ssl object.  bio =
</I>&gt;&gt;<i>     &gt; BIO_new_dgram(VI_sock,BIO_NOCLOSE)) SSL_set_bio(ssl,VP_bio,VP_bio);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; 2. Enable cookie exchange on SSL object.  SSL_set_options(ssl,
</I>&gt;&gt;<i>     &gt; SSL_OP_COOKIE_EXCHANGE);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; 3. Then started listening using dtlsv1_listen for the new client
</I>&gt;&gt;<i>     &gt; connections.  Once dtlsv1_listen is successful and i got the peer
</I>&gt;&gt;<i>     &gt; address.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> okay.
</I>&gt;&gt;<i>
</I>&gt;<i>        Nivedita- Here the ssl object is created on the server socket  and
</I>same ssl is passed to dtlsv1_listen method.

&gt;<i>
</I>&gt;<i>    Nivedita-  All the above mentioned steps i am doing on server side . On
</I>&gt;<i> the client side i have already initiated ssl_connect.
</I>&gt;<i>                   On the server side when i am listening using
</I>&gt;<i> dtlsv1_listen method  -
</I>&gt;<i>
</I>

&gt;<i>                   while ( VI_res= DTLSv1_listen(VP_ssl, &amp;VS_client_addr)
</I>&gt;<i> &lt;= 0);
</I>&gt;<i>
</I>               Now i got the client_addr from dtlsv1_listen method.

&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>     &gt; 4. Once i got the client address , i am creating one new socket
</I>&gt;&gt;<i>     &gt; 5. With the new socket i tried to connect to client address.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do you mean, you call &quot;SSL_connect()&quot;?
</I>&gt;&gt;<i> Or do you mean you bind(2) and connect(2) the socket.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>          Nivedita- Once i got the client address from dtlsv1_listen, i am
creating one more socket , tried to connect the client address, which i
have got in dtlsv1_listen method

               Vi_res=  connect(new sockid, client_addr, sizeof (client
addr));


&gt;<i>
</I>&gt;&gt;<i>     &gt; 6. Then i am trying to do ssl_accept on the new socket by calling
</I>&gt;&gt;<i>     &gt; bio_set_fd.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; BIO_set_fd(SSL_get_rbio(ssl),VI_new_sock_id,BIO_NOCLOSE);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; BIO_ctrl(SSL_get_rbio(VP_ssl),BIO_CTRL_DGRAM_SET_CONNECTED, 0,
</I>&gt;&gt;<i>     &gt; &amp;client_addr);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; SSL_set_fd(ssl,VI_newsock_id);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So, SSL_set_fd() will allocate a ne bio, which probably undoes the effect
</I>&gt;&gt;<i> of calling BIO_CRTL_DGRAM_SET_CONNECTED.  Since you have set the fd of
</I>&gt;&gt;<i> the existing BIO, I think you can omit that line.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Nivedita - I have removed SSL_set _fd and tried by doing
</I>BIO_set_fd and Bio_ctrl, but still ssl_accept always returns -1 and with
error code of 2.

                         VI_res = BIO_set_fd(SSL_get_rbio(VP_
ssl),VI_new_sock_id,BIO_NOCLOSE);
                         VI_res =
BIO_ctrl(SSL_get_rbio(VP_ssl),BIO_CTRL_DGRAM_SET_CONNECTED,
0, &amp;client_addr);

                         SSL_set_accept_state(VP_ssl);
                        VI_res = SSL_accept(ssl);

       This ssl object is the same one which we have passed in
dtlsv1_listen method. Actually i am trying to do the ssl_accept on the
different socket for every client, even though
      dtlsv1_listen happens on server socket. Could you please let me know
if it is possible.



&gt;<i>     &gt; VI_res = SSL_accept(ssl);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; But ssl_accept will always return error code 2 [ i.e want read or
</I>&gt;&gt;<i> want
</I>&gt;&gt;<i>     &gt; write]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; But if i am doing ssl_accept without doing the step no 6 it it will
</I>&gt;&gt;<i> be
</I>&gt;&gt;<i>     &gt; successful.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &gt; Could someone please let us know how to switch to newly created
</I>&gt;&gt;<i> socket,
</I>&gt;&gt;<i>     &gt; so that it can start using newly created socket for further read and
</I>&gt;&gt;<i>     &gt; write operations and original server socket will keep on listening
</I>&gt;&gt;<i> for
</I>&gt;&gt;<i>     &gt; new connections.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do you expect additional connections on the existing socket?
</I>&gt;&gt;<i> I've been working on some new API to make this all easier.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Nivedita - Yes, we have multiple peers which try to connect to
</I>same server,so in that case i need different sockets for listening
operations and one for read/write operations [one for client]

Your method may fail if you have bound your &quot;listen&quot; to :: (0.0.0.0),
&gt;&gt;<i> and you have multiple IPs.  In my case, I expect connections over IPv6 LL
</I>&gt;&gt;<i> addresses, and there are always multiple of those, and ifindex issues as
</I>&gt;&gt;<i> well.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> ]               Never tell me the odds!                 | ipv6 mesh
</I>&gt;&gt;<i> networks [
</I>&gt;&gt;<i> ]   Michael Richardson, Sandelman Software Works        | network
</I>&gt;&gt;<i> architect  [
</I>&gt;&gt;<i> ]     <A HREF="../../../mailman/listinfo/openssl-users.html">mcr at sandelman.ca</A>  <A HREF="http://www.sandelman.ca/">http://www.sandelman.ca/</A>        |   ruby on
</I>&gt;&gt;<i> rails    [
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --=-=-=
</I>&gt;&gt;<i> Content-Type: application/pgp-signature; name=&quot;signature.asc&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> iQEzBAEBCAAdFiEEbsyLEzg/qUTA43uogItw+93Q3WUFAlqDM54ACgkQgItw+93Q
</I>&gt;&gt;<i> 3WW8Lgf7BwdHZbo22nUphMoVOgBek6qciLPJsa7ggwx6y/pP6kvQX/3bMn4fCx8t
</I>&gt;&gt;<i> 1H/LaTX2xgw8Incz/8RL4kkhfziDYUQJ5oe4cd4b4KIQuTLRLVELFw5RbNX4hmvx
</I>&gt;&gt;<i> tGd+KK2LMshcw/0+d/pAVtJpUdriHxKtMa3OQ7Tc+Lnqm338FRIhhqxi9/7IljW+
</I>&gt;&gt;<i> KA+vYcsCcLIpnlHfB5JfKR0N9S2ga7cUPCi4u/PRAZqTXuet4IPqxJLDVuNwCH8/
</I>&gt;&gt;<i> sbh/yYhFGSPOQG/c0ZaE1TDkcwYeE/lpcofkRdi+FNgBlUtZd9XGag5BW/lA3Rd7
</I>&gt;&gt;<i> IOCLfEDZENxWk2ki+PhDFwam5QO/Vw==
</I>&gt;&gt;<i> =v5TB
</I>&gt;&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;&gt;<i> --=-=-=--
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20180214/a764e291/attachment-0001.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20180214/a764e291/attachment-0001.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007483.html">[openssl-users] DTLS over UDP
</A></li>
	<LI>Next message: <A HREF="007515.html">[openssl-users] DTLS over UDP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7492">[ date ]</a>
              <a href="thread.html#7492">[ thread ]</a>
              <a href="subject.html#7492">[ subject ]</a>
              <a href="author.html#7492">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
