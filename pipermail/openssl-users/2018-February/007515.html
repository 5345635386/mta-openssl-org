<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] DTLS over UDP
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20DTLS%20over%20UDP&In-Reply-To=%3CCACS8YK3nJ1gGXuHpt%3DKRfS5302MEbNCgMon6KXd%3DFpgwwvvMLw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007492.html">
   <LINK REL="Next"  HREF="007547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] DTLS over UDP</H1>
    <B>Nivedita</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20DTLS%20over%20UDP&In-Reply-To=%3CCACS8YK3nJ1gGXuHpt%3DKRfS5302MEbNCgMon6KXd%3DFpgwwvvMLw%40mail.gmail.com%3E"
       TITLE="[openssl-users] DTLS over UDP">maddi.nivedita at gmail.com
       </A><BR>
    <I>Thu Feb 15 10:47:38 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="007492.html">[openssl-users] Fwd:  DTLS over UDP
</A></li>
        <LI>Next message: <A HREF="007547.html">[openssl-users] DTLS over UDP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7515">[ date ]</a>
              <a href="thread.html#7515">[ thread ]</a>
              <a href="subject.html#7515">[ subject ]</a>
              <a href="author.html#7515">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

Please find the response inline.

Regards,
Nivedita

On Wed, Feb 14, 2018 at 10:55 PM, Michael Richardson &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">mcr at sandelman.ca</A>&gt;
wrote:

&gt;<i>
</I>&gt;<i> Nivedita &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">maddi.nivedita at gmail.com</A>&gt; wrote:
</I>&gt;<i>     &gt; Hi Michael,
</I>&gt;<i>
</I>&gt;<i>     &gt; Thanks for the reply.
</I>&gt;<i>
</I>&gt;<i>     &gt; I have mentioned the answers below.
</I>&gt;<i>
</I>&gt;<i> &gt;okay. I saw only one comment.  Maybe you could use standard usenet
</I>&gt;<i> quoting?
</I>&gt;<i> &gt;Tell me a bit more about what you are working on?
</I>&gt;<i> &gt;I'm trying to make CoAP+DTLS work with the ruby-on-rails &quot;David&quot; CoAP
</I>&gt;<i> server.
</I>&gt;<i>
</I>
 Nivedita - We  are using c and Socket programming to establish dtls over
udp for sip communication.


&gt;<i>     &gt; Nivedita &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">maddi.nivedita at gmail.com</A>&gt; wrote:
</I>&gt;<i>     &gt;&gt; I am trying to establish DTLS over UDP connection by using
</I>&gt;<i>     &gt;&gt; DTLSv1_listen method .
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; I have followed the below steps - 1. Created a server socket and
</I>&gt;<i> using
</I>&gt;<i>     &gt;&gt; this socket created bio and ssl object. bio =
</I>&gt;<i>     &gt;&gt; BIO_new_dgram(VI_sock,BIO_NOCLOSE)) SSL_set_bio(ssl,VP_bio,VP_bio);
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; 2. Enable cookie exchange on SSL object. SSL_set_options(ssl,
</I>&gt;<i>     &gt;&gt; SSL_OP_COOKIE_EXCHANGE);
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; 3. Then started listening using dtlsv1_listen for the new client
</I>&gt;<i>     &gt;&gt; connections. Once dtlsv1_listen is successful and i got the peer
</I>&gt;<i>     &gt;&gt; address.
</I>&gt;<i>
</I>&gt;<i>     mcr&gt; okay.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     &gt; Nivedita- All the above mentioned steps i am doing on server side .
</I>&gt;<i> On the
</I>&gt;<i>     &gt; client side i have already initiated ssl_connect.
</I>&gt;<i>     &gt; On the server side when i am listening using dtlsv1_listen method -
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; 4. Once i got the peer address , i am creating one more socket
</I>&gt;<i>     &gt;&gt; 5. With the new socket i tried to connect to peer address.
</I>&gt;<i>
</I>&gt;<i>  &gt;  mcr&gt; Do you mean, you call &quot;SSL_connect()&quot;?
</I>&gt;<i>  &gt;  mcr&gt; Or do you mean you bind(2) and connect(2) the socket.
</I>&gt;<i>
</I>    &gt;You didn't answer this.
    &gt;You imply you might have tried &quot;SSL_connect()&quot; on the server side.

  Nivedita - SSL_connect is already issued on client side , because of
which it triggered the server and dtlsv1_listen was successful and i got
the peer address from dtlsv1_listen.

&gt;<i>                Then once i  got the client address from the dtlsv1_listen
</I>&gt;<i> method, i am creating one more socket  and trying to connect to this
</I>&gt;<i> client  address.
</I>&gt;<i>
</I>
                Vi_res=  connect(new sockid, client_addr, sizeof (client
addr));
           I am able to connect to client address which i got in
dtlsv1_listen method using new socket id.  and i want to do the ssl_accept
on the new socket id  by issuing bio_set_fd and bio_ctrl.
          But ssl_accept fails with error code 2.

                BIO_set_fd(SSL_get_rbio(ssl),VI_new_sock_id,BIO_NOCLOSE);

     BIO_ctrl(SSL_get_rbio(VP_ssl),BIO_CTRL_DGRAM_SET_CONNECTED, 0,
 &amp;client_addr)
            ssl_accept (VP_ssl)
     I would like to mention that VP_ssl is created using server socket id,
but we are trying to do ssl_accept on newly created socket id  which is
connected to peer address[got from dtlsv1_listen method) , so that we can
use this socket for further read-write operations and server socket for
listening operations.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; 6. Then i am trying to do ssl_accept on the new socket by calling
</I>&gt;<i>     &gt;&gt; bio_set_fd.
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; BIO_set_fd(SSL_get_rbio(ssl),VI_new_sock_id,BIO_NOCLOSE);
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; BIO_ctrl(SSL_get_rbio(VP_ssl),BIO_CTRL_DGRAM_SET_CONNECTED, 0,
</I>&gt;<i>     &gt;&gt; &amp;client_addr);
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; SSL_set_fd(ssl,VI_newsock_id);
</I>&gt;<i>
</I>&gt;<i>     mcr&gt; So, SSL_set_fd() will allocate a ne bio, which probably undoes
</I>&gt;<i> the effect
</I>&gt;<i>     mcr&gt; of calling BIO_CRTL_DGRAM_SET_CONNECTED. Since you have set the
</I>&gt;<i> fd of
</I>&gt;<i>     mcr&gt; the existing BIO, I think you can omit that line.
</I>&gt;<i>
</I>&gt;<i> Please omit the SSL_set_fd(), since you've already done it.
</I>&gt;<i>
</I>&gt;<i> I have a pull request at:
</I>&gt;<i>     <A HREF="https://github.com/openssl/openssl/pull/5024">https://github.com/openssl/openssl/pull/5024</A>
</I>&gt;<i>
</I>&gt;<i> which I am reworking to suit the OpenSSL team.
</I>&gt;<i> I am solving the same problem that you have encountered.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> ]               Never tell me the odds!                 | ipv6 mesh
</I>&gt;<i> networks [
</I>&gt;<i> ]   Michael Richardson, Sandelman Software Works        | network
</I>&gt;<i> architect  [
</I>&gt;<i> ]     <A HREF="../../../mailman/listinfo/openssl-users.html">mcr at sandelman.ca</A>  <A HREF="http://www.sandelman.ca/">http://www.sandelman.ca/</A>        |   ruby on
</I>&gt;<i> rails    [
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20180215/7d9beb8b/attachment.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20180215/7d9beb8b/attachment.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007492.html">[openssl-users] Fwd:  DTLS over UDP
</A></li>
	<LI>Next message: <A HREF="007547.html">[openssl-users] DTLS over UDP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7515">[ date ]</a>
              <a href="thread.html#7515">[ thread ]</a>
              <a href="subject.html#7515">[ subject ]</a>
              <a href="author.html#7515">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
