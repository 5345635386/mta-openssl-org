<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Reg Change in Error Code
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2019-May/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Reg%20Change%20in%20Error%20Code&In-Reply-To=%3CCAHgr%3DkJn5OcAYFDm-YzQ5TbZyppQ%3DCDx2qMA48D29OHMZP965w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010383.html">
   <LINK REL="Next"  HREF="010387.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Reg Change in Error Code</H1>
    <B>ramakrushna mishra</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Reg%20Change%20in%20Error%20Code&In-Reply-To=%3CCAHgr%3DkJn5OcAYFDm-YzQ5TbZyppQ%3DCDx2qMA48D29OHMZP965w%40mail.gmail.com%3E"
       TITLE="Reg Change in Error Code">rama.krushna7 at gmail.com
       </A><BR>
    <I>Sat May  4 03:54:33 UTC 2019</I>
    <P><UL>
        <LI>Previous message: <A HREF="010383.html">Reg Change in Error Code
</A></li>
        <LI>Next message: <A HREF="010387.html">Reg Change in Error Code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10386">[ date ]</a>
              <a href="thread.html#10386">[ thread ]</a>
              <a href="subject.html#10386">[ subject ]</a>
              <a href="author.html#10386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matt,

Thanks for the detailed response.
As you suggested there is definitely a lot to improve in our code to convey
the correct meaning of the code.  I have tested with the changes and it
conveyed the correct meaning now as you clearly stated.

I just have one more doubt. Now I tried to test with the code with an
ongoing customer scenario where we do not get any error or error string or
the libssl method name as well. Mostly it happens when SSL_get_error()
after SSL_do_handshake() returns SSL_ERROR_SYSCALL.

Is there any way to capture more information about this error ?

Thanks a lot again for your timely response.

Regards,
Ram Krushna

On Sat, May 4, 2019 at 3:34 AM &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>&gt; wrote:

&gt;<i> Send openssl-users mailing list submissions to
</I>&gt;<i>         <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>         <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>         <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-request at openssl.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>         <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-owner at openssl.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of openssl-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>    1. Re: SSL_read() returning SSL_ERROR_SYSCALL with errno 11
</I>&gt;<i>       EAGAIN (John Unsworth)
</I>&gt;<i>    2. Reg Change in Error Code (ramakrushna mishra)
</I>&gt;<i>    3. Re: Reg Change in Error Code (Matt Caswell)
</I>&gt;<i>    4. Re: Any timeframe for the 1.1.1c release? (Viktor Dukhovni)
</I>&gt;<i>    5. Re: SSL_read() returning SSL_ERROR_SYSCALL with errno 11
</I>&gt;<i>       EAGAIN (Viktor Dukhovni)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Fri, 3 May 2019 09:34:14 +0000
</I>&gt;<i> From: John Unsworth &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">John.Unsworth at synchronoss.com</A>&gt;
</I>&gt;<i> To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&quot; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i> Subject: Re: SSL_read() returning SSL_ERROR_SYSCALL with errno 11
</I>&gt;<i>         EAGAIN
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">DM6PR07MB4650AF92014D45DBB2017095F5350 at DM6PR07MB4650.namprd07.prod.outlook.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;<i>
</I>&gt;<i> Testing changed code.
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i> John
</I>&gt;<i>
</I>&gt;<i> ________________________________
</I>&gt;<i> From: openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt; on behalf of Matt
</I>&gt;<i> Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt;
</I>&gt;<i> Sent: Friday, May 3, 2019 10:16 am
</I>&gt;<i> To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> Subject: Re: SSL_read() returning SSL_ERROR_SYSCALL with errno 11 EAGAIN
</I>&gt;<i>
</I>&gt;<i> CAUTION: This email originated from outside of Synchronoss.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 02/05/2019 18:23, Viktor Dukhovni wrote:
</I>&gt;<i> &gt;&gt;&gt; At this point you'd be calling SSL_get_error(), is there a lock that
</I>&gt;<i> &gt;&gt;&gt; prevents writes between SSL_read() and SSL_read() and SSL_get_error()?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The mutex does not protect SSL_get_error() calls.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think that's an application bug.  The SSL_get_error() is using
</I>&gt;<i> &gt; the same SSL handle as the SSL_read(), which can be materially
</I>&gt;<i> &gt; altered by concurrent writes.  (Matt, if you're still reading this
</I>&gt;<i> &gt; thread, do you agree?)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I would not release the mutex until after the call to SSL_get_error().
</I>&gt;<i>
</I>&gt;<i> An SSL object should not be used in multiple threads at the same time no
</I>&gt;<i> matter
</I>&gt;<i> what the API call. This applies to SSL_get_error() as well. If you are
</I>&gt;<i> doing
</I>&gt;<i> that then that could most definitely cause the behaviour you are seeing.
</I>&gt;<i>
</I>&gt;<i> Matt
</I>&gt;<i>
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;
</I>&gt;<i> <A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20190503/7209280b/attachment-0001.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20190503/7209280b/attachment-0001.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 2
</I>&gt;<i> Date: Fri, 3 May 2019 20:48:05 +0530
</I>&gt;<i> From: ramakrushna mishra &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">rama.krushna7 at gmail.com</A>&gt;
</I>&gt;<i> To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> Subject: Reg Change in Error Code
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;CAHgr=
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">kKorZgv4ezpaT6nxtioqJPvyS-w2rVRvA7YC0CBT5gk6Q at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;utf-8&quot;
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> When client(openssl) is configured with TLSv1 and Server(java) was
</I>&gt;<i> configured with TLSv1_2, then in openssl version 1.1.0e we used to get the
</I>&gt;<i> error code : 337002677( 0x141640B5). But with openssl 1.1.1 upgrade the
</I>&gt;<i> error code changed to 337285301
</I>&gt;<i> (0x141A90B5). Moreover Earlier in java also we used to see
</I>&gt;<i> &quot;javax.net.ssl.SSLHandshakeException: Caused by: Remote host closed
</I>&gt;<i> connection during handshake &quot; exception at the server end which is not seen
</I>&gt;<i> now.
</I>&gt;<i>
</I>&gt;<i> Following are my doubts.
</I>&gt;<i>
</I>&gt;<i> 1) Has anyone noticed this change ?
</I>&gt;<i> 2) Where these error codes ( 337002677) and (337285301) defined ?
</I>&gt;<i> 3) Why the java server will not throw the exception any more ?
</I>&gt;<i>
</I>&gt;<i> Any help is highly appreciated.
</I>&gt;<i>
</I>&gt;<i> Thanks and Regards,
</I>&gt;<i> Ram Krushna
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;
</I>&gt;<i> <A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20190503/3368e8cb/attachment-0001.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20190503/3368e8cb/attachment-0001.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 3
</I>&gt;<i> Date: Fri, 3 May 2019 16:46:23 +0100
</I>&gt;<i> From: Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt;
</I>&gt;<i> To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> Subject: Re: Reg Change in Error Code
</I>&gt;<i> Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">d1a9743c-3ea4-9445-02d6-8e7512e490fe at openssl.org</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 03/05/2019 16:18, ramakrushna mishra wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When client(openssl) is configured with TLSv1 and Server(java) was
</I>&gt;<i> configured
</I>&gt;<i> &gt; with TLSv1_2, then in openssl version 1.1.0e we used to get the error
</I>&gt;<i> code
</I>&gt;<i> &gt; :?337002677( 0x141640B5). But with openssl 1.1.1 upgrade the error code
</I>&gt;<i> changed
</I>&gt;<i> &gt; to 337285301
</I>&gt;<i> &gt; (0x141A90B5). Moreover Earlier in java also we used to see
</I>&gt;<i> &gt; &quot;javax.net.ssl.SSLHandshakeException: Caused by: Remote host closed
</I>&gt;<i> connection
</I>&gt;<i> &gt; during handshake &quot; exception at the server end which is not seen now.?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Following are my doubts.?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) Has anyone noticed this change ??
</I>&gt;<i> &gt; 2) Where these error codes ( 337002677) and (337285301) defined ?
</I>&gt;<i>
</I>&gt;<i> You can use the command line &quot;errstr&quot; utility for the relevant openssl
</I>&gt;<i> version
</I>&gt;<i> to check their meanings. For 1.1.0e:
</I>&gt;<i>
</I>&gt;<i> $ openssl errstr 141640B5
</I>&gt;<i> error:141640B5:SSL routines:tls_construct_client_hello:no ciphers available
</I>&gt;<i>
</I>&gt;<i> For 1.1.1:
</I>&gt;<i> $ openssl errstr 141A90B5
</I>&gt;<i> error:141A90B5:SSL routines:ssl_cipher_list_to_bytes:no ciphers available
</I>&gt;<i>
</I>&gt;<i> You can also get your application to generate these human readable error
</I>&gt;<i> strings
</I>&gt;<i> using the appropriate functions:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://www.openssl.org/docs/man1.1.1/man3/ERR_error_string.html">https://www.openssl.org/docs/man1.1.1/man3/ERR_error_string.html</A>
</I>&gt;<i>
</I>&gt;<i> Error codes are highly version specific and may change from one version to
</I>&gt;<i> another. We do not provide any guarantee that the same error will always
</I>&gt;<i> produce
</I>&gt;<i> the same error code - so you should not rely on them remaining static. The
</I>&gt;<i> different components of the error string tell you different things about
</I>&gt;<i> the
</I>&gt;<i> cause of the error. &quot;SSL routines&quot; tells us that the error came from
</I>&gt;<i> libssl.
</I>&gt;<i> &quot;tls_construct_client_hello&quot; tells us the name of the function in the
</I>&gt;<i> source
</I>&gt;<i> code that generated the error. Finally &quot;no ciphers available&quot; tells us
</I>&gt;<i> specifically what the error was.
</I>&gt;<i>
</I>&gt;<i> In this case &quot;no ciphers available&quot; means that there are no configured
</I>&gt;<i> ciphersuites that are suitable for use in your configuration. For example
</I>&gt;<i> if
</I>&gt;<i> your client is configured to only use TLSv1 but you've only configured
</I>&gt;<i> ciphersuites suitable for use in TLSv1.2 then you will get this error.
</I>&gt;<i> (Incidentally it seems very strange to use 1.1.0/1.1.1 but then restrict
</I>&gt;<i> the
</I>&gt;<i> client to using TLSv1 only - I'd recommend using the highest protocol
</I>&gt;<i> version
</I>&gt;<i> available for the library in use)
</I>&gt;<i>
</I>&gt;<i> This error occurs in the &quot;tls_construct_client_hello&quot; function (in 1.1.0e)
</I>&gt;<i> which
</I>&gt;<i> is very early in the handshake process. It occurs during construction of
</I>&gt;<i> the
</I>&gt;<i> very first message sent by the client (the ClientHello).
</I>&gt;<i>
</I>&gt;<i> It appears that in 1.1.1 the function that does this check has changed. It
</I>&gt;<i> is
</I>&gt;<i> now done in &quot;ssl_cipher_list_to_bytes&quot;. This function is called from
</I>&gt;<i> &quot;tls_construct_client_hello&quot;. This is why the error code has changed - but
</I>&gt;<i> it is
</I>&gt;<i> the same underlying cause.
</I>&gt;<i> ?
</I>&gt;<i> &gt; 3) Why the java server will not throw the exception any more ?
</I>&gt;<i>
</I>&gt;<i> Looking at the code it appears that in 1.1.0e the client just abandons the
</I>&gt;<i> connection attempt without sending any error alert to the server. In 1.1.1
</I>&gt;<i> it
</I>&gt;<i> now sends an &quot;internal_error&quot; alert first. This is most likely the cause
</I>&gt;<i> of the
</I>&gt;<i> change of behaviour on the server side.
</I>&gt;<i>
</I>&gt;<i> Matt
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; ?
</I>&gt;<i> &gt; Any help is highly appreciated.?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks and?Regards,
</I>&gt;<i> &gt; Ram Krushna
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 4
</I>&gt;<i> Date: Fri, 3 May 2019 11:58:56 -0400
</I>&gt;<i> From: Viktor Dukhovni &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at dukhovni.org</A>&gt;
</I>&gt;<i> To: &quot;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&quot; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
</I>&gt;<i> Subject: Re: Any timeframe for the 1.1.1c release?
</I>&gt;<i> Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">3BECA507-6AE2-40CA-981A-C08400767957 at dukhovni.org</A>&gt;
</I>&gt;<i> Content-Type: text/plain;       charset=us-ascii
</I>&gt;<i>
</I>&gt;<i> &gt; On May 2, 2019, at 12:09 PM, Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; when is the 1.1.1c expected to be released? There were plenty of bug
</I>&gt;<i> &gt;&gt; fixes committed to the 1.1.1 branch since the 1.1.1b release. Is the
</I>&gt;<i> &gt;&gt; 1.1.1c release imminent?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; There are no plans at the moment.
</I>&gt;<i>
</I>&gt;<i> There should perhaps be a 1.1.1c soonish...  There are indeed many useful
</I>&gt;<i> improvements committed, but not yet released.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>         Viktor.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 5
</I>&gt;<i> Date: Fri, 3 May 2019 18:04:05 -0400
</I>&gt;<i> From: Viktor Dukhovni &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at dukhovni.org</A>&gt;
</I>&gt;<i> To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> Subject: Re: SSL_read() returning SSL_ERROR_SYSCALL with errno 11
</I>&gt;<i>         EAGAIN
</I>&gt;<i> Message-ID: &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">20190503220405.GF67454 at straasha.imrryr.org</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=us-ascii
</I>&gt;<i>
</I>&gt;<i> On Fri, May 03, 2019 at 09:34:14AM +0000, John Unsworth wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Testing changed code.
</I>&gt;<i>
</I>&gt;<i> For the record, though I think you realise this, *both* the SSL_read()
</I>&gt;<i> or SSL_write() and the following SSL_get_error() need to be protected
</I>&gt;<i> as a unit by the *same* instance of the locked mutex.  It would not
</I>&gt;<i> be enough to lock these separately.
</I>&gt;<i>
</I>&gt;<i>     acquire_lock();
</I>&gt;<i>         if (reading)
</I>&gt;<i>             ret = SSL_read(ssl, ...);
</I>&gt;<i>         else
</I>&gt;<i>             ret = SSL_write(ssl, ...);
</I>&gt;<i>         if (ret &lt;= 0)
</I>&gt;<i>             err = SSL_get_error(ssl, ret);
</I>&gt;<i>     release_lock();
</I>&gt;<i>
</I>&gt;<i>     /* Handle EOF and errors */
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>         Viktor.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Subject: Digest Footer
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> openssl-users mailing list
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> End of openssl-users Digest, Vol 54, Issue 4
</I>&gt;<i> ********************************************
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20190504/412acf67/attachment.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20190504/412acf67/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010383.html">Reg Change in Error Code
</A></li>
	<LI>Next message: <A HREF="010387.html">Reg Change in Error Code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10386">[ date ]</a>
              <a href="thread.html#10386">[ thread ]</a>
              <a href="subject.html#10386">[ subject ]</a>
              <a href="author.html#10386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
