<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Problem with certificate check when it does not match CN
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2016-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Problem%20with%20certificate%20check%20when%20it%20does%20not%0A%20match%20CN&In-Reply-To=%3CCAOBG12m0%2BWv1K5d4erbdxF6r6dgSjj2sOa7-Xx9A5bhOLjY%2Bog%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005002.html">
   <LINK REL="Next"  HREF="005008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Problem with certificate check when it does not match CN</H1>
    <B>Brice Andr&#233;</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Problem%20with%20certificate%20check%20when%20it%20does%20not%0A%20match%20CN&In-Reply-To=%3CCAOBG12m0%2BWv1K5d4erbdxF6r6dgSjj2sOa7-Xx9A5bhOLjY%2Bog%40mail.gmail.com%3E"
       TITLE="[openssl-users] Problem with certificate check when it does not match CN">brice at famille-andre.be
       </A><BR>
    <I>Mon Dec 19 07:12:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005002.html">[openssl-users] Problem with certificate check when it does not match CN
</A></li>
        <LI>Next message: <A HREF="005008.html">[openssl-users] Problem with certificate check when it does not match CN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5006">[ date ]</a>
              <a href="thread.html#5006">[ thread ]</a>
              <a href="subject.html#5006">[ subject ]</a>
              <a href="author.html#5006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Viktor,

Once again, thanks for your help.

I quickly setup a test server with new certificate. URL is the following :
<A HREF="https://test.online-rdv.be/demo">https://test.online-rdv.be/demo</A>

Soap is used for both website and self-written C++ application. You can
test soap directly with the provided link : enter a username and password
(whatever it is) and you will see a soap request to urls
<A HREF="https://test.online-rdv.be/v1/soap/public/">https://test.online-rdv.be/v1/soap/public/</A> and another one to
<A HREF="https://test.online-rdv.be/v1/soap/user/">https://test.online-rdv.be/v1/soap/user/</A>

Both are accepted by web browsers. So, my best guess is that my server is
properly configured.

On self-written client side, I use C++ code whose soap part is generated by
gsoap. You will find attached the generated code, as well as the wrapper
that I wrote and that uses the generated code). I also use openssl (1.0.1j
15 Oct 2014).

The bundle containing the root certificates is quite large because my
application performs several SSL access, but I added the certificates that
I copy-pasted here below, which, at my best knowledge,should be enough for
my certificate:

If it may be useful, I can write a small test program that performs only
the soap request instead of providing parts of code.

Many thanks for your help,

Brice


Comodo certification chain
==========================

-----BEGIN CERTIFICATE-----
MIIGCDCCA/CgAwIBAgIQKy5u6tl1NmwUim7bo3yMBzANBgkqhkiG9w0BAQwFADCB
hTELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4G
A1UEBxMHU2FsZm9yZDEaMBgGA1UEChMRQ09NT0RPIENBIExpbWl0ZWQxKzApBgNV
BAMTIkNPTU9ETyBSU0EgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwHhcNMTQwMjEy
MDAwMDAwWhcNMjkwMjExMjM1OTU5WjCBkDELMAkGA1UEBhMCR0IxGzAZBgNVBAgT
EkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4GA1UEBxMHU2FsZm9yZDEaMBgGA1UEChMR
Q09NT0RPIENBIExpbWl0ZWQxNjA0BgNVBAMTLUNPTU9ETyBSU0EgRG9tYWluIFZh
bGlkYXRpb24gU2VjdXJlIFNlcnZlciBDQTCCASIwDQYJKoZIhvcNAQEBBQADggEP
ADCCAQoCggEBAI7CAhnhoFmk6zg1jSz9AdDTScBkxwtiBUUWOqigwAwCfx3M28Sh
bXcDow+G+eMGnD4LgYqbSRutA776S9uMIO3Vzl5ljj4Nr0zCsLdFXlIvNN5IJGS0
Qa4Al/e+Z96e0HqnU4A7fK31llVvl0cKfIWLIpeNs4TgllfQcBhglo/uLQeTnaG6
ytHNe+nEKpooIZFNb5JPJaXyejXdJtxGpdCsWTWM/06RQ1A/WZMebFEh7lgUq/51
UHg+TLAchhP6a5i84DuUHoVS3AOTJBhuyydRReZw3iVDpA3hSqXttn7IzW3uLh0n
c13cRTCAquOyQQuvvUSH2rnlG51/ruWFgqUCAwEAAaOCAWUwggFhMB8GA1UdIwQY
MBaAFLuvfgI9+qbxPISOre44mOzZMjLUMB0GA1UdDgQWBBSQr2o6lFoL2JDqElZz
30O0Oija5zAOBgNVHQ8BAf8EBAMCAYYwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNV
HSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwGwYDVR0gBBQwEjAGBgRVHSAAMAgG
BmeBDAECATBMBgNVHR8ERTBDMEGgP6A9hjtodHRwOi8vY3JsLmNvbW9kb2NhLmNv
bS9DT01PRE9SU0FDZXJ0aWZpY2F0aW9uQXV0aG9yaXR5LmNybDBxBggrBgEFBQcB
AQRlMGMwOwYIKwYBBQUHMAKGL2h0dHA6Ly9jcnQuY29tb2RvY2EuY29tL0NPTU9E
T1JTQUFkZFRydXN0Q0EuY3J0MCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5jb21v
ZG9jYS5jb20wDQYJKoZIhvcNAQEMBQADggIBAE4rdk+SHGI2ibp3wScF9BzWRJ2p
mj6q1WZmAT7qSeaiNbz69t2Vjpk1mA42GHWx3d1Qcnyu3HeIzg/3kCDKo2cuH1Z/
e+FE6kKVxF0NAVBGFfKBiVlsit2M8RKhjTpCipj4SzR7JzsItG8kO3KdY3RYPBps
P0/HEZrIqPW1N+8QRcZs2eBelSaz662jue5/DJpmNXMyYE7l3YphLG5SEXdoltMY
dVEVABt0iN3hxzgEQyjpFv3ZBdRdRydg1vs4O2xyopT4Qhrf7W8GjEXCBgCq5Ojc
2bXhc3js9iPc0d1sjhqPpepUfJa3w/5Vjo1JXvxku88+vZbrac2/4EjxYoIQ5QxG
V/Iz2tDIY+3GH5QFlkoakdH368+PUq4NCNk+qKBR6cGHdNXJ93SrLlP7u3r7l+L4
HyaPs9Kg4DdbKDsx5Q5XLVq4rXmsXiBmGqW5prU5wfWYQ//u+aen/e7KJD2AFsQX
j4rBYKEMrltDR5FL1ZoXX/nUh8HCjLfn4g8wGTeGrODcQgPmlKidrv0PJFGUzpII
0fxQ8ANAe4hZ7Q7drNJ3gjTcBpUC2JD5Leo31Rpg0Gcg19hCC0Wvgmje3WYkN5Ap
lBlGGSW4gNfL1IYoakRwJiNiqZ+Gb7+6kHDSVneFeO/qJakXzlByjAA6quPbYzSf
+AZxAeKCINT+b72x
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFdDCCBFygAwIBAgIQJ2buVutJ846r13Ci/ITeIjANBgkqhkiG9w0BAQwFADBv
MQswCQYDVQQGEwJTRTEUMBIGA1UEChMLQWRkVHJ1c3QgQUIxJjAkBgNVBAsTHUFk
ZFRydXN0IEV4dGVybmFsIFRUUCBOZXR3b3JrMSIwIAYDVQQDExlBZGRUcnVzdCBF
eHRlcm5hbCBDQSBSb290MB4XDTAwMDUzMDEwNDgzOFoXDTIwMDUzMDEwNDgzOFow
gYUxCzAJBgNVBAYTAkdCMRswGQYDVQQIExJHcmVhdGVyIE1hbmNoZXN0ZXIxEDAO
BgNVBAcTB1NhbGZvcmQxGjAYBgNVBAoTEUNPTU9ETyBDQSBMaW1pdGVkMSswKQYD
VQQDEyJDT01PRE8gUlNBIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MIICIjANBgkq
hkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAkehUktIKVrGsDSTdxc9EZ3SZKzejfSNw
AHG8U9/E+ioSj0t/EFa9n3Byt2F/yUsPF6c947AEYe7/EZfH9IY+Cvo+XPmT5jR6
2RRr55yzhaCCenavcZDX7P0N+pxs+t+wgvQUfvm+xKYvT3+Zf7X8Z0NyvQwA1onr
ayzT7Y+YHBSrfuXjbvzYqOSSJNpDa2K4Vf3qwbxstovzDo2a5JtsaZn4eEgwRdWt
4Q08RWD8MpZRJ7xnw8outmvqRsfHIKCxH2XeSAi6pE6p8oNGN4Tr6MyBSENnTnIq
m1y9TBsoilwie7SrmNnu4FGDwwlGTm0+mfqVF9p8M1dBPI1R7Qu2XK8sYxrfV8g/
vOldxJuvRZnio1oktLqpVj3Pb6r/SVi+8Kj/9Lit6Tf7urj0Czr56ENCHonYhMsT
8dm74YlguIwoVqwUHZwK53Hrzw7dPamWoUi9PPevtQ0iTMARgexWO/bTouJbt7IE
IlKVgJNp6I5MZfGRAy1wdALqi2cVKWlSArvX31BqVUa/oKMoYX9w0MOiqiwhqkfO
KJwGRXa/ghgntNWutMtQ5mv0TIZxMOmm3xaG4Nj/QN370EKIf6MzOi5cHkERgWPO
GHFrK+ymircxXDpqR+DDeVnWIBqv8mqYqnK8V0rSS527EPywTEHl7R09XiidnMy/
s1Hap0flhFMCAwEAAaOB9DCB8TAfBgNVHSMEGDAWgBStvZh6NLQm9/rEJlTvA73g
JMtUGjAdBgNVHQ4EFgQUu69+Aj36pvE8hI6t7jiY7NkyMtQwDgYDVR0PAQH/BAQD
AgGGMA8GA1UdEwEB/wQFMAMBAf8wEQYDVR0gBAowCDAGBgRVHSAAMEQGA1UdHwQ9
MDswOaA3oDWGM2h0dHA6Ly9jcmwudXNlcnRydXN0LmNvbS9BZGRUcnVzdEV4dGVy
bmFsQ0FSb290LmNybDA1BggrBgEFBQcBAQQpMCcwJQYIKwYBBQUHMAGGGWh0dHA6
Ly9vY3NwLnVzZXJ0cnVzdC5jb20wDQYJKoZIhvcNAQEMBQADggEBAGS/g/FfmoXQ
zbihKVcN6Fr30ek+8nYEbvFScLsePP9NDXRqzIGCJdPDoCpdTPW6i6FtxFQJdcfj
Jw5dhHk3QBN39bSsHNA7qxcS1u80GH4r6XnTq1dFDK8o+tDb5VCViLvfhVdpfZLY
Uspzgb8c8+a4bmYRBbMelC1/kZWSWfFMzqORcUx8Rww7Cxn2obFshj5cqsQugsv5
B5a6SE2Q8pTIqXOi6wZ7I53eovNNVZ96YUWYGGjHXkBrI/V5eu+MtWuLt29G9Hvx
PUsE2JOAWVrgQSQdso8VYFhH2+9uRv0V9dlfmrPb2LjkQLPNlzmuhbsdjrzch5vR
pu/xO28QOG8=
-----END CERTIFICATE-----



2016-12-18 23:08 GMT+01:00 Viktor Dukhovni &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at dukhovni.org</A>&gt;:

&gt;<i>
</I>&gt;<i> &gt; On Dec 18, 2016, at 4:52 PM, Brice Andr&#233; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">brice at famille-andre.be</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I know that the current certificate is the old one, but this
</I>&gt;<i> &gt; is because my service is in production.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I tested new certificate this evening to limit the number of
</I>&gt;<i> &gt; impacted clients. And as it did not worked, i reinstalled
</I>&gt;<i> &gt; previous certificate waiting a solution for the new one.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If it may help, i can install the new cerrificate on a
</I>&gt;<i> &gt; test site.
</I>&gt;<i>
</I>&gt;<i> Either that, or post a problem report that contains detailed
</I>&gt;<i> technical information, rather than a hand-waving story.
</I>&gt;<i>
</I>&gt;<i> What version of OpenSSL are you using?  What O/S platform?
</I>&gt;<i> What certificate stores did you configure in your OpenSSL
</I>&gt;<i> client.  Which pertinent certificates (post these) did you
</I>&gt;<i> ensure are contained in that store.
</I>&gt;<i>
</I>&gt;<i> What certificate chain is returned by the server?
</I>&gt;<i> Post the output of:
</I>&gt;<i>
</I>&gt;<i>    $ (sleep 2; exit) |
</I>&gt;<i>         openssl s_client -showcerts -connect &lt;name&gt;:&lt;port&gt; 2&gt;&amp;1 |
</I>&gt;<i>         openssl crl2pkcs7 -nocrl -certfile /dev/stdin |
</I>&gt;<i>         openssl pkcs7 -print_certs | tee chain.pem
</I>&gt;<i>
</I>&gt;<i> Copy the trusted roots into a file named trusted.pem, then
</I>&gt;<i> make sure the server's chain validates:
</I>&gt;<i>
</I>&gt;<i>    $ openssl verify -trusted trusted.pem -untrusted chain.pem chain.pem
</I>&gt;<i>
</I>&gt;<i> (post the output...).  [ By the way, your problem is not a bug in DNS
</I>&gt;<i> subjectAltName processing in OpenSSL.  Either your server configuration
</I>&gt;<i> or client code is in error, if you present sufficient detail, it will
</I>&gt;<i> be possible to help you determine which. ]
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>         Viktor.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> openssl-users mailing list
</I>&gt;<i> To unsubscribe: <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20161219/d9d607d0/attachment-0001.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20161219/d9d607d0/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: soap.zip
Type: application/zip
Size: 48318 bytes
Desc: not available
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20161219/d9d607d0/attachment-0001.zip">http://mta.openssl.org/pipermail/openssl-users/attachments/20161219/d9d607d0/attachment-0001.zip</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005002.html">[openssl-users] Problem with certificate check when it does not match CN
</A></li>
	<LI>Next message: <A HREF="005008.html">[openssl-users] Problem with certificate check when it does not match CN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5006">[ date ]</a>
              <a href="thread.html#5006">[ thread ]</a>
              <a href="subject.html#5006">[ subject ]</a>
              <a href="author.html#5006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
