<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Unable to STARTTLS behind a specific network
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2016-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Unable%20to%20STARTTLS%20behind%20a%20specific%20network&In-Reply-To=%3C79CF82E2-EB40-454A-8032-E4B1B2BC2271%40dukhovni.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005025.html">
   <LINK REL="Next"  HREF="005024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Unable to STARTTLS behind a specific network</H1>
    <B>Viktor Dukhovni</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Unable%20to%20STARTTLS%20behind%20a%20specific%20network&In-Reply-To=%3C79CF82E2-EB40-454A-8032-E4B1B2BC2271%40dukhovni.org%3E"
       TITLE="[openssl-users] Unable to STARTTLS behind a specific network">openssl-users at dukhovni.org
       </A><BR>
    <I>Thu Dec 22 16:58:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005025.html">[openssl-users] Unable to STARTTLS behind a specific network
</A></li>
        <LI>Next message: <A HREF="005024.html">[openssl-users] Unable to STARTTLS behind a specific network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5023">[ date ]</a>
              <a href="thread.html#5023">[ thread ]</a>
              <a href="subject.html#5023">[ subject ]</a>
              <a href="author.html#5023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Dec 22, 2016, at 5:30 AM, Hoggins! &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">fuckspam at wheres5.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> So what I do is :
</I>&gt;<i> 
</I>&gt;<i>    $ openssl s_client -starttls smtp -crlf -connect newdude.radiom.fr:5000
</I>
This (well essentially this, but with the Postfix &quot;posttls-finger&quot; utility)
works for me from my MTA host:

$ posttls-finger -d sha512 &quot;[newdude.radiom.fr]:5000&quot;
posttls-finger: using DANE RR: _5000._tcp.newdude.radiom.fr IN TLSA 3 0 2 95:6D:5F:68:4A:65:07:55:53:7D:14:02:2C:23:F4:A2:CD:5B:93:AC:86:94:E2:D5:16:26:21:24:B7:A9:06:E3:E1:E6:61:77:DF:60:6E:98:9E:36:9F:BA:23:11:CA:F9:53:99:79:73:0C:D9:D5:10:DF:73:92:52:60:B5:EA:12
posttls-finger: Connected to newdude.radiom.fr[188.165.117.231]:5000
posttls-finger: &lt; 220 newdude.radiom.fr ESMTP Sendmail 8.15.2/8.15.2; Thu, 22 Dec 2016 17:54:11 +0100
posttls-finger: &gt; EHLO mournblade.imrryr.org
posttls-finger: &lt; 250-newdude.radiom.fr Hello mournblade.imrryr.org [38.117.134.19], pleased to meet you
posttls-finger: &lt; 250-ENHANCEDSTATUSCODES
posttls-finger: &lt; 250-PIPELINING
posttls-finger: &lt; 250-8BITMIME
posttls-finger: &lt; 250-SIZE
posttls-finger: &lt; 250-DSN
posttls-finger: &lt; 250-ETRN
posttls-finger: &lt; 250-AUTH GSSAPI LOGIN PLAIN
posttls-finger: &lt; 250-STARTTLS
posttls-finger: &lt; 250-DELIVERBY
posttls-finger: &lt; 250 HELP
posttls-finger: &gt; STARTTLS
posttls-finger: &lt; 220 2.0.0 Ready to start TLS
posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: depth=0 matched end entity certificate sha512 digest 95:6D:5F:68:4A:65:07:55:53:7D:14:02:2C:23:F4:A2:CD:5B:93:AC:86:94:E2:D5:16:26:21:24:B7:A9:06:E3:E1:E6:61:77:DF:60:6E:98:9E:36:9F:BA:23:11:CA:F9:53:99:79:73:0C:D9:D5:10:DF:73:92:52:60:B5:EA:12
posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: Matched subjectAltName: *.radiom.fr
posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: subjectAltName: radiom.fr
posttls-finger: newdude.radiom.fr[188.165.117.231]:5000 CommonName *.radiom.fr
posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: subject_CN=*.radiom.fr, issuer_CN=StartCom Class 2 Primary Intermediate Server CA, fingerprint=95:6D:5F:68:4A:65:07:55:53:7D:14:02:2C:23:F4:A2:CD:5B:93:AC:86:94:E2:D5:16:26:21:24:B7:A9:06:E3:E1:E6:61:77:DF:60:6E:98:9E:36:9F:BA:23:11:CA:F9:53:99:79:73:0C:D9:D5:10:DF:73:92:52:60:B5:EA:12, pkey_fingerprint=C2:86:49:CF:64:12:52:13:CE:55:AD:84:D5:50:DF:88:42:0D:58:6D:78:B0:67:F6:F3:EE:D7:48:99:F6:28:A4:59:E4:97:08:EA:E6:DA:D8:92:92:28:C9:B8:4E:83:25:3E:1A:F6:CA:C9:94:5A:83:A7:3D:0C:9B:DA:F5:F0:37
posttls-finger: Verified TLS connection established to newdude.radiom.fr[188.165.117.231]:5000: TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits)
posttls-finger: &gt; EHLO mournblade.imrryr.org
posttls-finger: &lt; 250-newdude.radiom.fr Hello mournblade.imrryr.org [38.117.134.19], pleased to meet you
posttls-finger: &lt; 250-ENHANCEDSTATUSCODES
posttls-finger: &lt; 250-PIPELINING
posttls-finger: &lt; 250-8BITMIME
posttls-finger: &lt; 250-SIZE
posttls-finger: &lt; 250-DSN
posttls-finger: &lt; 250-ETRN
posttls-finger: &lt; 250-AUTH GSSAPI LOGIN PLAIN
posttls-finger: &lt; 250-DELIVERBY
posttls-finger: &lt; 250 HELP
posttls-finger: &gt; QUIT
posttls-finger: &lt; 221 2.0.0 newdude.radiom.fr closing connection

&gt;<i> No problem, I can communicate with the SMTP server after the STARTTLS
</I>&gt;<i> occurred.
</I>&gt;<i> 
</I>&gt;<i> But behind that specific network, if I run the same command, all I get is :
</I>&gt;<i> 
</I>&gt;<i>    CONNECTED(00000003)
</I>&gt;<i>    write:errno=104
</I>&gt;<i>    ---
</I>&gt;<i>    no peer certificate available
</I>&gt;<i>    ---
</I>&gt;<i>    No client certificate CA names sent
</I>&gt;<i>    ---
</I>&gt;<i>    SSL handshake has read 351 bytes and written 147 bytes
</I>&gt;<i>    ---
</I>&gt;<i>    New, (NONE), Cipher is (NONE)
</I>&gt;<i>    Secure Renegotiation IS NOT supported
</I>&gt;<i>    Compression: NONE
</I>&gt;<i>    Expansion: NONE
</I>&gt;<i>    ---
</I>&gt;<i> 
</I>&gt;<i> When I compare two tcpdumps, I can clearly see that a lot of data is
</I>&gt;<i> missing, the transaction is not complete.
</I>&gt;<i> 
</I>&gt;<i> Before being paranoid, I simply suspect a MTU problem, but I'm not sure
</I>&gt;<i> how this would only apply to SSL transactions.
</I>&gt;<i> 
</I>&gt;<i> Should I provide tcpdumps or anything else?
</I>
Just the PCAP file for the broken session is enough.  However, since the
destination looks perfectly fine, the problem is surely some firewall at
the source network that exhibits the problem, and figuring out exactly
what's wrong with that firewall is not an OpenSSL issue.  Send the PCAP
file to the network administrator and ask for help there.

-- 
	Viktor.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005025.html">[openssl-users] Unable to STARTTLS behind a specific network
</A></li>
	<LI>Next message: <A HREF="005024.html">[openssl-users] Unable to STARTTLS behind a specific network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5023">[ date ]</a>
              <a href="thread.html#5023">[ thread ]</a>
              <a href="subject.html#5023">[ subject ]</a>
              <a href="author.html#5023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
