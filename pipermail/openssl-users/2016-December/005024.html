<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Unable to STARTTLS behind a specific network
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2016-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Unable%20to%20STARTTLS%20behind%20a%20specific%20network&In-Reply-To=%3C98ac869b-a1cc-3d8e-fa4e-8cc6c94db170%40wheres5.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005023.html">
   <LINK REL="Next"  HREF="005026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Unable to STARTTLS behind a specific network</H1>
    <B>Hoggins!</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Unable%20to%20STARTTLS%20behind%20a%20specific%20network&In-Reply-To=%3C98ac869b-a1cc-3d8e-fa4e-8cc6c94db170%40wheres5.com%3E"
       TITLE="[openssl-users] Unable to STARTTLS behind a specific network">fuckspam at wheres5.com
       </A><BR>
    <I>Fri Dec 23 14:13:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005023.html">[openssl-users] Unable to STARTTLS behind a specific network
</A></li>
        <LI>Next message: <A HREF="005026.html">[openssl-users] MinGW64 / MSYS2 and ./Configure : use of Windows style path causing failures to 'make'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5024">[ date ]</a>
              <a href="thread.html#5024">[ thread ]</a>
              <a href="subject.html#5024">[ subject ]</a>
              <a href="author.html#5024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

Thank you for your help !

Le 22/12/2016 &#224; 17:58, Viktor Dukhovni a &#233;crit :
&gt;&gt;<i> On Dec 22, 2016, at 5:30 AM, Hoggins! &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">fuckspam at wheres5.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So what I do is :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    $ openssl s_client -starttls smtp -crlf -connect newdude.radiom.fr:5000
</I>&gt;<i> This (well essentially this, but with the Postfix &quot;posttls-finger&quot; utility)
</I>&gt;<i> works for me from my MTA host:
</I>&gt;<i>
</I>&gt;<i> $ posttls-finger -d sha512 &quot;[newdude.radiom.fr]:5000&quot;
</I>&gt;<i> posttls-finger: using DANE RR: _5000._tcp.newdude.radiom.fr IN TLSA 3 0 2 95:6D:5F:68:4A:65:07:55:53:7D:14:02:2C:23:F4:A2:CD:5B:93:AC:86:94:E2:D5:16:26:21:24:B7:A9:06:E3:E1:E6:61:77:DF:60:6E:98:9E:36:9F:BA:23:11:CA:F9:53:99:79:73:0C:D9:D5:10:DF:73:92:52:60:B5:EA:12
</I>&gt;<i> posttls-finger: Connected to newdude.radiom.fr[188.165.117.231]:5000
</I>&gt;<i> posttls-finger: &lt; 220 newdude.radiom.fr ESMTP Sendmail 8.15.2/8.15.2; Thu, 22 Dec 2016 17:54:11 +0100
</I>&gt;<i> posttls-finger: &gt; EHLO mournblade.imrryr.org
</I>&gt;<i> posttls-finger: &lt; 250-newdude.radiom.fr Hello mournblade.imrryr.org [38.117.134.19], pleased to meet you
</I>&gt;<i> posttls-finger: &lt; 250-ENHANCEDSTATUSCODES
</I>&gt;<i> posttls-finger: &lt; 250-PIPELINING
</I>&gt;<i> posttls-finger: &lt; 250-8BITMIME
</I>&gt;<i> posttls-finger: &lt; 250-SIZE
</I>&gt;<i> posttls-finger: &lt; 250-DSN
</I>&gt;<i> posttls-finger: &lt; 250-ETRN
</I>&gt;<i> posttls-finger: &lt; 250-AUTH GSSAPI LOGIN PLAIN
</I>&gt;<i> posttls-finger: &lt; 250-STARTTLS
</I>&gt;<i> posttls-finger: &lt; 250-DELIVERBY
</I>&gt;<i> posttls-finger: &lt; 250 HELP
</I>&gt;<i> posttls-finger: &gt; STARTTLS
</I>&gt;<i> posttls-finger: &lt; 220 2.0.0 Ready to start TLS
</I>&gt;<i> posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: depth=0 matched end entity certificate sha512 digest 95:6D:5F:68:4A:65:07:55:53:7D:14:02:2C:23:F4:A2:CD:5B:93:AC:86:94:E2:D5:16:26:21:24:B7:A9:06:E3:E1:E6:61:77:DF:60:6E:98:9E:36:9F:BA:23:11:CA:F9:53:99:79:73:0C:D9:D5:10:DF:73:92:52:60:B5:EA:12
</I>&gt;<i> posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: Matched subjectAltName: *.radiom.fr
</I>&gt;<i> posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: subjectAltName: radiom.fr
</I>&gt;<i> posttls-finger: newdude.radiom.fr[188.165.117.231]:5000 CommonName *.radiom.fr
</I>&gt;<i> posttls-finger: newdude.radiom.fr[188.165.117.231]:5000: subject_CN=*.radiom.fr, issuer_CN=StartCom Class 2 Primary Intermediate Server CA, fingerprint=95:6D:5F:68:4A:65:07:55:53:7D:14:02:2C:23:F4:A2:CD:5B:93:AC:86:94:E2:D5:16:26:21:24:B7:A9:06:E3:E1:E6:61:77:DF:60:6E:98:9E:36:9F:BA:23:11:CA:F9:53:99:79:73:0C:D9:D5:10:DF:73:92:52:60:B5:EA:12, pkey_fingerprint=C2:86:49:CF:64:12:52:13:CE:55:AD:84:D5:50:DF:88:42:0D:58:6D:78:B0:67:F6:F3:EE:D7:48:99:F6:28:A4:59:E4:97:08:EA:E6:DA:D8:92:92:28:C9:B8:4E:83:25:3E:1A:F6:CA:C9:94:5A:83:A7:3D:0C:9B:DA:F5:F0:37
</I>&gt;<i> posttls-finger: Verified TLS connection established to newdude.radiom.fr[188.165.117.231]:5000: TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits)
</I>&gt;<i> posttls-finger: &gt; EHLO mournblade.imrryr.org
</I>&gt;<i> posttls-finger: &lt; 250-newdude.radiom.fr Hello mournblade.imrryr.org [38.117.134.19], pleased to meet you
</I>&gt;<i> posttls-finger: &lt; 250-ENHANCEDSTATUSCODES
</I>&gt;<i> posttls-finger: &lt; 250-PIPELINING
</I>&gt;<i> posttls-finger: &lt; 250-8BITMIME
</I>&gt;<i> posttls-finger: &lt; 250-SIZE
</I>&gt;<i> posttls-finger: &lt; 250-DSN
</I>&gt;<i> posttls-finger: &lt; 250-ETRN
</I>&gt;<i> posttls-finger: &lt; 250-AUTH GSSAPI LOGIN PLAIN
</I>&gt;<i> posttls-finger: &lt; 250-DELIVERBY
</I>&gt;<i> posttls-finger: &lt; 250 HELP
</I>&gt;<i> posttls-finger: &gt; QUIT
</I>&gt;<i> posttls-finger: &lt; 221 2.0.0 newdude.radiom.fr closing connection
</I>&gt;<i>
</I>&gt;&gt;<i> No problem, I can communicate with the SMTP server after the STARTTLS
</I>&gt;&gt;<i> occurred.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But behind that specific network, if I run the same command, all I get is :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    CONNECTED(00000003)
</I>&gt;&gt;<i>    write:errno=104
</I>&gt;&gt;<i>    ---
</I>&gt;&gt;<i>    no peer certificate available
</I>&gt;&gt;<i>    ---
</I>&gt;&gt;<i>    No client certificate CA names sent
</I>&gt;&gt;<i>    ---
</I>&gt;&gt;<i>    SSL handshake has read 351 bytes and written 147 bytes
</I>&gt;&gt;<i>    ---
</I>&gt;&gt;<i>    New, (NONE), Cipher is (NONE)
</I>&gt;&gt;<i>    Secure Renegotiation IS NOT supported
</I>&gt;&gt;<i>    Compression: NONE
</I>&gt;&gt;<i>    Expansion: NONE
</I>&gt;&gt;<i>    ---
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I compare two tcpdumps, I can clearly see that a lot of data is
</I>&gt;&gt;<i> missing, the transaction is not complete.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Before being paranoid, I simply suspect a MTU problem, but I'm not sure
</I>&gt;&gt;<i> how this would only apply to SSL transactions.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Should I provide tcpdumps or anything else?
</I>&gt;<i> Just the PCAP file for the broken session is enough.  However, since the
</I>&gt;<i> destination looks perfectly fine, the problem is surely some firewall at
</I>&gt;<i> the source network that exhibits the problem, and figuring out exactly
</I>&gt;<i> what's wrong with that firewall is not an OpenSSL issue.  Send the PCAP
</I>&gt;<i> file to the network administrator and ask for help there.
</I>&gt;<i>
</I>
Routing my traffic through an IPSec VPN directly to the host solves the
issue, so we can definitely bet on a problem on the local network.
I'm afraid the administrators are not too much into Net neutrality ;)

Cheers !

    Hoggins!

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 181 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20161223/cd1c004f/attachment.sig">http://mta.openssl.org/pipermail/openssl-users/attachments/20161223/cd1c004f/attachment.sig</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005023.html">[openssl-users] Unable to STARTTLS behind a specific network
</A></li>
	<LI>Next message: <A HREF="005026.html">[openssl-users] MinGW64 / MSYS2 and ./Configure : use of Windows style path causing failures to 'make'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5024">[ date ]</a>
              <a href="thread.html#5024">[ thread ]</a>
              <a href="subject.html#5024">[ subject ]</a>
              <a href="author.html#5024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
