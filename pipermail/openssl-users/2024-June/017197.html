<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> openssl hmac and key on the command line
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2024-June/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20openssl%20hmac%20and%20key%20on%20the%20command%20line&In-Reply-To=%3C20240608074325.bkl2yxyh5ijtqsjt%40chazelas.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017196.html">
   <LINK REL="Next"  HREF="017198.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>openssl hmac and key on the command line</H1>
    <B>Stephane Chazelas</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20openssl%20hmac%20and%20key%20on%20the%20command%20line&In-Reply-To=%3C20240608074325.bkl2yxyh5ijtqsjt%40chazelas.org%3E"
       TITLE="openssl hmac and key on the command line">stephane at chazelas.org
       </A><BR>
    <I>Sat Jun  8 07:43:26 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017196.html">OpenSSL version 3.1.6 published
</A></li>
        <LI>Next message (by thread): <A HREF="017198.html">openssl hmac and key on the command line
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17197">[ date ]</a>
              <a href="thread.html#17197">[ thread ]</a>
              <a href="subject.html#17197">[ subject ]</a>
              <a href="author.html#17197">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2022-08-07 18:20:56 +0200, Francois:
[...]
&gt;<i> I am reading some doc instructing me to run
</I>&gt;<i> 
</I>&gt;<i>     printf '%s' &quot;${challenge}&quot; | openssl dgst -sha1 -hmac ${APP_TOKEN}
</I>&gt;<i> 
</I>&gt;<i> Doing so would leak the APP_TOKEN on the command line arguments (so a
</I>&gt;<i> user running a &quot;ps&quot; at the right time would see the APP_TOKEN in
</I>&gt;<i> clear). Due to my machine setup,  programs started and their arguments
</I>&gt;<i> also end up in an audit log.
</I>&gt;<i> 
</I>&gt;<i> I am reading the documentation on
</I>&gt;<i> <A HREF="https://www.openssl.org/docs/manmaster/man1/openssl-dgst.html,">https://www.openssl.org/docs/manmaster/man1/openssl-dgst.html,</A> that
</I>&gt;<i> points at the preferred
</I>&gt;<i> <A HREF="https://www.openssl.org/docs/manmaster/man1/openssl-mac.html">https://www.openssl.org/docs/manmaster/man1/openssl-mac.html</A>
</I>&gt;<i> , and all
</I>&gt;<i> the examples have the key in clear text on the command line.
</I>&gt;<i> 
</I>&gt;<i> Is there an equivalent command I can run that will not leak the key?
</I>[...]

Hello,

I had the exact same concern and found this post by Francois in
the mailing list archives.

I see it was never answered.

Does it mean there is currently no safe way to pass the hmac
secret to the openssl utility to do HMAC in shell scripts?

Would it be possible to have a: -macopt keyenv:varname and
-macopt keyexenv:varname for instance to be able to pass the
secret via environment variables instead (which on most systems
are a lot less public than command arguments)?

I'd generally welcome any move to deprecate all APIs that rely
on passing secrets on the command line.

Best regards,
Stephane
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017196.html">OpenSSL version 3.1.6 published
</A></li>
	<LI>Next message (by thread): <A HREF="017198.html">openssl hmac and key on the command line
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17197">[ date ]</a>
              <a href="thread.html#17197">[ thread ]</a>
              <a href="subject.html#17197">[ subject ]</a>
              <a href="author.html#17197">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
