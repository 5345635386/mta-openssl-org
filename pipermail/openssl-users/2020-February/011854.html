<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> CMS decryption of message with OAEP using Hardware security module
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2020-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20CMS%20decryption%20of%20message%20with%20OAEP%20using%20Hardware%20security%20module&In-Reply-To=%3CCAB7O4GxMt%2BhU0L1jruEetyTNk4TvutnrxrRFaf_bsW7YwuBtKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011853.html">
   <LINK REL="Next"  HREF="011855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>CMS decryption of message with OAEP using Hardware security module</H1>
    <B>Thulasi Goriparthi</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20CMS%20decryption%20of%20message%20with%20OAEP%20using%20Hardware%20security%20module&In-Reply-To=%3CCAB7O4GxMt%2BhU0L1jruEetyTNk4TvutnrxrRFaf_bsW7YwuBtKA%40mail.gmail.com%3E"
       TITLE="CMS decryption of message with OAEP using Hardware security module">thulasi.goriparthi at gmail.com
       </A><BR>
    <I>Tue Feb 18 08:51:50 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="011853.html">CMS decryption of message with OAEP using Hardware security module
</A></li>
        <LI>Next message: <A HREF="011855.html">CMS decryption of message with OAEP using Hardware security module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11854">[ date ]</a>
              <a href="thread.html#11854">[ thread ]</a>
              <a href="subject.html#11854">[ subject ]</a>
              <a href="author.html#11854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Do you mean RSA OAEP decryption done by HSM fails?

Possible tests:
1. Try RSA OAEP encryption/decryption with HSM. - basic test.
2. Encrypt with HSM and decrypt using openssl crypto library. - To make
sure RSA OAEP encryption of the HSM works fine.
3. If test 2 fails, check if all the parameters (hash, mgf, salt length)
used for OAEP are same on both sides. If they match and decryption still
fails, check with your HSM vendor. If they don't, try fixing the parameters
and repeat test 2.

RSA_NO_PADDING always works as all it does is modular exponentiation.

Thanks,
Thulasi.

On Mon, 17 Feb, 2020, 19:22 RudyAC, &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">rpo at compumatica.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I have the requirement to decrypt e-mails where RSA-OAEP padding is used. I
</I>&gt;<i> use the library openssl-1.0.2k and decrypt with CMS container
</I>&gt;<i> (CMS_decrypt).
</I>&gt;<i> This works very well unless the private key is stored in a Hardware
</I>&gt;<i> security
</I>&gt;<i> module and the cryptographic operation is performed via the PKCS11 engine
</I>&gt;<i> from openssl.
</I>&gt;<i>
</I>&gt;<i> When decrypting an email which uses OAEP I got the error message:
</I>&gt;<i>
</I>&gt;<i> 47235129370352:error:06065064:digital envelope
</I>&gt;<i> routines:EVP_DecryptFinal_ex:bad decrypt:evp_enc.c:529:
</I>&gt;<i>
</I>&gt;<i> To analyze the problem I encrypted an clear text using OAEP padding and
</I>&gt;<i> setup a decryption function using
</I>&gt;<i> RSA_private_decrypt(). Here I use padding mode &quot;RSA_NO_PADDING&quot; and the
</I>&gt;<i> decryption also works with the PKCS11 engine. Unfortunately CMS does not
</I>&gt;<i> support setting the padding mode.
</I>&gt;<i>
</I>&gt;<i> For any comments I would be very grateful
</I>&gt;<i>
</I>&gt;<i> Regards Rudy
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Sent from: <A HREF="http://openssl.6102.n7.nabble.com/OpenSSL-User-f3.html">http://openssl.6102.n7.nabble.com/OpenSSL-User-f3.html</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20200218/482863c5/attachment.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20200218/482863c5/attachment.html</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011853.html">CMS decryption of message with OAEP using Hardware security module
</A></li>
	<LI>Next message: <A HREF="011855.html">CMS decryption of message with OAEP using Hardware security module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11854">[ date ]</a>
              <a href="thread.html#11854">[ thread ]</a>
              <a href="subject.html#11854">[ subject ]</a>
              <a href="author.html#11854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
