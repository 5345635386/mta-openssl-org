<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Question about Open SSL 1.0.2 series compatibility
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2023-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Question%20about%20Open%20SSL%201.0.2%20series%20compatibility&In-Reply-To=%3CZXIqX5tVz3ZDvG40%40straasha.imrryr.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016892.html">
   <LINK REL="Next"  HREF="016894.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Question about Open SSL 1.0.2 series compatibility</H1>
    <B>Viktor Dukhovni</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Question%20about%20Open%20SSL%201.0.2%20series%20compatibility&In-Reply-To=%3CZXIqX5tVz3ZDvG40%40straasha.imrryr.org%3E"
       TITLE="Question about Open SSL 1.0.2 series compatibility">openssl-users at dukhovni.org
       </A><BR>
    <I>Thu Dec  7 20:26:07 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016892.html">Question about Open SSL 1.0.2 series compatibility
</A></li>
        <LI>Next message (by thread): <A HREF="016894.html">Question about Open SSL 1.0.2 series compatibility
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16893">[ date ]</a>
              <a href="thread.html#16893">[ thread ]</a>
              <a href="subject.html#16893">[ subject ]</a>
              <a href="author.html#16893">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Dec 07, 2023 at 06:22:41PM +0000, Fox, Shawn D (US) via openssl-users wrote:

&gt;<i> We do link to the dynamic libraries which I didn&#8217;t mention before and
</I>&gt;<i> when we setup our execution environment we do update LD_LIBRARY_PATH.
</I>&gt;<i> I would think that would resolve conflicts as the applications would
</I>&gt;<i> then find our custom installation of openssl first.
</I>
You SHOULD NOT rely on LD_LIBRARY_PATH.  Use &quot;$ORIGIN&quot; and relative
library paths when building the object.  Make sure the compiled .SO has
a suitably unique SONAME, and distinctive symbol version numbers, by
backporting the &quot;shlib_variant&quot; from 1.1.0 (IIRC) to your 1.0.2 build
(this is fairly easy, I originally developed shlib_variant for 1.0.2,
but it was never in an official 1.0.2 release).


&gt;<i> The function PEM_read_X509 seems to be the root my issue.
</I>
It should not be a problem, provided you use the right headers when
building the application.  The compile-time headers and library
dependency need to match.

&gt;<i> On RHEL8 it doesn&#8217;t populate the out parameter the same way and it
</I>&gt;<i> results in a downstream seg fault.
</I>
This suggests a misconfiguration of the include or library path.


&gt;<i> I have not been able to find where that function is defined.
</I>
It is code generated by macros when OpenSSL is built.  The shared
object library has the symbol:

    $ objdump -T /usr/lib/libcrypto.so | grep -w PEM_read_X509
    0000000000153fb0 g    DF .text  0000000000000024  OPENSSL_1_1_0 PEM_read_X509

    $ objdump -T /usr/local/lib/libcrypto.so | grep -w PEM_read_X509
    0000000000385580 g    DF .text  0000000000000041  OPENSSL_3.0.0 PEM_read_X509

    $ objdump -T /usr/local/siteexec/lib/libcrypto.so | grep -w PEM_read_X509
    00000000003cf210 g    DF .text  0000000000000024  OPENSSLRPK_3.0.0 PEM_read_X509

The first one is FreeBSD 12's bundled OpenSSL 1.1.1q.
The second is OpenSSL 3.0.12 from FreeBSD ports.
The third is my own build of OpenSSL 3.2 with RPK support, as a
&quot;shlib_variant&quot; to avoid symbol conflicts with the ports build.

All three can coexist in the same executable without conflicts, by
virtue of non-overlapping symbol versions and distinct SONAMEs.

    $ readelf -d /usr/lib/libcrypto.so | grep SONAME
     0x000000000000000e SONAME               Library soname: [libcrypto.so.111]
    $ readelf -d /usr/local/lib/libcrypto.so | grep -w SONAME
     0x000000000000000e SONAME               Library soname: [libcrypto.so.12]
    $ readelf -d /usr/local/siteexec/lib/libcrypto.so | grep -w SONAME
     0x000000000000000e SONAME               Library soname: [libcryptorpk.so.3]

-- 
    Viktor.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016892.html">Question about Open SSL 1.0.2 series compatibility
</A></li>
	<LI>Next message (by thread): <A HREF="016894.html">Question about Open SSL 1.0.2 series compatibility
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16893">[ date ]</a>
              <a href="thread.html#16893">[ thread ]</a>
              <a href="subject.html#16893">[ subject ]</a>
              <a href="author.html#16893">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
