<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-March/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20File%20signing/encrypting%20upgrade%20from%201.0.2%20to%0A%201.1.0&In-Reply-To=%3C4d98fc4078cc1b18d96d975cfaa218ff%40jan-kohnert.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007805.html">
   <LINK REL="Next"  HREF="007753.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0</H1>
    <B>Jan Kohnert</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20File%20signing/encrypting%20upgrade%20from%201.0.2%20to%0A%201.1.0&In-Reply-To=%3C4d98fc4078cc1b18d96d975cfaa218ff%40jan-kohnert.de%3E"
       TITLE="[openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0">nospam001-lists at jan-kohnert.de
       </A><BR>
    <I>Thu Mar 29 07:07:13 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="007805.html">[openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0
</A></li>
        <LI>Next message: <A HREF="007753.html">[openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7828">[ date ]</a>
              <a href="thread.html#7828">[ thread ]</a>
              <a href="subject.html#7828">[ subject ]</a>
              <a href="author.html#7828">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Am 2018-03-28 00:40, schrieb Jan Kohnert:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Am Tue, 27 Mar 2018 18:24:25 +0000
</I>&gt;<i> schrieb Sergio NNX &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">sfhacker at hotmail.com</A>&gt;:
</I>&gt;<i> 
</I>&gt;&gt;<i> &gt; The code comiles just fine
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Unfortunately, it does NOT compile fine on my system (and I guess the
</I>&gt;&gt;<i> same occurs on several others!)
</I>&gt;<i> 
</I>&gt;<i> Good, updated the zip file, just tested on Linux here (the local
</I>&gt;<i> Windows maschine just installs VS for testing), giving the following
</I>&gt;<i> (correct output file format here):
</I>
Next update after clean test on another Win32 maschine: there have to
be crypt32.lib and ws2_32.lib libs linked, besides that the code is 
unchanged. As the code produces correct asn1 files on Linux (see 
previous mail), it now looks even more like a bug in the 
crypto-library on Windows...

Following output:
C:\Users\Alkes\Downloads\TestCrypt&gt;dir
  Datentr&#228;ger in Laufwerk C: ist OS
  Volumeseriennummer: 1E39-A7D1

  Verzeichnis von C:\Users\Alkes\Downloads\TestCrypt

29.03.2018  08:53    &lt;DIR&gt;          .
29.03.2018  08:53    &lt;DIR&gt;          ..
29.03.2018  08:52               877 CMakeLists.txt
29.03.2018  08:33             1.038 local.cert
29.03.2018  08:33             1.708 local.key
29.03.2018  08:33    &lt;DIR&gt;          src
29.03.2018  08:33    &lt;DIR&gt;          ssl
29.03.2018  08:33                27 testfile.txt
                4 Datei(en),          3.650 Bytes
                4 Verzeichnis(se), 276.550.766.592 Bytes frei

C:\Users\Alkes\Downloads\TestCrypt&gt;mkdir build

C:\Users\Alkes\Downloads\TestCrypt&gt;cd build

C:\Users\Alkes\Downloads\TestCrypt\build&gt;cmake .. -G&quot;NMake Makefiles&quot;
-- The C compiler identification is MSVC 19.0.24215.1
-- The CXX compiler identification is MSVC 19.0.24215.1
-- Check for working C compiler: C:/Program Files (x86)/Microsoft
Visual Studio
14.0/VC/bin/cl.exe
-- Check for working C compiler: C:/Program Files (x86)/Microsoft
Visual Studio
14.0/VC/bin/cl.exe -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working CXX compiler: C:/Program Files (x86)/Microsoft 
Visual Studi
o 14.0/VC/bin/cl.exe
-- Check for working CXX compiler: C:/Program Files (x86)/Microsoft 
Visual Studi
o 14.0/VC/bin/cl.exe -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Found OpenSSL: C:/Program Files (x86)/openssl/lib/libcrypto.lib 
(found suitab
le exact version &quot;1.1.0g&quot;)
-- Configuring done
-- Generating done
-- Build files have been written to: 
C:/Users/Alkes/Downloads/TestCrypt/build

C:\Users\Alkes\Downloads\TestCrypt\build&gt;nmake

Microsoft (R) Program Maintenance Utility, Version 14.00.24210.0
Copyright (C) Microsoft Corporation. Alle Rechte vorbehalten.

         &quot;C:\Program Files\CMake\bin\cmake.exe&quot; 
-HC:\Users\Alkes\Downloads\TestCr
ypt -BC:\Users\Alkes\Downloads\TestCrypt\build --check-build-system 
CMakeFiles\M
akefile.cmake 0
         &quot;C:\Program Files\CMake\bin\cmake.exe&quot; -E cmake_progress_start 
C:\Users\
Alkes\Downloads\TestCrypt\build\CMakeFiles 
C:\Users\Alkes\Downloads\TestCrypt\bu
ild\CMakeFiles\progress.marks
         &quot;C:\Program Files (x86)\Microsoft Visual Studio 
14.0\VC\BIN\nmake.exe&quot; -
f CMakeFiles\Makefile2 /nologo -                   all
         &quot;C:\Program Files (x86)\Microsoft Visual Studio 
14.0\VC\BIN\nmake.exe&quot; -
f CMakeFiles\TestCrypt.dir\build.make /nologo -L                  
CMakeFiles\Tes
tCrypt.dir\depend
         &quot;C:\Program Files\CMake\bin\cmake.exe&quot; -E cmake_depends &quot;NMake 
Makefiles
&quot; C:\Users\Alkes\Downloads\TestCrypt C:\Users\Alkes\Downloads\TestCrypt 
C:\Users
\Alkes\Downloads\TestCrypt\build 
C:\Users\Alkes\Downloads\TestCrypt\build C:\Use
rs\Alkes\Downloads\TestCrypt\build\CMakeFiles\TestCrypt.dir\DependInfo.cmake 
--c
olor=
Scanning dependencies of target TestCrypt
         &quot;C:\Program Files (x86)\Microsoft Visual Studio 
14.0\VC\BIN\nmake.exe&quot; -
f CMakeFiles\TestCrypt.dir\build.make /nologo -L                  
CMakeFiles\Tes
tCrypt.dir\build
[ 50%] Building CXX object CMakeFiles/TestCrypt.dir/src/app.cpp.obj
         C:\PROGRA~2\MICROS~1.0\VC\bin\cl.exe 
@C:\Users\Alkes\AppData\Local\Temp\
nm2433.tmp
app.cpp
[100%] Linking CXX executable TestCrypt.exe
         &quot;C:\Program Files\CMake\bin\cmake.exe&quot; -E vs_link_exe 
--intdir=CMakeFile
s\TestCrypt.dir --manifests  -- C:\PROGRA~2\MICROS~1.0\VC\bin\link.exe 
/nologo @
CMakeFiles\TestCrypt.dir\objects1.rsp 
@C:\Users\Alkes\AppData\Local\Temp\nm2618.
tmp
[100%] Built target TestCrypt
         &quot;C:\Program Files\CMake\bin\cmake.exe&quot; -E cmake_progress_start 
C:\Users\
Alkes\Downloads\TestCrypt\build\CMakeFiles 0

C:\Users\Alkes\Downloads\TestCrypt\build&gt;cp ..\testfile.txt .
Der Befehl &quot;cp&quot; ist entweder falsch geschrieben oder
konnte nicht gefunden werden.

C:\Users\Alkes\Downloads\TestCrypt\build&gt;copy ..\testfile.txt .
         1 Datei(en) kopiert.

C:\Users\Alkes\Downloads\TestCrypt\build&gt;copy ..\local.cert .
         1 Datei(en) kopiert.

C:\Users\Alkes\Downloads\TestCrypt\build&gt;copy ..\local.key .
         1 Datei(en) kopiert.

C:\Users\Alkes\Downloads\TestCrypt\build&gt;.\TestCrypt.exe

C:\Users\Alkes\Downloads\TestCrypt\build&gt;.\TestCrypt.exe

C:\Users\Alkes\Downloads\TestCrypt\build&gt;openssl smime -decrypt -inform 
DER -in
testfile.crypt -inkey local.key -out testfile.sig

C:\Users\Alkes\Downloads\TestCrypt\build&gt;openssl smime -verify -inform 
DER -in t
estfile.sig -CAfile local.cert
Error reading S/MIME message
4592:error:0D07207B:asn1 encoding routines:ASN1_get_object:header too 
long:crypt
o\asn1\asn1_lib.c:101:
4592:error:0D068066:asn1 encoding routines:asn1_check_tlen:bad object 
header:cry
pto\asn1\tasn_dec.c:1100:
4592:error:0D08303A:asn1 encoding 
routines:asn1_template_noexp_d2i:nested asn1 e
rror:crypto\asn1\tasn_dec.c:536:Field=cert, Type=PKCS7_SIGNED
4592:error:0D08303A:asn1 encoding 
routines:asn1_template_noexp_d2i:nested asn1 e
rror:crypto\asn1\tasn_dec.c:609:
4592:error:0D08403A:asn1 encoding routines:asn1_template_ex_d2i:nested 
asn1 erro
r:crypto\asn1\tasn_dec.c:460:Field=d.sign, Type=PKCS7

C:\Users\Alkes\Downloads\TestCrypt\build&gt;

Best regards Jan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TestCrypt.zip
Type: application/zip
Size: 6506 bytes
Desc: not available
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20180329/a90b4a47/attachment-0001.zip">http://mta.openssl.org/pipermail/openssl-users/attachments/20180329/a90b4a47/attachment-0001.zip</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007805.html">[openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0
</A></li>
	<LI>Next message: <A HREF="007753.html">[openssl-users] File signing/encrypting upgrade from 1.0.2 to 1.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7828">[ date ]</a>
              <a href="thread.html#7828">[ thread ]</a>
              <a href="subject.html#7828">[ subject ]</a>
              <a href="author.html#7828">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
