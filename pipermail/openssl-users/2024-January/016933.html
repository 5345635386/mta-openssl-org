<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> d2i_PKCS12_fp() documentation issues
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2024-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20d2i_PKCS12_fp%28%29%20documentation%20issues&In-Reply-To=%3CZa7ejnb-JsdRsKz3%40comcast.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016932.html">
   <LINK REL="Next"  HREF="016934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>d2i_PKCS12_fp() documentation issues</H1>
    <B>Matthew Ogilvie</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20d2i_PKCS12_fp%28%29%20documentation%20issues&In-Reply-To=%3CZa7ejnb-JsdRsKz3%40comcast.net%3E"
       TITLE="d2i_PKCS12_fp() documentation issues">mmogilvi4711+ssl at gmail.com
       </A><BR>
    <I>Mon Jan 22 21:30:54 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016932.html">OPENSSL_thread_stop() fiber local storage and questions
</A></li>
        <LI>Next message (by thread): <A HREF="016934.html">Live OpenSSL Webinar: Getting Started with OpenSSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16933">[ date ]</a>
              <a href="thread.html#16933">[ thread ]</a>
              <a href="subject.html#16933">[ subject ]</a>
              <a href="author.html#16933">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>1: When is argument freed?

The (generic &quot;TYPE&quot;) man page for d2i_PKCS12_fp() BUGS section mentions:
&quot;Additionally, in versions of OpenSSL prior to 1.1.0, when the 'reuse'
behaviour is used and an error occurs the behaviour is inconsistent. Some
functions behaved as described here, while some did not free *a on error
and did not set *a to NULL.&quot;

In my testing of d2i_PKCS12_fp() under Open SSL 3.0.11, it still seems
to have this bug.  I haven't tested other TYPE's, etc.  My workaround is
that after a NULL error is returned, I'll explicitly call PKCS12_free()
with the same variable/argument.  Hopefully this will work with
d2i_PKCS12_fp() both &quot;as implemented&quot; and &quot;as documented&quot; since free
does nothing when passed NULL.

------

2: Online man pages with '*':

The online version of the man pages seem to sometimes misinterpret
asterisk as an &quot;italicize&quot; command.  For example, in the web version
of the page above, it says &quot;... while some did not free a on error...&quot;,
without the &quot;*&quot; before the &quot;a&quot;, and stuff before it italicized.
There is similar corruption in the 4the paragraph of the description
that starts &quot;On a successful return...&quot;, and probably other
pages as well.
<A HREF="https://www.openssl.org/docs/man3.0/man3/d2i_PKCS12_fp.html">https://www.openssl.org/docs/man3.0/man3/d2i_PKCS12_fp.html</A>

In contrast, the actual installed man page (&quot;man d2i_PKCS12_fp&quot;) seems
to get this right.  Also, online paragraphs that only have one
asterisk seem to work.

===========

3. As a very minor followup to my previous question about
OPENSSL_thread_stop() vs &quot;_ex()&quot;:

Thanks.  I can call both as easily as one in my applications since
I only use one extra global OSSL_LIB_CTX besides the default. (I only
use the extra for reading P12 files with legacy encryption enabled,
which still seem to be commonly generated by other tools.)

--
FUTURE/consider documentation changes:

However, tracking/arranging multiple OPENSSL_thread_stop_ex() calls
might be trickier in other applications structured differently than
mine.

Also, as I mentioned before, a quick glance suggests the code looks
somewhat inconsistent with the documentation (the &quot;...is the same
as...&quot; part you quoted), such that OPENSSL_thread_stop() seems to
clean up all OSSL_LIB_CTX?  (Untested: Might cause problems if you
still want to use other explicit OSSL_LIB_CTX's after an
OPENSSL_thread_stop(), from the same thread?)

Perhaps the OPENSSL_thread_stop_ex() could be deprecated?  Only
really needed internally when destroying an OSSL_LIB_CTX long before
a thread exits, to satisfy the documented &quot;If OSSL_LIB_CTX_free()
is called OPENSSL_thread_stop_ex will be called automatically for the
current thread&quot;.  That is useful and probably intended to allow
continued use of other OSSL_LIB_CTX's from the same thread, but
I don't know why you should ever need to call it externally.  (If
a thread is actually exiting, then it makes more sense to
cleanup everything, which OPENSSL_thread_stop() looks like it
does already...)


- Matthew Ogilvie
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016932.html">OPENSSL_thread_stop() fiber local storage and questions
</A></li>
	<LI>Next message (by thread): <A HREF="016934.html">Live OpenSSL Webinar: Getting Started with OpenSSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16933">[ date ]</a>
              <a href="thread.html#16933">[ thread ]</a>
              <a href="subject.html#16933">[ subject ]</a>
              <a href="author.html#16933">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
