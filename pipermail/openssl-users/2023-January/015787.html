<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Query on Openssh
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2023-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Query%20on%20Openssh&In-Reply-To=%3C6520fd2b7f6b4f023cf7d9aa84dd9e840549306c.camel%40markhack.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015786.html">
   <LINK REL="Next"  HREF="015788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Query on Openssh</H1>
    <B>Mark Hack</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Query%20on%20Openssh&In-Reply-To=%3C6520fd2b7f6b4f023cf7d9aa84dd9e840549306c.camel%40markhack.com%3E"
       TITLE="Query on Openssh">markhack at markhack.com
       </A><BR>
    <I>Thu Jan 12 20:09:33 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015786.html">Query on Openssh
</A></li>
        <LI>Next message (by thread): <A HREF="015788.html">OpenSSL with Linux kernel crypto API 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15787">[ date ]</a>
              <a href="thread.html#15787">[ thread ]</a>
              <a href="subject.html#15787">[ subject ]</a>
              <a href="author.html#15787">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This does not appear to have anything to do with OpenSSL and is mostl
likely a problem with SSH.
Start by running SSH on the destination server in debug mode. That is
the best way I have found to determine client issues. 
RegardsMark Hack


On Thu, 2023-01-12 at 09:47 +0000, Deepti Sharma S via openssl-users
wrote:
&gt;<i> Hello Team,
</I>&gt;<i>  
</I>&gt;<i> Problem Statement : 
</I>&gt;<i> Unable to connect to SFTP server hosted on Microsoft Azure using
</I>&gt;<i> openssh-client version 7.4p1 using Subsytem SFTP.
</I>&gt;<i> Observation :
</I>&gt;<i> We are unable to connect with SFTP server using public key
</I>&gt;<i> authentication(same with password authentication). And getting
</I>&gt;<i> following error :
</I>&gt;<i> We are able to connect with the machine using our ssh-client.
</I>&gt;<i> 
</I>&gt;<i> After successful authentication, our client immediately send the
</I>&gt;<i> message &quot;type 1&quot; to disconnect from the server as shown in logs
</I>&gt;<i> attached.
</I>&gt;<i>  
</I>&gt;<i> Other observations :
</I>&gt;<i> We running through sftp utility, same user successfully connected
</I>&gt;<i> with SFTP Server hosted on Azure. Logs attached
</I>&gt;<i> 
</I>&gt;<i> kiel1-med10:/home/ealekbl# sftp 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">stdmpingprivwesteu01p.emmuserpass at 10.136.113.70</A>
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">stdmpingprivwesteu01p.emmuserp at 10.136.113.70</A>'s password:
</I>&gt;<i> Connected to 10.136.113.70.
</I>&gt;<i> sftp&gt; exit
</I>&gt;<i>  
</I>&gt;<i> Openssh 7.4p1 is connected successfully with sftp servers running on
</I>&gt;<i> linux machines not hosted on Azure.
</I>&gt;<i>  
</I>&gt;<i> Setup Details : 
</I>&gt;<i>               client : 
</I>&gt;<i>                              openssh-client 7.4p1 running on RHEL
</I>&gt;<i>               SFTP Server : MS Azure (AzureSSH_1.0.0)
</I>&gt;<i>               
</I>&gt;<i> Verbose Logs : 
</I>&gt;<i>  
</I>&gt;<i> kiel1-med1:/home/ealekbl#
</I>&gt;<i> /opt/mediation/appl/SERVER/CXC1741717_R4N//lib/exe/ssh-client_7.4p1
</I>&gt;<i> -oForwardX11=no -oForwardAgent=no -oProtocol=2 -l
</I>&gt;<i> stdmpingprivwesteu01p.emmuser
</I>&gt;<i> -oIdentityFile=/home/mmsuper/.ssh/emmdata.pem
</I>&gt;<i> -oNumberOfPasswordPrompts=1
</I>&gt;<i>  -oPreferredAuthentications=publickey -oPubkeyAuthentication=yes
</I>&gt;<i> -oRhostsAuthentication=no -oRhostsRSAAuthentication=no
</I>&gt;<i> -oRSAAuthentication=no -oUserKnownHostsFile=/dev/null
</I>&gt;<i> -oStrictHostKeyChecking=no -s -oport=22 -vvv -Z &quot;Alive and kicking&quot;
</I>&gt;<i> 10.136.113.70 sftp
</I>&gt;<i> OpenSSH_7.4p1, OpenSSL 1.0.2k  26 Jan 2017
</I>&gt;<i> debug2: resolving &quot;10.136.113.70&quot; port 22
</I>&gt;<i> debug2: ssh_connect_direct: needpriv 0
</I>&gt;<i> debug1: Connecting to 10.136.113.70 [10.136.113.70] port 22.
</I>&gt;<i> debug1: Connection established.
</I>&gt;<i> debug1: permanently_set_uid: 0/0
</I>&gt;<i> debug1: key_load_public: No such file or directory
</I>&gt;<i> debug1: identity file /home/mmsuper/.ssh/emmdata.pem type -1
</I>&gt;<i> debug1: key_load_public: No such file or directory
</I>&gt;<i> debug1: identity file /home/mmsuper/.ssh/emmdata.pem-cert type -1
</I>&gt;<i> debug1: Enabling compatibility mode for protocol 2.0
</I>&gt;<i> debug1: Local version string SSH-2.0-OpenSSH_7.4
</I>&gt;<i> debug1: Remote protocol version 2.0, remote software version
</I>&gt;<i> AzureSSH_1.0.0
</I>&gt;<i> debug1: no match: AzureSSH_1.0.0
</I>&gt;<i> debug2: fd 3 setting O_NONBLOCK
</I>&gt;<i> debug1: Authenticating to 10.136.113.70:22 as
</I>&gt;<i> 'stdmpingprivwesteu01p.emmuser'
</I>&gt;<i> debug3: hostkeys_foreach: reading file &quot;/dev/null&quot;
</I>&gt;<i> debug3: send packet: type 20
</I>&gt;<i> debug1: SSH2_MSG_KEXINIT sent
</I>&gt;<i> debug3: receive packet: type 20
</I>&gt;<i> debug1: SSH2_MSG_KEXINIT received
</I>&gt;<i> debug2: local client KEXINIT proposal
</I>&gt;<i> debug2: KEX algorithms: curve25519-sha256,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">curve25519-sha256 at libssh.org</A>,ecdh-sha2-nistp256,ecdh-sha2-
</I>&gt;<i> nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-
</I>&gt;<i> sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-
</I>&gt;<i> sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-
</I>&gt;<i> sha256,diffie-hellman-group14-sha1,ext-info-c
</I>&gt;<i> debug2: host key algorithms: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">ecdsa-sha2-nistp256-cert-v01 at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">ecdsa-sha2-nistp384-cert-v01 at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">ecdsa-sha2-nistp521-cert-v01 at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">ssh-ed25519-cert-v01 at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,ssh-rsa-cert-v01 at openssh.com</A>,ecdsa-
</I>&gt;<i> sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-
</I>&gt;<i> ed25519,rsa-sha2-512,rsa-sha2-256,ssh-rsa
</I>&gt;<i> debug2: ciphers ctos: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">chacha20-poly1305 at openssh.com</A>,aes128-ctr,aes192-ctr,aes256-ctr,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">aes128-gcm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,aes256-gcm at openssh.com</A>,aes128-cbc,aes192-
</I>&gt;<i> cbc,aes256-cbc
</I>&gt;<i> debug2: ciphers stoc: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">chacha20-poly1305 at openssh.com</A>,aes128-ctr,aes192-ctr,aes256-ctr,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">aes128-gcm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,aes256-gcm at openssh.com</A>,aes128-cbc,aes192-
</I>&gt;<i> cbc,aes256-cbc
</I>&gt;<i> debug2: MACs ctos: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">umac-64-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,umac-128-etm at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha2-256-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,hmac-sha2-512-etm at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha1-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,umac-64 at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,umac-128 at openssh.com</A>,hm
</I>&gt;<i> ac-sha2-256,hmac-sha2-512,hmac-sha1
</I>&gt;<i> debug2: MACs stoc: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">umac-64-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,umac-128-etm at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha2-256-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,hmac-sha2-512-etm at openssh.com</A>,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha1-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,umac-64 at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,umac-128 at openssh.com</A>,hm
</I>&gt;<i> ac-sha2-256,hmac-sha2-512,hmac-sha1
</I>&gt;<i> debug2: compression ctos: <A HREF="../../../mailman/listinfo/openssl-users.html">none,zlib at openssh.com</A>,zlib
</I>&gt;<i> debug2: compression stoc: <A HREF="../../../mailman/listinfo/openssl-users.html">none,zlib at openssh.com</A>,zlib
</I>&gt;<i> debug2: languages ctos:
</I>&gt;<i> debug2: languages stoc:
</I>&gt;<i> debug2: first_kex_follows 0
</I>&gt;<i> debug2: reserved 0
</I>&gt;<i> debug2: peer server KEXINIT proposal
</I>&gt;<i> debug2: KEX algorithms: ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-
</I>&gt;<i> hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-
</I>&gt;<i> group-exchange-sha256,ext-info-s
</I>&gt;<i> debug2: host key algorithms: rsa-sha2-256,rsa-sha2-512,ecdsa-sha2-
</I>&gt;<i> nistp256,ecdsa-sha2-nistp384
</I>&gt;<i> debug2: ciphers ctos: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">aes128-gcm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,aes256-gcm at openssh.com</A>,aes128-ctr,aes192-
</I>&gt;<i> ctr,aes256-ctr
</I>&gt;<i> debug2: ciphers stoc: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">aes128-gcm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,aes256-gcm at openssh.com</A>,aes128-ctr,aes192-
</I>&gt;<i> ctr,aes256-ctr
</I>&gt;<i> debug2: MACs ctos: hmac-sha2-256,hmac-sha2-512,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha2-256-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,hmac-sha2-512-etm at openssh.com</A>
</I>&gt;<i> debug2: MACs stoc: hmac-sha2-256,hmac-sha2-512,
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha2-256-etm at openssh.com</A><A HREF="../../../mailman/listinfo/openssl-users.html">,hmac-sha2-512-etm at openssh.com</A>
</I>&gt;<i> debug2: compression ctos: none
</I>&gt;<i> debug2: compression stoc: none
</I>&gt;<i> debug2: languages ctos:
</I>&gt;<i> debug2: languages stoc:
</I>&gt;<i> debug2: first_kex_follows 0
</I>&gt;<i> debug2: reserved 0
</I>&gt;<i> debug1: kex: algorithm: ecdh-sha2-nistp256
</I>&gt;<i> debug1: kex: host key algorithm: ecdsa-sha2-nistp256
</I>&gt;<i> debug1: kex: server-&gt;client cipher: aes128-ctr MAC: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha2-256-etm at openssh.com</A> compression: none
</I>&gt;<i> debug1: kex: client-&gt;server cipher: aes128-ctr MAC: 
</I>&gt;<i> <A HREF="../../../mailman/listinfo/openssl-users.html">hmac-sha2-256-etm at openssh.com</A> compression: none
</I>&gt;<i> debug3: send packet: type 30
</I>&gt;<i> debug1: sending SSH2_MSG_KEX_ECDH_INIT
</I>&gt;<i> debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
</I>&gt;<i> debug3: receive packet: type 31
</I>&gt;<i> debug1: Server host key: ecdsa-sha2-nistp256
</I>&gt;<i> SHA256:0WNMHmCNJE1YFBpHNeADuT5h+PfJ/jJPtUDHCxCSrO0
</I>&gt;<i> debug3: hostkeys_foreach: reading file &quot;/dev/null&quot;
</I>&gt;<i> Warning: Permanently added '10.136.113.70' (ECDSA) to the list of
</I>&gt;<i> known hosts.
</I>&gt;<i> debug3: send packet: type 21
</I>&gt;<i> debug2: set_newkeys: mode 1
</I>&gt;<i> debug1: rekey after 4294967296 blocks
</I>&gt;<i> debug1: SSH2_MSG_NEWKEYS sent
</I>&gt;<i> debug1: expecting SSH2_MSG_NEWKEYS
</I>&gt;<i> debug3: receive packet: type 21
</I>&gt;<i> debug1: SSH2_MSG_NEWKEYS received
</I>&gt;<i> debug2: set_newkeys: mode 0
</I>&gt;<i> debug1: rekey after 4294967296 blocks
</I>&gt;<i> debug2: key: /home/mmsuper/.ssh/emmdata.pem ((nil)), explicit
</I>&gt;<i> debug3: send packet: type 5
</I>&gt;<i> debug3: receive packet: type 7
</I>&gt;<i> debug1: SSH2_MSG_EXT_INFO received
</I>&gt;<i> debug3: receive packet: type 6
</I>&gt;<i> debug2: service_accept: ssh-userauth
</I>&gt;<i> debug1: SSH2_MSG_SERVICE_ACCEPT received
</I>&gt;<i> debug3: send packet: type 50
</I>&gt;<i> debug3: receive packet: type 51
</I>&gt;<i> debug1: Authentications that can continue: publickey,password
</I>&gt;<i> debug3: start over, passed a different list publickey,password
</I>&gt;<i> debug3: preferred publickey
</I>&gt;<i> debug3: authmethod_lookup publickey
</I>&gt;<i> debug3: remaining preferred:
</I>&gt;<i> debug3: authmethod_is_enabled publickey
</I>&gt;<i> debug1: Next authentication method: publickey
</I>&gt;<i> debug1: Trying private key: /home/mmsuper/.ssh/emmdata.pem
</I>&gt;<i> debug3: sign_and_send_pubkey: RSA
</I>&gt;<i> SHA256:achpp3Nli3MXyIAeJJuREpdXHtYpqVvOTl5YpUsO7hI
</I>&gt;<i> debug3: send packet: type 50
</I>&gt;<i> debug2: we sent a publickey packet, wait for reply
</I>&gt;<i> debug3: receive packet: type 52
</I>&gt;<i> debug1: Authentication succeeded (publickey).
</I>&gt;<i> Authenticated to 10.136.113.70 ([10.136.113.70]:22).
</I>&gt;<i> debug1: channel 0: new [client-session]
</I>&gt;<i> debug3: ssh_session2_open: channel_new: 0
</I>&gt;<i> debug2: channel 0: send open
</I>&gt;<i> debug3: send packet: type 90
</I>&gt;<i> debug1: Entering interactive session.
</I>&gt;<i> debug1: pledge: network
</I>&gt;<i> Alive and kickingdebug3: receive packet: type 91
</I>&gt;<i> debug2: callback start
</I>&gt;<i> debug2: fd 3 setting TCP_NODELAY
</I>&gt;<i> debug3: ssh_packet_set_tos: set IP_TOS 0x08
</I>&gt;<i> debug2: client_session2_setup: id 0
</I>&gt;<i> debug1: Sending subsystem: sftp
</I>&gt;<i> debug2: channel 0: request subsystem confirm 1
</I>&gt;<i> debug3: send packet: type 98
</I>&gt;<i> debug2: callback done
</I>&gt;<i> debug2: channel 0: open confirm rwindow 4294967295 rmax 262143
</I>&gt;<i> debug3: receive packet: type 99
</I>&gt;<i> debug2: channel_input_status_confirm: type 99 id 0
</I>&gt;<i> debug2: subsystem request accepted on channel 0
</I>&gt;<i> debug3: send packet: type 1
</I>&gt;<i> packet_write_wait: Connection to 10.136.113.70 port 22: Broken pipe
</I>&gt;<i> kiel1-med1:/home/ealekbl#
</I>&gt;<i>  
</I>&gt;<i> Is it some known issue or please do let us know the way forward to
</I>&gt;<i> debug it.
</I>&gt;<i> Is openssh 7.4p1 is compatible with AzureSSH_1.0.0?
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Regards,
</I>&gt;<i> Deepti Sharma
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> PMP&#174; &amp; ITIL 
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> From: Neeraj Gupta G &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">neeraj.g.gupta at ericsson.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Sent: 12 January 2023 12:31
</I>&gt;<i> 
</I>&gt;<i> To: Deepti Sharma S &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">deepti.s.sharma at ericsson.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Cc: Piyush Anand &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">piyush.anand at ericsson.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Subject: Query on Openssh
</I>&gt;<i> 
</I>&gt;<i> Importance: High
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Hi Deepti,
</I>&gt;<i>  
</I>&gt;<i> We are working on a CSR regarding regarding issue in ssh connection
</I>&gt;<i> with Azure sftp server from EM20.
</I>&gt;<i>  
</I>&gt;<i> So can you please raise the query on openssh community. 
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Query : 
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> Thanks,
</I>&gt;<i> Neeraj Gupta
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20230112/004c603a/attachment-0001.htm">https://mta.openssl.org/pipermail/openssl-users/attachments/20230112/004c603a/attachment-0001.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015786.html">Query on Openssh
</A></li>
	<LI>Next message (by thread): <A HREF="015788.html">OpenSSL with Linux kernel crypto API 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15787">[ date ]</a>
              <a href="thread.html#15787">[ thread ]</a>
              <a href="subject.html#15787">[ subject ]</a>
              <a href="author.html#15787">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
