<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] rsaOAEP OID in X509 certificate
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2018-August/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20rsaOAEP%20OID%20in%20X509%20certificate&In-Reply-To=%3C01c601d42fb8%24ff4ea8a0%24fdebf9e0%24%40codingwizard.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008472.html">
   <LINK REL="Next"  HREF="008478.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] rsaOAEP OID in X509 certificate</H1>
    <B>Stephane van Hardeveld</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20rsaOAEP%20OID%20in%20X509%20certificate&In-Reply-To=%3C01c601d42fb8%24ff4ea8a0%24fdebf9e0%24%40codingwizard.nl%3E"
       TITLE="[openssl-users] rsaOAEP OID in X509 certificate">stephane at codingwizard.nl
       </A><BR>
    <I>Thu Aug  9 08:14:30 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="008472.html">[openssl-users] rsaOAEP OID in X509 certificate
</A></li>
        <LI>Next message: <A HREF="008478.html">[openssl-users] rsaOAEP OID in X509 certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8477">[ date ]</a>
              <a href="thread.html#8477">[ thread ]</a>
              <a href="subject.html#8477">[ subject ]</a>
              <a href="author.html#8477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ken,

I am trying to do two thing:
1: Generate X 509 certificates, with RSA-PSS signing, with different Hashing
and Masking (SHA1 and SHA256), including an RSA Public key as content. This
RSA 'content key' should specify it will be used for RSA-OAEP decryption.
2: Verify X 509 certificates, produced by other tools, which have the same
format

Currently, I am able to:
- create a X 509 certificate with the different hashing and masking
algorithms, but only with standard RSA Encryption OID. Verification of these
certificates succeeds, and X509_get_pubkey() works as expected
- Verify a X 509 certificate which is generated by a different tool, with
SHA256 hashing and masking and RSA OAEP OID. Verification succeeds, but
indeed, X509_get_pubkey fails (unknown algorithm I believe). I am able to
retrieve the public key via 
	ASN1_BIT_STRING *asnPubKey = X509_get0_pubkey_bitstr(x);
	unsigned char* pblob = asnPubKey-&gt;data;
And then parsing the ASN myself. Will test your solution as well, seems a
bit more robust ;-)

One other thing I encountered: if wincrypt is used as certificate generator,
it creates a valid certificate when using SHA1 as hashing and masking
algorithm, but the signing seems to go wrong: openssl X509_verify reports
'first octet invalid'. Any idea if this is an issue with wincrypt? If using
SHA256 as hashing and masking, the resulting ASN is invalid (sizes are not
correct), openssl still can read it, and still reports the same 'first octet
invalid' error.
Verification of the signing itself is than already ok, right?

Regards,
Stephane

&gt;<i> -----Original Message-----
</I>&gt;<i> From: openssl-users [mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>] On Behalf
</I>&gt;<i> Of Ken Goldman
</I>&gt;<i> Sent: woensdag 8 augustus 2018 19:21
</I>&gt;<i> To: <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> Subject: Re: [openssl-users] rsaOAEP OID in X509 certificate
</I>&gt;<i> 
</I>&gt;<i> 1 - If you are trying to extract the public key, X509_get_pubkey() won't
</I>&gt;<i> work.  I have sample code to do it.  Let me know if you want the
</I>&gt;<i> complete function.
</I>&gt;<i> 
</I>&gt;<i> Basically:
</I>&gt;<i> 
</I>&gt;<i> 	X509_get_X509_PUBKEY
</I>&gt;<i> 	X509_PUBKEY_get0_param
</I>&gt;<i> 	d2i_RSAPublicKey
</I>&gt;<i> 
</I>&gt;<i> 2 - If you are trying to verify a certificate chain, it does not work
</I>&gt;<i> with openssl 1.1.  You have to stay at 1.0 until someone (perhaps me)
</I>&gt;<i> submits a fix.
</I>&gt;<i> 
</I>&gt;<i> ~~~~~~~~~~~~~
</I>&gt;<i> 
</I>&gt;<i> BTW, the only time I ever saw rsaAOEP was for TPM 1.2 EK certificates.
</I>&gt;<i> If you're working with the TPM, I can supply a lot of sample code.
</I>&gt;<i> 
</I>&gt;<i> On 8/8/2018 12:01 PM, Stephane van Hardeveld wrote:
</I>&gt;<i> &gt; Hello all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; By default, if I create an X 509 certificate with a public key in it,
</I>the
&gt;<i> &gt; object identifier is rsaEncyption (1.2.840.113549.1.1.1). Is it possible
</I>to
&gt;<i> &gt; specify a different object identifier, e.g. rsaOAEP
</I>(1.2.840.113549.1.1.7)?
&gt;<i> &gt; I looked into the various EVP_PKEY and EVP_PKEY_CTX functions, and
</I>&gt;<i> other
</I>&gt;<i> &gt; places in code, but the only place this object ID is specified is in
</I>&gt;<i> &gt; obj_dat.h, and not used anywhere else (as far as I can see...)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; Stephane van Hardeveld
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> openssl-users mailing list
</I>&gt;<i> To unsubscribe: <A HREF="../../../mailman/listinfo/openssl-users.html">https://mta.openssl.org/mailman/listinfo/openssl-users</A>
</I>
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008472.html">[openssl-users] rsaOAEP OID in X509 certificate
</A></li>
	<LI>Next message: <A HREF="008478.html">[openssl-users] rsaOAEP OID in X509 certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8477">[ date ]</a>
              <a href="thread.html#8477">[ thread ]</a>
              <a href="subject.html#8477">[ subject ]</a>
              <a href="author.html#8477">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
