<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2016-July/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Unable%20to%20decrypt%20CMS%20object%20encrypted%20with%20EC%0A%20prime256v1%20certificate&In-Reply-To=%3C56d2b6cb-5e45-300b-5050-8831c8126b97%40pdflib.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003988.html">
   <LINK REL="Next"  HREF="003999.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate</H1>
    <B>Stephan M&#252;hlstrasser</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20Unable%20to%20decrypt%20CMS%20object%20encrypted%20with%20EC%0A%20prime256v1%20certificate&In-Reply-To=%3C56d2b6cb-5e45-300b-5050-8831c8126b97%40pdflib.com%3E"
       TITLE="[openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate">stm at pdflib.com
       </A><BR>
    <I>Wed Jul  6 15:16:47 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="003988.html">[openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate
</A></li>
        <LI>Next message: <A HREF="003999.html">[openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3996">[ date ]</a>
              <a href="thread.html#3996">[ thread ]</a>
              <a href="subject.html#3996">[ subject ]</a>
              <a href="author.html#3996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Am 06.07.16 um 05:15 schrieb Dr. Stephen Henson:
&gt;<i> ...
</I>&gt;&gt;<i> Is the CMS object broken, or is this a problem in OpenSSL?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well the OpenSSL version does interop OK with the Bouncy Castle version of
</I>&gt;<i> ECDH and CMS. I've checked through your test message and the problem is that
</I>&gt;<i> the AES unwrapping algorithm checks fail meaning it can't proceed any further.
</I>&gt;<i> That could be down to a CMS problem, an ECDH issue or a problem with the wrap
</I>&gt;<i> algorithm either in the version you are testing or OpenSSL.
</I>&gt;<i>
</I>&gt;<i> Is it possible to get any debugging information from the other version you are
</I>&gt;<i> using: for example the content encryption key it is expecting or the ECDH
</I>&gt;<i> shared secret?
</I>
I don't know whether that is possible, I will check.

&gt;<i> Have you tried generating an message with OpenSSL and decrypting it with the
</I>&gt;<i> other version?
</I>
Yes, the other version cannot decrypt the CMS object generated by 
OpenSSL. I did some tests with Bouncy Castle, and it also cannot decrypt 
the CMS object.

What might be interesting is that on the other hand Windows CryptoAPI is 
able to decrypt the CMS object (tested on Windows 10).

While doing research on this, we found one thing that looks suspicious 
in the CMS objects generated by OpenSSL 1.0.2. When dumping the CMS 
object with dumpasn1, the key wrap algorithm is encoded as follows:

SEQUENCE {
  OBJECT IDENTIFIER '1 3 132 1 11 3'
  SEQUENCE {
    OBJECT IDENTIFIER aes256-wrap (2 16 840 1 101 3 4 1 45)
    NULL
    }
  }

Note the NULL parameter in the aes256-wrap algorithm identifier. Compare 
that to RFC 3565, &quot;2.3.2.  AES CEK Wrap Process&quot;:

<A HREF="https://tools.ietf.org/html/rfc3565#section-2.3.2">https://tools.ietf.org/html/rfc3565#section-2.3.2</A>

&quot;In all cases the parameters field MUST be absent.&quot;

Does this refer to the parameters field of the AlgorithmIdentifier of 
the AES key wrap algorithm? Then it would be incorrect to include the 
NULL here.

-- 
Stephan
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003988.html">[openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate
</A></li>
	<LI>Next message: <A HREF="003999.html">[openssl-users] Unable to decrypt CMS object encrypted with EC prime256v1 certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3996">[ date ]</a>
              <a href="thread.html#3996">[ thread ]</a>
              <a href="subject.html#3996">[ subject ]</a>
              <a href="author.html#3996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
