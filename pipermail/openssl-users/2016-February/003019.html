<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] openssl.ld and global symbols
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2016-February/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20openssl.ld%20and%20global%20symbols&In-Reply-To=%3CCAEsYawxQMiDyn%2BUKkdGZrzHdZ%3DqWMw9S2zQKaxsmGuYjVWAFfw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003021.html">
   <LINK REL="Next"  HREF="003022.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] openssl.ld and global symbols</H1>
    <B>cloud force</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20openssl.ld%20and%20global%20symbols&In-Reply-To=%3CCAEsYawxQMiDyn%2BUKkdGZrzHdZ%3DqWMw9S2zQKaxsmGuYjVWAFfw%40mail.gmail.com%3E"
       TITLE="[openssl-users] openssl.ld and global symbols">cloud.force858 at gmail.com
       </A><BR>
    <I>Fri Feb 12 22:36:51 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="003021.html">[openssl-users] Validation status of openssl-fips-2.0.11?
</A></li>
        <LI>Next message: <A HREF="003022.html">[openssl-users] pkcs12 oddity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3019">[ date ]</a>
              <a href="thread.html#3019">[ thread ]</a>
              <a href="subject.html#3019">[ subject ]</a>
              <a href="author.html#3019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Everyone,

I tried to build a FIPS capable OpenSSL Ubuntu package (using the Ubuntu
12.04 debian build scripts).

The Ubuntu package uses Configure for configuring the source tree with the
following parameters:



*ARCH_CONFARGS := enable-ec_nistp_64_gcc_128CONFARGS  = --prefix=/usr
--openssldir=/usr/lib/ssl --libdir=lib/$(DEB_HOST_MULTIARCH) fips no-idea
no-mdc2 no-rc5 zlib  enable-tlsext no-ssl2 $(ARCH_CONFARGS)*


I ran into the following errors near the end of the build:






























*shlib_target=; if [ -n &quot;libcrypto.so.1.0.0 libssl.so.1.0.0&quot; ]; then \
    shlib_target=&quot;linux-shared&quot;; \    elif [ -n &quot;libcrypto&quot; ]; then \
FIPSLD_CC=&quot;gcc&quot;; CC=/usr/local/ssl/fips-2.0/bin/fipsld; export CC
FIPSLD_CC; \    fi; \    LIBRARIES=&quot;-L.. -lssl  -L.. -lcrypto&quot; ; \    make
-f ../Makefile.shared -e \        APPNAME=openssl OBJECTS=&quot;openssl.o
verify.o asn1pars.o req.o dgst.o dh.o dhparam.o enc.o passwd.o gendh.o
errstr.o ca.o pkcs7.o crl2p7.o crl.o rsa.o rsautl.o dsa.o dsaparam.o ec.o
ecparam.o x509.o genrsa.o gendsa.o genpkey.o s_server.o s_client.o speed.o
s_time.o apps.o s_cb.o s_socket.o app_rand.o version.o sess_id.o ciphers.o
nseq.o pkcs12.o pkcs8.o pkey.o pkeyparam.o pkeyutl.o spkac.o smime.o cms.o
rand.o engine.o ocsp.o prime.o ts.o srp.o&quot; \        LIBDEPS=&quot; $LIBRARIES
-ldl -lz&quot; \        link_app.${shlib_target}make[3]: Entering directory
`/home/precise/amd64/openssl/openssl-1.0.1/apps'speed.o: In function
`speed_main':/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1219:
undefined reference to
`private_DES_set_key_unchecked'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1220:
undefined reference to
`private_DES_set_key_unchecked'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1221:
undefined reference to
`private_DES_set_key_unchecked'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1224:
undefined reference to
`private_AES_set_encrypt_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1225:
undefined reference to
`private_AES_set_encrypt_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1226:
undefined reference to
`private_AES_set_encrypt_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1229:
undefined reference to
`private_Camellia_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1230:
undefined reference to
`private_Camellia_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1231:
undefined reference to
`private_Camellia_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1237:
undefined reference to
`private_SEED_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1240:
undefined reference to
`private_RC4_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1243:
undefined reference to
`private_RC2_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1249:
undefined reference to
`private_BF_set_key'/home/precise/amd64/openssl/openssl-1.0.1/apps/speed.c:1252:
undefined reference to `private_CAST_set_key'collect2: ld returned 1 exit
status*


By comparing with the build from the stock tarball, I noticed that the
above symbols were shown as local (t) in libcrypto.so, while they're shown
as global (T) in the libcrypto.so which was built from the stock openssl
tarball. I found that if I add the above symbols to the openssl.ld file,
then the build went through without problems.


My questions are:
1. How was the openssl.ld file generated?

2. Is it an ok solution to add the above symbols to openssl.ld?

3. How to control the symbols visibility in the Makefile so that these
symbols will be exposed as global in the libcrypto.so?



-- 
Thanks,
Rich
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://mta.openssl.org/pipermail/openssl-users/attachments/20160212/4b054574/attachment.html">http://mta.openssl.org/pipermail/openssl-users/attachments/20160212/4b054574/attachment.html</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003021.html">[openssl-users] Validation status of openssl-fips-2.0.11?
</A></li>
	<LI>Next message: <A HREF="003022.html">[openssl-users] pkcs12 oddity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3019">[ date ]</a>
              <a href="thread.html#3019">[ thread ]</a>
              <a href="subject.html#3019">[ subject ]</a>
              <a href="author.html#3019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
