<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Indirect CRL CLI and support
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2020-May/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Indirect%20CRL%20CLI%20and%20support&In-Reply-To=%3CBL0PR08MB5441CA8BB3D3638742FA39E4B5AB0%40BL0PR08MB5441.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012380.html">
   <LINK REL="Next"  HREF="012372.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Indirect CRL CLI and support</H1>
    <B>Wade Cline</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Indirect%20CRL%20CLI%20and%20support&In-Reply-To=%3CBL0PR08MB5441CA8BB3D3638742FA39E4B5AB0%40BL0PR08MB5441.namprd08.prod.outlook.com%3E"
       TITLE="Indirect CRL CLI and support">wadecline at hotmail.com
       </A><BR>
    <I>Fri May  1 05:23:47 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="012380.html">OpenSSL version 3.0.0-alpha1 published
</A></li>
        <LI>Next message: <A HREF="012372.html">OpenSSL version 3.0.0-alpha1 build failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12371">[ date ]</a>
              <a href="thread.html#12371">[ thread ]</a>
              <a href="subject.html#12371">[ subject ]</a>
              <a href="author.html#12371">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I have the following PKI:

        root_ca
         /   \
 localhost   signing_ca -
             /    |      \
         admin   friend   referrer -
                             |      \
                          referred   referred_bad_indirect (R)

'admin', 'friend', 'referred', and 'referred_bad_indirect' are all client
certificates while the others are CAs ('referrer' has a 'pathlen' of '0').
My goal is to revoke the 'referred_bad_indirect' certificate via the
'signing_ca' using an indirect CRL.

&gt;<i>From what I've read on an old forum post about Indirect CRLs [1] it seems
</I>possible to add the &quot;CRL Distribution Points&quot; extension [2] to the
'referred_bad_indirect' certificate and to add the &quot;Issuing Distribution
Point&quot; extension [3] to the issued CRL; however, it seems that the CRL
also needs to have at least one &quot;Certificate Issuer&quot; extension [4] for each
certificate that is not revoked by the CRL issuer.  This does not appear to
be possible with the current `crl` tool provided by OpenSSL as the CRL is
generated from the plaintext database which does not appear to have support
for certificates issued by other CAs.

For completeness, I tried out [5] a set-up similar to the one mentioned in the
old Indirect CRL forum post mentioned earlier [1]:

        root_ca -----------------------
         /   \                         \
 localhost   signing_ca_indirectcrl     crl_ca
             /           \
        friend_indirect   friend_bad_indirect (R)

I was able to get the &quot;CRL Distribution Points&quot; extension added to
'friend_indirect' and 'friend_bad_indirect' and also the &quot;Issuing Distribution
Point&quot; to the CRL generated by 'crl_ca', but was not able to verify that
'friend_bad_indirect' was actually revoked, which I expect is due to the fact
that the CRL does not have a &quot;Certificate Issuer&quot; extension and the CRL
issuer does not match the issuer of the 'friend_bad_indirect' certificate,
which is how I interpet [1]:

 As written, both user credentials successfully validate because the CRL
 generated does not include the issuer extension on each of its entries.  If
 you choose common names such that the CA credential, CRL issuer credential, and
 CRL issuer named in the user certificates are all the same, the verify command
 will successfully recognize that one of the user credentials has been revoked.

So at this point it seems to be that the problem is a lack of the &quot;Certificate
Issuer&quot; extension on the generated CRL.  My questions are thus:

 1) Is it possible to generate an indirect CRL with appropriate
    &quot;Certificate Issuer&quot; extensions via the OpenSSL CLI tools?
 2) If not, is this supported via the library API?
 3) Does OpenSSL fully support verifying an indirect CRL if one is
    provided?
 4) Lastly, referring to the first PKI, what would happen if
    'referred_bad_indirect' left out its &quot;CRL Distribution Points&quot;
    extension (perhaps a lazy or malevolent 'referrer' CA), but the
    'signing_ca' issued an indirect CRL with 'referred_bad_indirect'
    revoked?  Would the revocation be ignored because
    'referred_bad_indirect' lacked a &quot;CRL Distribution Points&quot; extension
    or would it the revocation be accepted regardless because it's in
    the CRL?

My version of OpenSSL is 'OpenSSL 1.1.1g  21 Apr 2020', provided by the Gentoo
system distribution.

Thanks,
Wade

[1] <A HREF="http://openssl.6102.n7.nabble.com/Re-openssl-org-3097-Incorrect-revocation-status-with-indirect-CRL-td47482.html">http://openssl.6102.n7.nabble.com/Re-openssl-org-3097-Incorrect-revocation-status-with-indirect-CRL-td47482.html</A>

[2] <A HREF="https://tools.ietf.org/html/rfc5280#section-4.2.1.13">https://tools.ietf.org/html/rfc5280#section-4.2.1.13</A>

[3] <A HREF="https://tools.ietf.org/html/rfc5280#section-5.2.5">https://tools.ietf.org/html/rfc5280#section-5.2.5</A>

[4] <A HREF="https://tools.ietf.org/html/rfc5280#section-5.3.3">https://tools.ietf.org/html/rfc5280#section-5.3.3</A>

[5] <A HREF="https://github.com/clinew/inspircdtests/blob/indirect_crl/afr.sh#L437">https://github.com/clinew/inspircdtests/blob/indirect_crl/afr.sh#L437</A>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012380.html">OpenSSL version 3.0.0-alpha1 published
</A></li>
	<LI>Next message: <A HREF="012372.html">OpenSSL version 3.0.0-alpha1 build failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12371">[ date ]</a>
              <a href="thread.html#12371">[ thread ]</a>
              <a href="subject.html#12371">[ subject ]</a>
              <a href="author.html#12371">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
