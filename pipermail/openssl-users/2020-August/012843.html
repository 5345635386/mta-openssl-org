<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [EXTERNAL] Re: odd error for ECDSA key in REQ.
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2020-August/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5BEXTERNAL%5D%20Re%3A%20odd%20error%20for%20ECDSA%20key%20in%20REQ.&In-Reply-To=%3C4CD7C507-392B-44BE-986C-21E03E426E2D%40docusign.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012841.html">
   <LINK REL="Next"  HREF="012844.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[EXTERNAL] Re: odd error for ECDSA key in REQ.</H1>
    <B>Erwann Abalea</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5BEXTERNAL%5D%20Re%3A%20odd%20error%20for%20ECDSA%20key%20in%20REQ.&In-Reply-To=%3C4CD7C507-392B-44BE-986C-21E03E426E2D%40docusign.com%3E"
       TITLE="[EXTERNAL] Re: odd error for ECDSA key in REQ.">Erwann.Abalea at docusign.com
       </A><BR>
    <I>Mon Aug 10 08:32:19 UTC 2020</I>
    <P><UL>
        <LI>Previous message: <A HREF="012841.html">odd error for ECDSA key in REQ.
</A></li>
        <LI>Next message: <A HREF="012844.html">Help - Building OpenSSL FIPS for 64 bit Android
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12843">[ date ]</a>
              <a href="thread.html#12843">[ thread ]</a>
              <a href="subject.html#12843">[ subject ]</a>
              <a href="author.html#12843">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The key itself is good. Its encoding in the CSR isn't.
Looks like the public key was X9.62 encoded in its uncompressed form (i.e. start with a 04 octet, and then the octets composing the x and y coordinates), and then wrapped into an ASN.1 OCTET STRING (i.e. use the 04 tag, plus a 0x41 length, and the encoded public key), and finally the BIT STRING encapsulation.
The OCTET STRING is wrong here.

Cordialement,
Erwann Abalea

&#65279;Le 08/08/2020 14:24, &#171; openssl-users au nom de Dirk-Willem van Gulik &#187; &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A> au nom de <A HREF="../../../mailman/listinfo/openssl-users.html">dirkx at webweaving.org</A>&gt; a &#233;crit :

    The key is generated by a lovely HSM - which is by its nature a bit of a closed box. Whose vendor is very sure its software is right.

    So this helps a lot - and helps confirm what we thought !

    Thanks,

    Dw

    &gt; On 8 Aug 2020, at 04:16, Frank Migge &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">fm at frank4dd.com</A>&gt; wrote:
    &gt; 
    &gt; Hi Dirk-Willem,
    &gt; 
    &gt; Something is wrong with your EC key. The error mentions that it can't
    &gt; get the curve points from the key data. How did you generate the key?
    &gt; 
    &gt; If it helps, here is a working CSR example, using a prime256v1 key for
    &gt; comparison:
    &gt; 
    &gt; -----BEGIN CERTIFICATE REQUEST-----
    &gt; MIIBDjCBtAIBADArMQswCQYDVQQGEwJKUDEcMBoGA1UEAwwTdGVzdCBmb3IgcHJp
    &gt; bWUyNTZ2MTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABOMQV0Vep+9Xnje6bKNy
    &gt; +8blwKEscr5LoUQCuwqaUT4HyPgXFE9E0r1PiWbC6bGkS26MuguOBp52X9H9z+NS
    &gt; zM6gJzAlBgkqhkiG9w0BCQ4xGDAWMBQGA1UdEQQNMAuCCWZtNGRkLmNvbTAKBggq
    &gt; hkjOPQQDAgNJADBGAiEA5uYlfkpRsJhBk+WwippCjupEpaCNaHwNyNqbj8qrR80C
    &gt; IQDCoJtaWhFGxbaAB2+o3gm87ZHJSDSjfrD2lEhlkbEXHQ==
    &gt; -----END CERTIFICATE REQUEST-----
    &gt; 
    &gt; 
    &gt; $ openssl req -inform PEM -noout -pubkey -in test.csr
    &gt; -----BEGIN PUBLIC KEY-----
    &gt; MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4xBXRV6n71eeN7pso3L7xuXAoSxy
    &gt; vkuhRAK7CppRPgfI+BcUT0TSvU+JZsLpsaRLboy6C44GnnZf0f3P41LMzg==
    &gt; -----END PUBLIC KEY-----
    &gt; 
    &gt; 
    &gt; On Fri, 2020-08-07 at 19:07 +0200, Dirk-Willem van Gulik wrote:
    &gt;&gt; Below CSR gives me an odd error with the standard openssl REQ
    &gt;&gt; command:
    &gt;&gt; 
    &gt;&gt; 	openssl req -inform DER -noout -pubkey
    &gt;&gt; 
    &gt;&gt; 	Error getting public key
    &gt;&gt; 
    &gt;&gt; 	140673482679616:error:10067066:elliptic curve
    &gt;&gt; routines:ec_GFp_simple_oct2point:invalid
    &gt;&gt; encoding:../crypto/ec/ecp_oct.c:312:
    &gt;&gt; 	140673482679616:error:10098010:elliptic curve
    &gt;&gt; routines:o2i_ECPublicKey:EC lib:../crypto/ec/ec_asn1.c:1175:
    &gt;&gt; 	140673482679616:error:100D708E:elliptic curve
    &gt;&gt; routines:eckey_pub_decode:decode error:../crypto/ec/ec_ameth.c:157:
    &gt;&gt; 	140673482679616:error:0B09407D:x509 certificate
    &gt;&gt; routines:x509_pubkey_decode:public key decode
    &gt;&gt; error:../crypto/x509/x_pubkey.c:125:
    &gt;&gt; 
    &gt;&gt; Even though the ASN1 of the public key looks correct to me:
    &gt;&gt; 
    &gt;&gt;    SEQUENCE (2 elem)
    &gt;&gt;      SEQUENCE (2 elem)
    &gt;&gt;        OBJECT IDENTIFIER 1.2.840.10045.2.1 ecPublicKey (ANSI X9.62
    &gt;&gt; public key type)
    &gt;&gt;        OBJECT IDENTIFIER 1.2.840.10045.3.1.7 prime256v1 (ANSI X9.62
    &gt;&gt; named elliptic curve)
    &gt;&gt;      BIT STRING (536 bit)
    &gt;&gt; 000001000100000100000100001110010011001110011100011010001010010110100
    &gt;&gt; 0&#8230;
    &gt;&gt;        OCTET STRING (65 byte)
    &gt;&gt; 0439339C68A5A333143592C0A36D053F31D3AF6ED18FB54F4747B9DFC6DB6ABC71556
    &gt;&gt; 1&#8230;
    &gt;&gt; 
    &gt;&gt; What would be a good way to further debug this ?
    &gt;&gt; 
    &gt;&gt; With kind regards,
    &gt;&gt; 
    &gt;&gt; Dw
    &gt;&gt; 
    &gt;&gt; -----BEGIN CERTIFICATE REQUEST-----
    &gt;&gt; MIIBPzCB5QIBADCBgDELMAkGA1UEAxMCQ04xCjAIBgNVBAUTATExCjAIBgNVBAYT
    &gt;&gt; AUMxCjAIBgNVBAcTAUwxCjAIBgNVBAgTAVMxCjAIBgNVBAoTAU8xCzAJBgNVBAsT
    &gt;&gt; Ak9VMQowCAYDVQQMEwFUMQowCAYDVQQNEwFEMRAwDgYJKoZIhvcNAQkBEwFFMFsw
    &gt;&gt; EwYHKoZIzj0CAQYIKoZIzj0DAQcDRAAEQQQ5M5xopaMzFDWSwKNtBT8x069u0Y+1
    &gt;&gt; T0dHud/G22q8cVVh8sVcpLUortLxxesEXCddpx/EeuxP+MN/RymHTMrjoAAwCgYI
    &gt;&gt; KoZIzj0EAwIDSQAwRgIhAO+K+TFCdYxQg7aT+B3wIVa6CCYxM/mL4/WHSrwXujJy
    &gt;&gt; AiEA7UsbQT/YRKaFDPn/U9jdrJaUmKsqKJvGwN7YVaMGdeo=
    &gt;&gt; -----END CERTIFICATE REQUEST-----
    &gt; 
    &gt; 
    &gt; -- 
    &gt; Frank Migge
    &gt; <A HREF="http://fm4dd.com">http://fm4dd.com</A> | <A HREF="../../../mailman/listinfo/openssl-users.html">public at frank4dd.com</A>
    &gt; 


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012841.html">odd error for ECDSA key in REQ.
</A></li>
	<LI>Next message: <A HREF="012844.html">Help - Building OpenSSL FIPS for 64 bit Android
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12843">[ date ]</a>
              <a href="thread.html#12843">[ thread ]</a>
              <a href="subject.html#12843">[ subject ]</a>
              <a href="author.html#12843">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
