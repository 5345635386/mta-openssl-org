<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need help/inputs
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2023-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20OpenSSL%203.0.x%20%2B%20Python%203.9.x%20%2B%20Enable%20FIPS-%20Need%20help/inputs&In-Reply-To=%3C5df790e4-90a1-5985-16b4-2232ee1a039e%40openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016230.html">
   <LINK REL="Next"  HREF="016222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need help/inputs</H1>
    <B>Dr Paul Dale</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20OpenSSL%203.0.x%20%2B%20Python%203.9.x%20%2B%20Enable%20FIPS-%20Need%20help/inputs&In-Reply-To=%3C5df790e4-90a1-5985-16b4-2232ee1a039e%40openssl.org%3E"
       TITLE="OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need help/inputs">pauli at openssl.org
       </A><BR>
    <I>Thu Apr 20 06:01:49 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016230.html">OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need help/inputs
</A></li>
        <LI>Next message (by thread): <A HREF="016222.html">Crash seen in tls13_enc API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16231">[ date ]</a>
              <a href="thread.html#16231">[ thread ]</a>
              <a href="subject.html#16231">[ subject ]</a>
              <a href="author.html#16231">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You example indicates that you were attempting to use a legacy algorithm 
that the legacy provider implements.&#160; This will never be FIPS compliant.

Yes, you can have many library contexts.&#160; Just be very careful which you 
are using for FIPS and which you are using for legacy access. Non-legacy 
access to non-FIPS algorithms will invalidate any FIPS compliance.

Dr Paul Dale


On 20/4/23 15:39, Prasad, PCRaghavendra wrote:
&gt;<i>
</I>&gt;<i> Thanks, Dr.Paul,
</I>&gt;<i>
</I>&gt;<i> So we can have another context for the default providers along with 
</I>&gt;<i> the fips and base providers?
</I>&gt;<i>
</I>&gt;<i> FIPS and base providers are loaded in the default context (NULL) and 
</I>&gt;<i> we are not using any specific lib context for default providers.
</I>&gt;<i>
</I>&gt;<i> As we want to run our application only in the FIPS mode so we didn&#8217;t 
</I>&gt;<i> load the default provider.
</I>&gt;<i>
</I>&gt;<i> We will explore the points which you have mentioned below and try to 
</I>&gt;<i> integrate and test them again
</I>&gt;<i>
</I>&gt;<i> One more thing when we searched for this error most of the places they 
</I>&gt;<i> were saying we need to use --openssl-legacy-provideris it the right 
</I>&gt;<i> way to add this flag?
</I>&gt;<i>
</I>&gt;<i> Thanks, Dr. Paul for the information.
</I>&gt;<i>
</I>&gt;<i> Internal Use - Confidential
</I>&gt;<i>
</I>&gt;<i> *From:* openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt; *On Behalf 
</I>&gt;<i> Of *Dr Paul Dale
</I>&gt;<i> *Sent:* Thursday, April 20, 2023 7:10 AM
</I>&gt;<i> *To:* Prasad, PCRaghavendra; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i> *Cc:* Ds, Pradeep Kumar
</I>&gt;<i> *Subject:* Re: OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need 
</I>&gt;<i> help/inputs
</I>&gt;<i>
</I>&gt;<i> [EXTERNAL EMAIL]
</I>&gt;<i>
</I>&gt;<i> It looks like you're trying to access non-approved crypto.&#160; My 
</I>&gt;<i> suggestion would be to create a new library context specifically for 
</I>&gt;<i> this using OSSL_LIB_CTX_new().&#160; Load only the default provider into 
</I>&gt;<i> that context using OSSL_PROVIDER_load().&#160; Do not call 
</I>&gt;<i> EVP_default_properties_enable_fips() on it.
</I>&gt;<i>
</I>&gt;<i> You should only use this new library context for non-FIPS operations.&#160; 
</I>&gt;<i> If there is any doubt about what is permitted and what isn't, contact 
</I>&gt;<i> your FIPS lab for clarification.
</I>&gt;<i>
</I>&gt;<i> Paul Dale
</I>&gt;<i>
</I>&gt;<i> On 20/4/23 01:35, Prasad, PCRaghavendra wrote:
</I>&gt;<i>
</I>&gt;<i>     Hi Dr.Paul/Team,
</I>&gt;<i>
</I>&gt;<i>     Good Morning,
</I>&gt;<i>
</I>&gt;<i>     We have integrated OpenSSL 3.0.8 in our code along with fips
</I>&gt;<i>     enablement. We are using python 3.11 version.
</I>&gt;<i>
</I>&gt;<i>     We have used the default search path as our application directory
</I>&gt;<i>     (OSSL_PROVIDER_set_default_search_path) and loaded the &#8220;base&#8221; and
</I>&gt;<i>     &#8220;fips&#8221; providers and not the default provider.
</I>&gt;<i>
</I>&gt;<i>     OSSL_PROVIDER_load(None, b&quot;base&quot;)
</I>&gt;<i>
</I>&gt;<i>     OSSL_PROVIDER_load(None, b&quot;fips&quot;)
</I>&gt;<i>
</I>&gt;<i>     After that, we enabled the FIPS using
</I>&gt;<i>     libcrypto.EVP_default_properties_enable_fips() call.
</I>&gt;<i>
</I>&gt;<i>     Should we load the default provider as well or base and fips are
</I>&gt;<i>     good enough?
</I>&gt;<i>
</I>&gt;<i>     Sometimes we are getting the below error message from Python
</I>&gt;<i>     cryptography package
</I>&gt;<i>
</I>&gt;<i>     cryptography.exceptions.InternalError: Unknown OpenSSL error. This
</I>&gt;<i>     error is commonly encountered when another library is not cleaning
</I>&gt;<i>     up the OpenSSL error stack. If you are using cryptography with
</I>&gt;<i>     another library that uses OpenSSL try disabling it before
</I>&gt;<i>     reporting a bug. Otherwise please file an issue at
</I>&gt;<i>     <A HREF="https://github.com/pyca/cryptography/issues">https://github.com/pyca/cryptography/issues</A> [github.com]
</I>&gt;<i>     &lt;<A HREF="https://urldefense.com/v3/__https:/github.com/pyca/cryptography/issues__;!!LpKI!k2dOju-PcFtDgXJsvQ8wln-keBoqB3Zo6epPOzNg4aOtQsO98RQzfy_XPLDhXGAB2LO6UMYRTiMVr8SPtOggfQ$">https://urldefense.com/v3/__https:/github.com/pyca/cryptography/issues__;!!LpKI!k2dOju-PcFtDgXJsvQ8wln-keBoqB3Zo6epPOzNg4aOtQsO98RQzfy_XPLDhXGAB2LO6UMYRTiMVr8SPtOggfQ$</A>&gt;
</I>&gt;<i>     with information on how to reproduce this.
</I>&gt;<i>     ([_OpenSSLErrorWithText(code=50856204, lib=6, reason=524556,
</I>&gt;<i>     reason_text=b'error:0308010C:digital envelope
</I>&gt;<i>     routines::unsupported')])
</I>&gt;<i>
</I>&gt;<i>     This error is intermittent is what we are observing as we have
</I>&gt;<i>     already tested the complete application couple of times
</I>&gt;<i>
</I>&gt;<i>     Any thoughts or inputs on this please will help us in debugging
</I>&gt;<i>     more on this issue.
</I>&gt;<i>
</I>&gt;<i>     Thanks,
</I>&gt;<i>
</I>&gt;<i>     Raghavendra
</I>&gt;<i>
</I>&gt;<i>     Internal Use - Confidential
</I>&gt;<i>
</I>&gt;<i>     *From:* Dr Paul Dale &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">pauli at openssl.org</A>&gt; &lt;mailto:<A HREF="../../../mailman/listinfo/openssl-users.html">pauli at openssl.org</A>&gt;
</I>&gt;<i>     *Sent:* Wednesday, March 8, 2023 11:02 AM
</I>&gt;<i>     *To:* Prasad, PCRaghavendra; <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>
</I>&gt;<i>     *Cc:* Ds, Pradeep Kumar; Kuppam, Pradeep; Kappgal, Srinath
</I>&gt;<i>     *Subject:* Re: OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need
</I>&gt;<i>     help/inputs
</I>&gt;<i>
</I>&gt;<i>     [EXTERNAL EMAIL]
</I>&gt;<i>
</I>&gt;<i>         Are there any specific .h files where we can refer to this
</I>&gt;<i>         method that needs to be used ( ex: evp.h )?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     #include &quot;openssl/evp.h&quot; should be enough to get the EVP APIs.&#160;
</I>&gt;<i>     You will need other includes for other parts of OpenSSL but that
</I>&gt;<i>     covers EVP well enough.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         still, are there any files that we can go through once before
</I>&gt;<i>         calling in the fips mode?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Turn on -Wdeprecated or equivalent in your compile and the low
</I>&gt;<i>     level calls will be flagged.&#160; They should all be deprecated.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         One more doubt is How can we set fips enabled for the complete
</I>&gt;<i>         application (process/service) while running so that if we are
</I>&gt;<i>         using non-compliant algorithms/methods it should throw errors?
</I>&gt;<i>         Is it possible in OpenSSL 3.0.x?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     The call you are looking for is:
</I>&gt;<i>
</I>&gt;<i>     EVP_set_default_properties(libctx, &quot;fips=yes&quot;);
</I>&gt;<i>
</I>&gt;<i>     I strongly suggest reading the documentation about the FIPS
</I>&gt;<i>     provider [openssl.org]
</I>&gt;<i>     &lt;<A HREF="https://urldefense.com/v3/__https:/www.openssl.org/docs/man3.0/man7/fips_module.html__;!!LpKI!gwsGt_60jqaHzhWTEXZCwSn0frcRAuJbbxYQLrkbfBfkw9-Eg_mdOnYzU6EDHNOBOR25XSXKcqHcPO1X7_TtGA$">https://urldefense.com/v3/__https:/www.openssl.org/docs/man3.0/man7/fips_module.html__;!!LpKI!gwsGt_60jqaHzhWTEXZCwSn0frcRAuJbbxYQLrkbfBfkw9-Eg_mdOnYzU6EDHNOBOR25XSXKcqHcPO1X7_TtGA$</A>&gt;
</I>&gt;<i>     and the migration guide [openssl.org]
</I>&gt;<i>     &lt;<A HREF="https://urldefense.com/v3/__https:/www.openssl.org/docs/man3.0/man7/migration_guide.html__;!!LpKI!gwsGt_60jqaHzhWTEXZCwSn0frcRAuJbbxYQLrkbfBfkw9-Eg_mdOnYzU6EDHNOBOR25XSXKcqHcPO2zYsa_AA$">https://urldefense.com/v3/__https:/www.openssl.org/docs/man3.0/man7/migration_guide.html__;!!LpKI!gwsGt_60jqaHzhWTEXZCwSn0frcRAuJbbxYQLrkbfBfkw9-Eg_mdOnYzU6EDHNOBOR25XSXKcqHcPO2zYsa_AA$</A>&gt;.&#160;
</I>&gt;<i>     Both the avoidance of low level calls and setting the default
</I>&gt;<i>     properties are covered therein.&#160; There are a number of other
</I>&gt;<i>     nuances to trip over when using the FIPS provider.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Paul Dale
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20230420/4eef04ba/attachment.htm">https://mta.openssl.org/pipermail/openssl-users/attachments/20230420/4eef04ba/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016230.html">OpenSSL 3.0.x + Python 3.9.x + Enable FIPS- Need help/inputs
</A></li>
	<LI>Next message (by thread): <A HREF="016222.html">Crash seen in tls13_enc API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16231">[ date ]</a>
              <a href="thread.html#16231">[ thread ]</a>
              <a href="subject.html#16231">[ subject ]</a>
              <a href="author.html#16231">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
