<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Is curl the good tool
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2023-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Is%20curl%20the%20good%20tool&In-Reply-To=%3CVE1P189MB1135C584B96D7D6299AF6EA6BA659%40VE1P189MB1135.EURP189.PROD.OUTLOOK.COM%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016273.html">
   <LINK REL="Next"  HREF="016262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Is curl the good tool</H1>
    <B>Jean Brico</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Is%20curl%20the%20good%20tool&In-Reply-To=%3CVE1P189MB1135C584B96D7D6299AF6EA6BA659%40VE1P189MB1135.EURP189.PROD.OUTLOOK.COM%3E"
       TITLE="Is curl the good tool">jeanbrico at hotmail.com
       </A><BR>
    <I>Wed Apr 26 21:13:13 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016273.html">Is curl the good tool
</A></li>
        <LI>Next message (by thread): <A HREF="016262.html">openssl x509 -x509toreq -extensions v3_req will not output version 3 even though input cert.pem is X509v3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16274">[ date ]</a>
              <a href="thread.html#16274">[ thread ]</a>
              <a href="subject.html#16274">[ subject ]</a>
              <a href="author.html#16274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your answer, and your help.

I'm confused, really.

I use certificates since many years,  All my problems are due to terrible error.

In my Debian 11 server with Apache, I'v set CA certificates and server certificates. All have been created this week for new tests.

On the Windows client, I've set certicates (CA and users) ... created 4 years ago...

I use the same scripts, so files have the same names...

So, on Windows, all results were illogical (&quot;weird&quot;, sorry).

I've seen my mistake this afternoon. After having set good certificates on Windows client, all is working fine.

I'm very sorry. I apologize.

My question was about curl. It seems to be usefull, but I'm not sure it's the right tool to test the Debian Server and Apache (I use curl on the same server that hosts the web site).

I've used curl successfully (each time, all messages seems to be good, and at end the HTML code of the web page appears - see below):

If Apache don't ask for user authentication:
curl -iv --tlsv1.1 --tls-max 1.1 <A HREF="https://www.my_site.fr">https://www.my_site.fr</A>

If Apache asks for user authentication:
curl -iv --tlsv1.1 --tls-max 1.1 --cert /etc/ssl/certs/Alex.crt --key /etc/ssl/private/Alex.pem <A HREF="https://www.my_site.fr">https://www.my_site.fr</A>

For &quot;openssl s_client&quot;, as you wrote, on Windows 10, I don't find how to use it successfully. It is kind of a shame. This would probably be useful for testing on Windows without using an Internet browser. Don't bother, I'll figure out how to use, no problems.

I'm sorry.

Thanks for all.


-----------------------------------------------------
A successful example of curl use:

# curl -iv --tlsv1.1 --tls-max 1.1 --cert /etc/ssl/certs/Alex.crt --key /etc/ssl/private/Alex.pem <A HREF="https://www.my_site.fr">https://www.my_site.fr</A>
*   Trying 192.168.0.100:443...
* Connected to www.my_site.fr (192.168.0.100) port 443 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: /etc/ssl/certs
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Request CERT (13):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Certificate (11):
* TLSv1.3 (OUT), TLS handshake, CERT verify (15):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384
* ALPN, server accepted to use http/1.1
* Server certificate:
*  subject: C=FR; ST=France; L=Paris; O=Entreprise; OU=Factory; CN=www.my_site.fr; emailAddress=<A HREF="../../../mailman/listinfo/openssl-users.html">mail at my_site.fr</A>
*  start date: Jun 12 08:09:15 2018 GMT
*  expire date: Jun  9 08:09:15 2028 GMT
*  common name: www.my_site.fr (matched)
*  issuer: C=FR; ST=France; L=Paris; O=Entreprise; OU=Factory; CN=CA my_site; emailAddress=<A HREF="../../../mailman/listinfo/openssl-users.html">admin_ca at my_site.fr</A>
*  SSL certificate verify ok.
&gt;<i> GET / HTTP/1.1
</I>&gt;<i> Host: www.my_site.fr
</I>&gt;<i> User-Agent: curl/7.74.0
</I>&gt;<i> Accept: */*
</I>&gt;<i>
</I>* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* old SSL session ID is stale, removing
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
HTTP/1.1 200 OK
&lt; Date: Wed, 26 Apr 2023 07:29:17 GMT
Date: Wed, 26 Apr 2023 07:29:17 GMT
&lt; Server: Apache/2.4.56 (Debian)
Server: Apache/2.4.56 (Debian)
&lt; Last-Modified: Tue, 25 Apr 2023 12:14:52 GMT
Last-Modified: Tue, 25 Apr 2023 12:14:52 GMT
&lt; ETag: &quot;bc-5fa281219dadd&quot;
ETag: &quot;bc-5fa281219dadd&quot;
&lt; Accept-Ranges: bytes
Accept-Ranges: bytes
&lt; Content-Length: 188
Content-Length: 188
&lt; Vary: Accept-Encoding
Vary: Accept-Encoding
&lt; Content-Type: text/html
Content-Type: text/html

&lt;
&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
You are on a secure site.
&lt;/body&gt;
&lt;/html&gt;

* Connection #0 to host www.my_site.fr left intact

-----------------------------------------------------

________________________________
De : openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt; de la part de Michael Wojcik via openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
Envoy&#233; : mercredi 26 avril 2023 20:03
&#192; : <A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A> &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users at openssl.org</A>&gt;
Objet : RE: Is curl the good tool

&gt;<i> From: openssl-users &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">openssl-users-bounces at openssl.org</A>&gt; On Behalf Of
</I>&gt;<i> Viktor Dukhovni
</I>&gt;<i> Sent: Wednesday, 26 April, 2023 13:51
</I>&gt;<i>
</I>&gt;<i> On Wed, Apr 26, 2023 at 07:34:10PM +0000, Michael Wojcik via openssl-
</I>&gt;<i> users wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; My question: if curl is working fine, can'I conclude my Apache
</I>&gt;<i> configuration and my certificates are fine ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you didn't build curl yourself, there's no easy way to know what
</I>&gt;<i> &gt; options were used when compiling it; but I believe by default it does
</I>&gt;<i> &gt; not attempt to validate the peer's certificate chain. You have to use
</I>&gt;<i> &gt; options such as --cacert or --capath to do basic validation, --crlfile
</I>&gt;<i> &gt; to check against a CRL, --cert-status to check OCSP stapling if the
</I>&gt;<i> &gt; peer provides it, and so on.
</I>&gt;<i>
</I>&gt;<i> This is not accurate.  Curl will do WebPKI certificate verification by default, and
</I>&gt;<i> fail hard when the certificate does not match.  To get unvalidated &quot;https&quot;
</I>&gt;<i> connections, the &quot;-k&quot; option is required to opt out of validation.
</I>
Sorry, my mistake. I see now from the curl documentation that it has a collection of trust anchors it ships with.

Since the OP is either using a private CA or self-signed entity certificates (it's not clear from the original message), curl's stock set of trust anchors obviously shouldn't work for verifying their server. But the OP didn't provide a curl command line so it's not clear what tests were performed.

--
Michael Wojcik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20230426/b01291bc/attachment-0001.htm">https://mta.openssl.org/pipermail/openssl-users/attachments/20230426/b01291bc/attachment-0001.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016273.html">Is curl the good tool
</A></li>
	<LI>Next message (by thread): <A HREF="016262.html">openssl x509 -x509toreq -extensions v3_req will not output version 3 even though input cert.pem is X509v3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16274">[ date ]</a>
              <a href="thread.html#16274">[ thread ]</a>
              <a href="subject.html#16274">[ subject ]</a>
              <a href="author.html#16274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
