<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> FIPS Module Checksum is null in OpenSSL 3.0
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2021-December/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20FIPS%20Module%20Checksum%20is%20null%20in%20OpenSSL%203.0&In-Reply-To=%3CPH2P111MB130882E26E31A2A072032C1389769%40PH2P111MB1308.NAMP111.PROD.OUTLOOK.COM%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014721.html">
   <LINK REL="Next"  HREF="014723.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>FIPS Module Checksum is null in OpenSSL 3.0</H1>
    <B>Eshelman, Robert Michael (54440) JR CTR USN NIWC ATLANTIC SC (USA)</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20FIPS%20Module%20Checksum%20is%20null%20in%20OpenSSL%203.0&In-Reply-To=%3CPH2P111MB130882E26E31A2A072032C1389769%40PH2P111MB1308.NAMP111.PROD.OUTLOOK.COM%3E"
       TITLE="FIPS Module Checksum is null in OpenSSL 3.0">robert.m.eshelman2.ctr at us.navy.mil
       </A><BR>
    <I>Wed Dec 15 14:43:54 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014721.html">FIPS Checksum Data is null
</A></li>
        <LI>Next message (by thread): <A HREF="014723.html">Contract of d2i_SSL_SESSION ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14722">[ date ]</a>
              <a href="thread.html#14722">[ thread ]</a>
              <a href="subject.html#14722">[ subject ]</a>
              <a href="author.html#14722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good Morning,


I am having an issue with the FIPS Module in an OpenSSL 3.0 build. Below are the build steps and the issues that I am seeing. Sorry for the length but I am trying to provide all of the relevant details in hopes that the solution to this issue will be easily identifiable.

First, we are using ZLib 1.2.11. This is the default build for a windows machine so the tarball is extracted to the zlib directory and then we run &#8220;nmake -f win32/Makefile.msc&#8221;.



Second, we are using OpenSSL 3.0.0. After extracting the tarball to the OpenSSL directory, we are running the following configuration:

perl Configure VC-WIN32 zlib-dynamic --with-zlib-include=&lt;ZLIB_INCLUDE_DIR&gt; --with-zlib-lib=&lt;ZLIB_LIB_DIR&gt; enable-fips enable-static-engine enable-capieng -DOPENSSL_CAPIENG_DIALOG

Followed by the default &#8220;nmake&#8221;. For the install step, I have tried both the default &#8220;nmake install&#8221; and I am currently using &#8220;nmake DESTDIR=&lt;OPENSSL_INSTALL_DIR&gt; install&#8221; to mimic the file structure after an install would have been done on the current machine.



Once the install is completed, I am running the openssl fips-install command:

Openssl fipsinstall &#8211;out &#8220;&lt;OPENSSL_INSTALL_DIR&gt;\Program Files (x86)\Common Files\SSL\fipsmodule.cnf&#8221; &#8211;module &#8220;&lt;OPENSSL_INSTALL_DIR&gt;\Program Files (x86)\OpenSSL\lib\ossl-modules\fips.dll&#8221;



At this point, all of the self-tests pass and the configure file is updated successfully. I also have to go into openssl.cnf and uncomment the following lines:



# For FIPS

# Optionally include a file that is generated by the OpenSSL fipsinstall

# application. This file contains configuration data required by the OpenSSL

# fips provider. It contains a named section e.g. [fips_sect] which is

# referenced from the [provider_sect] below.

# Refer to the OpenSSL security policy for more information.

.include fipsmodule.cnf

&#8230;

[provider_sect]

default = default_sect

# The fips section name should match the section name inside the

# included fipsmodule.cnf.

fips = fips_sect



I am using this as part of stunnel so I am doing a stunnel build following this step. Once stunnel is built, I am running stunnel to create a connection but it fails on trying to initialize the FIPS module. Here is the error stack that I am getting:



[!] error queue: crypto\provider_core.c:903: error:078C0105:common libcrypto routines::init fail

[!] error queue: providers\fips\fipsprov.c:706: error:1C8000D8:Provider routines::self test post failure

[!] error queue: providers\fips\self_test.c:387: error:1C8000E0:Provider routines::fips module entering error state

[!] FIPS PROVIDER: providers\fips\self_test.c:289: error:1C8000D5:Provider routines::missing config data



Tracing through this, I have found that the check on line 288 in the self_test.c is failing because the module_checksum_data is null in the ST object. What I am failing to understand is why the module checksum keeps coming back null. To me, it seems that I am overlooking a small step somewhere and can&#8217;t see it. Any help here would be greatly appreciated.



Thank you very much,
Bob Eshelman

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20211215/73652c9e/attachment.htm">https://mta.openssl.org/pipermail/openssl-users/attachments/20211215/73652c9e/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014721.html">FIPS Checksum Data is null
</A></li>
	<LI>Next message (by thread): <A HREF="014723.html">Contract of d2i_SSL_SESSION ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14722">[ date ]</a>
              <a href="thread.html#14722">[ thread ]</a>
              <a href="subject.html#14722">[ subject ]</a>
              <a href="author.html#14722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
