<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2015-January/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20SSL_F_SSL3_GET_MESSAGE%20and%0A%09SSL_R_UNEXPECTED_MESSAGE&In-Reply-To=%3C54BC3E0D.10202%40openssl.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000290.html">
   <LINK REL="Next"  HREF="000293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE</H1>
    <B>Matt Caswell</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20SSL_F_SSL3_GET_MESSAGE%20and%0A%09SSL_R_UNEXPECTED_MESSAGE&In-Reply-To=%3C54BC3E0D.10202%40openssl.org%3E"
       TITLE="[openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE">matt at openssl.org
       </A><BR>
    <I>Sun Jan 18 23:13:17 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000290.html">[openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE
</A></li>
        <LI>Next message: <A HREF="000293.html">[openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#291">[ date ]</a>
              <a href="thread.html#291">[ thread ]</a>
              <a href="subject.html#291">[ subject ]</a>
              <a href="author.html#291">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 18/01/15 21:58, Jeffrey Walton wrote:
&gt;<i> On Sun, Jan 18, 2015 at 3:25 PM, Matt Caswell &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">matt at openssl.org</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 18/01/15 20:13, Jeffrey Walton wrote:
</I>&gt;&gt;&gt;<i> My bad... I think this is the code (from around line 500 in s3_both.c):
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         /* s-&gt;init_num == 4 */
</I>&gt;&gt;&gt;<i>         if ((mt &gt;= 0) &amp;&amp; (*p != mt))
</I>&gt;&gt;&gt;<i>             {
</I>&gt;&gt;&gt;<i>             al=SSL_AD_UNEXPECTED_MESSAGE;
</I>&gt;&gt;&gt;<i>             SSLerr(SSL_F_SSL3_GET_MESSAGE,SSL_R_UNEXPECTED_MESSAGE);
</I>&gt;&gt;&gt;<i>             goto f_err;
</I>&gt;&gt;&gt;<i>             }
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What would cause this error on a client?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The client has an internal state machine which tells it what message it
</I>&gt;&gt;<i> should expect next from the server based on its current state. Only
</I>&gt;&gt;<i> certain messages are legal at any one time. The variable mt holds the
</I>&gt;&gt;<i> message type of the message it is expecting to receive. The variable p
</I>&gt;&gt;<i> points into the message buffer for the message that it has actually
</I>&gt;&gt;<i> received. If the message sent from the server doesn't match the one the
</I>&gt;&gt;<i> client was expecting then you get this error.
</I>&gt;<i> 
</I>&gt;<i> Thanks Matt.
</I>&gt;<i> 
</I>&gt;<i> Have you guys (the devs) seen this failure in the field during
</I>&gt;<i> testing? If so, what's a typical configuration to cause it? Or what's
</I>&gt;<i> the offending server message?
</I>
No - I've not seen it.

&gt;<i> 
</I>&gt;<i> The server is using OpenSSL 1.0.1e-fips 11 Feb 2013, Thu Nov 6
</I>&gt;<i> 12:33:36 UTC 2014. The client is Android 5.0. Down level Android
</I>&gt;<i> versions are OK. s_client is OK.
</I>
So - just to clarify: Is the client openssl too? Which side is sending
the alert? Having just reread your earlier comment I'm not clear if you
meant the client sent the alert, or the client received the alert.

Are you able to capture the handshake packets?

Matt
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000290.html">[openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE
</A></li>
	<LI>Next message: <A HREF="000293.html">[openssl-users] SSL_F_SSL3_GET_MESSAGE and	SSL_R_UNEXPECTED_MESSAGE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#291">[ date ]</a>
              <a href="thread.html#291">[ thread ]</a>
              <a href="subject.html#291">[ subject ]</a>
              <a href="author.html#291">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
