<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2017-April/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20What%20does%20this%20error%20mean%3F%20sslv3%20alert%0A%20certificate%20unknown%3Astate%2023&In-Reply-To=%3C36B5D094-BDAD-46FB-9331-3E03E795B343%40dukhovni.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005681.html">
   <LINK REL="Next"  HREF="005683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23</H1>
    <B>Viktor Dukhovni</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20%5Bopenssl-users%5D%20What%20does%20this%20error%20mean%3F%20sslv3%20alert%0A%20certificate%20unknown%3Astate%2023&In-Reply-To=%3C36B5D094-BDAD-46FB-9331-3E03E795B343%40dukhovni.org%3E"
       TITLE="[openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23">openssl-users at dukhovni.org
       </A><BR>
    <I>Tue Apr 25 20:29:31 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="005681.html">[openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23
</A></li>
        <LI>Next message: <A HREF="005683.html">[openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5682">[ date ]</a>
              <a href="thread.html#5682">[ thread ]</a>
              <a href="subject.html#5682">[ subject ]</a>
              <a href="author.html#5682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Apr 25, 2017, at 3:17 PM, Blumenthal, Uri - 0553 - MITLL &lt;<A HREF="../../../mailman/listinfo/openssl-users.html">uri at ll.mit.edu</A>&gt; wrote:
</I>
&gt;<i> Secure Sockets Layer
</I>&gt;<i>     SSL Record Layer: Handshake Protocol: Client Hello
</I>&gt;<i>         Content Type: Handshake (22)
</I>&gt;<i>         Version: TLS 1.2 (0x0303)
</I>&gt;<i>         Length: 228
</I>&gt;<i>         Handshake Protocol: Client Hello
</I>&gt;<i>             Handshake Type: Client Hello (1)
</I>&gt;<i>             Length: 224
</I>&gt;<i>             Version: TLS 1.2 (0x0303)
</I>&gt;<i> ... vanilla client hello ...
</I>&gt;<i> 
</I>&gt;<i> Secure Sockets Layer
</I>&gt;<i>     TLSv1.2 Record Layer: Handshake Protocol: Server Hello
</I>&gt;<i>         Content Type: Handshake (22)
</I>&gt;<i>         Version: TLS 1.2 (0x0303)
</I>&gt;<i>         Length: 89
</I>&gt;<i>         Handshake Protocol: Server Hello
</I>&gt;<i>             Handshake Type: Server Hello (2)
</I>&gt;<i>             Length: 85
</I>&gt;<i>             Version: TLS 1.2 (0x0303)
</I>&gt;<i>             Random
</I>&gt;<i>                 GMT Unix Time: Jan 12, 2043 21:01:43.000000000 EST
</I>&gt;<i>                 Random Bytes: 74befd6060b40803a1f2eeee81de721667ea45ac751fb7cd...
</I>&gt;<i>             Session ID Length: 32
</I>&gt;<i>             Session ID: c07a259d71e9906c44632f6f9e885d40a647d514ef5deb8b...
</I>&gt;<i>             Cipher Suite: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)
</I>&gt;<i> ... vanilla server hello ...
</I>&gt;<i> 
</I>&gt;<i> Secure Sockets Layer
</I>&gt;<i>     TLSv1.2 Record Layer: Handshake Protocol: Certificate
</I>&gt;<i>         Content Type: Handshake (22)
</I>&gt;<i>         Version: TLS 1.2 (0x0303)
</I>&gt;<i>         Length: 2017
</I>&gt;<i>         Handshake Protocol: Certificate
</I>&gt;<i>             Handshake Type: Certificate (11)
</I>&gt;<i>             Length: 2013
</I>&gt;<i>             Certificates Length: 2010
</I>&gt;<i>             Certificates (2010 bytes)
</I>&gt;<i>                 Certificate Length: 1038
</I>&gt;<i>                 Certificate (id-at-commonName=cs.visual-paradigm.com)
</I>&gt;<i>                     signedCertificate
</I>&gt;<i>                         version: v3 (2)
</I>&gt;<i>                         serialNumber : 0x1c3d07eea2d576e83c60613e5f3c2a18e518b8a0
</I>&gt;<i>                         signature (sha256WithRSAEncryption)
</I>&gt;<i>                             Algorithm Id: 1.2.840.113549.1.1.11 (sha256WithRSAEncryption)
</I>
EE cert sigalg is normal

&gt;<i>                         issuer: rdnSequence (0)
</I>&gt;<i>                             rdnSequence: 6 items (id-at-commonName=McAfee Web Gateway,id-at-countryName=US,...
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                         Id: 2.5.4.10 (id-at-organizationName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: MIT Lincoln Laboratory
</I>&gt;<i>                                     . . . . .
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                         Id: 2.5.4.3 (id-at-commonName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: McAfee Web Gateway
</I>
EE cert issuer looks OK.

&gt;<i>                         validity
</I>&gt;<i>                             notBefore: utcTime (0)
</I>&gt;<i>                                 utcTime: 17-04-24 18:35:25 (UTC)
</I>&gt;<i>                             notAfter: utcTime (0)
</I>&gt;<i>                                 utcTime: 18-04-24 18:35:25 (UTC)
</I>

EE cert validity is one year, looks OK.

&gt;<i>                         subject: rdnSequence (0)
</I>&gt;<i>                             rdnSequence: 1 item (id-at-commonName=cs.visual-paradigm.com)
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-commonName=cs.visual-paradigm.com)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-commonName=cs.visual-paradigm.com)
</I>&gt;<i>                                         Id: 2.5.4.3 (id-at-commonName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: cs.visual-paradigm.com
</I>
EE cert Subject looks OK.

&gt;<i>                         subjectPublicKeyInfo
</I>&gt;<i>                             algorithm (rsaEncryption)
</I>&gt;<i>                                 Algorithm Id: 1.2.840.113549.1.1.1 (rsaEncryption)
</I>&gt;<i>                             Padding: 0
</I>&gt;<i>                             subjectPublicKey: 3082010a02820101009a686b8a742ec2e4341a6f43e20f71...
</I>
The EE public key is 256 octets or 2048 bits, looks OK.

&gt;<i>                         extensions: 5 items
</I>&gt;<i>                             Extension (id-ce-basicConstraints)
</I>&gt;<i>                                 Extension Id: 2.5.29.19 (id-ce-basicConstraints)
</I>&gt;<i>                                 BasicConstraintsSyntax [0 length]
</I>
EE empty basicConstraints defaults to CA:FALSE, OK

&gt;<i>                             Extension (id-ce-subjectKeyIdentifier)
</I>&gt;<i>                                 Extension Id: 2.5.29.14 (id-ce-subjectKeyIdentifier)
</I>&gt;<i>                                 SubjectKeyIdentifier: 749037cb5eef9dc9b52ade1c2c465c61f1a63206
</I>
Not interesting for an EE cert.

&gt;<i>                             Extension (id-ce-authorityKeyIdentifier)
</I>&gt;<i>                                 Extension Id: 2.5.29.35 (id-ce-authorityKeyIdentifier)
</I>&gt;<i>                                 AuthorityKeyIdentifier
</I>&gt;<i>                                     authorityCertIssuer: 1 item
</I>&gt;<i>                                         GeneralName: directoryName (4)
</I>&gt;<i>                                             directoryName: rdnSequence (0)
</I>&gt;<i>                                                 rdnSequence: 6 items (id-at-commonName=McAfee Web Gateway,...
</I>&gt;<i>                                                     RDNSequence item: 1 item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                                         RelativeDistinguishedName item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                                             Id: 2.5.4.10 (id-at-organizationName)
</I>&gt;<i>                                                             DirectoryString: uTF8String (4)
</I>&gt;<i>                                                                 uTF8String: MIT Lincoln Laboratory
</I>&gt;<i>                                                             . . . . .
</I>&gt;<i>                                                     RDNSequence item: 1 item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                                         RelativeDistinguishedName item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                                             Id: 2.5.4.3 (id-at-commonName)
</I>&gt;<i>                                                             DirectoryString: uTF8String (4)
</I>&gt;<i>                                                                 uTF8String: McAfee Web Gateway
</I>&gt;<i>                                     authorityCertSerialNumber: 1
</I>
EE authority key id has DN and serial

&gt;<i>                             Extension (id-ce-keyUsage)
</I>&gt;<i>                                 Extension Id: 2.5.29.15 (id-ce-keyUsage)
</I>&gt;<i>                                 Padding: 5
</I>&gt;<i>                                 KeyUsage: a0 (digitalSignature, keyEncipherment)
</I>&gt;<i>                                     1... .... = digitalSignature: True
</I>&gt;<i>                                     .0.. .... = contentCommitment: False
</I>&gt;<i>                                     ..1. .... = keyEncipherment: True
</I>&gt;<i>                                     ...0 .... = dataEncipherment: False
</I>&gt;<i>                                     .... 0... = keyAgreement: False
</I>&gt;<i>                                     .... .0.. = keyCertSign: False
</I>&gt;<i>                                     .... ..0. = cRLSign: False
</I>&gt;<i>                                     .... ...0 = encipherOnly: False
</I>&gt;<i>                                     0... .... = decipherOnly: False
</I>
EE ku is OK.

&gt;<i>                             Extension (id-ce-extKeyUsage)
</I>&gt;<i>                                 Extension Id: 2.5.29.37 (id-ce-extKeyUsage)
</I>&gt;<i>                                 KeyPurposeIDs: 1 item
</I>&gt;<i>                                     KeyPurposeId: 1.3.6.1.5.5.7.3.1 (id-kp-serverAuth)
</I>
EE eku is OK

&gt;<i>                     algorithmIdentifier (sha256WithRSAEncryption)
</I>&gt;<i>                         Algorithm Id: 1.2.840.113549.1.1.11 (sha256WithRSAEncryption)
</I>&gt;<i>                     Padding: 0
</I>&gt;<i>                     encrypted: 76a83746f5faf96fe7911ad7fd57c7240262fcec5439075e...
</I>
EE cert fine overall.

&gt;<i>                 Certificate Length: 966
</I>&gt;<i>                 Certificate (id-at-commonName=McAfee Web Gateway,. . .
</I>&gt;<i>                     signedCertificate
</I>&gt;<i>                         version: v3 (2)
</I>&gt;<i>                         serialNumber: 1
</I>
Issuer serial matches EE cert issuer and authority key id.

&gt;<i>                         signature (shaWithRSAEncryption)
</I>&gt;<i>                             Algorithm Id: 1.2.840.113549.1.1.5 (shaWithRSAEncryption)
</I>
Self-signature is SHA1, but should be OK on root CA certs.

&gt;<i>                         issuer: rdnSequence (0)
</I>&gt;<i>                             rdnSequence: 6 items (id-at-commonName=McAfee Web Gateway,...
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                         Id: 2.5.4.10 (id-at-organizationName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: MIT Lincoln Laboratory
</I>&gt;<i>                                         . . . . .
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                         Id: 2.5.4.3 (id-at-commonName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: McAfee Web Gateway
</I>
Issuer is self-signed, see below

&gt;<i>                         validity
</I>&gt;<i>                             notBefore: utcTime (0)
</I>&gt;<i>                                 utcTime: 12-08-07 21:51:05 (UTC)
</I>&gt;<i>                             notAfter: utcTime (0)
</I>&gt;<i>                                 utcTime: 22-08-07 21:51:05 (UTC)
</I>
Issuer 10 year validity is fine.

&gt;<i>                         subject: rdnSequence (0)
</I>&gt;<i>                             rdnSequence: 6 items (id-at-commonName=McAfee Web Gateway,. . .
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-organizationName=MIT Lincoln Laboratory)
</I>&gt;<i>                                         Id: 2.5.4.10 (id-at-organizationName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: MIT Lincoln Laboratory
</I>&gt;<i>                                         . . . . .
</I>&gt;<i>                                 RDNSequence item: 1 item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                     RelativeDistinguishedName item (id-at-commonName=McAfee Web Gateway)
</I>&gt;<i>                                         Id: 2.5.4.3 (id-at-commonName)
</I>&gt;<i>                                         DirectoryString: uTF8String (4)
</I>&gt;<i>                                             uTF8String: McAfee Web Gateway
</I>
Same subject/issuer and issuer subject name matches EE cert issuer name, ...

&gt;<i>                         subjectPublicKeyInfo
</I>&gt;<i>                             algorithm (rsaEncryption)
</I>&gt;<i>                                 Algorithm Id: 1.2.840.113549.1.1.1 (rsaEncryption)
</I>&gt;<i>                             Padding: 0
</I>&gt;<i>                             subjectPublicKey: 3082010a028201010085b3b7c94a1150fdde952428b6a343...
</I>
Issuer cert also 2048-bits.

&gt;<i>                         extensions: 4 items
</I>&gt;<i>                             Extension (ns_cert_exts.comment)
</I>&gt;<i>                                 Extension Id: 2.16.840.1.113730.1.13 (ns_cert_exts.comment)
</I>&gt;<i>                                 BER Error: String with tag=22 expected but class:UNIVERSAL(0) primitive tag:12 was unexpected
</I>&gt;<i>                                     [Expert Info (Warn/Malformed): BER Error: String expected]
</I>&gt;<i>                                         [BER Error: String expected]
</I>&gt;<i>                                         [Severity level: Warn]
</I>&gt;<i>                                         [Group: Malformed]
</I>
This is odd, is tshark buggy, too picky, or is the issuer cert actually malformed?

&gt;<i>                             Extension (id-ce-subjectAltName)
</I>&gt;<i>                                 Extension Id: 2.5.29.17 (id-ce-subjectAltName)
</I>&gt;<i>                                 GeneralNames: 1 item
</I>&gt;<i>                                     GeneralName: rfc822Name (1)
</I>&gt;<i>                                         rfc822Name: <A HREF="../../../mailman/listinfo/openssl-users.html">help at ll.mit.edu</A>
</I>&gt;<i>                             Extension (id-ce-basicConstraints)
</I>&gt;<i>                                 Extension Id: 2.5.29.19 (id-ce-basicConstraints)
</I>&gt;<i>                                 BasicConstraintsSyntax
</I>&gt;<i>                                     cA: True
</I>
Good, issuer is a CA

&gt;<i>                             Extension (id-ce-keyUsage)
</I>&gt;<i>                                 Extension Id: 2.5.29.15 (id-ce-keyUsage)
</I>&gt;<i>                                 Padding: 1
</I>&gt;<i>                                 KeyUsage: 06 (keyCertSign, cRLSign)
</I>&gt;<i>                                     0... .... = digitalSignature: False
</I>&gt;<i>                                     .0.. .... = contentCommitment: False
</I>&gt;<i>                                     ..0. .... = keyEncipherment: False
</I>&gt;<i>                                     ...0 .... = dataEncipherment: False
</I>&gt;<i>                                     .... 0... = keyAgreement: False
</I>&gt;<i>                                     .... .1.. = keyCertSign: True
</I>&gt;<i>                                     .... ..1. = cRLSign: True
</I>&gt;<i>                                     .... ...0 = encipherOnly: False
</I>&gt;<i>                                     0... .... = decipherOnly: False
</I>
Issuer ku is OK

&gt;<i>                     algorithmIdentifier (shaWithRSAEncryption)
</I>&gt;<i>                         Algorithm Id: 1.2.840.113549.1.1.5 (shaWithRSAEncryption)
</I>&gt;<i>                     Padding: 0
</I>&gt;<i>                     encrypted: 408fc9a991e6cebbec05fa6b2463d89bcb8b2dc888c1a1b6...
</I>
Issuer cert is an MiTM proxy, and possibly has encoding errors.

&gt;<i> Secure Sockets Layer
</I>&gt;<i>     TLSv1.2 Record Layer: Handshake Protocol: Server Key Exchange
</I>&gt;<i>         Content Type: Handshake (22)
</I>&gt;<i>         Version: TLS 1.2 (0x0303)
</I>&gt;<i>         Length: 333
</I>&gt;<i>         Handshake Protocol: Server Key Exchange
</I>&gt;<i>             Handshake Type: Server Key Exchange (12)
</I>&gt;<i>             Length: 329
</I>&gt;<i>             EC Diffie-Hellman Server Params
</I>
ECDHE, no problem.

&gt;<i>     TLSv1.2 Record Layer: Handshake Protocol: Server Hello Done
</I>
Fine, no request for client cert.

&gt;<i> Secure Sockets Layer
</I>&gt;<i>     TLSv1.2 Record Layer: Alert (Level: Fatal, Description: Certificate Unknown)
</I>&gt;<i>         Content Type: Alert (21)
</I>&gt;<i>         Version: TLS 1.2 (0x0303)
</I>&gt;<i>         Length: 2
</I>&gt;<i>         Alert Message
</I>&gt;<i>             Level: Fatal (2)
</I>&gt;<i>             Description: Certificate Unknown (46)
</I>
Client objects to the server chain.  Either does not trust the MiTM root CA, or
is unhappy about its encoding (assuming tshark is not generating an FP warning).

-- 
	Viktor.

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005681.html">[openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23
</A></li>
	<LI>Next message: <A HREF="005683.html">[openssl-users] What does this error mean? sslv3 alert certificate unknown:state 23
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5682">[ date ]</a>
              <a href="thread.html#5682">[ thread ]</a>
              <a href="subject.html#5682">[ subject ]</a>
              <a href="author.html#5682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
