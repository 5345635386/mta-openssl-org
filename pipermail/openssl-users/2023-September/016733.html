<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Question about using Post Handshake Authentication (SSL_VERIFY_POST_HANDSHAKE) and SSL_get_peer_certificate
   </TITLE>
   <LINK REL="Index" HREF="https://mta.openssl.org/pipermail/openssl-users/2023-September/index.html" >
   <LINK REL="made" HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Question%20about%20using%20Post%20Handshake%20Authentication%0A%20%28SSL_VERIFY_POST_HANDSHAKE%29%20and%20SSL_get_peer_certificate&In-Reply-To=%3CAM8PR08MB6547F881CF0EC35AEDF47CA3EBF9A%40AM8PR08MB6547.eurprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016728.html">
   <LINK REL="Next"  HREF="016736.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Question about using Post Handshake Authentication (SSL_VERIFY_POST_HANDSHAKE) and SSL_get_peer_certificate</H1>
    <B>Shah, Amul</B> 
    <A HREF="mailto:openssl-users%40openssl.org?Subject=Re%3A%20Question%20about%20using%20Post%20Handshake%20Authentication%0A%20%28SSL_VERIFY_POST_HANDSHAKE%29%20and%20SSL_get_peer_certificate&In-Reply-To=%3CAM8PR08MB6547F881CF0EC35AEDF47CA3EBF9A%40AM8PR08MB6547.eurprd08.prod.outlook.com%3E"
       TITLE="Question about using Post Handshake Authentication (SSL_VERIFY_POST_HANDSHAKE) and SSL_get_peer_certificate">Amul.Shah at fisglobal.com
       </A><BR>
    <I>Wed Sep 20 19:39:19 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016728.html">Openssl 1.1.1k specifications (Jan Just Keijser)
</A></li>
        <LI>Next message (by thread): <A HREF="016736.html">openssl-users Digest, Vol 106, Issue 24
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16733">[ date ]</a>
              <a href="thread.html#16733">[ thread ]</a>
              <a href="subject.html#16733">[ subject ]</a>
              <a href="author.html#16733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We have a service that uses TLS. Prior to SSL_VERIFY_POST_HANDSHAKE, we knew we would have a certificate after the handshake when using SSL_VERIFY_PEER:SSL_VERIFY_FAIL_IF_NO_PEER_CERT. We would call
SSL_get_peer_certificate after the handshake completed and dump some information about the client certificate into our logs. After adding SSL_VERIFY_POST_HANDSHAKE to the mix, I&#8217;m trying to figure out when to check for the client certificate.
The options that I see are:
* Repeatedly call SSL_get_peer_certificate, or if OpenSSL 3.0 use SSL_get0_peer_certificate
* Implement a client certificate callback function
* Use SSL_get_state, but I&#8217;m not sure how to work out the states. It looks like either TLS_ST_SR_FINISHED/TLS_ST_SW_FINISHED are what I need to wait for
Any pointers on how to know when the client certificate has been received and processed?
Thanks,
Amul
The information contained in this message is proprietary and/or confidential. If you are not the intended recipient, please: (i) delete the message and all copies; (ii) do not disclose, distribute or use the message in any manner; and (iii) notify the sender immediately. In addition, please be aware that any message addressed to our domain is subject to archiving and review by persons other than the intended recipient. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://mta.openssl.org/pipermail/openssl-users/attachments/20230920/f378c555/attachment-0001.htm">https://mta.openssl.org/pipermail/openssl-users/attachments/20230920/f378c555/attachment-0001.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016728.html">Openssl 1.1.1k specifications (Jan Just Keijser)
</A></li>
	<LI>Next message (by thread): <A HREF="016736.html">openssl-users Digest, Vol 106, Issue 24
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16733">[ date ]</a>
              <a href="thread.html#16733">[ thread ]</a>
              <a href="subject.html#16733">[ subject ]</a>
              <a href="author.html#16733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="../../../mailman/listinfo/openssl-users.html">More information about the openssl-users
mailing list</a><br>
</body></html>
